/*! For license information please see 2.19c653b0.chunk.js.LICENSE.txt */
(this.webpackJsonpcra=this.webpackJsonpcra||[]).push([[2],[function(e,t,n){"use strict";n.r(t),n.d(t,"ACESFilmicToneMapping",(function(){return fe})),n.d(t,"AddEquation",(function(){return L})),n.d(t,"AddOperation",(function(){return de})),n.d(t,"AdditiveAnimationBlendMode",(function(){return Tt})),n.d(t,"AdditiveBlending",(function(){return F})),n.d(t,"AlphaFormat",(function(){return Qe})),n.d(t,"AlwaysDepth",(function(){return re})),n.d(t,"AlwaysStencilFunc",(function(){return pn})),n.d(t,"AmbientLight",(function(){return ad})),n.d(t,"AmbientLightProbe",(function(){return bd})),n.d(t,"AnimationClip",(function(){return xg})),n.d(t,"AnimationLoader",(function(){return Xg})),n.d(t,"AnimationMixer",(function(){return tI})),n.d(t,"AnimationObjectGroup",(function(){return $d})),n.d(t,"AnimationUtils",(function(){return Cg})),n.d(t,"ArcCurve",(function(){return Xu})),n.d(t,"ArrayCamera",(function(){return hc})),n.d(t,"ArrowHelper",(function(){return zI})),n.d(t,"Audio",(function(){return Ed})),n.d(t,"AudioAnalyser",(function(){return Od})),n.d(t,"AudioContext",(function(){return pd})),n.d(t,"AudioListener",(function(){return kd})),n.d(t,"AudioLoader",(function(){return md})),n.d(t,"AxesHelper",(function(){return KI})),n.d(t,"AxisHelper",(function(){return VA})),n.d(t,"BackSide",(function(){return R})),n.d(t,"BasicDepthPacking",(function(){return Qt})),n.d(t,"BasicShadowMap",(function(){return w})),n.d(t,"BinaryTextureLoader",(function(){return LA})),n.d(t,"Bone",(function(){return nu})),n.d(t,"BooleanKeyframeTrack",(function(){return yg})),n.d(t,"BoundingBoxHelper",(function(){return FA})),n.d(t,"Box2",(function(){return gI})),n.d(t,"Box3",(function(){return wr})),n.d(t,"Box3Helper",(function(){return NI})),n.d(t,"BoxBufferGeometry",(function(){return wi})),n.d(t,"BoxGeometry",(function(){return wi})),n.d(t,"BoxHelper",(function(){return LI})),n.d(t,"BufferAttribute",(function(){return Na})),n.d(t,"BufferGeometry",(function(){return ii})),n.d(t,"BufferGeometryLoader",(function(){return dd})),n.d(t,"ByteType",(function(){return Oe})),n.d(t,"Cache",(function(){return Mg})),n.d(t,"Camera",(function(){return Ri})),n.d(t,"CameraHelper",(function(){return VI})),n.d(t,"CanvasRenderer",(function(){return YA})),n.d(t,"CanvasTexture",(function(){return Wu})),n.d(t,"CapsuleBufferGeometry",(function(){return al})),n.d(t,"CapsuleGeometry",(function(){return al})),n.d(t,"CatmullRomCurve3",(function(){return Tu})),n.d(t,"CineonToneMapping",(function(){return Ce})),n.d(t,"CircleBufferGeometry",(function(){return il})),n.d(t,"CircleGeometry",(function(){return il})),n.d(t,"ClampToEdgeWrapping",(function(){return _e})),n.d(t,"Clock",(function(){return _d})),n.d(t,"Color",(function(){return cr})),n.d(t,"ColorKeyframeTrack",(function(){return Bg})),n.d(t,"ColorManagement",(function(){return er})),n.d(t,"CompressedTexture",(function(){return Eu})),n.d(t,"CompressedTextureLoader",(function(){return Hg})),n.d(t,"ConeBufferGeometry",(function(){return sl})),n.d(t,"ConeGeometry",(function(){return sl})),n.d(t,"CubeCamera",(function(){return Ei})),n.d(t,"CubeReflectionMapping",(function(){return ve})),n.d(t,"CubeRefractionMapping",(function(){return be})),n.d(t,"CubeTexture",(function(){return Wi})),n.d(t,"CubeTextureLoader",(function(){return Lg})),n.d(t,"CubeUVReflectionMapping",(function(){return Ge})),n.d(t,"CubicBezierCurve",(function(){return Du})),n.d(t,"CubicBezierCurve3",(function(){return Uu})),n.d(t,"CubicInterpolant",(function(){return pg})),n.d(t,"CullFaceBack",(function(){return y})),n.d(t,"CullFaceFront",(function(){return B})),n.d(t,"CullFaceFrontBack",(function(){return G})),n.d(t,"CullFaceNone",(function(){return b})),n.d(t,"Curve",(function(){return Vu})),n.d(t,"CurvePath",(function(){return tl})),n.d(t,"CustomBlending",(function(){return O})),n.d(t,"CustomToneMapping",(function(){return pe})),n.d(t,"CylinderBufferGeometry",(function(){return ol})),n.d(t,"CylinderGeometry",(function(){return ol})),n.d(t,"Cylindrical",(function(){return uI})),n.d(t,"Data3DTexture",(function(){return pr})),n.d(t,"DataArrayTexture",(function(){return Cr})),n.d(t,"DataTexture",(function(){return ru})),n.d(t,"DataTexture2DArray",(function(){return qA})),n.d(t,"DataTexture3D",(function(){return $A})),n.d(t,"DataTextureLoader",(function(){return Ng})),n.d(t,"DataUtils",(function(){return DI})),n.d(t,"DecrementStencilOp",(function(){return sn})),n.d(t,"DecrementWrapStencilOp",(function(){return un})),n.d(t,"DefaultLoadingManager",(function(){return Eg})),n.d(t,"DepthFormat",(function(){return et})),n.d(t,"DepthStencilFormat",(function(){return tt})),n.d(t,"DepthTexture",(function(){return mc})),n.d(t,"DirectionalLight",(function(){return rd})),n.d(t,"DirectionalLightHelper",(function(){return kI})),n.d(t,"DiscreteInterpolant",(function(){return vg})),n.d(t,"DodecahedronBufferGeometry",(function(){return ul})),n.d(t,"DodecahedronGeometry",(function(){return ul})),n.d(t,"DoubleSide",(function(){return M})),n.d(t,"DstAlphaFactor",(function(){return J})),n.d(t,"DstColorFactor",(function(){return $})),n.d(t,"DynamicBufferAttribute",(function(){return wA})),n.d(t,"DynamicCopyUsage",(function(){return _n})),n.d(t,"DynamicDrawUsage",(function(){return vn})),n.d(t,"DynamicReadUsage",(function(){return Bn})),n.d(t,"EdgesGeometry",(function(){return Al})),n.d(t,"EdgesHelper",(function(){return XA})),n.d(t,"EllipseCurve",(function(){return Fu})),n.d(t,"EqualDepth",(function(){return oe})),n.d(t,"EqualStencilFunc",(function(){return In})),n.d(t,"EquirectangularReflectionMapping",(function(){return ye})),n.d(t,"EquirectangularRefractionMapping",(function(){return Be})),n.d(t,"Euler",(function(){return ua})),n.d(t,"EventDispatcher",(function(){return Mn})),n.d(t,"ExtrudeBufferGeometry",(function(){return Kl})),n.d(t,"ExtrudeGeometry",(function(){return Kl})),n.d(t,"FaceColors",(function(){return AA})),n.d(t,"FileLoader",(function(){return Fg})),n.d(t,"FlatShading",(function(){return k})),n.d(t,"Float16BufferAttribute",(function(){return Qa})),n.d(t,"Float32Attribute",(function(){return EA})),n.d(t,"Float32BufferAttribute",(function(){return Pa})),n.d(t,"Float64Attribute",(function(){return WA})),n.d(t,"Float64BufferAttribute",(function(){return Ja})),n.d(t,"FloatType",(function(){return ze})),n.d(t,"Fog",(function(){return _c})),n.d(t,"FogExp2",(function(){return wc})),n.d(t,"Font",(function(){return QA})),n.d(t,"FontLoader",(function(){return UA})),n.d(t,"FramebufferTexture",(function(){return ku})),n.d(t,"FrontSide",(function(){return x})),n.d(t,"Frustum",(function(){return Yi})),n.d(t,"GLBufferAttribute",(function(){return aI})),n.d(t,"GLSL1",(function(){return Sn})),n.d(t,"GLSL3",(function(){return xn})),n.d(t,"GreaterDepth",(function(){return ce})),n.d(t,"GreaterEqualDepth",(function(){return se})),n.d(t,"GreaterEqualStencilFunc",(function(){return fn})),n.d(t,"GreaterStencilFunc",(function(){return hn})),n.d(t,"GridHelper",(function(){return ZI})),n.d(t,"Group",(function(){return Cc})),n.d(t,"HalfFloatType",(function(){return Ke})),n.d(t,"HemisphereLight",(function(){return zg})),n.d(t,"HemisphereLightHelper",(function(){return _I})),n.d(t,"HemisphereLightProbe",(function(){return vd})),n.d(t,"IcosahedronBufferGeometry",(function(){return Dl})),n.d(t,"IcosahedronGeometry",(function(){return Dl})),n.d(t,"ImageBitmapLoader",(function(){return fd})),n.d(t,"ImageLoader",(function(){return Og})),n.d(t,"ImageUtils",(function(){return ur})),n.d(t,"ImmediateRenderObject",(function(){return PA})),n.d(t,"IncrementStencilOp",(function(){return on})),n.d(t,"IncrementWrapStencilOp",(function(){return cn})),n.d(t,"InstancedBufferAttribute",(function(){return su})),n.d(t,"InstancedBufferGeometry",(function(){return ld})),n.d(t,"InstancedInterleavedBuffer",(function(){return rI})),n.d(t,"InstancedMesh",(function(){return du})),n.d(t,"Int16Attribute",(function(){return xA})),n.d(t,"Int16BufferAttribute",(function(){return Ka})),n.d(t,"Int32Attribute",(function(){return MA})),n.d(t,"Int32BufferAttribute",(function(){return Da})),n.d(t,"Int8Attribute",(function(){return _A})),n.d(t,"Int8BufferAttribute",(function(){return Ya})),n.d(t,"IntType",(function(){return Ye})),n.d(t,"InterleavedBuffer",(function(){return Sc})),n.d(t,"InterleavedBufferAttribute",(function(){return Rc})),n.d(t,"Interpolant",(function(){return fg})),n.d(t,"InterpolateDiscrete",(function(){return Ft})),n.d(t,"InterpolateLinear",(function(){return Xt})),n.d(t,"InterpolateSmooth",(function(){return Ht})),n.d(t,"InvertStencilOp",(function(){return ln})),n.d(t,"JSONLoader",(function(){return TA})),n.d(t,"KeepStencilOp",(function(){return rn})),n.d(t,"KeyframeTrack",(function(){return bg})),n.d(t,"LOD",(function(){return Qc})),n.d(t,"LatheBufferGeometry",(function(){return rl})),n.d(t,"LatheGeometry",(function(){return rl})),n.d(t,"Layers",(function(){return la})),n.d(t,"LensFlare",(function(){return KA})),n.d(t,"LessDepth",(function(){return ae})),n.d(t,"LessEqualDepth",(function(){return ie})),n.d(t,"LessEqualStencilFunc",(function(){return An})),n.d(t,"LessStencilFunc",(function(){return dn})),n.d(t,"Light",(function(){return Tg})),n.d(t,"LightProbe",(function(){return sd})),n.d(t,"Line",(function(){return mu})),n.d(t,"Line3",(function(){return AI})),n.d(t,"LineBasicMaterial",(function(){return Iu})),n.d(t,"LineCurve",(function(){return Qu})),n.d(t,"LineCurve3",(function(){return Pu})),n.d(t,"LineDashedMaterial",(function(){return Ag})),n.d(t,"LineLoop",(function(){return Bu})),n.d(t,"LinePieces",(function(){return dA})),n.d(t,"LineSegments",(function(){return yu})),n.d(t,"LineStrip",(function(){return gA})),n.d(t,"LinearEncoding",(function(){return Dt})),n.d(t,"LinearFilter",(function(){return Ee})),n.d(t,"LinearInterpolant",(function(){return mg})),n.d(t,"LinearMipMapLinearFilter",(function(){return Xe})),n.d(t,"LinearMipMapNearestFilter",(function(){return Ve})),n.d(t,"LinearMipmapLinearFilter",(function(){return Fe})),n.d(t,"LinearMipmapNearestFilter",(function(){return We})),n.d(t,"LinearSRGBColorSpace",(function(){return tn})),n.d(t,"LinearToneMapping",(function(){return Ae})),n.d(t,"Loader",(function(){return Wg})),n.d(t,"LoaderUtils",(function(){return ud})),n.d(t,"LoadingManager",(function(){return kg})),n.d(t,"LoopOnce",(function(){return Et})),n.d(t,"LoopPingPong",(function(){return Vt})),n.d(t,"LoopRepeat",(function(){return Wt})),n.d(t,"LuminanceAlphaFormat",(function(){return $e})),n.d(t,"LuminanceFormat",(function(){return qe})),n.d(t,"MOUSE",(function(){return m})),n.d(t,"Material",(function(){return Xa})),n.d(t,"MaterialLoader",(function(){return cd})),n.d(t,"Math",(function(){return zn})),n.d(t,"MathUtils",(function(){return zn})),n.d(t,"Matrix3",(function(){return jn})),n.d(t,"Matrix4",(function(){return $r})),n.d(t,"MaxEquation",(function(){return z})),n.d(t,"Mesh",(function(){return Bi})),n.d(t,"MeshBasicMaterial",(function(){return Ha})),n.d(t,"MeshDepthMaterial",(function(){return uc})),n.d(t,"MeshDistanceMaterial",(function(){return lc})),n.d(t,"MeshFaceMaterial",(function(){return CA})),n.d(t,"MeshLambertMaterial",(function(){return dg})),n.d(t,"MeshMatcapMaterial",(function(){return Ig})),n.d(t,"MeshNormalMaterial",(function(){return gg})),n.d(t,"MeshPhongMaterial",(function(){return ug})),n.d(t,"MeshPhysicalMaterial",(function(){return cg})),n.d(t,"MeshStandardMaterial",(function(){return sg})),n.d(t,"MeshToonMaterial",(function(){return lg})),n.d(t,"MinEquation",(function(){return T})),n.d(t,"MirroredRepeatWrapping",(function(){return Ze})),n.d(t,"MixOperation",(function(){return ge})),n.d(t,"MultiMaterial",(function(){return fA})),n.d(t,"MultiplyBlending",(function(){return H})),n.d(t,"MultiplyOperation",(function(){return le})),n.d(t,"NearestFilter",(function(){return Se})),n.d(t,"NearestMipMapLinearFilter",(function(){return ke})),n.d(t,"NearestMipMapNearestFilter",(function(){return Re})),n.d(t,"NearestMipmapLinearFilter",(function(){return Me})),n.d(t,"NearestMipmapNearestFilter",(function(){return xe})),n.d(t,"NeverDepth",(function(){return ne})),n.d(t,"NeverStencilFunc",(function(){return gn})),n.d(t,"NoBlending",(function(){return W})),n.d(t,"NoColorSpace",(function(){return $t})),n.d(t,"NoColors",(function(){return IA})),n.d(t,"NoToneMapping",(function(){return Ie})),n.d(t,"NormalAnimationBlendMode",(function(){return Yt})),n.d(t,"NormalBlending",(function(){return V})),n.d(t,"NotEqualDepth",(function(){return ue})),n.d(t,"NotEqualStencilFunc",(function(){return Cn})),n.d(t,"NumberKeyframeTrack",(function(){return Gg})),n.d(t,"Object3D",(function(){return Ga})),n.d(t,"ObjectLoader",(function(){return Id})),n.d(t,"ObjectSpaceNormalMap",(function(){return qt})),n.d(t,"OctahedronBufferGeometry",(function(){return Ul})),n.d(t,"OctahedronGeometry",(function(){return Ul})),n.d(t,"OneFactor",(function(){return j})),n.d(t,"OneMinusDstAlphaFactor",(function(){return q})),n.d(t,"OneMinusDstColorFactor",(function(){return ee})),n.d(t,"OneMinusSrcAlphaFactor",(function(){return P})),n.d(t,"OneMinusSrcColorFactor",(function(){return U})),n.d(t,"OrthographicCamera",(function(){return to})),n.d(t,"PCFShadowMap",(function(){return _})),n.d(t,"PCFSoftShadowMap",(function(){return Z})),n.d(t,"PMREMGenerator",(function(){return lo})),n.d(t,"ParametricGeometry",(function(){return jA})),n.d(t,"Particle",(function(){return mA})),n.d(t,"ParticleBasicMaterial",(function(){return yA})),n.d(t,"ParticleSystem",(function(){return vA})),n.d(t,"ParticleSystemMaterial",(function(){return BA})),n.d(t,"Path",(function(){return nl})),n.d(t,"PerspectiveCamera",(function(){return Mi})),n.d(t,"Plane",(function(){return Oi})),n.d(t,"PlaneBufferGeometry",(function(){return Ki})),n.d(t,"PlaneGeometry",(function(){return Ki})),n.d(t,"PlaneHelper",(function(){return YI})),n.d(t,"PointCloud",(function(){return pA})),n.d(t,"PointCloudMaterial",(function(){return bA})),n.d(t,"PointLight",(function(){return td})),n.d(t,"PointLightHelper",(function(){return yI})),n.d(t,"Points",(function(){return xu})),n.d(t,"PointsMaterial",(function(){return Gu})),n.d(t,"PolarGridHelper",(function(){return SI})),n.d(t,"PolyhedronBufferGeometry",(function(){return cl})),n.d(t,"PolyhedronGeometry",(function(){return cl})),n.d(t,"PositionalAudio",(function(){return Hd})),n.d(t,"PropertyBinding",(function(){return qd})),n.d(t,"PropertyMixer",(function(){return Ld})),n.d(t,"QuadraticBezierCurve",(function(){return Ju})),n.d(t,"QuadraticBezierCurve3",(function(){return qu})),n.d(t,"Quaternion",(function(){return br})),n.d(t,"QuaternionKeyframeTrack",(function(){return _g})),n.d(t,"QuaternionLinearInterpolant",(function(){return wg})),n.d(t,"REVISION",(function(){return p})),n.d(t,"RGBADepthPacking",(function(){return Pt})),n.d(t,"RGBAFormat",(function(){return Je})),n.d(t,"RGBAIntegerFormat",(function(){return ot})),n.d(t,"RGBA_ASTC_10x10_Format",(function(){return xt})),n.d(t,"RGBA_ASTC_10x5_Format",(function(){return _t})),n.d(t,"RGBA_ASTC_10x6_Format",(function(){return Zt})),n.d(t,"RGBA_ASTC_10x8_Format",(function(){return St})),n.d(t,"RGBA_ASTC_12x10_Format",(function(){return Rt})),n.d(t,"RGBA_ASTC_12x12_Format",(function(){return Mt})),n.d(t,"RGBA_ASTC_4x4_Format",(function(){return pt})),n.d(t,"RGBA_ASTC_5x4_Format",(function(){return mt})),n.d(t,"RGBA_ASTC_5x5_Format",(function(){return vt})),n.d(t,"RGBA_ASTC_6x5_Format",(function(){return bt})),n.d(t,"RGBA_ASTC_6x6_Format",(function(){return yt})),n.d(t,"RGBA_ASTC_8x5_Format",(function(){return Bt})),n.d(t,"RGBA_ASTC_8x6_Format",(function(){return Gt})),n.d(t,"RGBA_ASTC_8x8_Format",(function(){return wt})),n.d(t,"RGBA_BPTC_Format",(function(){return kt})),n.d(t,"RGBA_ETC2_EAC_Format",(function(){return ft})),n.d(t,"RGBA_PVRTC_2BPPV1_Format",(function(){return At})),n.d(t,"RGBA_PVRTC_4BPPV1_Format",(function(){return It})),n.d(t,"RGBA_S3TC_DXT1_Format",(function(){return ct})),n.d(t,"RGBA_S3TC_DXT3_Format",(function(){return ut})),n.d(t,"RGBA_S3TC_DXT5_Format",(function(){return lt})),n.d(t,"RGBFormat",(function(){return Pe})),n.d(t,"RGB_ETC1_Format",(function(){return ht})),n.d(t,"RGB_ETC2_Format",(function(){return Ct})),n.d(t,"RGB_PVRTC_2BPPV1_Format",(function(){return dt})),n.d(t,"RGB_PVRTC_4BPPV1_Format",(function(){return gt})),n.d(t,"RGB_S3TC_DXT1_Format",(function(){return st})),n.d(t,"RGFormat",(function(){return at})),n.d(t,"RGIntegerFormat",(function(){return it})),n.d(t,"RawShaderMaterial",(function(){return og})),n.d(t,"Ray",(function(){return qr})),n.d(t,"Raycaster",(function(){return iI})),n.d(t,"RectAreaLight",(function(){return id})),n.d(t,"RedFormat",(function(){return nt})),n.d(t,"RedIntegerFormat",(function(){return rt})),n.d(t,"ReinhardToneMapping",(function(){return he})),n.d(t,"RepeatWrapping",(function(){return we})),n.d(t,"ReplaceStencilOp",(function(){return an})),n.d(t,"ReverseSubtractEquation",(function(){return Y})),n.d(t,"RingBufferGeometry",(function(){return Ql})),n.d(t,"RingGeometry",(function(){return Ql})),n.d(t,"SRGBColorSpace",(function(){return en})),n.d(t,"Scene",(function(){return Zc})),n.d(t,"SceneUtils",(function(){return zA})),n.d(t,"ShaderChunk",(function(){return ji})),n.d(t,"ShaderLib",(function(){return Ui})),n.d(t,"ShaderMaterial",(function(){return xi})),n.d(t,"ShadowMaterial",(function(){return ig})),n.d(t,"Shape",(function(){return hl})),n.d(t,"ShapeBufferGeometry",(function(){return Pl})),n.d(t,"ShapeGeometry",(function(){return Pl})),n.d(t,"ShapePath",(function(){return jI})),n.d(t,"ShapeUtils",(function(){return Yl})),n.d(t,"ShortType",(function(){return Le})),n.d(t,"Skeleton",(function(){return ou})),n.d(t,"SkeletonHelper",(function(){return vI})),n.d(t,"SkinnedMesh",(function(){return tu})),n.d(t,"SmoothShading",(function(){return E})),n.d(t,"Source",(function(){return lr})),n.d(t,"Sphere",(function(){return zr})),n.d(t,"SphereBufferGeometry",(function(){return Jl})),n.d(t,"SphereGeometry",(function(){return Jl})),n.d(t,"Spherical",(function(){return cI})),n.d(t,"SphericalHarmonics3",(function(){return od})),n.d(t,"SplineCurve",(function(){return $u})),n.d(t,"SpotLight",(function(){return Pg})),n.d(t,"SpotLightHelper",(function(){return CI})),n.d(t,"Sprite",(function(){return Kc})),n.d(t,"SpriteMaterial",(function(){return kc})),n.d(t,"SrcAlphaFactor",(function(){return Q})),n.d(t,"SrcAlphaSaturateFactor",(function(){return te})),n.d(t,"SrcColorFactor",(function(){return D})),n.d(t,"StaticCopyUsage",(function(){return wn})),n.d(t,"StaticDrawUsage",(function(){return mn})),n.d(t,"StaticReadUsage",(function(){return yn})),n.d(t,"StereoCamera",(function(){return wd})),n.d(t,"StreamCopyUsage",(function(){return Zn})),n.d(t,"StreamDrawUsage",(function(){return bn})),n.d(t,"StreamReadUsage",(function(){return Gn})),n.d(t,"StringKeyframeTrack",(function(){return Zg})),n.d(t,"SubtractEquation",(function(){return N})),n.d(t,"SubtractiveBlending",(function(){return X})),n.d(t,"TOUCH",(function(){return v})),n.d(t,"TangentSpaceNormalMap",(function(){return Jt})),n.d(t,"TetrahedronBufferGeometry",(function(){return ql})),n.d(t,"TetrahedronGeometry",(function(){return ql})),n.d(t,"TextGeometry",(function(){return DA})),n.d(t,"Texture",(function(){return Ir})),n.d(t,"TextureLoader",(function(){return Yg})),n.d(t,"TorusBufferGeometry",(function(){return $l})),n.d(t,"TorusGeometry",(function(){return $l})),n.d(t,"TorusKnotBufferGeometry",(function(){return eg})),n.d(t,"TorusKnotGeometry",(function(){return eg})),n.d(t,"Triangle",(function(){return Va})),n.d(t,"TriangleFanDrawMode",(function(){return jt})),n.d(t,"TriangleStripDrawMode",(function(){return Kt})),n.d(t,"TrianglesDrawMode",(function(){return zt})),n.d(t,"TubeBufferGeometry",(function(){return tg})),n.d(t,"TubeGeometry",(function(){return tg})),n.d(t,"UVMapping",(function(){return me})),n.d(t,"Uint16Attribute",(function(){return RA})),n.d(t,"Uint16BufferAttribute",(function(){return ja})),n.d(t,"Uint32Attribute",(function(){return kA})),n.d(t,"Uint32BufferAttribute",(function(){return Ua})),n.d(t,"Uint8Attribute",(function(){return ZA})),n.d(t,"Uint8BufferAttribute",(function(){return Ta})),n.d(t,"Uint8ClampedAttribute",(function(){return SA})),n.d(t,"Uint8ClampedBufferAttribute",(function(){return za})),n.d(t,"Uniform",(function(){return nI})),n.d(t,"UniformsLib",(function(){return Di})),n.d(t,"UniformsUtils",(function(){return Si})),n.d(t,"UnsignedByteType",(function(){return He})),n.d(t,"UnsignedInt248Type",(function(){return Ue})),n.d(t,"UnsignedIntType",(function(){return Te})),n.d(t,"UnsignedShort4444Type",(function(){return je})),n.d(t,"UnsignedShort5551Type",(function(){return De})),n.d(t,"UnsignedShortType",(function(){return Ne})),n.d(t,"VSMShadowMap",(function(){return S})),n.d(t,"Vector2",(function(){return Kn})),n.d(t,"Vector3",(function(){return yr})),n.d(t,"Vector4",(function(){return Ar})),n.d(t,"VectorKeyframeTrack",(function(){return Sg})),n.d(t,"Vertex",(function(){return GA})),n.d(t,"VertexColors",(function(){return hA})),n.d(t,"VideoTexture",(function(){return Mu})),n.d(t,"WebGL1Renderer",(function(){return Gc})),n.d(t,"WebGL3DRenderTarget",(function(){return mr})),n.d(t,"WebGLArrayRenderTarget",(function(){return fr})),n.d(t,"WebGLCubeRenderTarget",(function(){return Vi})),n.d(t,"WebGLMultipleRenderTargets",(function(){return vr})),n.d(t,"WebGLMultisampleRenderTarget",(function(){return JA})),n.d(t,"WebGLRenderTarget",(function(){return hr})),n.d(t,"WebGLRenderTargetCube",(function(){return NA})),n.d(t,"WebGLRenderer",(function(){return Bc})),n.d(t,"WebGLUtils",(function(){return Ac})),n.d(t,"WireframeGeometry",(function(){return ng})),n.d(t,"WireframeHelper",(function(){return HA})),n.d(t,"WrapAroundEnding",(function(){return Nt})),n.d(t,"XHRLoader",(function(){return OA})),n.d(t,"ZeroCurvatureEnding",(function(){return Ot})),n.d(t,"ZeroFactor",(function(){return K})),n.d(t,"ZeroSlopeEnding",(function(){return Lt})),n.d(t,"ZeroStencilOp",(function(){return nn})),n.d(t,"_SRGBAFormat",(function(){return Rn})),n.d(t,"sRGBEncoding",(function(){return Ut}));for(var r,a=n(32),i=n(22),o=n(10),s=n(68),c=n(12),u=n(11),l=n(3),g=n(6),d=n(7),I=n(2),A=n(4),h=n(5),C=n(17),f=n.n(C),p="139",m={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},v={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b=0,y=1,B=2,G=3,w=0,_=1,Z=2,S=3,x=0,R=1,M=2,k=1,E=2,W=0,V=1,F=2,X=3,H=4,O=5,L=100,N=101,Y=102,T=103,z=104,K=200,j=201,D=202,U=203,Q=204,P=205,J=206,q=207,$=208,ee=209,te=210,ne=0,re=1,ae=2,ie=3,oe=4,se=5,ce=6,ue=7,le=0,ge=1,de=2,Ie=0,Ae=1,he=2,Ce=3,fe=4,pe=5,me=300,ve=301,be=302,ye=303,Be=304,Ge=306,we=1e3,_e=1001,Ze=1002,Se=1003,xe=1004,Re=1004,Me=1005,ke=1005,Ee=1006,We=1007,Ve=1007,Fe=1008,Xe=1008,He=1009,Oe=1010,Le=1011,Ne=1012,Ye=1013,Te=1014,ze=1015,Ke=1016,je=1017,De=1018,Ue=1020,Qe=1021,Pe=1022,Je=1023,qe=1024,$e=1025,et=1026,tt=1027,nt=1028,rt=1029,at=1030,it=1031,ot=1033,st=33776,ct=33777,ut=33778,lt=33779,gt=35840,dt=35841,It=35842,At=35843,ht=36196,Ct=37492,ft=37496,pt=37808,mt=37809,vt=37810,bt=37811,yt=37812,Bt=37813,Gt=37814,wt=37815,_t=37816,Zt=37817,St=37818,xt=37819,Rt=37820,Mt=37821,kt=36492,Et=2200,Wt=2201,Vt=2202,Ft=2300,Xt=2301,Ht=2302,Ot=2400,Lt=2401,Nt=2402,Yt=2500,Tt=2501,zt=0,Kt=1,jt=2,Dt=3e3,Ut=3001,Qt=3200,Pt=3201,Jt=0,qt=1,$t="",en="srgb",tn="srgb-linear",nn=0,rn=7680,an=7681,on=7682,sn=7683,cn=34055,un=34056,ln=5386,gn=512,dn=513,In=514,An=515,hn=516,Cn=517,fn=518,pn=519,mn=35044,vn=35048,bn=35040,yn=35045,Bn=35049,Gn=35041,wn=35046,_n=35050,Zn=35042,Sn="100",xn="300 es",Rn=1035,Mn=function(){function e(){Object(A.a)(this,e)}return Object(h.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,a=n.length;r<a;r++)n[r].call(this,e);e.target=null}}}}]),e}(),kn=[],En=0;En<256;En++)kn[En]=(En<16?"0":"")+En.toString(16);var Wn=1234567,Vn=Math.PI/180,Fn=180/Math.PI;function Xn(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(kn[255&e]+kn[e>>8&255]+kn[e>>16&255]+kn[e>>24&255]+"-"+kn[255&t]+kn[t>>8&255]+"-"+kn[t>>16&15|64]+kn[t>>24&255]+"-"+kn[63&n|128]+kn[n>>8&255]+"-"+kn[n>>16&255]+kn[n>>24&255]+kn[255&r]+kn[r>>8&255]+kn[r>>16&255]+kn[r>>24&255]).toLowerCase()}function Hn(e,t,n){return Math.max(t,Math.min(n,e))}function On(e,t){return(e%t+t)%t}function Ln(e,t,n){return(1-n)*e+n*t}function Nn(e){return 0===(e&e-1)&&0!==e}function Yn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Tn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var zn=Object.freeze({__proto__:null,DEG2RAD:Vn,RAD2DEG:Fn,generateUUID:Xn,clamp:Hn,euclideanModulo:On,mapLinear:function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Ln,damp:function(e,t,n,r){return Ln(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(On(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Wn=e);var t=Wn+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Vn},radToDeg:function(e){return e*Fn},isPowerOfTwo:Nn,ceilPowerOfTwo:Yn,floorPowerOfTwo:Tn,setQuaternionFromProperEuler:function(e,t,n,r,a){var i=Math.cos,o=Math.sin,s=i(n/2),c=o(n/2),u=i((t+r)/2),l=o((t+r)/2),g=i((t-r)/2),d=o((t-r)/2),I=i((r-t)/2),A=o((r-t)/2);switch(a){case"XYX":e.set(s*l,c*g,c*d,s*u);break;case"YZY":e.set(c*d,s*l,c*g,s*u);break;case"ZXZ":e.set(c*g,c*d,s*l,s*u);break;case"XZX":e.set(s*l,c*A,c*I,s*u);break;case"YXY":e.set(c*I,s*l,c*A,s*u);break;case"ZYZ":e.set(c*A,c*I,s*l,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}}),Kn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,t),this.x=e,this.y=n}return Object(h.a)(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:e,value:f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);Kn.prototype.isVector2=!0;var jn=function(){function e(){Object(A.a)(this,e),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Object(h.a)(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,c){var u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=a,u[5]=s,u[6]=n,u[7]=i,u[8]=c,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[3],s=n[6],c=n[1],u=n[4],l=n[7],g=n[2],d=n[5],I=n[8],A=r[0],h=r[3],C=r[6],f=r[1],p=r[4],m=r[7],v=r[2],b=r[5],y=r[8];return a[0]=i*A+o*f+s*v,a[3]=i*h+o*p+s*b,a[6]=i*C+o*m+s*y,a[1]=c*A+u*f+l*v,a[4]=c*h+u*p+l*b,a[7]=c*C+u*m+l*y,a[2]=g*A+d*f+I*v,a[5]=g*h+d*p+I*b,a[8]=g*C+d*m+I*y,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8];return t*i*u-t*o*c-n*a*u+n*o*s+r*a*c-r*i*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=u*i-o*c,g=o*s-u*a,d=c*a-i*s,I=t*l+n*g+r*d;if(0===I)return this.set(0,0,0,0,0,0,0,0,0);var A=1/I;return e[0]=l*A,e[1]=(r*c-u*n)*A,e[2]=(o*n-r*i)*A,e[3]=g*A,e[4]=(u*t-r*s)*A,e[5]=(r*a-o*t)*A,e[6]=d*A,e[7]=(n*s-c*t)*A,e[8]=(i*t-n*a)*A,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,a,i,o){var s=Math.cos(a),c=Math.sin(a);return this.set(n*s,n*c,-n*(s*i+c*o)+i+e,-r*c,r*s,-r*(-c*i+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,a=r[0],i=r[3],o=r[6],s=r[1],c=r[4],u=r[7];return r[0]=t*a+n*s,r[3]=t*i+n*c,r[6]=t*o+n*u,r[1]=-n*a+t*s,r[4]=-n*i+t*c,r[7]=-n*o+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function Dn(e){for(var t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}jn.prototype.isMatrix3=!0;var Un={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Qn(e,t){return new Un[e](t)}function Pn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Jn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function qn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var $n=(r={},Object(I.a)(r,en,Object(I.a)({},tn,Jn)),Object(I.a)(r,tn,Object(I.a)({},en,qn)),r),er={legacyMode:!0,get workingColorSpace(){return tn},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if($n[t]&&void 0!==$n[t][n]){var r=$n[t][n];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},tr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nr={r:0,g:0,b:0},rr={h:0,s:0,l:0},ar={h:0,s:0,l:0};function ir(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function or(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var sr,cr=function(){function e(t,n,r){return Object(A.a)(this,e),void 0===n&&void 0===r?this.set(t):this.setRGB(t,n,r)}return Object(h.a)(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:en;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,er.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tn;return this.r=e,this.g=t,this.b=n,er.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tn;if(e=On(e,1),t=Hn(t,0,1),n=Hn(n,0,1),0===t)this.r=this.g=this.b=n;else{var a=n<=.5?n*(1+t):n+t-n*t,i=2*n-a;this.r=ir(i,a,e+1/3),this.g=ir(i,a,e),this.b=ir(i,a,e-1/3)}return er.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:en;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var a,i=t[1],o=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,er.toWorkingColorSpace(this,n),r(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,er.toWorkingColorSpace(this,n),r(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(a[1])/360,c=parseInt(a[2],10)/100,u=parseInt(a[3],10)/100;return r(a[4]),this.setHSL(s,c,u,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=t[1],g=l.length;if(3===g)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,er.toWorkingColorSpace(this,n),this;if(6===g)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,er.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:en,n=tr[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=Jn(e.r),this.g=Jn(e.g),this.b=Jn(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=qn(e.r),this.g=qn(e.g),this.b=qn(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return er.fromWorkingColorSpace(or(this,nr),e),Hn(255*nr.r,0,255)<<16^Hn(255*nr.g,0,255)<<8^Hn(255*nr.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tn;er.fromWorkingColorSpace(or(this,nr),t);var n,r,a=nr.r,i=nr.g,o=nr.b,s=Math.max(a,i,o),c=Math.min(a,i,o),u=(c+s)/2;if(c===s)n=0,r=0;else{var l=s-c;switch(r=u<=.5?l/(s+c):l/(2-s-c),s){case a:n=(i-o)/l+(i<o?6:0);break;case i:n=(o-a)/l+2;break;case o:n=(a-i)/l+4}n/=6}return e.h=n,e.s=r,e.l=u,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tn;return er.fromWorkingColorSpace(or(this,nr),t),e.r=nr.r,e.g=nr.g,e.b=nr.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:en;return er.fromWorkingColorSpace(or(this,nr),e),e!==en?"color(".concat(e," ").concat(nr.r," ").concat(nr.g," ").concat(nr.b,")"):"rgb(".concat(255*nr.r|0,",").concat(255*nr.g|0,",").concat(255*nr.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(rr),rr.h+=e,rr.s+=t,rr.l+=n,this.setHSL(rr.h,rr.s,rr.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(rr),e.getHSL(ar);var n=Ln(rr.h,ar.h,t),r=Ln(rr.s,ar.s,t),a=Ln(rr.l,ar.l,t);return this.setHSL(n,r,a),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();cr.NAMES=tr,cr.prototype.isColor=!0,cr.prototype.r=1,cr.prototype.g=1,cr.prototype.b=1;var ur=function(){function e(){Object(A.a)(this,e)}return Object(h.a)(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===sr&&(sr=Pn("canvas")),sr.width=e.width,sr.height=e.height;var n=sr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=sr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=Pn("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),a=r.data,i=0;i<a.length;i++)a[i]=255*Jn(a[i]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*Jn(o[s]/255)):o[s]=Jn(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),lr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(A.a)(this,e),this.uuid=Xn(),this.data=t,this.version=0}return Object(h.a)(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var a;if(Array.isArray(r)){a=[];for(var i=0,o=r.length;i<o;i++)r[i].isDataTexture?a.push(gr(r[i].image)):a.push(gr(r[i]))}else a=gr(r);n.url=a}return t||(e.images[this.uuid]=n),n}}]),e}();function gr(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?ur.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}lr.prototype.isSource=!0;var dr=0,Ir=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_e,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_e,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ee,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Fe,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Je,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:He,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Dt;return Object(A.a)(this,n),e=t.call(this),Object.defineProperty(Object(l.a)(e),"id",{value:dr++}),e.uuid=Xn(),e.name="",e.source=new lr(r),e.mipmaps=[],e.mapping=a,e.wrapS=i,e.wrapT=o,e.magFilter=s,e.minFilter=c,e.anisotropy=d,e.format=u,e.internalFormat=null,e.type=g,e.offset=new Kn(0,0),e.repeat=new Kn(1,1),e.center=new Kn(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new jn,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=I,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return Object(h.a)(n,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(this.mapping!==me)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case we:e.x=e.x-Math.floor(e.x);break;case _e:e.x=e.x<0?0:1;break;case Ze:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case we:e.y=e.y-Math.floor(e.y);break;case _e:e.y=e.y<0?0:1;break;case Ze:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),n}(Mn);Ir.DEFAULT_IMAGE=null,Ir.DEFAULT_MAPPING=me,Ir.prototype.isTexture=!0;var Ar=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(A.a)(this,t),this.x=e,this.y=n,this.z=r,this.w=a}return Object(h.a)(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,a,i=.01,o=.1,s=e.elements,c=s[0],u=s[4],l=s[8],g=s[1],d=s[5],I=s[9],A=s[2],h=s[6],C=s[10];if(Math.abs(u-g)<i&&Math.abs(l-A)<i&&Math.abs(I-h)<i){if(Math.abs(u+g)<o&&Math.abs(l+A)<o&&Math.abs(I+h)<o&&Math.abs(c+d+C-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var f=(c+1)/2,p=(d+1)/2,m=(C+1)/2,v=(u+g)/4,b=(l+A)/4,y=(I+h)/4;return f>p&&f>m?f<i?(n=0,r=.707106781,a=.707106781):(r=v/(n=Math.sqrt(f)),a=b/n):p>m?p<i?(n=.707106781,r=0,a=.707106781):(n=v/(r=Math.sqrt(p)),a=y/r):m<i?(n=.707106781,r=.707106781,a=0):(n=b/(a=Math.sqrt(m)),r=y/a),this.set(n,r,a,t),this}var B=Math.sqrt((h-I)*(h-I)+(l-A)*(l-A)+(g-u)*(g-u));return Math.abs(B)<.001&&(B=1),this.x=(h-I)/B,this.y=(l-A)/B,this.z=(g-u)/B,this.w=Math.acos((c+d+C-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:e,value:f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);Ar.prototype.isVector4=!0;var hr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(A.a)(this,n),(a=t.call(this)).width=e,a.height=r,a.depth=1,a.scissor=new Ar(0,0,e,r),a.scissorTest=!1,a.viewport=new Ar(0,0,e,r);var o={width:e,height:r,depth:1};return a.texture=new Ir(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture.isRenderTargetTexture=!0,a.texture.flipY=!1,a.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,a.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,a.texture.minFilter=void 0!==i.minFilter?i.minFilter:Ee,a.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,a.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,a.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,a.samples=void 0!==i.samples?i.samples:0,a}return Object(h.a)(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Mn);hr.prototype.isWebGLRenderTarget=!0;var Cr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(A.a)(this,n),(e=t.call(this,null)).image={data:r,width:a,height:i,depth:o},e.magFilter=Se,e.minFilter=Se,e.wrapR=_e,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Object(h.a)(n)}(Ir);Cr.prototype.isDataArrayTexture=!0;var fr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),(i=t.call(this,e,r)).depth=a,i.texture=new Cr(null,e,r,a),i.texture.isRenderTargetTexture=!0,i}return Object(h.a)(n)}(hr);fr.prototype.isWebGLArrayRenderTarget=!0;var pr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(A.a)(this,n),(e=t.call(this,null)).image={data:r,width:a,height:i,depth:o},e.magFilter=Se,e.minFilter=Se,e.wrapR=_e,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Object(h.a)(n)}(Ir);pr.prototype.isData3DTexture=!0;var mr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),(i=t.call(this,e,r)).depth=a,i.texture=new pr(null,e,r,a),i.texture.isRenderTargetTexture=!0,i}return Object(h.a)(n)}(hr);mr.prototype.isWebGL3DRenderTarget=!0;var vr=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(A.a)(this,n);var s=(i=t.call(this,e,r,o)).texture;i.texture=[];for(var c=0;c<a;c++)i.texture[c]=s.clone(),i.texture[c].isRenderTargetTexture=!0;return i}return Object(h.a)(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}]),n}(hr);vr.prototype.isWebGLMultipleRenderTargets=!0;var br=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(A.a)(this,e),this._x=t,this._y=n,this._z=r,this._w=a}return Object(h.a)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,a=e._z,i=e._order,o=Math.cos,s=Math.sin,c=o(n/2),u=o(r/2),l=o(a/2),g=s(n/2),d=s(r/2),I=s(a/2);switch(i){case"XYZ":this._x=g*u*l+c*d*I,this._y=c*d*l-g*u*I,this._z=c*u*I+g*d*l,this._w=c*u*l-g*d*I;break;case"YXZ":this._x=g*u*l+c*d*I,this._y=c*d*l-g*u*I,this._z=c*u*I-g*d*l,this._w=c*u*l+g*d*I;break;case"ZXY":this._x=g*u*l-c*d*I,this._y=c*d*l+g*u*I,this._z=c*u*I+g*d*l,this._w=c*u*l-g*d*I;break;case"ZYX":this._x=g*u*l-c*d*I,this._y=c*d*l+g*u*I,this._z=c*u*I-g*d*l,this._w=c*u*l+g*d*I;break;case"YZX":this._x=g*u*l+c*d*I,this._y=c*d*l+g*u*I,this._z=c*u*I-g*d*l,this._w=c*u*l-g*d*I;break;case"XZY":this._x=g*u*l-c*d*I,this._y=c*d*l-g*u*I,this._z=c*u*I+g*d*l,this._w=c*u*l+g*d*I;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],o=t[5],s=t[9],c=t[2],u=t[6],l=t[10],g=n+o+l;if(g>0){var d=.5/Math.sqrt(g+1);this._w=.25/d,this._x=(u-s)*d,this._y=(a-c)*d,this._z=(i-r)*d}else if(n>o&&n>l){var I=2*Math.sqrt(1+n-o-l);this._w=(u-s)/I,this._x=.25*I,this._y=(r+i)/I,this._z=(a+c)/I}else if(o>l){var A=2*Math.sqrt(1+o-n-l);this._w=(a-c)/A,this._x=(r+i)/A,this._y=.25*A,this._z=(s+u)/A}else{var h=2*Math.sqrt(1+l-n-o);this._w=(i-r)/h,this._x=(a+c)/h,this._y=(s+u)/h,this._z=.25*h}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(Hn(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._w,o=t._x,s=t._y,c=t._z,u=t._w;return this._x=n*u+i*o+r*c-a*s,this._y=r*u+i*s+a*o-n*c,this._z=a*u+i*c+n*s-r*o,this._w=i*u-n*o-r*s-a*c,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,a=this._z,i=this._w,o=i*e._w+n*e._x+r*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;var s=1-o*o;if(s<=Number.EPSILON){var c=1-t;return this._w=c*i+t*this._w,this._x=c*n+t*this._x,this._y=c*r+t*this._y,this._z=c*a+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),l=Math.atan2(u,o),g=Math.sin((1-t)*l)/u,d=Math.sin(t*l)/u;return this._w=i*g+this._w*d,this._x=n*g+this._x*d,this._y=r*g+this._y*d,this._z=a*g+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(a),n*Math.cos(a),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}},{key:"slerpFlat",value:function(e,t,n,r,a,i,o){var s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3],g=a[i+0],d=a[i+1],I=a[i+2],A=a[i+3];if(0===o)return e[t+0]=s,e[t+1]=c,e[t+2]=u,void(e[t+3]=l);if(1===o)return e[t+0]=g,e[t+1]=d,e[t+2]=I,void(e[t+3]=A);if(l!==A||s!==g||c!==d||u!==I){var h=1-o,C=s*g+c*d+u*I+l*A,f=C>=0?1:-1,p=1-C*C;if(p>Number.EPSILON){var m=Math.sqrt(p),v=Math.atan2(m,C*f);h=Math.sin(h*v)/m,o=Math.sin(o*v)/m}var b=o*f;if(s=s*h+g*b,c=c*h+d*b,u=u*h+I*b,l=l*h+A*b,h===1-o){var y=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=y,c*=y,u*=y,l*=y}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,a,i){var o=n[r],s=n[r+1],c=n[r+2],u=n[r+3],l=a[i],g=a[i+1],d=a[i+2],I=a[i+3];return e[t]=o*I+u*l+s*d-c*g,e[t+1]=s*I+u*g+c*l-o*d,e[t+2]=c*I+u*d+o*g-s*l,e[t+3]=u*I-o*l-s*g-c*d,e}}]),e}();br.prototype.isQuaternion=!0;var yr=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(A.a)(this,t),this.x=e,this.y=n,this.z=r}return Object(h.a)(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Gr.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Gr.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z,s=e.w,c=s*t+i*r-o*n,u=s*n+o*t-a*r,l=s*r+a*n-i*t,g=-a*t-i*n-o*r;return this.x=c*s+g*-a+u*-o-l*-i,this.y=u*s+g*-i+l*-a-c*-o,this.z=l*s+g*-o+c*-i-u*-a,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=t.x,o=t.y,s=t.z;return this.x=r*s-a*o,this.y=a*i-n*s,this.z=n*o-r*i,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Br.copy(this).projectOnVector(e),this.sub(Br)}},{key:"reflect",value:function(e){return this.sub(Br.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Hn(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:e,value:f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);yr.prototype.isVector3=!0;var Br=new yr,Gr=new br,wr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr(-1/0,-1/0,-1/0);Object(A.a)(this,e),this.min=t,this.max=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,o=-1/0,s=0,c=e.length;s<c;s+=3){var u=e[s],l=e[s+1],g=e[s+2];u<t&&(t=u),l<n&&(n=l),g<r&&(r=g),u>a&&(a=u),l>i&&(i=l),g>o&&(o=g)}return this.min.set(t,n,r),this.max.set(a,i,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,o=-1/0,s=0,c=e.count;s<c;s++){var u=e.getX(s),l=e.getY(s),g=e.getZ(s);u<t&&(t=u),l<n&&(n=l),g<r&&(r=g),u>a&&(a=u),l>i&&(i=l),g>o&&(o=g)}return this.min.set(t,n,r),this.max.set(a,i,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Zr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,a=0,i=r.count;a<i;a++)Zr.fromBufferAttribute(r,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Zr);else null===n.boundingBox&&n.computeBoundingBox(),Sr.copy(n.boundingBox),Sr.applyMatrix4(e.matrixWorld),this.union(Sr);for(var o=e.children,s=0,c=o.length;s<c;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Zr),Zr.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Vr),Fr.subVectors(this.max,Vr),xr.subVectors(e.a,Vr),Rr.subVectors(e.b,Vr),Mr.subVectors(e.c,Vr),kr.subVectors(Rr,xr),Er.subVectors(Mr,Rr),Wr.subVectors(xr,Mr);var t=[0,-kr.z,kr.y,0,-Er.z,Er.y,0,-Wr.z,Wr.y,kr.z,0,-kr.x,Er.z,0,-Er.x,Wr.z,0,-Wr.x,-kr.y,kr.x,0,-Er.y,Er.x,0,-Wr.y,Wr.x,0];return!!Or(t,xr,Rr,Mr,Fr)&&(!!Or(t=[1,0,0,0,1,0,0,0,1],xr,Rr,Mr,Fr)&&(Xr.crossVectors(kr,Er),Or(t=[Xr.x,Xr.y,Xr.z],xr,Rr,Mr,Fr)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Zr.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Zr).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(_r[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_r[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_r[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_r[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_r[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_r[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_r[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_r[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_r)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();wr.prototype.isBox3=!0;var _r=[new yr,new yr,new yr,new yr,new yr,new yr,new yr,new yr],Zr=new yr,Sr=new wr,xr=new yr,Rr=new yr,Mr=new yr,kr=new yr,Er=new yr,Wr=new yr,Vr=new yr,Fr=new yr,Xr=new yr,Hr=new yr;function Or(e,t,n,r,a){for(var i=0,o=e.length-3;i<=o;i+=3){Hr.fromArray(e,i);var s=a.x*Math.abs(Hr.x)+a.y*Math.abs(Hr.y)+a.z*Math.abs(Hr.z),c=t.dot(Hr),u=n.dot(Hr),l=r.dot(Hr);if(Math.max(-Math.max(c,u,l),Math.min(c,u,l))>s)return!1}return!0}var Lr=new wr,Nr=new yr,Yr=new yr,Tr=new yr,zr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;Object(A.a)(this,e),this.center=t,this.radius=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Lr.setFromPoints(e).getCenter(n);for(var r=0,a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){Tr.subVectors(e,this.center);var t=Tr.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.add(Tr.multiplyScalar(r/n)),this.radius+=r}return this}},{key:"union",value:function(e){return!0===this.center.equals(e.center)?Yr.set(0,0,1).multiplyScalar(e.radius):Yr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Nr.copy(e.center).add(Yr)),this.expandByPoint(Nr.copy(e.center).sub(Yr)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Kr=new yr,jr=new yr,Dr=new yr,Ur=new yr,Qr=new yr,Pr=new yr,Jr=new yr,qr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr(0,0,-1);Object(A.a)(this,e),this.origin=t,this.direction=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Kr)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=Kr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Kr.copy(this.direction).multiplyScalar(t).add(this.origin),Kr.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){jr.copy(e).add(t).multiplyScalar(.5),Dr.copy(t).sub(e).normalize(),Ur.copy(this.origin).sub(jr);var a,i,o,s,c=.5*e.distanceTo(t),u=-this.direction.dot(Dr),l=Ur.dot(this.direction),g=-Ur.dot(Dr),d=Ur.lengthSq(),I=Math.abs(1-u*u);if(I>0)if(i=u*l-g,s=c*I,(a=u*g-l)>=0)if(i>=-s)if(i<=s){var A=1/I;o=(a*=A)*(a+u*(i*=A)+2*l)+i*(u*a+i+2*g)+d}else i=c,o=-(a=Math.max(0,-(u*i+l)))*a+i*(i+2*g)+d;else i=-c,o=-(a=Math.max(0,-(u*i+l)))*a+i*(i+2*g)+d;else i<=-s?o=-(a=Math.max(0,-(-u*c+l)))*a+(i=a>0?-c:Math.min(Math.max(-c,-g),c))*(i+2*g)+d:i<=s?(a=0,o=(i=Math.min(Math.max(-c,-g),c))*(i+2*g)+d):o=-(a=Math.max(0,-(u*c+l)))*a+(i=a>0?c:Math.min(Math.max(-c,-g),c))*(i+2*g)+d;else i=u>0?-c:c,o=-(a=Math.max(0,-(u*i+l)))*a+i*(i+2*g)+d;return n&&n.copy(this.direction).multiplyScalar(a).add(this.origin),r&&r.copy(Dr).multiplyScalar(i).add(jr),o}},{key:"intersectSphere",value:function(e,t){Kr.subVectors(e.center,this.origin);var n=Kr.dot(this.direction),r=Kr.dot(Kr)-n*n,a=e.radius*e.radius;if(r>a)return null;var i=Math.sqrt(a-r),o=n-i,s=n+i;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,a,i,o,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,g=this.origin;return c>=0?(n=(e.min.x-g.x)*c,r=(e.max.x-g.x)*c):(n=(e.max.x-g.x)*c,r=(e.min.x-g.x)*c),u>=0?(a=(e.min.y-g.y)*u,i=(e.max.y-g.y)*u):(a=(e.max.y-g.y)*u,i=(e.min.y-g.y)*u),n>i||a>r?null:((a>n||n!==n)&&(n=a),(i<r||r!==r)&&(r=i),l>=0?(o=(e.min.z-g.z)*l,s=(e.max.z-g.z)*l):(o=(e.max.z-g.z)*l,s=(e.min.z-g.z)*l),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Kr)}},{key:"intersectTriangle",value:function(e,t,n,r,a){Qr.subVectors(t,e),Pr.subVectors(n,e),Jr.crossVectors(Qr,Pr);var i,o=this.direction.dot(Jr);if(o>0){if(r)return null;i=1}else{if(!(o<0))return null;i=-1,o=-o}Ur.subVectors(this.origin,e);var s=i*this.direction.dot(Pr.crossVectors(Ur,Pr));if(s<0)return null;var c=i*this.direction.dot(Qr.cross(Ur));if(c<0)return null;if(s+c>o)return null;var u=-i*Ur.dot(Jr);return u<0?null:this.at(u/o,a)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),$r=function(){function e(){Object(A.a)(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Object(h.a)(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,c,u,l,g,d,I,A,h){var C=this.elements;return C[0]=e,C[4]=t,C[8]=n,C[12]=r,C[1]=a,C[5]=i,C[9]=o,C[13]=s,C[2]=c,C[6]=u,C[10]=l,C[14]=g,C[3]=d,C[7]=I,C[11]=A,C[15]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/ea.setFromMatrixColumn(e,0).length(),a=1/ea.setFromMatrixColumn(e,1).length(),i=1/ea.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),o=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(a),l=Math.sin(a);if("XYZ"===e.order){var g=i*u,d=i*l,I=o*u,A=o*l;t[0]=s*u,t[4]=-s*l,t[8]=c,t[1]=d+I*c,t[5]=g-A*c,t[9]=-o*s,t[2]=A-g*c,t[6]=I+d*c,t[10]=i*s}else if("YXZ"===e.order){var h=s*u,C=s*l,f=c*u,p=c*l;t[0]=h+p*o,t[4]=f*o-C,t[8]=i*c,t[1]=i*l,t[5]=i*u,t[9]=-o,t[2]=C*o-f,t[6]=p+h*o,t[10]=i*s}else if("ZXY"===e.order){var m=s*u,v=s*l,b=c*u,y=c*l;t[0]=m-y*o,t[4]=-i*l,t[8]=b+v*o,t[1]=v+b*o,t[5]=i*u,t[9]=y-m*o,t[2]=-i*c,t[6]=o,t[10]=i*s}else if("ZYX"===e.order){var B=i*u,G=i*l,w=o*u,_=o*l;t[0]=s*u,t[4]=w*c-G,t[8]=B*c+_,t[1]=s*l,t[5]=_*c+B,t[9]=G*c-w,t[2]=-c,t[6]=o*s,t[10]=i*s}else if("YZX"===e.order){var Z=i*s,S=i*c,x=o*s,R=o*c;t[0]=s*u,t[4]=R-Z*l,t[8]=x*l+S,t[1]=l,t[5]=i*u,t[9]=-o*u,t[2]=-c*u,t[6]=S*l+x,t[10]=Z-R*l}else if("XZY"===e.order){var M=i*s,k=i*c,E=o*s,W=o*c;t[0]=s*u,t[4]=-l,t[8]=c*u,t[1]=M*l+W,t[5]=i*u,t[9]=k*l-E,t[2]=E*l-k,t[6]=o*u,t[10]=W*l+M}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(na,e,ra)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return oa.subVectors(e,t),0===oa.lengthSq()&&(oa.z=1),oa.normalize(),aa.crossVectors(n,oa),0===aa.lengthSq()&&(1===Math.abs(n.z)?oa.x+=1e-4:oa.z+=1e-4,oa.normalize(),aa.crossVectors(n,oa)),aa.normalize(),ia.crossVectors(oa,aa),r[0]=aa.x,r[4]=ia.x,r[8]=oa.x,r[1]=aa.y,r[5]=ia.y,r[9]=oa.y,r[2]=aa.z,r[6]=ia.z,r[10]=oa.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[4],s=n[8],c=n[12],u=n[1],l=n[5],g=n[9],d=n[13],I=n[2],A=n[6],h=n[10],C=n[14],f=n[3],p=n[7],m=n[11],v=n[15],b=r[0],y=r[4],B=r[8],G=r[12],w=r[1],_=r[5],Z=r[9],S=r[13],x=r[2],R=r[6],M=r[10],k=r[14],E=r[3],W=r[7],V=r[11],F=r[15];return a[0]=i*b+o*w+s*x+c*E,a[4]=i*y+o*_+s*R+c*W,a[8]=i*B+o*Z+s*M+c*V,a[12]=i*G+o*S+s*k+c*F,a[1]=u*b+l*w+g*x+d*E,a[5]=u*y+l*_+g*R+d*W,a[9]=u*B+l*Z+g*M+d*V,a[13]=u*G+l*S+g*k+d*F,a[2]=I*b+A*w+h*x+C*E,a[6]=I*y+A*_+h*R+C*W,a[10]=I*B+A*Z+h*M+C*V,a[14]=I*G+A*S+h*k+C*F,a[3]=f*b+p*w+m*x+v*E,a[7]=f*y+p*_+m*R+v*W,a[11]=f*B+p*Z+m*M+v*V,a[15]=f*G+p*S+m*k+v*F,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],o=e[5],s=e[9],c=e[13],u=e[2],l=e[6],g=e[10],d=e[14];return e[3]*(+a*s*l-r*c*l-a*o*g+n*c*g+r*o*d-n*s*d)+e[7]*(+t*s*d-t*c*g+a*i*g-r*i*d+r*c*u-a*s*u)+e[11]*(+t*c*l-t*o*d-a*i*l+n*i*d+a*o*u-n*c*u)+e[15]*(-r*o*u-t*s*l+t*o*g+r*i*l-n*i*g+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=e[9],g=e[10],d=e[11],I=e[12],A=e[13],h=e[14],C=e[15],f=l*h*c-A*g*c+A*s*d-o*h*d-l*s*C+o*g*C,p=I*g*c-u*h*c-I*s*d+i*h*d+u*s*C-i*g*C,m=u*A*c-I*l*c+I*o*d-i*A*d-u*o*C+i*l*C,v=I*l*s-u*A*s-I*o*g+i*A*g+u*o*h-i*l*h,b=t*f+n*p+r*m+a*v;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var y=1/b;return e[0]=f*y,e[1]=(A*g*a-l*h*a-A*r*d+n*h*d+l*r*C-n*g*C)*y,e[2]=(o*h*a-A*s*a+A*r*c-n*h*c-o*r*C+n*s*C)*y,e[3]=(l*s*a-o*g*a-l*r*c+n*g*c+o*r*d-n*s*d)*y,e[4]=p*y,e[5]=(u*h*a-I*g*a+I*r*d-t*h*d-u*r*C+t*g*C)*y,e[6]=(I*s*a-i*h*a-I*r*c+t*h*c+i*r*C-t*s*C)*y,e[7]=(i*g*a-u*s*a+u*r*c-t*g*c-i*r*d+t*s*d)*y,e[8]=m*y,e[9]=(I*l*a-u*A*a-I*n*d+t*A*d+u*n*C-t*l*C)*y,e[10]=(i*A*a-I*o*a+I*n*c-t*A*c-i*n*C+t*o*C)*y,e[11]=(u*o*a-i*l*a-u*n*c+t*l*c+i*n*d-t*o*d)*y,e[12]=v*y,e[13]=(u*A*r-I*l*r+I*n*g-t*A*g-u*n*h+t*l*h)*y,e[14]=(I*o*r-i*A*r-I*n*s+t*A*s+i*n*h-t*o*h)*y,e[15]=(i*l*r-u*o*r+u*n*s-t*l*s-i*n*g+t*o*g)*y,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,o=e.y,s=e.z,c=a*i,u=a*o;return this.set(c*i+n,c*o-r*s,c*s+r*o,0,c*o+r*s,u*o+n,u*s-r*i,0,c*s-r*o,u*s+r*i,a*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,a=t._x,i=t._y,o=t._z,s=t._w,c=a+a,u=i+i,l=o+o,g=a*c,d=a*u,I=a*l,A=i*u,h=i*l,C=o*l,f=s*c,p=s*u,m=s*l,v=n.x,b=n.y,y=n.z;return r[0]=(1-(A+C))*v,r[1]=(d+m)*v,r[2]=(I-p)*v,r[3]=0,r[4]=(d-m)*b,r[5]=(1-(g+C))*b,r[6]=(h+f)*b,r[7]=0,r[8]=(I+p)*y,r[9]=(h-f)*y,r[10]=(1-(g+A))*y,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,a=ea.set(r[0],r[1],r[2]).length(),i=ea.set(r[4],r[5],r[6]).length(),o=ea.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],ta.copy(this);var s=1/a,c=1/i,u=1/o;return ta.elements[0]*=s,ta.elements[1]*=s,ta.elements[2]*=s,ta.elements[4]*=c,ta.elements[5]*=c,ta.elements[6]*=c,ta.elements[8]*=u,ta.elements[9]*=u,ta.elements[10]*=u,t.setFromRotationMatrix(ta),n.x=a,n.y=i,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,a,i){void 0===i&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*a/(t-e),c=2*a/(n-r),u=(t+e)/(t-e),l=(n+r)/(n-r),g=-(i+a)/(i-a),d=-2*i*a/(i-a);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=g,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,a,i){var o=this.elements,s=1/(t-e),c=1/(n-r),u=1/(i-a),l=(t+e)*s,g=(n+r)*c,d=(i+a)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-g,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}();$r.prototype.isMatrix4=!0;var ea=new yr,ta=new $r,na=new yr(0,0,0),ra=new yr(1,1,1),aa=new yr,ia=new yr,oa=new yr,sa=new $r,ca=new br,ua=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Object(A.a)(this,e),this._x=t,this._y=n,this._z=r,this._order=a}return Object(h.a)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,a=r[0],i=r[4],o=r[8],s=r[1],c=r[5],u=r[9],l=r[2],g=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Hn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(g,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Hn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-l,a),this._z=0);break;case"ZXY":this._x=Math.asin(Hn(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-l,d),this._z=Math.atan2(-i,c)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-Hn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(g,d),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-i,c));break;case"YZX":this._z=Math.asin(Hn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Hn(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(g,c),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return sa.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sa,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return ca.setFromEuler(this),this.setFromQuaternion(ca,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}]),e}();ua.prototype.isEuler=!0,ua.DefaultOrder="XYZ",ua.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var la=function(){function e(){Object(A.a)(this,e),this.mask=1}return Object(h.a)(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),ga=0,da=new yr,Ia=new br,Aa=new $r,ha=new yr,Ca=new yr,fa=new yr,pa=new br,ma=new yr(1,0,0),va=new yr(0,1,0),ba=new yr(0,0,1),ya={type:"added"},Ba={type:"removed"},Ga=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(A.a)(this,n),e=t.call(this),Object.defineProperty(Object(l.a)(e),"id",{value:ga++}),e.uuid=Xn(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var r=new yr,a=new ua,i=new br,o=new yr(1,1,1);return a._onChange((function(){i.setFromEuler(a,!1)})),i._onChange((function(){a.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(Object(l.a)(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new $r},normalMatrix:{value:new jn}}),e.matrix=new $r,e.matrixWorld=new $r,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new la,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return Object(h.a)(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Ia.setFromAxisAngle(e,t),this.quaternion.multiply(Ia),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Ia.setFromAxisAngle(e,t),this.quaternion.premultiply(Ia),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(ma,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(va,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(ba,e)}},{key:"translateOnAxis",value:function(e,t){return da.copy(e).applyQuaternion(this.quaternion),this.position.add(da.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(ma,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(va,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(ba,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Aa.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?ha.copy(e):ha.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Ca.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Aa.lookAt(Ca,ha,this.up):Aa.lookAt(ha,Ca,this.up),this.quaternion.setFromRotationMatrix(Aa),r&&(Aa.extractRotation(r.matrixWorld),Ia.setFromRotationMatrix(Aa),this.quaternion.premultiply(Ia.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ya)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Ba)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Ba)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Aa.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Aa.multiply(e.parent.matrixWorld)),e.applyMatrix4(Aa),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ca,e,fa),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ca,pa,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,a=0,i=r.length;a<i;a++)r[a].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var o=i.shapes;if(Array.isArray(o))for(var s=0,c=o.length;s<c;s++){var u=o[s];a(e.shapes,u)}else a(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],g=0,d=this.material.length;g<d;g++)l.push(a(e.materials,this.material[g]));r.material=l}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(var I=0;I<this.children.length;I++)r.children.push(this.children[I].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var A=0;A<this.animations.length;A++){var h=this.animations[A];r.animations.push(a(e.animations,h))}}if(t){var C=G(e.geometries),f=G(e.materials),p=G(e.textures),m=G(e.images),v=G(e.shapes),b=G(e.skeletons),y=G(e.animations),B=G(e.nodes);C.length>0&&(n.geometries=C),f.length>0&&(n.materials=f),p.length>0&&(n.textures=p),m.length>0&&(n.images=m),v.length>0&&(n.shapes=v),b.length>0&&(n.skeletons=b),y.length>0&&(n.animations=y),B.length>0&&(n.nodes=B)}return n.object=r,n;function G(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(Mn);Ga.DefaultUp=new yr(0,1,0),Ga.DefaultMatrixAutoUpdate=!0,Ga.prototype.isObject3D=!0;var wa=new yr,_a=new yr,Za=new yr,Sa=new yr,xa=new yr,Ra=new yr,Ma=new yr,ka=new yr,Ea=new yr,Wa=new yr,Va=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yr;Object(A.a)(this,e),this.a=t,this.b=n,this.c=r}return Object(h.a)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return wa.subVectors(this.c,this.b),_a.subVectors(this.a,this.b),.5*wa.cross(_a).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,a,i){return e.getUV(t,this.a,this.b,this.c,n,r,a,i)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,a=this.a,i=this.b,o=this.c;xa.subVectors(i,a),Ra.subVectors(o,a),ka.subVectors(e,a);var s=xa.dot(ka),c=Ra.dot(ka);if(s<=0&&c<=0)return t.copy(a);Ea.subVectors(e,i);var u=xa.dot(Ea),l=Ra.dot(Ea);if(u>=0&&l<=u)return t.copy(i);var g=s*l-u*c;if(g<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(a).addScaledVector(xa,n);Wa.subVectors(e,o);var d=xa.dot(Wa),I=Ra.dot(Wa);if(I>=0&&d<=I)return t.copy(o);var A=d*c-s*I;if(A<=0&&c>=0&&I<=0)return r=c/(c-I),t.copy(a).addScaledVector(Ra,r);var h=u*I-d*l;if(h<=0&&l-u>=0&&d-I>=0)return Ma.subVectors(o,i),r=(l-u)/(l-u+(d-I)),t.copy(i).addScaledVector(Ma,r);var C=1/(h+A+g);return n=A*C,r=g*C,t.copy(a).addScaledVector(xa,n).addScaledVector(Ra,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),wa.subVectors(e,t),r.cross(wa);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,a){wa.subVectors(r,t),_a.subVectors(n,t),Za.subVectors(e,t);var i=wa.dot(wa),o=wa.dot(_a),s=wa.dot(Za),c=_a.dot(_a),u=_a.dot(Za),l=i*c-o*o;if(0===l)return a.set(-2,-1,-1);var g=1/l,d=(c*s-o*u)*g,I=(i*u-o*s)*g;return a.set(1-d-I,I,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Sa),Sa.x>=0&&Sa.y>=0&&Sa.x+Sa.y<=1}},{key:"getUV",value:function(e,t,n,r,a,i,o,s){return this.getBarycoord(e,t,n,r,Sa),s.set(0,0),s.addScaledVector(a,Sa.x),s.addScaledVector(i,Sa.y),s.addScaledVector(o,Sa.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return wa.subVectors(n,t),_a.subVectors(e,t),wa.cross(_a).dot(r)<0}}]),e}(),Fa=0,Xa=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),e=t.call(this),Object.defineProperty(Object(l.a)(e),"id",{value:Fa++}),e.uuid=Xn(),e.name="",e.type="Material",e.fog=!0,e.blending=V,e.side=x,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=Q,e.blendDst=P,e.blendEquation=L,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=ie,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=pn,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=rn,e.stencilZFail=rn,e.stencilZPass=rn,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return Object(h.a)(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===k;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==V&&(n.blending=this.blending),this.side!==x&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var a=r(e.textures),i=r(e.images);a.length>0&&(n.textures=a),i.length>0&&(n.images=i)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var a=0;a!==r;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Mn);Xa.prototype.isMaterial=!0,Xa.fromType=function(){return null};var Ha=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshBasicMaterial",r.color=new cr(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=le,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Xa);Ha.prototype.isMeshBasicMaterial=!0;var Oa=new yr,La=new Kn,Na=function(){function e(t,n,r){if(Object(A.a)(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===r,this.usage=mn,this.updateRange={offset:0,count:-1},this.version=0}return Object(h.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new cr),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Kn),t[n++]=i.x,t[n++]=i.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new yr),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Ar),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)La.fromBufferAttribute(this,t),La.applyMatrix3(e),this.setXY(t,La.x,La.y);else if(3===this.itemSize)for(var r=0,a=this.count;r<a;r++)Oa.fromBufferAttribute(this,r),Oa.applyMatrix3(e),this.setXYZ(r,Oa.x,Oa.y,Oa.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)Oa.fromBufferAttribute(this,t),Oa.applyMatrix4(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Oa.fromBufferAttribute(this,t),Oa.applyNormalMatrix(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Oa.fromBufferAttribute(this,t),Oa.transformDirection(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==mn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}();Na.prototype.isBufferAttribute=!0;var Ya=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Int8Array(e),r,a)}return Object(h.a)(n)}(Na),Ta=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Uint8Array(e),r,a)}return Object(h.a)(n)}(Na),za=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Uint8ClampedArray(e),r,a)}return Object(h.a)(n)}(Na),Ka=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Int16Array(e),r,a)}return Object(h.a)(n)}(Na),ja=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Uint16Array(e),r,a)}return Object(h.a)(n)}(Na),Da=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Int32Array(e),r,a)}return Object(h.a)(n)}(Na),Ua=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Uint32Array(e),r,a)}return Object(h.a)(n)}(Na),Qa=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Uint16Array(e),r,a)}return Object(h.a)(n)}(Na);Qa.prototype.isFloat16BufferAttribute=!0;var Pa=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Float32Array(e),r,a)}return Object(h.a)(n)}(Na),Ja=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),t.call(this,new Float64Array(e),r,a)}return Object(h.a)(n)}(Na),qa=0,$a=new $r,ei=new Ga,ti=new yr,ni=new wr,ri=new wr,ai=new yr,ii=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),e=t.call(this),Object.defineProperty(Object(l.a)(e),"id",{value:qa++}),e.uuid=Xn(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return Object(h.a)(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(Dn(e)?Ua:ja)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new jn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(e),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return $a.makeRotationFromQuaternion(e),this.applyMatrix4($a),this}},{key:"rotateX",value:function(e){return $a.makeRotationX(e),this.applyMatrix4($a),this}},{key:"rotateY",value:function(e){return $a.makeRotationY(e),this.applyMatrix4($a),this}},{key:"rotateZ",value:function(e){return $a.makeRotationZ(e),this.applyMatrix4($a),this}},{key:"translate",value:function(e,t,n){return $a.makeTranslation(e,t,n),this.applyMatrix4($a),this}},{key:"scale",value:function(e,t,n){return $a.makeScale(e,t,n),this.applyMatrix4($a),this}},{key:"lookAt",value:function(e){return ei.lookAt(e),ei.updateMatrix(),this.applyMatrix4(ei.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ti).negate(),this.translate(ti.x,ti.y,ti.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Pa(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new wr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new yr(-1/0,-1/0,-1/0),new yr(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var a=t[n];ni.setFromBufferAttribute(a),this.morphTargetsRelative?(ai.addVectors(this.boundingBox.min,ni.min),this.boundingBox.expandByPoint(ai),ai.addVectors(this.boundingBox.max,ni.max),this.boundingBox.expandByPoint(ai)):(this.boundingBox.expandByPoint(ni.min),this.boundingBox.expandByPoint(ni.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new zr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new yr,1/0);if(e){var n=this.boundingSphere.center;if(ni.setFromBufferAttribute(e),t)for(var r=0,a=t.length;r<a;r++){var i=t[r];ri.setFromBufferAttribute(i),this.morphTargetsRelative?(ai.addVectors(ni.min,ri.min),ni.expandByPoint(ai),ai.addVectors(ni.max,ri.max),ni.expandByPoint(ai)):(ni.expandByPoint(ri.min),ni.expandByPoint(ri.max))}ni.getCenter(n);for(var o=0,s=0,c=e.count;s<c;s++)ai.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(ai));if(t)for(var u=0,l=t.length;u<l;u++)for(var g=t[u],d=this.morphTargetsRelative,I=0,A=g.count;I<A;I++)ai.fromBufferAttribute(g,I),d&&(ti.fromBufferAttribute(e,I),ai.add(ti)),o=Math.max(o,n.distanceToSquared(ai));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,a=t.normal.array,i=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Na(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,c=[],u=[],l=0;l<o;l++)c[l]=new yr,u[l]=new yr;var g=new yr,d=new yr,I=new yr,A=new Kn,h=new Kn,C=new Kn,f=new yr,p=new yr,m=this.groups;0===m.length&&(m=[{start:0,count:n.length}]);for(var v=0,b=m.length;v<b;++v)for(var y=m[v],B=y.start,G=B,w=B+y.count;G<w;G+=3)F(n[G+0],n[G+1],n[G+2]);for(var _=new yr,Z=new yr,S=new yr,x=new yr,R=0,M=m.length;R<M;++R)for(var k=m[R],E=k.start,W=E,V=E+k.count;W<V;W+=3)X(n[W+0]),X(n[W+1]),X(n[W+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function F(e,t,n){g.fromArray(r,3*e),d.fromArray(r,3*t),I.fromArray(r,3*n),A.fromArray(i,2*e),h.fromArray(i,2*t),C.fromArray(i,2*n),d.sub(g),I.sub(g),h.sub(A),C.sub(A);var a=1/(h.x*C.y-C.x*h.y);isFinite(a)&&(f.copy(d).multiplyScalar(C.y).addScaledVector(I,-h.y).multiplyScalar(a),p.copy(I).multiplyScalar(h.x).addScaledVector(d,-C.x).multiplyScalar(a),c[e].add(f),c[t].add(f),c[n].add(f),u[e].add(p),u[t].add(p),u[n].add(p))}function X(e){S.fromArray(a,3*e),x.copy(S);var t=c[e];_.copy(t),_.sub(S.multiplyScalar(S.dot(t))).normalize(),Z.crossVectors(x,t);var n=Z.dot(u[e])<0?-1:1;s[4*e]=_.x,s[4*e+1]=_.y,s[4*e+2]=_.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new Na(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,a=n.count;r<a;r++)n.setXYZ(r,0,0,0);var i=new yr,o=new yr,s=new yr,c=new yr,u=new yr,l=new yr,g=new yr,d=new yr;if(e)for(var I=0,A=e.count;I<A;I+=3){var h=e.getX(I+0),C=e.getX(I+1),f=e.getX(I+2);i.fromBufferAttribute(t,h),o.fromBufferAttribute(t,C),s.fromBufferAttribute(t,f),g.subVectors(s,o),d.subVectors(i,o),g.cross(d),c.fromBufferAttribute(n,h),u.fromBufferAttribute(n,C),l.fromBufferAttribute(n,f),c.add(g),u.add(g),l.add(g),n.setXYZ(h,c.x,c.y,c.z),n.setXYZ(C,u.x,u.y,u.z),n.setXYZ(f,l.x,l.y,l.z)}else for(var p=0,m=t.count;p<m;p+=3)i.fromBufferAttribute(t,p+0),o.fromBufferAttribute(t,p+1),s.fromBufferAttribute(t,p+2),g.subVectors(s,o),d.subVectors(i,o),g.cross(d),n.setXYZ(p+0,g.x,g.y,g.z),n.setXYZ(p+1,g.x,g.y,g.z),n.setXYZ(p+2,g.x,g.y,g.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var a=n[r].array,i=e.attributes[r],o=i.array,s=i.itemSize*t,c=Math.min(o.length,a.length-s),u=0,l=s;u<c;u++,l++)a[l]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)ai.fromBufferAttribute(e,t),ai.normalize(),e.setXYZ(t,ai.x,ai.y,ai.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r),o=0,s=0,c=0,u=t.length;c<u;c++){o=e.isInterleavedBufferAttribute?t[c]*e.data.stride+e.offset:t[c]*r;for(var l=0;l<r;l++)i[s++]=n[o++]}return new Na(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,a=this.attributes;for(var i in a){var o=e(a[i],r);t.setAttribute(i,o)}var s=this.morphAttributes;for(var c in s){for(var u=[],l=s[c],g=0,d=l.length;g<d;g++){var I=e(l[g],r);u.push(I)}t.morphAttributes[c]=u}t.morphTargetsRelative=this.morphTargetsRelative;for(var A=this.groups,h=0,C=A.length;h<C;h++){var f=A[h];t.addGroup(f.start,f.count,f.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var a=this.attributes;for(var i in a){var o=a[i];e.data.attributes[i]=o.toJSON(e.data)}var s={},c=!1;for(var u in this.morphAttributes){for(var l=this.morphAttributes[u],g=[],d=0,I=l.length;d<I;d++){var A=l[d];g.push(A.toJSON(e.data))}g.length>0&&(s[u]=g,c=!0)}c&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));var C=this.boundingSphere;return null!==C&&(e.data.boundingSphere={center:C.center.toArray(),radius:C.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var a in r){var i=r[a];this.setAttribute(a,i.clone(t))}var o=e.morphAttributes;for(var s in o){for(var c=[],u=o[s],l=0,g=u.length;l<g;l++)c.push(u[l].clone(t));this.morphAttributes[s]=c}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,I=0,A=d.length;I<A;I++){var h=d[I];this.addGroup(h.start,h.count,h.materialIndex)}var C=e.boundingBox;null!==C&&(this.boundingBox=C.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Mn);ii.prototype.isBufferGeometry=!0;var oi=new $r,si=new qr,ci=new zr,ui=new yr,li=new yr,gi=new yr,di=new yr,Ii=new yr,Ai=new yr,hi=new yr,Ci=new yr,fi=new yr,pi=new Kn,mi=new Kn,vi=new Kn,bi=new yr,yi=new yr,Bi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ii,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ha;return Object(A.a)(this,n),(e=t.call(this)).type="Mesh",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,i=r.length;a<i;a++){var o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"raycast",value:function(e,t){var n,r=this.geometry,a=this.material,i=this.matrixWorld;if(void 0!==a&&(null===r.boundingSphere&&r.computeBoundingSphere(),ci.copy(r.boundingSphere),ci.applyMatrix4(i),!1!==e.ray.intersectsSphere(ci)&&(oi.copy(i).invert(),si.copy(e.ray).applyMatrix4(oi),null===r.boundingBox||!1!==si.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index,s=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,l=r.attributes.uv,g=r.attributes.uv2,d=r.groups,I=r.drawRange;if(null!==o)if(Array.isArray(a))for(var A=0,h=d.length;A<h;A++)for(var C=d[A],f=a[C.materialIndex],p=Math.max(C.start,I.start),m=Math.min(o.count,Math.min(C.start+C.count,I.start+I.count));p<m;p+=3){var v=o.getX(p),b=o.getX(p+1),y=o.getX(p+2);(n=Gi(this,f,e,si,s,c,u,l,g,v,b,y))&&(n.faceIndex=Math.floor(p/3),n.face.materialIndex=C.materialIndex,t.push(n))}else for(var B=Math.max(0,I.start),G=Math.min(o.count,I.start+I.count);B<G;B+=3){var w=o.getX(B),_=o.getX(B+1),Z=o.getX(B+2);(n=Gi(this,a,e,si,s,c,u,l,g,w,_,Z))&&(n.faceIndex=Math.floor(B/3),t.push(n))}else if(void 0!==s)if(Array.isArray(a))for(var S=0,x=d.length;S<x;S++)for(var R=d[S],M=a[R.materialIndex],k=Math.max(R.start,I.start),E=Math.min(s.count,Math.min(R.start+R.count,I.start+I.count));k<E;k+=3){(n=Gi(this,M,e,si,s,c,u,l,g,k,k+1,k+2))&&(n.faceIndex=Math.floor(k/3),n.face.materialIndex=R.materialIndex,t.push(n))}else for(var W=Math.max(0,I.start),V=Math.min(s.count,I.start+I.count);W<V;W+=3){(n=Gi(this,a,e,si,s,c,u,l,g,W,W+1,W+2))&&(n.faceIndex=Math.floor(W/3),t.push(n))}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}]),n}(Ga);function Gi(e,t,n,r,a,i,o,s,c,u,l,g){ui.fromBufferAttribute(a,u),li.fromBufferAttribute(a,l),gi.fromBufferAttribute(a,g);var d=e.morphTargetInfluences;if(i&&d){hi.set(0,0,0),Ci.set(0,0,0),fi.set(0,0,0);for(var I=0,A=i.length;I<A;I++){var h=d[I],C=i[I];0!==h&&(di.fromBufferAttribute(C,u),Ii.fromBufferAttribute(C,l),Ai.fromBufferAttribute(C,g),o?(hi.addScaledVector(di,h),Ci.addScaledVector(Ii,h),fi.addScaledVector(Ai,h)):(hi.addScaledVector(di.sub(ui),h),Ci.addScaledVector(Ii.sub(li),h),fi.addScaledVector(Ai.sub(gi),h)))}ui.add(hi),li.add(Ci),gi.add(fi)}e.isSkinnedMesh&&(e.boneTransform(u,ui),e.boneTransform(l,li),e.boneTransform(g,gi));var f=function(e,t,n,r,a,i,o,s){if(null===(t.side===R?r.intersectTriangle(o,i,a,!0,s):r.intersectTriangle(a,i,o,t.side!==M,s)))return null;yi.copy(s),yi.applyMatrix4(e.matrixWorld);var c=n.ray.origin.distanceTo(yi);return c<n.near||c>n.far?null:{distance:c,point:yi.clone(),object:e}}(e,t,n,r,ui,li,gi,bi);if(f){s&&(pi.fromBufferAttribute(s,u),mi.fromBufferAttribute(s,l),vi.fromBufferAttribute(s,g),f.uv=Va.getUV(bi,ui,li,gi,pi,mi,vi,new Kn)),c&&(pi.fromBufferAttribute(c,u),mi.fromBufferAttribute(c,l),vi.fromBufferAttribute(c,g),f.uv2=Va.getUV(bi,ui,li,gi,pi,mi,vi,new Kn));var p={a:u,b:l,c:g,normal:new yr,materialIndex:0};Va.getNormal(ui,li,gi,p.normal),f.face=p}return f}Bi.prototype.isMesh=!0;var wi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(A.a)(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:a,depth:i,widthSegments:o,heightSegments:s,depthSegments:c};var u=Object(l.a)(e);o=Math.floor(o),s=Math.floor(s),c=Math.floor(c);var g=[],d=[],I=[],h=[],C=0,f=0;function p(e,t,n,r,a,i,o,s,c,l,A){for(var p=i/c,m=o/l,v=i/2,b=o/2,y=s/2,B=c+1,G=l+1,w=0,_=0,Z=new yr,S=0;S<G;S++)for(var x=S*m-b,R=0;R<B;R++){var M=R*p-v;Z[e]=M*r,Z[t]=x*a,Z[n]=y,d.push(Z.x,Z.y,Z.z),Z[e]=0,Z[t]=0,Z[n]=s>0?1:-1,I.push(Z.x,Z.y,Z.z),h.push(R/c),h.push(1-S/l),w+=1}for(var k=0;k<l;k++)for(var E=0;E<c;E++){var W=C+E+B*k,V=C+E+B*(k+1),F=C+(E+1)+B*(k+1),X=C+(E+1)+B*k;g.push(W,V,X),g.push(V,F,X),_+=6}u.addGroup(f,_,A),f+=_,C+=w}return p("z","y","x",-1,-1,i,a,r,c,s,0),p("z","y","x",1,-1,i,a,-r,c,s,1),p("x","z","y",1,1,r,i,a,o,c,2),p("x","z","y",1,-1,r,i,-a,o,c,3),p("x","y","z",1,-1,r,a,i,o,s,4),p("x","y","z",-1,-1,r,a,-i,o,s,5),e.setIndex(g),e.setAttribute("position",new Pa(d,3)),e.setAttribute("normal",new Pa(I,3)),e.setAttribute("uv",new Pa(h,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(ii);function _i(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}return t}function Zi(e){for(var t={},n=0;n<e.length;n++){var r=_i(e[n]);for(var a in r)t[a]=r[a]}return t}var Si={clone:_i,merge:Zi},xi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="ShaderMaterial",r.defines={},r.uniforms={},r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),r.setValues(e)),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=_i(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}]),n}(Xa);xi.prototype.isShaderMaterial=!0;var Ri=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="Camera",e.matrixWorldInverse=new $r,e.projectionMatrix=new $r,e.projectionMatrixInverse=new $r,e}return Object(h.a)(n,[{key:"copy",value:function(e,t){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Object(c.a)(Object(u.a)(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Ga);Ri.prototype.isCamera=!0;var Mi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return Object(A.a)(this,n),(e=t.call(this)).type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=i,e.far=o,e.focus=10,e.aspect=a,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return Object(h.a)(n,[{key:"copy",value:function(e,t){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Fn*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*Vn*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*Fn*Math.atan(Math.tan(.5*Vn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*Vn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r,i=this.view;if(null!==this.view&&this.view.enabled){var o=i.fullWidth,s=i.fullHeight;a+=i.offsetX*r/o,t-=i.offsetY*n/s,r*=i.width/o,n*=i.height/s}var c=this.filmOffset;0!==c&&(a+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Ri);Mi.prototype.isPerspectiveCamera=!0;var ki=90,Ei=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;if(Object(A.a)(this,n),(i=t.call(this)).type="CubeCamera",!0!==a.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Object(s.a)(i);i.renderTarget=a;var o=new Mi(ki,1,e,r);o.layers=i.layers,o.up.set(0,-1,0),o.lookAt(new yr(1,0,0)),i.add(o);var c=new Mi(ki,1,e,r);c.layers=i.layers,c.up.set(0,-1,0),c.lookAt(new yr(-1,0,0)),i.add(c);var u=new Mi(ki,1,e,r);u.layers=i.layers,u.up.set(0,0,1),u.lookAt(new yr(0,1,0)),i.add(u);var l=new Mi(ki,1,e,r);l.layers=i.layers,l.up.set(0,0,-1),l.lookAt(new yr(0,-1,0)),i.add(l);var g=new Mi(ki,1,e,r);g.layers=i.layers,g.up.set(0,-1,0),g.lookAt(new yr(0,0,1)),i.add(g);var d=new Mi(ki,1,e,r);return d.layers=i.layers,d.up.set(0,-1,0),d.lookAt(new yr(0,0,-1)),i.add(d),i}return Object(h.a)(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=Object(o.a)(this.children,6),a=r[0],i=r[1],s=r[2],c=r[3],u=r[4],l=r[5],g=e.getRenderTarget(),d=e.outputEncoding,I=e.toneMapping,A=e.xr.enabled;e.outputEncoding=Dt,e.toneMapping=Ie,e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,c),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(g),e.outputEncoding=d,e.toneMapping=I,e.xr.enabled=A,n.texture.needsPMREMUpdate=!0}}]),n}(Ga),Wi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s,c,u,l,g){var d;return Object(A.a)(this,n),e=void 0!==e?e:[],r=void 0!==r?r:ve,(d=t.call(this,e,r,a,i,o,s,c,u,l,g)).flipY=!1,d}return Object(h.a)(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Ir);Wi.prototype.isCubeTexture=!0;var Vi=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(A.a)(this,n);var i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];return(r=t.call(this,e,e,a)).texture=new Wi(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),r.texture.isRenderTargetTexture=!0,r.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,r.texture.minFilter=void 0!==a.minFilter?a.minFilter:Ee,r}return Object(h.a)(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new wi(5,5,5),o=new xi({name:"CubemapFromEquirect",uniforms:_i(n),vertexShader:r,fragmentShader:a,side:R,blending:W});o.uniforms.tEquirect.value=t;var s=new Bi(i,o),c=t.minFilter;return t.minFilter===Fe&&(t.minFilter=Ee),new Ei(1,10,this).update(e,s),t.minFilter=c,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var a=e.getRenderTarget(),i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}]),n}(hr);Vi.prototype.isWebGLCubeRenderTarget=!0;var Fi=new yr,Xi=new yr,Hi=new jn,Oi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,e),this.normal=t,this.constant=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=Fi.subVectors(n,t).cross(Xi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(Fi),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(n).multiplyScalar(a).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Hi.getNormalMatrix(e),r=this.coplanarPoint(Fi).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();Oi.prototype.isPlane=!0;var Li=new zr,Ni=new yr,Yi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Oi,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Oi,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Oi,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Oi,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Oi;Object(A.a)(this,e),this.planes=[t,n,r,a,i,o]}return Object(h.a)(e,[{key:"set",value:function(e,t,n,r,a,i){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(a),o[5].copy(i),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=n[5],u=n[6],l=n[7],g=n[8],d=n[9],I=n[10],A=n[11],h=n[12],C=n[13],f=n[14],p=n[15];return t[0].setComponents(o-r,l-s,A-g,p-h).normalize(),t[1].setComponents(o+r,l+s,A+g,p+h).normalize(),t[2].setComponents(o+a,l+c,A+d,p+C).normalize(),t[3].setComponents(o-a,l-c,A-d,p-C).normalize(),t[4].setComponents(o-i,l-u,A-I,p-f).normalize(),t[5].setComponents(o+i,l+u,A+I,p+f).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Li.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Li)}},{key:"intersectsSprite",value:function(e){return Li.center.set(0,0,0),Li.radius=.7071067811865476,Li.applyMatrix4(e.matrixWorld),this.intersectsSphere(Li)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(Ni.x=r.normal.x>0?e.max.x:e.min.x,Ni.y=r.normal.y>0?e.max.y:e.min.y,Ni.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ni)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function Ti(){var e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function zi(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,a){if(t.isGLBufferAttribute){var i=r.get(t);(!i||i.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var a,i=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)a=5126;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(i instanceof Int16Array)a=5122;else if(i instanceof Uint32Array)a=5125;else if(i instanceof Int32Array)a=5124;else if(i instanceof Int8Array)a=5120;else if(i instanceof Uint8Array)a=5121;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=5121}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,a)):o.version<t.version&&(!function(t,r,a){var i=r.array,o=r.updateRange;e.bindBuffer(a,t),-1===o.count?e.bufferSubData(a,0,i):(n?e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count):e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,a),o.version=t.version)}}}}var Ki=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(A.a)(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:a,widthSegments:i,heightSegments:o};for(var s=r/2,c=a/2,u=Math.floor(i),l=Math.floor(o),g=u+1,d=l+1,I=r/u,h=a/l,C=[],f=[],p=[],m=[],v=0;v<d;v++)for(var b=v*h-c,y=0;y<g;y++){var B=y*I-s;f.push(B,-b,0),p.push(0,0,1),m.push(y/u),m.push(1-v/l)}for(var G=0;G<l;G++)for(var w=0;w<u;w++){var _=w+g*G,Z=w+g*(G+1),S=w+1+g*(G+1),x=w+1+g*G;C.push(_,Z,x),C.push(Z,S,x)}return e.setIndex(C),e.setAttribute("position",new Pa(f,3)),e.setAttribute("normal",new Pa(p,3)),e.setAttribute("uv",new Pa(m,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(ii),ji={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Di={common:{diffuse:{value:new cr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new jn},uv2Transform:{value:new jn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Kn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new cr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new cr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new jn}},sprite:{diffuse:{value:new cr(16777215)},opacity:{value:1},center:{value:new Kn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new jn}}},Ui={basic:{uniforms:Zi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.fog]),vertexShader:ji.meshbasic_vert,fragmentShader:ji.meshbasic_frag},lambert:{uniforms:Zi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.fog,Di.lights,{emissive:{value:new cr(0)}}]),vertexShader:ji.meshlambert_vert,fragmentShader:ji.meshlambert_frag},phong:{uniforms:Zi([Di.common,Di.specularmap,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.fog,Di.lights,{emissive:{value:new cr(0)},specular:{value:new cr(1118481)},shininess:{value:30}}]),vertexShader:ji.meshphong_vert,fragmentShader:ji.meshphong_frag},standard:{uniforms:Zi([Di.common,Di.envmap,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.roughnessmap,Di.metalnessmap,Di.fog,Di.lights,{emissive:{value:new cr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ji.meshphysical_vert,fragmentShader:ji.meshphysical_frag},toon:{uniforms:Zi([Di.common,Di.aomap,Di.lightmap,Di.emissivemap,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.gradientmap,Di.fog,Di.lights,{emissive:{value:new cr(0)}}]),vertexShader:ji.meshtoon_vert,fragmentShader:ji.meshtoon_frag},matcap:{uniforms:Zi([Di.common,Di.bumpmap,Di.normalmap,Di.displacementmap,Di.fog,{matcap:{value:null}}]),vertexShader:ji.meshmatcap_vert,fragmentShader:ji.meshmatcap_frag},points:{uniforms:Zi([Di.points,Di.fog]),vertexShader:ji.points_vert,fragmentShader:ji.points_frag},dashed:{uniforms:Zi([Di.common,Di.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ji.linedashed_vert,fragmentShader:ji.linedashed_frag},depth:{uniforms:Zi([Di.common,Di.displacementmap]),vertexShader:ji.depth_vert,fragmentShader:ji.depth_frag},normal:{uniforms:Zi([Di.common,Di.bumpmap,Di.normalmap,Di.displacementmap,{opacity:{value:1}}]),vertexShader:ji.meshnormal_vert,fragmentShader:ji.meshnormal_frag},sprite:{uniforms:Zi([Di.sprite,Di.fog]),vertexShader:ji.sprite_vert,fragmentShader:ji.sprite_frag},background:{uniforms:{uvTransform:{value:new jn},t2D:{value:null}},vertexShader:ji.background_vert,fragmentShader:ji.background_frag},cube:{uniforms:Zi([Di.envmap,{opacity:{value:1}}]),vertexShader:ji.cube_vert,fragmentShader:ji.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ji.equirect_vert,fragmentShader:ji.equirect_frag},distanceRGBA:{uniforms:Zi([Di.common,Di.displacementmap,{referencePosition:{value:new yr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ji.distanceRGBA_vert,fragmentShader:ji.distanceRGBA_frag},shadow:{uniforms:Zi([Di.lights,Di.fog,{color:{value:new cr(0)},opacity:{value:1}}]),vertexShader:ji.shadow_vert,fragmentShader:ji.shadow_frag}};function Qi(e,t,n,r,a,i){var o,s,c=new cr(0),u=!0===a?0:1,l=null,g=0,d=null;function I(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return c},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;c.set(e),I(c,u=t)},getClearAlpha:function(){return u},setClearAlpha:function(e){I(c,u=e)},render:function(n,a){var i=!1,A=!0===a.isScene?a.background:null;A&&A.isTexture&&(A=t.get(A));var h=e.xr,C=h.getSession&&h.getSession();C&&"additive"===C.environmentBlendMode&&(A=null),null===A?I(c,u):A&&A.isColor&&(I(A,1),i=!0),(e.autoClear||i)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),A&&(A.isCubeTexture||A.mapping===Ge)?(void 0===s&&((s=new Bi(new wi(1,1,1),new xi({name:"BackgroundCubeMaterial",uniforms:_i(Ui.cube.uniforms),vertexShader:Ui.cube.vertexShader,fragmentShader:Ui.cube.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=A,s.material.uniforms.flipEnvMap.value=A.isCubeTexture&&!1===A.isRenderTargetTexture?-1:1,l===A&&g===A.version&&d===e.toneMapping||(s.material.needsUpdate=!0,l=A,g=A.version,d=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):A&&A.isTexture&&(void 0===o&&((o=new Bi(new Ki(2,2),new xi({name:"BackgroundMaterial",uniforms:_i(Ui.background.uniforms),vertexShader:Ui.background.vertexShader,fragmentShader:Ui.background.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=A,!0===A.matrixAutoUpdate&&A.updateMatrix(),o.material.uniforms.uvTransform.value.copy(A.matrix),l===A&&g===A.version&&d===e.toneMapping||(o.material.needsUpdate=!0,l=A,g=A.version,d=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Pi(e,t,n,r){var a=e.getParameter(34921),i=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==i,s={},c=I(null),u=c,l=!1;function g(t){return r.isWebGL2?e.bindVertexArray(t):i.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):i.deleteVertexArrayOES(t)}function I(e){for(var t=[],n=[],r=[],i=0;i<a;i++)t[i]=0,n[i]=0,r[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function A(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function h(e){C(e,0)}function C(n,a){var i=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;(i[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==a)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,a),s[n]=a)}function f(){for(var t=u.newAttributes,n=u.enabledAttributes,r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,a,i,o,s){!0!==r.isWebGL2||5124!==a&&5125!==a?e.vertexAttribPointer(t,n,a,i,o,s):e.vertexAttribIPointer(t,n,a,o,s)}function m(){v(),l=!0,u!==c&&g((u=c).object)}function v(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(a,c,d,m,v){var b=!1;if(o){var y=function(t,n,a){var o=!0===a.wireframe,c=s[t.id];void 0===c&&(c={},s[t.id]=c);var u=c[n.id];void 0===u&&(u={},c[n.id]=u);var l=u[o];void 0===l&&(l=I(r.isWebGL2?e.createVertexArray():i.createVertexArrayOES()),u[o]=l);return l}(m,d,c);u!==y&&g((u=y).object),b=function(e,t){var n=u.attributes,r=e.attributes,a=0;for(var i in r){var o=n[i],s=r[i];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;a++}return u.attributesNum!==a||u.index!==t}(m,v),b&&function(e,t){var n={},r=e.attributes,a=0;for(var i in r){var o=r[i],s={};s.attribute=o,o.data&&(s.data=o.data),n[i]=s,a++}u.attributes=n,u.attributesNum=a,u.index=t}(m,v)}else{var B=!0===c.wireframe;u.geometry===m.id&&u.program===d.id&&u.wireframe===B||(u.geometry=m.id,u.program=d.id,u.wireframe=B,b=!0)}!0===a.isInstancedMesh&&(b=!0),null!==v&&n.update(v,34963),(b||l)&&(l=!1,function(a,i,o,s){if(!1===r.isWebGL2&&(a.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;A();var c=s.attributes,u=o.getAttributes(),l=i.defaultAttributeValues;for(var g in u){var d=u[g];if(d.location>=0){var I=c[g];if(void 0===I&&("instanceMatrix"===g&&a.instanceMatrix&&(I=a.instanceMatrix),"instanceColor"===g&&a.instanceColor&&(I=a.instanceColor)),void 0!==I){var m=I.normalized,v=I.itemSize,b=n.get(I);if(void 0===b)continue;var y=b.buffer,B=b.type,G=b.bytesPerElement;if(I.isInterleavedBufferAttribute){var w=I.data,_=w.stride,Z=I.offset;if(w.isInstancedInterleavedBuffer){for(var S=0;S<d.locationSize;S++)C(d.location+S,w.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=w.meshPerAttribute*w.count)}else for(var x=0;x<d.locationSize;x++)h(d.location+x);e.bindBuffer(34962,y);for(var R=0;R<d.locationSize;R++)p(d.location+R,v/d.locationSize,B,m,_*G,(Z+v/d.locationSize*R)*G)}else{if(I.isInstancedBufferAttribute){for(var M=0;M<d.locationSize;M++)C(d.location+M,I.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=I.meshPerAttribute*I.count)}else for(var k=0;k<d.locationSize;k++)h(d.location+k);e.bindBuffer(34962,y);for(var E=0;E<d.locationSize;E++)p(d.location+E,v/d.locationSize,B,m,v*G,v/d.locationSize*E*G)}}else if(void 0!==l){var W=l[g];if(void 0!==W)switch(W.length){case 2:e.vertexAttrib2fv(d.location,W);break;case 3:e.vertexAttrib3fv(d.location,W);break;case 4:e.vertexAttrib4fv(d.location,W);break;default:e.vertexAttrib1fv(d.location,W)}}}}f()}(a,c,d,m),null!==v&&e.bindBuffer(34963,n.get(v).buffer))},reset:m,resetDefaultState:v,dispose:function(){for(var e in m(),s){var t=s[e];for(var n in t){var r=t[n];for(var a in r)d(r[a].object),delete r[a];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var a in r)d(r[a].object),delete r[a];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var a in r)d(r[a].object),delete r[a];delete n[e.id]}}},initAttributes:A,enableAttribute:h,disableUnusedAttributes:f}}function Ji(e,t,n,r){var a,i=r.isWebGL2;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0!==s){var c,u;if(i)c=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](a,r,o,s),n.update(o,a,s)}}}function qi(e,t,n){var r;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var i="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var c=i||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),g=e.getParameter(35660),d=e.getParameter(3379),I=e.getParameter(34076),A=e.getParameter(34921),h=e.getParameter(36347),C=e.getParameter(36348),f=e.getParameter(36349),p=g>0,m=i||t.has("OES_texture_float");return{isWebGL2:i,drawBuffers:c,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,precision:o,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:g,maxTextureSize:d,maxCubemapSize:I,maxAttributes:A,maxVertexUniforms:h,maxVaryings:C,maxFragmentUniforms:f,vertexTextures:p,floatFragmentTextures:m,floatVertexTextures:p&&m,maxSamples:i?e.getParameter(36183):0}}function $i(e){var t=this,n=null,r=0,a=!1,i=!1,o=new Oi,s=new jn,c={value:null,needsUpdate:!1};function u(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,n,r,a){var i=null!==e?e.length:0,u=null;if(0!==i){if(u=c.value,!0!==a||null===u){var l=r+4*i,g=n.matrixWorldInverse;s.getNormalMatrix(g),(null===u||u.length<l)&&(u=new Float32Array(l));for(var d=0,I=r;d!==i;++d,I+=4)o.copy(e[d]).applyMatrix4(g,s),o.normal.toArray(u,I),u[I+3]=o.constant}c.value=u,c.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,u}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,i){var o=0!==e.length||t||0!==r||a;return a=t,n=l(e,i,0),r=e.length,o},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,u()},this.setState=function(t,o,s){var g=t.clippingPlanes,d=t.clipIntersection,I=t.clipShadows,A=e.get(t);if(!a||null===g||0===g.length||i&&!I)i?l(null):u();else{var h=i?0:r,C=4*h,f=A.clippingState||null;c.value=f,f=l(g,o,C,s);for(var p=0;p!==C;++p)f[p]=n[p];A.clippingState=f,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=h}}}function eo(e){var t=new WeakMap;function n(e,t){return t===ye?e.mapping=ve:t===Be&&(e.mapping=be),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var i=a.mapping;if(i===ye||i===Be){if(t.has(a))return n(t.get(a).texture,a.mapping);var o=a.image;if(o&&o.height>0){var s=new Vi(o.height/2);return s.fromEquirectangularTexture(e,a),t.set(a,s),a.addEventListener("dispose",r),n(s.texture,a.mapping)}return null}}return a},dispose:function(){t=new WeakMap}}}Ui.physical={uniforms:Zi([Ui.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Kn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new cr(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Kn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new cr(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new cr(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ji.meshphysical_vert,fragmentShader:ji.meshphysical_frag};var to=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return Object(A.a)(this,n),(e=t.call(this)).type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=a,e.top=i,e.bottom=o,e.near=s,e.far=c,e.updateProjectionMatrix(),e}return Object(h.a)(n,[{key:"copy",value:function(e,t){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=n-e,i=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i=(a+=c*this.view.offsetX)+c*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(a,i,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Ri);to.prototype.isOrthographicCamera=!0;var no=[.125,.215,.35,.446,.526,.582],ro=20,ao=new to,io=new cr,oo=null,so=(1+Math.sqrt(5))/2,co=1/so,uo=[new yr(1,1,1),new yr(-1,1,1),new yr(1,1,-1),new yr(-1,1,-1),new yr(0,so,co),new yr(0,so,-co),new yr(co,0,so),new yr(-co,0,so),new yr(so,co,0),new yr(-so,co,0)],lo=function(){function e(t){Object(A.a)(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return Object(h.a)(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;oo=this._renderer.getRenderTarget(),this._setSize(256);var a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=ho(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Ao(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(oo),e.scissorTest=!1,Io(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===ve||e.mapping===be?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),oo=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,n={magFilter:Ee,minFilter:Ee,generateMipmaps:!1,type:Ke,format:Je,encoding:Dt,depthBuffer:!1},r=go(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=go(e,t,n);var a=this._lodMax,i=function(e){for(var t=[],n=[],r=[],a=e,i=e-4+1+no.length,o=0;o<i;o++){var s=Math.pow(2,a);n.push(s);var c=1/s;o>e-4?c=no[o-e+4-1]:0===o&&(c=0),r.push(c);for(var u=1/(s-1),l=-u/2,g=1+u/2,d=[l,l,g,l,g,g,l,l,g,g,l,g],I=6,A=6,h=3,C=2,f=1,p=new Float32Array(h*A*I),m=new Float32Array(C*A*I),v=new Float32Array(f*A*I),b=0;b<I;b++){var y=b%3*2/3-1,B=b>2?0:-1,G=[y,B,0,y+2/3,B,0,y+2/3,B+1,0,y,B,0,y+2/3,B+1,0,y,B+1,0];p.set(G,h*A*b),m.set(d,C*A*b);var w=[b,b,b,b,b,b];v.set(w,f*A*b)}var _=new ii;_.setAttribute("position",new Na(p,h)),_.setAttribute("uv",new Na(m,C)),_.setAttribute("faceIndex",new Na(v,f)),t.push(_),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(a);this._sizeLods=i.sizeLods,this._lodPlanes=i.lodPlanes,this._sigmas=i.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(ro),a=new yr(0,1,0);return new xi({name:"SphericalGaussianBlur",defines:{n:ro,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:W,depthTest:!1,depthWrite:!1})}(a,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new Bi(this._lodPlanes[0],e);this._renderer.compile(t,ao)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var a=new Mi(90,1,t,n),i=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,c=s.autoClear,u=s.toneMapping;s.getClearColor(io),s.toneMapping=Ie,s.autoClear=!1;var l=new Ha({name:"PMREM.Background",side:R,depthWrite:!1,depthTest:!1}),g=new Bi(new wi,l),d=!1,I=e.background;I?I.isColor&&(l.color.copy(I),e.background=null,d=!0):(l.color.copy(io),d=!0);for(var A=0;A<6;A++){var h=A%3;0===h?(a.up.set(0,i[A],0),a.lookAt(o[A],0,0)):1===h?(a.up.set(0,0,i[A]),a.lookAt(0,o[A],0)):(a.up.set(0,i[A],0),a.lookAt(0,0,o[A]));var C=this._cubeSize;Io(r,h*C,A>2?C:0,C,C),s.setRenderTarget(r),d&&s.render(g,a),s.render(e,a)}g.geometry.dispose(),g.material.dispose(),s.toneMapping=u,s.autoClear=c,e.background=I}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===ve||e.mapping===be;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=ho()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ao());var a=r?this._cubemapMaterial:this._equirectMaterial,i=new Bi(this._lodPlanes[0],a);a.uniforms.envMap.value=e;var o=this._cubeSize;Io(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(i,ao)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),i=uo[(r-1)%uo.length];this._blur(e,r-1,r,a,i)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,a){var i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}},{key:"_halfBlur",value:function(e,t,n,r,a,i,o){var s=this._renderer,c=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new Bi(this._lodPlanes[r],c),l=c.uniforms,g=this._sizeLods[n]-1,d=isFinite(a)?Math.PI/(2*g):2*Math.PI/39,I=a/d,A=isFinite(a)?1+Math.floor(3*I):ro;A>ro&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(A," samples when the maximum is set to ").concat(ro));for(var h=[],C=0,f=0;f<ro;++f){var p=f/I,m=Math.exp(-p*p/2);h.push(m),0===f?C+=m:f<A&&(C+=2*m)}for(var v=0;v<h.length;v++)h[v]=h[v]/C;l.envMap.value=e.texture,l.samples.value=A,l.weights.value=h,l.latitudinal.value="latitudinal"===i,o&&(l.poleAxis.value=o);var b=this._lodMax;l.dTheta.value=d,l.mipInt.value=b-n;var y=this._sizeLods[r];Io(t,3*y*(r>b-4?r-b+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(u,ao)}}]),e}();function go(e,t,n){var r=new hr(e,t,n);return r.texture.mapping=Ge,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Io(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function Ao(){return new xi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:W,depthTest:!1,depthWrite:!1})}function ho(){return new xi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:W,depthTest:!1,depthWrite:!1})}function Co(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){var i=a.mapping,o=i===ye||i===Be,s=i===ve||i===be;if(o||s){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;var c=t.get(a);return null===n&&(n=new lo(e)),c=o?n.fromEquirectangular(a,c):n.fromCubemap(a,c),t.set(a,c),c.texture}if(t.has(a))return t.get(a).texture;var u=a.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(u)){null===n&&(n=new lo(e));var l=o?n.fromEquirectangular(a):n.fromCubemap(a);return t.set(a,l),a.addEventListener("dispose",r),l.texture}return null}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function fo(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function po(e,t,n,r){var a={},i=new WeakMap;function o(e){var s=e.target;for(var c in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[c]);s.removeEventListener("dispose",o),delete a[s.id];var u=i.get(s);u&&(t.remove(u),i.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,a=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var c=0,u=s.length;c<u;c+=3){var l=s[c+0],g=s[c+1],d=s[c+2];n.push(l,g,g,d,d,l)}}else{var I=a.array;o=a.version;for(var A=0,h=I.length/3-1;A<h;A+=3){var C=A+0,f=A+1,p=A+2;n.push(C,f,f,p,p,C)}}var m=new(Dn(n)?Ua:ja)(n,1);m.version=o;var v=i.get(e);v&&t.remove(v),i.set(e,m)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,c=o.length;s<c;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function mo(e,t,n,r){var a,i,o,s=r.isWebGL2;this.setMode=function(e){a=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,i,t*o),n.update(r,a,1)},this.renderInstances=function(r,c,u){if(0!==u){var l,g;if(s)l=e,g="drawElementsInstanced";else if(g="drawElementsInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[g](a,c,i,r*o,u),n.update(c,a,u)}}}function vo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function bo(e,t){return e[0]-t[0]}function yo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Bo(e,t){var n=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function Go(e,t,n){for(var r={},a=new Float32Array(8),i=new WeakMap,o=new Ar,s=[],c=0;c<8;c++)s[c]=[c,0];return{update:function(c,u,l,g){var d=c.morphTargetInfluences;if(!0===t.isWebGL2){var I=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,A=void 0!==I?I.length:0,h=i.get(u);if(void 0===h||h.count!==A){void 0!==h&&h.texture.dispose();var C=void 0!==u.morphAttributes.position,f=void 0!==u.morphAttributes.normal,p=void 0!==u.morphAttributes.color,m=u.morphAttributes.position||[],v=u.morphAttributes.normal||[],b=u.morphAttributes.color||[],y=0;!0===C&&(y=1),!0===f&&(y=2),!0===p&&(y=3);var B=u.attributes.position.count*y,G=1;B>t.maxTextureSize&&(G=Math.ceil(B/t.maxTextureSize),B=t.maxTextureSize);var w=new Float32Array(B*G*4*A),_=new Cr(w,B,G,A);_.type=ze,_.needsUpdate=!0;for(var Z=4*y,S=0;S<A;S++)for(var x=m[S],R=v[S],M=b[S],k=B*G*4*S,E=0;E<x.count;E++){var W=E*Z;!0===C&&(o.fromBufferAttribute(x,E),!0===x.normalized&&Bo(o,x),w[k+W+0]=o.x,w[k+W+1]=o.y,w[k+W+2]=o.z,w[k+W+3]=0),!0===f&&(o.fromBufferAttribute(R,E),!0===R.normalized&&Bo(o,R),w[k+W+4]=o.x,w[k+W+5]=o.y,w[k+W+6]=o.z,w[k+W+7]=0),!0===p&&(o.fromBufferAttribute(M,E),!0===M.normalized&&Bo(o,M),w[k+W+8]=o.x,w[k+W+9]=o.y,w[k+W+10]=o.z,w[k+W+11]=4===M.itemSize?o.w:1)}h={count:A,texture:_,size:new Kn(B,G)},i.set(u,h),u.addEventListener("dispose",(function e(){_.dispose(),i.delete(u),u.removeEventListener("dispose",e)}))}for(var V=0,F=0;F<d.length;F++)V+=d[F];var X=u.morphTargetsRelative?1:1-V;g.getUniforms().setValue(e,"morphTargetBaseInfluence",X),g.getUniforms().setValue(e,"morphTargetInfluences",d),g.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),g.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}else{var H=void 0===d?0:d.length,O=r[u.id];if(void 0===O||O.length!==H){O=[];for(var L=0;L<H;L++)O[L]=[L,0];r[u.id]=O}for(var N=0;N<H;N++){var Y=O[N];Y[0]=N,Y[1]=d[N]}O.sort(yo);for(var T=0;T<8;T++)T<H&&O[T][1]?(s[T][0]=O[T][0],s[T][1]=O[T][1]):(s[T][0]=Number.MAX_SAFE_INTEGER,s[T][1]=0);s.sort(bo);for(var z=u.morphAttributes.position,K=u.morphAttributes.normal,j=0,D=0;D<8;D++){var U=s[D],Q=U[0],P=U[1];Q!==Number.MAX_SAFE_INTEGER&&P?(z&&u.getAttribute("morphTarget"+D)!==z[Q]&&u.setAttribute("morphTarget"+D,z[Q]),K&&u.getAttribute("morphNormal"+D)!==K[Q]&&u.setAttribute("morphNormal"+D,K[Q]),a[D]=P,j+=P):(z&&!0===u.hasAttribute("morphTarget"+D)&&u.deleteAttribute("morphTarget"+D),K&&!0===u.hasAttribute("morphNormal"+D)&&u.deleteAttribute("morphNormal"+D),a[D]=0)}var J=u.morphTargetsRelative?1:1-j;g.getUniforms().setValue(e,"morphTargetBaseInfluence",J),g.getUniforms().setValue(e,"morphTargetInfluences",a)}}}}function wo(e,t,n,r){var a=new WeakMap;function i(e){var t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,c=t.get(e,s);return a.get(c)!==o&&(t.update(c),a.set(c,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",i)&&e.addEventListener("dispose",i),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),c},dispose:function(){a=new WeakMap}}}var _o=new Ir,Zo=new Cr,So=new pr,xo=new Wi,Ro=[],Mo=[],ko=new Float32Array(16),Eo=new Float32Array(9),Wo=new Float32Array(4);function Vo(e,t,n){var r=e[0];if(r<=0||r>0)return e;var a=t*n,i=Ro[a];if(void 0===i&&(i=new Float32Array(a),Ro[a]=i),0!==t){r.toArray(i,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(i,s)}return i}function Fo(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Xo(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Ho(e,t){var n=Mo[t];void 0===n&&(n=new Int32Array(t),Mo[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Oo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Lo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Fo(n,t))return;e.uniform2fv(this.addr,t),Xo(n,t)}}function No(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Fo(n,t))return;e.uniform3fv(this.addr,t),Xo(n,t)}}function Yo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Fo(n,t))return;e.uniform4fv(this.addr,t),Xo(n,t)}}function To(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Fo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Xo(n,t)}else{if(Fo(n,r))return;Wo.set(r),e.uniformMatrix2fv(this.addr,!1,Wo),Xo(n,r)}}function zo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Fo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Xo(n,t)}else{if(Fo(n,r))return;Eo.set(r),e.uniformMatrix3fv(this.addr,!1,Eo),Xo(n,r)}}function Ko(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Fo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Xo(n,t)}else{if(Fo(n,r))return;ko.set(r),e.uniformMatrix4fv(this.addr,!1,ko),Xo(n,r)}}function jo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Do(e,t){var n=this.cache;Fo(n,t)||(e.uniform2iv(this.addr,t),Xo(n,t))}function Uo(e,t){var n=this.cache;Fo(n,t)||(e.uniform3iv(this.addr,t),Xo(n,t))}function Qo(e,t){var n=this.cache;Fo(n,t)||(e.uniform4iv(this.addr,t),Xo(n,t))}function Po(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Jo(e,t){var n=this.cache;Fo(n,t)||(e.uniform2uiv(this.addr,t),Xo(n,t))}function qo(e,t){var n=this.cache;Fo(n,t)||(e.uniform3uiv(this.addr,t),Xo(n,t))}function $o(e,t){var n=this.cache;Fo(n,t)||(e.uniform4uiv(this.addr,t),Xo(n,t))}function es(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2D(t||_o,a)}function ts(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||So,a)}function ns(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||xo,a)}function rs(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||Zo,a)}function as(e,t){e.uniform1fv(this.addr,t)}function is(e,t){var n=Vo(t,this.size,2);e.uniform2fv(this.addr,n)}function os(e,t){var n=Vo(t,this.size,3);e.uniform3fv(this.addr,n)}function ss(e,t){var n=Vo(t,this.size,4);e.uniform4fv(this.addr,n)}function cs(e,t){var n=Vo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function us(e,t){var n=Vo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ls(e,t){var n=Vo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function gs(e,t){e.uniform1iv(this.addr,t)}function ds(e,t){e.uniform2iv(this.addr,t)}function Is(e,t){e.uniform3iv(this.addr,t)}function As(e,t){e.uniform4iv(this.addr,t)}function hs(e,t){e.uniform1uiv(this.addr,t)}function Cs(e,t){e.uniform2uiv(this.addr,t)}function fs(e,t){e.uniform3uiv(this.addr,t)}function ps(e,t){e.uniform4uiv(this.addr,t)}function ms(e,t,n){var r=t.length,a=Ho(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture2D(t[i]||_o,a[i])}function vs(e,t,n){var r=t.length,a=Ho(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture3D(t[i]||So,a[i])}function bs(e,t,n){var r=t.length,a=Ho(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTextureCube(t[i]||xo,a[i])}function ys(e,t,n){var r=t.length,a=Ho(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture2DArray(t[i]||Zo,a[i])}function Bs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Oo;case 35664:return Lo;case 35665:return No;case 35666:return Yo;case 35674:return To;case 35675:return zo;case 35676:return Ko;case 5124:case 35670:return jo;case 35667:case 35671:return Do;case 35668:case 35672:return Uo;case 35669:case 35673:return Qo;case 5125:return Po;case 36294:return Jo;case 36295:return qo;case 36296:return $o;case 35678:case 36198:case 36298:case 36306:case 35682:return es;case 35679:case 36299:case 36307:return ts;case 35680:case 36300:case 36308:case 36293:return ns;case 36289:case 36303:case 36311:case 36292:return rs}}(t.type)}function Gs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return as;case 35664:return is;case 35665:return os;case 35666:return ss;case 35674:return cs;case 35675:return us;case 35676:return ls;case 5124:case 35670:return gs;case 35667:case 35671:return ds;case 35668:case 35672:return Is;case 35669:case 35673:return As;case 5125:return hs;case 36294:return Cs;case 36295:return fs;case 36296:return ps;case 35678:case 36198:case 36298:case 36306:case 35682:return ms;case 35679:case 36299:case 36307:return vs;case 35680:case 36300:case 36308:case 36293:return bs;case 36289:case 36303:case 36311:case 36292:return ys}}(t.type)}function ws(e){this.id=e,this.seq=[],this.map={}}Gs.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Xo(t,e)},ws.prototype.setValue=function(e,t,n){for(var r=this.seq,a=0,i=r.length;a!==i;++a){var o=r[a];o.setValue(e,t[o.id],n)}};var _s=/(\w+)(\])?(\[|\.)?/g;function Zs(e,t){e.seq.push(t),e.map[t.id]=t}function Ss(e,t,n){var r=e.name,a=r.length;for(_s.lastIndex=0;;){var i=_s.exec(r),o=_s.lastIndex,s=i[1],c="]"===i[2],u=i[3];if(c&&(s|=0),void 0===u||"["===u&&o+2===a){Zs(n,void 0===u?new Bs(s,e,t):new Gs(s,e,t));break}var l=n.map[s];void 0===l&&Zs(n,l=new ws(s)),n=l}}function xs(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var a=e.getActiveUniform(t,r);Ss(a,e.getUniformLocation(t,a.name),this)}}function Rs(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}xs.prototype.setValue=function(e,t,n,r){var a=this.map[t];void 0!==a&&a.setValue(e,n,r)},xs.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},xs.upload=function(e,t,n,r){for(var a=0,i=t.length;a!==i;++a){var o=t[a],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},xs.seqWithValue=function(e,t){for(var n=[],r=0,a=e.length;r!==a;++r){var i=e[r];i.id in t&&n.push(i)}return n};var Ms=0;function ks(e,t,n){var r=e.getShaderParameter(t,35713),a=e.getShaderInfoLog(t).trim();if(r&&""===a)return"";var i=parseInt(/ERROR: 0:(\d+)/.exec(a)[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length),o=a;o<i;o++)r.push(o+1+": "+n[o]);return r.join("\n")}(e.getShaderSource(t),i)}function Es(e,t){var n=function(e){switch(e){case Dt:return["Linear","( value )"];case Ut:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ws(e,t){var n;switch(t){case Ae:n="Linear";break;case he:n="Reinhard";break;case Ce:n="OptimizedCineon";break;case fe:n="ACESFilmic";break;case pe:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Vs(e){return""!==e}function Fs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Xs(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Hs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Os(e){return e.replace(Hs,Ls)}function Ls(e,t){var n=ji[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Os(n)}var Ns=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ys=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ts(e){return e.replace(Ys,Ks).replace(Ns,zs)}function zs(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ks(e,t,n,r)}function Ks(e,t,n,r){for(var a="",i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function js(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ds(e,t,n,r){var a,i,o=e.getContext(),s=n.defines,c=n.vertexShader,u=n.fragmentShader,l=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===_?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Z?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===S&&(t="SHADOWMAP_TYPE_VSM"),t}(n),g=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ve:case be:t="ENVMAP_TYPE_CUBE";break;case Ge:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===be&&(t="ENVMAP_MODE_REFRACTION");return t}(n),I=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case le:t="ENVMAP_BLENDING_MULTIPLY";break;case ge:t="ENVMAP_BLENDING_MIX";break;case de:t="ENVMAP_BLENDING_ADD"}return t}(n),A=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t/32+1)+3,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),h=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vs).join("\n")}(n),C=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),f=o.createProgram(),p=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((a=[C].filter(Vs).join("\n")).length>0&&(a+="\n"),(i=[h,C].filter(Vs).join("\n")).length>0&&(i+="\n")):(a=[js(n),"#define SHADER_NAME "+n.shaderName,C,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Vs).join("\n"),i=[h,js(n),"#define SHADER_NAME "+n.shaderName,C,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+g:"",n.envMap?"#define "+d:"",n.envMap?"#define "+I:"",A?"#define CUBEUV_TEXEL_WIDTH "+A.texelWidth:"",A?"#define CUBEUV_TEXEL_HEIGHT "+A.texelHeight:"",A?"#define CUBEUV_MAX_MIP "+A.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ie?"#define TONE_MAPPING":"",n.toneMapping!==Ie?ji.tonemapping_pars_fragment:"",n.toneMapping!==Ie?Ws("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ji.encodings_pars_fragment,Es("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Vs).join("\n")),c=Xs(c=Fs(c=Os(c),n),n),u=Xs(u=Fs(u=Os(u),n),n),c=Ts(c),u=Ts(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(p="#version 300 es\n",a=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,i=["#define varying in",n.glslVersion===xn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===xn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i);var m,v,b=p+i+u,y=Rs(o,35633,p+a+c),B=Rs(o,35632,b);if(o.attachShader(f,y),o.attachShader(f,B),void 0!==n.index0AttributeName?o.bindAttribLocation(f,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(f,0,"position"),o.linkProgram(f),e.debug.checkShaderErrors){var G=o.getProgramInfoLog(f).trim(),w=o.getShaderInfoLog(y).trim(),x=o.getShaderInfoLog(B).trim(),R=!0,M=!0;if(!1===o.getProgramParameter(f,35714)){R=!1;var k=ks(o,y,"vertex"),E=ks(o,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+G+"\n"+k+"\n"+E)}else""!==G?console.warn("THREE.WebGLProgram: Program Info Log:",G):""!==w&&""!==x||(M=!1);M&&(this.diagnostics={runnable:R,programLog:G,vertexShader:{log:w,prefix:a},fragmentShader:{log:x,prefix:i}})}return o.deleteShader(y),o.deleteShader(B),this.getUniforms=function(){return void 0===m&&(m=new xs(o,f)),m},this.getAttributes=function(){return void 0===v&&(v=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),a=0;a<r;a++){var i=e.getActiveAttrib(t,a),o=i.name,s=1;35674===i.type&&(s=2),35675===i.type&&(s=3),35676===i.type&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,f)),v},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(f),this.program=void 0},this.name=n.shaderName,this.id=Ms++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=y,this.fragmentShader=B,this}var Us=0,Qs=function(){function e(){Object(A.a)(this,e),this.shaderCache=new Map,this.materialCache=new Map}return Object(h.a)(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}},{key:"remove",value:function(e){var t,n=this.materialCache.get(e),r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.usedTimes--,0===a.usedTimes&&this.shaderCache.delete(a.code)}}catch(o){r.e(o)}finally{r.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache;if(!1===t.has(e)){var n=new Ps(e);t.set(e,n)}return t.get(e)}}]),e}(),Ps=Object(h.a)((function e(t){Object(A.a)(this,e),this.id=Us++,this.code=t,this.usedTimes=0}));function Js(e,t,n,r,a,i,o){var s=new la,c=new Qs,u=[],l=a.isWebGL2,g=a.logarithmicDepthBuffer,d=a.floatVertexTextures,I=a.maxVertexUniforms,A=a.vertexTextures,h=a.precision,C={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(i,s,u,f,p){var m=f.fog,v=p.geometry,b=i.isMeshStandardMaterial?f.environment:null,y=(i.isMeshStandardMaterial?n:t).get(i.envMap||b),B=y&&y.mapping===Ge?y.image.height:null,G=C[i.type],w=p.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(d)return 1024;var n=I,r=Math.floor((n-20)/4),a=Math.min(r,t.length);return a<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+a+"."),0):a}(p):0;null!==i.precision&&(h=a.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",h,"instead.");var _,Z,S,x,k=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,E=void 0!==k?k.length:0,W=0;if(void 0!==v.morphAttributes.position&&(W=1),void 0!==v.morphAttributes.normal&&(W=2),void 0!==v.morphAttributes.color&&(W=3),G){var F=Ui[G];_=F.vertexShader,Z=F.fragmentShader}else _=i.vertexShader,Z=i.fragmentShader,c.update(i),S=c.getVertexShaderID(i),x=c.getFragmentShaderID(i);var X=e.getRenderTarget(),H=i.alphaTest>0,O=i.clearcoat>0;return{isWebGL2:l,shaderID:G,shaderName:i.type,vertexShader:_,fragmentShader:Z,defines:i.defines,customVertexShaderID:S,customFragmentShaderID:x,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:h,instancing:!0===p.isInstancedMesh,instancingColor:!0===p.isInstancedMesh&&null!==p.instanceColor,supportsVertexTextures:A,outputEncoding:null===X?e.outputEncoding:!0===X.isXRRenderTarget?X.texture.encoding:Dt,map:!!i.map,matcap:!!i.matcap,envMap:!!y,envMapMode:y&&y.mapping,envMapCubeUVHeight:B,lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===qt,tangentSpaceNormalMap:i.normalMapType===Jt,decodeVideoTexture:!!i.map&&!0===i.map.isVideoTexture&&i.map.encoding===Ut,clearcoat:O,clearcoatMap:O&&!!i.clearcoatMap,clearcoatRoughnessMap:O&&!!i.clearcoatRoughnessMap,clearcoatNormalMap:O&&!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,specularIntensityMap:!!i.specularIntensityMap,specularColorMap:!!i.specularColorMap,opaque:!1===i.transparent&&i.blending===V,alphaMap:!!i.alphaMap,alphaTest:H,gradientMap:!!i.gradientMap,sheen:i.sheen>0,sheenColorMap:!!i.sheenColorMap,sheenRoughnessMap:!!i.sheenRoughnessMap,transmission:i.transmission>0,transmissionMap:!!i.transmissionMap,thicknessMap:!!i.thicknessMap,combine:i.combine,vertexTangents:!!i.normalMap&&!!v.attributes.tangent,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap||!!i.transmissionMap||!!i.thicknessMap||!!i.specularIntensityMap||!!i.specularColorMap||!!i.sheenColorMap||!!i.sheenRoughnessMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmission>0||i.transmissionMap||i.thicknessMap||i.specularIntensityMap||i.specularColorMap||i.sheen>0||i.sheenColorMap||i.sheenRoughnessMap)&&!!i.displacementMap,fog:!!m,useFog:i.fog,fogExp2:m&&m.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:g,skinning:!0===p.isSkinnedMesh&&w>0,maxBones:w,useVertexTexture:d,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:E,morphTextureStride:W,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:Ie,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===M,flipSided:i.side===R,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.maxBones),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.displacementMap&&s.enable(18);t.specularMap&&s.enable(19);t.roughnessMap&&s.enable(20);t.metalnessMap&&s.enable(21);t.gradientMap&&s.enable(22);t.alphaMap&&s.enable(23);t.alphaTest&&s.enable(24);t.vertexColors&&s.enable(25);t.vertexAlphas&&s.enable(26);t.vertexUvs&&s.enable(27);t.vertexTangents&&s.enable(28);t.uvsVertexOnly&&s.enable(29);t.fog&&s.enable(30);e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0);t.flatShading&&s.enable(1);t.logarithmicDepthBuffer&&s.enable(2);t.skinning&&s.enable(3);t.useVertexTexture&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.physicallyCorrectLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.depthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=C[e.type];if(n){var r=Ui[n];t=Si.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,o=u.length;a<o;a++){var s=u[a];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new Ds(e,n,t,i),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){c.remove(e)},programs:u,dispose:function(){c.dispose()}}}function qs(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function $s(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ec(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function tc(){var e=[],t=0,n=[],r=[],a=[];function i(n,r,a,i,o,s){var c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:o,group:s},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=a,c.groupOrder=i,c.renderOrder=n.renderOrder,c.z=o,c.group=s),t++,c}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,o,s,c,u){var l=i(e,t,o,s,c,u);o.transmission>0?r.push(l):!0===o.transparent?a.push(l):n.push(l)},unshift:function(e,t,o,s,c,u){var l=i(e,t,o,s,c,u);o.transmission>0?r.unshift(l):!0===o.transparent?a.unshift(l):n.unshift(l)},finish:function(){for(var n=t,r=e.length;n<r;n++){var a=e[n];if(null===a.id)break;a.id=null,a.object=null,a.geometry=null,a.material=null,a.group=null}},sort:function(e,t){n.length>1&&n.sort(e||$s),r.length>1&&r.sort(t||ec),a.length>1&&a.sort(t||ec)}}}function nc(){var e=new WeakMap;return{get:function(t,n){var r;return!1===e.has(t)?(r=new tc,e.set(t,[r])):n>=e.get(t).length?(r=new tc,e.get(t).push(r)):r=e.get(t)[n],r},dispose:function(){e=new WeakMap}}}function rc(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new yr,color:new cr};break;case"SpotLight":n={position:new yr,direction:new yr,color:new cr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new yr,color:new cr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new yr,skyColor:new cr,groundColor:new cr};break;case"RectAreaLight":n={color:new cr,position:new yr,halfWidth:new yr,halfHeight:new yr}}return e[t.id]=n,n}}}var ac=0;function ic(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function oc(e,t){for(var n=new rc,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)a.probe.push(new yr);var o=new yr,s=new $r,c=new $r;return{setup:function(i,o){for(var s=0,c=0,u=0,l=0;l<9;l++)a.probe[l].set(0,0,0);var g=0,d=0,I=0,A=0,h=0,C=0,f=0,p=0;i.sort(ic);for(var m=!0!==o?Math.PI:1,v=0,b=i.length;v<b;v++){var y=i[v],B=y.color,G=y.intensity,w=y.distance,_=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)s+=B.r*G*m,c+=B.g*G*m,u+=B.b*G*m;else if(y.isLightProbe)for(var Z=0;Z<9;Z++)a.probe[Z].addScaledVector(y.sh.coefficients[Z],G);else if(y.isDirectionalLight){var S=n.get(y);if(S.color.copy(y.color).multiplyScalar(y.intensity*m),y.castShadow){var x=y.shadow,R=r.get(y);R.shadowBias=x.bias,R.shadowNormalBias=x.normalBias,R.shadowRadius=x.radius,R.shadowMapSize=x.mapSize,a.directionalShadow[g]=R,a.directionalShadowMap[g]=_,a.directionalShadowMatrix[g]=y.shadow.matrix,C++}a.directional[g]=S,g++}else if(y.isSpotLight){var M=n.get(y);if(M.position.setFromMatrixPosition(y.matrixWorld),M.color.copy(B).multiplyScalar(G*m),M.distance=w,M.coneCos=Math.cos(y.angle),M.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),M.decay=y.decay,y.castShadow){var k=y.shadow,E=r.get(y);E.shadowBias=k.bias,E.shadowNormalBias=k.normalBias,E.shadowRadius=k.radius,E.shadowMapSize=k.mapSize,a.spotShadow[I]=E,a.spotShadowMap[I]=_,a.spotShadowMatrix[I]=y.shadow.matrix,p++}a.spot[I]=M,I++}else if(y.isRectAreaLight){var W=n.get(y);W.color.copy(B).multiplyScalar(G),W.halfWidth.set(.5*y.width,0,0),W.halfHeight.set(0,.5*y.height,0),a.rectArea[A]=W,A++}else if(y.isPointLight){var V=n.get(y);if(V.color.copy(y.color).multiplyScalar(y.intensity*m),V.distance=y.distance,V.decay=y.decay,y.castShadow){var F=y.shadow,X=r.get(y);X.shadowBias=F.bias,X.shadowNormalBias=F.normalBias,X.shadowRadius=F.radius,X.shadowMapSize=F.mapSize,X.shadowCameraNear=F.camera.near,X.shadowCameraFar=F.camera.far,a.pointShadow[d]=X,a.pointShadowMap[d]=_,a.pointShadowMatrix[d]=y.shadow.matrix,f++}a.point[d]=V,d++}else if(y.isHemisphereLight){var H=n.get(y);H.skyColor.copy(y.color).multiplyScalar(G*m),H.groundColor.copy(y.groundColor).multiplyScalar(G*m),a.hemi[h]=H,h++}}A>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(a.rectAreaLTC1=Di.LTC_FLOAT_1,a.rectAreaLTC2=Di.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Di.LTC_HALF_1,a.rectAreaLTC2=Di.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=s,a.ambient[1]=c,a.ambient[2]=u;var O=a.hash;O.directionalLength===g&&O.pointLength===d&&O.spotLength===I&&O.rectAreaLength===A&&O.hemiLength===h&&O.numDirectionalShadows===C&&O.numPointShadows===f&&O.numSpotShadows===p||(a.directional.length=g,a.spot.length=I,a.rectArea.length=A,a.point.length=d,a.hemi.length=h,a.directionalShadow.length=C,a.directionalShadowMap.length=C,a.pointShadow.length=f,a.pointShadowMap.length=f,a.spotShadow.length=p,a.spotShadowMap.length=p,a.directionalShadowMatrix.length=C,a.pointShadowMatrix.length=f,a.spotShadowMatrix.length=p,O.directionalLength=g,O.pointLength=d,O.spotLength=I,O.rectAreaLength=A,O.hemiLength=h,O.numDirectionalShadows=C,O.numPointShadows=f,O.numSpotShadows=p,a.version=ac++)},setupView:function(e,t){for(var n=0,r=0,i=0,u=0,l=0,g=t.matrixWorldInverse,d=0,I=e.length;d<I;d++){var A=e[d];if(A.isDirectionalLight){var h=a.directional[n];h.direction.setFromMatrixPosition(A.matrixWorld),o.setFromMatrixPosition(A.target.matrixWorld),h.direction.sub(o),h.direction.transformDirection(g),n++}else if(A.isSpotLight){var C=a.spot[i];C.position.setFromMatrixPosition(A.matrixWorld),C.position.applyMatrix4(g),C.direction.setFromMatrixPosition(A.matrixWorld),o.setFromMatrixPosition(A.target.matrixWorld),C.direction.sub(o),C.direction.transformDirection(g),i++}else if(A.isRectAreaLight){var f=a.rectArea[u];f.position.setFromMatrixPosition(A.matrixWorld),f.position.applyMatrix4(g),c.identity(),s.copy(A.matrixWorld),s.premultiply(g),c.extractRotation(s),f.halfWidth.set(.5*A.width,0,0),f.halfHeight.set(0,.5*A.height,0),f.halfWidth.applyMatrix4(c),f.halfHeight.applyMatrix4(c),u++}else if(A.isPointLight){var p=a.point[r];p.position.setFromMatrixPosition(A.matrixWorld),p.position.applyMatrix4(g),r++}else if(A.isHemisphereLight){var m=a.hemi[l];m.direction.setFromMatrixPosition(A.matrixWorld),m.direction.transformDirection(g),m.direction.normalize(),l++}}},state:a}}function sc(e,t){var n=new oc(e,t),r=[],a=[];return{init:function(){r.length=0,a.length=0},state:{lightsArray:r,shadowsArray:a,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){a.push(e)}}}function cc(e,t){var n=new WeakMap;return{get:function(r){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(a=new sc(e,t),n.set(r,[a])):i>=n.get(r).length?(a=new sc(e,t),n.get(r).push(a)):a=n.get(r)[i],a},dispose:function(){n=new WeakMap}}}var uc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshDepthMaterial",r.depthPacking=Qt,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(Xa);uc.prototype.isMeshDepthMaterial=!0;var lc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshDistanceMaterial",r.referencePosition=new yr,r.nearDistance=1,r.farDistance=1e3,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.fog=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(Xa);lc.prototype.isMeshDistanceMaterial=!0;function gc(e,t,n){var r=new Yi,a=new Kn,i=new Kn,o=new Ar,s=new uc({depthPacking:Pt}),c=new lc,u={},l=n.maxTextureSize,g={0:R,1:x,2:M},d=new xi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Kn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),I=d.clone();I.defines.HORIZONTAL_PASS=1;var A=new ii;A.setAttribute("position",new Na(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var h=new Bi(A,d),C=this;function f(n,r){var a=t.update(h);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,I.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,I.needsUpdate=!0),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,h,null),I.uniforms.shadow_pass.value=n.mapPass.texture,I.uniforms.resolution.value=n.mapSize,I.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,I,h,null)}function p(t,n,r,a,i,o){var l=null,d=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(l=void 0!==d?d:!0===r.isPointLight?c:s,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){var I=l.uuid,A=n.uuid,h=u[I];void 0===h&&(h={},u[I]=h);var C=h[A];void 0===C&&(C=l.clone(),h[A]=C),l=C}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=o===S?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:g[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=a,l.farDistance=i),l}function m(n,a,i,o,s){if(!1!==n.visible){if(n.layers.test(a.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===S)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var c=t.update(n),u=n.material;if(Array.isArray(u))for(var l=c.groups,g=0,d=l.length;g<d;g++){var I=l[g],A=u[I.materialIndex];if(A&&A.visible){var h=p(n,A,o,i.near,i.far,s);e.renderBufferDirect(i,null,c,h,n,I)}}else if(u.visible){var C=p(n,u,o,i.near,i.far,s);e.renderBufferDirect(i,null,c,C,n,null)}}for(var f=n.children,v=0,b=f.length;v<b;v++)m(f[v],a,i,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_,this.render=function(t,n,s){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==t.length){var c=e.getRenderTarget(),u=e.getActiveCubeFace(),g=e.getActiveMipmapLevel(),d=e.state;d.setBlending(W),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var I=0,A=t.length;I<A;I++){var h=t[I],p=h.shadow;if(void 0!==p){if(!1!==p.autoUpdate||!1!==p.needsUpdate){a.copy(p.mapSize);var v=p.getFrameExtents();if(a.multiply(v),i.copy(p.mapSize),(a.x>l||a.y>l)&&(a.x>l&&(i.x=Math.floor(l/v.x),a.x=i.x*v.x,p.mapSize.x=i.x),a.y>l&&(i.y=Math.floor(l/v.y),a.y=i.y*v.y,p.mapSize.y=i.y)),null!==p.map||p.isPointLightShadow||this.type!==S||(p.map=new hr(a.x,a.y),p.map.texture.name=h.name+".shadowMap",p.mapPass=new hr(a.x,a.y),p.camera.updateProjectionMatrix()),null===p.map){var b={minFilter:Se,magFilter:Se,format:Je};p.map=new hr(a.x,a.y,b),p.map.texture.name=h.name+".shadowMap",p.camera.updateProjectionMatrix()}e.setRenderTarget(p.map),e.clear();for(var y=p.getViewportCount(),B=0;B<y;B++){var G=p.getViewport(B);o.set(i.x*G.x,i.y*G.y,i.x*G.z,i.y*G.w),d.viewport(o),p.updateMatrices(h,B),r=p.getFrustum(),m(n,s,p.camera,h,this.type)}p.isPointLightShadow||this.type!==S||f(p,s),p.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",h,"has no shadow.")}C.needsUpdate=!1,e.setRenderTarget(c,u,g)}}}function dc(e,t,n){var r,a,i=n.isWebGL2;var o=new function(){var t=!1,n=new Ar,r=null,a=new Ar(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,o,s){!0===s&&(t*=o,r*=o,i*=o),n.set(t,r,i,o),!1===a.equals(n)&&(e.clearColor(t,r,i,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,a=null;return{setTest:function(e){e?ye(2929):Be(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case ne:e.depthFunc(512);break;case re:e.depthFunc(519);break;case ae:e.depthFunc(513);break;case ie:e.depthFunc(515);break;case oe:e.depthFunc(514);break;case se:e.depthFunc(518);break;case ce:e.depthFunc(516);break;case ue:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){t=!1,n=null,r=null,a=null}}},c=new function(){var t=!1,n=null,r=null,a=null,i=null,o=null,s=null,c=null,u=null;return{setTest:function(e){t||(e?ye(2960):Be(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&a===n&&i===o||(e.stencilFunc(t,n,o),r=t,a=n,i=o)},setOp:function(t,n,r){o===t&&s===n&&c===r||(e.stencilOp(t,n,r),o=t,s=n,c=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,o=null,s=null,c=null,u=null}}},u={},l={},g=new WeakMap,d=[],A=null,h=!1,C=null,f=null,p=null,m=null,v=null,G=null,w=null,_=!1,Z=null,S=null,x=null,k=null,E=null,le=e.getParameter(35661),ge=!1,de=0,Ie=e.getParameter(7938);-1!==Ie.indexOf("WebGL")?(de=parseFloat(/^WebGL (\d)/.exec(Ie)[1]),ge=de>=1):-1!==Ie.indexOf("OpenGL ES")&&(de=parseFloat(/^OpenGL ES (\d)/.exec(Ie)[1]),ge=de>=2);var Ae=null,he={},Ce=e.getParameter(3088),fe=e.getParameter(2978),pe=(new Ar).fromArray(Ce),me=(new Ar).fromArray(fe);function ve(t,n,r){var a=new Uint8Array(4),i=e.createTexture();e.bindTexture(t,i),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,a);return i}var be={};function ye(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function Be(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}be[3553]=ve(3553,3553,1),be[34067]=ve(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),c.setClear(0),ye(2929),s.setFunc(ie),Se(!1),xe(y),ye(2884),Ze(W);var Ge=(r={},Object(I.a)(r,L,32774),Object(I.a)(r,N,32778),Object(I.a)(r,Y,32779),r);if(i)Ge[T]=32775,Ge[z]=32776;else{var we=t.get("EXT_blend_minmax");null!==we&&(Ge[T]=we.MIN_EXT,Ge[z]=we.MAX_EXT)}var _e=(a={},Object(I.a)(a,K,0),Object(I.a)(a,j,1),Object(I.a)(a,D,768),Object(I.a)(a,Q,770),Object(I.a)(a,te,776),Object(I.a)(a,$,774),Object(I.a)(a,J,772),Object(I.a)(a,U,769),Object(I.a)(a,P,771),Object(I.a)(a,ee,775),Object(I.a)(a,q,773),a);function Ze(t,n,r,a,i,o,s,c){if(t!==W){if(!1===h&&(ye(3042),h=!0),t===O)i=i||n,o=o||r,s=s||a,n===f&&i===v||(e.blendEquationSeparate(Ge[n],Ge[i]),f=n,v=i),r===p&&a===m&&o===G&&s===w||(e.blendFuncSeparate(_e[r],_e[a],_e[o],_e[s]),p=r,m=a,G=o,w=s),C=t,_=null;else if(t!==C||c!==_){if(f===L&&v===L||(e.blendEquation(32774),f=L,v=L),c)switch(t){case V:e.blendFuncSeparate(1,771,1,771);break;case F:e.blendFunc(1,1);break;case X:e.blendFuncSeparate(0,769,0,1);break;case H:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case V:e.blendFuncSeparate(770,771,1,771);break;case F:e.blendFunc(770,1);break;case X:e.blendFuncSeparate(0,769,0,1);break;case H:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}p=null,m=null,G=null,w=null,C=t,_=c}}else!0===h&&(Be(3042),h=!1)}function Se(t){Z!==t&&(t?e.frontFace(2304):e.frontFace(2305),Z=t)}function xe(t){t!==b?(ye(2884),t!==S&&(t===y?e.cullFace(1029):t===B?e.cullFace(1028):e.cullFace(1032))):Be(2884),S=t}function Re(t,n,r){t?(ye(32823),k===n&&E===r||(e.polygonOffset(n,r),k=n,E=r)):Be(32823)}function Me(t){void 0===t&&(t=33984+le-1),Ae!==t&&(e.activeTexture(t),Ae=t)}return{buffers:{color:o,depth:s,stencil:c},enable:ye,disable:Be,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,i&&(36009===t&&(l[36160]=n),36160===t&&(l[36009]=n)),!0)},drawBuffers:function(r,a){var i=d,o=!1;if(r)if(void 0===(i=g.get(a))&&(i=[],g.set(a,i)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(i.length!==s.length||36064!==i[0]){for(var c=0,u=s.length;c<u;c++)i[c]=36064+c;i.length=s.length,o=!0}}else 36064!==i[0]&&(i[0]=36064,o=!0);else 1029!==i[0]&&(i[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(i):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(t){return A!==t&&(e.useProgram(t),A=t,!0)},setBlending:Ze,setMaterial:function(e,t){e.side===M?Be(2884):ye(2884);var n=e.side===R;t&&(n=!n),Se(n),e.blending===V&&!1===e.transparent?Ze(W):Ze(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;c.setTest(r),r&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Re(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):Be(32926)},setFlipSided:Se,setCullFace:xe,setLineWidth:function(t){t!==x&&(ge&&e.lineWidth(t),x=t)},setPolygonOffset:Re,setScissorTest:function(e){e?ye(3089):Be(3089)},activeTexture:Me,bindTexture:function(t,n){null===Ae&&Me();var r=he[Ae];void 0===r&&(r={type:void 0,texture:void 0},he[Ae]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||be[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=he[Ae];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===pe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),pe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},Ae=null,he={},l={},g=new WeakMap,d=[],A=null,h=!1,C=null,f=null,p=null,m=null,v=null,G=null,w=null,_=!1,Z=null,S=null,x=null,k=null,E=null,pe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),c.reset()}}}function Ic(e,t,n,r,a,i,o){var s,c,u,l=a.isWebGL2,g=a.maxTextures,d=a.maxCubemapSize,A=a.maxTextureSize,h=a.maxSamples,C=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,m=new WeakMap,v=!1;try{v="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(K){}function b(e,t){return v?new OffscreenCanvas(e,t):Pn("canvas")}function y(e,t,n,r){var a=1;if((e.width>r||e.height>r)&&(a=r/Math.max(e.width,e.height)),a<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var i=t?Tn:Math.floor,o=i(a*e.width),s=i(a*e.height);void 0===u&&(u=b(o,s));var c=n?b(o,s):u;return c.width=o,c.height=s,c.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),c}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function B(e){return Nn(e.width)&&Nn(e.height)}function G(e,t){return e.generateMipmaps&&t&&e.minFilter!==Se&&e.minFilter!==Ee}function w(t){e.generateMipmap(t)}function _(n,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return 6403===r&&(5126===a&&(s=33326),5131===a&&(s=33325),5121===a&&(s=33321)),33319===r&&(5126===a&&(s=33328),5131===a&&(s=33327),5121===a&&(s=33323)),6408===r&&(5126===a&&(s=34836),5131===a&&(s=34842),5121===a&&(s=i===Ut&&!1===o?35907:32856),32819===a&&(s=32854),32820===a&&(s=32855)),33325!==s&&33326!==s&&33327!==s&&33328!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function Z(e,t,n){return!0===G(e,n)||e.isFramebufferTexture&&e.minFilter!==Se&&e.minFilter!==Ee?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){return e===Se||e===xe||e===Me?9728:9729}function x(e){var t=e.target;t.removeEventListener("dispose",x),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,a=m.get(n);if(a){var i=a[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(e),0===Object.keys(a).length&&m.delete(n)}r.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function R(t){var n=t.target;n.removeEventListener("dispose",R),function(t){var n=t.texture,a=r.get(t),i=r.get(n);void 0!==i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(a.__webglFramebuffer[s]),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer[s]);else e.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer),a.__webglMultisampledFramebuffer&&e.deleteFramebuffer(a.__webglMultisampledFramebuffer),a.__webglColorRenderbuffer&&e.deleteRenderbuffer(a.__webglColorRenderbuffer),a.__webglDepthRenderbuffer&&e.deleteRenderbuffer(a.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(var c=0,u=n.length;c<u;c++){var l=r.get(n[c]);l.__webglTexture&&(e.deleteTexture(l.__webglTexture),o.memory.textures--),r.remove(n[c])}r.remove(n),r.remove(t)}(n)}function M(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var a=t.source;delete m.get(a)[n.__cacheKey],o.memory.textures--}var k=0;function E(e,t){var a=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version){var i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void H(a,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,a.__webglTexture)}var W=(s={},Object(I.a)(s,we,10497),Object(I.a)(s,_e,33071),Object(I.a)(s,Ze,33648),s),V=(c={},Object(I.a)(c,Se,9728),Object(I.a)(c,xe,9984),Object(I.a)(c,Me,9986),Object(I.a)(c,Ee,9729),Object(I.a)(c,We,9985),Object(I.a)(c,Fe,9987),c);function F(n,i,o){if(o?(e.texParameteri(n,10242,W[i.wrapS]),e.texParameteri(n,10243,W[i.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,W[i.wrapR]),e.texParameteri(n,10240,V[i.magFilter]),e.texParameteri(n,10241,V[i.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),i.wrapS===_e&&i.wrapT===_e||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,S(i.magFilter)),e.texParameteri(n,10241,S(i.minFilter)),i.minFilter!==Se&&i.minFilter!==Ee&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(i.type===ze&&!1===t.has("OES_texture_float_linear"))return;if(!1===l&&i.type===Ke&&!1===t.has("OES_texture_half_float_linear"))return;(i.anisotropy>1||r.get(i).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy)}}function X(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",x));var a=n.source,i=m.get(a);void 0===i&&(i={},m.set(a,i));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),i[s].usedTimes++;var c=i[t.__cacheKey];void 0!==c&&(i[t.__cacheKey].usedTimes--,0===c.usedTimes&&M(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return r}function H(t,r,a){var o=3553;r.isDataArrayTexture&&(o=35866),r.isData3DTexture&&(o=32879);var s=X(t,r),c=r.source;if(n.activeTexture(33984+a),n.bindTexture(o,t.__webglTexture),c.version!==c.__currentVersion||!0===s){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);var u,g=function(e){return!l&&(e.wrapS!==_e||e.wrapT!==_e||e.minFilter!==Se&&e.minFilter!==Ee)}(r)&&!1===B(r.image),d=y(r.image,g,!1,A),I=B(d=z(r,d))||l,h=i.convert(r.format,r.encoding),C=i.convert(r.type),f=_(r.internalFormat,h,C,r.encoding,r.isVideoTexture);F(o,r,I);var p=r.mipmaps,m=l&&!0!==r.isVideoTexture,v=void 0===t.__version,b=Z(r,d,I);if(r.isDepthTexture)f=6402,l?f=r.type===ze?36012:r.type===Te?33190:r.type===Ue?35056:33189:r.type===ze&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===et&&6402===f&&r.type!==Ne&&r.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ne,C=i.convert(r.type)),r.format===tt&&6402===f&&(f=34041,r.type!==Ue&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ue,C=i.convert(r.type))),m&&v?n.texStorage2D(3553,1,f,d.width,d.height):n.texImage2D(3553,0,f,d.width,d.height,0,h,C,null);else if(r.isDataTexture)if(p.length>0&&I){m&&v&&n.texStorage2D(3553,b,f,p[0].width,p[0].height);for(var S=0,x=p.length;S<x;S++)u=p[S],m?n.texSubImage2D(3553,S,0,0,u.width,u.height,h,C,u.data):n.texImage2D(3553,S,f,u.width,u.height,0,h,C,u.data);r.generateMipmaps=!1}else m?(v&&n.texStorage2D(3553,b,f,d.width,d.height),n.texSubImage2D(3553,0,0,0,d.width,d.height,h,C,d.data)):n.texImage2D(3553,0,f,d.width,d.height,0,h,C,d.data);else if(r.isCompressedTexture){m&&v&&n.texStorage2D(3553,b,f,p[0].width,p[0].height);for(var R=0,M=p.length;R<M;R++)u=p[R],r.format!==Je?null!==h?m?n.compressedTexSubImage2D(3553,R,0,0,u.width,u.height,h,u.data):n.compressedTexImage2D(3553,R,f,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):m?n.texSubImage2D(3553,R,0,0,u.width,u.height,h,C,u.data):n.texImage2D(3553,R,f,u.width,u.height,0,h,C,u.data)}else if(r.isDataArrayTexture)m?(v&&n.texStorage3D(35866,b,f,d.width,d.height,d.depth),n.texSubImage3D(35866,0,0,0,0,d.width,d.height,d.depth,h,C,d.data)):n.texImage3D(35866,0,f,d.width,d.height,d.depth,0,h,C,d.data);else if(r.isData3DTexture)m?(v&&n.texStorage3D(32879,b,f,d.width,d.height,d.depth),n.texSubImage3D(32879,0,0,0,0,d.width,d.height,d.depth,h,C,d.data)):n.texImage3D(32879,0,f,d.width,d.height,d.depth,0,h,C,d.data);else if(r.isFramebufferTexture)m&&v?n.texStorage2D(3553,b,f,d.width,d.height):n.texImage2D(3553,0,f,d.width,d.height,0,h,C,null);else if(p.length>0&&I){m&&v&&n.texStorage2D(3553,b,f,p[0].width,p[0].height);for(var k=0,E=p.length;k<E;k++)u=p[k],m?n.texSubImage2D(3553,k,0,0,h,C,u):n.texImage2D(3553,k,f,h,C,u);r.generateMipmaps=!1}else m?(v&&n.texStorage2D(3553,b,f,d.width,d.height),n.texSubImage2D(3553,0,0,0,h,C,d)):n.texImage2D(3553,0,f,h,C,d);G(r,I)&&w(o),c.__currentVersion=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function O(t,a,o,s,c){var u=i.convert(o.format,o.encoding),l=i.convert(o.type),g=_(o.internalFormat,u,l,o.encoding);r.get(a).__hasExternalTextures||(32879===c||35866===c?n.texImage3D(c,0,g,a.width,a.height,a.depth,0,u,l,null):n.texImage2D(c,0,g,a.width,a.height,0,u,l,null)),n.bindFramebuffer(36160,t),T(a)?C.framebufferTexture2DMultisampleEXT(36160,s,c,r.get(o).__webglTexture,0,Y(a)):e.framebufferTexture2D(36160,s,c,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function L(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var a=33189;if(r||T(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===ze?a=36012:o.type===Te&&(a=33190));var s=Y(n);T(n)?C.renderbufferStorageMultisampleEXT(36161,s,a,n.width,n.height):e.renderbufferStorageMultisample(36161,s,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var c=Y(n);r&&!1===T(n)?e.renderbufferStorageMultisample(36161,c,35056,n.width,n.height):T(n)?C.renderbufferStorageMultisampleEXT(36161,c,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,l=i.convert(u.format,u.encoding),g=i.convert(u.type),d=_(u.internalFormat,l,g,u.encoding),I=Y(n);r&&!1===T(n)?e.renderbufferStorageMultisample(36161,I,d,n.width,n.height):T(n)?C.renderbufferStorageMultisampleEXT(36161,I,d,n.width,n.height):e.renderbufferStorage(36161,d,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(t){var a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),E(a.depthTexture,0);var i=r.get(a.depthTexture).__webglTexture,o=Y(a);if(a.depthTexture.format===et)T(a)?C.framebufferTexture2DMultisampleEXT(36160,36096,3553,i,0,o):e.framebufferTexture2D(36160,36096,3553,i,0);else{if(a.depthTexture.format!==tt)throw new Error("Unknown depthTexture format");T(a)?C.framebufferTexture2DMultisampleEXT(36160,33306,3553,i,0,o):e.framebufferTexture2D(36160,33306,3553,i,0)}}(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,a.__webglFramebuffer[o]),a.__webglDepthbuffer[o]=e.createRenderbuffer(),L(a.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,a.__webglFramebuffer),a.__webglDepthbuffer=e.createRenderbuffer(),L(a.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function Y(e){return Math.min(h,e.samples)}function T(e){var n=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,n){var r=e.encoding,a=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Rn||r!==Dt&&(r===Ut?!1===l?!0===t.has("EXT_sRGB")&&a===Je?(e.format=Rn,e.minFilter=Ee,e.generateMipmaps=!1):n=ur.sRGBToLinear(n):a===Je&&i===He||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){var e=k;return e>=g&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+g),k+=1,e},this.resetTextureUnits=function(){k=0},this.setTexture2D=E,this.setTexture2DArray=function(e,t){var a=r.get(e);e.version>0&&a.__version!==e.version?H(a,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,a.__webglTexture))},this.setTexture3D=function(e,t){var a=r.get(e);e.version>0&&a.__version!==e.version?H(a,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,a.__webglTexture))},this.setTextureCube=function(t,a){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;var o=X(t,r),s=r.source;if(n.activeTexture(33984+a),n.bindTexture(34067,t.__webglTexture),s.version!==s.__currentVersion||!0===o){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);for(var c=r.isCompressedTexture||r.image[0].isCompressedTexture,u=r.image[0]&&r.image[0].isDataTexture,g=[],I=0;I<6;I++)g[I]=c||u?u?r.image[I].image:r.image[I]:y(r.image[I],!1,!0,d),g[I]=z(r,g[I]);var A,h=g[0],C=B(h)||l,f=i.convert(r.format,r.encoding),p=i.convert(r.type),m=_(r.internalFormat,f,p,r.encoding),v=l&&!0!==r.isVideoTexture,b=void 0===t.__version,S=Z(r,h,C);if(F(34067,r,C),c){v&&b&&n.texStorage2D(34067,S,m,h.width,h.height);for(var x=0;x<6;x++){A=g[x].mipmaps;for(var R=0;R<A.length;R++){var M=A[R];r.format!==Je?null!==f?v?n.compressedTexSubImage2D(34069+x,R,0,0,M.width,M.height,f,M.data):n.compressedTexImage2D(34069+x,R,m,M.width,M.height,0,M.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(34069+x,R,0,0,M.width,M.height,f,p,M.data):n.texImage2D(34069+x,R,m,M.width,M.height,0,f,p,M.data)}}}else{A=r.mipmaps,v&&b&&(A.length>0&&S++,n.texStorage2D(34067,S,m,g[0].width,g[0].height));for(var k=0;k<6;k++)if(u){v?n.texSubImage2D(34069+k,0,0,0,g[k].width,g[k].height,f,p,g[k].data):n.texImage2D(34069+k,0,m,g[k].width,g[k].height,0,f,p,g[k].data);for(var E=0;E<A.length;E++){var W=A[E].image[k].image;v?n.texSubImage2D(34069+k,E+1,0,0,W.width,W.height,f,p,W.data):n.texImage2D(34069+k,E+1,m,W.width,W.height,0,f,p,W.data)}}else{v?n.texSubImage2D(34069+k,0,0,0,f,p,g[k]):n.texImage2D(34069+k,0,m,f,p,g[k]);for(var V=0;V<A.length;V++){var H=A[V];v?n.texSubImage2D(34069+k,V+1,0,0,f,p,H.image[k]):n.texImage2D(34069+k,V+1,m,f,p,H.image[k])}}}G(r,C)&&w(34067),s.__currentVersion=s.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,a):(n.activeTexture(33984+a),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,n){var a=r.get(e);void 0!==t&&O(a.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&N(e)},this.setupRenderTarget=function(t){var s=t.texture,c=r.get(t),u=r.get(s);t.addEventListener("dispose",R),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=s.version,o.memory.textures++);var g=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,I=B(t)||l;if(g){c.__webglFramebuffer=[];for(var A=0;A<6;A++)c.__webglFramebuffer[A]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(a.drawBuffers)for(var h=t.texture,C=0,f=h.length;C<f;C++){var p=r.get(h[C]);void 0===p.__webglTexture&&(p.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(l&&t.samples>0&&!1===T(t)){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);var m=i.convert(s.format,s.encoding),v=i.convert(s.type),b=_(s.internalFormat,m,v,s.encoding),y=Y(t);e.renderbufferStorageMultisample(36161,y,b,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),L(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}if(g){n.bindTexture(34067,u.__webglTexture),F(34067,s,I);for(var Z=0;Z<6;Z++)O(c.__webglFramebuffer[Z],t,s,36064,34069+Z);G(s,I)&&w(34067),n.unbindTexture()}else if(d){for(var S=t.texture,x=0,M=S.length;x<M;x++){var k=S[x],E=r.get(k);n.bindTexture(3553,E.__webglTexture),F(3553,k,I),O(c.__webglFramebuffer,t,k,36064+x,3553),G(k,I)&&w(3553)}n.unbindTexture()}else{var W=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?W=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(W,u.__webglTexture),F(W,s,I),O(c.__webglFramebuffer,t,s,36064,W),G(s,I)&&w(W),n.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){for(var t=B(e)||l,a=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],i=0,o=a.length;i<o;i++){var s=a[i];if(G(s,t)){var c=e.isWebGLCubeRenderTarget?34067:3553,u=r.get(s).__webglTexture;n.bindTexture(c,u),w(c),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===T(t)){var a=t.width,i=t.height,o=16384,s=[36064],c=t.stencilBuffer?33306:36096;t.depthBuffer&&s.push(c);var u=r.get(t),g=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;!1===g&&(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024)),n.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,u.__webglFramebuffer),!0===g&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),e.blitFramebuffer(0,0,a,i,0,0,a,i,o,9728),f&&e.invalidateFramebuffer(36008,s),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=O,this.useMultisampledRTT=T}function Ac(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e===He)return 5121;if(e===je)return 32819;if(e===De)return 32820;if(e===Oe)return 5120;if(e===Le)return 5122;if(e===Ne)return 5123;if(e===Ye)return 5124;if(e===Te)return 5125;if(e===ze)return 5126;if(e===Ke)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===Qe)return 6406;if(e===Je)return 6408;if(e===qe)return 6409;if(e===$e)return 6410;if(e===et)return 6402;if(e===tt)return 34041;if(e===nt)return 6403;if(e===Pe)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(e===Rn)return null!==(n=t.get("EXT_sRGB"))?n.SRGB_ALPHA_EXT:null;if(e===rt)return 36244;if(e===at)return 33319;if(e===it)return 33320;if(e===ot)return 36249;if(e===st||e===ct||e===ut||e===lt)if(a===Ut){if(null===(n=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(e===st)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===ct)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===ut)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===lt)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===st)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ct)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ut)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===lt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===gt||e===dt||e===It||e===At){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===gt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===dt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===It)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===At)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ht)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===Ct||e===ft){if(null===(n=t.get("WEBGL_compressed_texture_etc")))return null;if(e===Ct)return a===Ut?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===ft)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(e===pt||e===mt||e===vt||e===bt||e===yt||e===Bt||e===Gt||e===wt||e===_t||e===Zt||e===St||e===xt||e===Rt||e===Mt){if(null===(n=t.get("WEBGL_compressed_texture_astc")))return null;if(e===pt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===mt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===vt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===bt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===yt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Bt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Gt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===wt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===_t)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Zt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===St)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===xt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Rt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Mt)return a===Ut?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===kt){if(null===(n=t.get("EXT_texture_compression_bptc")))return null;if(e===kt)return a===Ut?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}return e===Ue?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}var hc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(A.a)(this,n),(e=t.call(this)).cameras=r,e}return Object(h.a)(n)}(Mi);hc.prototype.isArrayCamera=!0;var Cc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="Group",e}return Object(h.a)(n)}(Ga);Cc.prototype.isGroup=!0;var fc={type:"move"},pc=function(){function e(){Object(A.a)(this,e),this._targetRay=null,this._grip=null,this._hand=null}return Object(h.a)(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Cc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Cc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new yr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new yr),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Cc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new yr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new yr),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,a=null,o=null,s=this._targetRay,c=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==s&&null!==(r=t.getPose(e.targetRaySpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(fc)),u&&e.hand){o=!0;var l,g=Object(i.a)(e.hand.values());try{for(g.s();!(l=g.n()).done;){var d=l.value,I=t.getJointPose(d,n);if(void 0===u.joints[d.jointName]){var A=new Cc;A.matrixAutoUpdate=!1,A.visible=!1,u.joints[d.jointName]=A,u.add(A)}var h=u.joints[d.jointName];null!==I&&(h.matrix.fromArray(I.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointRadius=I.radius),h.visible=null!==I}}catch(m){g.e(m)}finally{g.f()}var C=u.joints["index-finger-tip"],f=u.joints["thumb-tip"],p=C.position.distanceTo(f.position);u.inputState.pinching&&p>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&p<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&null!==(a=t.getPose(e.gripSpace,n))&&(c.matrix.fromArray(a.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),a.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(a.linearVelocity)):c.hasLinearVelocity=!1,a.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(a.angularVelocity)):c.hasAngularVelocity=!1);return null!==s&&(s.visible=null!==r),null!==c&&(c.visible=null!==a),null!==u&&(u.visible=null!==o),this}}]),e}(),mc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s,c,u,l,g){var d;if(Object(A.a)(this,n),(g=void 0!==g?g:et)!==et&&g!==tt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===a&&g===et&&(a=Ne),void 0===a&&g===tt&&(a=Ue),(d=t.call(this,null,i,o,s,c,u,g,a,l)).image={width:e,height:r},d.magFilter=void 0!==c?c:Se,d.minFilter=void 0!==u?u:Se,d.flipY=!1,d.generateMipmaps=!1,d}return Object(h.a)(n)}(Ir);mc.prototype.isDepthTexture=!0;var vc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var i;Object(A.a)(this,n),i=t.call(this);var o=Object(l.a)(i),s=null,c=1,u=null,g="local-floor",d=null,I=null,h=null,C=null,p=null,m=r.getContextAttributes(),v=null,b=null,y=[],B=new Map,G=new Mi;G.layers.enable(1),G.viewport=new Ar;var w=new Mi;w.layers.enable(2),w.viewport=new Ar;var _=[G,w],Z=new hc;Z.layers.enable(1),Z.layers.enable(2);var S=null,x=null;function R(e){var t=B.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function M(){B.forEach((function(e,t){e.disconnect(t)})),B.clear(),S=null,x=null,e.setRenderTarget(v),C=null,h=null,I=null,s=null,b=null,X.stop(),o.isPresenting=!1,o.dispatchEvent({type:"sessionend"})}function k(e){for(var t=s.inputSources,n=0;n<y.length;n++)B.set(t[n],y[n]);for(var r=0;r<e.removed.length;r++){var a=e.removed[r],i=B.get(a);i&&(i.dispatchEvent({type:"disconnected",data:a}),B.delete(a))}for(var o=0;o<e.added.length;o++){var c=e.added[o],u=B.get(c);u&&u.dispatchEvent({type:"connected",data:c})}}i.cameraAutoUpdate=!0,i.enabled=!1,i.isPresenting=!1,i.getController=function(e){var t=y[e];return void 0===t&&(t=new pc,y[e]=t),t.getTargetRaySpace()},i.getControllerGrip=function(e){var t=y[e];return void 0===t&&(t=new pc,y[e]=t),t.getGripSpace()},i.getHand=function(e){var t=y[e];return void 0===t&&(t=new pc,y[e]=t),t.getHandSpace()},i.setFramebufferScaleFactor=function(e){c=e,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},i.setReferenceSpaceType=function(e){g=e,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},i.getReferenceSpace=function(){return u},i.getBaseLayer=function(){return null!==h?h:C},i.getBinding=function(){return I},i.getFrame=function(){return p},i.getSession=function(){return s},i.setSession=function(){var t=Object(a.a)(f.a.mark((function t(n){var a,i,l,d,A;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(s=n)){t.next=24;break}if(v=e.getRenderTarget(),s.addEventListener("select",R),s.addEventListener("selectstart",R),s.addEventListener("selectend",R),s.addEventListener("squeeze",R),s.addEventListener("squeezestart",R),s.addEventListener("squeezeend",R),s.addEventListener("end",M),s.addEventListener("inputsourceschange",k),!0===m.xrCompatible){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:return void 0===s.renderState.layers||!1===e.capabilities.isWebGL2?(a={antialias:void 0!==s.renderState.layers||m.antialias,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:c},C=new XRWebGLLayer(s,r,a),s.updateRenderState({baseLayer:C}),b=new hr(C.framebufferWidth,C.framebufferHeight,{format:Je,type:He,encoding:e.outputEncoding})):(i=null,l=null,d=null,m.depth&&(d=m.stencil?35056:33190,i=m.stencil?tt:et,l=m.stencil?Ue:Ne),A={colorFormat:e.outputEncoding===Ut?35907:32856,depthFormat:d,scaleFactor:c},I=new XRWebGLBinding(s,r),h=I.createProjectionLayer(A),s.updateRenderState({layers:[h]}),b=new hr(h.textureWidth,h.textureHeight,{format:Je,type:He,depthTexture:new mc(h.textureWidth,h.textureHeight,l,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0}),e.properties.get(b).__ignoreDepthValues=h.ignoreDepthValues),b.isXRRenderTarget=!0,this.setFoveation(1),t.next=19,s.requestReferenceSpace(g);case 19:u=t.sent,X.setContext(s),X.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"});case 24:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var E=new yr,W=new yr;function V(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}i.updateCamera=function(e){if(null!==s){Z.near=w.near=G.near=e.near,Z.far=w.far=G.far=e.far,S===Z.near&&x===Z.far||(s.updateRenderState({depthNear:Z.near,depthFar:Z.far}),S=Z.near,x=Z.far);var t=e.parent,n=Z.cameras;V(Z,t);for(var r=0;r<n.length;r++)V(n[r],t);Z.matrixWorld.decompose(Z.position,Z.quaternion,Z.scale),e.position.copy(Z.position),e.quaternion.copy(Z.quaternion),e.scale.copy(Z.scale),e.matrix.copy(Z.matrix),e.matrixWorld.copy(Z.matrixWorld);for(var a=e.children,i=0,o=a.length;i<o;i++)a[i].updateMatrixWorld(!0);2===n.length?function(e,t,n){E.setFromMatrixPosition(t.matrixWorld),W.setFromMatrixPosition(n.matrixWorld);var r=E.distanceTo(W),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,o=a[14]/(a[10]-1),s=a[14]/(a[10]+1),c=(a[9]+1)/a[5],u=(a[9]-1)/a[5],l=(a[8]-1)/a[0],g=(i[8]+1)/i[0],d=o*l,I=o*g,A=r/(-l+g),h=A*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(A),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var C=o+A,f=s+A,p=d-h,m=I+(r-h),v=c*s/f*C,b=u*s/f*C;e.projectionMatrix.makePerspective(p,m,v,b,C,f)}(Z,G,w):Z.projectionMatrix.copy(G.projectionMatrix)}},i.getCamera=function(){return Z},i.getFoveation=function(){return null!==h?h.fixedFoveation:null!==C?C.fixedFoveation:void 0},i.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==C&&void 0!==C.fixedFoveation&&(C.fixedFoveation=e)};var F=null;var X=new Ti;return X.setAnimationLoop((function(t,n){if(d=n.getViewerPose(u),p=n,null!==d){var r=d.views;null!==C&&(e.setRenderTargetFramebuffer(b,C.framebuffer),e.setRenderTarget(b));var a=!1;r.length!==Z.cameras.length&&(Z.cameras.length=0,a=!0);for(var i=0;i<r.length;i++){var o=r[i],c=null;if(null!==C)c=C.getViewport(o);else{var l=I.getViewSubImage(h,o);c=l.viewport,0===i&&(e.setRenderTargetTextures(b,l.colorTexture,h.ignoreDepthValues?void 0:l.depthStencilTexture),e.setRenderTarget(b))}var g=_[i];g.matrix.fromArray(o.transform.matrix),g.projectionMatrix.fromArray(o.projectionMatrix),g.viewport.set(c.x,c.y,c.width,c.height),0===i&&Z.matrix.copy(g.matrix),!0===a&&Z.cameras.push(g)}}for(var A=s.inputSources,f=0;f<y.length;f++){var m=y[f],v=A[f];m.update(v,n,u)}F&&F(t,n),p=null})),i.setAnimationLoop=function(e){F=e},i.dispose=function(){},i}return Object(h.a)(n)}(Mn);function bc(e,t){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,r.side===R&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),r.side===R&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);var a,i,o=t.get(r).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*s}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?a=r.map:r.specularMap?a=r.specularMap:r.displacementMap?a=r.displacementMap:r.normalMap?a=r.normalMap:r.bumpMap?a=r.bumpMap:r.roughnessMap?a=r.roughnessMap:r.metalnessMap?a=r.metalnessMap:r.alphaMap?a=r.alphaMap:r.emissiveMap?a=r.emissiveMap:r.clearcoatMap?a=r.clearcoatMap:r.clearcoatNormalMap?a=r.clearcoatNormalMap:r.clearcoatRoughnessMap?a=r.clearcoatRoughnessMap:r.specularIntensityMap?a=r.specularIntensityMap:r.specularColorMap?a=r.specularColorMap:r.transmissionMap?a=r.transmissionMap:r.thicknessMap?a=r.thicknessMap:r.sheenColorMap?a=r.sheenColorMap:r.sheenRoughnessMap&&(a=r.sheenRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uvTransform.value.copy(a.matrix)),r.aoMap?i=r.aoMap:r.lightMap&&(i=r.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),n.uv2Transform.value.copy(i.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,a,i,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===R&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var a;t.map?a=t.map:t.alphaMap&&(a=t.alphaMap);void 0!==a&&(!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uvTransform.value.copy(a.matrix))}(e,r,a,i):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function yc(){var e=Pn("canvas");return e.style.display="block",e}function Bc(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=void 0!==t.canvas?t.canvas:yc(),r=void 0!==t.context?t.context:null,a=void 0===t.depth||t.depth,i=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",l=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;e=void 0!==t.context?r.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;var g=null,d=null,I=[],A=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Dt,this.physicallyCorrectLights=!1,this.toneMapping=Ie,this.toneMappingExposure=1;var h=this,C=!1,f=0,m=0,v=null,b=-1,y=null,B=new Ar,G=new Ar,w=null,_=n.width,Z=n.height,S=1,k=null,E=null,W=new Ar(0,0,_,Z),V=new Ar(0,0,_,Z),F=!1,X=new Yi,H=!1,O=!1,L=null,N=new $r,Y=new Kn,T=new yr,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return null===v?S:1}var j,D,U,Q,P,J,q,$,ee,te,ne,re,ae,ie,oe,se,ce,ue,le,ge,de,Ae,he,Ce=r;function fe(e,t){for(var r=0;r<e.length;r++){var a=e[r],i=n.getContext(a,t);if(null!==i)return i}return null}try{var pe={alpha:!0,depth:a,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:l};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(p)),n.addEventListener("webglcontextlost",ye,!1),n.addEventListener("webglcontextrestored",Be,!1),null===Ce){var me=["webgl2","webgl","experimental-webgl"];if(!0===h.isWebGL1Renderer&&me.shift(),null===(Ce=fe(me,pe)))throw fe(me)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Ce.getShaderPrecisionFormat&&(Ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(je){throw console.error("THREE.WebGLRenderer: "+je.message),je}function ve(){j=new fo(Ce),D=new qi(Ce,j,t),j.init(D),Ae=new Ac(Ce,j,D),U=new dc(Ce,j,D),Q=new vo(Ce),P=new qs,J=new Ic(Ce,j,U,P,D,Ae,Q),q=new eo(h),$=new Co(h),ee=new zi(Ce,D),he=new Pi(Ce,j,ee,D),te=new po(Ce,ee,Q,he),ne=new wo(Ce,te,ee,Q),le=new Go(Ce,D,J),se=new $i(P),re=new Js(h,q,$,j,D,he,se),ae=new bc(h,P),ie=new nc,oe=new cc(j,D),ue=new Qi(h,q,U,ne,e,s),ce=new gc(h,ne,D),ge=new Ji(Ce,j,Q,D),de=new mo(Ce,j,Q,D),Q.programs=re.programs,h.capabilities=D,h.extensions=j,h.properties=P,h.renderLists=ie,h.shadowMap=ce,h.state=U,h.info=Q}ve();var be=new vc(h,Ce);function ye(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Be(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;var e=Q.autoReset,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,a=ce.type;ve(),Q.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=a}function Ge(e){var t=e.target;t.removeEventListener("dispose",Ge),we(t)}function we(e){_e(e),P.remove(e)}function _e(e){var t=P.get(e).programs;void 0!==t&&(t.forEach((function(e){re.releaseProgram(e)})),e.isShaderMaterial&&re.releaseShaderCache(e))}this.xr=be,this.getContext=function(){return Ce},this.getContextAttributes=function(){return Ce.getContextAttributes()},this.forceContextLoss=function(){var e=j.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=j.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return S},this.setPixelRatio=function(e){void 0!==e&&(S=e,this.setSize(_,Z,!1))},this.getSize=function(e){return e.set(_,Z)},this.setSize=function(e,t,r){be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_=e,Z=t,n.width=Math.floor(e*S),n.height=Math.floor(t*S),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(_*S,Z*S).floor()},this.setDrawingBufferSize=function(e,t,r){_=e,Z=t,S=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(B)},this.getViewport=function(e){return e.copy(W)},this.setViewport=function(e,t,n,r){e.isVector4?W.set(e.x,e.y,e.z,e.w):W.set(e,t,n,r),U.viewport(B.copy(W).multiplyScalar(S).floor())},this.getScissor=function(e){return e.copy(V)},this.setScissor=function(e,t,n,r){e.isVector4?V.set(e.x,e.y,e.z,e.w):V.set(e,t,n,r),U.scissor(G.copy(V).multiplyScalar(S).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){U.setScissorTest(F=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){E=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;e&&(r|=16384),t&&(r|=256),n&&(r|=1024),Ce.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ye,!1),n.removeEventListener("webglcontextrestored",Be,!1),ie.dispose(),oe.dispose(),P.dispose(),q.dispose(),$.dispose(),ne.dispose(),he.dispose(),re.dispose(),be.dispose(),be.removeEventListener("sessionstart",xe),be.removeEventListener("sessionend",Re),L&&(L.dispose(),L=null),Me.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=z);var o=a.isMesh&&a.matrixWorld.determinant()<0,s=Ne(e,t,n,r,a);U.setMaterial(r,o);var c=n.index,u=n.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;var l,g=1;!0===r.wireframe&&(c=te.getWireframeAttribute(n),g=2),he.setup(a,r,s,n,c);var d=ge;null!==c&&(l=ee.get(c),(d=de).setIndex(l));var I=null!==c?c.count:u.count,A=n.drawRange.start*g,h=n.drawRange.count*g,C=null!==i?i.start*g:0,f=null!==i?i.count*g:1/0,p=Math.max(A,C),m=Math.min(I,A+h,C+f)-1,v=Math.max(0,m-p+1);if(0!==v){if(a.isMesh)!0===r.wireframe?(U.setLineWidth(r.wireframeLinewidth*K()),d.setMode(1)):d.setMode(4);else if(a.isLine){var b=r.linewidth;void 0===b&&(b=1),U.setLineWidth(b*K()),a.isLineSegments?d.setMode(1):a.isLineLoop?d.setMode(2):d.setMode(3)}else a.isPoints?d.setMode(0):a.isSprite&&d.setMode(4);if(a.isInstancedMesh)d.renderInstances(p,v,a.count);else if(n.isInstancedBufferGeometry){var y=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(p,v,y)}else d.render(p,v)}},this.compile=function(e,t){(d=oe.get(e)).init(),A.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(h.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){Oe(n[r],e,t)}else Oe(n,e,t)})),A.pop(),d=null};var Ze=null;function Se(e){Ze&&Ze(e)}function xe(){Me.stop()}function Re(){Me.start()}var Me=new Ti;function ke(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||X.intersectsSprite(e)){r&&T.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);var a=ne.update(e),i=e.material;i.visible&&g.push(e,a,i,n,T.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||X.intersectsObject(e))){r&&T.setFromMatrixPosition(e.matrixWorld).applyMatrix4(N);var o=ne.update(e),s=e.material;if(Array.isArray(s))for(var c=o.groups,u=0,l=c.length;u<l;u++){var I=c[u],A=s[I.materialIndex];A&&A.visible&&g.push(e,o,A,n,T.z,I)}else s.visible&&g.push(e,o,s,n,T.z,null)}for(var h=e.children,C=0,f=h.length;C<f;C++)ke(h[C],t,n,r)}}function Ee(e,t,n,r){var a=e.opaque,i=e.transmissive,o=e.transparent;d.setupLightsView(n),i.length>0&&We(a,t,n),r&&U.viewport(B.copy(r)),a.length>0&&Ve(a,t,n),i.length>0&&Ve(i,t,n),o.length>0&&Ve(o,t,n),U.buffers.depth.setTest(!0),U.buffers.depth.setMask(!0),U.buffers.color.setMask(!0),U.setPolygonOffset(!1)}function We(e,t,n){var r=D.isWebGL2;null===L&&(L=new hr(1,1,{generateMipmaps:!0,type:null!==Ae.convert(Ke)?Ke:He,minFilter:Fe,samples:r&&!0===o?4:0})),h.getDrawingBufferSize(Y),r?L.setSize(Y.x,Y.y):L.setSize(Tn(Y.x),Tn(Y.y));var a=h.getRenderTarget();h.setRenderTarget(L),h.clear();var i=h.toneMapping;h.toneMapping=Ie,Ve(e,t,n),h.toneMapping=i,J.updateMultisampleRenderTarget(L),J.updateRenderTargetMipmap(L),h.setRenderTarget(a)}function Ve(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,a=0,i=e.length;a<i;a++){var o=e[a],s=o.object,c=o.geometry,u=null===r?o.material:r,l=o.group;s.layers.test(n.layers)&&Xe(s,t,n,c,u,l)}}function Xe(e,t,n,r,a,i){e.onBeforeRender(h,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(h,t,n,r,e,i),!0===a.transparent&&a.side===M?(a.side=R,a.needsUpdate=!0,h.renderBufferDirect(n,t,r,a,e,i),a.side=x,a.needsUpdate=!0,h.renderBufferDirect(n,t,r,a,e,i),a.side=M):h.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(h,t,n,r,a,i)}function Oe(e,t,n){!0!==t.isScene&&(t=z);var r=P.get(e),a=d.state.lights,i=d.state.shadowsArray,o=a.state.version,s=re.getParameters(e,a.state,i,t,n),c=re.getProgramCacheKey(s),u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?$:q).get(e.envMap||r.environment),void 0===u&&(e.addEventListener("dispose",Ge),u=new Map,r.programs=u);var l=u.get(c);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===o)return Le(e,s),l}else s.uniforms=re.getUniforms(e),e.onBuild(n,s,h),e.onBeforeCompile(s,h),l=re.acquireProgram(s,c),u.set(c,l),r.uniforms=s.uniforms;var g=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(g.clippingPlanes=se.uniform),Le(e,s),r.needsLights=Te(e),r.lightsStateVersion=o,r.needsLights&&(g.ambientLightColor.value=a.state.ambient,g.lightProbe.value=a.state.probe,g.directionalLights.value=a.state.directional,g.directionalLightShadows.value=a.state.directionalShadow,g.spotLights.value=a.state.spot,g.spotLightShadows.value=a.state.spotShadow,g.rectAreaLights.value=a.state.rectArea,g.ltc_1.value=a.state.rectAreaLTC1,g.ltc_2.value=a.state.rectAreaLTC2,g.pointLights.value=a.state.point,g.pointLightShadows.value=a.state.pointShadow,g.hemisphereLights.value=a.state.hemi,g.directionalShadowMap.value=a.state.directionalShadowMap,g.directionalShadowMatrix.value=a.state.directionalShadowMatrix,g.spotShadowMap.value=a.state.spotShadowMap,g.spotShadowMatrix.value=a.state.spotShadowMatrix,g.pointShadowMap.value=a.state.pointShadowMap,g.pointShadowMatrix.value=a.state.pointShadowMatrix);var I=l.getUniforms(),A=xs.seqWithValue(I.seq,g);return r.currentProgram=l,r.uniformsList=A,l}function Le(e,t){var n=P.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}function Ne(e,t,n,r,a){!0!==t.isScene&&(t=z),J.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===v?h.outputEncoding:!0===v.isXRRenderTarget?v.texture.encoding:Dt,c=(r.isMeshStandardMaterial?$:q).get(r.envMap||o),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,g=!!n.morphAttributes.position,I=!!n.morphAttributes.normal,A=!!n.morphAttributes.color,C=r.toneMapped?h.toneMapping:Ie,f=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,p=void 0!==f?f.length:0,m=P.get(r),B=d.state.lights;if(!0===H&&(!0===O||e!==y)){var G=e===y&&r.id===b;se.setState(r,e,G)}var w=!1;r.version===m.__version?m.needsLights&&m.lightsStateVersion!==B.state.version||m.outputEncoding!==s||a.isInstancedMesh&&!1===m.instancing?w=!0:a.isInstancedMesh||!0!==m.instancing?a.isSkinnedMesh&&!1===m.skinning?w=!0:a.isSkinnedMesh||!0!==m.skinning?m.envMap!==c||r.fog&&m.fog!==i?w=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===se.numPlanes&&m.numIntersection===se.numIntersection?(m.vertexAlphas!==u||m.vertexTangents!==l||m.morphTargets!==g||m.morphNormals!==I||m.morphColors!==A||m.toneMapping!==C||!0===D.isWebGL2&&m.morphTargetsCount!==p)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,m.__version=r.version);var _=m.currentProgram;!0===w&&(_=Oe(r,t,a));var x=!1,R=!1,M=!1,k=_.getUniforms(),E=m.uniforms;if(U.useProgram(_.program)&&(x=!0,R=!0,M=!0),r.id!==b&&(b=r.id,R=!0),x||y!==e){if(k.setValue(Ce,"projectionMatrix",e.projectionMatrix),D.logarithmicDepthBuffer&&k.setValue(Ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),y!==e&&(y=e,R=!0,M=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var W=k.map.cameraPosition;void 0!==W&&W.setValue(Ce,T.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&k.setValue(Ce,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||a.isSkinnedMesh)&&k.setValue(Ce,"viewMatrix",e.matrixWorldInverse)}if(a.isSkinnedMesh){k.setOptional(Ce,a,"bindMatrix"),k.setOptional(Ce,a,"bindMatrixInverse");var V=a.skeleton;V&&(D.floatVertexTextures?(null===V.boneTexture&&V.computeBoneTexture(),k.setValue(Ce,"boneTexture",V.boneTexture,J),k.setValue(Ce,"boneTextureSize",V.boneTextureSize)):k.setOptional(Ce,V,"boneMatrices"))}var F=n.morphAttributes;return(void 0!==F.position||void 0!==F.normal||void 0!==F.color&&!0===D.isWebGL2)&&le.update(a,n,r,_),(R||m.receiveShadow!==a.receiveShadow)&&(m.receiveShadow=a.receiveShadow,k.setValue(Ce,"receiveShadow",a.receiveShadow)),R&&(k.setValue(Ce,"toneMappingExposure",h.toneMappingExposure),m.needsLights&&Ye(E,M),i&&r.fog&&ae.refreshFogUniforms(E,i),ae.refreshMaterialUniforms(E,r,S,Z,L),xs.upload(Ce,m.uniformsList,E,J)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(xs.upload(Ce,m.uniformsList,E,J),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&k.setValue(Ce,"center",a.center),k.setValue(Ce,"modelViewMatrix",a.modelViewMatrix),k.setValue(Ce,"normalMatrix",a.normalMatrix),k.setValue(Ce,"modelMatrix",a.matrixWorld),_}function Ye(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Te(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Me.setAnimationLoop(Se),"undefined"!==typeof self&&Me.setContext(self),this.setAnimationLoop=function(e){Ze=e,be.setAnimationLoop(e),null===e?Me.stop():Me.start()},be.addEventListener("sessionstart",xe),be.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==C){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(h,e,t,v),(d=oe.get(e,A.length)).init(),A.push(d),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),X.setFromProjectionMatrix(N),O=this.localClippingEnabled,H=se.init(this.clippingPlanes,O,t),(g=ie.get(e,I.length)).init(),I.push(g),ke(e,t,0,h.sortObjects),g.finish(),!0===h.sortObjects&&g.sort(k,E),!0===H&&se.beginShadows();var n=d.state.shadowsArray;if(ce.render(n,e,t),!0===H&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(g,e),d.setupLights(h.physicallyCorrectLights),t.isArrayCamera)for(var r=t.cameras,a=0,i=r.length;a<i;a++){var o=r[a];Ee(g,e,o,o.viewport)}else Ee(g,e,t);null!==v&&(J.updateMultisampleRenderTarget(v),J.updateRenderTargetMipmap(v)),!0===e.isScene&&e.onAfterRender(h,e,t),he.resetDefaultState(),b=-1,y=null,A.pop(),d=A.length>0?A[A.length-1]:null,I.pop(),g=I.length>0?I[I.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return v},this.setRenderTargetTextures=function(e,t,n){P.get(e.texture).__webglTexture=t,P.get(e.depthTexture).__webglTexture=n;var r=P.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===j.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=P.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;v=e,f=t,m=n;var r=!0;if(e){var a=P.get(e);void 0!==a.__useDefaultFramebuffer?(U.bindFramebuffer(36160,null),r=!1):void 0===a.__webglFramebuffer?J.setupRenderTarget(e):a.__hasExternalTextures&&J.rebindTextures(e,P.get(e.texture).__webglTexture,P.get(e.depthTexture).__webglTexture)}var i=null,o=!1,s=!1;if(e){var c=e.texture;(c.isData3DTexture||c.isDataArrayTexture)&&(s=!0);var u=P.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=u[t],o=!0):i=D.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?P.get(e).__webglMultisampledFramebuffer:u,B.copy(e.viewport),G.copy(e.scissor),w=e.scissorTest}else B.copy(W).multiplyScalar(S).floor(),G.copy(V).multiplyScalar(S).floor(),w=F;var l=U.bindFramebuffer(36160,i);if(l&&D.drawBuffers&&r&&U.drawBuffers(e,i),U.viewport(B),U.scissor(G),U.setScissorTest(w),o){var g=P.get(e.texture);Ce.framebufferTexture2D(36160,36064,34069+t,g.__webglTexture,n)}else if(s){var d=P.get(e.texture),I=t||0;Ce.framebufferTextureLayer(36160,36064,d.__webglTexture,n||0,I)}b=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,o){if(e&&e.isWebGLRenderTarget){var s=P.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){U.bindFramebuffer(36160,s);try{var c=e.texture,u=c.format,l=c.type;if(u!==Je&&Ae.convert(u)!==Ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var g=l===Ke&&(j.has("EXT_color_buffer_half_float")||D.isWebGL2&&j.has("EXT_color_buffer_float"));if(l!==He&&Ae.convert(l)!==Ce.getParameter(35738)&&(l!==ze||!(D.isWebGL2||j.has("OES_texture_float")||j.has("WEBGL_color_buffer_float")))&&!g)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&Ce.readPixels(t,n,r,a,Ae.convert(u),Ae.convert(l),i)}finally{var d=null!==v?P.get(v).__webglFramebuffer:null;U.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!0===t.isFramebufferTexture){var r=Math.pow(2,-n),a=Math.floor(t.image.width*r),i=Math.floor(t.image.height*r);J.setTexture2D(t,0),Ce.copyTexSubImage2D(3553,n,0,0,e.x,e.y,a,i),U.unbindTexture()}else console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.")},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.image.width,i=t.image.height,o=Ae.convert(n.format),s=Ae.convert(n.type);J.setTexture2D(n,0),Ce.pixelStorei(37440,n.flipY),Ce.pixelStorei(37441,n.premultiplyAlpha),Ce.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?Ce.texSubImage2D(3553,r,e.x,e.y,a,i,o,s,t.image.data):t.isCompressedTexture?Ce.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):Ce.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&Ce.generateMipmap(3553),U.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(h.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var i,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,c=e.max.z-e.min.z+1,u=Ae.convert(r.format),l=Ae.convert(r.type);if(r.isData3DTexture)J.setTexture3D(r,0),i=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(r,0),i=35866}Ce.pixelStorei(37440,r.flipY),Ce.pixelStorei(37441,r.premultiplyAlpha),Ce.pixelStorei(3317,r.unpackAlignment);var g=Ce.getParameter(3314),d=Ce.getParameter(32878),I=Ce.getParameter(3316),A=Ce.getParameter(3315),C=Ce.getParameter(32877),f=n.isCompressedTexture?n.mipmaps[0]:n.image;Ce.pixelStorei(3314,f.width),Ce.pixelStorei(32878,f.height),Ce.pixelStorei(3316,e.min.x),Ce.pixelStorei(3315,e.min.y),Ce.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?Ce.texSubImage3D(i,a,t.x,t.y,t.z,o,s,c,u,l,f.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ce.compressedTexSubImage3D(i,a,t.x,t.y,t.z,o,s,c,u,f.data)):Ce.texSubImage3D(i,a,t.x,t.y,t.z,o,s,c,u,l,f),Ce.pixelStorei(3314,g),Ce.pixelStorei(32878,d),Ce.pixelStorei(3316,I),Ce.pixelStorei(3315,A),Ce.pixelStorei(32877,C),0===a&&r.generateMipmaps&&Ce.generateMipmap(i),U.unbindTexture()}},this.initTexture=function(e){J.setTexture2D(e,0),U.unbindTexture()},this.resetState=function(){f=0,m=0,v=null,U.reset(),he.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Bc.prototype.isWebGLRenderer=!0;var Gc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(Bc);Gc.prototype.isWebGL1Renderer=!0;var wc=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;Object(A.a)(this,e),this.name="",this.color=new cr(t),this.density=n}return Object(h.a)(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}();wc.prototype.isFogExp2=!0;var _c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;Object(A.a)(this,e),this.name="",this.color=new cr(t),this.near=n,this.far=r}return Object(h.a)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}();_c.prototype.isFog=!0;var Zc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Object(l.a)(e)})),e}return Object(h.a)(n,[{key:"copy",value:function(e,t){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(Ga);Zc.prototype.isScene=!0;var Sc=function(){function e(t,n){Object(A.a)(this,e),this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=mn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Xn()}return Object(h.a)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Xn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}();Sc.prototype.isInterleavedBuffer=!0;var xc=new yr,Rc=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(A.a)(this,e),this.name="",this.data=t,this.itemSize=n,this.offset=r,this.normalized=!0===a}return Object(h.a)(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.applyMatrix4(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.applyNormalMatrix(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)xc.fromBufferAttribute(this,t),xc.transformDirection(e),this.setXYZ(t,xc.x,xc.y,xc.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var a=r*this.data.stride+this.offset,i=0;i<this.itemSize;i++)n.push(this.data.array[a+i]);return new Na(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,a=0;a<this.itemSize;a++)t.push(this.data.array[r+a]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}();Rc.prototype.isInterleavedBufferAttribute=!0;var Mc,kc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="SpriteMaterial",r.color=new cr(16777215),r.map=null,r.alphaMap=null,r.rotation=0,r.sizeAttenuation=!0,r.transparent=!0,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(Xa);kc.prototype.isSpriteMaterial=!0;var Ec=new yr,Wc=new yr,Vc=new yr,Fc=new Kn,Xc=new Kn,Hc=new $r,Oc=new yr,Lc=new yr,Nc=new yr,Yc=new Kn,Tc=new Kn,zc=new Kn,Kc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;if(Object(A.a)(this,n),(r=t.call(this)).type="Sprite",void 0===Mc){Mc=new ii;var a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Sc(a,5);Mc.setIndex([0,1,2,0,2,3]),Mc.setAttribute("position",new Rc(i,3,0,!1)),Mc.setAttribute("uv",new Rc(i,2,3,!1))}return r.geometry=Mc,r.material=void 0!==e?e:new kc,r.center=new Kn(.5,.5),r}return Object(h.a)(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Wc.setFromMatrixScale(this.matrixWorld),Hc.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Vc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Wc.multiplyScalar(-Vc.z);var n,r,a=this.material.rotation;0!==a&&(r=Math.cos(a),n=Math.sin(a));var i=this.center;jc(Oc.set(-.5,-.5,0),Vc,i,Wc,n,r),jc(Lc.set(.5,-.5,0),Vc,i,Wc,n,r),jc(Nc.set(.5,.5,0),Vc,i,Wc,n,r),Yc.set(0,0),Tc.set(1,0),zc.set(1,1);var o=e.ray.intersectTriangle(Oc,Lc,Nc,!1,Ec);if(null!==o||(jc(Lc.set(-.5,.5,0),Vc,i,Wc,n,r),Tc.set(0,1),null!==(o=e.ray.intersectTriangle(Oc,Nc,Lc,!1,Ec)))){var s=e.ray.origin.distanceTo(Ec);s<e.near||s>e.far||t.push({distance:s,point:Ec.clone(),uv:Va.getUV(Ec,Oc,Lc,Nc,Yc,Tc,zc,new Kn),face:null,object:this})}}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Ga);function jc(e,t,n,r,a,i){Fc.subVectors(e,n).addScalar(.5).multiply(r),void 0!==a?(Xc.x=i*Fc.x-a*Fc.y,Xc.y=a*Fc.x+i*Fc.y):Xc.copy(Fc),e.copy(t),e.x+=Xc.x,e.y+=Xc.y,e.applyMatrix4(Hc)}Kc.prototype.isSprite=!0;var Dc=new yr,Uc=new yr,Qc=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this))._currentLevel=0,e.type="LOD",Object.defineProperties(Object(l.a)(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}return Object(h.a)(n,[{key:"copy",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,!1);for(var t=e.levels,r=0,a=t.length;r<a;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}},{key:"addLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}},{key:"raycast",value:function(e,t){if(this.levels.length>0){Dc.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Dc);this.getObjectForDistance(n).raycast(e,t)}}},{key:"update",value:function(e){var t=this.levels;if(t.length>1){Dc.setFromMatrixPosition(e.matrixWorld),Uc.setFromMatrixPosition(this.matrixWorld);var n,r,a=Dc.distanceTo(Uc)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&a>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,a=0,i=r.length;a<i;a++){var o=r[a];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}]),n}(Ga),Pc=new yr,Jc=new Ar,qc=new Ar,$c=new yr,eu=new $r,tu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="SkinnedMesh",a.bindMode="attached",a.bindMatrix=new $r,a.bindMatrixInverse=new $r,a}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Ar,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);var a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,r=this.geometry;Jc.fromBufferAttribute(r.attributes.skinIndex,e),qc.fromBufferAttribute(r.attributes.skinWeight,e),Pc.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var a=0;a<4;a++){var i=qc.getComponent(a);if(0!==i){var o=Jc.getComponent(a);eu.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector($c.copy(Pc).applyMatrix4(eu),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(Bi);tu.prototype.isSkinnedMesh=!0;var nu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="Bone",e}return Object(h.a)(n)}(Ga);nu.prototype.isBone=!0;var ru=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Se,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Se,I=arguments.length>10?arguments[10]:void 0,h=arguments.length>11?arguments[11]:void 0;return Object(A.a)(this,n),(e=t.call(this,null,c,u,l,g,d,o,s,I,h)).image={data:r,width:a,height:i},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Object(h.a)(n)}(Ir);ru.prototype.isDataTexture=!0;var au=new $r,iu=new $r,ou=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(A.a)(this,e),this.uuid=Xn(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return Object(h.a)(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new $r)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new $r;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,a=this.bones.length;r<a;r++){var i=this.bones[r];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,a=0,i=e.length;a<i;a++){var o=e[a]?e[a].matrixWorld:iu;au.multiplyMatrices(o,t[a]),au.toArray(n,16*a)}null!==r&&(r.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=Yn(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new ru(t,e,e,Je,ze);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var a=e.bones[n],i=t[a];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),i=new nu),this.bones.push(i),this.boneInverses.push((new $r).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,a=t.length;r<a;r++){var i=t[r];e.bones.push(i.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}}]),e}(),su=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(A.a)(this,n),"number"===typeof a&&(o=a,a=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(i=t.call(this,e,r,a)).meshPerAttribute=o,i}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(Na);su.prototype.isInstancedBufferAttribute=!0;var cu=new $r,uu=new $r,lu=[],gu=new Bi,du=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),(i=t.call(this,e,r)).instanceMatrix=new su(new Float32Array(16*a),16),i.instanceColor=null,i.count=a,i.frustumCulled=!1,i}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,r=this.count;if(gu.geometry=this.geometry,gu.material=this.material,void 0!==gu.material)for(var a=0;a<r;a++){this.getMatrixAt(a,cu),uu.multiplyMatrices(n,cu),gu.matrixWorld=uu,gu.raycast(e,lu);for(var i=0,o=lu.length;i<o;i++){var s=lu[i];s.instanceId=a,s.object=this,t.push(s)}lu.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new su(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Bi);du.prototype.isInstancedMesh=!0;var Iu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="LineBasicMaterial",r.color=new cr(16777215),r.linewidth=1,r.linecap="round",r.linejoin="round",r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}]),n}(Xa);Iu.prototype.isLineBasicMaterial=!0;var Au=new yr,hu=new yr,Cu=new $r,fu=new qr,pu=new zr,mu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ii,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Iu;return Object(A.a)(this,n),(e=t.call(this)).type="Line",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,a=t.count;r<a;r++)Au.fromBufferAttribute(t,r-1),hu.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Au.distanceTo(hu);e.setAttribute("lineDistance",new Pa(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),pu.copy(n.boundingSphere),pu.applyMatrix4(r),pu.radius+=a,!1!==e.ray.intersectsSphere(pu)){Cu.copy(r).invert(),fu.copy(e.ray).applyMatrix4(Cu);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,c=new yr,u=new yr,l=new yr,g=new yr,d=this.isLineSegments?2:1;if(n.isBufferGeometry){var I=n.index,A=n.attributes.position;if(null!==I)for(var h=Math.max(0,i.start),C=Math.min(I.count,i.start+i.count)-1;h<C;h+=d){var f=I.getX(h),p=I.getX(h+1);if(c.fromBufferAttribute(A,f),u.fromBufferAttribute(A,p),!(fu.distanceSqToSegment(c,u,g,l)>s)){g.applyMatrix4(this.matrixWorld);var m=e.ray.origin.distanceTo(g);m<e.near||m>e.far||t.push({distance:m,point:l.clone().applyMatrix4(this.matrixWorld),index:h,face:null,faceIndex:null,object:this})}}else for(var v=Math.max(0,i.start),b=Math.min(A.count,i.start+i.count)-1;v<b;v+=d){if(c.fromBufferAttribute(A,v),u.fromBufferAttribute(A,v+1),!(fu.distanceSqToSegment(c,u,g,l)>s)){g.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(g);y<e.near||y>e.far||t.push({distance:y,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,i=r.length;a<i;a++){var o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Ga);mu.prototype.isLine=!0;var vu=new yr,bu=new yr,yu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="LineSegments",a}return Object(h.a)(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,a=t.count;r<a;r+=2)vu.fromBufferAttribute(t,r),bu.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+vu.distanceTo(bu);e.setAttribute("lineDistance",new Pa(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}]),n}(mu);yu.prototype.isLineSegments=!0;var Bu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="LineLoop",a}return Object(h.a)(n)}(mu);Bu.prototype.isLineLoop=!0;var Gu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="PointsMaterial",r.color=new cr(16777215),r.map=null,r.alphaMap=null,r.size=1,r.sizeAttenuation=!0,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(Xa);Gu.prototype.isPointsMaterial=!0;var wu=new $r,_u=new qr,Zu=new zr,Su=new yr,xu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ii,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gu;return Object(A.a)(this,n),(e=t.call(this)).type="Points",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Zu.copy(n.boundingSphere),Zu.applyMatrix4(r),Zu.radius+=a,!1!==e.ray.intersectsSphere(Zu)){wu.copy(r).invert(),_u.copy(e.ray).applyMatrix4(wu);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){var c=n.index,u=n.attributes.position;if(null!==c)for(var l=Math.max(0,i.start),g=Math.min(c.count,i.start+i.count);l<g;l++){var d=c.getX(l);Su.fromBufferAttribute(u,d),Ru(Su,d,s,r,e,t,this)}else for(var I=Math.max(0,i.start),A=Math.min(u.count,i.start+i.count);I<A;I++)Su.fromBufferAttribute(u,I),Ru(Su,I,s,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,i=r.length;a<i;a++){var o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(Ga);function Ru(e,t,n,r,a,i,o){var s=_u.distanceSqToPoint(e);if(s<n){var c=new yr;_u.closestPointToPoint(e,c),c.applyMatrix4(r);var u=a.ray.origin.distanceTo(c);if(u<a.near||u>a.far)return;i.push({distance:u,distanceToRay:Math.sqrt(s),point:c,index:t,face:null,object:o})}}xu.prototype.isPoints=!0;var Mu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s,c,u,g){var d;Object(A.a)(this,n),(d=t.call(this,e,r,a,i,o,s,c,u,g)).minFilter=void 0!==s?s:Ee,d.magFilter=void 0!==o?o:Ee,d.generateMipmaps=!1;var I=Object(l.a)(d);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){I.needsUpdate=!0,e.requestVideoFrameCallback(t)})),d}return Object(h.a)(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Ir);Mu.prototype.isVideoTexture=!0;var ku=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),(i=t.call(this,{width:e,height:r})).format=a,i.magFilter=Se,i.minFilter=Se,i.generateMipmaps=!1,i.needsUpdate=!0,i}return Object(h.a)(n)}(Ir);ku.prototype.isFramebufferTexture=!0;var Eu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s,c,u,l,g,d,I){var h;return Object(A.a)(this,n),(h=t.call(this,null,s,c,u,l,g,i,o,d,I)).image={width:r,height:a},h.mipmaps=e,h.flipY=!1,h.generateMipmaps=!1,h}return Object(h.a)(n)}(Ir);Eu.prototype.isCompressedTexture=!0;var Wu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s,c,u,l){var g;return Object(A.a)(this,n),(g=t.call(this,e,r,a,i,o,s,c,u,l)).needsUpdate=!0,g}return Object(h.a)(n)}(Ir);Wu.prototype.isCanvasTexture=!0;var Vu=function(){function e(){Object(A.a)(this,e),this.type="Curve",this.arcLengthDivisions=200}return Object(h.a)(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),a=0;n.push(0);for(var i=1;i<=e;i++)a+=(t=this.getPoint(i/e)).distanceTo(r),n.push(a),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),a=0,i=r.length;n=t||e*r[i-1];for(var o,s=0,c=i-1;s<=c;)if((o=r[a=Math.floor(s+(c-s)/2)]-n)<0)s=a+1;else{if(!(o>0)){c=a;break}c=a-1}if(r[a=c]===n)return a/(i-1);var u=r[a];return(a+(n-u)/(r[a+1]-u))/(i-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,r=e-n,a=e+n;r<0&&(r=0),a>1&&(a=1);var i=this.getPoint(r),o=this.getPoint(a),s=t||(i.isVector2?new Kn:new yr);return s.copy(o).sub(i).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new yr,r=[],a=[],i=[],o=new yr,s=new $r,c=0;c<=e;c++){var u=c/e;r[c]=this.getTangentAt(u,new yr)}a[0]=new yr,i[0]=new yr;var l=Number.MAX_VALUE,g=Math.abs(r[0].x),d=Math.abs(r[0].y),I=Math.abs(r[0].z);g<=l&&(l=g,n.set(1,0,0)),d<=l&&(l=d,n.set(0,1,0)),I<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],o),i[0].crossVectors(r[0],a[0]);for(var A=1;A<=e;A++){if(a[A]=a[A-1].clone(),i[A]=i[A-1].clone(),o.crossVectors(r[A-1],r[A]),o.length()>Number.EPSILON){o.normalize();var h=Math.acos(Hn(r[A-1].dot(r[A]),-1,1));a[A].applyMatrix4(s.makeRotationAxis(o,h))}i[A].crossVectors(r[A],a[A])}if(!0===t){var C=Math.acos(Hn(a[0].dot(a[e]),-1,1));C/=e,r[0].dot(o.crossVectors(a[0],a[e]))>0&&(C=-C);for(var f=1;f<=e;f++)a[f].applyMatrix4(s.makeRotationAxis(r[f],C*f)),i[f].crossVectors(r[f],a[f])}return{tangents:r,normals:a,binormals:i}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),Fu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return Object(A.a)(this,n),(e=t.call(this)).type="EllipseCurve",e.aX=r,e.aY=a,e.xRadius=i,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=c,e.aClockwise=u,e.aRotation=l,e}return Object(h.a)(n,[{key:"getPoint",value:function(e,t){for(var n=t||new Kn,r=2*Math.PI,a=this.aEndAngle-this.aStartAngle,i=Math.abs(a)<Number.EPSILON;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(a=i?0:r),!0!==this.aClockwise||i||(a===r?a=-r:a-=r);var o=this.aStartAngle+e*a,s=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),g=s-this.aX,d=c-this.aY;s=g*u-d*l+this.aX,c=g*l+d*u+this.aY}return n.set(s,c)}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(Vu);Fu.prototype.isEllipseCurve=!0;var Xu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i,o,s){var c;return Object(A.a)(this,n),(c=t.call(this,e,r,a,a,i,o,s)).type="ArcCurve",c}return Object(h.a)(n)}(Fu);function Hu(){var e=0,t=0,n=0,r=0;function a(a,i,o,s){e=a,t=o,n=-3*a+3*i-2*o-s,r=2*a-2*i+o+s}return{initCatmullRom:function(e,t,n,r,i){a(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,o,s){var c=(t-e)/i-(n-e)/(i+o)+(n-t)/o,u=(n-t)/o-(r-t)/(o+s)+(r-n)/s;a(t,n,c*=o,u*=o)},calc:function(a){var i=a*a;return e+t*a+n*i+r*(i*a)}}}Xu.prototype.isArcCurve=!0;var Ou=new yr,Lu=new Hu,Nu=new Hu,Yu=new Hu,Tu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return Object(A.a)(this,n),(e=t.call(this)).type="CatmullRomCurve3",e.points=r,e.closed=a,e.curveType=i,e.tension=o,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,a=r,i=this.points,o=i.length,s=(o-(this.closed?0:1))*e,c=Math.floor(s),u=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/o)+1)*o:0===u&&c===o-1&&(c=o-2,u=1),this.closed||c>0?t=i[(c-1)%o]:(Ou.subVectors(i[0],i[1]).add(i[0]),t=Ou);var l=i[c%o],g=i[(c+1)%o];if(this.closed||c+2<o?n=i[(c+2)%o]:(Ou.subVectors(i[o-1],i[o-2]).add(i[o-1]),n=Ou),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,I=Math.pow(t.distanceToSquared(l),d),A=Math.pow(l.distanceToSquared(g),d),h=Math.pow(g.distanceToSquared(n),d);A<1e-4&&(A=1),I<1e-4&&(I=A),h<1e-4&&(h=A),Lu.initNonuniformCatmullRom(t.x,l.x,g.x,n.x,I,A,h),Nu.initNonuniformCatmullRom(t.y,l.y,g.y,n.y,I,A,h),Yu.initNonuniformCatmullRom(t.z,l.z,g.z,n.z,I,A,h)}else"catmullrom"===this.curveType&&(Lu.initCatmullRom(t.x,l.x,g.x,n.x,this.tension),Nu.initCatmullRom(t.y,l.y,g.y,n.y,this.tension),Yu.initCatmullRom(t.z,l.z,g.z,n.z,this.tension));return a.set(Lu.calc(u),Nu.calc(u),Yu.calc(u)),a}},{key:"copy",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new yr).fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(Vu);function zu(e,t,n,r,a){var i=.5*(r-t),o=.5*(a-n),s=e*e;return(2*n-2*r+i+o)*(e*s)+(-3*n+3*r-2*i-o)*s+i*e+n}function Ku(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function ju(e,t,n,r,a){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,a)}Tu.prototype.isCatmullRomCurve3=!0;var Du=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Kn;return Object(A.a)(this,n),(e=t.call(this)).type="CubicBezierCurve",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=t,r=this.v0,a=this.v1,i=this.v2,o=this.v3;return n.set(ju(e,r.x,a.x,i.x,o.x),ju(e,r.y,a.y,i.y,o.y)),n}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(Vu);Du.prototype.isCubicBezierCurve=!0;var Uu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yr,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new yr;return Object(A.a)(this,n),(e=t.call(this)).type="CubicBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,n=t,r=this.v0,a=this.v1,i=this.v2,o=this.v3;return n.set(ju(e,r.x,a.x,i.x,o.x),ju(e,r.y,a.y,i.y,o.y),ju(e,r.z,a.z,i.z,o.z)),n}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(Vu);Uu.prototype.isCubicBezierCurve3=!0;var Qu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn;return Object(A.a)(this,n),(e=t.call(this)).type="LineCurve",e.v1=r,e.v2=a,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new Kn;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Vu);Qu.prototype.isLineCurve=!0;var Pu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr;return Object(A.a)(this,n),(e=t.call(this)).type="LineCurve3",e.isLineCurve3=!0,e.v1=r,e.v2=a,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Vu),Ju=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kn;return Object(A.a)(this,n),(e=t.call(this)).type="QuadraticBezierCurve",e.v0=r,e.v1=a,e.v2=i,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(Ku(e,r.x,a.x,i.x),Ku(e,r.y,a.y,i.y)),n}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Vu);Ju.prototype.isQuadraticBezierCurve=!0;var qu=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yr;return Object(A.a)(this,n),(e=t.call(this)).type="QuadraticBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr,n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(Ku(e,r.x,a.x,i.x),Ku(e,r.y,a.y,i.y),Ku(e,r.z,a.z,i.z)),n}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Vu);qu.prototype.isQuadraticBezierCurve3=!0;var $u=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(A.a)(this,n),(e=t.call(this)).type="SplineCurve",e.points=r,e}return Object(h.a)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=t,r=this.points,a=(r.length-1)*e,i=Math.floor(a),o=a-i,s=r[0===i?i:i-1],c=r[i],u=r[i>r.length-2?r.length-1:i+1],l=r[i>r.length-3?r.length-1:i+2];return n.set(zu(o,s.x,c.x,u.x,l.x),zu(o,s.y,c.y,u.y,l.y)),n}},{key:"copy",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e}},{key:"fromJSON",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new Kn).fromArray(a))}return this}}]),n}(Vu);$u.prototype.isSplineCurve=!0;var el=Object.freeze({__proto__:null,ArcCurve:Xu,CatmullRomCurve3:Tu,CubicBezierCurve:Du,CubicBezierCurve3:Uu,EllipseCurve:Fu,LineCurve:Qu,LineCurve3:Pu,QuadraticBezierCurve:Ju,QuadraticBezierCurve3:qu,SplineCurve:$u}),tl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return Object(h.a)(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Qu(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),a=0;a<r.length;){if(r[a]>=n){var i=r[a]-n,o=this.curves[a],s=o.getLength(),c=0===s?0:1-i/s;return o.getPointAt(c,t)}a++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,a=this.curves;r<a.length;r++)for(var i=a[r],o=i.isEllipseCurve?2*t:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?t*i.points.length:t,s=i.getPoints(o),c=0;c<s.length;c++){var u=s[c];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var a=this.curves[t];e.curves.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push((new el[a.type]).fromJSON(a))}return this}}]),n}(Vu),nl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="Path",r.currentPoint=new Kn,e&&r.setFromPoints(e),r}return Object(h.a)(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Qu(this.currentPoint.clone(),new Kn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var a=new Ju(this.currentPoint.clone(),new Kn(e,t),new Kn(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){var o=new Du(this.currentPoint.clone(),new Kn(e,t),new Kn(n,r),new Kn(a,i));return this.curves.push(o),this.currentPoint.set(a,i),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new $u(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,a,i){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,a,i),this}},{key:"absarc",value:function(e,t,n,r,a,i){return this.absellipse(e,t,n,n,r,a,i),this}},{key:"ellipse",value:function(e,t,n,r,a,i,o,s){var c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,a,i,o,s),this}},{key:"absellipse",value:function(e,t,n,r,a,i,o,s){var c=new Fu(e,t,n,r,a,i,o,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);return this.currentPoint.copy(l),this}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(tl),rl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Kn(0,.5),new Kn(.5,0),new Kn(0,-.5)],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:r,segments:a,phiStart:i,phiLength:o},a=Math.floor(a),o=Hn(o,0,2*Math.PI);for(var s=[],c=[],u=[],l=[],g=[],d=1/a,I=new yr,h=new Kn,C=new yr,f=new yr,p=new yr,m=0,v=0,b=0;b<=r.length-1;b++)switch(b){case 0:m=r[b+1].x-r[b].x,v=r[b+1].y-r[b].y,C.x=1*v,C.y=-m,C.z=0*v,p.copy(C),C.normalize(),l.push(C.x,C.y,C.z);break;case r.length-1:l.push(p.x,p.y,p.z);break;default:m=r[b+1].x-r[b].x,v=r[b+1].y-r[b].y,C.x=1*v,C.y=-m,C.z=0*v,f.copy(C),C.x+=p.x,C.y+=p.y,C.z+=p.z,C.normalize(),l.push(C.x,C.y,C.z),p.copy(f)}for(var y=0;y<=a;y++)for(var B=i+y*d*o,G=Math.sin(B),w=Math.cos(B),_=0;_<=r.length-1;_++){I.x=r[_].x*G,I.y=r[_].y,I.z=r[_].x*w,c.push(I.x,I.y,I.z),h.x=y/a,h.y=_/(r.length-1),u.push(h.x,h.y);var Z=l[3*_+0]*G,S=l[3*_+1],x=l[3*_+0]*w;g.push(Z,S,x)}for(var R=0;R<a;R++)for(var M=0;M<r.length-1;M++){var k=M+R*r.length,E=k,W=k+r.length,V=k+r.length+1,F=k+1;s.push(E,W,F),s.push(V,F,W)}return e.setIndex(s),e.setAttribute("position",new Pa(c,3)),e.setAttribute("uv",new Pa(u,2)),e.setAttribute("normal",new Pa(g,3)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(ii),al=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;Object(A.a)(this,n);var s=new nl;return s.absarc(0,-a/2,r,1.5*Math.PI,0),s.absarc(0,a/2,r,0,.5*Math.PI),(e=t.call(this,s.getPoints(i),o)).type="CapsuleGeometry",e.parameters={radius:r,height:a,capSegments:i,radialSegments:o},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(rl),il=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:r,segments:a,thetaStart:i,thetaLength:o},a=Math.max(3,a);var s=[],c=[],u=[],l=[],g=new yr,d=new Kn;c.push(0,0,0),u.push(0,0,1),l.push(.5,.5);for(var I=0,h=3;I<=a;I++,h+=3){var C=i+I/a*o;g.x=r*Math.cos(C),g.y=r*Math.sin(C),c.push(g.x,g.y,g.z),u.push(0,0,1),d.x=(c[h]/r+1)/2,d.y=(c[h+1]/r+1)/2,l.push(d.x,d.y)}for(var f=1;f<=a;f++)s.push(f,f+1,0);return e.setIndex(s),e.setAttribute("position",new Pa(c,3)),e.setAttribute("normal",new Pa(u,3)),e.setAttribute("uv",new Pa(l,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(ii),ol=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:r,radiusBottom:a,height:i,radialSegments:o,heightSegments:s,openEnded:c,thetaStart:u,thetaLength:g};var d=Object(l.a)(e);o=Math.floor(o),s=Math.floor(s);var I=[],h=[],C=[],f=[],p=0,m=[],v=i/2,b=0;function y(){for(var e=new yr,t=new yr,n=0,c=(a-r)/i,l=0;l<=s;l++){for(var A=[],y=l/s,B=y*(a-r)+r,G=0;G<=o;G++){var w=G/o,_=w*g+u,Z=Math.sin(_),S=Math.cos(_);t.x=B*Z,t.y=-y*i+v,t.z=B*S,h.push(t.x,t.y,t.z),e.set(Z,c,S).normalize(),C.push(e.x,e.y,e.z),f.push(w,1-y),A.push(p++)}m.push(A)}for(var x=0;x<o;x++)for(var R=0;R<s;R++){var M=m[R][x],k=m[R+1][x],E=m[R+1][x+1],W=m[R][x+1];I.push(M,k,W),I.push(k,E,W),n+=6}d.addGroup(b,n,0),b+=n}function B(e){for(var t=p,n=new Kn,i=new yr,s=0,c=!0===e?r:a,l=!0===e?1:-1,A=1;A<=o;A++)h.push(0,v*l,0),C.push(0,l,0),f.push(.5,.5),p++;for(var m=p,y=0;y<=o;y++){var B=y/o*g+u,G=Math.cos(B),w=Math.sin(B);i.x=c*w,i.y=v*l,i.z=c*G,h.push(i.x,i.y,i.z),C.push(0,l,0),n.x=.5*G+.5,n.y=.5*w*l+.5,f.push(n.x,n.y),p++}for(var _=0;_<o;_++){var Z=t+_,S=m+_;!0===e?I.push(S,S+1,Z):I.push(S+1,S,Z),s+=3}d.addGroup(b,s,!0===e?1:2),b+=s}return y(),!1===c&&(r>0&&B(!0),a>0&&B(!1)),e.setIndex(I),e.setAttribute("position",new Pa(h,3)),e.setAttribute("normal",new Pa(C,3)),e.setAttribute("uv",new Pa(f,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(ii),sl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return Object(A.a)(this,n),(e=t.call(this,0,r,a,i,o,s,c,u)).type="ConeGeometry",e.parameters={radius:r,height:a,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:c,thetaLength:u},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(ol),cl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(A.a)(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:r,indices:a,radius:i,detail:o};var s=[],c=[];function u(e){for(var t=new yr,n=new yr,r=new yr,i=0;i<a.length;i+=3)C(a[i+0],t),C(a[i+1],n),C(a[i+2],r),l(t,n,r,e)}function l(e,t,n,r){for(var a=r+1,i=[],o=0;o<=a;o++){i[o]=[];for(var s=e.clone().lerp(n,o/a),c=t.clone().lerp(n,o/a),u=a-o,l=0;l<=u;l++)i[o][l]=0===l&&o===a?s:s.clone().lerp(c,l/u)}for(var g=0;g<a;g++)for(var d=0;d<2*(a-g)-1;d++){var I=Math.floor(d/2);d%2===0?(h(i[g][I+1]),h(i[g+1][I]),h(i[g][I])):(h(i[g][I+1]),h(i[g+1][I+1]),h(i[g+1][I]))}}function g(e){for(var t=new yr,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}function d(){for(var e=new yr,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=m(e)/2/Math.PI+.5,r=v(e)/Math.PI+.5;c.push(n,1-r)}f(),I()}function I(){for(var e=0;e<c.length;e+=6){var t=c[e+0],n=c[e+2],r=c[e+4],a=Math.max(t,n,r),i=Math.min(t,n,r);a>.9&&i<.1&&(t<.2&&(c[e+0]+=1),n<.2&&(c[e+2]+=1),r<.2&&(c[e+4]+=1))}}function h(e){s.push(e.x,e.y,e.z)}function C(e,t){var n=3*e;t.x=r[n+0],t.y=r[n+1],t.z=r[n+2]}function f(){for(var e=new yr,t=new yr,n=new yr,r=new yr,a=new Kn,i=new Kn,o=new Kn,u=0,l=0;u<s.length;u+=9,l+=6){e.set(s[u+0],s[u+1],s[u+2]),t.set(s[u+3],s[u+4],s[u+5]),n.set(s[u+6],s[u+7],s[u+8]),a.set(c[l+0],c[l+1]),i.set(c[l+2],c[l+3]),o.set(c[l+4],c[l+5]),r.copy(e).add(t).add(n).divideScalar(3);var g=m(r);p(a,l+0,e,g),p(i,l+2,t,g),p(o,l+4,n,g)}}function p(e,t,n,r){r<0&&1===e.x&&(c[t]=e.x-1),0===n.x&&0===n.z&&(c[t]=r/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function v(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return u(o),g(i),d(),e.setAttribute("position",new Pa(s,3)),e.setAttribute("normal",new Pa(s.slice(),3)),e.setAttribute("uv",new Pa(c,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(ii),ul=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,n);var i=(1+Math.sqrt(5))/2,o=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],c=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];return(e=t.call(this,s,c,r,a)).type="DodecahedronGeometry",e.parameters={radius:r,detail:a},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(cl),ll=new yr,gl=new yr,dl=new yr,Il=new Va,Al=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Object(A.a)(this,n),(e=t.call(this)).type="EdgesGeometry",e.parameters={geometry:r,thresholdAngle:a},null!==r){for(var i=4,o=Math.pow(10,i),s=Math.cos(Vn*a),c=r.getIndex(),u=r.getAttribute("position"),l=c?c.count:u.count,g=[0,0,0],d=["a","b","c"],I=new Array(3),h={},C=[],f=0;f<l;f+=3){c?(g[0]=c.getX(f),g[1]=c.getX(f+1),g[2]=c.getX(f+2)):(g[0]=f,g[1]=f+1,g[2]=f+2);var p=Il.a,m=Il.b,v=Il.c;if(p.fromBufferAttribute(u,g[0]),m.fromBufferAttribute(u,g[1]),v.fromBufferAttribute(u,g[2]),Il.getNormal(dl),I[0]="".concat(Math.round(p.x*o),",").concat(Math.round(p.y*o),",").concat(Math.round(p.z*o)),I[1]="".concat(Math.round(m.x*o),",").concat(Math.round(m.y*o),",").concat(Math.round(m.z*o)),I[2]="".concat(Math.round(v.x*o),",").concat(Math.round(v.y*o),",").concat(Math.round(v.z*o)),I[0]!==I[1]&&I[1]!==I[2]&&I[2]!==I[0])for(var b=0;b<3;b++){var y=(b+1)%3,B=I[b],G=I[y],w=Il[d[b]],_=Il[d[y]],Z="".concat(B,"_").concat(G),S="".concat(G,"_").concat(B);S in h&&h[S]?(dl.dot(h[S].normal)<=s&&(C.push(w.x,w.y,w.z),C.push(_.x,_.y,_.z)),h[S]=null):Z in h||(h[Z]={index0:g[b],index1:g[y],normal:dl.clone()})}}for(var x in h)if(h[x]){var R=h[x],M=R.index0,k=R.index1;ll.fromBufferAttribute(u,M),gl.fromBufferAttribute(u,k),C.push(ll.x,ll.y,ll.z),C.push(gl.x,gl.y,gl.z)}e.setAttribute("position",new Pa(C,3))}return e}return Object(h.a)(n)}(ii),hl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).uuid=Xn(),r.type="Shape",r.holes=[],r}return Object(h.a)(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var a=this.holes[t];e.holes.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push((new nl).fromJSON(a))}return this}}]),n}(nl),Cl=function(e,t){var n,r,a,i,o,s,c,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=t&&t.length,g=l?t[0]*u:e.length,d=fl(e,0,g,u,!0),I=[];if(!d||d.next===d.prev)return I;if(l&&(d=Gl(e,t,d,u)),e.length>80*u){n=a=e[0],r=i=e[1];for(var A=u;A<g;A+=u)(o=e[A])<n&&(n=o),(s=e[A+1])<r&&(r=s),o>a&&(a=o),s>i&&(i=s);c=0!==(c=Math.max(a-n,i-r))?1/c:0}return ml(d,I,u,n,r,c),I};function fl(e,t,n,r,a){var i,o;if(a===function(e,t,n,r){for(var a=0,i=t,o=n-r;i<n;i+=r)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}(e,t,n,r)>0)for(i=t;i<n;i+=r)o=Ol(i,e[i],e[i+1],o);else for(i=n-r;i>=t;i-=r)o=Ol(i,e[i],e[i+1],o);return o&&El(o,o.next)&&(Ll(o),o=o.next),o}function pl(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!El(r,r.next)&&0!==kl(r.prev,r,r.next))r=r.next;else{if(Ll(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function ml(e,t,n,r,a,i,o){if(e){!o&&i&&function(e,t,n,r){var a=e;do{null===a.z&&(a.z=Sl(a.x,a.y,t,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,n,r,a,i,o,s,c,u=1;do{for(n=e,e=null,i=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(a=n,n=n.nextZ,s--):(a=r,r=r.nextZ,c--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;n=r}i.nextZ=null,u*=2}while(o>1)}(a)}(e,r,a,i);for(var s,c,u=e;e.prev!==e.next;)if(s=e.prev,c=e.next,i?bl(e,r,a,i):vl(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),Ll(e),e=c.next,u=c.next;else if((e=c)===u){o?1===o?ml(e=yl(pl(e),t,n),t,n,r,a,i,2):2===o&&Bl(e,t,n,r,a,i):ml(pl(e),t,n,r,a,i,1);break}}}function vl(e){var t=e.prev,n=e,r=e.next;if(kl(t,n,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(Rl(t.x,t.y,n.x,n.y,r.x,r.y,a.x,a.y)&&kl(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function bl(e,t,n,r){var a=e.prev,i=e,o=e.next;if(kl(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,c=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,u=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,l=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,g=Sl(s,c,t,n,r),d=Sl(u,l,t,n,r),I=e.prevZ,A=e.nextZ;I&&I.z>=g&&A&&A.z<=d;){if(I!==e.prev&&I!==e.next&&Rl(a.x,a.y,i.x,i.y,o.x,o.y,I.x,I.y)&&kl(I.prev,I,I.next)>=0)return!1;if(I=I.prevZ,A!==e.prev&&A!==e.next&&Rl(a.x,a.y,i.x,i.y,o.x,o.y,A.x,A.y)&&kl(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;I&&I.z>=g;){if(I!==e.prev&&I!==e.next&&Rl(a.x,a.y,i.x,i.y,o.x,o.y,I.x,I.y)&&kl(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;A&&A.z<=d;){if(A!==e.prev&&A!==e.next&&Rl(a.x,a.y,i.x,i.y,o.x,o.y,A.x,A.y)&&kl(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function yl(e,t,n){var r=e;do{var a=r.prev,i=r.next.next;!El(a,i)&&Wl(a,r,r.next,i)&&Xl(a,i)&&Xl(i,a)&&(t.push(a.i/n),t.push(r.i/n),t.push(i.i/n),Ll(r),Ll(r.next),r=e=i),r=r.next}while(r!==e);return pl(r)}function Bl(e,t,n,r,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Ml(o,s)){var c=Hl(o,s);return o=pl(o,o.next),c=pl(c,c.next),ml(o,t,n,r,a,i),void ml(c,t,n,r,a,i)}s=s.next}o=o.next}while(o!==e)}function Gl(e,t,n,r){var a,i,o,s=[];for(a=0,i=t.length;a<i;a++)(o=fl(e,t[a]*r,a<i-1?t[a+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(xl(o));for(s.sort(wl),a=0;a<s.length;a++)_l(s[a],n),n=pl(n,n.next);return n}function wl(e,t){return e.x-t.x}function _l(e,t){if(t=function(e,t){var n,r=t,a=e.x,i=e.y,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=a&&s>o){if(o=s,s===a){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(a===o)return n;var c,u=n,l=n.x,g=n.y,d=1/0;r=n;do{a>=r.x&&r.x>=l&&a!==r.x&&Rl(i<g?a:o,i,l,g,i<g?o:a,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(a-r.x),Xl(r,e)&&(c<d||c===d&&(r.x>n.x||r.x===n.x&&Zl(n,r)))&&(n=r,d=c)),r=r.next}while(r!==u);return n}(e,t),t){var n=Hl(t,e);pl(t,t.next),pl(n,n.next)}}function Zl(e,t){return kl(e.prev,e,t.prev)<0&&kl(t.next,e,e.next)<0}function Sl(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xl(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rl(e,t,n,r,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(i-s)-(a-o)*(r-s)>=0}function Ml(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Wl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Xl(e,t)&&Xl(t,e)&&function(e,t){var n=e,r=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!==n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(kl(e.prev,e,t.prev)||kl(e,t.prev,t))||El(e,t)&&kl(e.prev,e,e.next)>0&&kl(t.prev,t,t.next)>0)}function kl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function El(e,t){return e.x===t.x&&e.y===t.y}function Wl(e,t,n,r){var a=Fl(kl(e,t,n)),i=Fl(kl(e,t,r)),o=Fl(kl(n,r,e)),s=Fl(kl(n,r,t));return a!==i&&o!==s||(!(0!==a||!Vl(e,n,t))||(!(0!==i||!Vl(e,r,t))||(!(0!==o||!Vl(n,e,r))||!(0!==s||!Vl(n,t,r)))))}function Vl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Fl(e){return e>0?1:e<0?-1:0}function Xl(e,t){return kl(e.prev,e,e.next)<0?kl(e,t,e.next)>=0&&kl(e,e.prev,t)>=0:kl(e,t,e.prev)<0||kl(e,e.next,t)<0}function Hl(e,t){var n=new Nl(e.i,e.x,e.y),r=new Nl(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function Ol(e,t,n,r){var a=new Nl(e,t,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function Ll(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Yl=function(){function e(){Object(A.a)(this,e)}return Object(h.a)(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,a=0;a<t;r=a++)n+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],a=[];Tl(e),zl(n,e);var i=e.length;t.forEach(Tl);for(var o=0;o<t.length;o++)r.push(i),i+=t[o].length,zl(n,t[o]);for(var s=Cl(n,r),c=0;c<s.length;c+=3)a.push(s.slice(c,c+3));return a}}]),e}();function Tl(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function zl(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Kl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hl([new Kn(.5,.5),new Kn(-.5,.5),new Kn(-.5,-.5),new Kn(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(A.a)(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:r,options:a},r=Array.isArray(r)?r:[r];for(var i=Object(l.a)(e),o=[],s=[],c=0,u=r.length;c<u;c++){var g=r[c];d(g)}function d(e){var t=[],n=void 0!==a.curveSegments?a.curveSegments:12,r=void 0!==a.steps?a.steps:1,c=void 0!==a.depth?a.depth:1,u=void 0===a.bevelEnabled||a.bevelEnabled,l=void 0!==a.bevelThickness?a.bevelThickness:.2,g=void 0!==a.bevelSize?a.bevelSize:l-.1,d=void 0!==a.bevelOffset?a.bevelOffset:0,I=void 0!==a.bevelSegments?a.bevelSegments:3,A=a.extrudePath,h=void 0!==a.UVGenerator?a.UVGenerator:jl;void 0!==a.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=a.amount);var C,f,p,m,v,b=!1;A&&(C=A.getSpacedPoints(r),b=!0,u=!1,f=A.computeFrenetFrames(r,!1),p=new yr,m=new yr,v=new yr),u||(I=0,l=0,g=0,d=0);var y=e.extractPoints(n),B=y.shape,G=y.holes;if(!Yl.isClockWise(B)){B=B.reverse();for(var w=0,_=G.length;w<_;w++){var Z=G[w];Yl.isClockWise(Z)&&(G[w]=Z.reverse())}}for(var S=Yl.triangulateShape(B,G),x=B,R=0,M=G.length;R<M;R++){var k=G[R];B=B.concat(k)}function E(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var W=B.length,V=S.length;function F(e,t,n){var r,a,i,o=e.x-t.x,s=e.y-t.y,c=n.x-e.x,u=n.y-e.y,l=o*o+s*s,g=o*u-s*c;if(Math.abs(g)>Number.EPSILON){var d=Math.sqrt(l),I=Math.sqrt(c*c+u*u),A=t.x-s/d,h=t.y+o/d,C=((n.x-u/I-A)*u-(n.y+c/I-h)*c)/(o*u-s*c),f=(r=A+o*C-e.x)*r+(a=h+s*C-e.y)*a;if(f<=2)return new Kn(r,a);i=Math.sqrt(f/2)}else{var p=!1;o>Number.EPSILON?c>Number.EPSILON&&(p=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(p=!0):Math.sign(s)===Math.sign(u)&&(p=!0),p?(r=-s,a=o,i=Math.sqrt(l)):(r=o,a=s,i=Math.sqrt(l/2))}return new Kn(r/i,a/i)}for(var X=[],H=0,O=x.length,L=O-1,N=H+1;H<O;H++,L++,N++)L===O&&(L=0),N===O&&(N=0),X[H]=F(x[H],x[L],x[N]);for(var Y,T=[],z=X.concat(),K=0,j=G.length;K<j;K++){var D=G[K];Y=[];for(var U=0,Q=D.length,P=Q-1,J=U+1;U<Q;U++,P++,J++)P===Q&&(P=0),J===Q&&(J=0),Y[U]=F(D[U],D[P],D[J]);T.push(Y),z=z.concat(Y)}for(var q=0;q<I;q++){for(var $=q/I,ee=l*Math.cos($*Math.PI/2),te=g*Math.sin($*Math.PI/2)+d,ne=0,re=x.length;ne<re;ne++){var ae=E(x[ne],X[ne],te);Me(ae.x,ae.y,-ee)}for(var ie=0,oe=G.length;ie<oe;ie++){var se=G[ie];Y=T[ie];for(var ce=0,ue=se.length;ce<ue;ce++){var le=E(se[ce],Y[ce],te);Me(le.x,le.y,-ee)}}}for(var ge=g+d,de=0;de<W;de++){var Ie=u?E(B[de],z[de],ge):B[de];b?(m.copy(f.normals[0]).multiplyScalar(Ie.x),p.copy(f.binormals[0]).multiplyScalar(Ie.y),v.copy(C[0]).add(m).add(p),Me(v.x,v.y,v.z)):Me(Ie.x,Ie.y,0)}for(var Ae=1;Ae<=r;Ae++)for(var he=0;he<W;he++){var Ce=u?E(B[he],z[he],ge):B[he];b?(m.copy(f.normals[Ae]).multiplyScalar(Ce.x),p.copy(f.binormals[Ae]).multiplyScalar(Ce.y),v.copy(C[Ae]).add(m).add(p),Me(v.x,v.y,v.z)):Me(Ce.x,Ce.y,c/r*Ae)}for(var fe=I-1;fe>=0;fe--){for(var pe=fe/I,me=l*Math.cos(pe*Math.PI/2),ve=g*Math.sin(pe*Math.PI/2)+d,be=0,ye=x.length;be<ye;be++){var Be=E(x[be],X[be],ve);Me(Be.x,Be.y,c+me)}for(var Ge=0,we=G.length;Ge<we;Ge++){var _e=G[Ge];Y=T[Ge];for(var Ze=0,Se=_e.length;Ze<Se;Ze++){var xe=E(_e[Ze],Y[Ze],ve);b?Me(xe.x,xe.y+C[r-1].y,C[r-1].x+me):Me(xe.x,xe.y,c+me)}}}function Re(e,t){for(var n=e.length;--n>=0;){var a=n,i=n-1;i<0&&(i=e.length-1);for(var o=0,s=r+2*I;o<s;o++){var c=W*o,u=W*(o+1);Ee(t+a+c,t+i+c,t+i+u,t+a+u)}}}function Me(e,n,r){t.push(e),t.push(n),t.push(r)}function ke(e,t,n){We(e),We(t),We(n);var r=o.length/3,a=h.generateTopUV(i,o,r-3,r-2,r-1);Ve(a[0]),Ve(a[1]),Ve(a[2])}function Ee(e,t,n,r){We(e),We(t),We(r),We(t),We(n),We(r);var a=o.length/3,s=h.generateSideWallUV(i,o,a-6,a-3,a-2,a-1);Ve(s[0]),Ve(s[1]),Ve(s[3]),Ve(s[1]),Ve(s[2]),Ve(s[3])}function We(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Ve(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(u){for(var t=0,n=W*t,a=0;a<V;a++){var s=S[a];ke(s[2]+n,s[1]+n,s[0]+n)}n=W*(t=r+2*I);for(var c=0;c<V;c++){var l=S[c];ke(l[0]+n,l[1]+n,l[2]+n)}}else{for(var g=0;g<V;g++){var d=S[g];ke(d[2],d[1],d[0])}for(var A=0;A<V;A++){var h=S[A];ke(h[0]+W*r,h[1]+W*r,h[2]+W*r)}}i.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Re(x,t),t+=x.length;for(var n=0,r=G.length;n<r;n++){var a=G[n];Re(a,t),t+=a.length}i.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new Pa(o,3)),e.setAttribute("uv",new Pa(s,2)),e.computeVertexNormals(),e}return Object(h.a)(n,[{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,a=e.length;r<a;r++){var i=e[r];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new el[s.type]).fromJSON(s)),new n(r,e.options)}}]),n}(ii),jl={generateTopUV:function(e,t,n,r,a){var i=t[3*n],o=t[3*n+1],s=t[3*r],c=t[3*r+1],u=t[3*a],l=t[3*a+1];return[new Kn(i,o),new Kn(s,c),new Kn(u,l)]},generateSideWallUV:function(e,t,n,r,a,i){var o=t[3*n],s=t[3*n+1],c=t[3*n+2],u=t[3*r],l=t[3*r+1],g=t[3*r+2],d=t[3*a],I=t[3*a+1],A=t[3*a+2],h=t[3*i],C=t[3*i+1],f=t[3*i+2];return Math.abs(s-l)<Math.abs(o-u)?[new Kn(o,1-c),new Kn(u,1-g),new Kn(d,1-A),new Kn(h,1-f)]:[new Kn(s,1-c),new Kn(l,1-g),new Kn(I,1-A),new Kn(C,1-f)]}};var Dl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,n);var i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];return(e=t.call(this,o,s,r,a)).type="IcosahedronGeometry",e.parameters={radius:r,detail:a},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(cl),Ul=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,n);var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];return(e=t.call(this,i,o,r,a)).type="OctahedronGeometry",e.parameters={radius:r,detail:a},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(cl),Ql=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:r,outerRadius:a,thetaSegments:i,phiSegments:o,thetaStart:s,thetaLength:c},i=Math.max(3,i);for(var u=[],l=[],g=[],d=[],I=r,h=(a-r)/(o=Math.max(1,o)),C=new yr,f=new Kn,p=0;p<=o;p++){for(var m=0;m<=i;m++){var v=s+m/i*c;C.x=I*Math.cos(v),C.y=I*Math.sin(v),l.push(C.x,C.y,C.z),g.push(0,0,1),f.x=(C.x/a+1)/2,f.y=(C.y/a+1)/2,d.push(f.x,f.y)}I+=h}for(var b=0;b<o;b++)for(var y=b*(i+1),B=0;B<i;B++){var G=B+y,w=G,_=G+i+1,Z=G+i+2,S=G+1;u.push(w,_,S),u.push(_,Z,S)}return e.setIndex(u),e.setAttribute("position",new Pa(l,3)),e.setAttribute("normal",new Pa(g,3)),e.setAttribute("uv",new Pa(d,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(ii),Pl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hl([new Kn(0,.5),new Kn(-.5,-.5),new Kn(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Object(A.a)(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:r,curveSegments:a};var i=[],o=[],s=[],c=[],u=0,l=0;if(!1===Array.isArray(r))d(r);else for(var g=0;g<r.length;g++)d(r[g]),e.addGroup(u,l,g),u+=l,l=0;function d(e){var t=o.length/3,n=e.extractPoints(a),r=n.shape,u=n.holes;!1===Yl.isClockWise(r)&&(r=r.reverse());for(var g=0,d=u.length;g<d;g++){var I=u[g];!0===Yl.isClockWise(I)&&(u[g]=I.reverse())}for(var A=Yl.triangulateShape(r,u),h=0,C=u.length;h<C;h++){var f=u[h];r=r.concat(f)}for(var p=0,m=r.length;p<m;p++){var v=r[p];o.push(v.x,v.y,0),s.push(0,0,1),c.push(v.x,v.y)}for(var b=0,y=A.length;b<y;b++){var B=A[b],G=B[0]+t,w=B[1]+t,_=B[2]+t;i.push(G,w,_),l+=3}}return e.setIndex(i),e.setAttribute("position",new Pa(o,3)),e.setAttribute("normal",new Pa(s,3)),e.setAttribute("uv",new Pa(c,2)),e}return Object(h.a)(n,[{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}return new n(r,e.curveSegments)}}]),n}(ii);var Jl=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:r,widthSegments:a,heightSegments:i,phiStart:o,phiLength:s,thetaStart:c,thetaLength:u},a=Math.max(3,Math.floor(a)),i=Math.max(2,Math.floor(i));for(var l=Math.min(c+u,Math.PI),g=0,d=[],I=new yr,h=new yr,C=[],f=[],p=[],m=[],v=0;v<=i;v++){var b=[],y=v/i,B=0;0==v&&0==c?B=.5/a:v==i&&l==Math.PI&&(B=-.5/a);for(var G=0;G<=a;G++){var w=G/a;I.x=-r*Math.cos(o+w*s)*Math.sin(c+y*u),I.y=r*Math.cos(c+y*u),I.z=r*Math.sin(o+w*s)*Math.sin(c+y*u),f.push(I.x,I.y,I.z),h.copy(I).normalize(),p.push(h.x,h.y,h.z),m.push(w+B,1-y),b.push(g++)}d.push(b)}for(var _=0;_<i;_++)for(var Z=0;Z<a;Z++){var S=d[_][Z+1],x=d[_][Z],R=d[_+1][Z],M=d[_+1][Z+1];(0!==_||c>0)&&C.push(S,x,M),(_!==i-1||l<Math.PI)&&C.push(x,R,M)}return e.setIndex(C),e.setAttribute("position",new Pa(f,3)),e.setAttribute("normal",new Pa(p,3)),e.setAttribute("uv",new Pa(m,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(ii),ql=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(A.a)(this,n);var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];return(e=t.call(this,i,o,r,a)).type="TetrahedronGeometry",e.parameters={radius:r,detail:a},e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(cl),$l=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;Object(A.a)(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:r,tube:a,radialSegments:i,tubularSegments:o,arc:s},i=Math.floor(i),o=Math.floor(o);for(var c=[],u=[],l=[],g=[],d=new yr,I=new yr,h=new yr,C=0;C<=i;C++)for(var f=0;f<=o;f++){var p=f/o*s,m=C/i*Math.PI*2;I.x=(r+a*Math.cos(m))*Math.cos(p),I.y=(r+a*Math.cos(m))*Math.sin(p),I.z=a*Math.sin(m),u.push(I.x,I.y,I.z),d.x=r*Math.cos(p),d.y=r*Math.sin(p),h.subVectors(I,d).normalize(),l.push(h.x,h.y,h.z),g.push(f/o),g.push(C/i)}for(var v=1;v<=i;v++)for(var b=1;b<=o;b++){var y=(o+1)*v+b-1,B=(o+1)*(v-1)+b-1,G=(o+1)*(v-1)+b,w=(o+1)*v+b;c.push(y,B,w),c.push(B,G,w)}return e.setIndex(c),e.setAttribute("position",new Pa(u,3)),e.setAttribute("normal",new Pa(l,3)),e.setAttribute("uv",new Pa(g,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(ii),eg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;Object(A.a)(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:r,tube:a,tubularSegments:i,radialSegments:o,p:s,q:c},i=Math.floor(i),o=Math.floor(o);for(var u=[],l=[],g=[],d=[],I=new yr,h=new yr,C=new yr,f=new yr,p=new yr,m=new yr,v=new yr,b=0;b<=i;++b){var y=b/i*s*Math.PI*2;E(y,s,c,r,C),E(y+.01,s,c,r,f),m.subVectors(f,C),v.addVectors(f,C),p.crossVectors(m,v),v.crossVectors(p,m),p.normalize(),v.normalize();for(var B=0;B<=o;++B){var G=B/o*Math.PI*2,w=-a*Math.cos(G),_=a*Math.sin(G);I.x=C.x+(w*v.x+_*p.x),I.y=C.y+(w*v.y+_*p.y),I.z=C.z+(w*v.z+_*p.z),l.push(I.x,I.y,I.z),h.subVectors(I,C).normalize(),g.push(h.x,h.y,h.z),d.push(b/i),d.push(B/o)}}for(var Z=1;Z<=i;Z++)for(var S=1;S<=o;S++){var x=(o+1)*(Z-1)+(S-1),R=(o+1)*Z+(S-1),M=(o+1)*Z+S,k=(o+1)*(Z-1)+S;u.push(x,R,k),u.push(R,M,k)}function E(e,t,n,r,a){var i=Math.cos(e),o=Math.sin(e),s=n/t*e,c=Math.cos(s);a.x=r*(2+c)*.5*i,a.y=r*(2+c)*o*.5,a.z=r*Math.sin(s)*.5}return e.setIndex(u),e.setAttribute("position",new Pa(l,3)),e.setAttribute("normal",new Pa(g,3)),e.setAttribute("uv",new Pa(d,2)),e}return Object(h.a)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(ii),tg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new qu(new yr(-1,-1,0),new yr(-1,1,0),new yr(1,1,0)),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(A.a)(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:r,tubularSegments:a,radius:i,radialSegments:o,closed:s};var c=r.computeFrenetFrames(a,s);e.tangents=c.tangents,e.normals=c.normals,e.binormals=c.binormals;var u=new yr,l=new yr,g=new Kn,d=new yr,I=[],h=[],C=[],f=[];function p(){for(var e=0;e<a;e++)m(e);m(!1===s?a:0),b(),v()}function m(e){d=r.getPointAt(e/a,d);for(var t=c.normals[e],n=c.binormals[e],s=0;s<=o;s++){var g=s/o*Math.PI*2,A=Math.sin(g),C=-Math.cos(g);l.x=C*t.x+A*n.x,l.y=C*t.y+A*n.y,l.z=C*t.z+A*n.z,l.normalize(),h.push(l.x,l.y,l.z),u.x=d.x+i*l.x,u.y=d.y+i*l.y,u.z=d.z+i*l.z,I.push(u.x,u.y,u.z)}}function v(){for(var e=1;e<=a;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),r=(o+1)*e+(t-1),i=(o+1)*e+t,s=(o+1)*(e-1)+t;f.push(n,r,s),f.push(r,i,s)}}function b(){for(var e=0;e<=a;e++)for(var t=0;t<=o;t++)g.x=e/a,g.y=t/o,C.push(g.x,g.y)}return p(),e.setIndex(f),e.setAttribute("position",new Pa(I,3)),e.setAttribute("normal",new Pa(h,3)),e.setAttribute("uv",new Pa(C,2)),e}return Object(h.a)(n,[{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new el[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(ii),ng=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(Object(A.a)(this,n),(e=t.call(this)).type="WireframeGeometry",e.parameters={geometry:r},null!==r){var a=[],i=new Set,o=new yr,s=new yr;if(null!==r.index){var c=r.attributes.position,u=r.index,l=r.groups;0===l.length&&(l=[{start:0,count:u.count,materialIndex:0}]);for(var g=0,d=l.length;g<d;++g)for(var I=l[g],h=I.start,C=I.count,f=h,p=h+C;f<p;f+=3)for(var m=0;m<3;m++){var v=u.getX(f+m),b=u.getX(f+(m+1)%3);o.fromBufferAttribute(c,v),s.fromBufferAttribute(c,b),!0===rg(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}}else for(var y=r.attributes.position,B=0,G=y.count/3;B<G;B++)for(var w=0;w<3;w++){var _=3*B+w,Z=3*B+(w+1)%3;o.fromBufferAttribute(y,_),s.fromBufferAttribute(y,Z),!0===rg(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}e.setAttribute("position",new Pa(a,3))}return e}return Object(h.a)(n)}(ii);function rg(e,t,n){var r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),a="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(r)&&!0!==n.has(a)&&(n.add(r),n.add(a),!0)}var ag=Object.freeze({__proto__:null,BoxGeometry:wi,BoxBufferGeometry:wi,CapsuleGeometry:al,CapsuleBufferGeometry:al,CircleGeometry:il,CircleBufferGeometry:il,ConeGeometry:sl,ConeBufferGeometry:sl,CylinderGeometry:ol,CylinderBufferGeometry:ol,DodecahedronGeometry:ul,DodecahedronBufferGeometry:ul,EdgesGeometry:Al,ExtrudeGeometry:Kl,ExtrudeBufferGeometry:Kl,IcosahedronGeometry:Dl,IcosahedronBufferGeometry:Dl,LatheGeometry:rl,LatheBufferGeometry:rl,OctahedronGeometry:Ul,OctahedronBufferGeometry:Ul,PlaneGeometry:Ki,PlaneBufferGeometry:Ki,PolyhedronGeometry:cl,PolyhedronBufferGeometry:cl,RingGeometry:Ql,RingBufferGeometry:Ql,ShapeGeometry:Pl,ShapeBufferGeometry:Pl,SphereGeometry:Jl,SphereBufferGeometry:Jl,TetrahedronGeometry:ql,TetrahedronBufferGeometry:ql,TorusGeometry:$l,TorusBufferGeometry:$l,TorusKnotGeometry:eg,TorusKnotBufferGeometry:eg,TubeGeometry:tg,TubeBufferGeometry:tg,WireframeGeometry:ng}),ig=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="ShadowMaterial",r.color=new cr(0),r.transparent=!0,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this}}]),n}(Xa);ig.prototype.isShadowMaterial=!0;var og=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).type="RawShaderMaterial",r}return Object(h.a)(n)}(xi);og.prototype.isRawShaderMaterial=!0;var sg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).defines={STANDARD:""},r.type="MeshStandardMaterial",r.color=new cr(16777215),r.roughness=1,r.metalness=0,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new cr(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Jt,r.normalScale=new Kn(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.roughnessMap=null,r.metalnessMap=null,r.alphaMap=null,r.envMap=null,r.envMapIntensity=1,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(Xa);sg.prototype.isMeshStandardMaterial=!0;var cg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).defines={STANDARD:"",PHYSICAL:""},r.type="MeshPhysicalMaterial",r.clearcoatMap=null,r.clearcoatRoughness=0,r.clearcoatRoughnessMap=null,r.clearcoatNormalScale=new Kn(1,1),r.clearcoatNormalMap=null,r.ior=1.5,Object.defineProperty(Object(l.a)(r),"reflectivity",{get:function(){return Hn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),r.sheenColor=new cr(0),r.sheenColorMap=null,r.sheenRoughness=1,r.sheenRoughnessMap=null,r.transmissionMap=null,r.thickness=0,r.thicknessMap=null,r.attenuationDistance=0,r.attenuationColor=new cr(1,1,1),r.specularIntensity=1,r.specularIntensityMap=null,r.specularColor=new cr(1,1,1),r.specularColorMap=null,r._sheen=0,r._clearcoat=0,r._transmission=0,r.setValues(e),r}return Object(h.a)(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(sg);cg.prototype.isMeshPhysicalMaterial=!0;var ug=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshPhongMaterial",r.color=new cr(16777215),r.specular=new cr(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new cr(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Jt,r.normalScale=new Kn(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=le,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(Xa);ug.prototype.isMeshPhongMaterial=!0;var lg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).defines={TOON:""},r.type="MeshToonMaterial",r.color=new cr(16777215),r.map=null,r.gradientMap=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new cr(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Jt,r.normalScale=new Kn(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Xa);lg.prototype.isMeshToonMaterial=!0;var gg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshNormalMaterial",r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Jt,r.normalScale=new Kn(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.flatShading=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(Xa);gg.prototype.isMeshNormalMaterial=!0;var dg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="MeshLambertMaterial",r.color=new cr(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new cr(0),r.emissiveIntensity=1,r.emissiveMap=null,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=le,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Xa);dg.prototype.isMeshLambertMaterial=!0;var Ig=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).defines={MATCAP:""},r.type="MeshMatcapMaterial",r.color=new cr(16777215),r.matcap=null,r.map=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Jt,r.normalScale=new Kn(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.flatShading=!1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}]),n}(Xa);Ig.prototype.isMeshMatcapMaterial=!0;var Ag=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="LineDashedMaterial",r.scale=1,r.dashSize=3,r.gapSize=1,r.setValues(e),r}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(Iu);Ag.prototype.isLineDashedMaterial=!0;var hg={ShadowMaterial:ig,SpriteMaterial:kc,RawShaderMaterial:og,ShaderMaterial:xi,PointsMaterial:Gu,MeshPhysicalMaterial:cg,MeshStandardMaterial:sg,MeshPhongMaterial:ug,MeshToonMaterial:lg,MeshNormalMaterial:gg,MeshLambertMaterial:dg,MeshDepthMaterial:uc,MeshDistanceMaterial:lc,MeshBasicMaterial:Ha,MeshMatcapMaterial:Ig,LineDashedMaterial:Ag,LineBasicMaterial:Iu,Material:Xa};Xa.fromType=function(e){return new hg[e]};var Cg={arraySlice:function(e,t,n){return Cg.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,a=new e.constructor(r),i=0,o=0;o!==r;++i)for(var s=n[i]*t,c=0;c!==t;++c)a[o++]=e[s+c];return a},flattenJSON:function(e,t,n,r){for(var a=1,i=e[0];void 0!==i&&void 0===i[r];)i=e[a++];if(void 0!==i){var o=i[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=i[r])&&(t.push(i.time),n.push.apply(n,o)),i=e[a++]}while(void 0!==i);else if(void 0!==o.toArray)do{void 0!==(o=i[r])&&(t.push(i.time),o.toArray(n,n.length)),i=e[a++]}while(void 0!==i);else do{void 0!==(o=i[r])&&(t.push(i.time),n.push(o)),i=e[a++]}while(void 0!==i)}},subclip:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,i=e.clone();i.name=t;for(var o=[],s=0;s<i.tracks.length;++s){for(var c=i.tracks[s],u=c.getValueSize(),l=[],g=[],d=0;d<c.times.length;++d){var I=c.times[d]*a;if(!(I<n||I>=r)){l.push(c.times[d]);for(var A=0;A<u;++A)g.push(c.values[d*u+A])}}0!==l.length&&(c.times=Cg.convertArray(l,c.times.constructor),c.values=Cg.convertArray(g,c.values.constructor),o.push(c))}i.tracks=o;for(var h=1/0,C=0;C<i.tracks.length;++C)h>i.tracks[C].times[0]&&(h=i.tracks[C].times[0]);for(var f=0;f<i.tracks.length;++f)i.tracks[f].shift(-1*h);return i.resetDuration(),i},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var a=n.tracks.length,i=t/r,o=function(t){var r=n.tracks[t],a=r.ValueTypeName;if("bool"===a||"string"===a)return"continue";var o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===a}));if(void 0===o)return"continue";var s=0,c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=c/3);var u=0,l=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=l/3);var g=r.times.length-1,d=void 0;if(i<=r.times[0]){var I=s,A=c-s;d=Cg.arraySlice(r.values,I,A)}else if(i>=r.times[g]){var h=g*c+s,C=h+c-s;d=Cg.arraySlice(r.values,h,C)}else{var f=r.createInterpolant(),p=s,m=c-s;f.evaluate(i),d=Cg.arraySlice(f.resultBuffer,p,m)}"quaternion"===a&&(new br).fromArray(d).normalize().conjugate().toArray(d);for(var v=o.times.length,b=0;b<v;++b){var y=b*l+u;if("quaternion"===a)br.multiplyQuaternionsFlat(o.values,y,d,0,o.values,y);else for(var B=l-2*u,G=0;G<B;++G)o.values[y+G]-=d[G]}},s=0;s<a;++s)o(s);return e.blendMode=Tt,e}},fg=function(){function e(t,n,r,a){Object(A.a)(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return Object(h.a)(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{var i;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,a)}if(n===o)break;if(a=r,e<(r=t[++n]))break t}i=t.length;break n}if(e>=a)break e;var s=t[1];e<s&&(n=2,a=s);for(var c=n-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===c)break;if(r=a,e>=(a=t[--n-1]))break t}i=n,n=0}for(;n<i;){var u=n+i>>>1;e<t[u]?i=u:n=u+1}if(r=t[n],void 0===(a=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,a,e)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r,i=0;i!==r;++i)t[i]=n[a+i];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}();fg.prototype.beforeStart_=fg.prototype.copySampleValue_,fg.prototype.afterEnd_=fg.prototype.copySampleValue_;var pg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){var o;return Object(A.a)(this,n),(o=t.call(this,e,r,a,i))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:Ot,endingEnd:Ot},o}return Object(h.a)(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,a=e-2,i=e+1,o=r[a],s=r[i];if(void 0===o)switch(this.getSettings_().endingStart){case Lt:a=e,o=2*t-n;break;case Nt:o=t+r[a=r.length-2]-r[a+1];break;default:a=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Lt:i=e,s=2*n-t;break;case Nt:i=1,s=n+r[1]-r[0];break;default:i=e-1,s=t}var c=.5*(n-t),u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(s-n),this._offsetPrev=a*u,this._offsetNext=i*u}},{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=this._offsetPrev,l=this._offsetNext,g=this._weightPrev,d=this._weightNext,I=(n-t)/(r-t),A=I*I,h=A*I,C=-g*h+2*g*A-g*I,f=(1+g)*h+(-1.5-2*g)*A+(-.5+g)*I+1,p=(-1-d)*h+(1.5+d)*A+.5*I,m=d*h-d*A,v=0;v!==o;++v)a[v]=C*i[u+v]+f*i[c+v]+p*i[s+v]+m*i[l+v];return a}}]),n}(fg),mg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){return Object(A.a)(this,n),t.call(this,e,r,a,i)}return Object(h.a)(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=(n-t)/(r-t),l=1-u,g=0;g!==o;++g)a[g]=i[c+g]*l+i[s+g]*u;return a}}]),n}(fg),vg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){return Object(A.a)(this,n),t.call(this,e,r,a,i)}return Object(h.a)(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(fg),bg=function(){function e(t,n,r,a){if(Object(A.a)(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Cg.convertArray(n,this.TimeBufferType),this.values=Cg.convertArray(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return Object(h.a)(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new vg(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new mg(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new pg(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case Ft:t=this.InterpolantFactoryMethodDiscrete;break;case Xt:t=this.InterpolantFactoryMethodLinear;break;case Ht:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ft;case this.InterpolantFactoryMethodLinear:return Xt;case this.InterpolantFactoryMethodSmooth:return Ht}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,a=0,i=r-1;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(a=(i=Math.max(i,1))-1);var o=this.getValueSize();this.times=Cg.arraySlice(n,a,i),this.values=Cg.arraySlice(this.values,a*o,i*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var i=null,o=0;o!==a;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==i&&i>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,i),e=!1;break}i=s}if(void 0!==r&&Cg.isTypedArray(r))for(var c=0,u=r.length;c!==u;++c){var l=r[c];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,l),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Cg.arraySlice(this.times),t=Cg.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Ht,a=e.length-1,i=1,o=1;o<a;++o){var s=!1,c=e[o];if(c!==e[o+1]&&(1!==o||c!==e[0]))if(r)s=!0;else for(var u=o*n,l=u-n,g=u+n,d=0;d!==n;++d){var I=t[u+d];if(I!==t[l+d]||I!==t[g+d]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var A=o*n,h=i*n,C=0;C!==n;++C)t[h+C]=t[A+C]}++i}}if(a>0){e[i]=e[a];for(var f=a*n,p=i*n,m=0;m!==n;++m)t[p+m]=t[f+m];++i}return i!==e.length?(this.times=Cg.arraySlice(e,0,i),this.values=Cg.arraySlice(t,0,i*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Cg.arraySlice(this.times,0),t=Cg.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Cg.convertArray(e.times,Array),values:Cg.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();bg.prototype.TimeBufferType=Float32Array,bg.prototype.ValueBufferType=Float32Array,bg.prototype.DefaultInterpolation=Xt;var yg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(bg);yg.prototype.ValueTypeName="bool",yg.prototype.ValueBufferType=Array,yg.prototype.DefaultInterpolation=Ft,yg.prototype.InterpolantFactoryMethodLinear=void 0,yg.prototype.InterpolantFactoryMethodSmooth=void 0;var Bg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(bg);Bg.prototype.ValueTypeName="color";var Gg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(bg);Gg.prototype.ValueTypeName="number";var wg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){return Object(A.a)(this,n),t.call(this,e,r,a,i)}return Object(h.a)(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),c=e*o,u=c+o;c!==u;c+=4)br.slerpFlat(a,0,i,c-o,i,c,s);return a}}]),n}(fg),_g=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new wg(this.times,this.values,this.getValueSize(),e)}}]),n}(bg);_g.prototype.ValueTypeName="quaternion",_g.prototype.DefaultInterpolation=Xt,_g.prototype.InterpolantFactoryMethodSmooth=void 0;var Zg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(bg);Zg.prototype.ValueTypeName="string",Zg.prototype.ValueBufferType=Array,Zg.prototype.DefaultInterpolation=Ft,Zg.prototype.InterpolantFactoryMethodLinear=void 0,Zg.prototype.InterpolantFactoryMethodSmooth=void 0;var Sg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(bg);Sg.prototype.ValueTypeName="vector";var xg=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Yt;Object(A.a)(this,e),this.name=t,this.tracks=r,this.duration=n,this.blendMode=a,this.uuid=Xn(),this.duration<0&&this.resetDuration()}return Object(h.a)(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),a=0,i=n.length;a!==i;++a)t.push(Rg(n[a]).scale(r));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},a=0,i=n.length;a!==i;++a)t.push(bg.toJSON(n[a]));return r}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,r){for(var a=t.length,i=[],o=0;o<a;o++){var s=[],c=[];s.push((o+a-1)%a,o,(o+1)%a),c.push(0,1,0);var u=Cg.getKeyframeOrder(s);s=Cg.sortedArray(s,1,u),c=Cg.sortedArray(c,1,u),r||0!==s[0]||(s.push(a),c.push(c[0])),i.push(new Gg(".morphTargetInfluences["+t[o].name+"]",s,c).scale(1/n))}return new this(e,-1,i)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var r={},a=/^([\w-]*?)([\d]+)$/,i=0,o=e.length;i<o;i++){var s=e[i],c=s.name.match(a);if(c&&c.length>1){var u=c[1],l=r[u];l||(r[u]=l=[]),l.push(s)}}var g=[];for(var d in r)g.push(this.CreateFromMorphTargetSequence(d,r[d],t,n));return g}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,a){if(0!==n.length){var i=[],o=[];Cg.flattenJSON(n,i,o,r),0!==i.length&&a.push(new e(t,i,o))}},r=[],a=e.name||"default",i=e.fps||30,o=e.blendMode,s=e.length||-1,c=e.hierarchy||[],u=0;u<c.length;u++){var l=c[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){var g={},d=void 0;for(d=0;d<l.length;d++)if(l[d].morphTargets)for(var I=0;I<l[d].morphTargets.length;I++)g[l[d].morphTargets[I]]=-1;for(var A in g){for(var h=[],C=[],f=0;f!==l[d].morphTargets.length;++f){var p=l[d];h.push(p.time),C.push(p.morphTarget===A?1:0)}r.push(new Gg(".morphTargetInfluence["+A+"]",h,C))}s=g.length*i}else{var m=".bones["+t[u].name+"]";n(Sg,m+".position",l,"pos",r),n(_g,m+".quaternion",l,"rot",r),n(Sg,m+".scale",l,"scl",r)}}return 0===r.length?null:new this(a,s,r,o)}}]),e}();function Rg(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gg;case"vector":case"vector2":case"vector3":case"vector4":return Sg;case"color":return Bg;case"quaternion":return _g;case"bool":case"boolean":return yg;case"string":return Zg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Cg.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Mg={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},kg=Object(h.a)((function e(t,n,r){Object(A.a)(this,e);var a=this,i=!1,o=0,s=0,c=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==a.onStart&&a.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==a.onProgress&&a.onProgress(e,o,s),o===s&&(i=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return c?c(e):e},this.setURLModifier=function(e){return c=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=u.length;t<n;t+=2){var r=u[t],a=u[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return a}return null}})),Eg=new kg,Wg=function(){function e(t){Object(A.a)(this,e),this.manager=void 0!==t?t:Eg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return Object(h.a)(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,a){n.load(e,r,t,a)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),Vg={},Fg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=Mg.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;if(void 0===Vg[e]){Vg[e]=[],Vg[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,c=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=Vg[e],r=t.body.getReader(),a=t.headers.get("Content-Length"),i=a?parseInt(a):0,o=0!==i,s=0,c=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var a=r.done,c=r.value;if(a)e.close();else{s+=c.byteLength;for(var u=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:i}),l=0,g=n.length;l<g;l++){var d=n[l];d.onProgress&&d.onProgress(u)}e.enqueue(c),t()}}))}()}});return new Response(c)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(c){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){Mg.add(e,t);var n=Vg[e];delete Vg[e];for(var r=0,a=n.length;r<a;r++){var i=n[r];i.onLoad&&i.onLoad(t)}})).catch((function(t){var n=Vg[e];if(void 0===n)throw a.manager.itemError(e),t;delete Vg[e];for(var r=0,i=n.length;r<i;r++){var o=n[r];o.onError&&o.onError(t)}a.manager.itemError(e)})).finally((function(){a.manager.itemEnd(e)})),this.manager.itemStart(e)}else Vg[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(Wg),Xg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new Fg(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(eA){r?r(eA):console.error(eA),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=xg.parse(e[n]);t.push(r)}return t}}]),n}(Wg),Hg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=[],o=new Eu,s=new Fg(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(a.withCredentials);var c=0;function u(u){s.load(e[u],(function(e){var n=a.parse(e,!0);i[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapCount&&(o.minFilter=Ee),o.image=i,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(var l=0,g=e.length;l<g;++l)u(l);else s.load(e,(function(e){var n=a.parse(e,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){i[s]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)i[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+c]),i[s].format=n.format,i[s].width=n.width,i[s].height=n.height}o.image=i}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Ee),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}]),n}(Wg),Og=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=Mg.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o=Pn("img");function s(){u(),Mg.add(e,this),t&&t(this),a.manager.itemEnd(e)}function c(t){u(),r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}]),n}(Wg),Lg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=new Wi,i=new Og(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var o=0;function s(n){i.load(e[n],(function(e){a.images[n]=e,6===++o&&(a.needsUpdate=!0,t&&t(a))}),void 0,r)}for(var c=0;c<e.length;++c)s(c);return a}}]),n}(Wg),Ng=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new ru,o=new Fg(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(a.withCredentials),o.load(e,(function(e){var n=a.parse(e);n&&(void 0!==n.image?i.image=n.image:void 0!==n.data&&(i.image.width=n.width,i.image.height=n.height,i.image.data=n.data),i.wrapS=void 0!==n.wrapS?n.wrapS:_e,i.wrapT=void 0!==n.wrapT?n.wrapT:_e,i.magFilter=void 0!==n.magFilter?n.magFilter:Ee,i.minFilter=void 0!==n.minFilter?n.minFilter:Ee,i.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(i.encoding=n.encoding),void 0!==n.flipY&&(i.flipY=n.flipY),void 0!==n.format&&(i.format=n.format),void 0!==n.type&&(i.type=n.type),void 0!==n.mipmaps&&(i.mipmaps=n.mipmaps,i.minFilter=Fe),1===n.mipmapCount&&(i.minFilter=Ee),void 0!==n.generateMipmaps&&(i.generateMipmaps=n.generateMipmaps),i.needsUpdate=!0,t&&t(i,n))}),n,r),i}}]),n}(Wg),Yg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=new Ir,i=new Og(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,(function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)}),n,r),a}}]),n}(Wg),Tg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(A.a)(this,n),(r=t.call(this)).type="Light",r.color=new cr(e),r.intensity=a,r}return Object(h.a)(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Ga);Tg.prototype.isLight=!0;var zg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),(i=t.call(this,e,a)).type="HemisphereLight",i.position.copy(Ga.DefaultUp),i.updateMatrix(),i.groundColor=new cr(r),i}return Object(h.a)(n,[{key:"copy",value:function(e){return Tg.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}]),n}(Tg);zg.prototype.isHemisphereLight=!0;var Kg=new $r,jg=new yr,Dg=new yr,Ug=function(){function e(t){Object(A.a)(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Kn(512,512),this.map=null,this.mapPass=null,this.matrix=new $r,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Yi,this._frameExtents=new Kn(1,1),this._viewportCount=1,this._viewports=[new Ar(0,0,1,1)]}return Object(h.a)(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;jg.setFromMatrixPosition(e.matrixWorld),t.position.copy(jg),Dg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Dg),t.updateMatrixWorld(),Kg.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kg),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Qg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this,new Mi(50,1,.5,500))).focus=1,e}return Object(h.a)(n,[{key:"updateMatrices",value:function(e){var t=this.camera,r=2*Fn*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&a===t.aspect&&i===t.far||(t.fov=r,t.aspect=a,t.far=i,t.updateProjectionMatrix()),Object(c.a)(Object(u.a)(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(Ug);Qg.prototype.isSpotLightShadow=!0;var Pg=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="SpotLight",a.position.copy(Ga.DefaultUp),a.updateMatrix(),a.target=new Ga,a.distance=i,a.angle=o,a.penumbra=s,a.decay=c,a.shadow=new Qg,a}return Object(h.a)(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Tg);Pg.prototype.isSpotLight=!0;var Jg=new $r,qg=new yr,$g=new yr,ed=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this,new Mi(90,1,.5,500)))._frameExtents=new Kn(4,2),e._viewportCount=6,e._viewports=[new Ar(2,1,1,1),new Ar(0,1,1,1),new Ar(3,1,1,1),new Ar(1,1,1,1),new Ar(3,0,1,1),new Ar(1,0,1,1)],e._cubeDirections=[new yr(1,0,0),new yr(-1,0,0),new yr(0,0,1),new yr(0,0,-1),new yr(0,1,0),new yr(0,-1,0)],e._cubeUps=[new yr(0,1,0),new yr(0,1,0),new yr(0,1,0),new yr(0,1,0),new yr(0,0,1),new yr(0,0,-1)],e}return Object(h.a)(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),qg.setFromMatrixPosition(e.matrixWorld),n.position.copy(qg),$g.copy(n.position),$g.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt($g),n.updateMatrixWorld(),r.makeTranslation(-qg.x,-qg.y,-qg.z),Jg.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jg)}}]),n}(Ug);ed.prototype.isPointLightShadow=!0;var td=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="PointLight",a.distance=i,a.decay=o,a.shadow=new ed,a}return Object(h.a)(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Tg);td.prototype.isPointLight=!0;var nd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),t.call(this,new to(-5,5,5,-5,.5,500))}return Object(h.a)(n)}(Ug);nd.prototype.isDirectionalLightShadow=!0;var rd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="DirectionalLight",a.position.copy(Ga.DefaultUp),a.updateMatrix(),a.target=new Ga,a.shadow=new nd,a}return Object(h.a)(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Tg);rd.prototype.isDirectionalLight=!0;var ad=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="AmbientLight",a}return Object(h.a)(n)}(Tg);ad.prototype.isAmbientLight=!0;var id=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return Object(A.a)(this,n),(a=t.call(this,e,r)).type="RectAreaLight",a.width=i,a.height=o,a}return Object(h.a)(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(Tg);id.prototype.isRectAreaLight=!0;var od=function(){function e(){Object(A.a)(this,e),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new yr)}return Object(h.a)(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*r),t.addScaledVector(i[2],.488603*a),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*r*1.092548),t.addScaledVector(i[5],r*a*1.092548),t.addScaledVector(i[6],.315392*(3*a*a-1)),t.addScaledVector(i[7],n*a*1.092548),t.addScaledVector(i[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*r),t.addScaledVector(i[2],1.023328*a),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*r),t.addScaledVector(i[5],.858086*r*a),t.addScaledVector(i[6],.743125*a*a-.247708),t.addScaledVector(i[7],.858086*n*a),t.addScaledVector(i[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-r*r)}}]),e}();od.prototype.isSphericalHarmonics3=!0;var sd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new od,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(A.a)(this,n),(e=t.call(this,void 0,a)).sh=r,e}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(Tg);sd.prototype.isLightProbe=!0;var cd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).textures={},r}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new Fg(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(eA){r?r(eA):console.error(eA),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=Xa.fromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new cr).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var a in e.uniforms){var i=e.uniforms[a];switch(r.uniforms[a]={},i.type){case"t":r.uniforms[a].value=n(i.value);break;case"c":r.uniforms[a].value=(new cr).setHex(i.value);break;case"v2":r.uniforms[a].value=(new Kn).fromArray(i.value);break;case"v3":r.uniforms[a].value=(new yr).fromArray(i.value);break;case"v4":r.uniforms[a].value=(new Ar).fromArray(i.value);break;case"m3":r.uniforms[a].value=(new jn).fromArray(i.value);break;case"m4":r.uniforms[a].value=(new $r).fromArray(i.value);break;default:r.uniforms[a].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)r.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Kn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Kn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}},{key:"setTextures",value:function(e){return this.textures=e,this}}]),n}(Wg),ud=function(){function e(){Object(A.a)(this,e)}return Object(h.a)(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(eA){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),ld=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="InstancedBufferGeometry",e.instanceCount=1/0,e}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(ii);ld.prototype.isInstancedBufferGeometry=!0;var gd,dd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new Fg(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(eA){r?r(eA):console.error(eA),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var a=e.interleavedBuffers[r],i=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],a=new Uint32Array(r).buffer;return n[t]=a,a}(e,a.buffer),o=Qn(a.type,i),s=new Sc(o,a.stride);return s.uuid=a.uuid,t[r]=s,s}var a=e.isInstancedBufferGeometry?new ld:new ii,i=e.data.index;if(void 0!==i){var o=Qn(i.type,i.array);a.setIndex(new Na(o,1))}var s=e.data.attributes;for(var c in s){var u=s[c],l=void 0;if(u.isInterleavedBufferAttribute){var g=r(e.data,u.data);l=new Rc(g,u.itemSize,u.offset,u.normalized)}else{var d=Qn(u.type,u.array);l=new(u.isInstancedBufferAttribute?su:Na)(d,u.itemSize,u.normalized)}void 0!==u.name&&(l.name=u.name),void 0!==u.usage&&l.setUsage(u.usage),void 0!==u.updateRange&&(l.updateRange.offset=u.updateRange.offset,l.updateRange.count=u.updateRange.count),a.setAttribute(c,l)}var I=e.data.morphAttributes;if(I)for(var A in I){for(var h=I[A],C=[],f=0,p=h.length;f<p;f++){var m=h[f],v=void 0;if(m.isInterleavedBufferAttribute){var b=r(e.data,m.data);v=new Rc(b,m.itemSize,m.offset,m.normalized)}else{var y=Qn(m.type,m.array);v=new Na(y,m.itemSize,m.normalized)}void 0!==m.name&&(v.name=m.name),C.push(v)}a.morphAttributes[A]=C}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);var B=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==B)for(var G=0,w=B.length;G!==w;++G){var _=B[G];a.addGroup(_.start,_.count,_.materialIndex)}var Z=e.data.boundingSphere;if(void 0!==Z){var S=new yr;void 0!==Z.center&&S.fromArray(Z.center),a.boundingSphere=new zr(S,Z.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}]),n}(Wg),Id=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=""===this.path?ud.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;var o=new Fg(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var i=null;try{i=JSON.parse(n)}catch(s){return void 0!==r&&r(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=i.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?a.parse(i,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}},{key:"loadAsync",value:function(){var e=Object(a.a)(f.a.mark((function e(t,n){var r,a,i,o,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=""===this.path?ud.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||a,(i=new Fg(this.manager)).setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),e.next=9,i.loadAsync(t,n);case 9:if(o=e.sent,s=JSON.parse(o),void 0!==(c=s.metadata)&&void 0!==c.type&&"geometry"!==c.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,r.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,a,s,o,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),void 0!==t){var l=!1;for(var g in i)if(i[g]instanceof HTMLImageElement){l=!0;break}!1===l&&t(c)}return c}},{key:"parseAsync",value:function(){var e=Object(a.a)(f.a.mark((function e(t){var n,r,a,i,o,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),a=this.parseGeometries(t.geometries,r),e.next=5,this.parseImagesAsync(t.images);case 5:return i=e.sent,o=this.parseTextures(t.textures,i),s=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,a,s,o,n),u=this.parseSkeletons(t.skeletons,c),this.bindSkeletons(c,u),e.abrupt("return",c);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var a=(new hl).fromJSON(e[n]);t[a.uuid]=a}return t}},{key:"parseSkeletons",value:function(e,t){var n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=(new ou).fromJSON(e[a],r);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n={};if(void 0!==e)for(var r=new dd,a=0,i=e.length;a<i;a++){var o=void 0,s=e[a];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in ag?o=ag[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n}},{key:"parseMaterials",value:function(e,t){var n={},r={};if(void 0!==e){var a=new cd;a.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];if("MultiMaterial"===s.type){for(var c=[],u=0;u<s.materials.length;u++){var l=s.materials[u];void 0===n[l.uuid]&&(n[l.uuid]=a.parse(l)),c.push(n[l.uuid])}r[s.uuid]=c}else void 0===n[s.uuid]&&(n[s.uuid]=a.parse(s)),r[s.uuid]=n[s.uuid]}}return r}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var r=e[n],a=xg.parse(r);t[a.uuid]=a}return t}},{key:"parseImages",value:function(e,t){var n,r=this,a={};function i(e){if("string"===typeof e){var t=e;return function(e){return r.manager.itemStart(e),n.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:Qn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new kg(t);(n=new Og(o)).setCrossOrigin(this.crossOrigin);for(var s=0,c=e.length;s<c;s++){var u=e[s],l=u.url;if(Array.isArray(l)){for(var g=[],d=0,I=l.length;d<I;d++){var A=i(l[d]);null!==A&&(A instanceof HTMLImageElement?g.push(A):g.push(new ru(A.data,A.width,A.height)))}a[u.uuid]=new lr(g)}else{var h=i(u.url);a[u.uuid]=new lr(h)}}}return a}},{key:"parseImagesAsync",value:function(){var e=Object(a.a)(f.a.mark((function e(t){var n,r,i,o,s,c,u,l,g,d,I,A,h,C,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(){return s=Object(a.a)(f.a.mark((function e(t){var r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}return a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r=t)?r:n.resourcePath+r,e.next=5,i.loadAsync(a);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:Qn(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)},o=function(e){return s.apply(this,arguments)},n=this,r={},!(void 0!==t&&t.length>0)){e.next=33;break}(i=new Og(this.manager)).setCrossOrigin(this.crossOrigin),c=0,u=t.length;case 8:if(!(c<u)){e.next=33;break}if(l=t[c],g=l.url,!Array.isArray(g)){e.next=26;break}d=[],I=0,A=g.length;case 14:if(!(I<A)){e.next=23;break}return h=g[I],e.next=18,o(h);case 18:null!==(C=e.sent)&&(C instanceof HTMLImageElement?d.push(C):d.push(new ru(C.data,C.width,C.height)));case 20:I++,e.next=14;break;case 23:r[l.uuid]=new lr(d),e.next=30;break;case 26:return e.next=28,o(l.url);case 28:p=e.sent,r[l.uuid]=new lr(p);case 30:c++,e.next=8;break;case 33:return e.abrupt("return",r);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=e[a];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=t[o.image],c=s.data,u=void 0;Array.isArray(c)?(u=new Wi,6===c.length&&(u.needsUpdate=!0)):(u=c&&c.data?new ru:new Ir,c&&(u.needsUpdate=!0)),u.source=s,u.uuid=o.uuid,void 0!==o.name&&(u.name=o.name),void 0!==o.mapping&&(u.mapping=n(o.mapping,Ad)),void 0!==o.offset&&u.offset.fromArray(o.offset),void 0!==o.repeat&&u.repeat.fromArray(o.repeat),void 0!==o.center&&u.center.fromArray(o.center),void 0!==o.rotation&&(u.rotation=o.rotation),void 0!==o.wrap&&(u.wrapS=n(o.wrap[0],hd),u.wrapT=n(o.wrap[1],hd)),void 0!==o.format&&(u.format=o.format),void 0!==o.type&&(u.type=o.type),void 0!==o.encoding&&(u.encoding=o.encoding),void 0!==o.minFilter&&(u.minFilter=n(o.minFilter,Cd)),void 0!==o.magFilter&&(u.magFilter=n(o.magFilter,Cd)),void 0!==o.anisotropy&&(u.anisotropy=o.anisotropy),void 0!==o.flipY&&(u.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(u.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(u.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(u.userData=o.userData),r[o.uuid]=u}return r}},{key:"parseObject",value:function(e,t,n,r,a){var i,o,s;function c(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,a=e.length;r<a;r++){var i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":i=new Zc,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new cr(e.background):i.background=l(e.background)),void 0!==e.environment&&(i.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new _c(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new wc(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Mi(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new to(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new ad(e.color,e.intensity);break;case"DirectionalLight":i=new rd(e.color,e.intensity);break;case"PointLight":i=new td(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new id(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Pg(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new zg(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new sd).fromJSON(e);break;case"SkinnedMesh":o=c(e.geometry),s=u(e.material),i=new tu(o,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":o=c(e.geometry),s=u(e.material),i=new Bi(o,s);break;case"InstancedMesh":o=c(e.geometry),s=u(e.material);var g=e.count,d=e.instanceMatrix,I=e.instanceColor;(i=new du(o,s,g)).instanceMatrix=new su(new Float32Array(d.array),16),void 0!==I&&(i.instanceColor=new su(new Float32Array(I.array),I.itemSize));break;case"LOD":i=new Qc;break;case"Line":i=new mu(c(e.geometry),u(e.material));break;case"LineLoop":i=new Bu(c(e.geometry),u(e.material));break;case"LineSegments":i=new yu(c(e.geometry),u(e.material));break;case"PointCloud":case"Points":i=new xu(c(e.geometry),u(e.material));break;case"Sprite":i=new Kc(u(e.material));break;case"Group":i=new Cc;break;case"Bone":i=new nu;break;default:i=new Ga}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var A=e.children,h=0;h<A.length;h++)i.add(this.parseObject(A[h],t,n,r,a));if(void 0!==e.animations)for(var C=e.animations,f=0;f<C.length;f++){var p=C[f];i.animations.push(a[p])}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var m=e.levels,v=0;v<m.length;v++){var b=m[v],y=i.getObjectByProperty("uuid",b.object);void 0!==y&&i.addLevel(y,b.distance)}}return i}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}},{key:"setTexturePath",value:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}]),n}(Wg),Ad={UVMapping:me,CubeReflectionMapping:ve,CubeRefractionMapping:be,EquirectangularReflectionMapping:ye,EquirectangularRefractionMapping:Be,CubeUVReflectionMapping:Ge},hd={RepeatWrapping:we,ClampToEdgeWrapping:_e,MirroredRepeatWrapping:Ze},Cd={NearestFilter:Se,NearestMipmapNearestFilter:xe,NearestMipmapLinearFilter:Me,LinearFilter:Ee,LinearMipmapNearestFilter:We,LinearMipmapLinearFilter:Fe},fd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),r=t.call(this,e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),r.options={premultiplyAlpha:"none"},r}return Object(h.a)(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=Mg.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(a.options,{colorSpaceConversion:"none"}))})).then((function(n){Mg.add(e,n),t&&t(n),a.manager.itemEnd(e)})).catch((function(t){r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)})),a.manager.itemStart(e)}}]),n}(Wg);fd.prototype.isImageBitmapLoader=!0;var pd={getContext:function(){return void 0===gd&&(gd=new(window.AudioContext||window.webkitAudioContext)),gd},setContext:function(e){gd=e}},md=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),t.call(this,e)}return Object(h.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new Fg(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{var i=n.slice(0);pd.getContext().decodeAudioData(i,(function(e){t(e)}))}catch(eA){r?r(eA):console.error(eA),a.manager.itemError(e)}}),n,r)}}]),n}(Wg),vd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Object(A.a)(this,n),a=t.call(this,void 0,i);var o=(new cr).set(e),s=(new cr).set(r),c=new yr(o.r,o.g,o.b),u=new yr(s.r,s.g,s.b),l=Math.sqrt(Math.PI),g=l*Math.sqrt(.75);return a.sh.coefficients[0].copy(c).add(u).multiplyScalar(l),a.sh.coefficients[1].copy(c).sub(u).multiplyScalar(g),a}return Object(h.a)(n)}(sd);vd.prototype.isHemisphereLightProbe=!0;var bd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(A.a)(this,n),r=t.call(this,void 0,a);var i=(new cr).set(e);return r.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI)),r}return Object(h.a)(n)}(sd);bd.prototype.isAmbientLightProbe=!0;var yd=new $r,Bd=new $r,Gd=new $r,wd=function(){function e(){Object(A.a)(this,e),this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Mi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Mi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return Object(h.a)(e,[{key:"update",value:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Gd.copy(e.projectionMatrix);var n,r,a=t.eyeSep/2,i=a*t.near/t.focus,o=t.near*Math.tan(Vn*t.fov*.5)/t.zoom;Bd.elements[12]=-a,yd.elements[12]=a,n=-o*t.aspect+i,r=o*t.aspect+i,Gd.elements[0]=2*t.near/(r-n),Gd.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(Gd),n=-o*t.aspect-i,r=o*t.aspect-i,Gd.elements[0]=2*t.near/(r-n),Gd.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(Gd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Bd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(yd)}}]),e}(),_d=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(A.a)(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Object(h.a)(e,[{key:"start",value:function(){this.startTime=Zd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=Zd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function Zd(){return("undefined"===typeof performance?Date:performance).now()}var Sd=new yr,xd=new br,Rd=new yr,Md=new yr,kd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(A.a)(this,n),(e=t.call(this)).type="AudioListener",e.context=pd.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new _d,e}return Object(h.a)(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Sd,xd,Rd),Md.set(0,0,-1).applyQuaternion(xd),t.positionX){var a=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Sd.x,a),t.positionY.linearRampToValueAtTime(Sd.y,a),t.positionZ.linearRampToValueAtTime(Sd.z,a),t.forwardX.linearRampToValueAtTime(Md.x,a),t.forwardY.linearRampToValueAtTime(Md.y,a),t.forwardZ.linearRampToValueAtTime(Md.z,a),t.upX.linearRampToValueAtTime(r.x,a),t.upY.linearRampToValueAtTime(r.y,a),t.upZ.linearRampToValueAtTime(r.z,a)}else t.setPosition(Sd.x,Sd.y,Sd.z),t.setOrientation(Md.x,Md.y,Md.z,r.x,r.y,r.z)}}]),n}(Ga),Ed=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this)).type="Audio",r.listener=e,r.context=e.context,r.gain=r.context.createGain(),r.gain.connect(e.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}return Object(h.a)(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(Ga),Wd=new yr,Vd=new br,Fd=new yr,Xd=new yr,Hd=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).panner=r.context.createPanner(),r.panner.panningModel="HRTF",r.panner.connect(r.gain),r}return Object(h.a)(n,[{key:"disconnect",value:function(){Object(c.a)(Object(u.a)(n.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain)}},{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Wd,Vd,Fd),Xd.set(0,0,1).applyQuaternion(Vd);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Wd.x,r),t.positionY.linearRampToValueAtTime(Wd.y,r),t.positionZ.linearRampToValueAtTime(Wd.z,r),t.orientationX.linearRampToValueAtTime(Xd.x,r),t.orientationY.linearRampToValueAtTime(Xd.y,r),t.orientationZ.linearRampToValueAtTime(Xd.z,r)}else t.setPosition(Wd.x,Wd.y,Wd.z),t.setOrientation(Xd.x,Xd.y,Xd.z)}}}]),n}(Ed),Od=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;Object(A.a)(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Object(h.a)(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),Ld=function(){function e(t,n,r){var a,i,o;switch(Object(A.a)(this,e),this.binding=t,this.valueSize=r,n){case"quaternion":a=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":a=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:a=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return Object(h.a)(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,r=this.valueSize,a=e*r+r,i=this.cumulativeWeight;if(0===i){for(var o=0;o!==r;++o)n[a+o]=n[o];i=t}else{var s=t/(i+=t);this._mixBufferRegion(n,a,0,s,r)}this.cumulativeWeight=i}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,a=this.cumulativeWeight,i=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-a,t)}i>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){o.setValue(n,r);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var a=n,i=r;a!==i;++a)t[a]=t[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,r,a){if(r>=.5)for(var i=0;i!==a;++i)e[t+i]=e[n+i]}},{key:"_slerp",value:function(e,t,n,r){br.slerpFlat(e,t,e,t,e,n,r)}},{key:"_slerpAdditive",value:function(e,t,n,r,a){var i=this._workIndex*a;br.multiplyQuaternionsFlat(e,i,e,t,e,n),br.slerpFlat(e,t,e,t,e,i,r)}},{key:"_lerp",value:function(e,t,n,r,a){for(var i=1-r,o=0;o!==a;++o){var s=t+o;e[s]=e[s]*i+e[n+o]*r}}},{key:"_lerpAdditive",value:function(e,t,n,r,a){for(var i=0;i!==a;++i){var o=t+i;e[o]=e[o]+e[n+i]*r}}}]),e}(),Nd="\\[\\]\\.:\\/",Yd=new RegExp("[\\[\\]\\.:\\/]","g"),Td="[^\\[\\]\\.:\\/]",zd="[^"+Nd.replace("\\.","")+"]",Kd=/((?:WC+[\/:])*)/.source.replace("WC",Td),jd=/(WCOD+)?/.source.replace("WCOD",zd),Dd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Td),Ud=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Td),Qd=new RegExp("^"+Kd+jd+Dd+Ud+"$"),Pd=["material","materials","bones"],Jd=function(){function e(t,n,r){Object(A.a)(this,e);var a=r||qd.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,a)}return Object(h.a)(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),qd=function(){function e(t,n,r){Object(A.a)(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return Object(h.a)(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,a=n.propertyName,i=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var c=t[a];if(void 0!==c){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===a){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}l=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=i}else void 0!==c.fromArray&&void 0!==c.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(l=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=a;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else{var g=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+a+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Yd,"")}},{key:"parseTrackName",value:function(e){var t=Qd.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var a=n.nodeName.substring(r+1);-1!==Pd.indexOf(a)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t||a.uuid===t)return a;var i=e(a.children);if(i)return i}return null}(e.children);if(r)return r}return null}}]),e}();qd.Composite=Jd,qd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},qd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},qd.prototype.GetterByBindingType=[qd.prototype._getValue_direct,qd.prototype._getValue_array,qd.prototype._getValue_arrayElement,qd.prototype._getValue_toArray],qd.prototype.SetterByBindingTypeAndVersioning=[[qd.prototype._setValue_direct,qd.prototype._setValue_direct_setNeedsUpdate,qd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_array,qd.prototype._setValue_array_setNeedsUpdate,qd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_arrayElement,qd.prototype._setValue_arrayElement_setNeedsUpdate,qd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qd.prototype._setValue_fromArray,qd.prototype._setValue_fromArray_setNeedsUpdate,qd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var $d=function(){function e(){Object(A.a)(this,e),this.uuid=Xn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,r=arguments.length;n!==r;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}return Object(h.a)(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,a=this._bindings,i=a.length,o=void 0,s=e.length,c=this.nCachedObjects_,u=0,l=arguments.length;u!==l;++u){var g=arguments[u],d=g.uuid,I=t[d];if(void 0===I){I=s++,t[d]=I,e.push(g);for(var A=0,h=i;A!==h;++A)a[A].push(new qd(g,n[A],r[A]))}else if(I<c){o=e[I];var C=--c,f=e[C];t[f.uuid]=I,e[I]=f,t[d]=C,e[C]=g;for(var p=0,m=i;p!==m;++p){var v=a[p],b=v[C],y=v[I];v[I]=b,void 0===y&&(y=new qd(g,n[p],r[p])),v[C]=y}}else e[I]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=0,o=arguments.length;i!==o;++i){var s=arguments[i],c=s.uuid,u=t[c];if(void 0!==u&&u>=a){var l=a++,g=e[l];t[g.uuid]=u,e[u]=g,t[c]=l,e[l]=s;for(var d=0,I=r;d!==I;++d){var A=n[d],h=A[l],C=A[u];A[u]=h,A[l]=C}}}this.nCachedObjects_=a}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=e.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o],u=c.uuid,l=t[u];if(void 0!==l)if(delete t[u],l<a){var g=--a,d=e[g],I=--i,A=e[I];t[d.uuid]=l,e[l]=d,t[A.uuid]=g,e[g]=A,e.pop();for(var h=0,C=r;h!==C;++h){var f=n[h],p=f[g],m=f[I];f[l]=p,f[g]=m,f.pop()}}else{var v=--i,b=e[v];v>0&&(t[b.uuid]=l),e[l]=b,e.pop();for(var y=0,B=r;y!==B;++y){var G=n[y];G[l]=G[v],G.pop()}}}this.nCachedObjects_=a}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],a=this._bindings;if(void 0!==r)return a[r];var i=this._paths,o=this._parsedPaths,s=this._objects,c=s.length,u=this.nCachedObjects_,l=new Array(c);r=a.length,n[e]=r,i.push(e),o.push(t),a.push(l);for(var g=u,d=s.length;g!==d;++g){var I=s[g];l[g]=new qd(I,e,t)}return l}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,a=this._parsedPaths,i=this._bindings,o=i.length-1,s=i[o];t[e[o]]=n,i[n]=s,i.pop(),a[n]=a[o],a.pop(),r[n]=r[o],r.pop()}}}]),e}();$d.prototype.isAnimationObjectGroup=!0;var eI=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Object(A.a)(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=a;for(var i=n.tracks,o=i.length,s=new Array(o),c={endingStart:Ot,endingEnd:Ot},u=0;u!==o;++u){var l=i[u].createInterpolant(null);s[u]=l,l.settings=c}this._interpolantSettings=c,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Wt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Object(h.a)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,a=e._clip.duration,i=a/r,o=r/a;e.warp(1,i,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,a=r.time,i=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,c=o.sampleValues;return s[0]=a,s[1]=a+n,c[0]=e/i,c[1]=t/i,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var a=this._startTime;if(null!==a){var i=(e-a)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var c=this._interpolants,u=this._propertyBindings;if(this.blendMode===Tt)for(var l=0,g=c.length;l!==g;++l)c[l].evaluate(o),u[l].accumulateAdditive(s);else for(var d=0,I=c.length;d!==I;++d)c[d].evaluate(o),u[d].accumulate(r,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,a=this._loopCount,i=n===Vt;if(0===e)return-1===a?r:i&&1===(1&a)?t-r:r;if(n===Et){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,a+=Math.abs(o);var s=this.repetitions-a;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var c=e<0;this._setEndings(c,!c,i)}else this._setEndings(!1,!1,i);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(i&&1===(1&a))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=Lt,r.endingEnd=Lt):(r.endingStart=e?this.zeroSlopeAtStart?Lt:Ot:Nt,r.endingEnd=t?this.zeroSlopeAtEnd?Lt:Ot:Nt)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,a=r.time,i=this._weightInterpolant;null===i&&(i=r._lendControlInterpolant(),this._weightInterpolant=i);var o=i.parameterPositions,s=i.sampleValues;return o[0]=a,s[0]=t,o[1]=a+e,s[1]=n,this}}]),e}(),tI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this))._root=e,r._initMemoryManager(),r._accuIndex=0,r.time=0,r.timeScale=1,r}return Object(h.a)(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,a=r.length,i=e._propertyBindings,o=e._interpolants,s=n.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(u={},c[s]=u);for(var l=0;l!==a;++l){var g=r[l],d=g.name,I=u[d];if(void 0!==I)++I.referenceCount,i[l]=I;else{if(void 0!==(I=i[l])){null===I._cacheIndex&&(++I.referenceCount,this._addInactiveBinding(I,s,d));continue}var A=t&&t._propertyBindings[l].binding.parsedPath;++(I=new Ld(qd.create(n,d,A),g.ValueTypeName,g.getValueSize())).referenceCount,this._addInactiveBinding(I,s,d),i[l]=I}o[l].resultBuffer=I.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var a=e._propertyBindings,i=0,o=a.length;i!==o;++i){var s=a[i];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.useCount&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var r=this._actions,a=this._actionsByClip,i=a[t];if(void 0===i)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=i;else{var o=i.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),i.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var a=e._clip.uuid,i=this._actionsByClip,o=i[a],s=o.knownActions,c=s[s.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete i[a],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.referenceCount&&this._removeInactiveBinding(a)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_addInactiveBinding",value:function(e,t,n){var r=this._bindingsByRootAndName,a=this._bindings,i=r[t];void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,a=n.path,i=this._bindingsByRootAndName,o=i[r],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete o[a],0===Object.keys(o).length&&delete i[r]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new mg(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=n,t[n]=a}},{key:"clipAction",value:function(e,t,n){var r=t||this._root,a=r.uuid,i="string"===typeof e?xg.findByName(r,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],c=null;if(void 0===n&&(n=null!==i?i.blendMode:Yt),void 0!==s){var u=s.actionByRoot[a];if(void 0!==u&&u.blendMode===n)return u;c=s.knownActions[0],null===i&&(i=c._clip)}if(null===i)return null;var l=new eI(this,i,t,n);return this._bindAction(l,c),this._addInactiveAction(l,o,a),l}},{key:"existingAction",value:function(e,t){var n=t||this._root,r=n.uuid,a="string"===typeof e?xg.findByName(n,e):e,i=a?a.uuid:e,o=this._actionsByClip[i];return void 0!==o&&o.actionByRoot[r]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),i=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,a,i)}for(var s=this._bindings,c=this._nActiveBindings,u=0;u!==c;++u)s[u].apply(i);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,a=r[n];if(void 0!==a){for(var i=a.knownActions,o=0,s=i.length;o!==s;++o){var c=i[o];this._deactivateAction(c);var u=c._cacheIndex,l=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,t[u]=l,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var a=n[r].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var i=this._bindingsByRootAndName[t];if(void 0!==i)for(var o in i){var s=i[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(Mn);tI.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var nI=function(){function e(t){Object(A.a)(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Object(h.a)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),rI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(A.a)(this,n),(a=t.call(this,e,r)).meshPerAttribute=i,a}return Object(h.a)(n,[{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=Object(c.a)(Object(u.a)(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(Sc);rI.prototype.isInstancedInterleavedBuffer=!0;var aI=function(){function e(t,n,r,a,i){Object(A.a)(this,e),this.buffer=t,this.type=n,this.itemSize=r,this.elementSize=a,this.count=i,this.version=0}return Object(h.a)(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}();aI.prototype.isGLBufferAttribute=!0;var iI=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;Object(A.a)(this,e),this.ray=new qr(t,n),this.near=r,this.far=a,this.camera=null,this.layers=new la,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return Object(h.a)(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return sI(e,this,n,t),n.sort(oI),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,a=e.length;r<a;r++)sI(e[r],this,n,t);return n.sort(oI),n}}]),e}();function oI(e,t){return e.distance-t.distance}function sI(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var a=e.children,i=0,o=a.length;i<o;i++)sI(a[i],t,n,!0)}var cI=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(A.a)(this,e),this.radius=t,this.phi=n,this.theta=r,this}return Object(h.a)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Hn(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),uI=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(A.a)(this,e),this.radius=t,this.theta=n,this.y=r,this}return Object(h.a)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),lI=new Kn,gI=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn(-1/0,-1/0);Object(A.a)(this,e),this.min=t,this.max=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=lI.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return lI.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();gI.prototype.isBox2=!0;var dI=new yr,II=new yr,AI=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr;Object(A.a)(this,e),this.start=t,this.end=n}return Object(h.a)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){dI.subVectors(e,this.start),II.subVectors(this.end,this.start);var n=II.dot(II),r=II.dot(dI)/n;return t&&(r=Hn(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),hI=new yr,CI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;Object(A.a)(this,n),(a=t.call(this)).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r;for(var i=new ii,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,c=1;s<32;s++,c++){var u=s/32*Math.PI*2,l=c/32*Math.PI*2;o.push(Math.cos(u),Math.sin(u),1,Math.cos(l),Math.sin(l),1)}i.setAttribute("position",new Pa(o,3));var g=new Iu({fog:!1,toneMapped:!1});return a.cone=new yu(i,g),a.add(a.cone),a.update(),a}return Object(h.a)(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hI.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hI),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(Ga),fI=new yr,pI=new $r,mI=new $r,vI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(A.a)(this,n);for(var a=bI(e),i=new ii,o=[],s=[],c=new cr(0,0,1),u=new cr(0,1,0),l=0;l<a.length;l++){var g=a[l];g.parent&&g.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(c.r,c.g,c.b),s.push(u.r,u.g,u.b))}i.setAttribute("position",new Pa(o,3)),i.setAttribute("color",new Pa(s,3));var d=new Iu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=t.call(this,i,d)).type="SkeletonHelper",r.isSkeletonHelper=!0,r.root=e,r.bones=a,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return Object(h.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,r=this.geometry,a=r.getAttribute("position");mI.copy(this.root.matrixWorld).invert();for(var i=0,o=0;i<t.length;i++){var s=t[i];s.parent&&s.parent.isBone&&(pI.multiplyMatrices(mI,s.matrixWorld),fI.setFromMatrixPosition(pI),a.setXYZ(o,fI.x,fI.y,fI.z),pI.multiplyMatrices(mI,s.parent.matrixWorld),fI.setFromMatrixPosition(pI),a.setXYZ(o+1,fI.x,fI.y,fI.z),o+=2)}r.getAttribute("position").needsUpdate=!0,Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(yu);function bI(e){var t=[];!0===e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,bI(e.children[n]));return t}var yI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;Object(A.a)(this,n);var o=new Jl(r,4,2),s=new Ha({wireframe:!0,fog:!1,toneMapped:!1});return(i=t.call(this,o,s)).light=e,i.light.updateMatrixWorld(),i.color=a,i.type="PointLightHelper",i.matrix=i.light.matrixWorld,i.matrixAutoUpdate=!1,i.update(),i}return Object(h.a)(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(Bi),BI=new yr,GI=new cr,wI=new cr,_I=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;Object(A.a)(this,n),(i=t.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a;var o=new Ul(r);o.rotateY(.5*Math.PI),i.material=new Ha({wireframe:!0,fog:!1,toneMapped:!1}),void 0===i.color&&(i.material.vertexColors=!0);var s=o.getAttribute("position"),c=new Float32Array(3*s.count);return o.setAttribute("color",new Na(c,3)),i.add(new Bi(o,i.material)),i.update(),i}return Object(h.a)(n,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");GI.copy(this.light.color),wI.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var a=n<r/2?GI:wI;t.setXYZ(n,a.r,a.g,a.b)}t.needsUpdate=!0}e.lookAt(BI.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),n}(Ga),ZI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Object(A.a)(this,n),i=new cr(i),o=new cr(o);for(var s=a/2,c=r/a,u=r/2,l=[],g=[],d=0,I=0,h=-u;d<=a;d++,h+=c){l.push(-u,0,h,u,0,h),l.push(h,0,-u,h,0,u);var C=d===s?i:o;C.toArray(g,I),I+=3,C.toArray(g,I),I+=3,C.toArray(g,I),I+=3,C.toArray(g,I),I+=3}var f=new ii;f.setAttribute("position",new Pa(l,3)),f.setAttribute("color",new Pa(g,3));var p=new Iu({vertexColors:!0,toneMapped:!1});return(e=t.call(this,f,p)).type="GridHelper",e}return Object(h.a)(n)}(yu),SI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;Object(A.a)(this,n),s=new cr(s),c=new cr(c);for(var u=[],l=[],g=0;g<=a;g++){var d=g/a*(2*Math.PI),I=Math.sin(d)*r,h=Math.cos(d)*r;u.push(0,0,0),u.push(I,0,h);var C=1&g?s:c;l.push(C.r,C.g,C.b),l.push(C.r,C.g,C.b)}for(var f=0;f<=i;f++)for(var p=1&f?s:c,m=r-r/i*f,v=0;v<o;v++){var b=v/o*(2*Math.PI),y=Math.sin(b)*m,B=Math.cos(b)*m;u.push(y,0,B),l.push(p.r,p.g,p.b),b=(v+1)/o*(2*Math.PI),y=Math.sin(b)*m,B=Math.cos(b)*m,u.push(y,0,B),l.push(p.r,p.g,p.b)}var G=new ii;G.setAttribute("position",new Pa(u,3)),G.setAttribute("color",new Pa(l,3));var w=new Iu({vertexColors:!0,toneMapped:!1});return(e=t.call(this,G,w)).type="PolarGridHelper",e}return Object(h.a)(n)}(yu),xI=new yr,RI=new yr,MI=new yr,kI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;Object(A.a)(this,n),(i=t.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a,void 0===r&&(r=1);var o=new ii;o.setAttribute("position",new Pa([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new Iu({fog:!1,toneMapped:!1});return i.lightPlane=new mu(o,s),i.add(i.lightPlane),(o=new ii).setAttribute("position",new Pa([0,0,0,0,0,1],3)),i.targetLine=new mu(o,s),i.add(i.targetLine),i.update(),i}return Object(h.a)(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){xI.setFromMatrixPosition(this.light.matrixWorld),RI.setFromMatrixPosition(this.light.target.matrixWorld),MI.subVectors(RI,xI),this.lightPlane.lookAt(RI),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(RI),this.targetLine.scale.z=MI.length()}}]),n}(Ga),EI=new yr,WI=new Ri,VI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(A.a)(this,n);var a=new ii,i=new Iu({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],c={},u=new cr(16755200),l=new cr(16711680),g=new cr(43775),d=new cr(16777215),I=new cr(3355443);function h(e,t,n){C(e,n),C(t,n)}function C(e,t){o.push(0,0,0),s.push(t.r,t.g,t.b),void 0===c[e]&&(c[e]=[]),c[e].push(o.length/3-1)}return h("n1","n2",u),h("n2","n4",u),h("n4","n3",u),h("n3","n1",u),h("f1","f2",u),h("f2","f4",u),h("f4","f3",u),h("f3","f1",u),h("n1","f1",u),h("n2","f2",u),h("n3","f3",u),h("n4","f4",u),h("p","n1",l),h("p","n2",l),h("p","n3",l),h("p","n4",l),h("u1","u2",g),h("u2","u3",g),h("u3","u1",g),h("c","t",d),h("p","c",I),h("cn1","cn2",I),h("cn3","cn4",I),h("cf1","cf2",I),h("cf3","cf4",I),a.setAttribute("position",new Pa(o,3)),a.setAttribute("color",new Pa(s,3)),(r=t.call(this,a,i)).type="CameraHelper",r.camera=e,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=c,r.update(),r}return Object(h.a)(n,[{key:"update",value:function(){var e=this.geometry,t=this.pointMap;WI.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),FI("c",t,e,WI,0,0,-1),FI("t",t,e,WI,0,0,1),FI("n1",t,e,WI,-1,-1,-1),FI("n2",t,e,WI,1,-1,-1),FI("n3",t,e,WI,-1,1,-1),FI("n4",t,e,WI,1,1,-1),FI("f1",t,e,WI,-1,-1,1),FI("f2",t,e,WI,1,-1,1),FI("f3",t,e,WI,-1,1,1),FI("f4",t,e,WI,1,1,1),FI("u1",t,e,WI,.7,1.1,-1),FI("u2",t,e,WI,-.7,1.1,-1),FI("u3",t,e,WI,0,2,-1),FI("cf1",t,e,WI,-1,0,1),FI("cf2",t,e,WI,1,0,1),FI("cf3",t,e,WI,0,-1,1),FI("cf4",t,e,WI,0,1,1),FI("cn1",t,e,WI,-1,0,-1),FI("cn2",t,e,WI,1,0,-1),FI("cn3",t,e,WI,0,-1,-1),FI("cn4",t,e,WI,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(yu);function FI(e,t,n,r,a,i,o){EI.set(a,i,o).unproject(r);var s=t[e];if(void 0!==s)for(var c=n.getAttribute("position"),u=0,l=s.length;u<l;u++)c.setXYZ(s[u],EI.x,EI.y,EI.z)}for(var XI,HI,OI=new wr,LI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;Object(A.a)(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new ii;return s.setIndex(new Na(i,1)),s.setAttribute("position",new Na(o,3)),(r=t.call(this,s,new Iu({color:a,toneMapped:!1}))).object=e,r.type="BoxHelper",r.matrixAutoUpdate=!1,r.update(),r}return Object(h.a)(n,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&OI.setFromObject(this.object),!OI.isEmpty()){var t=OI.min,n=OI.max,r=this.geometry.attributes.position,a=r.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=t.x,a[4]=n.y,a[5]=n.z,a[6]=t.x,a[7]=t.y,a[8]=n.z,a[9]=n.x,a[10]=t.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=t.z,a[15]=t.x,a[16]=n.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=n.x,a[22]=t.y,a[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e){return yu.prototype.copy.call(this,e),this.object=e.object,this}}]),n}(yu),NI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;Object(A.a)(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new ii;return s.setIndex(new Na(i,1)),s.setAttribute("position",new Pa(o,3)),(r=t.call(this,s,new Iu({color:a,toneMapped:!1}))).box=e,r.type="Box3Helper",r.geometry.computeBoundingSphere(),r}return Object(h.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e))}}]),n}(yu),YI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;Object(A.a)(this,n);var o=i,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],c=new ii;c.setAttribute("position",new Pa(s,3)),c.computeBoundingSphere(),(r=t.call(this,c,new Iu({color:o,toneMapped:!1}))).type="PlaneHelper",r.plane=e,r.size=a;var u=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new ii;return l.setAttribute("position",new Pa(u,3)),l.computeBoundingSphere(),r.add(new Bi(l,new Ha({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),r}return Object(h.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?R:x,this.lookAt(this.plane.normal),Object(c.a)(Object(u.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(mu),TI=new yr,zI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yr(0,0,1),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yr(0,0,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*i,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*s;return Object(A.a)(this,n),(e=t.call(this)).type="ArrowHelper",void 0===XI&&((XI=new ii).setAttribute("position",new Pa([0,0,0,0,1,0],3)),(HI=new ol(0,.5,1,5,1)).translate(0,-.5,0)),e.position.copy(a),e.line=new mu(XI,new Iu({color:o,toneMapped:!1})),e.line.matrixAutoUpdate=!1,e.add(e.line),e.cone=new Bi(HI,new Ha({color:o,toneMapped:!1})),e.cone.matrixAutoUpdate=!1,e.add(e.cone),e.setDirection(r),e.setLength(i,s,c),e}return Object(h.a)(n,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{TI.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(TI,t)}}},{key:"setLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return Object(c.a)(Object(u.a)(n.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}]),n}(Ga),KI=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(A.a)(this,n);var a=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new ii;o.setAttribute("position",new Pa(a,3)),o.setAttribute("color",new Pa(i,3));var s=new Iu({vertexColors:!0,toneMapped:!1});return(e=t.call(this,o,s)).type="AxesHelper",e}return Object(h.a)(n,[{key:"setColors",value:function(e,t,n){var r=new cr,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(yu),jI=function(){function e(){Object(A.a)(this,e),this.type="ShapePath",this.color=new cr,this.subPaths=[],this.currentPath=null}return Object(h.a)(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new nl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){return this.currentPath.bezierCurveTo(e,t,n,r,a,i),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n],i=new hl;i.curves=a.curves,t.push(i)}return t}function r(e,t){for(var n=t.length,r=!1,a=n-1,i=0;i<n;a=i++){var o=t[a],s=t[i],c=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[i],c=-c,s=t[a],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var l=u*(e.x-o.x)-c*(e.y-o.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var a,i,o,s=Yl.isClockWise,c=this.subPaths;if(0===c.length)return[];if(!0===t)return n(c);var u=[];if(1===c.length)return i=c[0],(o=new hl).curves=i.curves,u.push(o),u;var l=!s(c[0].getPoints());l=e?!l:l;var g,d,I=[],A=[],h=[],C=0;A[C]=void 0,h[C]=[];for(var f=0,p=c.length;f<p;f++)a=s(g=(i=c[f]).getPoints()),(a=e?!a:a)?(!l&&A[C]&&C++,A[C]={s:new hl,p:g},A[C].s.curves=i.curves,l&&C++,h[C]=[]):h[C].push({h:i,p:g[0]});if(!A[0])return n(c);if(A.length>1){for(var m=!1,v=0,b=0,y=A.length;b<y;b++)I[b]=[];for(var B=0,G=A.length;B<G;B++)for(var w=h[B],_=0;_<w.length;_++){for(var Z=w[_],S=!0,x=0;x<A.length;x++)r(Z.p,A[x].p)&&(B!==x&&v++,S?(S=!1,I[x].push(Z)):m=!0);S&&I[B].push(Z)}v>0&&!1===m&&(h=I)}for(var R=0,M=A.length;R<M;R++){o=A[R].s,u.push(o);for(var k=0,E=(d=h[R]).length;k<E;k++)o.holes.push(d[k].h)}return u}}]),e}(),DI=function(){function e(){Object(A.a)(this,e)}return Object(h.a)(e,null,[{key:"toHalfFloat",value:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Hn(e,-65504,65504),QI[0]=e;var t=PI[0],n=t>>23&511;return JI[n]+((8388607&t)>>qI[n])}},{key:"fromHalfFloat",value:function(e){var t=e>>10;return PI[0]=tA[rA[t]+(1023&e)]+nA[t],QI[0]}}]),e}(),UI=new ArrayBuffer(4),QI=new Float32Array(UI),PI=new Uint32Array(UI),JI=new Uint32Array(512),qI=new Uint32Array(512),$I=0;$I<256;++$I){var eA=$I-127;eA<-27?(JI[$I]=0,JI[256|$I]=32768,qI[$I]=24,qI[256|$I]=24):eA<-14?(JI[$I]=1024>>-eA-14,JI[256|$I]=1024>>-eA-14|32768,qI[$I]=-eA-1,qI[256|$I]=-eA-1):eA<=15?(JI[$I]=eA+15<<10,JI[256|$I]=eA+15<<10|32768,qI[$I]=13,qI[256|$I]=13):eA<128?(JI[$I]=31744,JI[256|$I]=64512,qI[$I]=24,qI[256|$I]=24):(JI[$I]=31744,JI[256|$I]=64512,qI[$I]=13,qI[256|$I]=13)}for(var tA=new Uint32Array(2048),nA=new Uint32Array(64),rA=new Uint32Array(64),aA=1;aA<1024;++aA){for(var iA=aA<<13,oA=0;0===(8388608&iA);)iA<<=1,oA-=8388608;iA&=-8388609,oA+=947912704,tA[aA]=iA|oA}for(var sA=1024;sA<2048;++sA)tA[sA]=939524096+(sA-1024<<13);for(var cA=1;cA<31;++cA)nA[cA]=cA<<23;nA[31]=1199570944,nA[32]=2147483648;for(var uA=33;uA<63;++uA)nA[uA]=2147483648+(uA-32<<23);nA[63]=3347054592;for(var lA=1;lA<64;++lA)32!==lA&&(rA[lA]=1024);var gA=0,dA=1,IA=0,AA=1,hA=2;function CA(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function fA(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}var pA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.PointCloud has been renamed to THREE.Points."),t.call(this,e,r)}return Object(h.a)(n)}(xu),mA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.Particle has been renamed to THREE.Sprite."),t.call(this,e)}return Object(h.a)(n)}(Kc),vA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),t.call(this,e,r)}return Object(h.a)(n)}(xu),bA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),t.call(this,e)}return Object(h.a)(n)}(Gu),yA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),t.call(this,e)}return Object(h.a)(n)}(Gu),BA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),t.call(this,e)}return Object(h.a)(n)}(Gu),GA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),t.call(this,e,r,a)}return Object(h.a)(n)}(yr),wA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){var a;return Object(A.a)(this,n),console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),(a=t.call(this,e,r)).setUsage(vn),a}return Object(h.a)(n)}(Na),_A=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Ya),ZA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Ta),SA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(za),xA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Ka),RA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(ja),MA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Da),kA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Ua),EA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Pa),WA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),t.call(this,e,r)}return Object(h.a)(n)}(Ja);Vu.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Vu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},nl.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)};var VA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),t.call(this,e)}return Object(h.a)(n)}(KI),FA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),t.call(this,e,r)}return Object(h.a)(n)}(LI),XA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),t.call(this,new Al(e.geometry),new Iu({color:void 0!==r?r:16777215}))}return Object(h.a)(n)}(yu);ZI.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},vI.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};var HA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r){return Object(A.a)(this,n),console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),t.call(this,new ng(e.geometry),new Iu({color:void 0!==r?r:16777215}))}return Object(h.a)(n)}(yu);Wg.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ud.extractUrlBase(e)},Wg.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};var OA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),t.call(this,e)}return Object(h.a)(n)}(Fg),LA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(A.a)(this,n),console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),t.call(this,e)}return Object(h.a)(n)}(Ng);gI.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},gI.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},gI.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},gI.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},wr.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},wr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},wr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},wr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},wr.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},ua.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},zr.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Yi.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},AI.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},jn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},jn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},jn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},jn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},jn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},jn.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},$r.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},$r.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},$r.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new yr).setFromMatrixColumn(this,3)},$r.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},$r.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},$r.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},$r.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},$r.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},$r.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},$r.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},$r.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},$r.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},$r.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},$r.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},$r.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},$r.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},$r.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},$r.prototype.makeFrustum=function(e,t,n,r,a,i){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,a,i)},$r.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Oi.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},br.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},br.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},qr.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},qr.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},qr.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Va.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Va.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Va.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Va.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Va.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Va.barycoordFromPoint=function(e,t,n,r,a){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Va.getBarycoord(e,t,n,r,a)},Va.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Va.getNormal(e,t,n,r)},hl.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},hl.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Kl(this,e)},hl.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Pl(this,e)},Kn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Kn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Kn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},yr.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},yr.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},yr.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},yr.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},yr.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},yr.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},yr.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},yr.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},yr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ar.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Ar.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ga.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Ga.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Ga.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Ga.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Ga.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Ga.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Bi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Bi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),zt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),tu.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Mi.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Tg.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Na.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===vn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(vn)}}}),Na.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?vn:mn),this},Na.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Na.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ii.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},ii.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Na(arguments[1],arguments[2])))},ii.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},ii.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ii.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ii.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},ii.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(ii.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Sc.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?vn:mn),this},Sc.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Kl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Kl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Kl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Zc.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},nI.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Xa.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new cr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===k}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(xi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Bc.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Bc.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Bc.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Bc.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Bc.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Bc.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Bc.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Bc.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Bc.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Bc.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Bc.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Bc.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Bc.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Bc.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Bc.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Bc.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Bc.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Bc.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Bc.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Bc.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Bc.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Bc.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Bc.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Bc.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Bc.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Bc.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Ut:Dt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(gc.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});var NA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){return Object(A.a)(this,n),console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),t.call(this,e,a)}return Object(h.a)(n)}(Vi);function YA(){console.error("THREE.CanvasRenderer has been removed")}function TA(){console.error("THREE.JSONLoader has been removed.")}Object.defineProperties(hr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Ed.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new md).load(e,(function(e){t.setBuffer(e)})),this},Od.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ei.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ei.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},ur.crossOrigin=void 0,ur.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var a=new Yg;a.setCrossOrigin(this.crossOrigin);var i=a.load(e,n,void 0,r);return t&&(i.mapping=t),i},ur.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var a=new Lg;a.setCrossOrigin(this.crossOrigin);var i=a.load(e,n,void 0,r);return t&&(i.mapping=t),i},ur.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ur.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var zA={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function KA(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}var jA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),t.call(this)}return Object(h.a)(n)}(ii),DA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(){return Object(A.a)(this,n),console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),t.call(this)}return Object(h.a)(n)}(ii);function UA(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function QA(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function PA(){console.error("THREE.ImmediateRenderObject has been removed.")}var JA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a){var i;return Object(A.a)(this,n),console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),(i=t.call(this,e,r,a)).samples=4,i}return Object(h.a)(n)}(hr),qA=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){return Object(A.a)(this,n),console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),t.call(this,e,r,a,i)}return Object(h.a)(n)}(Cr),$A=function(e){Object(g.a)(n,e);var t=Object(d.a)(n);function n(e,r,a,i){return Object(A.a)(this,n),console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),t.call(this,e,r,a,i)}return Object(h.a)(n)}(pr);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:p}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=p)},function(e,t,n){"use strict";e.exports=n(107)},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(48);function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Object(r.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(11),a=n(65),i=n(68);function o(e){var t=Object(a.a)();return function(){var n,a=Object(r.a)(e);if(t){var o=Object(r.a)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return Object(i.a)(this,n)}}},function(e,t,n){"use strict";n.d(t,"w",(function(){return c})),n.d(t,"a",(function(){return Ge})),n.d(t,"b",(function(){return N})),n.d(t,"c",(function(){return _e})),n.d(t,"d",(function(){return Be})),n.d(t,"e",(function(){return J})),n.d(t,"f",(function(){return Ce})),n.d(t,"g",(function(){return He})),n.d(t,"h",(function(){return Z})),n.d(t,"i",(function(){return ze})),n.d(t,"j",(function(){return Ye})),n.d(t,"k",(function(){return R})),n.d(t,"l",(function(){return M})),n.d(t,"m",(function(){return E})),n.d(t,"n",(function(){return F})),n.d(t,"o",(function(){return j})),n.d(t,"p",(function(){return ye})),n.d(t,"q",(function(){return be})),n.d(t,"r",(function(){return ve})),n.d(t,"s",(function(){return S})),n.d(t,"t",(function(){return Ke})),n.d(t,"u",(function(){return x})),n.d(t,"v",(function(){return _})),n.d(t,"x",(function(){return Ze})),n.d(t,"y",(function(){return k})),n.d(t,"z",(function(){return Ue})),n.d(t,"A",(function(){return qe})),n.d(t,"B",(function(){return Pe})),n.d(t,"C",(function(){return je})),n.d(t,"D",(function(){return Je}));var r=n(10),a=n(5),i=n(4),o=n(16),s=B(),c=function(e){return m(e,s)},u=B();c.write=function(e){return m(e,u)};var l=B();c.onStart=function(e){return m(e,l)};var g=B();c.onFrame=function(e){return m(e,g)};var d=B();c.onFinish=function(e){return m(e,d)};var I=[];c.setTimeout=function(e,t){var n=c.now()+t,r={time:n,handler:e,cancel:function e(){var t=I.findIndex((function(t){return t.cancel==e}));~t&&I.splice(t,1),f-=~t?1:0}};return I.splice(A(n),0,r),f+=1,v(),r};var A=function(e){return~(~I.findIndex((function(t){return t.time>e}))||~I.length)};c.cancel=function(e){l.delete(e),g.delete(e),s.delete(e),u.delete(e),d.delete(e)},c.sync=function(e){p=!0,c.batchedUpdates(e),p=!1},c.throttle=function(e){var t;function n(){try{e.apply(void 0,Object(o.a)(t))}finally{t=null}}function r(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];t=r,c.onStart(n)}return r.handler=e,r.cancel=function(){l.delete(n),t=null},r};var h="undefined"!=typeof window?window.requestAnimationFrame:function(){};c.use=function(e){return h=e},c.now="undefined"!=typeof performance?function(){return performance.now()}:Date.now,c.batchedUpdates=function(e){return e()},c.catch=console.error,c.frameLoop="always",c.advance=function(){"demand"!==c.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):y()};var C=-1,f=0,p=!1;function m(e,t){p?(t.delete(e),e(0)):(t.add(e),v())}function v(){C<0&&(C=0,"demand"!==c.frameLoop&&h(b))}function b(){~C&&(h(b),c.batchedUpdates(y))}function y(){var e=C;C=c.now();var t=A(C);t&&(G(I.splice(0,t),(function(e){return e.handler()})),f-=t),l.flush(),s.flush(e?Math.min(64,C-e):16.667),g.flush(),u.flush(),d.flush(),f||(C=-1)}function B(){var e=new Set,t=e;return{add:function(n){f+=t!=e||e.has(n)?0:1,e.add(n)},delete:function(n){return f-=t==e&&e.has(n)?1:0,e.delete(n)},flush:function(n){t.size&&(e=new Set,f-=t.size,G(t,(function(t){return t(n)&&e.add(t)})),f+=e.size,t=e)}}}function G(e,t){e.forEach((function(e){try{t(e)}catch(n){c.catch(n)}}))}var w=n(1);function _(){}var Z=function(e,t,n){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})},S={arr:Array.isArray,obj:function(e){return!!e&&"Object"===e.constructor.name},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},und:function(e){return void 0===e}};function x(e,t){if(S.arr(e)){if(!S.arr(t)||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}var R=function(e,t){return e.forEach(t)};function M(e,t,n){if(S.arr(e))for(var r=0;r<e.length;r++)t.call(n,e[r],"".concat(r));else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a)}var k=function(e){return S.und(e)?[]:S.arr(e)?e:[e]};function E(e,t){if(e.size){var n=Array.from(e);e.clear(),R(n,t)}}var W,V,F=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return E(e,(function(e){return e.apply(void 0,n)}))},X=function(){return"undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)},H=null,O=!1,L=_,N=Object.freeze({__proto__:null,get createStringInterpolator(){return W},get to(){return V},get colors(){return H},get skipAnimation(){return O},get willAdvance(){return L},assign:function(e){e.to&&(V=e.to),e.now&&(c.now=e.now),void 0!==e.colors&&(H=e.colors),null!=e.skipAnimation&&(O=e.skipAnimation),e.createStringInterpolator&&(W=e.createStringInterpolator),e.requestAnimationFrame&&c.use(e.requestAnimationFrame),e.batchedUpdates&&(c.batchedUpdates=e.batchedUpdates),e.willAdvance&&(L=e.willAdvance),e.frameLoop&&(c.frameLoop=e.frameLoop)}}),Y=new Set,T=[],z=[],K=0,j={get idle(){return!Y.size&&!T.length},start:function(e){K>e.priority?(Y.add(e),c.onStart(D)):(U(e),c(P))},advance:P,sort:function(e){if(K)c.onFrame((function(){return j.sort(e)}));else{var t=T.indexOf(e);~t&&(T.splice(t,1),Q(e))}},clear:function(){T=[],Y.clear()}};function D(){Y.forEach(U),Y.clear(),c(P)}function U(e){T.includes(e)||Q(e)}function Q(e){T.splice(function(e,t){var n=e.findIndex(t);return n<0?e.length:n}(T,(function(t){return t.priority>e.priority})),0,e)}function P(e){for(var t=z,n=0;n<T.length;n++){var r=T[n];K=r.priority,r.idle||(L(r),r.advance(e),r.idle||t.push(r))}return K=0,(z=T).length=0,(T=t).length>0}var J={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},q="[-+]?\\d*\\.?\\d+",$=q+"%";function ee(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var te=new RegExp("rgb"+ee(q,q,q)),ne=new RegExp("rgba"+ee(q,q,q,q)),re=new RegExp("hsl"+ee(q,$,$)),ae=new RegExp("hsla"+ee(q,$,$,q)),ie=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,oe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,se=/^#([0-9a-fA-F]{6})$/,ce=/^#([0-9a-fA-F]{8})$/;function ue(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function le(e,t,n){var r=n<.5?n*(1+t):n+t-n*t,a=2*n-r,i=ue(a,r,e+1/3),o=ue(a,r,e),s=ue(a,r,e-1/3);return Math.round(255*i)<<24|Math.round(255*o)<<16|Math.round(255*s)<<8}function ge(e){var t=parseInt(e,10);return t<0?0:t>255?255:t}function de(e){return(parseFloat(e)%360+360)%360/360}function Ie(e){var t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function Ae(e){var t=parseFloat(e);return t<0?0:t>100?1:t/100}function he(e){var t=function(e){var t;return"number"===typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=se.exec(e))?parseInt(t[1]+"ff",16)>>>0:H&&void 0!==H[e]?H[e]:(t=te.exec(e))?(ge(t[1])<<24|ge(t[2])<<16|ge(t[3])<<8|255)>>>0:(t=ne.exec(e))?(ge(t[1])<<24|ge(t[2])<<16|ge(t[3])<<8|Ie(t[4]))>>>0:(t=ie.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ce.exec(e))?parseInt(t[1],16)>>>0:(t=oe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=re.exec(e))?(255|le(de(t[1]),Ae(t[2]),Ae(t[3])))>>>0:(t=ae.exec(e))?(le(de(t[1]),Ae(t[2]),Ae(t[3]))|Ie(t[4]))>>>0:null}(e);if(null===t)return e;var n=(16711680&(t=t||0))>>>16,r=(65280&t)>>>8,a=(255&t)/255;return"rgba(".concat((4278190080&t)>>>24,", ").concat(n,", ").concat(r,", ").concat(a,")")}var Ce=function e(t,n,r){if(S.fun(t))return t;if(S.arr(t))return e({range:t,output:n,extrapolate:r});if(S.str(t.output[0]))return W(t);var a=t,i=a.output,o=a.range||[0,1],s=a.extrapolateLeft||a.extrapolate||"extend",c=a.extrapolateRight||a.extrapolate||"extend",u=a.easing||function(e){return e};return function(e){var t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,o);return function(e,t,n,r,a,i,o,s,c){var u=c?c(e):e;if(u<t){if("identity"===o)return u;"clamp"===o&&(u=t)}if(u>n){if("identity"===s)return u;"clamp"===s&&(u=n)}if(r===a)return r;if(t===n)return e<=t?r:a;t===-1/0?u=-u:n===1/0?u-=t:u=(u-t)/(n-t);u=i(u),r===-1/0?u=-u:a===1/0?u+=r:u=u*(a-r)+r;return u}(e,o[t],o[t+1],i[t],i[t+1],u,s,c,a.map)}};function fe(){return fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fe.apply(this,arguments)}var pe=Symbol.for("FluidValue.get"),me=Symbol.for("FluidValue.observers"),ve=function(e){return Boolean(e&&e[pe])},be=function(e){return e&&e[pe]?e[pe]():e},ye=function(e){return e[me]||null};function Be(e,t){var n=e[me];n&&n.forEach((function(e){!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}var Ge=Object(a.a)((function e(t){if(Object(i.a)(this,e),this[pe]=void 0,this[me]=void 0,!t&&!(t=this.get))throw Error("Unknown getter");we(this,t)})),we=function(e,t){return xe(e,pe,t)};function _e(e,t){if(e[pe]){var n=e[me];n||xe(e,me,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function Ze(e,t){var n=e[me];if(n&&n.has(t)){var r=n.size-1;r?n.delete(t):e[me]=null,e.observerRemoved&&e.observerRemoved(r,t)}}var Se,xe=function(e,t,n){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})},Re=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Me=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,ke=new RegExp("(".concat(Re.source,")(%|[a-z]+)"),"i"),Ee=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,We=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Ve=function e(t){var n=Fe(t),a=Object(r.a)(n,2),i=a[0],o=a[1];if(!i||X())return t;var s=window.getComputedStyle(document.documentElement).getPropertyValue(i);if(s)return s.trim();if(o&&o.startsWith("--")){var c=window.getComputedStyle(document.documentElement).getPropertyValue(o);return c||t}return o&&We.test(o)?e(o):o||t},Fe=function(e){var t=We.exec(e);if(!t)return[,];var n=Object(r.a)(t,3);return[n[1],n[2]]},Xe=function(e,t,n,r,a){return"rgba(".concat(Math.round(t),", ").concat(Math.round(n),", ").concat(Math.round(r),", ").concat(a,")")},He=function(e){Se||(Se=H?new RegExp("(".concat(Object.keys(H).join("|"),")(?!\\w)"),"g"):/^\b$/);var t=e.output.map((function(e){return be(e).replace(We,Ve).replace(Me,he).replace(Se,he)})),n=t.map((function(e){return e.match(Re).map(Number)})),r=n[0].map((function(e,t){return n.map((function(e){if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]}))})).map((function(t){return Ce(fe({},e,{output:t}))}));return function(e){var n,a=!ke.test(t[0])&&(null==(n=t.find((function(e){return ke.test(e)})))?void 0:n.replace(Re,"")),i=0;return t[0].replace(Re,(function(){return"".concat(r[i++](e)).concat(a||"")})).replace(Ee,Xe)}},Oe="react-spring: ",Le=function(e){var t=e,n=!1;if("function"!=typeof t)throw new TypeError("".concat(Oe,"once requires a function parameter"));return function(){n||(t.apply(void 0,arguments),n=!0)}},Ne=Le(console.warn);function Ye(){Ne("".concat(Oe,'The "interpolate" function is deprecated in v9 (use "to" instead)'))}var Te=Le(console.warn);function ze(){Te("".concat(Oe,'Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions'))}function Ke(e){return S.str(e)&&("#"==e[0]||/\d/.test(e)||!X()&&We.test(e)||e in(H||{}))}var je=function(e){return Object(w.useEffect)(e,De)},De=[];function Ue(){var e=Object(w.useState)()[1],t=Object(w.useState)(Qe)[0];return je(t.unmount),function(){t.current&&e({})}}function Qe(){var e={current:!0,unmount:function(){return function(){e.current=!1}}};return e}function Pe(e,t){var n=Object(w.useState)((function(){return{inputs:t,result:e()}})),a=Object(r.a)(n,1)[0],i=Object(w.useRef)(),o=i.current,s=o;s?Boolean(t&&s.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,s.inputs))||(s={inputs:t,result:e()}):s=a;return Object(w.useEffect)((function(){i.current=s,o==a&&(a.inputs=a.result=void 0)}),[s]),s.result}function Je(e){var t=Object(w.useRef)();return Object(w.useEffect)((function(){t.current=e})),t.current}var qe="undefined"!==typeof window&&window.document&&window.document.createElement?w.useLayoutEffect:w.useEffect},function(e,t,n){"use strict";n.r(t),n.d(t,"Canvas",(function(){return Be})),n.d(t,"ReactThreeFiber",(function(){return j})),n.d(t,"_roots",(function(){return Me})),n.d(t,"act",(function(){return ze})),n.d(t,"addAfterEffect",(function(){return he})),n.d(t,"addEffect",(function(){return Ae})),n.d(t,"addTail",(function(){return Ce})),n.d(t,"advance",(function(){return Ve})),n.d(t,"applyProps",(function(){return He})),n.d(t,"context",(function(){return ce})),n.d(t,"createPortal",(function(){return Ke})),n.d(t,"dispose",(function(){return Te})),n.d(t,"events",(function(){return me})),n.d(t,"extend",(function(){return ne})),n.d(t,"invalidate",(function(){return We})),n.d(t,"reconciler",(function(){return Xe})),n.d(t,"render",(function(){return Le})),n.d(t,"unmountComponentAtNode",(function(){return Ye})),n.d(t,"useFrame",(function(){return _e})),n.d(t,"useGraph",(function(){return Se})),n.d(t,"useLoader",(function(){return Re})),n.d(t,"useStore",(function(){return Ge})),n.d(t,"useThree",(function(){return we}));var r=n(4),a=n(5),i=n(6),o=n(7),s=n(2),c=n(25),u=n(63),l=n(66),g=n(40),d=n(64);var I=n(10),A=n(14),h=n(16),C=n(13),f=n(22),p=n(0),m=n(1),v=n(100),b=n.n(v),y=n(99),B=n.n(y),G=n(47),w=n(56),_=n.n(w),Z=[];function S(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=Object(f.a)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(_()(n,s.args)){if(i)return;if(s.error)throw s.error;if(s.response)return s.response;throw s.promise}}}catch(u){o.e(u)}finally{o.f()}var c={args:n,promise:e.apply(void 0,Object(h.a)(n)).then((function(e){return c.response=null==e||e})).catch((function(e){return c.error=null!=e?e:"unknown error"})).then((function(){a>0&&setTimeout((function(){var e=t.indexOf(c);-1!==e&&t.splice(e,1)}),a)}))};if(t.push(c),!i)throw c.promise}function x(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(void 0===n||0===n.length)e.splice(0,e.length);else{var a=e.find((function(e){return _()(n,e.args)}));if(a){var i=e.indexOf(a);-1!==i&&e.splice(i,1)}}}function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return S(e,Z,n,R.lifespan)}R.lifespan=0,R.clear=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return x.apply(void 0,[Z].concat(t))},R.preload=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];S(e,Z,n,R.lifespan,!0)},R.peek=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return null==(r=Z.find((function(e){return _()(t,e.args)})))?void 0:r.response};var M=n(18),k=n(75),E=n.n(k);function W(e){var t=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e,n=t.debounce,i=t.scroll,o=t.polyfill,s=t.offsetSize,c=o||("undefined"===typeof window?Object(a.a)((function e(){Object(r.a)(this,e)})):window.ResizeObserver);if(!c)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");var u=Object(m.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=Object(I.a)(u,2),g=l[0],d=l[1],A=Object(m.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:g}),h=n?"number"===typeof n?n:n.scroll:null,C=n?"number"===typeof n?n:n.resize:null,f=Object(m.useRef)(!1);Object(m.useEffect)((function(){return f.current=!0,function(){f.current=!1}}));var p=Object(m.useMemo)((function(){var e=function(){if(A.current.element){var e=A.current.element.getBoundingClientRect(),t={left:e.left,top:e.top,width:e.width,height:e.height,bottom:e.bottom,right:e.right,x:e.x,y:e.y};A.current.element instanceof HTMLElement&&s&&(t.height=A.current.element.offsetHeight,t.width=A.current.element.offsetWidth),Object.freeze(t),f.current&&!X(A.current.lastBounds,t)&&d(A.current.lastBounds=t)}};return[e,C?E()(e,C):e,h?E()(e,h):e]}),[d,s,h,C]),v=Object(I.a)(p,3),b=v[0],y=v[1],B=v[2];function G(){A.current.scrollContainers&&(A.current.scrollContainers.forEach((function(e){return e.removeEventListener("scroll",B,!0)})),A.current.scrollContainers=null),A.current.resizeObserver&&(A.current.resizeObserver.disconnect(),A.current.resizeObserver=null)}function w(){A.current.element&&(A.current.resizeObserver=new c(B),A.current.resizeObserver.observe(A.current.element),i&&A.current.scrollContainers&&A.current.scrollContainers.forEach((function(e){return e.addEventListener("scroll",B,{capture:!0,passive:!0})})))}var _,Z,S;return _=B,Z=Boolean(i),Object(m.useEffect)((function(){if(Z){var e=_;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),function(){window.removeEventListener("scroll",e,!0)}}}),[_,Z]),S=y,Object(m.useEffect)((function(){var e=S;return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[S]),Object(m.useEffect)((function(){G(),w()}),[i,B,y]),Object(m.useEffect)((function(){return G}),[]),[function(e){e&&e!==A.current.element&&(G(),A.current.element=e,A.current.scrollContainers=V(e),w())},g,b]}function V(e){var t=[];if(!e||e===document.body)return t;var n=window.getComputedStyle(e);return[n.overflow,n.overflowX,n.overflowY].some((function(e){return"auto"===e||"scroll"===e}))&&t.push(e),[].concat(t,Object(h.a)(V(e.parentElement)))}var F=["x","y","top","bottom","left","right","width","height"],X=function(e,t){return F.every((function(n){return e[n]===t[n]}))},H=["children","key","ref"],O=["children","key","ref"],L=["args"],N=["args","children"],Y=["args","children"],T=["params"],z=["children","fallback","tabIndex","resize","id","style","className","events"],K=["gl","size","mode","events","onCreated"],j=Object.freeze({__proto__:null}),D={obj:function(e){return e===Object(e)&&!D.arr(e)&&"function"!==typeof e},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},und:function(e){return void 0===e},arr:function(e){return Array.isArray(e)},equ:function(e,t){if(typeof e!==typeof t||!!e!==!!t)return!1;if(D.str(e)||D.num(e)||D.obj(e))return e===t;if(D.arr(e)&&e==t)return!0;var n;for(n in e)if(!(n in t))return!1;for(n in t)if(e[n]!==t[n])return!1;return!D.und(n)||e===t}};function U(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Q(e,t,n,r){var a=n.get(t);a&&(n.delete(t),0===n.size&&(e.delete(r),a.target.releasePointerCapture(r)))}function P(e){var t=new p.Vector3;function n(e){return e.filter((function(e){return["Move","Over","Enter","Out","Leave"].some((function(t){var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}))}function r(t){var n=e.getState().internal;Array.from(n.hovered.values()).forEach((function(e){if(!t.length||!t.find((function(t){return t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId}))){var r=e.eventObject.__r3f,a=null==r?void 0:r.handlers;if(n.hovered.delete(U(e)),null!=r&&r.eventCount){var i=Object(C.a)(Object(C.a)({},e),{},{intersections:t||[]});null==a.onPointerOut||a.onPointerOut(i),null==a.onPointerLeave||a.onPointerLeave(i)}}}))}function a(e,t){t.forEach((function(t){var n;return null==(n=t.__r3f)||null==n.handlers.onPointerMissed?void 0:n.handlers.onPointerMissed(e)}))}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return function(){return r([])};case"onLostPointerCapture":return function(t){var n=e.getState().internal;"pointerId"in t&&!n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),r([]))}}return function(o){var s=e.getState(),c=s.onPointerMissed,u=s.internal;!function(t){var n,r,a,i,o=e.getState(),s=o.raycaster,c=o.mouse,u=o.camera,l=o.size,g=null==s.computeOffsets?void 0:s.computeOffsets(t,o),d=null!=(n=null==g?void 0:g.offsetX)?n:t.offsetX,I=null!=(r=null==g?void 0:g.offsetY)?r:t.offsetY,A=null!=(a=null==g?void 0:g.width)?a:l.width,h=null!=(i=null==g?void 0:g.height)?i:l.height;c.set(d/A*2-1,-I/h*2+1),s.setFromCamera(c,u)}(o),u.lastEvent.current=o;var l="onPointerMove"===i,g="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,d=function(t,n){var r=e.getState().internal;if("pointerId"in n&&r.capturedMap.has(n.pointerId)){var a,i=Object(f.a)(r.capturedMap.get(n.pointerId).values());try{for(i.s();!(a=i.n()).done;){var o=a.value;t.push(o.intersection)}}catch(s){i.e(s)}finally{i.f()}}return t}(function(t){var n=e.getState(),r=n.raycaster,a=n.internal;if(!r.enabled)return[];var i=new Set,o=[],s=t?t(a.interaction):a.interaction,c=r.intersectObjects(s,!0).filter((function(e){var t=U(e);return!i.has(t)&&(i.add(t),!0)}));r.filter&&(c=r.filter(c,n));var u,l=Object(f.a)(c);try{for(l.s();!(u=l.n()).done;)for(var g=u.value,d=g.object;d;){var I;null!=(I=d.__r3f)&&I.eventCount&&o.push(Object(C.a)(Object(C.a)({},g),{},{eventObject:d})),d=d.parent}}catch(A){l.e(A)}finally{l.f()}return o}(l?n:void 0),o),I=g?function(t){var n=e.getState().internal,r=t.offsetX-n.initialClick[0],a=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+a*a))}(o):0;"onPointerDown"===i&&(u.initialClick=[o.offsetX,o.offsetY],u.initialHits=d.map((function(e){return e.eventObject}))),g&&!d.length&&I<=2&&(a(o,u.interaction),c&&c(o)),l&&r(d),function(n,a,i,o){var s=e.getState(),c=s.raycaster,u=s.mouse,l=s.camera,g=s.internal;n.length&&function(){var e,s=t.set(u.x,u.y,0).unproject(l),d={stopped:!1},I=Object(f.a)(n);try{var A=function(){var t=e.value,I=function(e){var n,r;return null!=(n=null==(r=g.capturedMap.get(e))?void 0:r.has(t.eventObject))&&n},A=function(e){var n={intersection:t,target:a.target};g.capturedMap.has(e)?g.capturedMap.get(e).set(t.eventObject,n):g.capturedMap.set(e,new Map([[t.eventObject,n]])),a.target.setPointerCapture(e)},f=function(e){var n=g.capturedMap.get(e);n&&Q(g.capturedMap,t.eventObject,n,e)},p={};for(var m in a){var v=a[m];"function"!==typeof v&&(p[m]=v)}var b=Object(C.a)(Object(C.a)(Object(C.a)({},t),p),{},{spaceX:u.x,spaceY:u.y,intersections:n,stopped:d.stopped,delta:i,unprojectedPoint:s,ray:c.ray,camera:l,stopPropagation:function(){var e="pointerId"in a&&g.capturedMap.get(a.pointerId);if((!e||e.has(t.eventObject))&&(b.stopped=d.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find((function(e){return e.eventObject===t.eventObject})))){var i=n.slice(0,n.indexOf(t));r([].concat(Object(h.a)(i),[t]))}},target:{hasPointerCapture:I,setPointerCapture:A,releasePointerCapture:f},currentTarget:{hasPointerCapture:I,setPointerCapture:A,releasePointerCapture:f},sourceEvent:a,nativeEvent:a});if(o(b),!0===d.stopped)return"break"};for(I.s();!(e=I.n()).done&&"break"!==A(););}catch(p){I.e(p)}finally{I.f()}}()}(d,o,I,(function(e){var t=e.eventObject,n=t.__r3f,r=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(r.onPointerOver||r.onPointerEnter||r.onPointerOut||r.onPointerLeave){var s=U(e),c=u.hovered.get(s);c?c.stopped&&e.stopPropagation():(u.hovered.set(s,e),null==r.onPointerOver||r.onPointerOver(e),null==r.onPointerEnter||r.onPointerEnter(e))}null==r.onPointerMove||r.onPointerMove(e)}else{var d=r[i];d?g&&!u.initialHits.includes(t)||(a(o,u.interaction.filter((function(e){return!u.initialHits.includes(e)}))),d(e)):g&&u.initialHits.includes(t)&&a(o,u.interaction.filter((function(e){return!u.initialHits.includes(e)})))}}))}}}}var J=function(e){return e&&!!e.getState},q=function(e,t){var n,r;return{root:J(e)?e:null!=(n=null==(r=e.__r3f)?void 0:r.root)?n:t.__r3f.root,container:J(e)?e.getState().scene:e}},$="__default",ee={},te={},ne=function(e){te=Object(C.a)(Object(C.a)({},te),e)};function re(e,t){return!(!D.arr(e)||!D.equ(e,t))||e===t}function ae(e,t){var n=e;return(null!=t&&t.primitive||!n.__r3f)&&(n.__r3f=Object(C.a)({root:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t)),e}var ie=function(e){return e&&e.isOrthographicCamera};function oe(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}var se,ce=m.createContext(null),ue=function(e,t,n,r){var a=r.gl,i=r.size,o=r.shadows,s=void 0!==o&&o,c=r.linear,u=void 0!==c&&c,l=r.flat,g=void 0!==l&&l,d=r.vr,I=void 0!==d&&d,f=r.orthographic,v=void 0!==f&&f,y=r.frameloop,B=void 0===y?"always":y,G=r.dpr,w=void 0===G?1:G,_=r.performance,Z=r.clock,S=void 0===Z?new p.Clock:Z,x=r.raycaster,R=r.camera,M=r.onPointerMissed;s&&(a.shadowMap.enabled=!0,"object"===typeof s?Object.assign(a.shadowMap,s):a.shadowMap.type=p.PCFSoftShadowMap),u&&(a.outputEncoding=p.LinearEncoding),g&&(a.toneMapping=p.NoToneMapping),"never"===B&&(S.stop(),S.elapsedTime=0);var k=b()((function(i,o){var s=new p.Raycaster,c=x||{},l=c.params,d=Object(A.a)(c,T);e(s,Object(C.a)(Object(C.a)({enabled:!0},d),{},{params:Object(C.a)(Object(C.a)({},s.params),l)}));var f=R instanceof p.Camera,b=f?R:v?new p.OrthographicCamera(0,0,0,0,.1,1e3):new p.PerspectiveCamera(75,0,.1,1e3);f||(b.position.z=5,R&&e(b,R),null!=R&&R.rotation||b.lookAt(0,0,0));var y=oe(w),G=new p.Vector3,Z=new p.Vector3,k=new p.Vector3;function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o().size,r=n.width,a=n.height,i=r/a;t instanceof p.Vector3?k.copy(t):k.set.apply(k,Object(h.a)(t));var s=e.getWorldPosition(G).distanceTo(k);if(ie(e))return{width:r/e.zoom,height:a/e.zoom,factor:1,distance:s,aspect:i};var c=e.fov*Math.PI/180,u=2*Math.tan(c/2)*s,l=u*(r/a);return{width:l,height:u,factor:r/l,distance:s,aspect:i}}var W=void 0,V=function(e){return i((function(t){return{performance:Object(C.a)(Object(C.a)({},t.performance),{},{current:e})}}))};return{gl:a,set:i,get:o,invalidate:function(){return t(o())},advance:function(e,t){return n(e,t,o())},linear:u,flat:g,scene:ae(new p.Scene),camera:b,controls:null,raycaster:s,clock:S,mouse:new p.Vector2,vr:I,frameloop:B,onPointerMissed:M,performance:Object(C.a)(Object(C.a)({current:1,min:.5,max:1,debounce:200},_),{},{regress:function(){var e=o();W&&clearTimeout(W),e.performance.current!==e.performance.min&&V(e.performance.min),W=setTimeout((function(){return V(o().performance.max)}),e.performance.debounce)}}),size:{width:0,height:0},viewport:{initialDpr:y,dpr:y,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:E},setSize:function(e,t){var n={width:e,height:t};i((function(e){return{size:n,viewport:Object(C.a)(Object(C.a)({},e.viewport),E(b,Z,n))}}))},setDpr:function(e){return i((function(t){return{viewport:Object(C.a)(Object(C.a)({},t.viewport),{},{dpr:oe(e)})}}))},setFrameloop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";return i((function(){return{frameloop:e}}))},events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:r,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i((function(n){var r=n.internal;return{internal:Object(C.a)(Object(C.a)({},r),{},{priority:r.priority+(t>0?1:0),subscribers:[].concat(Object(h.a)(r.subscribers),[{ref:e,priority:t}]).sort((function(e,t){return e.priority-t.priority}))})}})),function(){i((function(n){var r=n.internal;return{internal:Object(C.a)(Object(C.a)({},r),{},{priority:r.priority-(t>0?1:0),subscribers:r.subscribers.filter((function(t){return t.ref!==e}))})}}))}}}}})),E=k.getState(),W=E.size,V=E.viewport.dpr;return k.subscribe((function(){var e=k.getState(),t=e.camera,n=e.size,r=e.viewport,i=e.internal;n===W&&r.dpr===V||(t.manual||i.lastProps.camera instanceof p.Camera||(ie(t)?(t.left=n.width/-2,t.right=n.width/2,t.top=n.height/2,t.bottom=n.height/-2):t.aspect=n.width/n.height,t.updateProjectionMatrix(),t.updateMatrixWorld()),a.setPixelRatio(r.dpr),a.setSize(n.width,n.height),W=n,V=r.dpr)})),i&&E.setSize(i.width,i.height),k.subscribe((function(e){return t(e)})),k};function le(e,t){var n=t.length;return t.push(e),function(){t.splice(n,1)}}var ge=[],de=[],Ie=[],Ae=function(e){return le(e,ge)},he=function(e){return le(e,de)},Ce=function(e){return le(e,Ie)};function fe(e,t){for(se=0;se<e.length;se++)e[se](t)}function pe(e,t){var n=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(n=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),se=0;se<t.internal.subscribers.length;se++)t.internal.subscribers[se].ref.current(t,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function me(e){var t=P(e).handlePointer,n={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(n).reduce((function(e,n){return Object(C.a)(Object(C.a)({},e),{},Object(s.a)({},n,t(n)))}),{}),connect:function(t){var r,a=e.getState(),i=a.set,o=a.events;null==o.disconnect||o.disconnect(),i((function(e){return{events:Object(C.a)(Object(C.a)({},e.events),{},{connected:t})}})),Object.entries(null!=(r=null==o?void 0:o.handlers)?r:[]).forEach((function(e){var r=Object(I.a)(e,2),a=r[0],i=r[1],o=Object(I.a)(n[a],2),s=o[0],c=o[1];t.addEventListener(s,i,{passive:c})}))},disconnect:function(){var t,r=e.getState(),a=r.set,i=r.events;i.connected&&(Object.entries(null!=(t=i.handlers)?t:[]).forEach((function(e){var t=Object(I.a)(e,2),r=t[0],a=t[1];if(i&&i.connected instanceof HTMLElement){var o=Object(I.a)(n[r],1)[0];i.connected.removeEventListener(o,a)}})),a((function(e){return{events:Object(C.a)(Object(C.a)({},e.events),{},{connected:!1})}})))}}}var ve="undefined"!==typeof window?m.useLayoutEffect:m.useEffect;function be(e){var t=e.set;return ve((function(){return t(new Promise((function(){return null}))),function(){return t(!1)}}),[]),null}var ye=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={error:!1},e}return Object(a.a)(n,[{key:"componentDidCatch",value:function(e){this.props.set(e)}},{key:"render",value:function(){return this.state.error?null:this.props.children}}]),n}(m.Component);ye.getDerivedStateFromError=function(){return{error:!0}};var Be=m.forwardRef((function(e,t){var n=e.children,r=e.fallback,a=e.tabIndex,i=e.resize,o=e.id,s=e.style,c=e.className,u=e.events,l=Object(A.a)(e,z),g=W(Object(C.a)({scroll:!0,debounce:{scroll:50,resize:0}},i)),d=Object(I.a)(g,2),h=d[0],f=d[1],p=f.width,v=f.height,b=m.useRef(null),y=m.useState(!1),B=Object(I.a)(y,2),G=B[0],w=B[1],_=m.useState(!1),Z=Object(I.a)(_,2),S=Z[0],x=Z[1];if(G)throw G;if(S)throw S;return ve((function(){p>0&&v>0&&Le(m.createElement(ye,{set:x},m.createElement(m.Suspense,{fallback:m.createElement(be,{set:w})},n)),b.current,Object(C.a)(Object(C.a)({},l),{},{size:{width:p,height:v},events:u||me}))}),[p,v,n]),ve((function(){var e=b.current;return function(){return Ye(e)}}),[]),m.createElement("div",{ref:h,id:o,className:c,tabIndex:a,style:Object(C.a)({position:"relative",width:"100%",height:"100%",overflow:"hidden"},s)},m.createElement("canvas",{ref:Object(M.default)([b,t]),style:{display:"block"}},r))}));function Ge(){var e=m.useContext(ce);if(!e)throw"R3F hooks can only be used within the Canvas component!";return e}function we(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=arguments.length>1?arguments[1]:void 0;return Ge()(e,t)}function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ge().getState().internal.subscribe,r=m.useRef(e);return m.useLayoutEffect((function(){r.current=e}),[e]),m.useLayoutEffect((function(){return n(r,t)}),[t,n]),null}function Ze(e){var t={nodes:{},materials:{}};return e&&e.traverse((function(e){e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function Se(e){return m.useMemo((function(){return Ze(e)}),[e])}function xe(e,t){return function(n){var r=new n;e&&e(r);for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return Promise.all(i.map((function(e){return new Promise((function(n,a){return r.load(e,(function(e){e.scene&&Object.assign(e,Ze(e.scene)),n(e)}),t,(function(t){return a("Could not load ".concat(e,": ").concat(t.message))}))}))})))}}function Re(e,t,n,r){var a=Array.isArray(t)?t:[t],i=R.apply(void 0,[xe(n,r),e].concat(Object(h.a)(a)));return Array.isArray(t)?i:i[0]}Re.preload=function(e,t,n){var r=Array.isArray(t)?t:[t];return R.preload.apply(R,[xe(n),e].concat(Object(h.a)(r)))},Re.clear=function(e,t){var n=Array.isArray(t)?t:[t];return R.clear.apply(R,[e].concat(Object(h.a)(n)))};var Me=new Map,ke=["legacy","blocking","concurrent"],Ee=function(e){var t,n=!1;function r(a){if(n=!0,t=0,fe(ge,a),e.forEach((function(e){var n=e.store.getState();n.internal.active&&("always"===n.frameloop||n.internal.frames>0)&&(t+=pe(a,n))})),fe(de,a),t>0)return requestAnimationFrame(r);fe(Ie,a),n=!1}return{loop:r,invalidate:function t(a){if(!a)return e.forEach((function(e){return t(e.store.getState())}));!a.vr&&a.internal.active&&"never"!==a.frameloop&&(a.internal.frames=Math.min(60,a.internal.frames+1),n||(n=!0,requestAnimationFrame(r)))},advance:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;n&&fe(ge,t),r?pe(t,r):e.forEach((function(e){return pe(t,e.store.getState())})),n&&fe(de,t)}}}(Me),We=Ee.invalidate,Ve=Ee.advance,Fe=function(e){function t(e,t){t.children,t.key,t.ref;var n,r=Object(A.a)(t,H),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(a.children,a.key,a.ref,Object(A.a)(a,O)),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null!=(n=null==e?void 0:e.__r3f)?n:{},c=Object.entries(r),u=[];if(o)for(var l=Object.keys(i),g=0;g<l.length;g++)r.hasOwnProperty(l[g])||c.unshift([l[g],$+"remove"]);c.forEach((function(t){var n,r=Object(I.a)(t,2),a=r[0],o=r[1];if((null==(n=e.__r3f)||!n.primitive||"object"!==a)&&!re(o,i[a])){if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(a))return u.push([a,o,!0,[]]);var s=[];a.includes("-")&&(s=a.split("-")),u.push([a,o,!1,s])}}));var d=Object(C.a)({},r);return s.memoizedProps&&s.memoizedProps.args&&(d.args=s.memoizedProps.args),s.memoizedProps&&s.memoizedProps.attach&&(d.attach=s.memoizedProps.attach),{accumulative:o,memoized:d,changes:u}}function n(e,n){var i,o,s,c,A=null!=(i=null==e?void 0:e.__r3f)?i:{},C=A.root,f=null!=(o=null==C||null==C.getState?void 0:C.getState())?o:{},m=(c=n)&&c.memoized&&c.changes?n:t(e,n),v=m.memoized,b=m.changes,y=A.eventCount;if(e.__r3f&&(e.__r3f.memoizedProps=v),b.forEach((function(t){var n,a,i=Object(I.a)(t,4),o=i[0],s=i[1],c=i[2],C=i[3],m=e,b=m[o];if(C.length&&(b=C.reduce((function(e,t){return e[t]}),e),!b||!b.set)){var y=C.reverse(),B=(a=y,Object(u.a)(a)||Object(l.a)(a)||Object(g.a)(a)||Object(d.a)()),G=B[0];m=B.slice(1).reverse().reduce((function(e,t){return e[t]}),e),o=G}if(s===$+"remove")if(b&&b.constructor)s=new b.constructor(v.args);else if(m.constructor){var w=new m.constructor(m.__r3f.memoizedProps.args);s=w[b],w.dispose&&w.dispose()}else s=0;var _=(null==f||null==(n=f.gl)?void 0:n.outputEncoding)===p.LinearEncoding;if(c)s?A.handlers[o]=s:delete A.handlers[o],A.eventCount=Object.keys(A.handlers).length;else if(b&&b.set&&(b.copy||b instanceof p.Layers)){var Z;if(Array.isArray(s))b.fromArray?b.fromArray(s):(Z=b).set.apply(Z,Object(h.a)(s));else if(b.copy&&s&&s.constructor&&b.constructor.name===s.constructor.name)b.copy(s);else if(void 0!==s){var S=b instanceof p.Color;!S&&b.setScalar?b.setScalar(s):b instanceof p.Layers&&s instanceof p.Layers?b.mask=s.mask:b.set(s),!_&&S&&b.convertSRGBToLinear()}}else m[o]=s,!_&&m[o]instanceof p.Texture&&(m[o].encoding=p.sRGBEncoding);r(e)})),A.parent&&f.internal&&e.raycast&&y!==A.eventCount){var B=f.internal.interaction.indexOf(e);B>-1&&f.internal.interaction.splice(B,1),A.eventCount&&f.internal.interaction.push(e)}return b.length&&null!=(s=e.__r3f)&&s.parent&&a(e),e}function r(e){var t,n,r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function a(e){null==e.onUpdate||e.onUpdate(e)}function i(e,t,r,a,i){var o,s=t.args,u=void 0===s?[]:s,l=Object(A.a)(t,L),g="".concat(e[0].toUpperCase()).concat(e.slice(1));if(!J(r)&&i){r=function e(t){return t.return?e(t.return):t.stateNode&&t.stateNode.containerInfo}(i)}if(!r||!J(r))throw"No valid root for ".concat(g,"!");if("primitive"===e){if(void 0===l.object)throw"Primitives without 'object' are invalid!";o=ae(l.object,{root:r,primitive:!0})}else{var d=te[g]||p[g];if(!d)throw"".concat(g," is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively");if(!Array.isArray(u))throw"The args prop must be an array!";o=ae(Object(c.a)(d,Object(h.a)(u)),{root:r,memoizedProps:{args:0===u.length?null:u}})}return"attachFns"in l||(g.endsWith("Geometry")?l=Object(C.a)({attach:"geometry"},l):g.endsWith("Material")&&(l=Object(C.a)({attach:"material"},l))),n(o,l),o}function o(e,t){var n=!1;if(t){if(t.attachArray)D.arr(e[t.attachArray])||(e[t.attachArray]=[]),e[t.attachArray].push(t);else if(t.attachObject)D.obj(e[t.attachObject[0]])||(e[t.attachObject[0]]={}),e[t.attachObject[0]][t.attachObject[1]]=t;else if(t.attach&&!D.fun(t.attach))e[t.attach]=t;else if(D.arr(t.attachFns)){var i=Object(I.a)(t.attachFns,1)[0];D.str(i)&&D.fun(e[i])?e[i](t):D.fun(i)&&i(t,e)}else t.isObject3D&&e.isObject3D&&(e.add(t),n=!0);n||e.__r3f.objects.push(t),t.__r3f||ae(t,{}),t.__r3f.parent=e,a(t),r(t)}}function s(e,t,n){var i=!1;if(t){if(t.attachArray){var s=e[t.attachArray];D.arr(s)||(e[t.attachArray]=[]),s.splice(s.indexOf(n),0,t)}else{if(t.attachObject||t.attach&&!D.fun(t.attach))return o(e,t);if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});var c=e.children.filter((function(e){return e!==t})),u=c.indexOf(n);e.children=[].concat(Object(h.a)(c.slice(0,u)),[t],Object(h.a)(c.slice(u))),i=!0}}i||e.__r3f.objects.push(t),t.__r3f||ae(t,{}),t.__r3f.parent=e,a(t),r(t)}}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&Object(h.a)(e).forEach((function(e){return m(t,e,n)}))}function m(e,t,n){if(t){var a,i;if(t.__r3f&&(t.__r3f.parent=null),null!=(a=e.__r3f)&&a.objects&&(e.__r3f.objects=e.__r3f.objects.filter((function(e){return e!==t}))),t.attachArray)e[t.attachArray]=e[t.attachArray].filter((function(e){return e!==t}));else if(t.attachObject)delete e[t.attachObject[0]][t.attachObject[1]];else if(t.attach&&!D.fun(t.attach)&&e[t.attach]===t)e[t.attach]=null;else if(D.arr(t.attachFns)){var o=Object(I.a)(t.attachFns,2)[1];D.str(o)&&D.fun(e[o])?e[o](t):D.fun(o)&&o(t,e)}else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){var n=e.getState().internal;n.interaction=n.interaction.filter((function(e){return e!==t})),n.initialHits=n.initialHits.filter((function(e){return e!==t})),n.hovered.forEach((function(e,r){e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach((function(e,r){Q(n.capturedMap,t,e,r)}))}(t.__r3f.root,t)}var c,u=null==(i=t.__r3f)?void 0:i.primitive,l=void 0===n?null!==t.dispose&&!u:n;if(!u)f(null==(c=t.__r3f)?void 0:c.objects,t,l),f(t.children,t,l);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,u||delete t.__r3f),l&&t.dispose&&"Scene"!==t.type&&Object(G.unstable_runWithPriority)(G.unstable_IdlePriority,(function(){try{t.dispose()}catch(e){}})),r(e)}}return{reconciler:B()({now:G.unstable_now,createInstance:i,removeChild:m,appendChild:o,appendInitialChild:o,insertBefore:s,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0,setTimeout:D.fun(setTimeout)?setTimeout:void 0,clearTimeout:D.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:function(e,t){var n=q(e,t),r=n.container,a=n.root;r.__r3f.root=a,o(r,t)},removeChildFromContainer:function(e,t){return m(q(e,t).container,t)},insertInContainerBefore:function(e,t,n){return s(q(e,t).container,t,n)},prepareUpdate:function(e,n,r,a){if(e.__r3f.primitive&&a.object&&a.object!==e)return[!0];var i=a.args,s=void 0===i?[]:i,c=(a.children,Object(A.a)(a,N)),u=r.args,l=void 0===u?[]:u,g=(r.children,Object(A.a)(r,Y));if(!Array.isArray(s))throw"The args prop must be an array!";if(s.some((function(e,t){return e!==l[t]})))return[!0];var d=t(e,c,g,!0);if(d.changes.length)return[!1,d];if(e.attach&&"function"!==typeof e.attach){var I=e.__r3f.parent;I&&I[e.attach]!==e&&o(I,e)}return null},commitUpdate:function(e,t,r,a,s,c){var u=Object(I.a)(t,2),l=u[0],g=u[1];l?function(e,t,n,r){var a,s=null==(a=e.__r3f)?void 0:a.parent;if(s){var c=i(t,n,e.__r3f.root);"primitive"!==t&&e.children&&(e.children.forEach((function(e){return o(c,e)})),e.children=[]),e.__r3f.objects.forEach((function(e){return o(c,e)})),e.__r3f.objects=[],m(s,e),o(s,c),c.raycast&&c.__r3f.eventCount&&c.__r3f.root.getState().internal.interaction.push(c),[r,r.alternate].forEach((function(e){null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))}))}}(e,r,s,c):n(e,g)},hideInstance:function(e){e.isObject3D&&(e.visible=!1,r(e))},unhideInstance:function(e,t){(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0,r(e))},hideTextInstance:function(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance:function(e){return e},getRootHostContext:function(e){return ee},getChildHostContext:function(e){return e},createTextInstance:function(){},finalizeInitialChildren:function(e){var t;return!!(null!=(t=null==e?void 0:e.__r3f)?t:{}).handlers},commitMount:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{};e.raycast&&n.handlers&&n.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},shouldDeprioritizeSubtree:function(){return!1},prepareForCommit:function(){return null},preparePortalMount:function(e){ae(e)},resetAfterCommit:function(){},shouldSetTextContent:function(){return!1},clearContainer:function(){return!1}}),applyProps:n}}(),Xe=Fe.reconciler,He=Fe.applyProps,Oe=function(e,t){var n,r="function"===typeof e?e(t):e;if(null!=(n=r)&&n.render)return r;var a=new p.WebGLRenderer(Object(C.a)({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e));return a.outputEncoding=p.sRGBEncoding,a.toneMapping=p.ACESFilmicToneMapping,e&&He(a,e),a};function Le(e,t){var n,r,a,i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=s.gl,u=s.size,l=s.mode,g=void 0===l?ke[1]:l,d=s.events,I=s.onCreated,h=Object(A.a)(s,K);u||(u={width:null!=(r=null==(a=t.parentElement)?void 0:a.clientWidth)?r:0,height:null!=(i=null==(o=t.parentElement)?void 0:o.clientHeight)?i:0});var f=Me.get(t),p=null==f?void 0:f.fiber,v=null==f?void 0:f.store,b=null==(n=v)?void 0:n.getState();if(p&&b){void 0===h.dpr||D.equ(b.viewport.dpr,oe(h.dpr))||b.setDpr(h.dpr),b.size.width===u.width&&b.size.height===u.height||b.setSize(u.width,u.height),b.frameloop!==h.frameloop&&b.setFrameloop(h.frameloop);var y=h.linear!==b.internal.lastProps.linear;y&&(Ye(t),p=void 0)}if(!p){var B=Oe(c,t);h.vr&&(B.xr.enabled=!0,B.setAnimationLoop((function(e){return Ve(e,!0)})));var G=(v=ue(He,We,Ve,Object(C.a)({gl:B,size:u},h))).getState();p=Xe.createContainer(v,ke.indexOf(g),!1,null),Me.set(t,{fiber:p,store:v}),d&&G.set({events:d(v)})}if(v&&p)return Xe.updateContainer(m.createElement(Ne,{store:v,element:e,onCreated:I,target:t}),p,null,(function(){})),v;throw"Error creating root!"}function Ne(e){var t=e.store,n=e.element,r=e.onCreated,a=e.target;return m.useEffect((function(){var e=t.getState();e.set((function(e){return{internal:Object(C.a)(Object(C.a)({},e.internal),{},{active:!0})}})),null==e.events.connect||e.events.connect(a),r&&r(e)}),[]),m.createElement(ce.Provider,{value:t},n)}function Ye(e,t){var n=Me.get(e),r=null==n?void 0:n.fiber;if(r){var a=null==n?void 0:n.store.getState();a&&(a.internal.active=!1),Xe.updateContainer(null,r,null,(function(){a&&setTimeout((function(){var n,r,i;null==a.events.disconnect||a.events.disconnect(),null==(n=a.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=a.gl)||null==i.forceContextLoss||i.forceContextLoss(),Te(a),Me.delete(e),t&&t(e)}),500)}))}}function Te(e){for(var t in e.dispose&&"Scene"!==e.type&&e.dispose(),e){var n,r;null==(n=(r=t).dispose)||n.call(r),delete e[t]}}var ze=Xe.act;function Ke(e,t){return Xe.createPortal(e,t,null,null)}Xe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"})},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(63);var a=n(40),i=n(64);function o(e,t){return Object(r.a)(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(c){s=!0,a=c}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||Object(a.a)(e,t)||Object(i.a)()}},function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(11);function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=a(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},i.apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(54);var a=n(66),i=n(40);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(a.a)(e)||Object(i.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){e.exports=n(119)},function(e,t,n){"use strict";n.r(t),t.default=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";n.d(t,"a",(function(){return oe})),n.d(t,"b",(function(){return ie})),n.d(t,"c",(function(){return D})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return Z})),n.d(t,"g",(function(){return W})),n.d(t,"h",(function(){return v})),n.d(t,"i",(function(){return ce})),n.d(t,"j",(function(){return ge})),n.d(t,"k",(function(){return ue})),n.d(t,"l",(function(){return G})),n.d(t,"m",(function(){return le})),n.d(t,"n",(function(){return y})),n.d(t,"o",(function(){return se})),n.d(t,"p",(function(){return de})),n.d(t,"q",(function(){return B})),n.d(t,"r",(function(){return Ie}));var r=n(16),a=n(3),i=n(12),o=n(11),s=n(6),c=n(7),u=n(2),l=n(4),g=n(5),d=n(22),I=n(10),A=n(23);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function m(e){return e?e[0].toUpperCase()+e.slice(1):""}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=p[e],a=r&&r[t]||t;return"on"+m(e)+m(a)+(n?"Capture":"")}var b=["gotpointercapture","lostpointercapture"];function y(e){var t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));var r=b.includes(t)?"capturecapture":"capture",a=!!~t.indexOf(r);return a&&(t=t.replace("capture","")),{device:t,capture:a,passive:n}}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=p[e],r=n&&n[t]||t;return e+r}function G(e){return"touches"in e}function w(e){return G(e)?function(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}(e)[0]:e}function _(e,t){var n=t.clientX-e.clientX,r=t.clientY-e.clientY,a=(t.clientX+e.clientX)/2,i=(t.clientY+e.clientY)/2,o=Math.hypot(n,r);return{angle:-180*Math.atan2(n,r)/Math.PI,distance:o,origin:[a,i]}}function Z(e){return function(e){return Array.from(e.touches).filter((function(t){var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}))}(e).map((function(e){return e.identifier}))}function S(e,t){var n=Array.from(e.touches).filter((function(e){return t.includes(e.identifier)})),r=Object(I.a)(n,2);return _(r[0],r[1])}function x(e){var t=w(e);return G(e)?t.identifier:t.pointerId}function R(e){var t=w(e);return[t.clientX,t.clientY]}function M(e){var t=e.deltaX,n=e.deltaY,r=e.deltaMode;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function k(e){if("function"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}return e}function E(){}function W(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?E:1===t.length?t[0]:function(){var e,n,r=Object(d.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;e=a.apply(this,arguments)||e}}catch(i){r.e(i)}finally{r.f()}return e}}function V(e,t){return Object.assign({},t,e||{})}var F=function(){function e(t,n,r){Object(l.a)(this,e),this.ctrl=t,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}return Object(g.a)(e,[{key:"state",get:function(){return this.ctrl.state[this.key]},set:function(e){this.ctrl.state[this.key]=e}},{key:"shared",get:function(){return this.ctrl.state.shared}},{key:"eventStore",get:function(){return this.ctrl.gestureEventStores[this.key]}},{key:"timeoutStore",get:function(){return this.ctrl.gestureTimeoutStores[this.key]}},{key:"config",get:function(){return this.ctrl.config[this.key]}},{key:"sharedConfig",get:function(){return this.ctrl.config.shared}},{key:"handler",get:function(){return this.ctrl.handlers[this.key]}},{key:"reset",value:function(){var e=this.state,t=this.shared,n=this.ingKey,r=this.args;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}},{key:"start",value:function(e){var t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?k(n.from,t):t.offset,t.offset=t.lastOffset),t.startTime=t.timeStamp=e.timeStamp}},{key:"computeValues",value:function(e){var t=this.state;t._values=e,t.values=this.config.transform(e)}},{key:"computeInitial",value:function(){var e=this.state;e._initial=e._values,e.initial=e.values}},{key:"compute",value:function(e){var t=this.state,n=this.config,r=this.shared;t.args=this.args;var a=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){var t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){var n=e.shiftKey,r=e.altKey,a=e.metaKey,i=e.ctrlKey;Object.assign(t,{shiftKey:n,altKey:r,metaKey:a,ctrlKey:i})}return t}(e)),r.down=r.pressed=r.buttons%2===1||r.touches>0,a=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){var i=t._delta.map(Math.abs);A.a.addTo(t._distance,i)}var o=Object(I.a)(t._movement,2),s=o[0],c=o[1],u=Object(I.a)(n.threshold,2),l=u[0],g=u[1],d=t._step,h=t.values;if(n.hasCustomTransform?(!1===d[0]&&(d[0]=Math.abs(s)>=l&&h[0]),!1===d[1]&&(d[1]=Math.abs(c)>=g&&h[1])):(!1===d[0]&&(d[0]=Math.abs(s)>=l&&Math.sign(s)*l),!1===d[1]&&(d[1]=Math.abs(c)>=g&&Math.sign(c)*g)),t.intentional=!1!==d[0]||!1!==d[1],t.intentional){var C=[0,0];if(n.hasCustomTransform){var f=Object(I.a)(h,2),p=f[0],m=f[1];C[0]=!1!==d[0]?p-d[0]:0,C[1]=!1!==d[1]?m-d[1]:0}else C[0]=!1!==d[0]?s-d[0]:0,C[1]=!1!==d[1]?c-d[1]:0;this.intent&&this.intent(C);var v=t.offset,b=t._active&&!t._blocked||t.active;b&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=k(n.bounds,t)),this.setup&&this.setup()),t.movement=C,this.computeOffset()));var y=Object(I.a)(t.offset,2),B=y[0],G=y[1],w=Object(I.a)(t._bounds,2),_=Object(I.a)(w[0],2),Z=_[0],S=_[1],x=Object(I.a)(w[1],2),R=x[0],M=x[1];t.overflow=[B<Z?-1:B>S?1:0,G<R?-1:G>M?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);var E=t._active&&n.rubberband||[0,0];if(t.offset=Object(A.b)(t._bounds,t.offset,E),t.delta=A.a.sub(t.offset,v),this.computeMovement(),b&&(!t.last||a>32)){t.delta=A.a.sub(t.offset,v);var W=t.delta.map(Math.abs);A.a.addTo(t.distance,W),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&a>0&&(t.velocity=[W[0]/a,W[1]/a])}}}},{key:"emit",value:function(){var e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),!e._blocked&&e.intentional||e._force||n.triggerAllEvents){var r=this.handler(f(f(f({},t),e),{},Object(u.a)({},this.aliasKey,e.values)));void 0!==r&&(e.memo=r)}}},{key:"clean",value:function(){this.eventStore.clean(),this.timeoutStore.clean()}}]),e}();var X=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"aliasKey","xy"),e}return Object(g.a)(n,[{key:"reset",value:function(){Object(i.a)(Object(o.a)(n.prototype),"reset",this).call(this),this.state.axis=void 0}},{key:"init",value:function(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}},{key:"computeOffset",value:function(){this.state.offset=A.a.add(this.state.lastOffset,this.state.movement)}},{key:"computeMovement",value:function(){this.state.movement=A.a.sub(this.state.offset,this.state.lastOffset)}},{key:"intent",value:function(e){this.state.axis=this.state.axis||function(e){var t=Object(I.a)(e,2),n=t[0],r=t[1],a=Math.abs(n)-Math.abs(r);return a>0?"x":a<0?"y":void 0}(e),this.state._blocked=(this.config.lockDirection||!!this.config.axis)&&!this.state.axis||!!this.config.axis&&this.config.axis!==this.state.axis,this.state._blocked||(this.config.axis||this.config.lockDirection)&&function(e,t){switch(t){case"x":e[1]=0;break;case"y":e[0]=0}}(e,this.state.axis)}}]),n}(F),H=function(e){return e},O=.15,L={enabled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e},preventDefault:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e},triggerAllEvents:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e},rubberband:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return[O,O];case!1:return[0,0];default:return A.a.toVector(e)}},from:function(e){return"function"===typeof e?e:null!=e?A.a.toVector(e):void 0},transform:function(e,t,n){var r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||H},threshold:function(e){return A.a.toVector(e,0)}};var N=f(f({},L),{},{axis:function(e,t,n){var r=n.axis;if(this.lockDirection="lock"===r,!this.lockDirection)return r},bounds:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("function"===typeof e)return function(t){return N.bounds(e(t))};if("current"in e)return function(){return e.current};if("function"===typeof HTMLElement&&e instanceof HTMLElement)return e;var t=e.left,n=void 0===t?-1/0:t,r=e.right,a=void 0===r?1/0:r,i=e.top,o=void 0===i?-1/0:i,s=e.bottom,c=void 0===s?1/0:s;return[[n,a],[o,c]]}}),Y=10,T={ArrowRight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return[Y*e,0]},ArrowLeft:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return[-10*e,0]},ArrowUp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return[0,-10*e]},ArrowDown:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return[0,Y*e]}},z=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","dragging"),e}return Object(g.a)(n,[{key:"reset",value:function(){Object(i.a)(Object(o.a)(n.prototype),"reset",this).call(this);var e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}},{key:"setup",value:function(){var e=this.state;if(e._bounds instanceof HTMLElement){var t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),r={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=N.bounds(r)}}},{key:"cancel",value:function(){var e=this,t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout((function(){e.compute(),e.emit()}),0))}},{key:"setActive",value:function(){this.state._active=this.state._pointerActive||this.state._keyboardActive}},{key:"clean",value:function(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,Object(i.a)(Object(o.a)(n.prototype),"clean",this).call(this)}},{key:"pointerDown",value:function(e){var t=this.config,n=this.state;(null==e.buttons||(Array.isArray(t.pointerButtons)?t.pointerButtons.includes(e.buttons):-1===t.pointerButtons||t.pointerButtons===e.buttons))&&(this.ctrl.setEventIds(e),t.pointerCapture&&e.target.setPointerCapture(e.pointerId),n._pointerActive||(this.start(e),this.setupPointer(e),n._pointerId=x(e),n._pointerActive=!0,this.computeValues(R(e)),this.computeInitial(),t.preventScrollAxis?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?this.setupDelayTrigger(e):this.startPointerDrag(e)))}},{key:"startPointerDrag",value:function(e){var t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}},{key:"pointerMove",value:function(e){var t=this.state,n=this.config;if(t._pointerActive&&(t.type!==e.type||e.timeStamp!==t.timeStamp)){var r=x(e);if(void 0===t._pointerId||r===t._pointerId){var a=R(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=A.a.sub(a,t._values),this.computeValues(a)),A.a.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}}}},{key:"pointerUp",value:function(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(G){0}var t=this.state,n=this.config;if(t._active&&t._pointerActive){var r=x(e);if(void 0===t._pointerId||r===t._pointerId){this.state._pointerActive=!1,this.setActive(),this.compute(e);var a=Object(I.a)(t._distance,2),i=a[0],o=a[1];if(t.tap=i<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{var s=Object(I.a)(t.direction,2),c=s[0],u=s[1],l=Object(I.a)(t.velocity,2),g=l[0],d=l[1],A=Object(I.a)(t.movement,2),h=A[0],C=A[1],f=Object(I.a)(n.swipe.velocity,2),p=f[0],m=f[1],v=Object(I.a)(n.swipe.distance,2),b=v[0],y=v[1],B=n.swipe.duration;t.elapsedTime<B&&(Math.abs(g)>p&&Math.abs(h)>b&&(t.swipe[0]=c),Math.abs(d)>m&&Math.abs(C)>y&&(t.swipe[1]=u))}this.emit()}}}},{key:"pointerClick",value:function(e){this.state.tap||(e.preventDefault(),e.stopPropagation())}},{key:"setupPointer",value:function(e){var t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}},{key:"pointerClean",value:function(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}},{key:"preventScroll",value:function(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}},{key:"setupScrollPrevention",value:function(e){!function(e){"persist"in e&&"function"===typeof e.persist&&e.persist()}(e),this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1}),this.eventStore.add(this.sharedConfig.window,"touch","end",this.clean.bind(this)),this.eventStore.add(this.sharedConfig.window,"touch","cancel",this.clean.bind(this)),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}},{key:"setupDelayTrigger",value:function(e){var t=this;this.state._delayed=!0,this.timeoutStore.add("dragDelay",(function(){t.state._step=[0,0],t.startPointerDrag(e)}),this.config.delay)}},{key:"keyDown",value:function(e){var t=T[e.key];if(t){var n=this.state,r=e.shiftKey?10:e.altKey?.1:1;n._delta=t(r),this.start(e),n._keyboardActive=!0,A.a.addTo(n._movement,n._delta),this.compute(e),this.emit()}}},{key:"keyUp",value:function(e){e.key in T&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}},{key:"bind",value:function(e){var t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this)),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}]),n}(X);var K="undefined"!==typeof window&&window.document&&window.document.createElement;function j(){return K&&"ontouchstart"in window||K&&window.navigator.maxTouchPoints>1}var D={isBrowser:K,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:j(),touchscreen:j(),pointer:K&&"onpointerdown"in window,pointerLock:K&&"exitPointerLock"in window.document},U=f(f({},N),{},{device:function(e,t,n){var r=n.pointer,a=(r=void 0===r?{}:r).touch,i=void 0!==a&&a,o=r.lock,s=void 0!==o&&o,c=r.mouse,u=void 0!==c&&c;return this.pointerLock=s&&D.pointerLock,D.touch&&i?"touch":this.pointerLock?"mouse":D.pointer&&!u?"pointer":D.touch?"touch":"mouse"},preventScrollAxis:function(e,t,n){var r=n.preventScroll;if(this.preventScrollDelay="number"===typeof r?r:r||void 0===r&&e?250:void 0,D.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture:function(e,t,n){var r=n.pointer,a=(r=void 0===r?{}:r).capture,i=void 0===a||a,o=r.buttons,s=void 0===o?1:o;return this.pointerButtons=s,!this.pointerLock&&"pointer"===this.device&&i},threshold:function(e,t,n){var r=n.filterTaps,a=void 0!==r&&r,i=n.tapsThreshold,o=void 0===i?3:i,s=n.axis,c=void 0===s?void 0:s,u=A.a.toVector(e,a?o:c?1:0);return this.filterTaps=a,this.tapsThreshold=o,u},swipe:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.velocity,n=void 0===t?.5:t,r=e.distance,a=void 0===r?50:r,i=e.duration,o=void 0===i?250:i;return{velocity:this.transform(A.a.toVector(n)),distance:this.transform(A.a.toVector(a)),duration:o}},delay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;switch(e){case!0:return 180;case!1:return 0;default:return e}}});var Q=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","pinching"),h(Object(a.a)(e),"aliasKey","da"),e}return Object(g.a)(n,[{key:"init",value:function(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}},{key:"reset",value:function(){Object(i.a)(Object(o.a)(n.prototype),"reset",this).call(this);var e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}},{key:"computeOffset",value:function(){var e=this.state,t=e.type,n=e.movement,r=e.lastOffset;this.state.offset="wheel"===t?A.a.add(n,r):[(1+n[0])*r[0],n[1]+r[1]]}},{key:"computeMovement",value:function(){var e=this.state,t=e.offset,n=e.lastOffset;this.state.movement=[t[0]/n[0],t[1]-n[1]]}},{key:"intent",value:function(e){var t=this.state;if(!t.axis){var n=30*Math.abs(e[0])-Math.abs(e[1]);n<0?t.axis="angle":n>0&&(t.axis="scale")}this.config.lockDirection&&("scale"===t.axis?e[1]=0:"angle"===t.axis&&(e[0]=0))}},{key:"cancel",value:function(){var e=this,t=this.state;t.canceled||setTimeout((function(){t.canceled=!0,t._active=!1,e.compute(),e.emit()}),0)}},{key:"touchStart",value:function(e){this.ctrl.setEventIds(e);var t=this.state,n=this.ctrl.touchIds;if((!t._active||!t._touchIds.every((function(e){return n.has(e)})))&&!(n.size<2)){this.start(e),t._touchIds=Array.from(n).slice(0,2);var r=S(e,t._touchIds);this.pinchStart(e,r)}}},{key:"pointerStart",value:function(e){if(null==e.buttons||e.buttons%2===1){this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);var t=this.state,n=t._pointerEvents,a=this.ctrl.pointerIds;if((!t._active||!Array.from(n.keys()).every((function(e){return a.has(e)})))&&(n.size<2&&n.set(e.pointerId,e),!(t._pointerEvents.size<2))){this.start(e);var i=_.apply(void 0,Object(r.a)(Array.from(n.values())));this.pinchStart(e,i)}}}},{key:"pinchStart",value:function(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}},{key:"touchMove",value:function(e){if(this.state._active){var t=S(e,this.state._touchIds);this.pinchMove(e,t)}}},{key:"pointerMove",value:function(e){var t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),this.state._active){var n=_.apply(void 0,Object(r.a)(Array.from(t.values())));this.pinchMove(e,n)}}},{key:"pinchMove",value:function(e,t){var n=this.state,r=n._values[1],a=t.angle-r,i=0;Math.abs(a)>270&&(i+=Math.sign(a)),this.computeValues([t.distance,t.angle-360*i]),n.origin=t.origin,n.turns=i,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}},{key:"touchEnd",value:function(e){var t=this;this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some((function(e){return!t.ctrl.touchIds.has(e)}))&&(this.state._active=!1,this.compute(e),this.emit())}},{key:"pointerEnd",value:function(e){var t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(n){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}},{key:"gestureStart",value:function(e){e.cancelable&&e.preventDefault();var t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}},{key:"gestureMove",value:function(e){if(e.cancelable&&e.preventDefault(),this.state._active){var t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];var n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=A.a.sub(t._movement,n),this.compute(e),this.emit()}}},{key:"gestureEnd",value:function(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}},{key:"wheel",value:function(e){e.ctrlKey&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}},{key:"wheelStart",value:function(e){this.start(e),this.wheelChange(e)}},{key:"wheelChange",value:function(e){"uv"in e||e.cancelable&&e.preventDefault();var t=this.state;t._delta=[-M(e)[1]/100*t.offset[0],0],A.a.addTo(t._movement,t._delta),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}},{key:"wheelEnd",value:function(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}},{key:"bind",value:function(e){var t=this.config.device;t?(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this))):e("wheel","",this.wheel.bind(this),{passive:!1})}}]),n}(F),P=f(f({},L),{},{device:function(e,t,n){var r=n.shared,a=n.pointer,i=(a=void 0===a?{}:a).touch,o=void 0!==i&&i;if(r.target&&!D.touch&&D.gesture)return"gesture";if(D.touch&&o)return"touch";if(D.touchscreen){if(D.pointer)return"pointer";if(D.touch)return"touch"}},bounds:function(e,t,n){var r=n.scaleBounds,a=void 0===r?{}:r,i=n.angleBounds,o=void 0===i?{}:i,s=function(e){var t=V(k(a,e),{min:-1/0,max:1/0});return[t.min,t.max]},c=function(e){var t=V(k(o,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!==typeof a&&"function"!==typeof o?[s(),c()]:function(e){return[s(e),c(e)]}},threshold:function(e,t,n){this.lockDirection="lock"===n.axis;var r=A.a.toVector(e,this.lockDirection?[.1,3]:0);return r}}),J=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","moving"),e}return Object(g.a)(n,[{key:"move",value:function(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}},{key:"moveStart",value:function(e){this.start(e),this.computeValues(R(e)),this.compute(e),this.computeInitial(),this.emit()}},{key:"moveChange",value:function(e){if(this.state._active){var t=R(e),n=this.state;n._delta=A.a.sub(t,n._values),A.a.addTo(n._movement,n._delta),this.computeValues(t),this.compute(e),this.emit()}}},{key:"moveEnd",value:function(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}},{key:"bind",value:function(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}]),n}(X),q=f(f({},N),{},{mouseOnly:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e}}),$=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","scrolling"),e}return Object(g.a)(n,[{key:"scroll",value:function(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}},{key:"scrollChange",value:function(e){e.cancelable&&e.preventDefault();var t=this.state,n=function(e){var t,n,r=e.currentTarget,a=r.scrollX,i=r.scrollY,o=r.scrollLeft,s=r.scrollTop;return[null!==(t=null!==a&&void 0!==a?a:o)&&void 0!==t?t:0,null!==(n=null!==i&&void 0!==i?i:s)&&void 0!==n?n:0]}(e);t._delta=A.a.sub(n,t._values),A.a.addTo(t._movement,t._delta),this.computeValues(n),this.compute(e),this.emit()}},{key:"scrollEnd",value:function(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}},{key:"bind",value:function(e){e("scroll","",this.scroll.bind(this))}}]),n}(X),ee=N,te=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","wheeling"),e}return Object(g.a)(n,[{key:"wheel",value:function(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}},{key:"wheelChange",value:function(e){var t=this.state;t._delta=M(e),A.a.addTo(t._movement,t._delta);var n=Object(I.a)(t.overflow,2),r=n[0],a=n[1],i=Object(I.a)(t._delta,2),o=i[0],s=i[1],c=Object(I.a)(t._direction,2),u=c[0],l=c[1];(r<0&&o>0&&u<0||r>0&&o<0&&u>0)&&(t._movement[0]=t._movementBound[0]),(a<0&&s>0&&l<0||a>0&&s<0&&l>0)&&(t._movement[1]=t._movementBound[1]),this.compute(e),this.emit()}},{key:"wheelEnd",value:function(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}},{key:"bind",value:function(e){e("wheel","",this.wheel.bind(this))}}]),n}(X),ne=N,re=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),h(Object(a.a)(e),"ingKey","hovering"),e}return Object(g.a)(n,[{key:"enter",value:function(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(R(e)),this.compute(e),this.emit())}},{key:"leave",value:function(e){if(!this.config.mouseOnly||"mouse"===e.pointerType){var t=this.state;if(t._active){t._active=!1;var n=R(e);t._movement=t._delta=A.a.sub(n,t._values),this.computeValues(n),this.compute(e),t.delta=t.movement,this.emit()}}}},{key:"bind",value:function(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}]),n}(X),ae=f(f({},N),{},{mouseOnly:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e}}),ie=new Map,oe=new Map;function se(e){ie.set(e.key,e.engine),oe.set(e.key,e.resolver)}var ce={key:"drag",engine:z,resolver:U},ue={key:"hover",engine:re,resolver:ae},le={key:"move",engine:J,resolver:q},ge={key:"pinch",engine:Q,resolver:P},de={key:"scroll",engine:$,resolver:ee},Ie={key:"wheel",engine:te,resolver:ne}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(40);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Object(r.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n(10);function a(e,t,n){return Math.max(t,Math.min(e,n))}var i={toVector:function(e,t){return void 0===e&&(e=t),Array.isArray(e)?e:[e,e]},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},sub:function(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo:function(e,t){e[0]+=t[0],e[1]+=t[1]},subTo:function(e,t){e[0]-=t[0],e[1]-=t[1]}};function o(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function s(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15;return 0===r?a(e,t,n):e<t?-o(t-e,n-t,r)+t:e>n?+o(e-n,n-t,r)+n:e}function c(e,t,n){var a=Object(r.a)(t,2),i=a[0],o=a[1],c=Object(r.a)(n,2),u=c[0],l=c[1],g=Object(r.a)(e,2),d=Object(r.a)(g[0],2),I=d[0],A=d[1],h=Object(r.a)(g[1],2),C=h[0],f=h[1];return[s(i,I,A,u),s(o,C,f,l)]}},function(e,t,n){"use strict";e.exports=n(192)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(48),a=n(65);function i(e,t,n){return i=Object(a.a)()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var i=new(Function.bind.apply(e,a));return n&&Object(r.a)(i,n.prototype),i},i.apply(null,arguments)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return S})),n.d(t,"d",(function(){return I})),n.d(t,"e",(function(){return B})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return A}));var r=n(10),a=n(12),i=n(11),o=n(6),s=n(7),c=n(4),u=n(5),l=n(8),g=n(1),d=Symbol.for("Animated:node"),I=function(e){return e&&e[d]},A=function(e,t){return Object(l.h)(e,d,t)},h=function(e){return e&&e[d]&&e[d].getPayload()},C=function(){function e(){Object(c.a)(this,e),this.payload=void 0,A(this,this)}return Object(u.a)(e,[{key:"getPayload",value:function(){return this.payload||[]}}]),e}(),f=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).done=!0,r.elapsedTime=void 0,r.lastPosition=void 0,r.lastVelocity=void 0,r.v0=void 0,r.durationProgress=0,r._value=e,l.s.num(r._value)&&(r.lastPosition=r._value),r}return Object(u.a)(n,[{key:"getPayload",value:function(){return[this]}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e,t){return l.s.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}},{key:"reset",value:function(){var e=this.done;this.done=!1,l.s.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}],[{key:"create",value:function(e){return new n(e)}}]),n}(C),p=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,0))._string=null,r._toString=void 0,r._toString=Object(l.f)({output:[e,e]}),r}return Object(u.a)(n,[{key:"getValue",value:function(){var e=this._string;return null==e?this._string=this._toString(this._value):e}},{key:"setValue",value:function(e){if(l.s.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!Object(a.a)(Object(i.a)(n.prototype),"setValue",this).call(this,e))return!1;this._string=null}return!0}},{key:"reset",value:function(e){e&&(this._toString=Object(l.f)({output:[this.getValue(),e]})),this._value=0,Object(a.a)(Object(i.a)(n.prototype),"reset",this).call(this)}}],[{key:"create",value:function(e){return new n(e)}}]),n}(f),m={dependencies:null},v=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).source=e,r.setValue(e),r}return Object(u.a)(n,[{key:"getValue",value:function(e){var t={};return Object(l.l)(this.source,(function(n,r){var a;(a=n)&&a[d]===a?t[r]=n.getValue(e):Object(l.r)(n)?t[r]=Object(l.q)(n):e||(t[r]=n)})),t}},{key:"setValue",value:function(e){this.source=e,this.payload=this._makePayload(e)}},{key:"reset",value:function(){this.payload&&Object(l.k)(this.payload,(function(e){return e.reset()}))}},{key:"_makePayload",value:function(e){if(e){var t=new Set;return Object(l.l)(e,this._addToPayload,t),Array.from(t)}}},{key:"_addToPayload",value:function(e){var t=this;m.dependencies&&Object(l.r)(e)&&m.dependencies.add(e);var n=h(e);n&&Object(l.k)(n,(function(e){return t.add(e)}))}}]),n}(C),b=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){return Object(c.a)(this,n),t.call(this,e)}return Object(u.a)(n,[{key:"getValue",value:function(){return this.source.map((function(e){return e.getValue()}))}},{key:"setValue",value:function(e){var t=this.getPayload();return e.length==t.length?t.map((function(t,n){return t.setValue(e[n])})).some(Boolean):(Object(a.a)(Object(i.a)(n.prototype),"setValue",this).call(this,e.map(y)),!0)}}],[{key:"create",value:function(e){return new n(e)}}]),n}(v);function y(e){return(Object(l.t)(e)?p:f).create(e)}function B(e){var t=I(e);return t?t.constructor:l.s.arr(e)?b:Object(l.t)(e)?p:f}function G(){return G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},G.apply(this,arguments)}var w=function(e,t){var n=!l.s.fun(e)||e.prototype&&e.prototype.isReactComponent;return Object(g.forwardRef)((function(a,i){var o=Object(g.useRef)(null),s=n&&Object(g.useCallback)((function(e){o.current=function(e,t){e&&(l.s.fun(e)?e(t):e.current=t);return t}(i,e)}),[i]),c=function(e,t){var n=new Set;m.dependencies=n,e.style&&(e=G({},e,{style:t.createAnimatedStyle(e.style)}));return e=new v(e),m.dependencies=null,[e,n]}(a,t),u=Object(r.a)(c,2),d=u[0],I=u[1],A=Object(l.z)(),h=function(){var e=o.current;n&&!e||!1===(!!e&&t.applyAnimatedValues(e,d.getValue(!0)))&&A()},C=new _(h,I),f=Object(g.useRef)();Object(l.A)((function(){var e=f.current;f.current=C,Object(l.k)(I,(function(e){return Object(l.c)(e,C)})),e&&(Object(l.k)(e.deps,(function(t){return Object(l.x)(t,e)})),l.w.cancel(e.update))})),Object(g.useEffect)(h,[]),Object(l.C)((function(){return function(){var e=f.current;Object(l.k)(e.deps,(function(t){return Object(l.x)(t,e)}))}}));var p=t.getComponentProps(d.getValue());return g.createElement(e,G({},p,{ref:s}))}))},_=function(){function e(t,n){Object(c.a)(this,e),this.update=t,this.deps=n}return Object(u.a)(e,[{key:"eventObserved",value:function(e){"change"==e.type&&l.w.write(this.update)}}]),e}();var Z=Symbol.for("AnimatedComponent"),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.applyAnimatedValues,r=void 0===n?function(){return!1}:n,a=t.createAnimatedStyle,i=void 0===a?function(e){return new v(e)}:a,o=t.getComponentProps,s=void 0===o?function(e){return e}:o,c={applyAnimatedValues:r,createAnimatedStyle:i,getComponentProps:s},u=function e(t){var n=x(t)||"Anonymous";return(t=l.s.str(t)?e[t]||(e[t]=w(t,c)):t[Z]||(t[Z]=w(t,c))).displayName="Animated(".concat(n,")"),t};return Object(l.l)(e,(function(t,n){l.s.arr(e)&&(n=x(t)),u[n]=u(t)})),{animated:u}},x=function(e){return l.s.str(e)?e:e&&l.s.str(e.displayName)?e.displayName:l.s.fun(e)&&e.name||null}},function(e,t,n){"use strict";var r=n(21);n.d(t,"a",(function(){return r.i})),n.d(t,"b",(function(){return r.k})),n.d(t,"c",(function(){return r.m})),n.d(t,"d",(function(){return r.j})),n.d(t,"e",(function(){return r.o})),n.d(t,"f",(function(){return r.p})),n.d(t,"g",(function(){return r.r}))},,function(e,t,n){var r=n(114);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(38),a=n(115),i=n(116);e.exports=function(e){var t=a();return function(){var n,a=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return i(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THREE=void 0;var r=n(0);t.THREE=r},function(e,t,n){"use strict";function r(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,c,"next",e)}function c(e){r(o,a,i,s,c,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";var r=n(17),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.loadedPromise=t.loaded=t.browserIncompatibleUI=t.browserIncompatible=t.drawPlane=t.projectionMatrixFromCameraModel=t.invert=t.cameraDefaultDeviceID=t.z=void 0;var i,o=n(51),s=n(36),c=n(144);function u(){return i||(console.log("Zappar JS v".concat(c.VERSION)),i=o.initialize()),i}function l(){return u().loaded()}function g(e){return new Promise((function(t){return setTimeout(t,e)}))}t.z=u,t.cameraDefaultDeviceID=function(e){return u().camera_default_device_id(e||!1)},t.invert=function(e){var t=s.mat4.create();return s.mat4.invert(t,e),t},t.projectionMatrixFromCameraModel=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100;return u().projection_matrix_from_camera_model_ext(e,t,n,r,a)},t.drawPlane=function(e,t,n,r,a){u().draw_plane(e,t,n,r,a)},t.browserIncompatible=function(){return u().browser_incompatible()},t.browserIncompatibleUI=function(){u().browser_incompatible_ui()},t.loaded=l,t.loadedPromise=function(){return a(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,g(50);case 5:e.next=0;break;case 7:case"end":return e.stop()}}),e)})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadedPromise=t.loaded=t.browserIncompatibleUI=t.browserIncompatible=t.permissionRequestUI=t.permissionDeniedUI=t.permissionRequest=t.permissionGranted=t.permissionDenied=t.setLogLevel=t.LogLevel=t.Pipeline=t.FaceLandmarkName=t.FaceLandmark=t.FaceMesh=t.getDefaultPipeline=t.glContextLost=t.glContextSet=t.onFrameUpdate=t.HTMLElementSource=t.CameraSource=t.FaceTracker=t.BarcodeFinder=t.InstantWorldTracker=t.ImageTracker=t.CameraEnvironmentMap=t.DefaultLoaderUI=t.LoadingManager=t.LibraryLoader=t.HeadMaskMeshLoader=t.HeadMaskMesh=t.FaceMeshLoader=t.FaceBufferGeometry=t.FaceTrackerLoader=t.FaceLandmarkGroup=t.FaceAnchorGroup=t.InstantWorldAnchorGroup=t.ImageTrackerLoader=t.ImageAnchorGroup=t.CameraMirrorMode=t.CameraPoseMode=t.Camera=void 0;var r=n(112);console.log("Zappar for ThreeJS v".concat(r.VERSION));var a=n(42);Object.defineProperty(t,"Camera",{enumerable:!0,get:function(){return a.Camera}}),Object.defineProperty(t,"CameraPoseMode",{enumerable:!0,get:function(){return a.CameraPoseMode}}),Object.defineProperty(t,"CameraMirrorMode",{enumerable:!0,get:function(){return a.CameraMirrorMode}});var i=n(155);Object.defineProperty(t,"ImageAnchorGroup",{enumerable:!0,get:function(){return i.ImageAnchorGroup}});var o=n(156);Object.defineProperty(t,"ImageTrackerLoader",{enumerable:!0,get:function(){return o.ImageTrackerLoader}});var s=n(157);Object.defineProperty(t,"InstantWorldAnchorGroup",{enumerable:!0,get:function(){return s.InstantWorldAnchorGroup}});var c=n(158);Object.defineProperty(t,"FaceAnchorGroup",{enumerable:!0,get:function(){return c.FaceAnchorGroup}});var u=n(159);Object.defineProperty(t,"FaceLandmarkGroup",{enumerable:!0,get:function(){return u.FaceLandmarkGroup}});var l=n(160);Object.defineProperty(t,"FaceTrackerLoader",{enumerable:!0,get:function(){return l.FaceTrackerLoader}});var g=n(87);Object.defineProperty(t,"FaceBufferGeometry",{enumerable:!0,get:function(){return g.FaceBufferGeometry}});var d=n(88);Object.defineProperty(t,"FaceMeshLoader",{enumerable:!0,get:function(){return d.FaceMeshLoader}});var I=n(89);Object.defineProperty(t,"HeadMaskMesh",{enumerable:!0,get:function(){return I.HeadMaskMesh}});var A=n(161);Object.defineProperty(t,"HeadMaskMeshLoader",{enumerable:!0,get:function(){return A.HeadMaskMeshLoader}});var h=n(90);Object.defineProperty(t,"LibraryLoader",{enumerable:!0,get:function(){return h.LibraryLoader}});var C=n(162);Object.defineProperty(t,"LoadingManager",{enumerable:!0,get:function(){return C.LoadingManager}}),Object.defineProperty(t,"DefaultLoaderUI",{enumerable:!0,get:function(){return C.DefaultLoaderUI}});var f=n(163);Object.defineProperty(t,"CameraEnvironmentMap",{enumerable:!0,get:function(){return f.CameraEnvironmentMap}});var p=n(61);Object.defineProperty(t,"ImageTracker",{enumerable:!0,get:function(){return p.ImageTracker}}),Object.defineProperty(t,"InstantWorldTracker",{enumerable:!0,get:function(){return p.InstantWorldTracker}}),Object.defineProperty(t,"BarcodeFinder",{enumerable:!0,get:function(){return p.BarcodeFinder}}),Object.defineProperty(t,"FaceTracker",{enumerable:!0,get:function(){return p.FaceTracker}}),Object.defineProperty(t,"CameraSource",{enumerable:!0,get:function(){return p.CameraSource}}),Object.defineProperty(t,"HTMLElementSource",{enumerable:!0,get:function(){return p.HTMLElementSource}}),Object.defineProperty(t,"onFrameUpdate",{enumerable:!0,get:function(){return p.onFrameUpdate}}),Object.defineProperty(t,"glContextSet",{enumerable:!0,get:function(){return p.glContextSet}}),Object.defineProperty(t,"glContextLost",{enumerable:!0,get:function(){return p.glContextLost}}),Object.defineProperty(t,"getDefaultPipeline",{enumerable:!0,get:function(){return p.getDefaultPipeline}});var m=n(44);Object.defineProperty(t,"FaceMesh",{enumerable:!0,get:function(){return m.FaceMesh}}),Object.defineProperty(t,"FaceLandmark",{enumerable:!0,get:function(){return m.FaceLandmark}}),Object.defineProperty(t,"FaceLandmarkName",{enumerable:!0,get:function(){return m.FaceLandmarkName}}),Object.defineProperty(t,"Pipeline",{enumerable:!0,get:function(){return m.Pipeline}}),Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return m.LogLevel}}),Object.defineProperty(t,"setLogLevel",{enumerable:!0,get:function(){return m.setLogLevel}}),Object.defineProperty(t,"permissionDenied",{enumerable:!0,get:function(){return m.permissionDenied}}),Object.defineProperty(t,"permissionGranted",{enumerable:!0,get:function(){return m.permissionGranted}}),Object.defineProperty(t,"permissionRequest",{enumerable:!0,get:function(){return m.permissionRequest}}),Object.defineProperty(t,"permissionDeniedUI",{enumerable:!0,get:function(){return m.permissionDeniedUI}}),Object.defineProperty(t,"permissionRequestUI",{enumerable:!0,get:function(){return m.permissionRequestUI}}),Object.defineProperty(t,"browserIncompatible",{enumerable:!0,get:function(){return m.browserIncompatible}}),Object.defineProperty(t,"browserIncompatibleUI",{enumerable:!0,get:function(){return m.browserIncompatibleUI}}),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return m.loaded}}),Object.defineProperty(t,"loadedPromise",{enumerable:!0,get:function(){return m.loadedPromise}})},function(e,t,n){"use strict";(function(e){function r(){var e,t=0,n=[],a=0,i=0;var o=I((function(e){i||c(1,e)})),s=I((function(e){i||c(-1,e)}));function c(n,r){i++;var a=0;try{r===C&&A();var o=n>0&&d(r);o?o.call(r,I((function(e){a++,c(1,e)})),I((function(e){a++,c(-1,e)}))):(t=n,e=r,u())}catch(s){t||a||c(-1,s)}}function u(){a||(setTimeout(l,0),a=1)}function l(){var e=n;a=0,n=[],e.forEach(g)}function g(e){e()}function d(e){var t=e&&(h(e)||"object"===typeof e)&&e.then;return h(t)&&t}function I(e){var t=0;return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];t++||e.apply(this,n)}}function A(){throw new TypeError("Chaining cycle detected")}var h=function(e){return"function"===typeof e},C={then:function(a,i){var o=r();return n.push((function(){var n=t>0?a:i;if(h(n))try{var r=n(e);r===o&&A();var s=d(r);s?s.call(r,o.resolve,o.reject):o.resolve(r)}catch(c){o.reject(c)}else o[t>0?"resolve":"reject"](e)})),t&&u(),o},resolve:o,reject:s};return C}function a(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return{then:n.then.bind(n),resolve:e,reject:t}}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return A})),n.d(t,"d",(function(){return h})),r.all=a.all=function(e){var t=0,n=[],r=i();return 0===e.length?r.resolve([]):e.forEach((function(a,o){var s=i();s.resolve(a),s.then((function(a){t++,n[o]=a,t===e.length&&r.resolve(n)}),r.reject)})),r};var i="function"===typeof Promise?a:r;function o(){var e=Object.create(null);function t(r,a){var i=r.id,o=r.name,s=r.dependencies;void 0===s&&(s=[]);var c=r.init;void 0===c&&(c=function(){});var u=r.getTransferables;if(void 0===u&&(u=null),!e[i])try{s=s.map((function(n){return n&&n.isWorkerModule&&(t(n,(function(e){if(e instanceof Error)throw e})),n=e[n.id].value),n})),c=n("<"+o+">.init",c),u&&(u=n("<"+o+">.getTransferables",u));var l=null;"function"===typeof c?l=c.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[i]={id:i,value:l,getTransferables:u},a(l)}catch(g){g&&g.noLog||console.error(g),a(g)}}function n(e,t){var n=void 0;self.troikaDefine=function(e){return n=e};var r=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(r)}catch(a){console.error(a)}return URL.revokeObjectURL(r),delete self.troikaDefine,n}self.addEventListener("message",(function(n){var r=n.data,a=r.messageId,i=r.action,o=r.data;try{"registerModule"===i&&t(o,(function(e){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:{isCallable:"function"===typeof e}})})),"callModule"===i&&function(t,n){var r,a=t.id,i=t.args;e[a]&&"function"===typeof e[a].value||n(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var o=(r=e[a]).value.apply(r,i);o&&"function"===typeof o.then?o.then(s,(function(e){return n(e instanceof Error?e:new Error(""+e))})):s(o)}catch(c){n(c)}function s(t){try{var r=e[a].getTransferables&&e[a].getTransferables(t);r&&Array.isArray(r)&&r.length||(r=void 0),n(t,r)}catch(c){console.error(c),n(c)}}}(o,(function(e,t){e instanceof Error?postMessage({messageId:a,success:!1,error:e.message}):postMessage({messageId:a,success:!0,result:e},t||void 0)}))}catch(s){postMessage({messageId:a,success:!1,error:s.stack})}}))}var s=function(){var e=!1;if("undefined"!==typeof window&&"undefined"!==typeof window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return s=function(){return e},e},c=0,u=0,l=!1,g=Object.create(null),d=Object.create(null),I=Object.create(null);function A(e){if((!e||"function"!==typeof e.init)&&!l)throw new Error("requires `options.init` function");var t=e.dependencies,n=e.init,r=e.getTransferables,a=e.workerId;if(!s())return function(e){var t=function e(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then((function(e){if("function"===typeof e)return e.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return t._getInitResult=function(){var n=e.dependencies,r=e.init;n=Array.isArray(n)?n.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var a=i.all(n).then((function(e){return r.apply(null,e)}));return t._getInitResult=function(){return a},a},t}(e);null==a&&(a="#default");var o="workerModule"+ ++c,u=e.name||o,g=null;function I(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!g){g=f(a,"registerModule",I.workerModuleData);var n=function e(){g=null,d[a].delete(e)};(d[a]||(d[a]=new Set)).add(n)}return g.then((function(t){if(t.isCallable)return f(a,"callModule",{id:o,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!==typeof e||e.workerModuleData||(l=!0,e=A({workerId:a,name:"<"+u+"> function dependency: "+e.name,init:"function(){return (\n"+C(e)+"\n)}"}),l=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),I.workerModuleData={isWorkerModule:!0,id:o,name:u,dependencies:t,init:C(n),getTransferables:r&&C(r)},I}function h(e){d[e]&&d[e].forEach((function(e){e()})),g[e]&&(g[e].terminate(),delete g[e])}function C(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function f(e,t,n){var r=i(),a=++u;return I[a]=function(e){e.success?r.resolve(e.result):r.reject(new Error("Error in worker "+t+" call: "+e.error))},function(e){var t=g[e];if(!t){var n=C(o);(t=g[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+n+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,n=t.messageId,r=I[n];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete I[n],r(t)}}return t}(e).postMessage({messageId:a,action:t,data:n}),r}var p=A({name:"Thenable",dependencies:[i],init:function(e){return e}})}).call(this,n(182))},function(e,t,n){"use strict";n.r(t),n.d(t,"glMatrix",(function(){return r})),n.d(t,"mat2",(function(){return a})),n.d(t,"mat2d",(function(){return i})),n.d(t,"mat3",(function(){return o})),n.d(t,"mat4",(function(){return s})),n.d(t,"quat",(function(){return l})),n.d(t,"quat2",(function(){return g})),n.d(t,"vec2",(function(){return d})),n.d(t,"vec3",(function(){return c})),n.d(t,"vec4",(function(){return u}));var r={};n.r(r),n.d(r,"EPSILON",(function(){return I})),n.d(r,"ARRAY_TYPE",(function(){return A})),n.d(r,"RANDOM",(function(){return h})),n.d(r,"setMatrixArrayType",(function(){return C})),n.d(r,"toRadian",(function(){return p})),n.d(r,"equals",(function(){return m}));var a={};n.r(a),n.d(a,"create",(function(){return v})),n.d(a,"clone",(function(){return b})),n.d(a,"copy",(function(){return y})),n.d(a,"identity",(function(){return B})),n.d(a,"fromValues",(function(){return G})),n.d(a,"set",(function(){return w})),n.d(a,"transpose",(function(){return _})),n.d(a,"invert",(function(){return Z})),n.d(a,"adjoint",(function(){return S})),n.d(a,"determinant",(function(){return x})),n.d(a,"multiply",(function(){return R})),n.d(a,"rotate",(function(){return M})),n.d(a,"scale",(function(){return k})),n.d(a,"fromRotation",(function(){return E})),n.d(a,"fromScaling",(function(){return W})),n.d(a,"str",(function(){return V})),n.d(a,"frob",(function(){return F})),n.d(a,"LDU",(function(){return X})),n.d(a,"add",(function(){return H})),n.d(a,"subtract",(function(){return O})),n.d(a,"exactEquals",(function(){return L})),n.d(a,"equals",(function(){return N})),n.d(a,"multiplyScalar",(function(){return Y})),n.d(a,"multiplyScalarAndAdd",(function(){return T})),n.d(a,"mul",(function(){return z})),n.d(a,"sub",(function(){return K}));var i={};n.r(i),n.d(i,"create",(function(){return j})),n.d(i,"clone",(function(){return D})),n.d(i,"copy",(function(){return U})),n.d(i,"identity",(function(){return Q})),n.d(i,"fromValues",(function(){return P})),n.d(i,"set",(function(){return J})),n.d(i,"invert",(function(){return q})),n.d(i,"determinant",(function(){return $})),n.d(i,"multiply",(function(){return ee})),n.d(i,"rotate",(function(){return te})),n.d(i,"scale",(function(){return ne})),n.d(i,"translate",(function(){return re})),n.d(i,"fromRotation",(function(){return ae})),n.d(i,"fromScaling",(function(){return ie})),n.d(i,"fromTranslation",(function(){return oe})),n.d(i,"str",(function(){return se})),n.d(i,"frob",(function(){return ce})),n.d(i,"add",(function(){return ue})),n.d(i,"subtract",(function(){return le})),n.d(i,"multiplyScalar",(function(){return ge})),n.d(i,"multiplyScalarAndAdd",(function(){return de})),n.d(i,"exactEquals",(function(){return Ie})),n.d(i,"equals",(function(){return Ae})),n.d(i,"mul",(function(){return he})),n.d(i,"sub",(function(){return Ce}));var o={};n.r(o),n.d(o,"create",(function(){return fe})),n.d(o,"fromMat4",(function(){return pe})),n.d(o,"clone",(function(){return me})),n.d(o,"copy",(function(){return ve})),n.d(o,"fromValues",(function(){return be})),n.d(o,"set",(function(){return ye})),n.d(o,"identity",(function(){return Be})),n.d(o,"transpose",(function(){return Ge})),n.d(o,"invert",(function(){return we})),n.d(o,"adjoint",(function(){return _e})),n.d(o,"determinant",(function(){return Ze})),n.d(o,"multiply",(function(){return Se})),n.d(o,"translate",(function(){return xe})),n.d(o,"rotate",(function(){return Re})),n.d(o,"scale",(function(){return Me})),n.d(o,"fromTranslation",(function(){return ke})),n.d(o,"fromRotation",(function(){return Ee})),n.d(o,"fromScaling",(function(){return We})),n.d(o,"fromMat2d",(function(){return Ve})),n.d(o,"fromQuat",(function(){return Fe})),n.d(o,"normalFromMat4",(function(){return Xe})),n.d(o,"projection",(function(){return He})),n.d(o,"str",(function(){return Oe})),n.d(o,"frob",(function(){return Le})),n.d(o,"add",(function(){return Ne})),n.d(o,"subtract",(function(){return Ye})),n.d(o,"multiplyScalar",(function(){return Te})),n.d(o,"multiplyScalarAndAdd",(function(){return ze})),n.d(o,"exactEquals",(function(){return Ke})),n.d(o,"equals",(function(){return je})),n.d(o,"mul",(function(){return De})),n.d(o,"sub",(function(){return Ue}));var s={};n.r(s),n.d(s,"create",(function(){return Qe})),n.d(s,"clone",(function(){return Pe})),n.d(s,"copy",(function(){return Je})),n.d(s,"fromValues",(function(){return qe})),n.d(s,"set",(function(){return $e})),n.d(s,"identity",(function(){return et})),n.d(s,"transpose",(function(){return tt})),n.d(s,"invert",(function(){return nt})),n.d(s,"adjoint",(function(){return rt})),n.d(s,"determinant",(function(){return at})),n.d(s,"multiply",(function(){return it})),n.d(s,"translate",(function(){return ot})),n.d(s,"scale",(function(){return st})),n.d(s,"rotate",(function(){return ct})),n.d(s,"rotateX",(function(){return ut})),n.d(s,"rotateY",(function(){return lt})),n.d(s,"rotateZ",(function(){return gt})),n.d(s,"fromTranslation",(function(){return dt})),n.d(s,"fromScaling",(function(){return It})),n.d(s,"fromRotation",(function(){return At})),n.d(s,"fromXRotation",(function(){return ht})),n.d(s,"fromYRotation",(function(){return Ct})),n.d(s,"fromZRotation",(function(){return ft})),n.d(s,"fromRotationTranslation",(function(){return pt})),n.d(s,"fromQuat2",(function(){return mt})),n.d(s,"getTranslation",(function(){return vt})),n.d(s,"getScaling",(function(){return bt})),n.d(s,"getRotation",(function(){return yt})),n.d(s,"fromRotationTranslationScale",(function(){return Bt})),n.d(s,"fromRotationTranslationScaleOrigin",(function(){return Gt})),n.d(s,"fromQuat",(function(){return wt})),n.d(s,"frustum",(function(){return _t})),n.d(s,"perspective",(function(){return Zt})),n.d(s,"perspectiveFromFieldOfView",(function(){return St})),n.d(s,"ortho",(function(){return xt})),n.d(s,"lookAt",(function(){return Rt})),n.d(s,"targetTo",(function(){return Mt})),n.d(s,"str",(function(){return kt})),n.d(s,"frob",(function(){return Et})),n.d(s,"add",(function(){return Wt})),n.d(s,"subtract",(function(){return Vt})),n.d(s,"multiplyScalar",(function(){return Ft})),n.d(s,"multiplyScalarAndAdd",(function(){return Xt})),n.d(s,"exactEquals",(function(){return Ht})),n.d(s,"equals",(function(){return Ot})),n.d(s,"mul",(function(){return Lt})),n.d(s,"sub",(function(){return Nt}));var c={};n.r(c),n.d(c,"create",(function(){return Yt})),n.d(c,"clone",(function(){return Tt})),n.d(c,"length",(function(){return zt})),n.d(c,"fromValues",(function(){return Kt})),n.d(c,"copy",(function(){return jt})),n.d(c,"set",(function(){return Dt})),n.d(c,"add",(function(){return Ut})),n.d(c,"subtract",(function(){return Qt})),n.d(c,"multiply",(function(){return Pt})),n.d(c,"divide",(function(){return Jt})),n.d(c,"ceil",(function(){return qt})),n.d(c,"floor",(function(){return $t})),n.d(c,"min",(function(){return en})),n.d(c,"max",(function(){return tn})),n.d(c,"round",(function(){return nn})),n.d(c,"scale",(function(){return rn})),n.d(c,"scaleAndAdd",(function(){return an})),n.d(c,"distance",(function(){return on})),n.d(c,"squaredDistance",(function(){return sn})),n.d(c,"squaredLength",(function(){return cn})),n.d(c,"negate",(function(){return un})),n.d(c,"inverse",(function(){return ln})),n.d(c,"normalize",(function(){return gn})),n.d(c,"dot",(function(){return dn})),n.d(c,"cross",(function(){return In})),n.d(c,"lerp",(function(){return An})),n.d(c,"hermite",(function(){return hn})),n.d(c,"bezier",(function(){return Cn})),n.d(c,"random",(function(){return fn})),n.d(c,"transformMat4",(function(){return pn})),n.d(c,"transformMat3",(function(){return mn})),n.d(c,"transformQuat",(function(){return vn})),n.d(c,"rotateX",(function(){return bn})),n.d(c,"rotateY",(function(){return yn})),n.d(c,"rotateZ",(function(){return Bn})),n.d(c,"angle",(function(){return Gn})),n.d(c,"zero",(function(){return wn})),n.d(c,"str",(function(){return _n})),n.d(c,"exactEquals",(function(){return Zn})),n.d(c,"equals",(function(){return Sn})),n.d(c,"sub",(function(){return xn})),n.d(c,"mul",(function(){return Rn})),n.d(c,"div",(function(){return Mn})),n.d(c,"dist",(function(){return kn})),n.d(c,"sqrDist",(function(){return En})),n.d(c,"len",(function(){return Wn})),n.d(c,"sqrLen",(function(){return Vn})),n.d(c,"forEach",(function(){return Fn}));var u={};n.r(u),n.d(u,"create",(function(){return Xn})),n.d(u,"clone",(function(){return Hn})),n.d(u,"fromValues",(function(){return On})),n.d(u,"copy",(function(){return Ln})),n.d(u,"set",(function(){return Nn})),n.d(u,"add",(function(){return Yn})),n.d(u,"subtract",(function(){return Tn})),n.d(u,"multiply",(function(){return zn})),n.d(u,"divide",(function(){return Kn})),n.d(u,"ceil",(function(){return jn})),n.d(u,"floor",(function(){return Dn})),n.d(u,"min",(function(){return Un})),n.d(u,"max",(function(){return Qn})),n.d(u,"round",(function(){return Pn})),n.d(u,"scale",(function(){return Jn})),n.d(u,"scaleAndAdd",(function(){return qn})),n.d(u,"distance",(function(){return $n})),n.d(u,"squaredDistance",(function(){return er})),n.d(u,"length",(function(){return tr})),n.d(u,"squaredLength",(function(){return nr})),n.d(u,"negate",(function(){return rr})),n.d(u,"inverse",(function(){return ar})),n.d(u,"normalize",(function(){return ir})),n.d(u,"dot",(function(){return or})),n.d(u,"cross",(function(){return sr})),n.d(u,"lerp",(function(){return cr})),n.d(u,"random",(function(){return ur})),n.d(u,"transformMat4",(function(){return lr})),n.d(u,"transformQuat",(function(){return gr})),n.d(u,"zero",(function(){return dr})),n.d(u,"str",(function(){return Ir})),n.d(u,"exactEquals",(function(){return Ar})),n.d(u,"equals",(function(){return hr})),n.d(u,"sub",(function(){return Cr})),n.d(u,"mul",(function(){return fr})),n.d(u,"div",(function(){return pr})),n.d(u,"dist",(function(){return mr})),n.d(u,"sqrDist",(function(){return vr})),n.d(u,"len",(function(){return br})),n.d(u,"sqrLen",(function(){return yr})),n.d(u,"forEach",(function(){return Br}));var l={};n.r(l),n.d(l,"create",(function(){return Gr})),n.d(l,"identity",(function(){return wr})),n.d(l,"setAxisAngle",(function(){return _r})),n.d(l,"getAxisAngle",(function(){return Zr})),n.d(l,"getAngle",(function(){return Sr})),n.d(l,"multiply",(function(){return xr})),n.d(l,"rotateX",(function(){return Rr})),n.d(l,"rotateY",(function(){return Mr})),n.d(l,"rotateZ",(function(){return kr})),n.d(l,"calculateW",(function(){return Er})),n.d(l,"exp",(function(){return Wr})),n.d(l,"ln",(function(){return Vr})),n.d(l,"pow",(function(){return Fr})),n.d(l,"slerp",(function(){return Xr})),n.d(l,"random",(function(){return Hr})),n.d(l,"invert",(function(){return Or})),n.d(l,"conjugate",(function(){return Lr})),n.d(l,"fromMat3",(function(){return Nr})),n.d(l,"fromEuler",(function(){return Yr})),n.d(l,"str",(function(){return Tr})),n.d(l,"clone",(function(){return zr})),n.d(l,"fromValues",(function(){return Kr})),n.d(l,"copy",(function(){return jr})),n.d(l,"set",(function(){return Dr})),n.d(l,"add",(function(){return Ur})),n.d(l,"mul",(function(){return Qr})),n.d(l,"scale",(function(){return Pr})),n.d(l,"dot",(function(){return Jr})),n.d(l,"lerp",(function(){return qr})),n.d(l,"length",(function(){return $r})),n.d(l,"len",(function(){return ea})),n.d(l,"squaredLength",(function(){return ta})),n.d(l,"sqrLen",(function(){return na})),n.d(l,"normalize",(function(){return ra})),n.d(l,"exactEquals",(function(){return aa})),n.d(l,"equals",(function(){return ia})),n.d(l,"rotationTo",(function(){return oa})),n.d(l,"sqlerp",(function(){return sa})),n.d(l,"setAxes",(function(){return ca}));var g={};n.r(g),n.d(g,"create",(function(){return ua})),n.d(g,"clone",(function(){return la})),n.d(g,"fromValues",(function(){return ga})),n.d(g,"fromRotationTranslationValues",(function(){return da})),n.d(g,"fromRotationTranslation",(function(){return Ia})),n.d(g,"fromTranslation",(function(){return Aa})),n.d(g,"fromRotation",(function(){return ha})),n.d(g,"fromMat4",(function(){return Ca})),n.d(g,"copy",(function(){return fa})),n.d(g,"identity",(function(){return pa})),n.d(g,"set",(function(){return ma})),n.d(g,"getReal",(function(){return va})),n.d(g,"getDual",(function(){return ba})),n.d(g,"setReal",(function(){return ya})),n.d(g,"setDual",(function(){return Ba})),n.d(g,"getTranslation",(function(){return Ga})),n.d(g,"translate",(function(){return wa})),n.d(g,"rotateX",(function(){return _a})),n.d(g,"rotateY",(function(){return Za})),n.d(g,"rotateZ",(function(){return Sa})),n.d(g,"rotateByQuatAppend",(function(){return xa})),n.d(g,"rotateByQuatPrepend",(function(){return Ra})),n.d(g,"rotateAroundAxis",(function(){return Ma})),n.d(g,"add",(function(){return ka})),n.d(g,"multiply",(function(){return Ea})),n.d(g,"mul",(function(){return Wa})),n.d(g,"scale",(function(){return Va})),n.d(g,"dot",(function(){return Fa})),n.d(g,"lerp",(function(){return Xa})),n.d(g,"invert",(function(){return Ha})),n.d(g,"conjugate",(function(){return Oa})),n.d(g,"length",(function(){return La})),n.d(g,"len",(function(){return Na})),n.d(g,"squaredLength",(function(){return Ya})),n.d(g,"sqrLen",(function(){return Ta})),n.d(g,"normalize",(function(){return za})),n.d(g,"str",(function(){return Ka})),n.d(g,"exactEquals",(function(){return ja})),n.d(g,"equals",(function(){return Da}));var d={};n.r(d),n.d(d,"create",(function(){return Ua})),n.d(d,"clone",(function(){return Qa})),n.d(d,"fromValues",(function(){return Pa})),n.d(d,"copy",(function(){return Ja})),n.d(d,"set",(function(){return qa})),n.d(d,"add",(function(){return $a})),n.d(d,"subtract",(function(){return ei})),n.d(d,"multiply",(function(){return ti})),n.d(d,"divide",(function(){return ni})),n.d(d,"ceil",(function(){return ri})),n.d(d,"floor",(function(){return ai})),n.d(d,"min",(function(){return ii})),n.d(d,"max",(function(){return oi})),n.d(d,"round",(function(){return si})),n.d(d,"scale",(function(){return ci})),n.d(d,"scaleAndAdd",(function(){return ui})),n.d(d,"distance",(function(){return li})),n.d(d,"squaredDistance",(function(){return gi})),n.d(d,"length",(function(){return di})),n.d(d,"squaredLength",(function(){return Ii})),n.d(d,"negate",(function(){return Ai})),n.d(d,"inverse",(function(){return hi})),n.d(d,"normalize",(function(){return Ci})),n.d(d,"dot",(function(){return fi})),n.d(d,"cross",(function(){return pi})),n.d(d,"lerp",(function(){return mi})),n.d(d,"random",(function(){return vi})),n.d(d,"transformMat2",(function(){return bi})),n.d(d,"transformMat2d",(function(){return yi})),n.d(d,"transformMat3",(function(){return Bi})),n.d(d,"transformMat4",(function(){return Gi})),n.d(d,"rotate",(function(){return wi})),n.d(d,"angle",(function(){return _i})),n.d(d,"zero",(function(){return Zi})),n.d(d,"str",(function(){return Si})),n.d(d,"exactEquals",(function(){return xi})),n.d(d,"equals",(function(){return Ri})),n.d(d,"len",(function(){return Mi})),n.d(d,"sub",(function(){return ki})),n.d(d,"mul",(function(){return Ei})),n.d(d,"div",(function(){return Wi})),n.d(d,"dist",(function(){return Vi})),n.d(d,"sqrDist",(function(){return Fi})),n.d(d,"sqrLen",(function(){return Xi})),n.d(d,"forEach",(function(){return Hi}));var I=1e-6,A="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;function C(e){A=e}var f=Math.PI/180;function p(e){return e*f}function m(e,t){return Math.abs(e-t)<=I*Math.max(1,Math.abs(e),Math.abs(t))}function v(){var e=new A(4);return A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function b(e){var t=new A(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function B(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function G(e,t,n,r){var a=new A(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function w(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function _(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Z(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*i-a*r;return o?(o=1/o,e[0]=i*o,e[1]=-r*o,e[2]=-a*o,e[3]=n*o,e):null}function S(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function x(e){return e[0]*e[3]-e[2]*e[1]}function R(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*s+i*c,e[1]=a*s+o*c,e[2]=r*u+i*l,e[3]=a*u+o*l,e}function M(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*s,e[1]=a*c+o*s,e[2]=r*-s+i*c,e[3]=a*-s+o*c,e}function k(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[0],c=n[1];return e[0]=r*s,e[1]=a*s,e[2]=i*c,e[3]=o*c,e}function E(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function W(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function V(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function F(e){return Math.hypot(e[0],e[1],e[2],e[3])}function X(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function H(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function O(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function L(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function N(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],s=t[1],c=t[2],u=t[3];return Math.abs(n-o)<=I*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=I*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=I*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-u)<=I*Math.max(1,Math.abs(i),Math.abs(u))}function Y(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function T(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var z=R,K=O;function j(){var e=new A(6);return A!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function D(e){var t=new A(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function U(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Q(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function P(e,t,n,r,a,i){var o=new A(6);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=a,o[5]=i,o}function J(e,t,n,r,a,i,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e}function q(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=n*i-r*a;return c?(c=1/c,e[0]=i*c,e[1]=-r*c,e[2]=-a*c,e[3]=n*c,e[4]=(a*s-i*o)*c,e[5]=(r*o-n*s)*c,e):null}function $(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=n[0],l=n[1],g=n[2],d=n[3],I=n[4],A=n[5];return e[0]=r*u+i*l,e[1]=a*u+o*l,e[2]=r*g+i*d,e[3]=a*g+o*d,e[4]=r*I+i*A+s,e[5]=a*I+o*A+c,e}function te(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*u,e[1]=a*l+o*u,e[2]=r*-u+i*l,e[3]=a*-u+o*l,e[4]=s,e[5]=c,e}function ne(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=n[0],l=n[1];return e[0]=r*u,e[1]=a*u,e[2]=i*l,e[3]=o*l,e[4]=s,e[5]=c,e}function re(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=n[0],l=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=r*u+i*l+s,e[5]=a*u+o*l+c,e}function ae(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function oe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function se(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ce(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ue(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function le(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function ge(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function de(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function Ie(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Ae(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=t[0],u=t[1],l=t[2],g=t[3],d=t[4],A=t[5];return Math.abs(n-c)<=I*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=I*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-l)<=I*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-g)<=I*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-d)<=I*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-A)<=I*Math.max(1,Math.abs(s),Math.abs(A))}var he=ee,Ce=le;function fe(){var e=new A(9);return A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function pe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function me(e){var t=new A(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function be(e,t,n,r,a,i,o,s,c){var u=new A(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=a,u[5]=i,u[6]=o,u[7]=s,u[8]=c,u}function ye(e,t,n,r,a,i,o,s,c,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=c,e[8]=u,e}function Be(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ge(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function we(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8],g=l*o-s*u,d=-l*i+s*c,I=u*i-o*c,A=n*g+r*d+a*I;return A?(A=1/A,e[0]=g*A,e[1]=(-l*r+a*u)*A,e[2]=(s*r-a*o)*A,e[3]=d*A,e[4]=(l*n-a*c)*A,e[5]=(-s*n+a*i)*A,e[6]=I*A,e[7]=(-u*n+r*c)*A,e[8]=(o*n-r*i)*A,e):null}function _e(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8];return e[0]=o*l-s*u,e[1]=a*u-r*l,e[2]=r*s-a*o,e[3]=s*c-i*l,e[4]=n*l-a*c,e[5]=a*i-n*s,e[6]=i*u-o*c,e[7]=r*c-n*u,e[8]=n*o-r*i,e}function Ze(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8];return t*(u*i-o*c)+n*(-u*a+o*s)+r*(c*a-i*s)}function Se(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=t[8],d=n[0],I=n[1],A=n[2],h=n[3],C=n[4],f=n[5],p=n[6],m=n[7],v=n[8];return e[0]=d*r+I*o+A*u,e[1]=d*a+I*s+A*l,e[2]=d*i+I*c+A*g,e[3]=h*r+C*o+f*u,e[4]=h*a+C*s+f*l,e[5]=h*i+C*c+f*g,e[6]=p*r+m*o+v*u,e[7]=p*a+m*s+v*l,e[8]=p*i+m*c+v*g,e}function xe(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=t[8],d=n[0],I=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=s,e[5]=c,e[6]=d*r+I*o+u,e[7]=d*a+I*s+l,e[8]=d*i+I*c+g,e}function Re(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=t[8],d=Math.sin(n),I=Math.cos(n);return e[0]=I*r+d*o,e[1]=I*a+d*s,e[2]=I*i+d*c,e[3]=I*o-d*r,e[4]=I*s-d*a,e[5]=I*c-d*i,e[6]=u,e[7]=l,e[8]=g,e}function Me(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ke(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ee(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function We(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Fe(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,s=r+r,c=a+a,u=n*o,l=r*o,g=r*s,d=a*o,I=a*s,A=a*c,h=i*o,C=i*s,f=i*c;return e[0]=1-g-A,e[3]=l-f,e[6]=d+C,e[1]=l+f,e[4]=1-u-A,e[7]=I-h,e[2]=d-C,e[5]=I+h,e[8]=1-u-g,e}function Xe(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8],g=t[9],d=t[10],I=t[11],A=t[12],h=t[13],C=t[14],f=t[15],p=n*s-r*o,m=n*c-a*o,v=n*u-i*o,b=r*c-a*s,y=r*u-i*s,B=a*u-i*c,G=l*h-g*A,w=l*C-d*A,_=l*f-I*A,Z=g*C-d*h,S=g*f-I*h,x=d*f-I*C,R=p*x-m*S+v*Z+b*_-y*w+B*G;return R?(R=1/R,e[0]=(s*x-c*S+u*Z)*R,e[1]=(c*_-o*x-u*w)*R,e[2]=(o*S-s*_+u*G)*R,e[3]=(a*S-r*x-i*Z)*R,e[4]=(n*x-a*_+i*w)*R,e[5]=(r*_-n*S-i*G)*R,e[6]=(h*B-C*y+f*b)*R,e[7]=(C*v-A*B-f*m)*R,e[8]=(A*y-h*v+f*p)*R,e):null}function He(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Oe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Le(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ne(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function Ye(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Te(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function ze(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function Ke(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function je(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],l=e[8],g=t[0],d=t[1],A=t[2],h=t[3],C=t[4],f=t[5],p=t[6],m=t[7],v=t[8];return Math.abs(n-g)<=I*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-d)<=I*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-A)<=I*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(i-h)<=I*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-C)<=I*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(s-f)<=I*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(c-p)<=I*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(u-m)<=I*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-v)<=I*Math.max(1,Math.abs(l),Math.abs(v))}var De=Se,Ue=Ye;function Qe(){var e=new A(16);return A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Pe(e){var t=new A(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Je(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function qe(e,t,n,r,a,i,o,s,c,u,l,g,d,I,h,C){var f=new A(16);return f[0]=e,f[1]=t,f[2]=n,f[3]=r,f[4]=a,f[5]=i,f[6]=o,f[7]=s,f[8]=c,f[9]=u,f[10]=l,f[11]=g,f[12]=d,f[13]=I,f[14]=h,f[15]=C,f}function $e(e,t,n,r,a,i,o,s,c,u,l,g,d,I,A,h,C){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=c,e[8]=u,e[9]=l,e[10]=g,e[11]=d,e[12]=I,e[13]=A,e[14]=h,e[15]=C,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function nt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8],g=t[9],d=t[10],I=t[11],A=t[12],h=t[13],C=t[14],f=t[15],p=n*s-r*o,m=n*c-a*o,v=n*u-i*o,b=r*c-a*s,y=r*u-i*s,B=a*u-i*c,G=l*h-g*A,w=l*C-d*A,_=l*f-I*A,Z=g*C-d*h,S=g*f-I*h,x=d*f-I*C,R=p*x-m*S+v*Z+b*_-y*w+B*G;return R?(R=1/R,e[0]=(s*x-c*S+u*Z)*R,e[1]=(a*S-r*x-i*Z)*R,e[2]=(h*B-C*y+f*b)*R,e[3]=(d*y-g*B-I*b)*R,e[4]=(c*_-o*x-u*w)*R,e[5]=(n*x-a*_+i*w)*R,e[6]=(C*v-A*B-f*m)*R,e[7]=(l*B-d*v+I*m)*R,e[8]=(o*S-s*_+u*G)*R,e[9]=(r*_-n*S-i*G)*R,e[10]=(A*y-h*v+f*p)*R,e[11]=(g*v-l*y-I*p)*R,e[12]=(s*w-o*Z-c*G)*R,e[13]=(n*Z-r*w+a*G)*R,e[14]=(h*m-A*b-C*p)*R,e[15]=(l*b-g*m+d*p)*R,e):null}function rt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],l=t[8],g=t[9],d=t[10],I=t[11],A=t[12],h=t[13],C=t[14],f=t[15];return e[0]=s*(d*f-I*C)-g*(c*f-u*C)+h*(c*I-u*d),e[1]=-(r*(d*f-I*C)-g*(a*f-i*C)+h*(a*I-i*d)),e[2]=r*(c*f-u*C)-s*(a*f-i*C)+h*(a*u-i*c),e[3]=-(r*(c*I-u*d)-s*(a*I-i*d)+g*(a*u-i*c)),e[4]=-(o*(d*f-I*C)-l*(c*f-u*C)+A*(c*I-u*d)),e[5]=n*(d*f-I*C)-l*(a*f-i*C)+A*(a*I-i*d),e[6]=-(n*(c*f-u*C)-o*(a*f-i*C)+A*(a*u-i*c)),e[7]=n*(c*I-u*d)-o*(a*I-i*d)+l*(a*u-i*c),e[8]=o*(g*f-I*h)-l*(s*f-u*h)+A*(s*I-u*g),e[9]=-(n*(g*f-I*h)-l*(r*f-i*h)+A*(r*I-i*g)),e[10]=n*(s*f-u*h)-o*(r*f-i*h)+A*(r*u-i*s),e[11]=-(n*(s*I-u*g)-o*(r*I-i*g)+l*(r*u-i*s)),e[12]=-(o*(g*C-d*h)-l*(s*C-c*h)+A*(s*d-c*g)),e[13]=n*(g*C-d*h)-l*(r*C-a*h)+A*(r*d-a*g),e[14]=-(n*(s*C-c*h)-o*(r*C-a*h)+A*(r*c-a*s)),e[15]=n*(s*d-c*g)-o*(r*d-a*g)+l*(r*c-a*s),e}function at(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],l=e[9],g=e[10],d=e[11],I=e[12],A=e[13],h=e[14],C=e[15];return(t*o-n*i)*(g*C-d*h)-(t*s-r*i)*(l*C-d*A)+(t*c-a*i)*(l*h-g*A)+(n*s-r*o)*(u*C-d*I)-(n*c-a*o)*(u*h-g*I)+(r*c-a*s)*(u*A-l*I)}function it(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=t[8],d=t[9],I=t[10],A=t[11],h=t[12],C=t[13],f=t[14],p=t[15],m=n[0],v=n[1],b=n[2],y=n[3];return e[0]=m*r+v*s+b*g+y*h,e[1]=m*a+v*c+b*d+y*C,e[2]=m*i+v*u+b*I+y*f,e[3]=m*o+v*l+b*A+y*p,m=n[4],v=n[5],b=n[6],y=n[7],e[4]=m*r+v*s+b*g+y*h,e[5]=m*a+v*c+b*d+y*C,e[6]=m*i+v*u+b*I+y*f,e[7]=m*o+v*l+b*A+y*p,m=n[8],v=n[9],b=n[10],y=n[11],e[8]=m*r+v*s+b*g+y*h,e[9]=m*a+v*c+b*d+y*C,e[10]=m*i+v*u+b*I+y*f,e[11]=m*o+v*l+b*A+y*p,m=n[12],v=n[13],b=n[14],y=n[15],e[12]=m*r+v*s+b*g+y*h,e[13]=m*a+v*c+b*d+y*C,e[14]=m*i+v*u+b*I+y*f,e[15]=m*o+v*l+b*A+y*p,e}function ot(e,t,n){var r,a,i,o,s,c,u,l,g,d,I,A,h=n[0],C=n[1],f=n[2];return t===e?(e[12]=t[0]*h+t[4]*C+t[8]*f+t[12],e[13]=t[1]*h+t[5]*C+t[9]*f+t[13],e[14]=t[2]*h+t[6]*C+t[10]*f+t[14],e[15]=t[3]*h+t[7]*C+t[11]*f+t[15]):(r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=t[8],d=t[9],I=t[10],A=t[11],e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=s,e[5]=c,e[6]=u,e[7]=l,e[8]=g,e[9]=d,e[10]=I,e[11]=A,e[12]=r*h+s*C+g*f+t[12],e[13]=a*h+c*C+d*f+t[13],e[14]=i*h+u*C+I*f+t[14],e[15]=o*h+l*C+A*f+t[15]),e}function st(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ct(e,t,n,r){var a,i,o,s,c,u,l,g,d,A,h,C,f,p,m,v,b,y,B,G,w,_,Z,S,x=r[0],R=r[1],M=r[2],k=Math.hypot(x,R,M);return k<I?null:(x*=k=1/k,R*=k,M*=k,a=Math.sin(n),o=1-(i=Math.cos(n)),s=t[0],c=t[1],u=t[2],l=t[3],g=t[4],d=t[5],A=t[6],h=t[7],C=t[8],f=t[9],p=t[10],m=t[11],v=x*x*o+i,b=R*x*o+M*a,y=M*x*o-R*a,B=x*R*o-M*a,G=R*R*o+i,w=M*R*o+x*a,_=x*M*o+R*a,Z=R*M*o-x*a,S=M*M*o+i,e[0]=s*v+g*b+C*y,e[1]=c*v+d*b+f*y,e[2]=u*v+A*b+p*y,e[3]=l*v+h*b+m*y,e[4]=s*B+g*G+C*w,e[5]=c*B+d*G+f*w,e[6]=u*B+A*G+p*w,e[7]=l*B+h*G+m*w,e[8]=s*_+g*Z+C*S,e[9]=c*_+d*Z+f*S,e[10]=u*_+A*Z+p*S,e[11]=l*_+h*Z+m*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ut(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],o=t[5],s=t[6],c=t[7],u=t[8],l=t[9],g=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+u*r,e[5]=o*a+l*r,e[6]=s*a+g*r,e[7]=c*a+d*r,e[8]=u*a-i*r,e[9]=l*a-o*r,e[10]=g*a-s*r,e[11]=d*a-c*r,e}function lt(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],s=t[2],c=t[3],u=t[8],l=t[9],g=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-u*r,e[1]=o*a-l*r,e[2]=s*a-g*r,e[3]=c*a-d*r,e[8]=i*r+u*a,e[9]=o*r+l*a,e[10]=s*r+g*a,e[11]=c*r+d*a,e}function gt(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],s=t[2],c=t[3],u=t[4],l=t[5],g=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+u*r,e[1]=o*a+l*r,e[2]=s*a+g*r,e[3]=c*a+d*r,e[4]=u*a-i*r,e[5]=l*a-o*r,e[6]=g*a-s*r,e[7]=d*a-c*r,e}function dt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function It(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function At(e,t,n){var r,a,i,o=n[0],s=n[1],c=n[2],u=Math.hypot(o,s,c);return u<I?null:(o*=u=1/u,s*=u,c*=u,r=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=s*o*i+c*r,e[2]=c*o*i-s*r,e[3]=0,e[4]=o*s*i-c*r,e[5]=s*s*i+a,e[6]=c*s*i+o*r,e[7]=0,e[8]=o*c*i+s*r,e[9]=s*c*i-o*r,e[10]=c*c*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ht(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ct(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ft(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=r+r,c=a+a,u=i+i,l=r*s,g=r*c,d=r*u,I=a*c,A=a*u,h=i*u,C=o*s,f=o*c,p=o*u;return e[0]=1-(I+h),e[1]=g+p,e[2]=d-f,e[3]=0,e[4]=g-p,e[5]=1-(l+h),e[6]=A+C,e[7]=0,e[8]=d+f,e[9]=A-C,e[10]=1-(l+I),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function mt(e,t){var n=new A(3),r=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=r*r+a*a+i*i+o*o;return g>0?(n[0]=2*(s*o+l*r+c*i-u*a)/g,n[1]=2*(c*o+l*a+u*r-s*i)/g,n[2]=2*(u*o+l*i+s*a-c*r)/g):(n[0]=2*(s*o+l*r+c*i-u*a),n[1]=2*(c*o+l*a+u*r-s*i),n[2]=2*(u*o+l*i+s*a-c*r)),pt(e,t,n),e}function vt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function bt(e,t){var n=t[0],r=t[1],a=t[2],i=t[4],o=t[5],s=t[6],c=t[8],u=t[9],l=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(i,o,s),e[2]=Math.hypot(c,u,l),e}function yt(e,t){var n=new A(3);bt(n,t);var r=1/n[0],a=1/n[1],i=1/n[2],o=t[0]*r,s=t[1]*a,c=t[2]*i,u=t[4]*r,l=t[5]*a,g=t[6]*i,d=t[8]*r,I=t[9]*a,h=t[10]*i,C=o+l+h,f=0;return C>0?(f=2*Math.sqrt(C+1),e[3]=.25*f,e[0]=(g-I)/f,e[1]=(d-c)/f,e[2]=(s-u)/f):o>l&&o>h?(f=2*Math.sqrt(1+o-l-h),e[3]=(g-I)/f,e[0]=.25*f,e[1]=(s+u)/f,e[2]=(d+c)/f):l>h?(f=2*Math.sqrt(1+l-o-h),e[3]=(d-c)/f,e[0]=(s+u)/f,e[1]=.25*f,e[2]=(g+I)/f):(f=2*Math.sqrt(1+h-o-l),e[3]=(s-u)/f,e[0]=(d+c)/f,e[1]=(g+I)/f,e[2]=.25*f),e}function Bt(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=t[3],c=a+a,u=i+i,l=o+o,g=a*c,d=a*u,I=a*l,A=i*u,h=i*l,C=o*l,f=s*c,p=s*u,m=s*l,v=r[0],b=r[1],y=r[2];return e[0]=(1-(A+C))*v,e[1]=(d+m)*v,e[2]=(I-p)*v,e[3]=0,e[4]=(d-m)*b,e[5]=(1-(g+C))*b,e[6]=(h+f)*b,e[7]=0,e[8]=(I+p)*y,e[9]=(h-f)*y,e[10]=(1-(g+A))*y,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Gt(e,t,n,r,a){var i=t[0],o=t[1],s=t[2],c=t[3],u=i+i,l=o+o,g=s+s,d=i*u,I=i*l,A=i*g,h=o*l,C=o*g,f=s*g,p=c*u,m=c*l,v=c*g,b=r[0],y=r[1],B=r[2],G=a[0],w=a[1],_=a[2],Z=(1-(h+f))*b,S=(I+v)*b,x=(A-m)*b,R=(I-v)*y,M=(1-(d+f))*y,k=(C+p)*y,E=(A+m)*B,W=(C-p)*B,V=(1-(d+h))*B;return e[0]=Z,e[1]=S,e[2]=x,e[3]=0,e[4]=R,e[5]=M,e[6]=k,e[7]=0,e[8]=E,e[9]=W,e[10]=V,e[11]=0,e[12]=n[0]+G-(Z*G+R*w+E*_),e[13]=n[1]+w-(S*G+M*w+W*_),e[14]=n[2]+_-(x*G+k*w+V*_),e[15]=1,e}function wt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,s=r+r,c=a+a,u=n*o,l=r*o,g=r*s,d=a*o,I=a*s,A=a*c,h=i*o,C=i*s,f=i*c;return e[0]=1-g-A,e[1]=l+f,e[2]=d-C,e[3]=0,e[4]=l-f,e[5]=1-u-A,e[6]=I+h,e[7]=0,e[8]=d+C,e[9]=I-h,e[10]=1-u-g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _t(e,t,n,r,a,i,o){var s=1/(n-t),c=1/(a-r),u=1/(i-o);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*c,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(a+r)*c,e[10]=(o+i)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*u,e[15]=0,e}function Zt(e,t,n,r,a){var i,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=(a+r)*i,e[14]=2*a*r*i):(e[10]=-1,e[14]=-2*r),e}function St(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+s),u=2/(a+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*c*.5,e[9]=(a-i)*u*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function xt(e,t,n,r,a,i,o){var s=1/(t-n),c=1/(r-a),u=1/(i-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(a+r)*c,e[14]=(o+i)*u,e[15]=1,e}function Rt(e,t,n,r){var a,i,o,s,c,u,l,g,d,A,h=t[0],C=t[1],f=t[2],p=r[0],m=r[1],v=r[2],b=n[0],y=n[1],B=n[2];return Math.abs(h-b)<I&&Math.abs(C-y)<I&&Math.abs(f-B)<I?et(e):(l=h-b,g=C-y,d=f-B,a=m*(d*=A=1/Math.hypot(l,g,d))-v*(g*=A),i=v*(l*=A)-p*d,o=p*g-m*l,(A=Math.hypot(a,i,o))?(a*=A=1/A,i*=A,o*=A):(a=0,i=0,o=0),s=g*o-d*i,c=d*a-l*o,u=l*i-g*a,(A=Math.hypot(s,c,u))?(s*=A=1/A,c*=A,u*=A):(s=0,c=0,u=0),e[0]=a,e[1]=s,e[2]=l,e[3]=0,e[4]=i,e[5]=c,e[6]=g,e[7]=0,e[8]=o,e[9]=u,e[10]=d,e[11]=0,e[12]=-(a*h+i*C+o*f),e[13]=-(s*h+c*C+u*f),e[14]=-(l*h+g*C+d*f),e[15]=1,e)}function Mt(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=r[0],c=r[1],u=r[2],l=a-n[0],g=i-n[1],d=o-n[2],I=l*l+g*g+d*d;I>0&&(l*=I=1/Math.sqrt(I),g*=I,d*=I);var A=c*d-u*g,h=u*l-s*d,C=s*g-c*l;return(I=A*A+h*h+C*C)>0&&(A*=I=1/Math.sqrt(I),h*=I,C*=I),e[0]=A,e[1]=h,e[2]=C,e[3]=0,e[4]=g*C-d*h,e[5]=d*A-l*C,e[6]=l*h-g*A,e[7]=0,e[8]=l,e[9]=g,e[10]=d,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e}function kt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Et(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Wt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Vt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Ft(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Xt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Ht(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Ot(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],l=e[8],g=e[9],d=e[10],A=e[11],h=e[12],C=e[13],f=e[14],p=e[15],m=t[0],v=t[1],b=t[2],y=t[3],B=t[4],G=t[5],w=t[6],_=t[7],Z=t[8],S=t[9],x=t[10],R=t[11],M=t[12],k=t[13],E=t[14],W=t[15];return Math.abs(n-m)<=I*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-v)<=I*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(a-b)<=I*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(i-y)<=I*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-B)<=I*Math.max(1,Math.abs(o),Math.abs(B))&&Math.abs(s-G)<=I*Math.max(1,Math.abs(s),Math.abs(G))&&Math.abs(c-w)<=I*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-_)<=I*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(l-Z)<=I*Math.max(1,Math.abs(l),Math.abs(Z))&&Math.abs(g-S)<=I*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(d-x)<=I*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(A-R)<=I*Math.max(1,Math.abs(A),Math.abs(R))&&Math.abs(h-M)<=I*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(C-k)<=I*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(f-E)<=I*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(p-W)<=I*Math.max(1,Math.abs(p),Math.abs(W))}var Lt=it,Nt=Vt;function Yt(){var e=new A(3);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Tt(e){var t=new A(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Kt(e,t,n){var r=new A(3);return r[0]=e,r[1]=t,r[2]=n,r}function jt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Dt(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Ut(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Qt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Pt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Jt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function qt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function $t(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function en(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function tn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function nn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function rn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function an(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function on(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function sn(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function cn(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function un(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ln(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function gn(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function dn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function In(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],s=n[1],c=n[2];return e[0]=a*c-i*s,e[1]=i*o-r*c,e[2]=r*s-a*o,e}function An(e,t,n,r){var a=t[0],i=t[1],o=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e}function hn(e,t,n,r,a,i){var o=i*i,s=o*(2*i-3)+1,c=o*(i-2)+i,u=o*(i-1),l=o*(3-2*i);return e[0]=t[0]*s+n[0]*c+r[0]*u+a[0]*l,e[1]=t[1]*s+n[1]*c+r[1]*u+a[1]*l,e[2]=t[2]*s+n[2]*c+r[2]*u+a[2]*l,e}function Cn(e,t,n,r,a,i){var o=1-i,s=o*o,c=i*i,u=s*o,l=3*i*s,g=3*c*o,d=c*i;return e[0]=t[0]*u+n[0]*l+r[0]*g+a[0]*d,e[1]=t[1]*u+n[1]*l+r[1]*g+a[1]*d,e[2]=t[2]*u+n[2]*l+r[2]*g+a[2]*d,e}function fn(e,t){t=t||1;var n=2*h()*Math.PI,r=2*h()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function pn(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,e}function mn(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e}function vn(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=t[0],c=t[1],u=t[2],l=a*u-i*c,g=i*s-r*u,d=r*c-a*s,I=a*d-i*g,A=i*l-r*d,h=r*g-a*l,C=2*o;return l*=C,g*=C,d*=C,I*=2,A*=2,h*=2,e[0]=s+l+I,e[1]=c+g+A,e[2]=u+d+h,e}function bn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function yn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Bn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Gn(e,t){var n=Kt(e[0],e[1],e[2]),r=Kt(t[0],t[1],t[2]);gn(n,n),gn(r,r);var a=dn(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function wn(e){return e[0]=0,e[1]=0,e[2]=0,e}function _n(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Zn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Sn(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],o=t[1],s=t[2];return Math.abs(n-i)<=I*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=I*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=I*Math.max(1,Math.abs(a),Math.abs(s))}var xn=Qt,Rn=Pt,Mn=Jt,kn=on,En=sn,Wn=zt,Vn=cn,Fn=function(){var e=Yt();return function(t,n,r,a,i,o){var s,c;for(n||(n=3),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],i(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();function Xn(){var e=new A(4);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Hn(e){var t=new A(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function On(e,t,n,r){var a=new A(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function Ln(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Nn(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function Yn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Tn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function zn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Kn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function jn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Dn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Un(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function Qn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function Pn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Jn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function qn(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function $n(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.hypot(n,r,a,i)}function er(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+a*a+i*i}function tr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function nr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}function rr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ar(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ir(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=i*o,e}function or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function sr(e,t,n,r){var a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],u=n[2]*r[3]-n[3]*r[2],l=t[0],g=t[1],d=t[2],I=t[3];return e[0]=g*u-d*c+I*s,e[1]=-l*u+d*o-I*i,e[2]=l*c-g*o+I*a,e[3]=-l*s+g*i-d*a,e}function cr(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e}function ur(e,t){var n,r,a,i,o,s;t=t||1;do{o=(n=2*h()-1)*n+(r=2*h()-1)*r}while(o>=1);do{s=(a=2*h()-1)*a+(i=2*h()-1)*i}while(s>=1);var c=Math.sqrt((1-o)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*a*c,e[3]=t*i*c,e}function lr(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,e}function gr(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],s=n[1],c=n[2],u=n[3],l=u*r+s*i-c*a,g=u*a+c*r-o*i,d=u*i+o*a-s*r,I=-o*r-s*a-c*i;return e[0]=l*u+I*-o+g*-c-d*-s,e[1]=g*u+I*-s+d*-o-l*-c,e[2]=d*u+I*-c+l*-s-g*-o,e[3]=t[3],e}function dr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ir(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ar(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function hr(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],s=t[1],c=t[2],u=t[3];return Math.abs(n-o)<=I*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=I*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=I*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-u)<=I*Math.max(1,Math.abs(i),Math.abs(u))}var Cr=Tn,fr=zn,pr=Kn,mr=$n,vr=er,br=tr,yr=nr,Br=function(){var e=Xn();return function(t,n,r,a,i,o){var s,c;for(n||(n=4),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Gr(){var e=new A(4);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function wr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function _r(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Zr(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>I?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Sr(e,t){var n=Jr(e,t);return Math.acos(2*n*n-1)}function xr(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*l+o*s+a*u-i*c,e[1]=a*l+o*c+i*s-r*u,e[2]=i*l+o*u+r*c-a*s,e[3]=o*l-r*s-a*c-i*u,e}function Rr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*s,e[1]=a*c+i*s,e[2]=i*c-a*s,e[3]=o*c-r*s,e}function Mr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c-i*s,e[1]=a*c+o*s,e[2]=i*c+r*s,e[3]=o*c-a*s,e}function kr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*s,e[1]=a*c-r*s,e[2]=i*c+o*s,e[3]=o*c-i*s,e}function Er(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function Wr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),s=Math.exp(i),c=o>0?s*Math.sin(o)/o:0;return e[0]=n*c,e[1]=r*c,e[2]=a*c,e[3]=s*Math.cos(o),e}function Vr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),s=o>0?Math.atan2(o,i)/o:0;return e[0]=n*s,e[1]=r*s,e[2]=a*s,e[3]=.5*Math.log(n*n+r*r+a*a+i*i),e}function Fr(e,t,n){return Vr(e,t),Pr(e,e,n),Wr(e,e),e}function Xr(e,t,n,r){var a,i,o,s,c,u=t[0],l=t[1],g=t[2],d=t[3],A=n[0],h=n[1],C=n[2],f=n[3];return(i=u*A+l*h+g*C+d*f)<0&&(i=-i,A=-A,h=-h,C=-C,f=-f),1-i>I?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-r)*a)/o,c=Math.sin(r*a)/o):(s=1-r,c=r),e[0]=s*u+c*A,e[1]=s*l+c*h,e[2]=s*g+c*C,e[3]=s*d+c*f,e}function Hr(e){var t=h(),n=h(),r=h(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e}function Or(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-a*s,e[3]=i*s,e}function Lr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Nr(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+o]-t[3*o+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e}function Yr(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),o=Math.cos(t),s=Math.sin(n),c=Math.cos(n),u=Math.sin(r),l=Math.cos(r);return e[0]=i*c*l-o*s*u,e[1]=o*s*l+i*c*u,e[2]=o*c*u-i*s*l,e[3]=o*c*l+i*s*u,e}function Tr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var zr=Hn,Kr=On,jr=Ln,Dr=Nn,Ur=Yn,Qr=xr,Pr=Jn,Jr=or,qr=cr,$r=tr,ea=$r,ta=nr,na=ta,ra=ir,aa=Ar,ia=hr,oa=function(){var e=Yt(),t=Kt(1,0,0),n=Kt(0,1,0);return function(r,a,i){var o=dn(a,i);return o<-.999999?(In(e,t,a),Wn(e)<1e-6&&In(e,n,a),gn(e,e),_r(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(In(e,a,i),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,ra(r,r))}}(),sa=function(){var e=Gr(),t=Gr();return function(n,r,a,i,o,s){return Xr(e,r,o,s),Xr(t,a,i,s),Xr(n,e,t,2*s*(1-s)),n}}(),ca=function(){var e=fe();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],ra(t,Nr(t,e))}}();function ua(){var e=new A(8);return A!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function la(e){var t=new A(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ga(e,t,n,r,a,i,o,s){var c=new A(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=a,c[5]=i,c[6]=o,c[7]=s,c}function da(e,t,n,r,a,i,o){var s=new A(8);s[0]=e,s[1]=t,s[2]=n,s[3]=r;var c=.5*a,u=.5*i,l=.5*o;return s[4]=c*r+u*n-l*t,s[5]=u*r+l*e-c*n,s[6]=l*r+c*t-u*e,s[7]=-c*e-u*t-l*n,s}function Ia(e,t,n){var r=.5*n[0],a=.5*n[1],i=.5*n[2],o=t[0],s=t[1],c=t[2],u=t[3];return e[0]=o,e[1]=s,e[2]=c,e[3]=u,e[4]=r*u+a*c-i*s,e[5]=a*u+i*o-r*c,e[6]=i*u+r*s-a*o,e[7]=-r*o-a*s-i*c,e}function Aa(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function ha(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ca(e,t){var n=Gr();yt(n,t);var r=new A(3);return vt(r,t),Ia(e,n,r),e}function fa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function pa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function ma(e,t,n,r,a,i,o,s,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=c,e}var va=jr;function ba(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var ya=jr;function Ba(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Ga(e,t){var n=t[4],r=t[5],a=t[6],i=t[7],o=-t[0],s=-t[1],c=-t[2],u=t[3];return e[0]=2*(n*u+i*o+r*c-a*s),e[1]=2*(r*u+i*s+a*o-n*c),e[2]=2*(a*u+i*c+n*s-r*o),e}function wa(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=.5*n[0],c=.5*n[1],u=.5*n[2],l=t[4],g=t[5],d=t[6],I=t[7];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=o*s+a*u-i*c+l,e[5]=o*c+i*s-r*u+g,e[6]=o*u+r*c-a*s+d,e[7]=-r*s-a*c-i*u+I,e}function _a(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=s*o+l*r+c*i-u*a,d=c*o+l*a+u*r-s*i,I=u*o+l*i+s*a-c*r,A=l*o-s*r-c*a-u*i;return Rr(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=g*o+A*r+d*i-I*a,e[5]=d*o+A*a+I*r-g*i,e[6]=I*o+A*i+g*a-d*r,e[7]=A*o-g*r-d*a-I*i,e}function Za(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=s*o+l*r+c*i-u*a,d=c*o+l*a+u*r-s*i,I=u*o+l*i+s*a-c*r,A=l*o-s*r-c*a-u*i;return Mr(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=g*o+A*r+d*i-I*a,e[5]=d*o+A*a+I*r-g*i,e[6]=I*o+A*i+g*a-d*r,e[7]=A*o-g*r-d*a-I*i,e}function Sa(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],c=t[5],u=t[6],l=t[7],g=s*o+l*r+c*i-u*a,d=c*o+l*a+u*r-s*i,I=u*o+l*i+s*a-c*r,A=l*o-s*r-c*a-u*i;return kr(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=g*o+A*r+d*i-I*a,e[5]=d*o+A*a+I*r-g*i,e[6]=I*o+A*i+g*a-d*r,e[7]=A*o-g*r-d*a-I*i,e}function xa(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=t[0],c=t[1],u=t[2],l=t[3];return e[0]=s*o+l*r+c*i-u*a,e[1]=c*o+l*a+u*r-s*i,e[2]=u*o+l*i+s*a-c*r,e[3]=l*o-s*r-c*a-u*i,s=t[4],c=t[5],u=t[6],l=t[7],e[4]=s*o+l*r+c*i-u*a,e[5]=c*o+l*a+u*r-s*i,e[6]=u*o+l*i+s*a-c*r,e[7]=l*o-s*r-c*a-u*i,e}function Ra(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*l+o*s+a*u-i*c,e[1]=a*l+o*c+i*s-r*u,e[2]=i*l+o*u+r*c-a*s,e[3]=o*l-r*s-a*c-i*u,s=n[4],c=n[5],u=n[6],l=n[7],e[4]=r*l+o*s+a*u-i*c,e[5]=a*l+o*c+i*s-r*u,e[6]=i*l+o*u+r*c-a*s,e[7]=o*l-r*s-a*c-i*u,e}function Ma(e,t,n,r){if(Math.abs(r)<I)return fa(e,t);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var i=Math.sin(r),o=i*n[0]/a,s=i*n[1]/a,c=i*n[2]/a,u=Math.cos(r),l=t[0],g=t[1],d=t[2],A=t[3];e[0]=l*u+A*o+g*c-d*s,e[1]=g*u+A*s+d*o-l*c,e[2]=d*u+A*c+l*s-g*o,e[3]=A*u-l*o-g*s-d*c;var h=t[4],C=t[5],f=t[6],p=t[7];return e[4]=h*u+p*o+C*c-f*s,e[5]=C*u+p*s+f*o-h*c,e[6]=f*u+p*c+h*s-C*o,e[7]=p*u-h*o-C*s-f*c,e}function ka(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Ea(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[4],c=n[5],u=n[6],l=n[7],g=t[4],d=t[5],I=t[6],A=t[7],h=n[0],C=n[1],f=n[2],p=n[3];return e[0]=r*p+o*h+a*f-i*C,e[1]=a*p+o*C+i*h-r*f,e[2]=i*p+o*f+r*C-a*h,e[3]=o*p-r*h-a*C-i*f,e[4]=r*l+o*s+a*u-i*c+g*p+A*h+d*f-I*C,e[5]=a*l+o*c+i*s-r*u+d*p+A*C+I*h-g*f,e[6]=i*l+o*u+r*c-a*s+I*p+A*f+g*C-d*h,e[7]=o*l-r*s-a*c-i*u+A*p-g*h-d*C-I*f,e}var Wa=Ea;function Va(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var Fa=Jr;function Xa(e,t,n,r){var a=1-r;return Fa(t,n)<0&&(r=-r),e[0]=t[0]*a+n[0]*r,e[1]=t[1]*a+n[1]*r,e[2]=t[2]*a+n[2]*r,e[3]=t[3]*a+n[3]*r,e[4]=t[4]*a+n[4]*r,e[5]=t[5]*a+n[5]*r,e[6]=t[6]*a+n[6]*r,e[7]=t[7]*a+n[7]*r,e}function Ha(e,t){var n=Ya(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function Oa(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var La=$r,Na=La,Ya=ta,Ta=Ya;function za(e,t){var n=Ya(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,a=t[1]/n,i=t[2]/n,o=t[3]/n,s=t[4],c=t[5],u=t[6],l=t[7],g=r*s+a*c+i*u+o*l;e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=(s-r*g)/n,e[5]=(c-a*g)/n,e[6]=(u-i*g)/n,e[7]=(l-o*g)/n}return e}function Ka(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ja(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function Da(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],l=t[0],g=t[1],d=t[2],A=t[3],h=t[4],C=t[5],f=t[6],p=t[7];return Math.abs(n-l)<=I*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-g)<=I*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-d)<=I*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(i-A)<=I*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(o-h)<=I*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-C)<=I*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(c-f)<=I*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-p)<=I*Math.max(1,Math.abs(u),Math.abs(p))}function Ua(){var e=new A(2);return A!=Float32Array&&(e[0]=0,e[1]=0),e}function Qa(e){var t=new A(2);return t[0]=e[0],t[1]=e[1],t}function Pa(e,t){var n=new A(2);return n[0]=e,n[1]=t,n}function Ja(e,t){return e[0]=t[0],e[1]=t[1],e}function qa(e,t,n){return e[0]=t,e[1]=n,e}function $a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ei(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ti(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function ni(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function ri(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ai(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ii(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function oi(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function si(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ci(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function ui(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function li(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function gi(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function di(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function Ii(e){var t=e[0],n=e[1];return t*t+n*n}function Ai(e,t){return e[0]=-t[0],e[1]=-t[1],e}function hi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ci(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function fi(e,t){return e[0]*t[0]+e[1]*t[1]}function pi(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function mi(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e}function vi(e,t){t=t||1;var n=2*h()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function bi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e}function yi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e}function Bi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e}function Gi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e}function wi(e,t,n,r){var a=t[0]-n[0],i=t[1]-n[1],o=Math.sin(r),s=Math.cos(r);return e[0]=a*s-i*o+n[0],e[1]=a*o+i*s+n[1],e}function _i(e,t){var n=e[0],r=e[1],a=t[0],i=t[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var s=a*a+i*i;s>0&&(s=1/Math.sqrt(s));var c=(n*a+r*i)*o*s;return c>1?0:c<-1?Math.PI:Math.acos(c)}function Zi(e){return e[0]=0,e[1]=0,e}function Si(e){return"vec2("+e[0]+", "+e[1]+")"}function xi(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ri(e,t){var n=e[0],r=e[1],a=t[0],i=t[1];return Math.abs(n-a)<=I*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=I*Math.max(1,Math.abs(r),Math.abs(i))}var Mi=di,ki=ei,Ei=ti,Wi=ni,Vi=li,Fi=gi,Xi=Ii,Hi=function(){var e=Ua();return function(t,n,r,a,i,o){var s,c;for(n||(n=2),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],i(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return f}));n(22);var r,a,i,o,s,c,u,l,g=n(5),d=n(4),I=(new Uint8Array([0]),[171,75,84,88,32,50,48,187,13,10,26,10]);!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(r||(r={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(a||(a={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(i||(i={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(o||(o={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(s||(s={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(c||(c={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(u||(u={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(l||(l={}));var A=Object(g.a)((function e(){Object(d.a)(this,e),this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=r.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:a.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:i.UNSPECIFIED,colorPrimaries:o.SRGB,transferFunction:o.SRGB,flags:c.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null})),h=function(){function e(t,n,r,a){Object(d.a)(this,e),this._dataView=new DataView(t.buffer,t.byteOffset+n,r),this._littleEndian=a,this._offset=0}return Object(g.a)(e,[{key:"_nextUint8",value:function(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e}},{key:"_nextUint16",value:function(){var e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}},{key:"_nextUint32",value:function(){var e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}},{key:"_nextUint64",value:function(){var e=this._dataView.getUint32(this._offset,this._littleEndian)+Math.pow(2,32)*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}},{key:"_skip",value:function(e){return this._offset+=e,this}},{key:"_scan",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._offset,r=0;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}]),e}();function C(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):e.from(t).toString("utf8")}function f(e){var t=new Uint8Array(e.buffer,e.byteOffset,I.length);if(t[0]!==I[0]||t[1]!==I[1]||t[2]!==I[2]||t[3]!==I[3]||t[4]!==I[4]||t[5]!==I[5]||t[6]!==I[6]||t[7]!==I[7]||t[8]!==I[8]||t[9]!==I[9]||t[10]!==I[10]||t[11]!==I[11])throw new Error("Missing KTX 2.0 identifier.");var n=new A,r=17*Uint32Array.BYTES_PER_ELEMENT,a=new h(e,I.length,r,!0);n.vkFormat=a._nextUint32(),n.typeSize=a._nextUint32(),n.pixelWidth=a._nextUint32(),n.pixelHeight=a._nextUint32(),n.pixelDepth=a._nextUint32(),n.layerCount=a._nextUint32(),n.faceCount=a._nextUint32();var i=a._nextUint32();n.supercompressionScheme=a._nextUint32();for(var o=a._nextUint32(),s=a._nextUint32(),c=a._nextUint32(),u=a._nextUint32(),l=a._nextUint64(),g=a._nextUint64(),d=new h(e,I.length+r,3*i*8,!0),f=0;f<i;f++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});for(var p=new h(e,o,s,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:{x:p._nextUint8()+1,y:p._nextUint8()+1,z:p._nextUint8()+1,w:p._nextUint8()+1},bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},v=(m.descriptorBlockSize/4-6)/4,b=0;b<v;b++)m.samples[b]={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelID:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:p._nextUint32(),sampleUpper:p._nextUint32()};n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(m);for(var y=new h(e,c,u,!0);y._offset<u;){var B=y._nextUint32(),G=y._scan(B),w=C(G),_=y._scan(B-G.byteLength);n.keyValue[w]=w.match(/^ktx/i)?C(_):_,y._offset%4&&y._skip(4-y._offset%4)}if(g<=0)return n;for(var Z=new h(e,l,g,!0),S=Z._nextUint16(),x=Z._nextUint16(),R=Z._nextUint32(),M=Z._nextUint32(),k=Z._nextUint32(),E=Z._nextUint32(),W=[],V=0;V<i;V++)W.push({imageFlags:Z._nextUint32(),rgbSliceByteOffset:Z._nextUint32(),rgbSliceByteLength:Z._nextUint32(),alphaSliceByteOffset:Z._nextUint32(),alphaSliceByteLength:Z._nextUint32()});var F=l+Z._offset,X=F+R,H=X+M,O=H+k,L=new Uint8Array(e.buffer,e.byteOffset+F,R),N=new Uint8Array(e.buffer,e.byteOffset+X,M),Y=new Uint8Array(e.buffer,e.byteOffset+H,k),T=new Uint8Array(e.buffer,e.byteOffset+O,E);return n.globalData={endpointCount:S,selectorCount:x,imageDescs:W,endpointsData:L,selectorsData:N,tablesData:Y,extendedData:T},n}}).call(this,n(96).Buffer)},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(165),a=n(166),i=n(70),o=n(167);e.exports=function(e,t){return r(e)||a(e,t)||i(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(54);function a(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(108)},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(43).default,o=n(38).default,s=n(29).default,c=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=t.CameraMirrorMode=t.CameraPoseMode=void 0;var u,l,g,d=n(44),I=n(31),A=n(61),h=n(86);!function(e){e[e.Default=0]="Default",e[e.Attitude=1]="Attitude",e[e.AnchorOrigin=2]="AnchorOrigin"}(u=t.CameraPoseMode||(t.CameraPoseMode={})),function(e){e[e.None=0]="None",e[e.Poses=1]="Poses",e[e.CSS=2]="CSS"}(l=t.CameraMirrorMode||(t.CameraMirrorMode={})),function(e){e[e.None=0]="None",e[e.User=1]="User",e[e.Rear=2]="Rear"}(g||(g={}));var C=function(e){s(n,e);var t=c(n);function n(e){var a;return r(this,n),(a=t.call(this)).poseMode=u.Default,a.rearCameraMirrorMode=l.None,a.userCameraMirrorMode=l.Poses,a._currentMirrorMode=l.None,a.isPerspectiveCamera=!0,a.cameraDirection=g.None,a.hasSetCSSScaleX=!1,a.renderWidth=0,a.renderHeight=0,a.pipeline=e instanceof d.Pipeline?e:(null===e||void 0===e?void 0:e.pipeline)||(0,A.getDefaultPipeline)(),a.rawPose=a.pipeline.cameraPoseDefault(),!e||e instanceof d.Pipeline?(a.rearCameraSource=new A.CameraSource(d.cameraDefaultDeviceID(),a.pipeline),a.userCameraSource=new A.CameraSource(d.cameraDefaultDeviceID(!0),a.pipeline),a.backgroundTexture=new h.CameraTexture):(a.zNear=e.zNear?e.zNear:.1,a.zFar=e.zFar?e.zFar:100,a.rearCameraSource=a.cameraSourceFromOpts(e.rearCameraSource),a.userCameraSource=a.cameraSourceFromOpts(e.userCameraSource,!0),a.backgroundTexture=e.backgroundTexture?e.backgroundTexture:new h.CameraTexture),a.matrixAutoUpdate=!1,document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState?a.resume():a.pause()})),a}return a(n,[{key:"cameraSourceFromOpts",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e instanceof Element?new d.HTMLElementSource(this.pipeline,e):new A.CameraSource(e||d.cameraDefaultDeviceID(t),this.pipeline)}},{key:"pause",value:function(){this.userCameraSource.pause(),this.rearCameraSource.pause()}},{key:"resume",value:function(){switch(this.cameraDirection){case g.User:this.userCameraSource.start();break;case g.Rear:this.rearCameraSource.start()}}},{key:"start",value:function(e){this.cameraDirection=e?g.User:g.Rear,this.resume()}},{key:"stop",value:function(){this.cameraDirection=g.None,this.pause()}},{key:"setPoseModeAnchorOrigin",value:function(e){this.poseAnchorOrigin=e,this.poseMode=u.AnchorOrigin}},{key:"currentMirrorMode",get:function(){return this._currentMirrorMode}},{key:"updateFrame",value:function(e){e.state.reset(),this.pipeline.processGL(),e.state.reset(),this.pipeline.frameUpdate(),this._currentMirrorMode=this.pipeline.cameraFrameUserFacing()?this.userCameraMirrorMode:this.rearCameraMirrorMode;var t=e.domElement;switch(this.currentMirrorMode!==l.CSS&&this.hasSetCSSScaleX?(t.style.transform="",this.hasSetCSSScaleX=!1):this.currentMirrorMode!==l.CSS||this.hasSetCSSScaleX||(t.style.transform="scaleX(-1)",this.hasSetCSSScaleX=!0),this.renderWidth=e.domElement.width,this.renderHeight=e.domElement.height,this._updateProjectionMatrix(),this.poseMode){case u.Default:this.rawPose=this.pipeline.cameraPoseDefault();break;case u.Attitude:this.rawPose=this.pipeline.cameraPoseWithAttitude(this.currentMirrorMode===l.Poses);break;case u.AnchorOrigin:this.rawPose=this.poseAnchorOrigin?this.getOriginPose():this.pipeline.cameraPoseDefault();break;default:this.rawPose=this.pipeline.cameraPoseDefault()}this.backgroundTexture.MirrorMode=this.currentMirrorMode,this.backgroundTexture.updateFromPipeline(e,this.pipeline)}},{key:"_updateProjectionMatrix",value:function(){var e=this.pipeline.cameraModel(),t=d.projectionMatrixFromCameraModel(e,this.renderWidth,this.renderHeight,this.zNear,this.zFar);this.projectionMatrix.fromArray(t),"function"===typeof this.projectionMatrixInverse.invert?this.projectionMatrixInverse.copy(this.projectionMatrix).invert():this.projectionMatrixInverse.getInverse(this.projectionMatrix)}},{key:"updateMatrixWorld",value:function(e){this.matrix.fromArray(this.rawPose),this.matrix.decompose(this.position,this.quaternion,this.scale),i(o(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"getOriginPose",value:function(){return this.poseAnchorOrigin?this.pipeline.cameraPoseWithOrigin(this.poseAnchorOrigin.poseCameraRelative(this.currentMirrorMode===l.Poses)):this.pipeline.cameraPoseDefault()}},{key:"dispose",value:function(){this.rearCameraSource.destroy(),this.userCameraSource.destroy()}}]),n}(I.THREE.Camera);t.Camera=C},function(e,t,n){var r=n(113);function a(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=a=Reflect.get,e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var a=r(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(this,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadedPromise=t.loaded=t.browserIncompatibleUI=t.browserIncompatible=t.projectionMatrixFromCameraModel=t.drawPlane=t.invert=t.cameraDefaultDeviceID=t.Event1=t.Event=t.logLevel=t.setLogLevel=t.LogLevel=t.Permission=t.permissionRequestUI=t.permissionRequest=t.permissionDenied=t.permissionGranted=t.permissionDeniedUI=t.FaceLandmark=t.FaceLandmarkName=t.Pipeline=t.HTMLElementSource=t.CameraSource=t.FaceMesh=t.FaceTracker=t.BarcodeFinder=t.InstantWorldTracker=t.ImageTracker=void 0;var r=n(118);Object.defineProperty(t,"ImageTracker",{enumerable:!0,get:function(){return r.ImageTracker}});var a=n(145);Object.defineProperty(t,"InstantWorldTracker",{enumerable:!0,get:function(){return a.InstantWorldTracker}});var i=n(146);Object.defineProperty(t,"BarcodeFinder",{enumerable:!0,get:function(){return i.BarcodeFinder}});var o=n(147);Object.defineProperty(t,"FaceTracker",{enumerable:!0,get:function(){return o.FaceTracker}});var s=n(148);Object.defineProperty(t,"FaceMesh",{enumerable:!0,get:function(){return s.FaceMesh}});var c=n(149);Object.defineProperty(t,"CameraSource",{enumerable:!0,get:function(){return c.CameraSource}});var u=n(150);Object.defineProperty(t,"HTMLElementSource",{enumerable:!0,get:function(){return u.HTMLElementSource}});var l=n(151);Object.defineProperty(t,"Pipeline",{enumerable:!0,get:function(){return l.Pipeline}});var g=n(152);Object.defineProperty(t,"FaceLandmarkName",{enumerable:!0,get:function(){return g.FaceLandmarkName}}),Object.defineProperty(t,"FaceLandmark",{enumerable:!0,get:function(){return g.FaceLandmark}});var d=n(153);Object.defineProperty(t,"permissionDeniedUI",{enumerable:!0,get:function(){return d.permissionDeniedUI}}),Object.defineProperty(t,"permissionGranted",{enumerable:!0,get:function(){return d.permissionGranted}}),Object.defineProperty(t,"permissionDenied",{enumerable:!0,get:function(){return d.permissionDenied}}),Object.defineProperty(t,"permissionRequest",{enumerable:!0,get:function(){return d.permissionRequest}}),Object.defineProperty(t,"permissionRequestUI",{enumerable:!0,get:function(){return d.permissionRequestUI}}),Object.defineProperty(t,"Permission",{enumerable:!0,get:function(){return d.Permission}});var I=n(154);Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return I.LogLevel}}),Object.defineProperty(t,"setLogLevel",{enumerable:!0,get:function(){return I.setLogLevel}}),Object.defineProperty(t,"logLevel",{enumerable:!0,get:function(){return I.logLevel}});var A=n(45);Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return A.Event}}),Object.defineProperty(t,"Event1",{enumerable:!0,get:function(){return A.Event1}});var h=n(33);Object.defineProperty(t,"cameraDefaultDeviceID",{enumerable:!0,get:function(){return h.cameraDefaultDeviceID}}),Object.defineProperty(t,"invert",{enumerable:!0,get:function(){return h.invert}}),Object.defineProperty(t,"drawPlane",{enumerable:!0,get:function(){return h.drawPlane}}),Object.defineProperty(t,"projectionMatrixFromCameraModel",{enumerable:!0,get:function(){return h.projectionMatrixFromCameraModel}}),Object.defineProperty(t,"browserIncompatible",{enumerable:!0,get:function(){return h.browserIncompatible}}),Object.defineProperty(t,"browserIncompatibleUI",{enumerable:!0,get:function(){return h.browserIncompatibleUI}}),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return h.loaded}}),Object.defineProperty(t,"loadedPromise",{enumerable:!0,get:function(){return h.loadedPromise}})},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Event1=t.Event=void 0;var i=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(){for(var e=0,t=this._funcs.length;e<t;e++)this._funcs[e]()}}]),e}();t.Event=i;var o=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e){for(var t=0,n=this._funcs.length;t<n;t++)this._funcs[t](e)}}]),e}();t.Event1=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zcwarn=t.zcerr=t.zcout=t.setLogLevel=void 0;var r=n(82),a=r.log_level_t.LOG_LEVEL_ERROR;t.setLogLevel=function(e){a=e},t.zcout=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];a>=r.log_level_t.LOG_LEVEL_VERBOSE&&(e=console).log.apply(e,["[Zappar] INFO"].concat(n))},t.zcerr=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];a>=r.log_level_t.LOG_LEVEL_ERROR&&(e=console).error.apply(e,["[Zappar] ERROR"].concat(n))},t.zcwarn=function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];a>=r.log_level_t.LOG_LEVEL_VERBOSE&&(e=console).log.apply(e,["[Zappar] WARN"].concat(n))}},function(e,t,n){"use strict";e.exports=n(109)},function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,"a",(function(){return r}))},function(e,t,n){e.exports=n(186)()},function(e,t,n){var r=n(70);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";if(Object.defineProperty(t,"__esModule",{value:!0}),t.log_level_t=t.instant_world_tracker_transform_orientation_t=t.face_landmark_name_t=t.barcode_format_t=t.initialize=void 0,"undefined"!==typeof Z_STANDALONE&&Z_STANDALONE&&document.currentScript){var r=new URL(document.currentScript.src),a=r.toString();if(r.pathname){var i=a.split("/");i.pop(),a=i.join("/")+"/"}n.p=a}var o=n(120),s=n(143);t.initialize=function(){return console.log("Zappar CV v".concat(s.VERSION)),o.initialize()};var c=n(82);Object.defineProperty(t,"barcode_format_t",{enumerable:!0,get:function(){return c.barcode_format_t}}),Object.defineProperty(t,"face_landmark_name_t",{enumerable:!0,get:function(){return c.face_landmark_name_t}}),Object.defineProperty(t,"instant_world_tracker_transform_orientation_t",{enumerable:!0,get:function(){return c.instant_world_tracker_transform_orientation_t}}),Object.defineProperty(t,"log_level_t",{enumerable:!0,get:function(){return c.log_level_t}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.linkProgram=t.compileShader=void 0,t.compileShader=function(e,t,n){var r=e.createShader(t);if(!r)throw new Error("Unable to create shader");e.shaderSource(r,n),e.compileShader(r);var a=e.getShaderInfoLog(r);if(a&&a.trim().length>0)throw new Error("Shader compile error: "+a);return r},t.linkProgram=function(e,t){e.linkProgram(t);var n=e.getProgramInfoLog(t);if(n&&n.trim().length>0)throw new Error("Unable to link: "+n)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(171)),i=(0,a.default)((function(e){return{object:void 0,set:function(t){return e({object:t})}}})),o=(0,a.default)((function(e){return{object:void 0,set:function(t){return e({object:t})}}})),s=(0,a.default)((function(e){return{object:void 0,set:function(t){return e({object:t})}}})),c=(0,a.default)((function(e){return{object:void 0,set:function(t){return e({object:t})}}}));t.default={camera:i,imageTracker:o,instantTracker:s,faceTracker:c}},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(11),a=n(48);var i=n(25);function o(e){var t="function"===typeof Map?new Map:void 0;return o=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,o)}function o(){return Object(i.a)(e,arguments,Object(r.a)(this).constructor)}return o.prototype=Object.create(e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),Object(a.a)(o,e)},o(e)}},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,a,i;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(a=r;0!==a--;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=r;0!==a--;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;for(a=r;0!==a--;){var o=i[a];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return lt})),n.d(t,"b",(function(){return ct})),n.d(t,"c",(function(){return st})),n.d(t,"d",(function(){return ut}));var r=n(14),a=(n(25),n(16)),i=(n(22),n(6)),o=n(7),s=n(4),c=n(5),u=n(13),l=n(10),g=n(1),d=n.n(g),I=n(9),A=n(0),h=["onCollide","onCollideBegin","onCollideEnd"],C=Object(g.createContext)({}),f=Object(g.createContext)(null);function p(e,t,n){var r=void 0===t?null:t,a=function(e,t){var n=atob(e);if(t){for(var r=new Uint8Array(n.length),a=0,i=n.length;a<i;++a)r[a]=n.charCodeAt(a);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return n}(e,void 0!==n&&n),i=a.indexOf("\n",10)+1,o=a.substring(i)+(r?"//# sourceMappingURL="+r:""),s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}var m=function(e,t,n){var r;return function(a){return r=r||p(e,t,n),new Worker(r,a)}}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KICAvKioKICAgKiBBIDN4MyBtYXRyaXguCiAgICogQXV0aG9yZWQgYnkge0BsaW5rIGh0dHA6Ly9naXRodWIuY29tL3NjaHRlcHBlLyBzY2h0ZXBwZX0KICAgKi8KCgogIGNsYXNzIE1hdDMgewogICAgLyoqCiAgICAgKiBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZWxlbWVudHMgQSB2ZWN0b3Igb2YgbGVuZ3RoIDksIGNvbnRhaW5pbmcgYWxsIG1hdHJpeCBlbGVtZW50cy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZWxlbWVudHMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF0pIHsKICAgICAgdGhpcy5lbGVtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggdG8gaWRlbnRpdHkKICAgICAqIEB0b2RvIFNob3VsZCBwZXJoYXBzIGJlIHJlbmFtZWQgdG8gYHNldElkZW50aXR5KClgIHRvIGJlIG1vcmUgY2xlYXIuCiAgICAgKiBAdG9kbyBDcmVhdGUgYW5vdGhlciBmdW5jdGlvbiB0aGF0IGltbWVkaWF0ZWx5IGNyZWF0ZXMgYW4gaWRlbnRpdHkgbWF0cml4IGVnLiBgZXllKClgCiAgICAgKi8KCgogICAgaWRlbnRpdHkoKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMTsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDE7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAxOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGVsZW1lbnRzIHRvIHplcm8KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVswXSA9IDA7CiAgICAgIGVbMV0gPSAwOwogICAgICBlWzJdID0gMDsKICAgICAgZVszXSA9IDA7CiAgICAgIGVbNF0gPSAwOwogICAgICBlWzVdID0gMDsKICAgICAgZVs2XSA9IDA7CiAgICAgIGVbN10gPSAwOwogICAgICBlWzhdID0gMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF0cml4IGRpYWdvbmFsIGVsZW1lbnRzIGZyb20gYSBWZWMzCiAgICAgKi8KCgogICAgc2V0VHJhY2UodmVjdG9yKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gdmVjdG9yLng7CiAgICAgIGVbNF0gPSB2ZWN0b3IueTsKICAgICAgZVs4XSA9IHZlY3Rvci56OwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMKICAgICAqLwoKCiAgICBnZXRUcmFjZSh0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICB0YXJnZXQueCA9IGVbMF07CiAgICAgIHRhcmdldC55ID0gZVs0XTsKICAgICAgdGFyZ2V0LnogPSBlWzhdOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNYXRyaXgtVmVjdG9yIG11bHRpcGxpY2F0aW9uCiAgICAgKiBAcGFyYW0gdiBUaGUgdmVjdG9yIHRvIG11bHRpcGx5IHdpdGgKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwsIHRhcmdldCB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCA9IG5ldyBNYXQzKCkpIHsKICAgICAgY29uc3QgQSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IEIgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGNvbnN0IGExMSA9IEFbMF0sCiAgICAgICAgICAgIGExMiA9IEFbMV0sCiAgICAgICAgICAgIGExMyA9IEFbMl0sCiAgICAgICAgICAgIGEyMSA9IEFbM10sCiAgICAgICAgICAgIGEyMiA9IEFbNF0sCiAgICAgICAgICAgIGEyMyA9IEFbNV0sCiAgICAgICAgICAgIGEzMSA9IEFbNl0sCiAgICAgICAgICAgIGEzMiA9IEFbN10sCiAgICAgICAgICAgIGEzMyA9IEFbOF07CiAgICAgIGNvbnN0IGIxMSA9IEJbMF0sCiAgICAgICAgICAgIGIxMiA9IEJbMV0sCiAgICAgICAgICAgIGIxMyA9IEJbMl0sCiAgICAgICAgICAgIGIyMSA9IEJbM10sCiAgICAgICAgICAgIGIyMiA9IEJbNF0sCiAgICAgICAgICAgIGIyMyA9IEJbNV0sCiAgICAgICAgICAgIGIzMSA9IEJbNl0sCiAgICAgICAgICAgIGIzMiA9IEJbN10sCiAgICAgICAgICAgIGIzMyA9IEJbOF07CiAgICAgIFRbMF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAgIFRbMV0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CiAgICAgIFRbMl0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CiAgICAgIFRbM10gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CiAgICAgIFRbNF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzI7CiAgICAgIFRbNV0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzM7CiAgICAgIFRbNl0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAgIFRbN10gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CiAgICAgIFRbOF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGVhY2ggY29sdW1uIG9mIHRoZSBtYXRyaXgKICAgICAqLwoKCiAgICBzY2FsZSh2ZWN0b3IsIHRhcmdldCA9IG5ldyBNYXQzKCkpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHQgPSB0YXJnZXQuZWxlbWVudHM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gMzsgaSsrKSB7CiAgICAgICAgdFszICogaSArIDBdID0gdmVjdG9yLnggKiBlWzMgKiBpICsgMF07CiAgICAgICAgdFszICogaSArIDFdID0gdmVjdG9yLnkgKiBlWzMgKiBpICsgMV07CiAgICAgICAgdFszICogaSArIDJdID0gdmVjdG9yLnogKiBlWzMgKiBpICsgMl07CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIEF4PWIKICAgICAqIEBwYXJhbSBiIFRoZSByaWdodCBoYW5kIHNpZGUKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwuIFRhcmdldCB2ZWN0b3IgdG8gc2F2ZSBpbi4KICAgICAqIEByZXR1cm4gVGhlIHNvbHV0aW9uIHgKICAgICAqIEB0b2RvIHNob3VsZCByZXVzZSBhcnJheXMKICAgICAqLwoKCiAgICBzb2x2ZShiLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgIkNvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyIgKyB0YXJnZXQudG9TdHJpbmcoKSArICJdLCBiPVsiICsgYi50b1N0cmluZygpICsgIl0sIEE9WyIgKyB0aGlzLnRvU3RyaW5nKCkgKyAiXSI7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0ID0gbmV3IE1hdDMoKSkgewogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNjsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSByZXZlcnNlX2VxbnM7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICBlcW5zW2kgKyBuYyAqIGpdID0gdGhpcy5lbGVtZW50c1tpICsgMyAqIGpdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZXFuc1szICsgNiAqIDBdID0gMTsKICAgICAgZXFuc1szICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1szICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDFdID0gMTsKICAgICAgZXFuc1s0ICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDJdID0gMTsgLy8gQ29tcHV0ZSByaWdodCB1cHBlciB0cmlhbmd1bGFyIHZlcnNpb24gb2YgdGhlIG1hdHJpeCAtIEdhdXNzIGVsaW1pbmF0aW9uCgogICAgICBsZXQgbiA9IDM7CiAgICAgIGNvbnN0IGsgPSBuOwogICAgICBsZXQgbnA7CiAgICAgIGNvbnN0IGtwID0gbmM7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBpICkgPSBsaW5lKCBpICkgKyBsaW5lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBrICkgPSBsaW5lKCBrICkgLSBtdWx0aXBsaWVyICogbGluZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gZWxpbWluYXRlIHRoZSB1cHBlciBsZWZ0IHRyaWFuZ2xlIG9mIHRoZSBtYXRyaXgKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gaSAtIDE7CgogICAgICAgIGRvIHsKICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgIG5wID0gbmM7CgogICAgICAgICAgZG8gewogICAgICAgICAgICBwID0gbmMgLSBucDsKICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgIH0gd2hpbGUgKGotLSk7CiAgICAgIH0gd2hpbGUgKC0taSk7IC8vIG9wZXJhdGlvbnMgb24gdGhlIGRpYWdvbmFsCgoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IDEgLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgIG5wID0gbmM7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgZXFuc1twICsgbmMgKiBpXSA9IGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgaiA9IDI7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBlcW5zW25yICsgaiArIG5jICogaV07CgogICAgICAgICAgaWYgKGlzTmFOKHApIHx8IHAgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHRocm93ICJDb3VsZCBub3QgcmV2ZXJzZSEgQT1bIiArIHRoaXMudG9TdHJpbmcoKSArICJdIjsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQgPSBuZXcgTWF0MygpKSB7CiAgICAgIGNvbnN0IE0gPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCBUID0gdGFyZ2V0LmVsZW1lbnRzOwogICAgICBsZXQgdG1wOyAvL1NldCBkaWFnb25hbHMKCiAgICAgIFRbMF0gPSBNWzBdOwogICAgICBUWzRdID0gTVs0XTsKICAgICAgVFs4XSA9IE1bOF07CiAgICAgIHRtcCA9IE1bMV07CiAgICAgIFRbMV0gPSBNWzNdOwogICAgICBUWzNdID0gdG1wOwogICAgICB0bXAgPSBNWzJdOwogICAgICBUWzJdID0gTVs2XTsKICAgICAgVFs2XSA9IHRtcDsKICAgICAgdG1wID0gTVs1XTsKICAgICAgVFs1XSA9IE1bN107CiAgICAgIFRbN10gPSB0bXA7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KCiAgY29uc3QgcmV2ZXJzZV9lcW5zID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogIC8qKgogICAqIDMtZGltZW5zaW9uYWwgdmVjdG9yCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgdiA9IG5ldyBWZWMzKDEsIDIsIDMpCiAgICogICAgIGNvbnNvbGUubG9nKCd4PScgKyB2LngpIC8vIHg9MQogICAqLwoKICBjbGFzcyBWZWMzIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLjAsIHkgPSAwLjAsIHogPSAwLjApIHsKICAgICAgdGhpcy54ID0gdm9pZCAwOwogICAgICB0aGlzLnkgPSB2b2lkIDA7CiAgICAgIHRoaXMueiA9IHZvaWQgMDsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIGNyb3NzIHByb2R1Y3QKICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4uCiAgICAgKi8KCgogICAgY3Jvc3ModmVjdG9yLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGNvbnN0IHZ4ID0gdmVjdG9yLng7CiAgICAgIGNvbnN0IHZ5ID0gdmVjdG9yLnk7CiAgICAgIGNvbnN0IHZ6ID0gdmVjdG9yLno7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geSAqIHZ6IC0geiAqIHZ5OwogICAgICB0YXJnZXQueSA9IHogKiB2eCAtIHggKiB2ejsKICAgICAgdGFyZ2V0LnogPSB4ICogdnkgLSB5ICogdng7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmVjdG9ycycgMyBlbGVtZW50cwogICAgICovCgoKICAgIHNldCh4LCB5LCB6KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB0byB6ZXJvLgogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIHRoaXMueCA9IHRoaXMueSA9IHRoaXMueiA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIFZlY3RvciBhZGRpdGlvbgogICAgICovCgoKICAgIHZhZGQodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdmVjdG9yLnggKyB0aGlzLng7CiAgICAgICAgdGFyZ2V0LnkgPSB2ZWN0b3IueSArIHRoaXMueTsKICAgICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICsgdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggKyB2ZWN0b3IueCwgdGhpcy55ICsgdmVjdG9yLnksIHRoaXMueiArIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3Igc3VidHJhY3Rpb24KICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4uCiAgICAgKi8KCgogICAgdnN1Yih2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgdGFyZ2V0LnggPSB0aGlzLnggLSB2ZWN0b3IueDsKICAgICAgICB0YXJnZXQueSA9IHRoaXMueSAtIHZlY3Rvci55OwogICAgICAgIHRhcmdldC56ID0gdGhpcy56IC0gdmVjdG9yLno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG5ldyBWZWMzKHRoaXMueCAtIHZlY3Rvci54LCB0aGlzLnkgLSB2ZWN0b3IueSwgdGhpcy56IC0gdmVjdG9yLnopOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY3Jvc3MgcHJvZHVjdCBtYXRyaXggYV9jcm9zcyBmcm9tIGEgdmVjdG9yLCBzdWNoIHRoYXQgYSB4IGIgPSBhX2Nyb3NzICogYiA9IGMKICAgICAqCiAgICAgKiBTZWUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyL1REQkQyNC9WVDA2L2xlY3R1cmVzL0xlY3R1cmU2LnBkZiBVbWXDpSBVbml2ZXJzaXR5IExlY3R1cmV9CiAgICAgKi8KCgogICAgY3Jvc3NtYXQoKSB7CiAgICAgIHJldHVybiBuZXcgTWF0MyhbMCwgLXRoaXMueiwgdGhpcy55LCB0aGlzLnosIDAsIC10aGlzLngsIC10aGlzLnksIHRoaXMueCwgMF0pOwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHZlY3Rvci4gTm90ZSB0aGF0IHRoaXMgY2hhbmdlcyB0aGUgdmFsdWVzIGluIHRoZSB2ZWN0b3IuCiAgICAgICogQHJldHVybiBSZXR1cm5zIHRoZSBub3JtIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IG4gPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuID4gMC4wKSB7CiAgICAgICAgY29uc3QgaW52TiA9IDEgLyBuOwogICAgICAgIHRoaXMueCAqPSBpbnZOOwogICAgICAgIHRoaXMueSAqPSBpbnZOOwogICAgICAgIHRoaXMueiAqPSBpbnZOOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIE1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZlcnNpb24gb2YgdGhpcyB2ZWN0b3IgdGhhdCBpcyBvZiBsZW5ndGggMS4KICAgICAqIEBwYXJhbSB0YXJnZXQgT3B0aW9uYWwgdGFyZ2V0IHRvIHNhdmUgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgdW5pdCB2ZWN0b3IKICAgICAqLwoKCiAgICB1bml0KHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgdGFyZ2V0LnggPSBzY2FsYXIgKiB4OwogICAgICB0YXJnZXQueSA9IHNjYWxhciAqIHk7CiAgICAgIHRhcmdldC56ID0gc2NhbGFyICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHZlY3RvciB3aXRoIGFuIG90aGVyIHZlY3RvciwgY29tcG9uZW50LXdpc2UuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB2ZWN0b3IgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWwodmVjdG9yLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRhcmdldC54ID0gdmVjdG9yLnggKiB0aGlzLng7CiAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKiB0aGlzLnk7CiAgICAgIHRhcmdldC56ID0gdmVjdG9yLnogKiB0aGlzLno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGEgdmVjdG9yIGFuZCBhZGQgaXQgdG8gdGhpcyB2ZWN0b3IuIFNhdmUgdGhlIHJlc3VsdCBpbiAidGFyZ2V0Ii4gKHRhcmdldCA9IHRoaXMgKyB2ZWN0b3IgKiBzY2FsYXIpCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB2ZWN0b3IgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIGFkZFNjYWxlZFZlY3RvcihzY2FsYXIsIHZlY3RvciwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdHdvIGFydGlmaWNpYWwgdGFuZ2VudHMgdG8gdGhlIHZlY3RvcgogICAgICogQHBhcmFtIHQxIFZlY3RvciBvYmplY3QgdG8gc2F2ZSB0aGUgZmlyc3QgdGFuZ2VudCBpbgogICAgICogQHBhcmFtIHQyIFZlY3RvciBvYmplY3QgdG8gc2F2ZSB0aGUgc2Vjb25kIHRhbmdlbnQgaW4KICAgICAqLwoKCiAgICB0YW5nZW50cyh0MSwgdDIpIHsKICAgICAgY29uc3Qgbm9ybSA9IHRoaXMubGVuZ3RoKCk7CgogICAgICBpZiAobm9ybSA+IDAuMCkgewogICAgICAgIGNvbnN0IG4gPSBWZWMzX3RhbmdlbnRzX247CiAgICAgICAgY29uc3QgaW5vcm0gPSAxIC8gbm9ybTsKICAgICAgICBuLnNldCh0aGlzLnggKiBpbm9ybSwgdGhpcy55ICogaW5vcm0sIHRoaXMueiAqIGlub3JtKTsKICAgICAgICBjb25zdCByYW5kVmVjID0gVmVjM190YW5nZW50c19yYW5kVmVjOwoKICAgICAgICBpZiAoTWF0aC5hYnMobi54KSA8IDAuOSkgewogICAgICAgICAgcmFuZFZlYy5zZXQoMSwgMCwgMCk7CiAgICAgICAgICBuLmNyb3NzKHJhbmRWZWMsIHQxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFuZFZlYy5zZXQoMCwgMSwgMCk7CiAgICAgICAgICBuLmNyb3NzKHJhbmRWZWMsIHQxKTsKICAgICAgICB9CgogICAgICAgIG4uY3Jvc3ModDEsIHQyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGUgbm9ybWFsIGxlbmd0aCBpcyB6ZXJvLCBtYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHQxLnNldCgxLCAwLCAwKTsKICAgICAgICB0Mi5zZXQoMCwgMSwgMCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29udmVydHMgdG8gYSBtb3JlIHJlYWRhYmxlIGZvcm1hdAogICAgICovCgoKICAgIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy54ICsgIiwiICsgdGhpcy55ICsgIiwiICsgdGhpcy56OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uID0gMWUtNikgewogICAgICBpZiAoTWF0aC5hYnModGhpcy54IC0gdmVjdG9yLngpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueSAtIHZlY3Rvci55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnogLSB2ZWN0b3IueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZlY3RvciBpcyBhbG1vc3QgemVybwogICAgICovCgoKICAgIGFsbW9zdFplcm8ocHJlY2lzaW9uID0gMWUtNikgewogICAgICBpZiAoTWF0aC5hYnModGhpcy54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgdmVjdG9yIGlzIGFudGktcGFyYWxsZWwgdG8gYW5vdGhlciB2ZWN0b3IuCiAgICAgKiBAcGFyYW0gcHJlY2lzaW9uIFNldCB0byB6ZXJvIGZvciBleGFjdCBjb21wYXJpc29ucwogICAgICovCgoKICAgIGlzQW50aXBhcmFsbGVsVG8odmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgdGhpcy5uZWdhdGUoYW50aXBfbmVnKTsKICAgICAgcmV0dXJuIGFudGlwX25lZy5hbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLngsIHRoaXMueSwgdGhpcy56KTsKICAgIH0KCiAgfQoKICBWZWMzLlpFUk8gPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ggPSB2b2lkIDA7CiAgVmVjMy5VTklUX1kgPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ogPSB2b2lkIDA7CiAgVmVjMy5aRVJPID0gbmV3IFZlYzMoMCwgMCwgMCk7CiAgVmVjMy5VTklUX1ggPSBuZXcgVmVjMygxLCAwLCAwKTsKICBWZWMzLlVOSVRfWSA9IG5ldyBWZWMzKDAsIDEsIDApOwogIFZlYzMuVU5JVF9aID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgY29uc3QgVmVjM190YW5nZW50c19uID0gbmV3IFZlYzMoKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX3JhbmRWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFudGlwX25lZyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KCiAgY2xhc3MgQUFCQiB7CiAgICAvKioKICAgICAqIFRoZSBsb3dlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB1cHBlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLmxvd2VyQm91bmQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXBwZXJCb3VuZCA9IHZvaWQgMDsKICAgICAgdGhpcy5sb3dlckJvdW5kID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cHBlckJvdW5kID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvd2VyQm91bmQpIHsKICAgICAgICB0aGlzLmxvd2VyQm91bmQuY29weShvcHRpb25zLmxvd2VyQm91bmQpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy51cHBlckJvdW5kKSB7CiAgICAgICAgdGhpcy51cHBlckJvdW5kLmNvcHkob3B0aW9ucy51cHBlckJvdW5kKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIEFBQkIgYm91bmRzIGZyb20gYSBzZXQgb2YgcG9pbnRzLgogICAgICogQHBhcmFtIHBvaW50cyBBbiBhcnJheSBvZiBWZWMzJ3MuCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdAogICAgICovCgoKICAgIHNldEZyb21Qb2ludHMocG9pbnRzLCBwb3NpdGlvbiwgcXVhdGVybmlvbiwgc2tpblNpemUpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgcSA9IHF1YXRlcm5pb247IC8vIFNldCB0byB0aGUgZmlyc3QgcG9pbnQKCiAgICAgIGwuY29weShwb2ludHNbMF0pOwoKICAgICAgaWYgKHEpIHsKICAgICAgICBxLnZtdWx0KGwsIGwpOwogICAgICB9CgogICAgICB1LmNvcHkobCk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBwID0gcG9pbnRzW2ldOwoKICAgICAgICBpZiAocSkgewogICAgICAgICAgcS52bXVsdChwLCB0bXAkMSk7CiAgICAgICAgICBwID0gdG1wJDE7CiAgICAgICAgfQoKICAgICAgICBpZiAocC54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSBwLng7CiAgICAgICAgfQoKICAgICAgICBpZiAocC54IDwgbC54KSB7CiAgICAgICAgICBsLnggPSBwLng7CiAgICAgICAgfQoKICAgICAgICBpZiAocC55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSBwLnk7CiAgICAgICAgfQoKICAgICAgICBpZiAocC55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSBwLnk7CiAgICAgICAgfQoKICAgICAgICBpZiAocC56ID4gdS56KSB7CiAgICAgICAgICB1LnogPSBwLno7CiAgICAgICAgfQoKICAgICAgICBpZiAocC56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSBwLno7CiAgICAgICAgfQogICAgICB9IC8vIEFkZCBvZmZzZXQKCgogICAgICBpZiAocG9zaXRpb24pIHsKICAgICAgICBwb3NpdGlvbi52YWRkKGwsIGwpOwogICAgICAgIHBvc2l0aW9uLnZhZGQodSwgdSk7CiAgICAgIH0KCiAgICAgIGlmIChza2luU2l6ZSkgewogICAgICAgIGwueCAtPSBza2luU2l6ZTsKICAgICAgICBsLnkgLT0gc2tpblNpemU7CiAgICAgICAgbC56IC09IHNraW5TaXplOwogICAgICAgIHUueCArPSBza2luU2l6ZTsKICAgICAgICB1LnkgKz0gc2tpblNpemU7CiAgICAgICAgdS56ICs9IHNraW5TaXplOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29weSBib3VuZHMgZnJvbSBhbiBBQUJCIHRvIHRoaXMgQUFCQgogICAgICogQHBhcmFtIGFhYmIgU291cmNlIHRvIGNvcHkgZnJvbQogICAgICogQHJldHVybiBUaGUgdGhpcyBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkKICAgICAqLwoKCiAgICBjb3B5KGFhYmIpIHsKICAgICAgdGhpcy5sb3dlckJvdW5kLmNvcHkoYWFiYi5sb3dlckJvdW5kKTsKICAgICAgdGhpcy51cHBlckJvdW5kLmNvcHkoYWFiYi51cHBlckJvdW5kKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENsb25lIGFuIEFBQkIKICAgICAqLwoKCiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyBBQUJCKCkuY29weSh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogRXh0ZW5kIHRoaXMgQUFCQiBzbyB0aGF0IGl0IGNvdmVycyB0aGUgZ2l2ZW4gQUFCQiB0b28uCiAgICAgKi8KCgogICAgZXh0ZW5kKGFhYmIpIHsKICAgICAgdGhpcy5sb3dlckJvdW5kLnggPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueCwgYWFiYi5sb3dlckJvdW5kLngpOwogICAgICB0aGlzLnVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueCk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC55ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnksIGFhYmIubG93ZXJCb3VuZC55KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueSwgYWFiYi51cHBlckJvdW5kLnkpOwogICAgICB0aGlzLmxvd2VyQm91bmQueiA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC56LCBhYWJiLmxvd2VyQm91bmQueik7CiAgICAgIHRoaXMudXBwZXJCb3VuZC56ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLnosIGFhYmIudXBwZXJCb3VuZC56KTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBBQUJCIG92ZXJsYXBzIHRoaXMgQUFCQi4KICAgICAqLwoKCiAgICBvdmVybGFwcyhhYWJiKSB7CiAgICAgIGNvbnN0IGwxID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbDIgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUyID0gYWFiYi51cHBlckJvdW5kOyAvLyAgICAgIGwyICAgICAgICB1MgogICAgICAvLyAgICAgIHwtLS0tLS0tLS18CiAgICAgIC8vIHwtLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgdTEKCiAgICAgIGNvbnN0IG92ZXJsYXBzWCA9IGwyLnggPD0gdTEueCAmJiB1MS54IDw9IHUyLnggfHwgbDEueCA8PSB1Mi54ICYmIHUyLnggPD0gdTEueDsKICAgICAgY29uc3Qgb3ZlcmxhcHNZID0gbDIueSA8PSB1MS55ICYmIHUxLnkgPD0gdTIueSB8fCBsMS55IDw9IHUyLnkgJiYgdTIueSA8PSB1MS55OwogICAgICBjb25zdCBvdmVybGFwc1ogPSBsMi56IDw9IHUxLnogJiYgdTEueiA8PSB1Mi56IHx8IGwxLnogPD0gdTIueiAmJiB1Mi56IDw9IHUxLno7CiAgICAgIHJldHVybiBvdmVybGFwc1ggJiYgb3ZlcmxhcHNZICYmIG92ZXJsYXBzWjsKICAgIH0gLy8gTW9zdGx5IGZvciBkZWJ1Z2dpbmcKCgogICAgdm9sdW1lKCkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICByZXR1cm4gKHUueCAtIGwueCkgKiAodS55IC0gbC55KSAqICh1LnogLSBsLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgaXMgZnVsbHkgY29udGFpbmVkIGluIHRoaXMgQUFCQi4KICAgICAqLwoKCiAgICBjb250YWlucyhhYWJiKSB7CiAgICAgIGNvbnN0IGwxID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbDIgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUyID0gYWFiYi51cHBlckJvdW5kOyAvLyAgICAgIGwyICAgICAgICB1MgogICAgICAvLyAgICAgIHwtLS0tLS0tLS18CiAgICAgIC8vIHwtLS0tLS0tLS0tLS0tLS18CiAgICAgIC8vIGwxICAgICAgICAgICAgICB1MQoKICAgICAgcmV0dXJuIGwxLnggPD0gbDIueCAmJiB1MS54ID49IHUyLnggJiYgbDEueSA8PSBsMi55ICYmIHUxLnkgPj0gdTIueSAmJiBsMS56IDw9IGwyLnogJiYgdTEueiA+PSB1Mi56OwogICAgfQoKICAgIGdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBhLmNvcHkobCk7CiAgICAgIGIuc2V0KHUueCwgbC55LCBsLnopOwogICAgICBjLnNldCh1LngsIHUueSwgbC56KTsKICAgICAgZC5zZXQobC54LCB1LnksIHUueik7CiAgICAgIGUuc2V0KHUueCwgbC55LCB1LnopOwogICAgICBmLnNldChsLngsIHUueSwgbC56KTsKICAgICAgZy5zZXQobC54LCBsLnksIHUueik7CiAgICAgIGguY29weSh1KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSByZXByZXNlbnRhdGlvbiBvZiBhbiBBQUJCIGluIGFub3RoZXIgZnJhbWUuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiBBQUJCIG9iamVjdC4KICAgICAqLwoKCiAgICB0b0xvY2FsRnJhbWUoZnJhbWUsIHRhcmdldCkgewogICAgICBjb25zdCBjb3JuZXJzID0gdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnM7CiAgICAgIGNvbnN0IGEgPSBjb3JuZXJzWzBdOwogICAgICBjb25zdCBiID0gY29ybmVyc1sxXTsKICAgICAgY29uc3QgYyA9IGNvcm5lcnNbMl07CiAgICAgIGNvbnN0IGQgPSBjb3JuZXJzWzNdOwogICAgICBjb25zdCBlID0gY29ybmVyc1s0XTsKICAgICAgY29uc3QgZiA9IGNvcm5lcnNbNV07CiAgICAgIGNvbnN0IGcgPSBjb3JuZXJzWzZdOwogICAgICBjb25zdCBoID0gY29ybmVyc1s3XTsgLy8gR2V0IGNvcm5lcnMgaW4gY3VycmVudCBmcmFtZQoKICAgICAgdGhpcy5nZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpOyAvLyBUcmFuc2Zvcm0gdGhlbSB0byBuZXcgbG9jYWwgZnJhbWUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICBjb25zdCBjb3JuZXIgPSBjb3JuZXJzW2ldOwogICAgICAgIGZyYW1lLnBvaW50VG9Mb2NhbChjb3JuZXIsIGNvcm5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQuc2V0RnJvbVBvaW50cyhjb3JuZXJzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSByZXByZXNlbnRhdGlvbiBvZiBhbiBBQUJCIGluIHRoZSBnbG9iYWwgZnJhbWUuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiBBQUJCIG9iamVjdC4KICAgICAqLwoKCiAgICB0b1dvcmxkRnJhbWUoZnJhbWUsIHRhcmdldCkgewogICAgICBjb25zdCBjb3JuZXJzID0gdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnM7CiAgICAgIGNvbnN0IGEgPSBjb3JuZXJzWzBdOwogICAgICBjb25zdCBiID0gY29ybmVyc1sxXTsKICAgICAgY29uc3QgYyA9IGNvcm5lcnNbMl07CiAgICAgIGNvbnN0IGQgPSBjb3JuZXJzWzNdOwogICAgICBjb25zdCBlID0gY29ybmVyc1s0XTsKICAgICAgY29uc3QgZiA9IGNvcm5lcnNbNV07CiAgICAgIGNvbnN0IGcgPSBjb3JuZXJzWzZdOwogICAgICBjb25zdCBoID0gY29ybmVyc1s3XTsgLy8gR2V0IGNvcm5lcnMgaW4gY3VycmVudCBmcmFtZQoKICAgICAgdGhpcy5nZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpOyAvLyBUcmFuc2Zvcm0gdGhlbSB0byBuZXcgbG9jYWwgZnJhbWUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICBjb25zdCBjb3JuZXIgPSBjb3JuZXJzW2ldOwogICAgICAgIGZyYW1lLnBvaW50VG9Xb3JsZChjb3JuZXIsIGNvcm5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQuc2V0RnJvbVBvaW50cyhjb3JuZXJzKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIEFBQkIgaXMgaGl0IGJ5IGEgcmF5LgogICAgICovCgoKICAgIG92ZXJsYXBzUmF5KHJheSkgewogICAgICBjb25zdCB7CiAgICAgICAgZGlyZWN0aW9uLAogICAgICAgIGZyb20KICAgICAgfSA9IHJheTsgLy8gY29uc3QgdCA9IDAKICAgICAgLy8gcmF5LmRpcmVjdGlvbiBpcyB1bml0IGRpcmVjdGlvbiB2ZWN0b3Igb2YgcmF5CgogICAgICBjb25zdCBkaXJGcmFjWCA9IDEgLyBkaXJlY3Rpb24ueDsKICAgICAgY29uc3QgZGlyRnJhY1kgPSAxIC8gZGlyZWN0aW9uLnk7CiAgICAgIGNvbnN0IGRpckZyYWNaID0gMSAvIGRpcmVjdGlvbi56OyAvLyB0aGlzLmxvd2VyQm91bmQgaXMgdGhlIGNvcm5lciBvZiBBQUJCIHdpdGggbWluaW1hbCBjb29yZGluYXRlcyAtIGxlZnQgYm90dG9tLCBydCBpcyBtYXhpbWFsIGNvcm5lcgoKICAgICAgY29uc3QgdDEgPSAodGhpcy5sb3dlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQyID0gKHRoaXMudXBwZXJCb3VuZC54IC0gZnJvbS54KSAqIGRpckZyYWNYOwogICAgICBjb25zdCB0MyA9ICh0aGlzLmxvd2VyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDQgPSAodGhpcy51cHBlckJvdW5kLnkgLSBmcm9tLnkpICogZGlyRnJhY1k7CiAgICAgIGNvbnN0IHQ1ID0gKHRoaXMubG93ZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOwogICAgICBjb25zdCB0NiA9ICh0aGlzLnVwcGVyQm91bmQueiAtIGZyb20ueikgKiBkaXJGcmFjWjsgLy8gY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpKTsKICAgICAgLy8gY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpKTsKCiAgICAgIGNvbnN0IHRtaW4gPSBNYXRoLm1heChNYXRoLm1heChNYXRoLm1pbih0MSwgdDIpLCBNYXRoLm1pbih0MywgdDQpKSwgTWF0aC5taW4odDUsIHQ2KSk7CiAgICAgIGNvbnN0IHRtYXggPSBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1heCh0MSwgdDIpLCBNYXRoLm1heCh0MywgdDQpKSwgTWF0aC5tYXgodDUsIHQ2KSk7IC8vIGlmIHRtYXggPCAwLCByYXkgKGxpbmUpIGlzIGludGVyc2VjdGluZyBBQUJCLCBidXQgd2hvbGUgQUFCQiBpcyBiZWhpbmcgdXMKCiAgICAgIGlmICh0bWF4IDwgMCkgewogICAgICAgIC8vdCA9IHRtYXg7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIGlmIHRtaW4gPiB0bWF4LCByYXkgZG9lc24ndCBpbnRlcnNlY3QgQUFCQgoKCiAgICAgIGlmICh0bWluID4gdG1heCkgewogICAgICAgIC8vdCA9IHRtYXg7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgfQoKICBjb25zdCB0bXAkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdHJhbnNmb3JtSW50b0ZyYW1lX2Nvcm5lcnMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgLyoqCiAgICogQ29sbGlzaW9uICJtYXRyaXgiLgogICAqIEl0J3MgYWN0dWFsbHkgYSB0cmlhbmd1bGFyLXNoYXBlZCBhcnJheSBvZiB3aGV0aGVyIHR3byBib2RpZXMgYXJlIHRvdWNoaW5nIHRoaXMgc3RlcCwgZm9yIHJlZmVyZW5jZSBuZXh0IHN0ZXAKICAgKi8KCiAgY2xhc3MgQXJyYXlDb2xsaXNpb25NYXRyaXggewogICAgLyoqCiAgICAgKiBUaGUgbWF0cml4IHN0b3JhZ2UuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm1hdHJpeCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBvYmplY3RzIHRoYXQgZGlzcGF0Y2hlcyBldmVudHMuCiAgICovCgoKICBjbGFzcyBFdmVudFRhcmdldCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5fbGlzdGVuZXJzID0gdm9pZCAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXZlbnQgbGlzdGVuZXIKICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXSA9IFtdOwogICAgICB9CgogICAgICBpZiAoIWxpc3RlbmVyc1t0eXBlXS5pbmNsdWRlcyhsaXN0ZW5lcikpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0ucHVzaChsaXN0ZW5lcik7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBldmVudCBsaXN0ZW5lciBpcyBhZGRlZAogICAgICovCgoKICAgIGhhc0V2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQgJiYgbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFueSBldmVudCBsaXN0ZW5lciBvZiB0aGUgZ2l2ZW4gdHlwZSBpcyBhZGRlZAogICAgICovCgoKICAgIGhhc0FueUV2ZW50TGlzdGVuZXIodHlwZSkgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgcmV0dXJuIGxpc3RlbmVyc1t0eXBlXSAhPT0gdW5kZWZpbmVkOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXZlbnQgbGlzdGVuZXIKICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBpbmRleCA9IGxpc3RlbmVyc1t0eXBlXS5pbmRleE9mKGxpc3RlbmVyKTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEVtaXQgYW4gZXZlbnQuCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIGNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbZXZlbnQudHlwZV07CgogICAgICBpZiAobGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZXZlbnQudGFyZ2V0ID0gdGhpczsKCiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBsaXN0ZW5lckFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgbGlzdGVuZXJBcnJheVtpXS5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgoKICBjbGFzcyBRdWF0ZXJuaW9uIHsKICAgIGNvbnN0cnVjdG9yKHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxKSB7CiAgICAgIHRoaXMueCA9IHZvaWQgMDsKICAgICAgdGhpcy55ID0gdm9pZCAwOwogICAgICB0aGlzLnogPSB2b2lkIDA7CiAgICAgIHRoaXMudyA9IHZvaWQgMDsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB2YWx1ZSBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeiwgdykgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICB0aGlzLncgPSB3OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhIHJlYWRhYmxlIGZvcm1hdAogICAgICogQHJldHVybiAieCx5LHosdyIKICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuIHRoaXMueCArICIsIiArIHRoaXMueSArICIsIiArIHRoaXMueiArICIsIiArIHRoaXMudzsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5ub3JtYWxpemUoKTsgLy8gaWYgdz4xIGFjb3MgYW5kIHNxcnQgd2lsbCBwcm9kdWNlIGVycm9ycywgdGhpcyBjYW50IGhhcHBlbiBpZiBxdWF0ZXJuaW9uIGlzIG5vcm1hbGlzZWQKCiAgICAgIGNvbnN0IGFuZ2xlID0gMiAqIE1hdGguYWNvcyh0aGlzLncpOwogICAgICBjb25zdCBzID0gTWF0aC5zcXJ0KDEgLSB0aGlzLncgKiB0aGlzLncpOyAvLyBhc3N1bWluZyBxdWF0ZXJuaW9uIG5vcm1hbGlzZWQgdGhlbiB3IGlzIGxlc3MgdGhhbiAxLCBzbyB0ZXJtIGFsd2F5cyBwb3NpdGl2ZS4KCiAgICAgIGlmIChzIDwgMC4wMDEpIHsKICAgICAgICAvLyB0ZXN0IHRvIGF2b2lkIGRpdmlkZSBieSB6ZXJvLCBzIGlzIGFsd2F5cyBwb3NpdGl2ZSBkdWUgdG8gc3FydAogICAgICAgIC8vIGlmIHMgY2xvc2UgdG8gemVybyB0aGVuIGRpcmVjdGlvbiBvZiBheGlzIG5vdCBpbXBvcnRhbnQKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLng7IC8vIGlmIGl0IGlzIGltcG9ydGFudCB0aGF0IGF4aXMgaXMgbm9ybWFsaXNlZCB0aGVuIHJlcGxhY2Ugd2l0aCB4PTE7IHk9ej0wOwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnk7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldEF4aXMueCA9IHRoaXMueCAvIHM7IC8vIG5vcm1hbGlzZSBheGlzCgogICAgICAgIHRhcmdldEF4aXMueSA9IHRoaXMueSAvIHM7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56IC8gczsKICAgICAgfQoKICAgICAgcmV0dXJuIFt0YXJnZXRBeGlzLCBhbmdsZV07CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiB2YWx1ZSBnaXZlbiB0d28gdmVjdG9ycy4gVGhlIHJlc3VsdGluZyByb3RhdGlvbiB3aWxsIGJlIHRoZSBuZWVkZWQgcm90YXRpb24gdG8gcm90YXRlIHUgdG8gdi4KICAgICAqLwoKCiAgICBzZXRGcm9tVmVjdG9ycyh1LCB2KSB7CiAgICAgIGlmICh1LmlzQW50aXBhcmFsbGVsVG8odikpIHsKICAgICAgICBjb25zdCB0MSA9IHNmdl90MTsKICAgICAgICBjb25zdCB0MiA9IHNmdl90MjsKICAgICAgICB1LnRhbmdlbnRzKHQxLCB0Mik7CiAgICAgICAgdGhpcy5zZXRGcm9tQXhpc0FuZ2xlKHQxLCBNYXRoLlBJKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhID0gdS5jcm9zcyh2KTsKICAgICAgICB0aGlzLnggPSBhLng7CiAgICAgICAgdGhpcy55ID0gYS55OwogICAgICAgIHRoaXMueiA9IGEuejsKICAgICAgICB0aGlzLncgPSBNYXRoLnNxcnQodS5sZW5ndGgoKSAqKiAyICogdi5sZW5ndGgoKSAqKiAyKSArIHUuZG90KHYpOwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiB3aXRoIGFuIG90aGVyIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbXVsdChxdWF0LCB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpKSB7CiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCkpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKICAgICAgdGhpcy5jb25qdWdhdGUodGFyZ2V0KTsKICAgICAgY29uc3QgaW5vcm0yID0gMSAvICh4ICogeCArIHkgKiB5ICsgeiAqIHogKyB3ICogdyk7CiAgICAgIHRhcmdldC54ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LnkgKj0gaW5vcm0yOwogICAgICB0YXJnZXQueiAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC53ICo9IGlub3JtMjsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBxdWF0ZXJuaW9uIGNvbmp1Z2F0ZQogICAgICovCgoKICAgIGNvbmp1Z2F0ZSh0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpKSB7CiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHRhcmdldC53ID0gdGhpcy53OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHF1YXRlcm5pb24uIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGxldCBsID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CgogICAgICBpZiAobCA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbCA9IDEgLyBsOwogICAgICAgIHRoaXMueCAqPSBsOwogICAgICAgIHRoaXMueSAqPSBsOwogICAgICAgIHRoaXMueiAqPSBsOwogICAgICAgIHRoaXMudyAqPSBsOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQXBwcm94aW1hdGlvbiBvZiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIFdvcmtzIGJlc3Qgd2hlbiBxdWF0IGlzIGFscmVhZHkgYWxtb3N0LW5vcm1hbGl6ZWQuCiAgICAgKiBAYXV0aG9yIHVucGhhc2VkLCBodHRwczovL2dpdGh1Yi5jb20vdW5waGFzZWQKICAgICAqLwoKCiAgICBub3JtYWxpemVGYXN0KCkgewogICAgICBjb25zdCBmID0gKDMuMCAtICh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpKSAvIDIuMDsKCiAgICAgIGlmIChmID09PSAwKSB7CiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgdGhpcy53ID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnggKj0gZjsKICAgICAgICB0aGlzLnkgKj0gZjsKICAgICAgICB0aGlzLnogKj0gZjsKICAgICAgICB0aGlzLncgKj0gZjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHRoZSBxdWF0ZXJuaW9uIGJ5IGEgdmVjdG9yCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIgPSAnWVpYJykgewogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFdWxlciBvcmRlciAiICsgb3JkZXIgKyAiIG5vdCBzdXBwb3J0ZWQgeWV0LiIpOwogICAgICB9CgogICAgICB0YXJnZXQueSA9IGhlYWRpbmc7CiAgICAgIHRhcmdldC56ID0gYXR0aXR1ZGU7CiAgICAgIHRhcmdldC54ID0gYmFuazsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG9yZGVyIFRoZSBvcmRlciB0byBhcHBseSBhbmdsZXM6ICdYWVonIG9yICdZWFonIG9yIGFueSBvdGhlciBjb21iaW5hdGlvbi4KICAgICAqCiAgICAgKiBTZWUge0BsaW5rIGh0dHBzOi8vd3d3Lm1hdGh3b3Jrcy5jb20vbWF0bGFiY2VudHJhbC9maWxlZXhjaGFuZ2UvMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMgTWF0aFdvcmtzfSByZWZlcmVuY2UKICAgICAqLwoKCiAgICBzZXRGcm9tRXVsZXIoeCwgeSwgeiwgb3JkZXIgPSAnWFlaJykgewogICAgICBjb25zdCBjMSA9IE1hdGguY29zKHggLyAyKTsKICAgICAgY29uc3QgYzIgPSBNYXRoLmNvcyh5IC8gMik7CiAgICAgIGNvbnN0IGMzID0gTWF0aC5jb3MoeiAvIDIpOwogICAgICBjb25zdCBzMSA9IE1hdGguc2luKHggLyAyKTsKICAgICAgY29uc3QgczIgPSBNYXRoLnNpbih5IC8gMik7CiAgICAgIGNvbnN0IHMzID0gTWF0aC5zaW4oeiAvIDIpOwoKICAgICAgaWYgKG9yZGVyID09PSAnWFlaJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1lYWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdaWFknKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWllYJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1laWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdYWlknKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBjbG9uZSgpIHsKICAgICAgcmV0dXJuIG5ldyBRdWF0ZXJuaW9uKHRoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMudyk7CiAgICB9CiAgICAvKioKICAgICAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHF1YXQKICAgICAqCiAgICAgKiBAcGFyYW0gdG9RdWF0IHNlY29uZCBvcGVyYW5kCiAgICAgKiBAcGFyYW0gdCBpbnRlcnBvbGF0aW9uIGFtb3VudCBiZXR3ZWVuIHRoZSBzZWxmIHF1YXRlcm5pb24gYW5kIHRvUXVhdAogICAgICogQHBhcmFtIHRhcmdldCBBIHF1YXRlcm5pb24gdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4gSWYgbm90IHByb3ZpZGVkLCBhIG5ldyBvbmUgd2lsbCBiZSBjcmVhdGVkLgogICAgICogQHJldHVybnMge1F1YXRlcm5pb259IFRoZSAidGFyZ2V0IiBvYmplY3QKICAgICAqLwoKCiAgICBzbGVycCh0b1F1YXQsIHQsIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCkpIHsKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKSkgewogICAgICBjb25zdCBheCA9IGFuZ3VsYXJWZWxvY2l0eS54ICogYW5ndWxhckZhY3Rvci54LAogICAgICAgICAgICBheSA9IGFuZ3VsYXJWZWxvY2l0eS55ICogYW5ndWxhckZhY3Rvci55LAogICAgICAgICAgICBheiA9IGFuZ3VsYXJWZWxvY2l0eS56ICogYW5ndWxhckZhY3Rvci56LAogICAgICAgICAgICBieCA9IHRoaXMueCwKICAgICAgICAgICAgYnkgPSB0aGlzLnksCiAgICAgICAgICAgIGJ6ID0gdGhpcy56LAogICAgICAgICAgICBidyA9IHRoaXMudzsKICAgICAgY29uc3QgaGFsZl9kdCA9IGR0ICogMC41OwogICAgICB0YXJnZXQueCArPSBoYWxmX2R0ICogKGF4ICogYncgKyBheSAqIGJ6IC0gYXogKiBieSk7CiAgICAgIHRhcmdldC55ICs9IGhhbGZfZHQgKiAoYXkgKiBidyArIGF6ICogYnggLSBheCAqIGJ6KTsKICAgICAgdGFyZ2V0LnogKz0gaGFsZl9kdCAqIChheiAqIGJ3ICsgYXggKiBieSAtIGF5ICogYngpOwogICAgICB0YXJnZXQudyArPSBoYWxmX2R0ICogKC1heCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYnopOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICB9CgogIGNvbnN0IHNmdl90MSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc2Z2X3QyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBUaGUgYXZhaWxhYmxlIHNoYXBlIHR5cGVzLgogICAqLwoKICBjb25zdCBTSEFQRV9UWVBFUyA9IHsKICAgIC8qKiBTUEhFUkUgKi8KICAgIFNQSEVSRTogMSwKCiAgICAvKiogUExBTkUgKi8KICAgIFBMQU5FOiAyLAoKICAgIC8qKiBCT1ggKi8KICAgIEJPWDogNCwKCiAgICAvKiogQ09NUE9VTkQgKi8KICAgIENPTVBPVU5EOiA4LAoKICAgIC8qKiBDT05WRVhQT0xZSEVEUk9OICovCiAgICBDT05WRVhQT0xZSEVEUk9OOiAxNiwKCiAgICAvKiogSEVJR0hURklFTEQgKi8KICAgIEhFSUdIVEZJRUxEOiAzMiwKCiAgICAvKiogUEFSVElDTEUgKi8KICAgIFBBUlRJQ0xFOiA2NCwKCiAgICAvKiogQ1lMSU5ERVIgKi8KICAgIENZTElOREVSOiAxMjgsCgogICAgLyoqIFRSSU1FU0ggKi8KICAgIFRSSU1FU0g6IDI1NgogIH07CiAgLyoqCiAgICogU2hhcGVUeXBlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIHNoYXBlcwogICAqLwoKICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLnR5cGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5ID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gU2hhcGUuaWRDb3VudGVyKys7CiAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZSB8fCAwOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAxOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLm1hdGVyaWFsID0gb3B0aW9ucy5tYXRlcmlhbCA/IG9wdGlvbnMubWF0ZXJpYWwgOiBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIHJhZGl1cy4KICAgICAqIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoZSBwcm9wZXJ0eSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYAogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aHJvdyAiY29tcHV0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdm9sdW1lIG9mIHRoaXMgc2hhcGUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHRocm93ICJ2b2x1bWUoKSBub3QgaW1wbGVtZW50ZWQgZm9yIHNoYXBlIHR5cGUgIiArIHRoaXMudHlwZTsKICAgIH0KICAgIC8qKgogICAgICogQ2FsY3VsYXRlcyB0aGUgaW5lcnRpYSBpbiB0aGUgbG9jYWwgZnJhbWUgZm9yIHRoaXMgc2hhcGUuCiAgICAgKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGlzdF9vZl9tb21lbnRzX29mX2luZXJ0aWEKICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIHRocm93ICJjYWxjdWxhdGVMb2NhbEluZXJ0aWEoKSBub3QgaW1wbGVtZW50ZWQgZm9yIHNoYXBlIHR5cGUgIiArIHRoaXMudHlwZTsKICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gdXNlIGFic3RyYWN0IGZvciB0aGVzZSBraW5kIG9mIG1ldGhvZHMKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICB0aHJvdyAiY2FsY3VsYXRlV29ybGRBQUJCKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CgogIH0KCiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwogIC8qKgogICAqIFRyYW5zZm9ybWF0aW9uIHV0aWxpdGllcy4KICAgKi8KCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgdGhpcy5wb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSBnbG9iYWwgcG9pbnQgaW4gbG9jYWwgdHJhbnNmb3JtIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgcmV0dXJuIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHdvcmxkUG9pbnQsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGxvY2FsIHBvaW50IGluIGdsb2JhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogdmVjdG9yVG9Xb3JsZEZyYW1lCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogcG9pbnRUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXRlcm5pb24sIHdvcmxkUG9pbnQsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0ID0gbmV3IFZlYzMoKSkgewogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsUG9pbnQsIHJlc3VsdCk7CiAgICAgIHJlc3VsdC52YWRkKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Xb3JsZEZyYW1lKHF1YXRlcm5pb24sIGxvY2FsVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvTG9jYWxGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXRlcm5pb24sIHdvcmxkVmVjdG9yLCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNvbnN0IHRtcFF1YXQkMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwoKICBjbGFzcyBDb252ZXhQb2x5aGVkcm9uIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHZlcnRpY2VzICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIGZhY2UgY29uc2lzdHMgb2YKICAgICAqLwoKICAgIC8qKiBmYWNlTm9ybWFscyAqLwoKICAgIC8qKiB3b3JsZFZlcnRpY2VzICovCgogICAgLyoqIHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKiB3b3JsZEZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKgogICAgICogSWYgZ2l2ZW4sIHRoZXNlIGxvY2FsbHkgZGVmaW5lZCwgbm9ybWFsaXplZCBheGVzIGFyZSB0aGUgb25seSBvbmVzIGJlaW5nIGNoZWNrZWQgd2hlbiBkb2luZyBzZXBhcmF0aW5nIGF4aXMgY2hlY2suCiAgICAgKi8KCiAgICAvKiogdW5pcXVlRWRnZXMgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSB2ZXJ0aWNlcyBBbiBhcnJheSBvZiBWZWMzJ3MKICAgICAqIEBwYXJhbSBmYWNlcyBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgZGVzY3JpYmluZyB3aGljaCB2ZXJ0aWNlcyB0aGF0IGlzIGluY2x1ZGVkIGluIGVhY2ggZmFjZS4KICAgICAqLwogICAgY29uc3RydWN0b3IocHJvcHMgPSB7fSkgewogICAgICBjb25zdCB7CiAgICAgICAgdmVydGljZXMgPSBbXSwKICAgICAgICBmYWNlcyA9IFtdLAogICAgICAgIG5vcm1hbHMgPSBbXSwKICAgICAgICBheGVzLAogICAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgIH0gPSBwcm9wczsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04KICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRWZXJ0aWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMudW5pcXVlQXhlcyA9IHZvaWQgMDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IHZvaWQgMDsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlZlcnRleCAiICsgdGhpcy5mYWNlc1tpXVtqXSArICIgbm90IGZvdW5kISIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29uc3QgbiA9IHRoaXMuZmFjZU5vcm1hbHNbaV0gfHwgbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmdldEZhY2VOb3JtYWwoaSwgbik7CiAgICAgICAgbi5uZWdhdGUobik7CiAgICAgICAgdGhpcy5mYWNlTm9ybWFsc1tpXSA9IG47CiAgICAgICAgY29uc3QgdmVydGV4ID0gdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldWzBdXTsKCiAgICAgICAgaWYgKG4uZG90KHZlcnRleCkgPCAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCIuZmFjZU5vcm1hbHNbIiArIGkgKyAiXSA9IFZlYzMoIiArIG4udG9TdHJpbmcoKSArICIpIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuIik7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiLnZlcnRpY2VzWyIgKyB0aGlzLmZhY2VzW2ldW2pdICsgIl0gPSBWZWMzKCIgKyB0aGlzLnZlcnRpY2VzW3RoaXMuZmFjZXNbaV1bal1dLnRvU3RyaW5nKCkgKyAiKSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWwgb2YgYSBmYWNlIGZyb20gaXRzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgZ2V0RmFjZU5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgZiA9IHRoaXMuZmFjZXNbaV07CiAgICAgIGNvbnN0IHZhID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgdmIgPSB0aGlzLnZlcnRpY2VzW2ZbMV1dOwogICAgICBjb25zdCB2YyA9IHRoaXMudmVydGljZXNbZlsyXV07CiAgICAgIENvbnZleFBvbHloZWRyb24uY29tcHV0ZU5vcm1hbCh2YSwgdmIsIHZjLCB0YXJnZXQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICAgICAgdmIudnN1Yih2YSwgYWIpOwogICAgICB2Yy52c3ViKHZiLCBjYik7CiAgICAgIGNiLmNyb3NzKGFiLCB0YXJnZXQpOwoKICAgICAgaWYgKCF0YXJnZXQuaXNaZXJvKCkpIHsKICAgICAgICB0YXJnZXQubm9ybWFsaXplKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG1pbkRpc3QgQ2xhbXAgZGlzdGFuY2UKICAgICAqIEBwYXJhbSByZXN1bHQgVGhlIGFuIGFycmF5IG9mIGNvbnRhY3QgcG9pbnQgb2JqZWN0cywgc2VlIGNsaXBGYWNlQWdhaW5zdEh1bGwKICAgICAqLwoKCiAgICBjbGlwQWdhaW5zdEh1bGwocG9zQSwgcXVhdEEsIGh1bGxCLCBwb3NCLCBxdWF0Qiwgc2VwYXJhdGluZ05vcm1hbCwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IFdvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQiA9IC0xOwogICAgICBsZXQgZG1heCA9IC1OdW1iZXIuTUFYX1ZBTFVFOwoKICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBodWxsQi5mYWNlcy5sZW5ndGg7IGZhY2UrKykgewogICAgICAgIFdvcmxkTm9ybWFsLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkTm9ybWFsLCBXb3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3QgZCA9IFdvcmxkTm9ybWFsLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPiBkbWF4KSB7CiAgICAgICAgICBkbWF4ID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQiA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB3b3JsZFZlcnRzQjEgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaHVsbEIuZmFjZXNbY2xvc2VzdEZhY2VCXS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBodWxsQi52ZXJ0aWNlc1todWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdW2ldXTsKICAgICAgICBjb25zdCB3b3JsZGIgPSBuZXcgVmVjMygpOwogICAgICAgIHdvcmxkYi5jb3B5KGIpOwogICAgICAgIHF1YXRCLnZtdWx0KHdvcmxkYiwgd29ybGRiKTsKICAgICAgICBwb3NCLnZhZGQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHdvcmxkVmVydHNCMS5wdXNoKHdvcmxkYik7CiAgICAgIH0KCiAgICAgIGlmIChjbG9zZXN0RmFjZUIgPj0gMCkgewogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgdGhlIHNlcGFyYXRpbmcgYXhpcyBiZXR3ZWVuIHRoaXMgaHVsbCBhbmQgYW5vdGhlcgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHZlY3RvciB0byBzYXZlIHRoZSBheGlzIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgZmFsc2UgaWYgYSBzZXBhcmF0aW9uIGlzIGZvdW5kLCBlbHNlIHRydWUKICAgICAqLwoKCiAgICBmaW5kU2VwYXJhdGluZ0F4aXMoaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QiwgdGFyZ2V0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBmYWNlQU5vcm1hbFdTMyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRlbHRhQyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZEVkZ2UxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgQ3Jvc3MgPSBuZXcgVmVjMygpOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKCiAgICAgIGlmICghaHVsbEEudW5pcXVlQXhlcykgewogICAgICAgIGNvbnN0IG51bUZhY2VzQSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QS5sZW5ndGggOiBodWxsQS5mYWNlcy5sZW5ndGg7IC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEEKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0E7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEEgPyBmYWNlTGlzdEFbaV0gOiBpOyAvLyBHZXQgd29ybGQgZmFjZSBub3JtYWwKCiAgICAgICAgICBmYWNlQU5vcm1hbFdTMy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZpXSk7CiAgICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTMywgZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKGZhY2VBTm9ybWFsV1MzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICBpZiAoZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgICAgdGFyZ2V0LmNvcHkoZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGh1bGxBLnVuaXF1ZUF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBheGlzCiAgICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVBeGVzW2ldLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWh1bGxCLnVuaXF1ZUF4ZXMpIHsKICAgICAgICAvLyBUZXN0IGZhY2Ugbm9ybWFscyBmcm9tIGh1bGxCCiAgICAgICAgY29uc3QgbnVtRmFjZXNCID0gZmFjZUxpc3RCID8gZmFjZUxpc3RCLmxlbmd0aCA6IGh1bGxCLmZhY2VzLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0I7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEJbaV0gOiBpOwogICAgICAgICAgV29ybGRub3JtYWwxLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkbm9ybWFsMSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzIGluIEIKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEIudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlQXhlc1tpXSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUZXN0IGVkZ2VzCgoKICAgICAgZm9yIChsZXQgZTAgPSAwOyBlMCAhPT0gaHVsbEEudW5pcXVlRWRnZXMubGVuZ3RoOyBlMCsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UKICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVFZGdlc1tlMF0sIHdvcmxkRWRnZTApOwoKICAgICAgICBmb3IgKGxldCBlMSA9IDA7IGUxICE9PSBodWxsQi51bmlxdWVFZGdlcy5sZW5ndGg7IGUxKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBlZGdlIDIKICAgICAgICAgIHF1YXRCLnZtdWx0KGh1bGxCLnVuaXF1ZUVkZ2VzW2UxXSwgd29ybGRFZGdlMSk7CiAgICAgICAgICB3b3JsZEVkZ2UwLmNyb3NzKHdvcmxkRWRnZTEsIENyb3NzKTsKCiAgICAgICAgICBpZiAoIUNyb3NzLmFsbW9zdFplcm8oKSkgewogICAgICAgICAgICBDcm9zcy5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IGh1bGxBLnRlc3RTZXBBeGlzKENyb3NzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICAgIGlmIChkaXN0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRpc3QgPCBkbWluKSB7CiAgICAgICAgICAgICAgZG1pbiA9IGRpc3Q7CiAgICAgICAgICAgICAgdGFyZ2V0LmNvcHkoQ3Jvc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBwb3NCLnZzdWIocG9zQSwgZGVsdGFDKTsKCiAgICAgIGlmIChkZWx0YUMuZG90KHRhcmdldCkgPiAwLjApIHsKICAgICAgICB0YXJnZXQubmVnYXRlKHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBUZXN0IHNlcGFyYXRpbmcgYXhpcyBhZ2FpbnN0IHR3byBodWxscy4gQm90aCBodWxscyBhcmUgcHJvamVjdGVkIG9udG8gdGhlIGF4aXMgYW5kIHRoZSBvdmVybGFwIHNpemUgaXMgcmV0dXJuZWQgaWYgdGhlcmUgaXMgb25lLgogICAgICogQHJldHVybiBUaGUgb3ZlcmxhcCBkZXB0aCwgb3IgRkFMU0UgaWYgbm8gcGVuZXRyYXRpb24uCiAgICAgKi8KCgogICAgdGVzdFNlcEF4aXMoYXhpcywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QikgewogICAgICBjb25zdCBodWxsQSA9IHRoaXM7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQSwgYXhpcywgcG9zQSwgcXVhdEEsIG1heG1pbkEpOwogICAgICBDb252ZXhQb2x5aGVkcm9uLnByb2plY3QoaHVsbEIsIGF4aXMsIHBvc0IsIHF1YXRCLCBtYXhtaW5CKTsKICAgICAgY29uc3QgbWF4QSA9IG1heG1pbkFbMF07CiAgICAgIGNvbnN0IG1pbkEgPSBtYXhtaW5BWzFdOwogICAgICBjb25zdCBtYXhCID0gbWF4bWluQlswXTsKICAgICAgY29uc3QgbWluQiA9IG1heG1pbkJbMV07CgogICAgICBpZiAobWF4QSA8IG1pbkIgfHwgbWF4QiA8IG1pbkEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFNlcGFyYXRlZAogICAgICB9CgogICAgICBjb25zdCBkMCA9IG1heEEgLSBtaW5COwogICAgICBjb25zdCBkMSA9IG1heEIgLSBtaW5BOwogICAgICBjb25zdCBkZXB0aCA9IGQwIDwgZDEgPyBkMCA6IGQxOwogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgY29uc3QgYWFiYm1heCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFhYmJtaW4gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoYWFiYm1pbiwgYWFiYm1heCk7CiAgICAgIGNvbnN0IHggPSBhYWJibWF4LnggLSBhYWJibWluLng7CiAgICAgIGNvbnN0IHkgPSBhYWJibWF4LnkgLSBhYWJibWluLnk7CiAgICAgIGNvbnN0IHogPSBhYWJibWF4LnogLSBhYWJibWluLno7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueSA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHggKiAyICogeCk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBmYWNlX2kgSW5kZXggb2YgdGhlIGZhY2UKICAgICAqLwoKCiAgICBnZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGZhY2VfaSkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tmYWNlX2ldOwogICAgICBjb25zdCBuID0gdGhpcy5mYWNlTm9ybWFsc1tmYWNlX2ldOwogICAgICBjb25zdCB2ID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgYyA9IC1uLmRvdCh2KTsKICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAvKioKICAgICAqIENsaXAgYSBmYWNlIGFnYWluc3QgYSBodWxsLgogICAgICogQHBhcmFtIHdvcmxkVmVydHNCMSBBbiBhcnJheSBvZiBWZWMzIHdpdGggdmVydGljZXMgaW4gdGhlIHdvcmxkIGZyYW1lLgogICAgICogQHBhcmFtIG1pbkRpc3QgRGlzdGFuY2UgY2xhbXBpbmcKICAgICAqIEBwYXJhbSBBcnJheSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGNvbnRhY3QgcG9pbnRzIGluLiBXaWxsIGJlIG9iamVjdHMgd2l0aCBwcm9wZXJ0aWVzOiBwb2ludCwgZGVwdGgsIG5vcm1hbC4gVGhlc2UgYXJlIHJlcHJlc2VudGVkIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIGNsaXBGYWNlQWdhaW5zdEh1bGwoc2VwYXJhdGluZ05vcm1hbCwgcG9zQSwgcXVhdEEsIHdvcmxkVmVydHNCMSwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBlZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZFBsYW5lQW5vcm1hbDEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkQTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBsb2NhbFBsYW5lTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGxhbmVOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgY29uc3Qgd29ybGRWZXJ0c0IyID0gW107CiAgICAgIGNvbnN0IHBWdHhJbiA9IHdvcmxkVmVydHNCMTsKICAgICAgY29uc3QgcFZ0eE91dCA9IHdvcmxkVmVydHNCMjsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQSA9IC0xOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7IC8vIEZpbmQgdGhlIGZhY2Ugd2l0aCBub3JtYWwgY2xvc2VzdCB0byB0aGUgc2VwYXJhdGluZyBheGlzCgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgZmFjZUFOb3JtYWxXUy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZhY2VdKTsKICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTLCBmYWNlQU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBkID0gZmFjZUFOb3JtYWxXUy5kb3Qoc2VwYXJhdGluZ05vcm1hbCk7CgogICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICBjbG9zZXN0RmFjZUEgPSBmYWNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQSA8IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gR2V0IHRoZSBmYWNlIGFuZCBjb25zdHJ1Y3QgY29ubmVjdGVkIGZhY2VzCgoKICAgICAgY29uc3QgcG9seUEgPSBodWxsQS5mYWNlc1tjbG9zZXN0RmFjZUFdOwogICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcyA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQS5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaHVsbEEuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICgKICAgICAgICAgIC8qIFNoYXJpbmcgYSB2ZXJ0ZXgqLwogICAgICAgICAgcG9seUEuaW5kZXhPZihodWxsQS5mYWNlc1tpXVtqXSkgIT09IC0xICYmCiAgICAgICAgICAvKiBOb3QgdGhlIG9uZSB3ZSBhcmUgbG9va2luZyBmb3IgY29ubmVjdGlvbnMgZnJvbSAqLwogICAgICAgICAgaSAhPT0gY2xvc2VzdEZhY2VBICYmCiAgICAgICAgICAvKiBOb3QgYWxyZWFkeSBhZGRlZCAqLwogICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMuaW5kZXhPZihpKSA9PT0gLTEpIHsKICAgICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2xpcCB0aGUgcG9seWdvbiB0byB0aGUgYmFjayBvZiB0aGUgcGxhbmVzIG9mIGFsbCBmYWNlcyBvZiBodWxsIEEsCiAgICAgIC8vIHRoYXQgYXJlIGFkamFjZW50IHRvIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBjb25zdCBudW1WZXJ0aWNlc0EgPSBwb2x5QS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZlcnRpY2VzQTsgaSsrKSB7CiAgICAgICAgY29uc3QgYSA9IGh1bGxBLnZlcnRpY2VzW3BvbHlBW2ldXTsKICAgICAgICBjb25zdCBiID0gaHVsbEEudmVydGljZXNbcG9seUFbKGkgKyAxKSAlIG51bVZlcnRpY2VzQV1dOwogICAgICAgIGEudnN1YihiLCBlZGdlMCk7CiAgICAgICAgV29ybGRFZGdlMC5jb3B5KGVkZ2UwKTsKICAgICAgICBxdWF0QS52bXVsdChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICBwb3NBLnZhZGQoV29ybGRFZGdlMCwgV29ybGRFZGdlMCk7CiAgICAgICAgd29ybGRQbGFuZUFub3JtYWwxLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgICBxdWF0QS52bXVsdCh3b3JsZFBsYW5lQW5vcm1hbDEsIHdvcmxkUGxhbmVBbm9ybWFsMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBXb3JsZEVkZ2UwLmNyb3NzKHdvcmxkUGxhbmVBbm9ybWFsMSwgcGxhbmVOb3JtYWxXUzEpOwogICAgICAgIHBsYW5lTm9ybWFsV1MxLm5lZ2F0ZShwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgd29ybGRBMS5jb3B5KGEpOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIHBvc0EudmFkZCh3b3JsZEExLCB3b3JsZEExKTsKICAgICAgICBjb25zdCBvdGhlckZhY2UgPSBwb2x5QS5jb25uZWN0ZWRGYWNlc1tpXTsKICAgICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tvdGhlckZhY2VdKTsKICAgICAgICBjb25zdCBsb2NhbFBsYW5lRXEgPSB0aGlzLmdldFBsYW5lQ29uc3RhbnRPZkZhY2Uob3RoZXJGYWNlKTsKICAgICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgICAgY29uc3QgcGxhbmVFcVdTID0gbG9jYWxQbGFuZUVxIC0gcGxhbmVOb3JtYWxXUy5kb3QocG9zQSk7IC8vIENsaXAgZmFjZSBhZ2FpbnN0IG91ciBjb25zdHJ1Y3RlZCBwbGFuZQoKICAgICAgICB0aGlzLmNsaXBGYWNlQWdhaW5zdFBsYW5lKHBWdHhJbiwgcFZ0eE91dCwgcGxhbmVOb3JtYWxXUywgcGxhbmVFcVdTKTsgLy8gVGhyb3cgYXdheSBhbGwgY2xpcHBlZCBwb2ludHMsIGJ1dCBzYXZlIHRoZSByZW1haW5pbmcgdW50aWwgbmV4dCBjbGlwCgogICAgICAgIHdoaWxlIChwVnR4SW4ubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4uc2hpZnQoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChwVnR4T3V0Lmxlbmd0aCkgewogICAgICAgICAgcFZ0eEluLnB1c2gocFZ0eE91dC5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgIH0gLy8gb25seSBrZWVwIGNvbnRhY3QgcG9pbnRzIHRoYXQgYXJlIGJlaGluZCB0aGUgd2l0bmVzcyBmYWNlCgoKICAgICAgbG9jYWxQbGFuZU5vcm1hbC5jb3B5KHRoaXMuZmFjZU5vcm1hbHNbY2xvc2VzdEZhY2VBXSk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShjbG9zZXN0RmFjZUEpOwogICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgIHF1YXRBLnZtdWx0KHBsYW5lTm9ybWFsV1MsIHBsYW5lTm9ybWFsV1MpOwogICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcFZ0eEluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGRlcHRoID0gcGxhbmVOb3JtYWxXUy5kb3QocFZ0eEluW2ldKSArIHBsYW5lRXFXUzsgLy8gPz8/CgogICAgICAgIGlmIChkZXB0aCA8PSBtaW5EaXN0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiY2xhbXBlZDogZGVwdGg9IiArIGRlcHRoICsgIiB0byBtaW5EaXN0PSIgKyBtaW5EaXN0KTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGFyZ2V0LnZhZGQodmVydHNbaV0sIHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5zY2FsZSgxIC8gdmVydHMubGVuZ3RoLCB0YXJnZXQpOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm0gYWxsIGxvY2FsIHBvaW50cy4gV2lsbCBjaGFuZ2UgdGhlIC52ZXJ0aWNlcwogICAgICovCgoKICAgIHRyYW5zZm9ybUFsbFBvaW50cyhvZmZzZXQsIHF1YXQpIHsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7IC8vIEFwcGx5IHJvdGF0aW9uCgogICAgICBpZiAocXVhdCkgewogICAgICAgIC8vIFJvdGF0ZSB2ZXJ0aWNlcwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgIH0gLy8gUm90YXRlIGZhY2Ugbm9ybWFscwoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdGhpcy5mYWNlTm9ybWFsc1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfQogICAgICAgIC8qCiAgICAgICAgICAgICAgLy8gUm90YXRlIGVkZ2VzCiAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy51bmlxdWVFZGdlcy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLnVuaXF1ZUVkZ2VzW2ldOwogICAgICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsdik7CiAgICAgICAgICAgICAgfSovCgogICAgICB9IC8vIEFwcGx5IG9mZnNldAoKCiAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOwogICAgICAgICAgdi52YWRkKG9mZnNldCwgdik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrcyB3aGV0aGVyIHAgaXMgaW5zaWRlIHRoZSBwb2x5aGVkcmEuIE11c3QgYmUgaW4gbG9jYWwgY29vcmRzLgogICAgICogVGhlIHBvaW50IGxpZXMgb3V0c2lkZSBvZiB0aGUgY29udmV4IGh1bGwgb2YgdGhlIG90aGVyIHBvaW50cyBpZiBhbmQgb25seSBpZiB0aGUgZGlyZWN0aW9uCiAgICAgKiBvZiBhbGwgdGhlIHZlY3RvcnMgZnJvbSBpdCB0byB0aG9zZSBvdGhlciBwb2ludHMgYXJlIG9uIGxlc3MgdGhhbiBvbmUgaGFsZiBvZiBhIHNwaGVyZSBhcm91bmQgaXQuCiAgICAgKiBAcGFyYW0gcCBBIHBvaW50IGdpdmVuIGluIGxvY2FsIGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgcG9pbnRJc0luc2lkZShwKSB7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgcG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldEF2ZXJhZ2VQb2ludExvY2FsKHBvaW50SW5zaWRlKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCBuID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCB2ID0gdmVydHNbZmFjZXNbaV1bMF1dOyAvLyBXZSBvbmx5IG5lZWQgb25lIHBvaW50IGluIHRoZSBmYWNlCiAgICAgICAgLy8gVGhpcyBkb3QgcHJvZHVjdCBkZXRlcm1pbmVzIHdoaWNoIHNpZGUgb2YgdGhlIGVkZ2UgdGhlIHBvaW50IGlzCgogICAgICAgIGNvbnN0IHZUb1AgPSBuZXcgVmVjMygpOwogICAgICAgIHAudnN1Yih2LCB2VG9QKTsKICAgICAgICBjb25zdCByMSA9IG4uZG90KHZUb1ApOwogICAgICAgIGNvbnN0IHZUb1BvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgICBwb2ludEluc2lkZS52c3ViKHYsIHZUb1BvaW50SW5zaWRlKTsKICAgICAgICBjb25zdCByMiA9IG4uZG90KHZUb1BvaW50SW5zaWRlKTsKCiAgICAgICAgaWYgKHIxIDwgMCAmJiByMiA+IDAgfHwgcjEgPiAwICYmIHIyIDwgMCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgICAgfQogICAgICB9IC8vIElmIHdlIGdvdCBoZXJlLCBhbGwgZG90IHByb2R1Y3RzIHdlcmUgb2YgdGhlIHNhbWUgc2lnbi4KCgogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXggYW5kIG1pbiBkb3QgcHJvZHVjdCBvZiBhIGNvbnZleCBodWxsIGF0IHBvc2l0aW9uIChwb3MscXVhdCkgcHJvamVjdGVkIG9udG8gYW4gYXhpcy4KICAgICAqIFJlc3VsdHMgYXJlIHNhdmVkIGluIHRoZSBhcnJheSBtYXhtaW4uCiAgICAgKiBAcGFyYW0gcmVzdWx0IHJlc3VsdFswXSBhbmQgcmVzdWx0WzFdIHdpbGwgYmUgc2V0IHRvIG1heGltdW0gYW5kIG1pbmltdW0sIHJlc3BlY3RpdmVseS4KICAgICAqLwoKCiAgICBzdGF0aWMgcHJvamVjdChzaGFwZSwgYXhpcywgcG9zLCBxdWF0LCByZXN1bHQpIHsKICAgICAgY29uc3QgbiA9IHNoYXBlLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgY29uc3QgbG9jYWxBeGlzID0gcHJvamVjdF9sb2NhbEF4aXM7CiAgICAgIGxldCBtYXggPSAwOwogICAgICBsZXQgbWluID0gMDsKICAgICAgY29uc3QgbG9jYWxPcmlnaW4gPSBwcm9qZWN0X2xvY2FsT3JpZ2luOwogICAgICBjb25zdCB2cyA9IHNoYXBlLnZlcnRpY2VzOwogICAgICBsb2NhbE9yaWdpbi5zZXRaZXJvKCk7IC8vIFRyYW5zZm9ybSB0aGUgYXhpcyB0byBsb2NhbAoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3MsIHF1YXQsIGF4aXMsIGxvY2FsQXhpcyk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3MsIHF1YXQsIGxvY2FsT3JpZ2luLCBsb2NhbE9yaWdpbik7CiAgICAgIGNvbnN0IGFkZCA9IGxvY2FsT3JpZ2luLmRvdChsb2NhbEF4aXMpOwogICAgICBtaW4gPSBtYXggPSB2c1swXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgY29uc3QgdmFsID0gdnNbaV0uZG90KGxvY2FsQXhpcyk7CgogICAgICAgIGlmICh2YWwgPiBtYXgpIHsKICAgICAgICAgIG1heCA9IHZhbDsKICAgICAgICB9CgogICAgICAgIGlmICh2YWwgPCBtaW4pIHsKICAgICAgICAgIG1pbiA9IHZhbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbiAtPSBhZGQ7CiAgICAgIG1heCAtPSBhZGQ7CgogICAgICBpZiAobWluID4gbWF4KSB7CiAgICAgICAgLy8gSW5jb25zaXN0ZW50IC0gc3dhcAogICAgICAgIGNvbnN0IHRlbXAgPSBtaW47CiAgICAgICAgbWluID0gbWF4OwogICAgICAgIG1heCA9IHRlbXA7CiAgICAgIH0gLy8gT3V0cHV0CgoKICAgICAgcmVzdWx0WzBdID0gbWF4OwogICAgICByZXN1bHRbMV0gPSBtaW47CiAgICB9CgogIH0KCiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCgogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaGFsZkV4dGVudHMgPSBoYWxmRXh0ZW50czsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSBudWxsOwogICAgICB0aGlzLnVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGxvY2FsIGNvbnZleCBwb2x5aGVkcm9uIHJlcHJlc2VudGF0aW9uIHVzZWQgZm9yIHNvbWUgY29sbGlzaW9ucy4KICAgICAqLwoKCiAgICB1cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKSB7CiAgICAgIGNvbnN0IHN4ID0gdGhpcy5oYWxmRXh0ZW50cy54OwogICAgICBjb25zdCBzeSA9IHRoaXMuaGFsZkV4dGVudHMueTsKICAgICAgY29uc3Qgc3ogPSB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICAgIGNvbnN0IFYgPSBWZWMzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtuZXcgVigtc3gsIC1zeSwgLXN6KSwgbmV3IFYoc3gsIC1zeSwgLXN6KSwgbmV3IFYoc3gsIHN5LCAtc3opLCBuZXcgVigtc3gsIHN5LCAtc3opLCBuZXcgVigtc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgLXN5LCBzeiksIG5ldyBWKHN4LCBzeSwgc3opLCBuZXcgVigtc3gsIHN5LCBzeildOwogICAgICBjb25zdCBmYWNlcyA9IFtbMywgMiwgMSwgMF0sIC8vIC16CiAgICAgIFs0LCA1LCA2LCA3XSwgLy8gK3oKICAgICAgWzUsIDQsIDAsIDFdLCAvLyAteQogICAgICBbMiwgMywgNywgNl0sIC8vICt5CiAgICAgIFswLCA0LCA3LCAzXSwgLy8gLXgKICAgICAgWzEsIDIsIDYsIDVdIC8vICt4CiAgICAgIF07CiAgICAgIGNvbnN0IGF4ZXMgPSBbbmV3IFYoMCwgMCwgMSksIG5ldyBWKDAsIDEsIDApLCBuZXcgVigxLCAwLCAwKV07CiAgICAgIGNvbnN0IGggPSBuZXcgQ29udmV4UG9seWhlZHJvbih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24gPSBoOwogICAgICBoLm1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIH0KICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRoZSBpbmVydGlhIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCA9IG5ldyBWZWMzKCkpIHsKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CgogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCgogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwoKICBjb25zdCBCT0RZX1NMRUVQX1NUQVRFUyA9IHsKICAgIC8qKiBBV0FLRSAqLwogICAgQVdBS0U6IDAsCgogICAgLyoqIFNMRUVQWSAqLwogICAgU0xFRVBZOiAxLAoKICAgIC8qKiBTTEVFUElORyAqLwogICAgU0xFRVBJTkc6IDIKICB9OwogIC8qKgogICAqIEJvZHlTbGVlcFN0YXRlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGFsbCBib2R5IHR5cGVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUoMSkKICAgKiAgICAgY29uc3QgYm9keSA9IG5ldyBDQU5OT04uQm9keSh7CiAgICogICAgICAgbWFzczogMSwKICAgKiAgICAgICBzaGFwZSwKICAgKiAgICAgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib2R5KQogICAqLwoKICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvc2l0aW9uIG9mIGJvZHkgaW4gV29ybGQuYm9kaWVzLiBVcGRhdGVkIGJ5IFdvcmxkIGFuZCB1c2VkIGluIEFycmF5Q29sbGlzaW9uTWF0cml4LgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2UgdG8gdGhlIHdvcmxkIHRoZSBib2R5IGlzIGxpdmluZyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIEJFRk9SRSBzdGVwcGluZyB0aGUgc3lzdGVtLiBVc2UgaXQgdG8gYXBwbHkgZm9yY2VzLCBmb3IgZXhhbXBsZS4gSW5zaWRlIHRoZSBmdW5jdGlvbiwgInRoaXMiIHdpbGwgcmVmZXIgdG8gdGhpcyBCb2R5IG9iamVjdC4gRGVwcmVjYXRlZCAtIHVzZSBXb3JsZCBldmVudHMgaW5zdGVhZC4KICAgICAqIEBkZXByZWNhdGVkIFVzZSBXb3JsZCBldmVudHMgaW5zdGVhZAogICAgICovCgogICAgLyoqCiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgQUZURVIgc3RlcHBpbmcgdGhlIHN5c3RlbS4gSW5zaWRlIHRoZSBmdW5jdGlvbiwgInRoaXMiIHdpbGwgcmVmZXIgdG8gdGhpcyBCb2R5IG9iamVjdC4gRGVwcmVjYXRlZCAtIHVzZSBXb3JsZCBldmVudHMgaW5zdGVhZC4KICAgICAqIEBkZXByZWNhdGVkIFVzZSBXb3JsZCBldmVudHMgaW5zdGVhZAogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY29sbGlzaW9uIGdyb3VwIHRoZSBib2R5IGJlbG9uZ3MgdG8uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBjb2xsaXNpb24gZ3JvdXAgdGhlIGJvZHkgY2FuIGNvbGxpZGUgd2l0aC4KICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZCAtIGkuZS4gImNvbGxpZGUiIGV2ZW50cyB3aWxsIGJlIHJhaXNlZCwgYnV0IGZvcmNlcyB3aWxsIG5vdCBiZSBhbHRlcmVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW50ZXJwb2xhdGVkIHBvc2l0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIHBvc2l0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogTGluZWFyIGZvcmNlIG9uIHRoZSBib2R5IGluIHdvcmxkIHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbWFzcyBvZiB0aGUgYm9keS4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHBoeXNpY3MgbWF0ZXJpYWwgb2YgdGhlIGJvZHkuIEl0IGRlZmluZXMgdGhlIGJvZHkgaW50ZXJhY3Rpb24gd2l0aCBvdGhlciBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBtdWNoIHRvIGRhbXAgdGhlIGJvZHkgdmVsb2NpdHkgZWFjaCBzdGVwLiBJdCBjYW4gZ28gZnJvbSAwIHRvIDEuCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIE9uZSBvZjogYEJvZHkuRFlOQU1JQ2AsIGBCb2R5LlNUQVRJQ2AgYW5kIGBCb2R5LktJTkVNQVRJQ2AuCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRydWUsIHRoZSBib2R5IHdpbGwgYXV0b21hdGljYWxseSBmYWxsIHRvIHNsZWVwLgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBDdXJyZW50IHNsZWVwIHN0YXRlLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgc3BlZWQgKHRoZSBub3JtIG9mIHRoZSB2ZWxvY2l0eSkgaXMgc21hbGxlciB0aGFuIHRoaXMgdmFsdWUsIHRoZSBib2R5IGlzIGNvbnNpZGVyZWQgc2xlZXB5LgogICAgICogQGRlZmF1bHQgMC4xCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSBib2R5IGhhcyBiZWVuIHNsZWVweSBmb3IgdGhpcyBzbGVlcFRpbWVMaW1pdCBzZWNvbmRzLCBpdCBpcyBjb25zaWRlcmVkIHNsZWVwaW5nLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSByb3RhdGlvbmFsIGZvcmNlIG9uIHRoZSBib2R5LCBhcm91bmQgY2VudGVyIG9mIG1hc3MuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNlIG9yaWVudGF0aW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIHF1YXRlcm5pb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEludGVycG9sYXRlZCBvcmllbnRhdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5ndWxhciB2ZWxvY2l0eSBvZiB0aGUgYm9keSwgaW4gd29ybGQgc3BhY2UuIFRoaW5rIG9mIHRoZSBhbmd1bGFyIHZlbG9jaXR5IGFzIGEgdmVjdG9yLCB3aGljaCB0aGUgYm9keSByb3RhdGVzIGFyb3VuZC4gVGhlIGxlbmd0aCBvZiB0aGlzIHZlY3RvciBkZXRlcm1pbmVzIGhvdyBmYXN0IChpbiByYWRpYW5zIHBlciBzZWNvbmQpIHRoZSBib2R5IHJvdGF0ZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluaXRpYWwgYW5ndWxhciB2ZWxvY2l0eSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogTGlzdCBvZiBTaGFwZXMgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvc2l0aW9uIG9mIGVhY2ggU2hhcGUgaW4gdGhlIGJvZHksIGdpdmVuIGluIGxvY2FsIEJvZHkgc3BhY2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE9yaWVudGF0aW9uIG9mIGVhY2ggU2hhcGUsIGdpdmVuIGluIGxvY2FsIEJvZHkgc3BhY2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmVydGlhIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9keSB0byByb3RhdGUuIE1ha2Ugc3VyZSB0byBydW4gLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCkgaWYgeW91IGNoYW5nZSB0aGlzIGFmdGVyIHRoZSBib2R5IGNyZWF0aW9uLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG11Y2ggdG8gZGFtcCB0aGUgYm9keSBhbmd1bGFyIHZlbG9jaXR5IGVhY2ggc3RlcC4gSXQgY2FuIGdvIGZyb20gMCB0byAxLgogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBVc2UgdGhpcyBwcm9wZXJ0eSB0byBsaW1pdCB0aGUgbW90aW9uIGFsb25nIGFueSB3b3JsZCBheGlzLiAoMSwxLDEpIHdpbGwgYWxsb3cgbW90aW9uIGFsb25nIGFsbCBheGVzIHdoaWxlICgwLDAsMCkgYWxsb3dzIG5vbmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZSB0aGlzIHByb3BlcnR5IHRvIGxpbWl0IHRoZSByb3RhdGlvbmFsIG1vdGlvbiBhbG9uZyBhbnkgd29ybGQgYXhpcy4gKDEsMSwxKSB3aWxsIGFsbG93IHJvdGF0aW9uIGFsb25nIGFsbCBheGVzIHdoaWxlICgwLDAsMCkgYWxsb3dzIG5vbmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNlIGJvdW5kaW5nIGJveCBvZiB0aGUgYm9keSBhbmQgaXRzIHNoYXBlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5kaWNhdGVzIGlmIHRoZSBBQUJCIG5lZWRzIHRvIGJlIHVwZGF0ZWQgYmVmb3JlIHVzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVG90YWwgYm91bmRpbmcgcmFkaXVzIG9mIHRoZSBCb2R5IGluY2x1ZGluZyBpdHMgc2hhcGVzLCByZWxhdGl2ZSB0byBib2R5LnBvc2l0aW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRydWUgdGhlIGJvZHkgYmVoYXZlcyBsaWtlIGEgdHJpZ2dlci4gSXQgZG9lcyBub3QgY29sbGlkZQogICAgICogd2l0aCBvdGhlciBib2RpZXMgYnV0IGNvbGxpc2lvbiBldmVudHMgYXJlIHN0aWxsIHRyaWdnZXJlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmluZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnByZVN0ZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zdFN0ZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMudmxhbWJkYSA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLnBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdFBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmluaXRWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXNzID0gdm9pZCAwOwogICAgICB0aGlzLmludk1hc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gdm9pZCAwOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB2b2lkIDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHZvaWQgMDsKICAgICAgdGhpcy50b3JxdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmluZXJ0aWEgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJEYW1waW5nID0gdm9pZCAwOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdm9pZCAwOwogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gdm9pZCAwOwogICAgICB0aGlzLndsYW1iZGEgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gQm9keS5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5pbmRleCA9IC0xOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5wcmVTdGVwID0gbnVsbDsKICAgICAgdGhpcy5wb3N0U3RlcCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHdvcmxkVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGRGcmFtZShsb2NhbFBvaW50LCByZXN1bHQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCA9IG5ldyBWZWMzKCkpIHsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDtlbHNlIHsKICAgICAgICBjb25zdCBtMSA9IHVpd19tMTsKICAgICAgICBjb25zdCBtMiA9IHVpd19tMjsKICAgICAgICBtMS5zZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKHRoaXMucXVhdGVybmlvbik7CiAgICAgICAgbTEudHJhbnNwb3NlKG0yKTsKICAgICAgICBtMS5zY2FsZShJLCBtMSk7CiAgICAgICAgbTEubW11bHQobTIsIHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFwcGx5aW5nIGZvcmNlIHRoaXMgd2F5IHdpbGwgYWRkIHRvIEJvZHkuZm9yY2UgYW5kIEJvZHkudG9ycXVlLgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBhbW91bnQgb2YgZm9yY2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoZm9yY2UsIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpKSB7CiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpKSB7CiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMud2FrZVVwKCk7CiAgICAgIH0gLy8gQ29tcHV0ZSBwb2ludCBwb3NpdGlvbiByZWxhdGl2ZSB0byB0aGUgYm9keSBjZW50ZXIKCgogICAgICBjb25zdCByID0gcmVsYXRpdmVQb2ludDsgLy8gQ29tcHV0ZSBwcm9kdWNlZCBjZW50cmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV92ZWxvOwogICAgICB2ZWxvLmNvcHkoaW1wdWxzZSk7CiAgICAgIHZlbG8uc2NhbGUodGhpcy5pbnZNYXNzLCB2ZWxvKTsgLy8gQWRkIGxpbmVhciBpbXB1bHNlCgogICAgICB0aGlzLnZlbG9jaXR5LnZhZGQodmVsbywgdGhpcy52ZWxvY2l0eSk7IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCByb3RWZWxvID0gQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbzsKICAgICAgci5jcm9zcyhpbXB1bHNlLCByb3RWZWxvKTsKICAgICAgLyoKICAgICAgIHJvdFZlbG8ueCAqPSB0aGlzLmludkluZXJ0aWEueDsKICAgICAgIHJvdFZlbG8ueSAqPSB0aGlzLmludkluZXJ0aWEueTsKICAgICAgIHJvdFZlbG8ueiAqPSB0aGlzLmludkluZXJ0aWEuejsKICAgICAgICovCgogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZC52bXVsdChyb3RWZWxvLCByb3RWZWxvKTsgLy8gQWRkIHJvdGF0aW9uYWwgSW1wdWxzZQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkudmFkZChyb3RWZWxvLCB0aGlzLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGxvY2FsbHktZGVmaW5lZCBpbXB1bHNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEltcHVsc2UobG9jYWxJbXB1bHNlLCBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CgogIEJvZHkuaWRDb3VudGVyID0gMDsKICBCb2R5LkNPTExJREVfRVZFTlRfTkFNRSA9ICdjb2xsaWRlJzsKICBCb2R5LkRZTkFNSUMgPSBCT0RZX1RZUEVTLkRZTkFNSUM7CiAgQm9keS5TVEFUSUMgPSBCT0RZX1RZUEVTLlNUQVRJQzsKICBCb2R5LktJTkVNQVRJQyA9IEJPRFlfVFlQRVMuS0lORU1BVElDOwogIEJvZHkuQVdBS0UgPSBCT0RZX1NMRUVQX1NUQVRFUy5BV0FLRTsKICBCb2R5LlNMRUVQWSA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQWTsKICBCb2R5LlNMRUVQSU5HID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBJTkc7CiAgQm9keS53YWtldXBFdmVudCA9IHsKICAgIHR5cGU6ICd3YWtldXAnCiAgfTsKICBCb2R5LnNsZWVweUV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVweScKICB9OwogIEJvZHkuc2xlZXBFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcCcKICB9OwogIGNvbnN0IHRtcFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgdXBkYXRlQUFCQl9zaGFwZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHVpd19tMSA9IG5ldyBNYXQzKCk7CiAgY29uc3QgdWl3X20yID0gbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbnMKICAgKiBAYXV0aG9yIHNjaHRlcHBlCiAgICovCgogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy51c2VCb3VuZGluZ0JveGVzID0gdm9pZCAwOwogICAgICB0aGlzLmRpcnR5ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy51c2VCb3VuZGluZ0JveGVzID0gZmFsc2U7CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbGxpc2lvbiBwYWlycyBmcm9tIHRoZSB3b3JsZAogICAgICogQHBhcmFtIHdvcmxkIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4KICAgICAqIEBwYXJhbSBwMSBFbXB0eSBhcnJheSB0byBiZSBmaWxsZWQgd2l0aCBib2R5IG9iamVjdHMKICAgICAqIEBwYXJhbSBwMiBFbXB0eSBhcnJheSB0byBiZSBmaWxsZWQgd2l0aCBib2R5IG9iamVjdHMKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcDEsIHAyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29sbGlzaW9uUGFpcnMgbm90IGltcGxlbWVudGVkIGZvciB0aGlzIEJyb2FkUGhhc2UgY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgYm9keSBwYWlyIG5lZWRzIHRvIGJlIGludGVyc2VjdGlvbiB0ZXN0ZWQgYXQgYWxsLgogICAgICovCgoKICAgIG5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJvZHlBLCBib2R5QikgewogICAgICAvLyBDaGVjayBjb2xsaXNpb24gZmlsdGVyIG1hc2tzCiAgICAgIGlmICgoYm9keUEuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5Qi5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keUIuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5QS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBDaGVjayB0eXBlcwoKCiAgICAgIGlmICgoKGJvZHlBLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUEuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgJiYgKChib2R5Qi50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlCLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpKSB7CiAgICAgICAgLy8gQm90aCBib2RpZXMgYXJlIHN0YXRpYyBvciBzbGVlcGluZy4gU2tpcC4KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgdm9sdW1lcyBvZiB0d28gYm9kaWVzIGludGVyc2VjdC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3Rpb25UZXN0KGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKHRoaXMudXNlQm91bmRpbmdCb3hlcykgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ0JveEJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgc3BoZXJlcyBvZiB0d28gYm9kaWVzIGFyZSBpbnRlcnNlY3RpbmcuCiAgICAgKiBAcGFyYW0gcGFpcnMxIGJvZHlBIGlzIGFwcGVuZGVkIHRvIHRoaXMgYXJyYXkgaWYgaW50ZXJzZWN0aW9uCiAgICAgKiBAcGFyYW0gcGFpcnMyIGJvZHlCIGlzIGFwcGVuZGVkIHRvIHRoaXMgYXJyYXkgaWYgaW50ZXJzZWN0aW9uCiAgICAgKi8KCgogICAgZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCByID0gQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yOwogICAgICBib2R5Qi5wb3NpdGlvbi52c3ViKGJvZHlBLnBvc2l0aW9uLCByKTsKICAgICAgY29uc3QgYm91bmRpbmdSYWRpdXNTdW0yID0gKGJvZHlBLmJvdW5kaW5nUmFkaXVzICsgYm9keUIuYm91bmRpbmdSYWRpdXMpICoqIDI7CiAgICAgIGNvbnN0IG5vcm0yID0gci5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobm9ybTIgPCBib3VuZGluZ1JhZGl1c1N1bTIpIHsKICAgICAgICBwYWlyczEucHVzaChib2R5QSk7CiAgICAgICAgcGFpcnMyLnB1c2goYm9keUIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBib3hlcyBvZiB0d28gYm9kaWVzIGFyZSBpbnRlcnNlY3RpbmcuCiAgICAgKi8KCgogICAgZG9Cb3VuZGluZ0JveEJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAoYm9keUEuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgYm9keUEudXBkYXRlQUFCQigpOwogICAgICB9CgogICAgICBpZiAoYm9keUIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgYm9keUIudXBkYXRlQUFCQigpOwogICAgICB9IC8vIENoZWNrIEFBQkIgLyBBQUJCCgoKICAgICAgaWYgKGJvZHlBLmFhYmIub3ZlcmxhcHMoYm9keUIuYWFiYikpIHsKICAgICAgICBwYWlyczEucHVzaChib2R5QSk7CiAgICAgICAgcGFpcnMyLnB1c2goYm9keUIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgZHVwbGljYXRlIHBhaXJzIGZyb20gdGhlIHBhaXIgYXJyYXlzLgogICAgICovCgoKICAgIG1ha2VQYWlyc1VuaXF1ZShwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCB0ID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcDsKICAgICAgY29uc3QgcDEgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMTsKICAgICAgY29uc3QgcDIgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMjsKICAgICAgY29uc3QgTiA9IHBhaXJzMS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgcDFbaV0gPSBwYWlyczFbaV07CiAgICAgICAgcDJbaV0gPSBwYWlyczJbaV07CiAgICAgIH0KCiAgICAgIHBhaXJzMS5sZW5ndGggPSAwOwogICAgICBwYWlyczIubGVuZ3RoID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBpZDEgPSBwMVtpXS5pZDsKICAgICAgICBjb25zdCBpZDIgPSBwMltpXS5pZDsKICAgICAgICBjb25zdCBrZXkgPSBpZDEgPCBpZDIgPyBpZDEgKyAiLCIgKyBpZDIgOiBpZDIgKyAiLCIgKyBpZDE7CiAgICAgICAgdFtrZXldID0gaTsKICAgICAgICB0LmtleXMucHVzaChrZXkpOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdC5rZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qga2V5ID0gdC5rZXlzLnBvcCgpOwogICAgICAgIGNvbnN0IHBhaXJJbmRleCA9IHRba2V5XTsKICAgICAgICBwYWlyczEucHVzaChwMVtwYWlySW5kZXhdKTsKICAgICAgICBwYWlyczIucHVzaChwMltwYWlySW5kZXhdKTsKICAgICAgICBkZWxldGUgdFtrZXldOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFRvIGJlIGltcGxlbWVudGVkIGJ5IHN1YmNhc3NlcwogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7fQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgc3BoZXJlcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAuCiAgICAgKi8KCgogICAgc3RhdGljIGJvdW5kaW5nU3BoZXJlQ2hlY2soYm9keUEsIGJvZHlCKSB7CiAgICAgIGNvbnN0IGRpc3QgPSBuZXcgVmVjMygpOyAvLyBic2NfZGlzdDsKCiAgICAgIGJvZHlBLnBvc2l0aW9uLnZzdWIoYm9keUIucG9zaXRpb24sIGRpc3QpOwogICAgICBjb25zdCBzYSA9IGJvZHlBLnNoYXBlc1swXTsKICAgICAgY29uc3Qgc2IgPSBib2R5Qi5zaGFwZXNbMF07CiAgICAgIHJldHVybiBNYXRoLnBvdyhzYS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNiLmJvdW5kaW5nU3BoZXJlUmFkaXVzLCAyKSA+IGRpc3QubGVuZ3RoU3F1YXJlZCgpOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiB0aGUgQUFCQi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBjb25zb2xlLndhcm4oJy5hYWJiUXVlcnkgaXMgbm90IGltcGxlbWVudGVkIGluIHRoaXMgQnJvYWRwaGFzZSBzdWJjbGFzcy4nKTsKICAgICAgcmV0dXJuIFtdOwogICAgfQoKICB9IC8vIFRlbXAgb2JqZWN0cwoKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKCiAgbmV3IFZlYzMoKTsKICAvKioKICAgKiBOYWl2ZSBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9uLCB1c2VkIGluIGxhY2sgb2YgYmV0dGVyIG9uZXMuCiAgICoKICAgKiBUaGUgbmFpdmUgYnJvYWRwaGFzZSBsb29rcyBhdCBhbGwgcG9zc2libGUgcGFpcnMgd2l0aG91dCByZXN0cmljdGlvbiwgdGhlcmVmb3JlIGl0IGhhcyBjb21wbGV4aXR5IE5eMiBfKHdoaWNoIGlzIGJhZClfCiAgICovCgogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0ID0gW10pIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCgoKICBjbGFzcyBSYXljYXN0UmVzdWx0IHsKICAgIC8qKgogICAgICogcmF5RnJvbVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJheVRvV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGl0Tm9ybWFsV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGl0UG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoYXNIaXQKICAgICAqLwoKICAgIC8qKgogICAgICogc2hhcGUKICAgICAqLwoKICAgIC8qKgogICAgICogYm9keQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXggb2YgdGhlIGhpdCB0cmlhbmdsZSwgaWYgdGhlIGhpdCBzaGFwZSB3YXMgYSB0cmltZXNoCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3RhbmNlIHRvIHRoZSBoaXQuIFdpbGwgYmUgc2V0IHRvIC0xIGlmIHRoZXJlIHdhcyBubyBoaXQKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIHJheSBzaG91bGQgc3RvcCB0cmF2ZXJzaW5nIHRoZSBib2RpZXMKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnJheVRvV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNIaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keSA9IHZvaWQgMDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KCgogIGNvbnN0IFJBWV9NT0RFUyA9IHsKICAgIC8qKiBDTE9TRVNUICovCiAgICBDTE9TRVNUOiAxLAoKICAgIC8qKiBBTlkgKi8KICAgIEFOWTogMiwKCiAgICAvKiogQUxMICovCiAgICBBTEw6IDQKICB9OwogIC8qKgogICAqIFJheU1vZGUKICAgKi8KCiAgX1NoYXBlJHR5cGVzJFNQSEVSRSA9IFNoYXBlLnR5cGVzLlNQSEVSRTsKICBfU2hhcGUkdHlwZXMkUExBTkUgPSBTaGFwZS50eXBlcy5QTEFORTsKICBfU2hhcGUkdHlwZXMkQk9YID0gU2hhcGUudHlwZXMuQk9YOwogIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogIF9TaGFwZSR0eXBlcyRDT05WRVhQTyA9IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST047CiAgX1NoYXBlJHR5cGVzJEhFSUdIVEZJID0gU2hhcGUudHlwZXMuSEVJR0hURklFTEQ7CiAgX1NoYXBlJHR5cGVzJFRSSU1FU0ggPSBTaGFwZS50eXBlcy5UUklNRVNIOwogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwoKICBjbGFzcyBSYXkgewogICAgLyoqCiAgICAgKiBmcm9tCiAgICAgKi8KCiAgICAvKioKICAgICAqIHRvCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgcHJlY2lzaW9uIG9mIHRoZSByYXkuIFVzZWQgd2hlbiBjaGVja2luZyBwYXJhbGxlbGl0eSBldGMuCiAgICAgKiBAZGVmYXVsdCAwLjAwMDEKICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGBmYWxzZWAgaWYgeW91IGRvbid0IHdhbnQgdGhlIFJheSB0byB0YWtlIGBjb2xsaXNpb25SZXNwb25zZWAgZmxhZ3MgaW50byBhY2NvdW50IG9uIGJvZGllcyBhbmQgc2hhcGVzLgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgcmF5IHNraXBzIGFueSBoaXRzIHdpdGggbm9ybWFsLmRvdChyYXlEaXJlY3Rpb24pIDwgMC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbkZpbHRlckdyb3VwCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW50ZXJzZWN0aW9uIG1vZGUuIFNob3VsZCBiZSBSYXkuQU5ZLCBSYXkuQUxMIG9yIFJheS5DTE9TRVNULgogICAgICogQGRlZmF1bHQgUkFZLkFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBDdXJyZW50IHJlc3VsdCBvYmplY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdpbGwgYmUgc2V0IHRvIGB0cnVlYCBkdXJpbmcgaW50ZXJzZWN0V29ybGQoKSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogVXNlci1wcm92aWRlZCByZXN1bHQgY2FsbGJhY2suIFdpbGwgYmUgdXNlZCBpZiBtb2RlIGlzIFJheS5BTEwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENMT1NFU1QKICAgICAqLwoKICAgIC8qKgogICAgICogQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFMTAogICAgICovCiAgICBnZXQgW19TaGFwZSR0eXBlcyRTUEhFUkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0U3BoZXJlOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFBMQU5FXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFBsYW5lOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEJPWF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RCb3g7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ1lMSU5ERVJdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENPTlZFWFBPXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRIRUlHSFRGSV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRUUklNRVNIXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFRyaW1lc2g7CiAgICB9CgogICAgY29uc3RydWN0b3IoZnJvbSA9IG5ldyBWZWMzKCksIHRvID0gbmV3IFZlYzMoKSkgewogICAgICB0aGlzLmZyb20gPSB2b2lkIDA7CiAgICAgIHRoaXMudG8gPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZWNpc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHZvaWQgMDsKICAgICAgdGhpcy5tb2RlID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3VsdCA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNIaXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuY2FsbGJhY2sgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CgogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X3ZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxEaXJlY3Rpb24gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxGcm9tID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IEFBQkIoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCB2MCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0ID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gZGlzdGFuY2VGcm9tSW50ZXJzZWN0aW9uKGZyb20sIGRpcmVjdGlvbiwgcG9zaXRpb24pIHsKICAgIC8vIHYwIGlzIHZlY3RvciBmcm9tIGZyb20gdG8gcG9zaXRpb24KICAgIHBvc2l0aW9uLnZzdWIoZnJvbSwgdjApOwogICAgY29uc3QgZG90ID0gdjAuZG90KGRpcmVjdGlvbik7IC8vIGludGVyc2VjdCA9IGRpcmVjdGlvbipkb3QgKyBmcm9tCgogICAgZGlyZWN0aW9uLnNjYWxlKGRvdCwgaW50ZXJzZWN0KTsKICAgIGludGVyc2VjdC52YWRkKGZyb20sIGludGVyc2VjdCk7CiAgICBjb25zdCBkaXN0YW5jZSA9IHBvc2l0aW9uLmRpc3RhbmNlVG8oaW50ZXJzZWN0KTsKICAgIHJldHVybiBkaXN0YW5jZTsKICB9CiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCgoKICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLl9hZGRCb2R5SGFuZGxlciA9IHZvaWQgMDsKICAgICAgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0ID0gW10pIHsKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMgPSB7fSwgZGVmYXVsdHMpIHsKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25zdHJhaW50IGJhc2UgY2xhc3MKICAgKi8KCgogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlBID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlCID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSB2b2lkIDA7CiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KCiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbCA9IHZvaWQgMDsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIE1pbmltdW0gKHJlYWQ6IG5lZ2F0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4aW11bSAocmVhZDogcG9zaXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBBIG51bWJlciwgcHJvcG9ydGlvbmFsIHRvIHRoZSBmb3JjZSBhZGRlZCB0byB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihiaSwgYmosIG1pbkZvcmNlID0gLTFlNiwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5taW5Gb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhGb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaiA9IHZvaWQgMDsKICAgICAgdGhpcy5hID0gdm9pZCAwOwogICAgICB0aGlzLmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXBzID0gdm9pZCAwOwogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSB2b2lkIDA7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQoKICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlID0gMWU2KSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnJpID0gdm9pZCAwOwogICAgICB0aGlzLnJqID0gdm9pZCAwOwogICAgICB0aGlzLm5pID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMSA9IG5ldyBWZWMzKCk7IC8vIFRlbXAgdmVjdG9ycwoKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwoKICBjbGFzcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBwaXZvdEEgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QSB3aGljaCBib2R5QSBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBib2R5QiBCb2R5IHRoYXQgd2lsbCBiZSBjb25zdHJhaW5lZCBpbiBhIHNpbWlsYXIgd2F5IHRvIHRoZSBzYW1lIHBvaW50IGFzIGJvZHlBLiBXZSB3aWxsIHRoZXJlZm9yZSBnZXQgYSBsaW5rIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLiBJZiBub3Qgc3BlY2lmaWVkLCBib2R5QSB3aWxsIGJlIGNvbnN0cmFpbmVkIHRvIGEgc3RhdGljIHBvaW50LgogICAgICogQHBhcmFtIHBpdm90QiBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlCIHdoaWNoIGJvZHlCIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBwaXZvdEEgPSBuZXcgVmVjMygpLCBib2R5QiwgcGl2b3RCID0gbmV3IFZlYzMoKSwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSB2b2lkIDA7CiAgICAgIHRoaXMucGl2b3RCID0gdm9pZCAwOwogICAgICB0aGlzLmVxdWF0aW9uWCA9IHZvaWQgMDsKICAgICAgdGhpcy5lcXVhdGlvblkgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25aID0gdm9pZCAwOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbmUgZXF1YXRpb24uIFdvcmtzIHRvIGtlZXAgdGhlIGdpdmVuIGJvZHkgd29ybGQgdmVjdG9ycyBhbGlnbmVkLCBvciB0aWx0ZWQgd2l0aGluIGEgZ2l2ZW4gYW5nbGUgZnJvbSBlYWNoIG90aGVyLgogICAqLwoKCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMuYW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwoKICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCgogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zID0ge30pIHsKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ2xlID0gdm9pZCAwOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29uZUVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnR3aXN0RXF1YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5heGlzQiA9IG9wdGlvbnMuYXhpc0IgPyBvcHRpb25zLmF4aXNCLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgdGhpcy5hbmdsZSA9IHR5cGVvZiBvcHRpb25zLmFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5nbGUgOiAwOwogICAgICBjb25zdCBjID0gdGhpcy5jb25lRXF1YXRpb24gPSBuZXcgQ29uZUVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHQgPSB0aGlzLnR3aXN0RXF1YXRpb24gPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIHRoaXMudHdpc3RBbmdsZSA9IHR5cGVvZiBvcHRpb25zLnR3aXN0QW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy50d2lzdEFuZ2xlIDogMDsgLy8gTWFrZSB0aGUgY29uZSBlcXVhdGlvbiBwdXNoIHRoZSBib2RpZXMgdG93YXJkIHRoZSBjb25lIGF4aXMsIG5vdCBvdXR3YXJkCgogICAgICBjLm1heEZvcmNlID0gMDsKICAgICAgYy5taW5Gb3JjZSA9IC1tYXhGb3JjZTsgLy8gTWFrZSB0aGUgdHdpc3QgZXF1YXRpb24gYWRkIHRvcnF1ZSB0b3dhcmQgdGhlIGluaXRpYWwgcG9zaXRpb24KCiAgICAgIHQubWF4Rm9yY2UgPSAwOwogICAgICB0Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGMsIHQpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IGNvbmUgPSB0aGlzLmNvbmVFcXVhdGlvbjsKICAgICAgY29uc3QgdHdpc3QgPSB0aGlzLnR3aXN0RXF1YXRpb247CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBVcGRhdGUgdGhlIGF4ZXMgdG8gdGhlIGNvbmUgY29uc3RyYWludAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0EsIGNvbmUuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQiwgY29uZS5heGlzQik7IC8vIFVwZGF0ZSB0aGUgd29ybGQgYXhlcyBpbiB0aGUgdHdpc3QgY29uc3RyYWludAoKICAgICAgdGhpcy5heGlzQS50YW5nZW50cyh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgdGhpcy5heGlzQi50YW5nZW50cyh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgY29uZS5hbmdsZSA9IHRoaXMuYW5nbGU7CiAgICAgIHR3aXN0Lm1heEFuZ2xlID0gdGhpcy50d2lzdEFuZ2xlOwogICAgfQoKICB9CiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KCgogIGNsYXNzIERpc3RhbmNlQ29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5QgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGlzdGFuY2UgVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBkaXN0YW5jZSwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gdm9pZCAwOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCgoKICBjbGFzcyBMb2NrQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zID0ge30pIHsKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSB2b2lkIDA7CiAgICAgIHRoaXMueEIgPSB2b2lkIDA7CiAgICAgIHRoaXMueUEgPSB2b2lkIDA7CiAgICAgIHRoaXMueUIgPSB2b2lkIDA7CiAgICAgIHRoaXMuekEgPSB2b2lkIDA7CiAgICAgIHRoaXMuekIgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IHZvaWQgMDsKICAgICAgdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjMgPSB2b2lkIDA7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KCgogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UgPSAxZTYpIHsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICAvKioKICAgKiBIaW5nZSBjb25zdHJhaW50LiBUaGluayBvZiBpdCBhcyBhIGRvb3IgaGluZ2UuIEl0IHRyaWVzIHRvIGtlZXAgdGhlIGRvb3IgaW4gdGhlIGNvcnJlY3QgcGxhY2UgYW5kIHdpdGggdGhlIGNvcnJlY3Qgb3JpZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSB2b2lkIDA7CiAgICAgIHRoaXMucmogPSB2b2lkIDA7CiAgICAgIHRoaXMudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CgogIENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwoKICBjbGFzcyBNYXRlcmlhbCB7CiAgICAvKioKICAgICAqIE1hdGVyaWFsIG5hbWUuCiAgICAgKiBJZiBvcHRpb25zIGlzIGEgc3RyaW5nLCBuYW1lIHdpbGwgYmUgc2V0IHRvIHRoYXQgc3RyaW5nLgogICAgICogQHRvZG8gRGVwcmVjYXRlIHRoaXMKICAgICAqLwoKICAgIC8qKiBNYXRlcmlhbCBpZC4gKi8KCiAgICAvKioKICAgICAqIEZyaWN0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgZnJpY3Rpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIHJlc3RpdHV0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIHRoaXMubmFtZSA9IHZvaWQgMDsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHZvaWQgMDsKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQoKICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwoKICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMgPSB7fSkgewogICAgICB0aGlzLnJlc3RMZW5ndGggPSB2b2lkIDA7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keUEgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keUIgPSB2b2lkIDA7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gdm9pZCAwOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KCiAgY29uc3QgYXBwbHlGb3JjZV9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JfdW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV91ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yaV94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmpfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3RtcCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCgogIGNsYXNzIFdoZWVsSW5mbyB7CiAgICAvKioKICAgICAqIE1heCB0cmF2ZWwgZGlzdGFuY2Ugb2YgdGhlIHN1c3BlbnNpb24sIGluIG1ldGVycy4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3BlZWQgdG8gYXBwbHkgdG8gdGhlIHdoZWVsIHJvdGF0aW9uIHdoZW4gdGhlIHdoZWVsIGlzIHNsaWRpbmcuCiAgICAgKiBAZGVmYXVsdCAtMC4xCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkIHNob3VsZCBiZSB1c2VkLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogc2xpZGluZwogICAgICovCgogICAgLyoqCiAgICAgKiBDb25uZWN0aW9uIHBvaW50LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGNoYXNzaXMgYm9keSBmcmFtZS4KICAgICAqLwoKICAgIC8qKgogICAgICogY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbkxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRpcmVjdGlvbldvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVMb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlc3RMZW5ndGgKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbk1heExlbmd0aAogICAgICogQGRlZmF1bHQgMgogICAgICovCgogICAgLyoqCiAgICAgKiByYWRpdXMKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblN0aWZmbmVzcwogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdDb21wcmVzc2lvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ1JlbGF4YXRpb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZyaWN0aW9uU2xpcAogICAgICogQGRlZmF1bHQgMTAuNQogICAgICovCgogICAgLyoqIGZvcndhcmRBY2NlbGVyYXRpb24gKi8KCiAgICAvKiogc2lkZUFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKgogICAgICogc3RlZXJpbmcKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogUm90YXRpb24gdmFsdWUsIGluIHJhZGlhbnMuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRlbHRhUm90YXRpb24KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogcm9sbEluZmx1ZW5jZQogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhTdXNwZW5zaW9uRm9yY2UKICAgICAqLwoKICAgIC8qKgogICAgICogZW5naW5lRm9yY2UKICAgICAqLwoKICAgIC8qKgogICAgICogYnJha2UKICAgICAqLwoKICAgIC8qKgogICAgICogaXNGcm9udFdoZWVsCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uRm9yY2UKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2xpcEluZm8KICAgICAqLwoKICAgIC8qKgogICAgICogc2tpZEluZm8KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkxlbmd0aAogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzaWRlSW1wdWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBmb3J3YXJkSW1wdWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgcmVzdWx0IGZyb20gcmF5Y2FzdGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlZWwgd29ybGQgdHJhbnNmb3JtLgogICAgICovCgogICAgLyoqCiAgICAgKiBpc0luQ29udGFjdAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gdm9pZCAwOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGlkaW5nID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gdm9pZCAwOwogICAgICB0aGlzLmF4bGVXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gdm9pZCAwOwogICAgICB0aGlzLnJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5kYW1waW5nUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZm9yd2FyZEFjY2VsZXJhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlQWNjZWxlcmF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZWVyaW5nID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucm9sbEluZmx1ZW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuYnJha2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gdm9pZCAwOwogICAgICB0aGlzLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpcEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkVHJhbnNmb3JtID0gdm9pZCAwOwogICAgICB0aGlzLmlzSW5Db250YWN0ID0gdm9pZCAwOwogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQoKICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCgogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gdm9pZCAwOwogICAgICB0aGlzLndoZWVsSW5mb3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpZGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleEZvcndhcmRBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGV4VXBBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9IHZvaWQgMDsKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gdm9pZCAwOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucyA9IHt9KSB7CiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQoKICBjb25zdCB0bXBWZWM0ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM1ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM2ID0gbmV3IFZlYzMoKTsKICBuZXcgUmF5KCk7CiAgY29uc3QgY2FzdFJheV9yYXl2ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBkaXJlY3Rpb25zID0gW25ldyBWZWMzKDEsIDAsIDApLCBuZXcgVmVjMygwLCAxLCAwKSwgbmV3IFZlYzMoMCwgMCwgMSldOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX3N1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fYXhsZSA9IFtdOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUyA9IFtdOwogIGNvbnN0IHNpZGVGcmljdGlvblN0aWZmbmVzczIgPSAxOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGNhbGNSb2xsaW5nRnJpY3Rpb24oYm9keTAsIGJvZHkxLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkLCBtYXhJbXB1bHNlKSB7CiAgICBsZXQgajEgPSAwOwogICAgY29uc3QgY29udGFjdFBvc1dvcmxkID0gZnJpY3Rpb25Qb3NXb3JsZDsgLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwoKICAgIGNvbnN0IHZlbDEgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDE7CiAgICBjb25zdCB2ZWwyID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwyOwogICAgY29uc3QgdmVsID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWw7IC8vIGNvbnRhY3RQb3NXb3JsZC52c3ViKGJvZHkwLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MS5wb3NpdGlvbiwgcmVsX3BvczIpOwoKICAgIGJvZHkwLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KGNvbnRhY3RQb3NXb3JsZCwgdmVsMSk7CiAgICBib2R5MS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDIpOwogICAgdmVsMS52c3ViKHZlbDIsIHZlbCk7CiAgICBjb25zdCB2cmVsID0gZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZC5kb3QodmVsKTsKICAgIGNvbnN0IGRlbm9tMCA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTAsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgZGVub20xID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCk7CiAgICBjb25zdCByZWxheGF0aW9uID0gMTsKICAgIGNvbnN0IGphY0RpYWdBQkludiA9IHJlbGF4YXRpb24gLyAoZGVub20wICsgZGVub20xKTsgLy8gY2FsY3VsYXRlIGogdGhhdCBtb3ZlcyB1cyB0byB6ZXJvIHJlbGF0aXZlIHZlbG9jaXR5CgogICAgajEgPSAtdnJlbCAqIGphY0RpYWdBQkludjsKCiAgICBpZiAobWF4SW1wdWxzZSA8IGoxKSB7CiAgICAgIGoxID0gbWF4SW1wdWxzZTsKICAgIH0KCiAgICBpZiAoajEgPCAtbWF4SW1wdWxzZSkgewogICAgICBqMSA9IC1tYXhJbXB1bHNlOwogICAgfQoKICAgIHJldHVybiBqMTsKICB9CgogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfcjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfYzAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfdmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX20gPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHksIHBvcywgbm9ybWFsKSB7CiAgICBjb25zdCByMCA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfcjA7CiAgICBjb25zdCBjMCA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfYzA7CiAgICBjb25zdCB2ZWMgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYzsKICAgIGNvbnN0IG0gPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX207CiAgICBwb3MudnN1Yihib2R5LnBvc2l0aW9uLCByMCk7CiAgICByMC5jcm9zcyhub3JtYWwsIGMwKTsKICAgIGJvZHkuaW52SW5lcnRpYVdvcmxkLnZtdWx0KGMwLCBtKTsKICAgIG0uY3Jvc3MocjAsIHZlYyk7CiAgICByZXR1cm4gYm9keS5pbnZNYXNzICsgbm9ybWFsLmRvdCh2ZWMpOwogIH0KCiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwxID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsID0gbmV3IFZlYzMoKTsgLy8gYmlsYXRlcmFsIGNvbnN0cmFpbnQgYmV0d2VlbiB0d28gZHluYW1pYyBvYmplY3RzCgogIGZ1bmN0aW9uIHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoYm9keTEsIHBvczEsIGJvZHkyLCBwb3MyLCBub3JtYWwpIHsKICAgIGNvbnN0IG5vcm1hbExlblNxciA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgaWYgKG5vcm1hbExlblNxciA+IDEuMSkgewogICAgICByZXR1cm4gMDsgLy8gbm8gaW1wdWxzZQogICAgfSAvLyBjb25zdCByZWxfcG9zMSA9IG5ldyBWZWMzKCk7CiAgICAvLyBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAvLyBwb3MxLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MxKTsKICAgIC8vIHBvczIudnN1Yihib2R5Mi5wb3NpdGlvbiwgcmVsX3BvczIpOwoKCiAgICBjb25zdCB2ZWwxID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwxOwogICAgY29uc3QgdmVsMiA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMjsKICAgIGNvbnN0IHZlbCA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMSwgdmVsMSk7CiAgICBib2R5Mi5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChwb3MyLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgcmVsX3ZlbCA9IG5vcm1hbC5kb3QodmVsKTsKICAgIGNvbnN0IGNvbnRhY3REYW1waW5nID0gMC4yOwogICAgY29uc3QgbWFzc1Rlcm0gPSAxIC8gKGJvZHkxLmludk1hc3MgKyBib2R5Mi5pbnZNYXNzKTsKICAgIGNvbnN0IGltcHVsc2UgPSAtY29udGFjdERhbXBpbmcgKiByZWxfdmVsICogbWFzc1Rlcm07CiAgICByZXR1cm4gaW1wdWxzZTsKICB9CiAgLyoqCiAgICogU3BoZXJpY2FsIHNoYXBlCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzID0gMQogICAqICAgICBjb25zdCBzcGhlcmVTaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKHJhZGl1cykKICAgKiAgICAgY29uc3Qgc3BoZXJlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBzcGhlcmVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHNwaGVyZUJvZHkpCiAgICovCgoKICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXMgIT09IHVuZGVmaW5lZCA/IHJhZGl1cyA6IDEuMDsKCiAgICAgIGlmICh0aGlzLnJhZGl1cyA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzcGhlcmUgcmFkaXVzIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYSAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICBjb25zdCBJID0gMi4wICogbWFzcyAqIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgLyA1LjA7CiAgICAgIHRhcmdldC54ID0gSTsKICAgICAgdGFyZ2V0LnkgPSBJOwogICAgICB0YXJnZXQueiA9IEk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKiogdm9sdW1lICovCgoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDQuMCAqIE1hdGguUEkgKiBNYXRoLnBvdyh0aGlzLnJhZGl1cywgMykgLyAzLjA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLnJhZGl1czsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCByID0gdGhpcy5yYWRpdXM7CiAgICAgIGNvbnN0IGF4ZXMgPSBbJ3gnLCAneScsICd6J107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBheCA9IGF4ZXNbaV07CiAgICAgICAgbWluW2F4XSA9IHBvc1theF0gLSByOwogICAgICAgIG1heFtheF0gPSBwb3NbYXhdICsgcjsKICAgICAgfQogICAgfQoKICB9CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wID0gMSwgcmFkaXVzQm90dG9tID0gMSwgaGVpZ2h0ID0gMSwgbnVtU2VnbWVudHMgPSA4KSB7CiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXNUb3AgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzQm90dG9tID0gdm9pZCAwOwogICAgICB0aGlzLmhlaWdodCA9IHZvaWQgMDsKICAgICAgdGhpcy5udW1TZWdtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQogIC8qKgogICAqIFBhcnRpY2xlIHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHBhcnRpY2xlU2hhcGUgPSBuZXcgQ0FOTk9OLlBhcnRpY2xlKCkKICAgKiAgICAgY29uc3QgcGFydGljbGVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHBhcnRpY2xlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShwYXJ0aWNsZUJvZHkpCiAgICovCgoKICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQgPSBuZXcgVmVjMygpKSB7CiAgICAgIHRhcmdldC5zZXQoMCwgMCwgMCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gMDsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgbWluLmNvcHkocG9zKTsKICAgICAgbWF4LmNvcHkocG9zKTsKICAgIH0KCiAgfQogIC8qKgogICAqIEEgcGxhbmUsIGZhY2luZyBpbiB0aGUgWiBkaXJlY3Rpb24uIFRoZSBwbGFuZSBoYXMgaXRzIHN1cmZhY2UgYXQgej0wIGFuZCBldmVyeXRoaW5nIGJlbG93IHo9MCBpcyBhc3N1bWVkIHRvIGJlIHNvbGlkIHBsYW5lLiBUbyBtYWtlIHRoZSBwbGFuZSBmYWNlIGluIHNvbWUgb3RoZXIgZGlyZWN0aW9uIHRoYW4geiwgeW91IG11c3QgcHV0IGl0IGluc2lkZSBhIEJvZHkgYW5kIHJvdGF0ZSB0aGF0IGJvZHkuIFNlZSB0aGUgZGVtb3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGxhbmVTaGFwZSA9IG5ldyBDQU5OT04uUGxhbmUoKQogICAqICAgICBjb25zdCBwbGFuZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAwLCBzaGFwZTogIHBsYW5lU2hhcGUgfSkKICAgKiAgICAgcGxhbmVCb2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJIC8gMiwgMCwgMCkgLy8gbWFrZSBpdCBmYWNlIHVwCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGxhbmVCb2R5KQogICAqLwoKCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkTm9ybWFsTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLndvcmxkTm9ybWFsTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KICAgIC8qKiBjb21wdXRlV29ybGROb3JtYWwgKi8KCgogICAgY29tcHV0ZVdvcmxkTm9ybWFsKHF1YXQpIHsKICAgICAgY29uc3QgbiA9IHRoaXMud29ybGROb3JtYWw7CiAgICAgIG4uc2V0KDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KG4sIG4pOwogICAgICB0aGlzLndvcmxkTm9ybWFsTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQoKICBjb25zdCB0ZW1wTm9ybWFsID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwoKICBjbGFzcyBIZWlnaHRmaWVsZCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXggdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2luZyBiZXR3ZWVuIHRoZSBkYXRhIHBvaW50cyBpbiBYIGFuZCBZIGRpcmVjdGlvbi4KICAgICAqIEB0b2RvIGVsZW1lbnRTaXplWCBhbmQgWQogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkYXRhIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZGF0YSwgb3B0aW9ucyA9IHt9KSB7CiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gdm9pZCAwOwogICAgICB0aGlzLm1heFZhbHVlID0gdm9pZCAwOwogICAgICB0aGlzLm1pblZhbHVlID0gdm9pZCAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gdm9pZCAwOwogICAgICB0aGlzLmNhY2hlRW5hYmxlZCA9IHZvaWQgMDsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSB2b2lkIDA7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gdm9pZCAwOwogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0gdm9pZCAwOwogICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgICB0aGlzLm1heFZhbHVlID0gb3B0aW9ucy5tYXhWYWx1ZTsKICAgICAgdGhpcy5taW5WYWx1ZSA9IG9wdGlvbnMubWluVmFsdWU7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSBvcHRpb25zLmVsZW1lbnRTaXplOwoKICAgICAgaWYgKG9wdGlvbnMubWluVmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLm1heFZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB9CgogICAgICB0aGlzLmNhY2hlRW5hYmxlZCA9IHRydWU7CiAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7IC8vICJpX2pfaXNVcHBlciIgPT4geyBjb252ZXg6IC4uLiwgb2Zmc2V0OiAuLi4gfQogICAgICAvLyBmb3IgZXhhbXBsZToKICAgICAgLy8gX2NhY2hlZFBpbGxhcnNbIjBfMl8xIl0KCiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogQ2FsbCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBkYXRhIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGBtaW5WYWx1ZWAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVNaW5WYWx1ZSgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IG1pblZhbHVlID0gZGF0YVswXVswXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGRhdGFbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmICh2IDwgbWluVmFsdWUpIHsKICAgICAgICAgICAgbWluVmFsdWUgPSB2OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5taW5WYWx1ZSA9IG1pblZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGBtYXhWYWx1ZWAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVNYXhWYWx1ZSgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IG1heFZhbHVlID0gZGF0YVswXVswXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGRhdGFbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmICh2ID4gbWF4VmFsdWUpIHsKICAgICAgICAgICAgbWF4VmFsdWUgPSB2OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG1heFZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGhlaWdodCB2YWx1ZSBhdCBhbiBpbmRleC4gRG9uJ3QgZm9yZ2V0IHRvIHVwZGF0ZSBtYXhWYWx1ZSBhbmQgbWluVmFsdWUgYWZ0ZXIgeW91J3JlIGRvbmUuCiAgICAgKi8KCgogICAgc2V0SGVpZ2h0VmFsdWVBdEluZGV4KHhpLCB5aSwgdmFsdWUpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgZGF0YVt4aV1beWldID0gdmFsdWU7IC8vIEludmFsaWRhdGUgY2FjaGUKCiAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGZhbHNlKTsKCiAgICAgIGlmICh4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwICYmIHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpIC0gMSwgdHJ1ZSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heC9taW4gaW4gYSByZWN0YW5nbGUgaW4gdGhlIG1hdHJpeCBkYXRhCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFuIGFycmF5IHRvIHN0b3JlIHRoZSByZXN1bHRzIGluLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IGFycmF5LCBpZiBpdCB3YXMgcGFzc2VkIGluLiBNaW5pbXVtIHdpbGwgYmUgYXQgcG9zaXRpb24gMCBhbmQgbWF4IGF0IDEuCiAgICAgKi8KCgogICAgZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgcmVzdWx0ID0gW10pIHsKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIHsKICAgICAgbG93ZXJCb3VuZCwKICAgICAgdXBwZXJCb3VuZAogICAgfSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHhpICsgIl8iICsgeWkgKyAiXyIgKyAoZ2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwKTsKICAgIH0KCiAgICBnZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQoKICAgIHNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgY29udmV4LCBvZmZzZXQpIHsKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV0gPSB7CiAgICAgICAgY29udmV4LAogICAgICAgIG9mZnNldAogICAgICB9OwogICAgfQoKICAgIGNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgZnJvbSB0aGUgaGVpZ2h0ZmllbGQKICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmICh1cHBlcikgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgICAgICBiLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgICBjLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCh4aSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0pOwogICAgICAgIGIuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICAgIGMuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGluIHRoZSB0ZXJyYWluIGluIHRoZSBmb3JtIG9mIGEgdHJpYW5ndWxhciBjb252ZXggc2hhcGUuCiAgICAgKi8KCgogICAgZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGxldCByZXN1bHQgPSB0aGlzLnBpbGxhckNvbnZleDsKICAgICAgbGV0IG9mZnNldFJlc3VsdCA9IHRoaXMucGlsbGFyT2Zmc2V0OwoKICAgICAgaWYgKHRoaXMuY2FjaGVFbmFibGVkKSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKTsKCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gZGF0YS5jb252ZXg7CiAgICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IGRhdGEub2Zmc2V0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0ID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgICAgICBvZmZzZXRSZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gcmVzdWx0OwogICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gb2Zmc2V0UmVzdWx0OwogICAgICB9CgogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IGZhY2VzID0gcmVzdWx0LmZhY2VzOyAvLyBSZXVzZSB2ZXJ0cyBpZiBwb3NzaWJsZQoKICAgICAgcmVzdWx0LnZlcnRpY2VzLmxlbmd0aCA9IDY7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGlmICghcmVzdWx0LnZlcnRpY2VzW2ldKSB7CiAgICAgICAgICByZXN1bHQudmVydGljZXNbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KICAgICAgfSAvLyBSZXVzZSBmYWNlcyBpZiBwb3NzaWJsZQoKCiAgICAgIGZhY2VzLmxlbmd0aCA9IDU7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIGlmICghZmFjZXNbaV0pIHsKICAgICAgICAgIGZhY2VzW2ldID0gW107CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB2ZXJ0cyA9IHJlc3VsdC52ZXJ0aWNlczsKICAgICAgY29uc3QgaCA9IChNYXRoLm1pbihkYXRhW3hpXVt5aV0sIGRhdGFbeGkgKyAxXVt5aV0sIGRhdGFbeGldW3lpICsgMV0sIGRhdGFbeGkgKyAxXVt5aSArIDFdKSAtIHRoaXMubWluVmFsdWUpIC8gMiArIHRoaXMubWluVmFsdWU7CgogICAgICBpZiAoIWdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuMjUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gdG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vIC14IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMDsKICAgICAgICBmYWNlc1syXVsxXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMl0gPSA1OwogICAgICAgIGZhY2VzWzJdWzNdID0gMzsgLy8gLXkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAxOwogICAgICAgIGZhY2VzWzNdWzFdID0gMDsKICAgICAgICBmYWNlc1szXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbM11bM10gPSA0OyAvLyAreHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSA0OwogICAgICAgIGZhY2VzWzRdWzFdID0gNTsKICAgICAgICBmYWNlc1s0XVsyXSA9IDI7CiAgICAgICAgZmFjZXNbNF1bM10gPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuNzUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gVG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vICt4IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMjsKICAgICAgICBmYWNlc1syXVsxXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bMl0gPSAzOwogICAgICAgIGZhY2VzWzJdWzNdID0gMDsgLy8gK3kgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAzOwogICAgICAgIGZhY2VzWzNdWzFdID0gNDsKICAgICAgICBmYWNlc1szXVsyXSA9IDE7CiAgICAgICAgZmFjZXNbM11bM10gPSAwOyAvLyAteHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSAxOwogICAgICAgIGZhY2VzWzRdWzFdID0gNDsKICAgICAgICBmYWNlc1s0XVsyXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bM10gPSAyOwogICAgICB9CgogICAgICByZXN1bHQuY29tcHV0ZU5vcm1hbHMoKTsKICAgICAgcmVzdWx0LmNvbXB1dGVFZGdlcygpOwogICAgICByZXN1bHQudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy5zZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIHJlc3VsdCwgb2Zmc2V0UmVzdWx0KTsKICAgIH0KCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0ID0gbmV3IFZlYzMoKSkgewogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KCiAgY29uc3QgZ2V0SGVpZ2h0QXRfaWR4ID0gW107CiAgY29uc3QgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UxID0gbmV3IFZlYzMoKTsgLy8gZnJvbSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXJ5Y2VudHJpY19jb29yZGluYXRlX3N5c3RlbQoKICBmdW5jdGlvbiBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcmVzdWx0KSB7CiAgICByZXN1bHQueCA9ICgoYnkgLSBjeSkgKiAoeCAtIGN4KSArIChjeCAtIGJ4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnkgPSAoKGN5IC0gYXkpICogKHggLSBjeCkgKyAoYXggLSBjeCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC56ID0gMSAtIHJlc3VsdC54IC0gcmVzdWx0Lnk7CiAgfQogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KCgogIGNsYXNzIE9jdHJlZU5vZGUgewogICAgLyoqIFRoZSByb290IG5vZGUgKi8KCiAgICAvKiogQm91bmRhcnkgb2YgdGhpcyBub2RlICovCgogICAgLyoqIENvbnRhaW5lZCBkYXRhIGF0IHRoZSBjdXJyZW50IG5vZGUgbGV2ZWwgKi8KCiAgICAvKiogQ2hpbGRyZW4gdG8gdGhpcyBub2RlICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgdGhpcy5yb290ID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGF0YSA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGlsZHJlbiA9IHZvaWQgMDsKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsID0gMCkgewogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMgPSB7fSkgewogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdm9pZCAwOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KCiAgY29uc3QgaGFsZkRpYWdvbmFsID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBBQUJCID0gbmV3IEFBQkIoKTsKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwoKICBjbGFzcyBUcmltZXNoIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiB2ZXJ0aWNlcwogICAgICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VycywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIHRyaWFuZ2xlIGNvbnNpc3RzIG9mLiBUaGUgbGVuZ3RoIG9mIHRoaXMgYXJyYXkgaXMgdGh1cyAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdHJpYW5nbGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbm9ybWFscyBkYXRhLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbG9jYWwgQUFCQiBvZiB0aGUgbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlcyB0byB2ZXJ0ZXggcGFpcnMsIG1ha2luZyB1cCBhbGwgdW5pcXVlIGVkZ2VzIGluIHRoZSB0cmltZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBzY2FsaW5nIG9mIHRoZSBtZXNoLiBVc2UgLnNldFNjYWxlKCkgdG8gc2V0IGl0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXhlZCB0cmlhbmdsZXMuIFVzZSAudXBkYXRlVHJlZSgpIHRvIHVwZGF0ZSBpdC4KICAgICAqLwogICAgY29uc3RydWN0b3IodmVydGljZXMsIGluZGljZXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlRSSU1FU0gKICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5kaWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5ub3JtYWxzID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZWRnZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2NhbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMudHJlZSA9IHZvaWQgMDsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBhICsgIl8iICsgYiA6IGIgKyAiXyIgKyBhOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cyA9IDEsIHR1YmUgPSAwLjUsIHJhZGlhbFNlZ21lbnRzID0gOCwgdHVidWxhclNlZ21lbnRzID0gNiwgYXJjID0gTWF0aC5QSSAqIDIpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSBbXTsKICAgICAgY29uc3QgaW5kaWNlcyA9IFtdOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCB1ID0gaSAvIHR1YnVsYXJTZWdtZW50cyAqIGFyYzsKICAgICAgICAgIGNvbnN0IHYgPSBqIC8gcmFkaWFsU2VnbWVudHMgKiBNYXRoLlBJICogMjsKICAgICAgICAgIGNvbnN0IHggPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguY29zKHUpOwogICAgICAgICAgY29uc3QgeSA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5zaW4odSk7CiAgICAgICAgICBjb25zdCB6ID0gdHViZSAqIE1hdGguc2luKHYpOwogICAgICAgICAgdmVydGljZXMucHVzaCh4LCB5LCB6KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGogPSAxOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgYSA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGIgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBjID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGk7CiAgICAgICAgICBjb25zdCBkID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGk7CiAgICAgICAgICBpbmRpY2VzLnB1c2goYSwgYiwgZCk7CiAgICAgICAgICBpbmRpY2VzLnB1c2goYiwgYywgZCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbmV3IFRyaW1lc2godmVydGljZXMsIGluZGljZXMpOwogICAgfQoKICB9CgogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBzb2x2ZXIgYmFzZSBjbGFzcy4KICAgKi8KCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcyEKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdAogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgcmV0dXJuICgvLyBTaG91bGQgcmV0dXJuIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBkb25lIQogICAgICAgIDAKICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgYWRkRXF1YXRpb24oZXEpIHsKICAgICAgaWYgKGVxLmVuYWJsZWQgJiYgIWVxLmJpLmlzVHJpZ2dlciAmJiAhZXEuYmouaXNUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgcmVtb3ZlRXF1YXRpb24oZXEpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IGkgPSBlcXMuaW5kZXhPZihlcSk7CgogICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICBlcXMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbGwgZXF1YXRpb25zCiAgICAgKi8KCgogICAgcmVtb3ZlQWxsRXF1YXRpb25zKCkgewogICAgICB0aGlzLmVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgfQoKICB9CiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KCgogIGNsYXNzIEdTU29sdmVyIGV4dGVuZHMgU29sdmVyIHsKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBzb2x2ZXIgaXRlcmF0aW9ucyBkZXRlcm1pbmVzIHF1YWxpdHkgb2YgdGhlIGNvbnN0cmFpbnRzIGluIHRoZSB3b3JsZC4KICAgICAqIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLml0ZXJhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gdm9pZCAwOwogICAgICB0aGlzLml0ZXJhdGlvbnMgPSAxMDsKICAgICAgdGhpcy50b2xlcmFuY2UgPSAxZS03OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZQogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgbGV0IGl0ZXIgPSAwOwogICAgICBjb25zdCBtYXhJdGVyID0gdGhpcy5pdGVyYXRpb25zOwogICAgICBjb25zdCB0b2xTcXVhcmVkID0gdGhpcy50b2xlcmFuY2UgKiB0aGlzLnRvbGVyYW5jZTsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgTmJvZGllcyA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGggPSBkdDsKICAgICAgbGV0IEI7CiAgICAgIGxldCBpbnZDOwogICAgICBsZXQgZGVsdGFsYW1iZGE7CiAgICAgIGxldCBkZWx0YWxhbWJkYVRvdDsKICAgICAgbGV0IEdXbGFtYmRhOwogICAgICBsZXQgbGFtYmRhajsgLy8gVXBkYXRlIHNvbHZlIG1hc3MKCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0udXBkYXRlU29sdmVNYXNzUHJvcGVydGllcygpOwogICAgICAgIH0KICAgICAgfSAvLyBUaGluZ3MgdGhhdCBkbyBub3QgY2hhbmdlIGR1cmluZyBpdGVyYXRpb24gY2FuIGJlIGNvbXB1dGVkIG9uY2UKCgogICAgICBjb25zdCBpbnZDcyA9IEdTU29sdmVyX3NvbHZlX2ludkNzOwogICAgICBjb25zdCBCcyA9IEdTU29sdmVyX3NvbHZlX0JzOwogICAgICBjb25zdCBsYW1iZGEgPSBHU1NvbHZlcl9zb2x2ZV9sYW1iZGE7CiAgICAgIGludkNzLmxlbmd0aCA9IE5lcTsKICAgICAgQnMubGVuZ3RoID0gTmVxOwogICAgICBsYW1iZGEubGVuZ3RoID0gTmVxOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcTsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tpXTsKICAgICAgICBsYW1iZGFbaV0gPSAwLjA7CiAgICAgICAgQnNbaV0gPSBjLmNvbXB1dGVCKGgpOwogICAgICAgIGludkNzW2ldID0gMS4wIC8gYy5jb21wdXRlQygpOwogICAgICB9CgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgLy8gUmVzZXQgdmxhbWJkYQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgICBjb25zdCB2bGFtYmRhID0gYi52bGFtYmRhOwogICAgICAgICAgY29uc3Qgd2xhbWJkYSA9IGIud2xhbWJkYTsKICAgICAgICAgIHZsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgICAgd2xhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgfSAvLyBJdGVyYXRlIG92ZXIgZXF1YXRpb25zCgoKICAgICAgICBmb3IgKGl0ZXIgPSAwOyBpdGVyICE9PSBtYXhJdGVyOyBpdGVyKyspIHsKICAgICAgICAgIC8vIEFjY3VtdWxhdGUgdGhlIHRvdGFsIGVycm9yIGZvciBlYWNoIGl0ZXJhdGlvbi4KICAgICAgICAgIGRlbHRhbGFtYmRhVG90ID0gMC4wOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2pdOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgICAgICAgQiA9IEJzW2pdOwogICAgICAgICAgICBpbnZDID0gaW52Q3Nbal07CiAgICAgICAgICAgIGxhbWJkYWogPSBsYW1iZGFbal07CiAgICAgICAgICAgIEdXbGFtYmRhID0gYy5jb21wdXRlR1dsYW1iZGEoKTsKICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBpbnZDICogKEIgLSBHV2xhbWJkYSAtIGMuZXBzICogbGFtYmRhaik7IC8vIENsYW1wIGlmIHdlIGFyZSBub3Qgd2l0aGluIHRoZSBtaW4vbWF4IGludGVydmFsCgogICAgICAgICAgICBpZiAobGFtYmRhaiArIGRlbHRhbGFtYmRhIDwgYy5taW5Gb3JjZSkgewogICAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gYy5taW5Gb3JjZSAtIGxhbWJkYWo7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobGFtYmRhaiArIGRlbHRhbGFtYmRhID4gYy5tYXhGb3JjZSkgewogICAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gYy5tYXhGb3JjZSAtIGxhbWJkYWo7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxhbWJkYVtqXSArPSBkZWx0YWxhbWJkYTsKICAgICAgICAgICAgZGVsdGFsYW1iZGFUb3QgKz0gZGVsdGFsYW1iZGEgPiAwLjAgPyBkZWx0YWxhbWJkYSA6IC1kZWx0YWxhbWJkYTsgLy8gYWJzKGRlbHRhbGFtYmRhKQoKICAgICAgICAgICAgYy5hZGRUb1dsYW1iZGEoZGVsdGFsYW1iZGEpOwogICAgICAgICAgfSAvLyBJZiB0aGUgdG90YWwgZXJyb3IgaXMgc21hbGwgZW5vdWdoIC0gc3RvcCBpdGVyYXRlCgoKICAgICAgICAgIGlmIChkZWx0YWxhbWJkYVRvdCAqIGRlbHRhbGFtYmRhVG90IDwgdG9sU3F1YXJlZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IC8vIEFkZCByZXN1bHQgdG8gdmVsb2NpdHkKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgICBjb25zdCB2ID0gYi52ZWxvY2l0eTsKICAgICAgICAgIGNvbnN0IHcgPSBiLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgICAgIGIudmxhbWJkYS52bXVsKGIubGluZWFyRmFjdG9yLCBiLnZsYW1iZGEpOwogICAgICAgICAgdi52YWRkKGIudmxhbWJkYSwgdik7CiAgICAgICAgICBiLndsYW1iZGEudm11bChiLmFuZ3VsYXJGYWN0b3IsIGIud2xhbWJkYSk7CiAgICAgICAgICB3LnZhZGQoYi53bGFtYmRhLCB3KTsKICAgICAgICB9IC8vIFNldCB0aGUgYC5tdWx0aXBsaWVyYCBwcm9wZXJ0eSBvZiBlYWNoIGVxdWF0aW9uCgoKICAgICAgICBsZXQgbCA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgICAgY29uc3QgaW52RHQgPSAxIC8gaDsKCiAgICAgICAgd2hpbGUgKGwtLSkgewogICAgICAgICAgZXF1YXRpb25zW2xdLm11bHRpcGxpZXIgPSBsYW1iZGFbbF0gKiBpbnZEdDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBpdGVyOwogICAgfQoKICB9IC8vIEp1c3QgdGVtcG9yYXJ5IG51bWJlciBob2xkZXJzIHRoYXQgd2Ugd2FudCB0byByZXVzZSBlYWNoIGl0ZXJhdGlvbi4KCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKICAvKioKICAgKiBTcGxpdHMgdGhlIGVxdWF0aW9ucyBpbnRvIGlzbGFuZHMgYW5kIHNvbHZlcyB0aGVtIGluZGVwZW5kZW50bHkuIENhbiBpbXByb3ZlIHBlcmZvcm1hbmNlLgogICAqLwoKICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMubm9kZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMubm9kZVBvb2wgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICAgIHRoaXMuc3Vic29sdmVyID0gc3Vic29sdmVyOwogICAgICB0aGlzLm5vZGVzID0gW107CiAgICAgIHRoaXMubm9kZVBvb2wgPSBbXTsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlICh0aGlzLm5vZGVQb29sLmxlbmd0aCA8IDEyOCkgewogICAgICAgIHRoaXMubm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY3JlYXRlTm9kZQogICAgICovCgoKICAgIGNyZWF0ZU5vZGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYm9keTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgZXFzOiBbXSwKICAgICAgICB2aXNpdGVkOiBmYWxzZQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSB0aGUgc3Vic3lzdGVtcwogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgY29uc3Qgbm9kZXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlczsKICAgICAgY29uc3Qgbm9kZVBvb2wgPSB0aGlzLm5vZGVQb29sOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3Qgc3Vic29sdmVyID0gdGhpcy5zdWJzb2x2ZXI7IC8vIENyZWF0ZSBuZWVkZWQgbm9kZXMsIHJldXNlIGlmIHBvc3NpYmxlCgogICAgICB3aGlsZSAobm9kZVBvb2wubGVuZ3RoIDwgTmJvZGllcykgewogICAgICAgIG5vZGVQb29sLnB1c2godGhpcy5jcmVhdGVOb2RlKCkpOwogICAgICB9CgogICAgICBub2Rlcy5sZW5ndGggPSBOYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOYm9kaWVzOyBpKyspIHsKICAgICAgICBub2Rlc1tpXSA9IG5vZGVQb29sW2ldOwogICAgICB9IC8vIFJlc2V0IG5vZGUgdmFsdWVzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICBub2RlLmJvZHkgPSBib2RpZXNbaV07CiAgICAgICAgbm9kZS5jaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIG5vZGUuZXFzLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOZXE7IGsrKykgewogICAgICAgIGNvbnN0IGVxID0gZXF1YXRpb25zW2tdOwogICAgICAgIGNvbnN0IGkgPSBib2RpZXMuaW5kZXhPZihlcS5iaSk7CiAgICAgICAgY29uc3QgaiA9IGJvZGllcy5pbmRleE9mKGVxLmJqKTsKICAgICAgICBjb25zdCBuaSA9IG5vZGVzW2ldOwogICAgICAgIGNvbnN0IG5qID0gbm9kZXNbal07CiAgICAgICAgbmkuY2hpbGRyZW4ucHVzaChuaik7CiAgICAgICAgbmkuZXFzLnB1c2goZXEpOwogICAgICAgIG5qLmNoaWxkcmVuLnB1c2gobmkpOwogICAgICAgIG5qLmVxcy5wdXNoKGVxKTsKICAgICAgfQoKICAgICAgbGV0IGNoaWxkOwogICAgICBsZXQgbiA9IDA7CiAgICAgIGxldCBlcXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9lcXM7CiAgICAgIHN1YnNvbHZlci50b2xlcmFuY2UgPSB0aGlzLnRvbGVyYW5jZTsKICAgICAgc3Vic29sdmVyLml0ZXJhdGlvbnMgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IGR1bW15V29ybGQgPSBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlcykpIHsKICAgICAgICBlcXMubGVuZ3RoID0gMDsKICAgICAgICBkdW1teVdvcmxkLmJvZGllcy5sZW5ndGggPSAwOwogICAgICAgIGJmcyhjaGlsZCwgdmlzaXRGdW5jLCBkdW1teVdvcmxkLmJvZGllcywgZXFzKTsKICAgICAgICBjb25zdCBOZXFzID0gZXFzLmxlbmd0aDsKICAgICAgICBlcXMgPSBlcXMuc29ydChzb3J0QnlJZCk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgICAgIHN1YnNvbHZlci5hZGRFcXVhdGlvbihlcXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgc3Vic29sdmVyLnNvbHZlKGR0LCBkdW1teVdvcmxkKTsKICAgICAgICBzdWJzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7CiAgICAgICAgbisrOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KCiAgfSAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3Vic3lzdGVtcwoKCiAgY29uc3QgU3BsaXRTb2x2ZXJfc29sdmVfbm9kZXMgPSBbXTsgLy8gQWxsIGFsbG9jYXRlZCBub2RlIG9iamVjdHMKCiAgY29uc3QgU3BsaXRTb2x2ZXJfc29sdmVfZXFzID0gW107IC8vIFRlbXAgYXJyYXkKCiAgY29uc3QgU3BsaXRTb2x2ZXJfc29sdmVfZHVtbXlXb3JsZCA9IHsKICAgIGJvZGllczogW10KICB9OyAvLyBUZW1wIG9iamVjdAoKICBjb25zdCBTVEFUSUMgPSBCb2R5LlNUQVRJQzsKCiAgZnVuY3Rpb24gZ2V0VW52aXNpdGVkTm9kZShub2RlcykgewogICAgY29uc3QgTm5vZGVzID0gbm9kZXMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBObm9kZXM7IGkrKykgewogICAgICBjb25zdCBub2RlID0gbm9kZXNbaV07CgogICAgICBpZiAoIW5vZGUudmlzaXRlZCAmJiAhKG5vZGUuYm9keS50eXBlICYgU1RBVElDKSkgewogICAgICAgIHJldHVybiBub2RlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgY29uc3QgcXVldWUgPSBbXTsKCiAgZnVuY3Rpb24gYmZzKHJvb3QsIHZpc2l0RnVuYywgYmRzLCBlcXMpIHsKICAgIHF1ZXVlLnB1c2gocm9vdCk7CiAgICByb290LnZpc2l0ZWQgPSB0cnVlOwogICAgdmlzaXRGdW5jKHJvb3QsIGJkcywgZXFzKTsKCiAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBxdWV1ZS5wb3AoKTsgLy8gTG9vcCBvdmVyIHVudmlzaXRlZCBjaGlsZCBub2RlcwoKICAgICAgbGV0IGNoaWxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlLmNoaWxkcmVuKSkgewogICAgICAgIGNoaWxkLnZpc2l0ZWQgPSB0cnVlOwogICAgICAgIHZpc2l0RnVuYyhjaGlsZCwgYmRzLCBlcXMpOwogICAgICAgIHF1ZXVlLnB1c2goY2hpbGQpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiB2aXNpdEZ1bmMobm9kZSwgYmRzLCBlcXMpIHsKICAgIGJkcy5wdXNoKG5vZGUuYm9keSk7CiAgICBjb25zdCBOZXFzID0gbm9kZS5lcXMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgY29uc3QgZXEgPSBub2RlLmVxc1tpXTsKCiAgICAgIGlmICghZXFzLmluY2x1ZGVzKGVxKSkgewogICAgICAgIGVxcy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gc29ydEJ5SWQoYSwgYikgewogICAgcmV0dXJuIGIuaWQgLSBhLmlkOwogIH0KICAvKioKICAgKiBGb3IgcG9vbGluZyBvYmplY3RzIHRoYXQgY2FuIGJlIHJldXNlZC4KICAgKi8KCgogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CiAgICAvKioKICAgICAqIFJlbGVhc2UgYW4gb2JqZWN0IGFmdGVyIHVzZQogICAgICovCgoKICAgIHJlbGVhc2UoLi4uYXJncykgewogICAgICBjb25zdCBOYXJncyA9IGFyZ3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChhcmdzW2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBvYmplY3QKICAgICAqLwoKCiAgICBnZXQoKSB7CiAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0T2JqZWN0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5wb3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYW4gb2JqZWN0LiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZWFjaCBzdWJjbGFzcy4KICAgICAqLwoKCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29uc3RydWN0T2JqZWN0KCkgbm90IGltcGxlbWVudGVkIGluIHRoaXMgUG9vbCBzdWJjbGFzcyB5ZXQhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gU2VsZiwgZm9yIGNoYWluaW5nCiAgICAgKi8KCgogICAgcmVzaXplKHNpemUpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMub2JqZWN0czsKCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA+IHNpemUpIHsKICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICB9CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wdXNoKHRoaXMuY29uc3RydWN0T2JqZWN0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgoKICBjbGFzcyBWZWMzUG9vbCBleHRlbmRzIFBvb2wgewogICAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgICBzdXBlciguLi5hcmdzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3RydWN0IGEgdmVjdG9yCiAgICAgKi8KCgogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICBsZXQgX0NPTExJU0lPTl9UWVBFUyRzcGhlLCBfQ09MTElTSU9OX1RZUEVTJHNwaGUyLCBfQ09MTElTSU9OX1RZUEVTJGJveEIsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMsIF9DT0xMSVNJT05fVFlQRVMkcGxhbiwgX0NPTExJU0lPTl9UWVBFUyRjb252LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU0LCBfQ09MTElTSU9OX1RZUEVTJHBsYW4yLCBfQ09MTElTSU9OX1RZUEVTJGJveEMsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTUsIF9DT0xMSVNJT05fVFlQRVMkYm94SCwgX0NPTExJU0lPTl9UWVBFUyRjb252MiwgX0NPTExJU0lPTl9UWVBFUyRzcGhlNiwgX0NPTExJU0lPTl9UWVBFUyRwbGFuMywgX0NPTExJU0lPTl9UWVBFUyRib3hQLCBfQ09MTElTSU9OX1RZUEVTJGNvbnYzLCBfQ09MTElTSU9OX1RZUEVTJGN5bGksIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcsIF9DT0xMSVNJT05fVFlQRVMkcGxhbjQsIF9DT0xMSVNJT05fVFlQRVMkYm94QzIsIF9DT0xMSVNJT05fVFlQRVMkY29udjQsIF9DT0xMSVNJT05fVFlQRVMkaGVpZywgX0NPTExJU0lPTl9UWVBFUyRwYXJ0LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU4LCBfQ09MTElTSU9OX1RZUEVTJHBsYW41OyAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKCgogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZSA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmU7CiAgX0NPTExJU0lPTl9UWVBFUyRzcGhlMiA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZTsKICBfQ09MTElTSU9OX1RZUEVTJGJveEIgPSBDT0xMSVNJT05fVFlQRVMuYm94Qm94OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbiA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUJveDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYgPSBDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTQgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjIgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVDb252ZXg7CiAgX0NPTExJU0lPTl9UWVBFUyRib3hDID0gQ09MTElTSU9OX1RZUEVTLmJveENvbnZleDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU1ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkYm94SCA9IENPTExJU0lPTl9UWVBFUy5ib3hIZWlnaHRmaWVsZDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYyID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleEhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTYgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGFydGljbGU7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuMyA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkYm94UCA9IENPTExJU0lPTl9UWVBFUy5ib3hQYXJ0aWNsZTsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYzID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleFBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkY3lsaSA9IENPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNCA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkYm94QzIgPSBDT0xMSVNJT05fVFlQRVMuYm94Q3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252NCA9IENPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJGhlaWcgPSBDT0xMSVNJT05fVFlQRVMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHBhcnQgPSBDT0xMSVNJT05fVFlQRVMucGFydGljbGVDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU4ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2g7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNSA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2g7CiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwoKICBjbGFzcyBOYXJyb3dwaGFzZSB7CiAgICAvKioKICAgICAqIEludGVybmFsIHN0b3JhZ2Ugb2YgcG9vbGVkIGNvbnRhY3QgcG9pbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBQb29sZWQgdmVjdG9ycy4KICAgICAqLwogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGxhbmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGJveEJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUzXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnZdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuMl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hDXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlNV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hIXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnYyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU2XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBsYW4zXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94UF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252M10oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjeWxpXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlN10oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjRdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94QzJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnY0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRoZWlnXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGFydF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBhcnRpY2xlQ3lsaW5kZXI7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMudjNwb29sID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICBjb25zdCBtdWcgPSBmcmljdGlvbiAqIHdvcmxkLmdyYXZpdHkubGVuZ3RoKCk7CiAgICAgICAgbGV0IHJlZHVjZWRNYXNzID0gYm9keUEuaW52TWFzcyArIGJvZHlCLmludk1hc3M7CgogICAgICAgIGlmIChyZWR1Y2VkTWFzcyA+IDApIHsKICAgICAgICAgIHJlZHVjZWRNYXNzID0gMSAvIHJlZHVjZWRNYXNzOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcG9vbCA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGMxLmJpID0gYzIuYmkgPSBib2R5QTsKICAgICAgICBjMS5iaiA9IGMyLmJqID0gYm9keUI7CiAgICAgICAgYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcgKiByZWR1Y2VkTWFzczsKICAgICAgICBjMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnICogcmVkdWNlZE1hc3M7IC8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwoKICAgICAgICBjMS5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzEucmouY29weShjb250YWN0RXF1YXRpb24ucmopOwogICAgICAgIGMyLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMi5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7IC8vIENvbnN0cnVjdCB0YW5nZW50cwoKICAgICAgICBjb250YWN0RXF1YXRpb24ubmkudGFuZ2VudHMoYzEudCwgYzIudCk7IC8vIFNldCBzcG9vayBwYXJhbXMKCiAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gY29udGFjdEVxdWF0aW9uLmVuYWJsZWQ7CiAgICAgICAgb3V0QXJyYXkucHVzaChjMSwgYzIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRha2UgdGhlIGF2ZXJhZ2UgTiBsYXRlc3QgY29udGFjdCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAgKi8KCgogICAgY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cykgewogICAgICAvLyBUaGUgbGFzdCBjb250YWN0RXF1YXRpb24KICAgICAgbGV0IGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxXTsgLy8gQ3JlYXRlIHRoZSByZXN1bHQ6IHR3byAiYXZlcmFnZSIgZnJpY3Rpb24gZXF1YXRpb25zCgogICAgICBpZiAoIXRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjLCB0aGlzLmZyaWN0aW9uUmVzdWx0KSB8fCBudW1Db250YWN0cyA9PT0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZjEgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMl07CiAgICAgIGNvbnN0IGYyID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICBhdmVyYWdlTm9ybWFsLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zZXRaZXJvKCk7CiAgICAgIGNvbnN0IGJvZHlBID0gYy5iaTsKICAgICAgYy5iajsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBudW1Db250YWN0czsgaSsrKSB7CiAgICAgICAgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDEgLSBpXTsKCiAgICAgICAgaWYgKGMuYmkgIT09IGJvZHlBKSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZhZGQoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZzdWIoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgaW52TnVtQ29udGFjdHMgPSAxIC8gbnVtQ29udGFjdHM7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaSk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaik7CiAgICAgIGYyLnJpLmNvcHkoZjEucmkpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUKCiAgICAgIGYyLnJqLmNvcHkoZjEucmopOwogICAgICBhdmVyYWdlTm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBhdmVyYWdlTm9ybWFsLnRhbmdlbnRzKGYxLnQsIGYyLnQpOyAvLyByZXR1cm4gZXE7CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFsbCBjb250YWN0cyBiZXR3ZWVuIGEgbGlzdCBvZiBib2R5IHBhaXJzCiAgICAgKiBAcGFyYW0gcDEgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcDIgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFycmF5IHRvIHN0b3JlIGdlbmVyYXRlZCBjb250YWN0cwogICAgICogQHBhcmFtIG9sZGNvbnRhY3RzIE9wdGlvbmFsLiBBcnJheSBvZiByZXVzYWJsZSBjb250YWN0IG9iamVjdHMKICAgICAqLwoKCiAgICBnZXRDb250YWN0cyhwMSwgcDIsIHdvcmxkLCByZXN1bHQsIG9sZGNvbnRhY3RzLCBmcmljdGlvblJlc3VsdCwgZnJpY3Rpb25Qb29sKSB7CiAgICAgIC8vIFNhdmUgb2xkIGNvbnRhY3Qgb2JqZWN0cwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBvbGRjb250YWN0czsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IGZyaWN0aW9uUG9vbDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBmcmljdGlvblJlc3VsdDsKICAgICAgY29uc3QgcWkgPSB0bXBRdWF0MTsKICAgICAgY29uc3QgcWogPSB0bXBRdWF0MjsKICAgICAgY29uc3QgeGkgPSB0bXBWZWMxOwogICAgICBjb25zdCB4aiA9IHRtcFZlYzI7CgogICAgICBmb3IgKGxldCBrID0gMCwgTiA9IHAxLmxlbmd0aDsgayAhPT0gTjsgaysrKSB7CiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGJvZGllcwogICAgICAgIGNvbnN0IGJpID0gcDFba107CiAgICAgICAgY29uc3QgYmogPSBwMltrXTsgLy8gR2V0IGNvbnRhY3QgbWF0ZXJpYWwKCiAgICAgICAgbGV0IGJvZHlDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGJvZHlDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganVzdFRlc3QgPSBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuU1RBVElDIHx8IGJpLnR5cGUgJiBCb2R5LlNUQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUMgfHwgYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQzsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaS5zaGFwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJpLnF1YXRlcm5pb24ubXVsdChiaS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgICAgYmkucXVhdGVybmlvbi52bXVsdChiaS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICAgIHhpLnZhZGQoYmkucG9zaXRpb24sIHhpKTsKICAgICAgICAgIGNvbnN0IHNpID0gYmkuc2hhcGVzW2ldOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmouc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIC8vIENvbXB1dGUgd29ybGQgdHJhbnNmb3JtIG9mIHNoYXBlcwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLm11bHQoYmouc2hhcGVPcmllbnRhdGlvbnNbal0sIHFqKTsKICAgICAgICAgICAgYmoucXVhdGVybmlvbi52bXVsdChiai5zaGFwZU9mZnNldHNbal0sIHhqKTsKICAgICAgICAgICAgeGoudmFkZChiai5wb3NpdGlvbiwgeGopOwogICAgICAgICAgICBjb25zdCBzaiA9IGJqLnNoYXBlc1tqXTsKCiAgICAgICAgICAgIGlmICghKHNpLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzai5jb2xsaXNpb25GaWx0ZXJHcm91cCAmJiBzai5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2kuY29sbGlzaW9uRmlsdGVyR3JvdXApKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSAvLyBHZXQgY29sbGlzaW9uIG1hdGVyaWFsCgoKICAgICAgICAgICAgbGV0IHNoYXBlQ29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChzaS5tYXRlcmlhbCAmJiBzai5tYXRlcmlhbCkgewogICAgICAgICAgICAgIHNoYXBlQ29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKHNpLm1hdGVyaWFsLCBzai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gc2hhcGVDb250YWN0TWF0ZXJpYWwgfHwgYm9keUNvbnRhY3RNYXRlcmlhbCB8fCB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOyAvLyBHZXQgY29udGFjdHMKCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVySW5kZXggPSBzaS50eXBlIHwgc2oudHlwZTsKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzW3Jlc29sdmVySW5kZXhdOwoKICAgICAgICAgICAgaWYgKHJlc29sdmVyKSB7CiAgICAgICAgICAgICAgbGV0IHJldHZhbCA9IGZhbHNlOyAvLyBUTyBETzogaW52ZXN0aWdhdGUgd2h5IHNwaGVyZVBhcnRpY2xlIGFuZCBjb252ZXhQYXJ0aWNsZQogICAgICAgICAgICAgIC8vIHJlc29sdmVycyBleHBlY3Qgc2kgYW5kIHNqIHNoYXBlcyB0byBiZSBpbiByZXZlcnNlIG9yZGVyCiAgICAgICAgICAgICAgLy8gKGkuZS4gbGFyZ2VyIGludGVnZXIgdmFsdWUgdHlwZSBmaXJzdCBpbnN0ZWFkIG9mIHNtYWxsZXIgZmlyc3QpCgogICAgICAgICAgICAgIGlmIChzaS50eXBlIDwgc2oudHlwZSkgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0dmFsICYmIGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciBvdmVybGFwCiAgICAgICAgICAgICAgICB3b3JsZC5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgICAgICAgICAgICB3b3JsZC5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVTcGhlcmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgcmV0dXJuIHhpLmRpc3RhbmNlU3F1YXJlZCh4aikgPCAoc2kucmFkaXVzICsgc2oucmFkaXVzKSAqKiAyOwogICAgICB9IC8vIFdlIHdpbGwgaGF2ZSBvbmx5IG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQoKCiAgICAgIGNvbnN0IGNvbnRhY3RFcSA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICB4ai52c3ViKHhpLCBjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEubmkubm9ybWFsaXplKCk7IC8vIENvbnRhY3QgcG9pbnQgbG9jYXRpb25zCgogICAgICBjb250YWN0RXEucmkuY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmouY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmkuc2NhbGUoc2kucmFkaXVzLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmouc2NhbGUoLXNqLnJhZGl1cywgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJpLnZhZGQoeGksIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yaS52c3ViKGJpLnBvc2l0aW9uLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmoudmFkZCh4aiwgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJqLnZzdWIoYmoucG9zaXRpb24sIGNvbnRhY3RFcS5yaik7CiAgICAgIHRoaXMucmVzdWx0LnB1c2goY29udGFjdEVxKTsKICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcSwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICB9CgogICAgc3BoZXJlUGxhbmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gV2Ugd2lsbCBoYXZlIG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQogICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHIubmkuc2V0KDAsIDAsIDEpOwogICAgICBxai52bXVsdChyLm5pLCByLm5pKTsKICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIGJvZHkgaSBpcyB0aGUgc3BoZXJlLCBmbGlwIG5vcm1hbAoKICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gTmVlZGVkPwogICAgICAvLyBWZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QgcG9pbnQKCiAgICAgIHIubmkuc2NhbGUoc2kucmFkaXVzLCByLnJpKTsgLy8gUHJvamVjdCBkb3duIHNwaGVyZSBvbiBwbGFuZQoKICAgICAgeGkudnN1Yih4aiwgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKTsKICAgICAgci5uaS5zY2FsZShyLm5pLmRvdChwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpLCBwbGFuZV90b19zcGhlcmVfb3J0aG8pOwogICAgICBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUudnN1YihwbGFuZV90b19zcGhlcmVfb3J0aG8sIHIucmopOyAvLyBUaGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byBwbGFuZQoKICAgICAgaWYgKC1wb2ludF9vbl9wbGFuZV90b19zcGhlcmUuZG90KHIubmkpIDw9IHNpLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgoKICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveEJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7IC8vIHdlIHJlZmVyIHRvIHRoZSBib3ggYXMgYm9keSBqCgogICAgICBjb25zdCBzaWRlcyA9IHNwaGVyZUJveF9zaWRlczsKICAgICAgeGkudnN1Yih4aiwgYm94X3RvX3NwaGVyZSk7CiAgICAgIHNqLmdldFNpZGVOb3JtYWxzKHNpZGVzLCBxaik7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBTdG9yZSB0aGUgcmVzdWx0aW5nIHNpZGUgcGVuZXRyYXRpb24gaW5mbwoKICAgICAgY29uc3Qgc2lkZV9ucyA9IHNwaGVyZUJveF9zaWRlX25zOwogICAgICBjb25zdCBzaWRlX25zMSA9IHNwaGVyZUJveF9zaWRlX25zMTsKICAgICAgY29uc3Qgc2lkZV9uczIgPSBzcGhlcmVCb3hfc2lkZV9uczI7CiAgICAgIGxldCBzaWRlX2ggPSBudWxsOwogICAgICBsZXQgc2lkZV9wZW5ldHJhdGlvbnMgPSAwOwogICAgICBsZXQgc2lkZV9kb3QxID0gMDsKICAgICAgbGV0IHNpZGVfZG90MiA9IDA7CiAgICAgIGxldCBzaWRlX2Rpc3RhbmNlID0gbnVsbDsKCiAgICAgIGZvciAobGV0IGlkeCA9IDAsIG5zaWRlcyA9IHNpZGVzLmxlbmd0aDsgaWR4ICE9PSBuc2lkZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpZHgrKykgewogICAgICAgIC8vIEdldCB0aGUgcGxhbmUgc2lkZSBub3JtYWwgKG5zKQogICAgICAgIGNvbnN0IG5zID0gc3BoZXJlQm94X25zOwogICAgICAgIG5zLmNvcHkoc2lkZXNbaWR4XSk7CiAgICAgICAgY29uc3QgaCA9IG5zLmxlbmd0aCgpOwogICAgICAgIG5zLm5vcm1hbGl6ZSgpOyAvLyBUaGUgbm9ybWFsL2Rpc3RhbmNlIGRvdCBwcm9kdWN0IHRlbGxzIHdoaWNoIHNpZGUgb2YgdGhlIHBsYW5lIHdlIGFyZQoKICAgICAgICBjb25zdCBkb3QgPSBib3hfdG9fc3BoZXJlLmRvdChucyk7CgogICAgICAgIGlmIChkb3QgPCBoICsgUiAmJiBkb3QgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgdGhlIG90aGVyIHR3byBkaW1lbnNpb25zCiAgICAgICAgICBjb25zdCBuczEgPSBzcGhlcmVCb3hfbnMxOwogICAgICAgICAgY29uc3QgbnMyID0gc3BoZXJlQm94X25zMjsKICAgICAgICAgIG5zMS5jb3B5KHNpZGVzWyhpZHggKyAxKSAlIDNdKTsKICAgICAgICAgIG5zMi5jb3B5KHNpZGVzWyhpZHggKyAyKSAlIDNdKTsKICAgICAgICAgIGNvbnN0IGgxID0gbnMxLmxlbmd0aCgpOwogICAgICAgICAgY29uc3QgaDIgPSBuczIubGVuZ3RoKCk7CiAgICAgICAgICBuczEubm9ybWFsaXplKCk7CiAgICAgICAgICBuczIubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCBkb3QxID0gYm94X3RvX3NwaGVyZS5kb3QobnMxKTsKICAgICAgICAgIGNvbnN0IGRvdDIgPSBib3hfdG9fc3BoZXJlLmRvdChuczIpOwoKICAgICAgICAgIGlmIChkb3QxIDwgaDEgJiYgZG90MSA+IC1oMSAmJiBkb3QyIDwgaDIgJiYgZG90MiA+IC1oMikgewogICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5hYnMoZG90IC0gaCAtIFIpOwoKICAgICAgICAgICAgaWYgKHNpZGVfZGlzdGFuY2UgPT09IG51bGwgfHwgZGlzdCA8IHNpZGVfZGlzdGFuY2UpIHsKICAgICAgICAgICAgICBzaWRlX2Rpc3RhbmNlID0gZGlzdDsKICAgICAgICAgICAgICBzaWRlX2RvdDEgPSBkb3QxOwogICAgICAgICAgICAgIHNpZGVfZG90MiA9IGRvdDI7CiAgICAgICAgICAgICAgc2lkZV9oID0gaDsKICAgICAgICAgICAgICBzaWRlX25zLmNvcHkobnMpOwogICAgICAgICAgICAgIHNpZGVfbnMxLmNvcHkobnMxKTsKICAgICAgICAgICAgICBzaWRlX25zMi5jb3B5KG5zMik7CiAgICAgICAgICAgICAgc2lkZV9wZW5ldHJhdGlvbnMrKzsKCiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzaWRlX3BlbmV0cmF0aW9ucykgewogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBzaWRlX25zLnNjYWxlKC1SLCByLnJpKTsgLy8gU3BoZXJlIHIKCiAgICAgICAgci5uaS5jb3B5KHNpZGVfbnMpOwogICAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgc2hvdWxkIGJlIG91dCBvZiBzcGhlcmUKCiAgICAgICAgc2lkZV9ucy5zY2FsZShzaWRlX2gsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMxLnNjYWxlKHNpZGVfZG90MSwgc2lkZV9uczEpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMSwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczIuc2NhbGUoc2lkZV9kb3QyLCBzaWRlX25zMik7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMyLCByLnJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfSAvLyBDaGVjayBjb3JuZXJzCgoKICAgICAgbGV0IHJqID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXI7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gMiAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSAyICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCAhPT0gMiAmJiAhZm91bmQ7IGwrKykgewogICAgICAgICAgICByai5zZXQoMCwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKCiAgICAgICAgICAgIHhqLnZhZGQocmosIHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICBzcGhlcmVfdG9fY29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgICAgIHIucmouY29weShyaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKHJqKTsKICAgICAgcmogPSBudWxsOyAvLyBDaGVjayBlZGdlcwoKICAgICAgY29uc3QgZWRnZVRhbmdlbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGVkZ2VDZW50ZXIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHIgPSB2M3Bvb2wuZ2V0KCk7IC8vIHIgPSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyCgogICAgICBjb25zdCBvcnRob2dvbmFsID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBkaXN0ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBOc2lkZXMgPSBzaWRlcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTnNpZGVzICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5zaWRlcyAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgaWYgKGogJSAzICE9PSBrICUgMykgewogICAgICAgICAgICAvLyBHZXQgZWRnZSB0YW5nZW50CiAgICAgICAgICAgIHNpZGVzW2tdLmNyb3NzKHNpZGVzW2pdLCBlZGdlVGFuZ2VudCk7CiAgICAgICAgICAgIGVkZ2VUYW5nZW50Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBzaWRlc1tqXS52YWRkKHNpZGVzW2tdLCBlZGdlQ2VudGVyKTsKICAgICAgICAgICAgci5jb3B5KHhpKTsKICAgICAgICAgICAgci52c3ViKGVkZ2VDZW50ZXIsIHIpOwogICAgICAgICAgICByLnZzdWIoeGosIHIpOwogICAgICAgICAgICBjb25zdCBvcnRob25vcm0gPSByLmRvdChlZGdlVGFuZ2VudCk7IC8vIGRpc3RhbmNlIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KCiAgICAgICAgICAgIGVkZ2VUYW5nZW50LnNjYWxlKG9ydGhvbm9ybSwgb3J0aG9nb25hbCk7IC8vIFZlY3RvciBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRoaXJkIHNpZGUgb3J0aG9nb25hbCB0byB0aGlzIG9uZQoKICAgICAgICAgICAgbGV0IGwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGwgPT09IGogJSAzIHx8IGwgPT09IGsgJSAzKSB7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICB9IC8vIHZlYyBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBwcm9qZWN0ZWQgdG8gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGVkZ2UgdGFuZ2VudAoKCiAgICAgICAgICAgIGRpc3QuY29weSh4aSk7CiAgICAgICAgICAgIGRpc3QudnN1YihvcnRob2dvbmFsLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKGVkZ2VDZW50ZXIsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoeGosIGRpc3QpOyAvLyBEaXN0YW5jZXMgaW4gdGFuZ2VudCBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGluIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIGl0CgogICAgICAgICAgICBjb25zdCB0ZGlzdCA9IE1hdGguYWJzKG9ydGhvbm9ybSk7CiAgICAgICAgICAgIGNvbnN0IG5kaXN0ID0gZGlzdC5sZW5ndGgoKTsKCiAgICAgICAgICAgIGlmICh0ZGlzdCA8IHNpZGVzW2xdLmxlbmd0aCgpICYmIG5kaXN0IDwgUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICBlZGdlQ2VudGVyLnZhZGQob3J0aG9nb25hbCwgcmVzLnJqKTsgLy8gYm94IHJqCgogICAgICAgICAgICAgIHJlcy5yai5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgZGlzdC5uZWdhdGUocmVzLm5pKTsKICAgICAgICAgICAgICByZXMubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1Yih4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLnNjYWxlKFIsIHJlcy5yaSk7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKGJpLnBvc2l0aW9uLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yai52YWRkKHhqLCByZXMucmopOwogICAgICAgICAgICAgIHJlcy5yai52c3ViKGJqLnBvc2l0aW9uLCByZXMucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocmVzKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QocmVzLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UoZWRnZVRhbmdlbnQsIGVkZ2VDZW50ZXIsIHIsIG9ydGhvZ29uYWwsIGRpc3QpOwogICAgfQoKICAgIHBsYW5lQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmlkID0gc2ouaWQ7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4KHNpLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCwgZmFjZUxpc3RBLCBmYWNlTGlzdEIpIHsKICAgICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwoKICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNpLmZpbmRTZXBhcmF0aW5nQXhpcyhzaiwgeGksIHFpLCB4aiwgcWosIHNlcEF4aXMsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGksIHFpLCBzaiwgeGosIHFqLCBzZXBBeGlzLCAtMTAwLCAxMDAsIHJlcyk7CiAgICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgICAgc2VwQXhpcy5uZWdhdGUoci5uaSk7CiAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgICAgICAgIHEuc2NhbGUocmVzW2pdLmRlcHRoLCBxKTsKICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQoKICAgICAgICAgIHJpLnZzdWIoeGksIHJpKTsKICAgICAgICAgIHJqLnZzdWIoeGosIHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlQ29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOwogICAgICB4aS52c3ViKHhqLCBjb252ZXhfdG9fc3BoZXJlKTsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNqLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBmYWNlcyA9IHNqLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0cyA9IHNqLnZlcnRpY2VzOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOyAvLyAgICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gQ2hlY2sgY29ybmVycwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCiAgICAgICAgY29uc3Qgd29ybGRDb3JuZXIgPSBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXI7CiAgICAgICAgcWoudm11bHQodiwgd29ybGRDb3JuZXIpOwogICAgICAgIHhqLnZhZGQod29ybGRDb3JuZXIsIHdvcmxkQ29ybmVyKTsKICAgICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyOwogICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICB3b3JsZENvcm5lci52c3ViKHhqLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBzaWRlIChwbGFuZSkgaW50ZXJzZWN0aW9ucwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBmYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGkrKykgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOyAvLyBHZXQgd29ybGQtdHJhbnNmb3JtZWQgbm9ybWFsIG9mIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsOwogICAgICAgIHFqLnZtdWx0KG5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBHZXQgYSB3b3JsZCB2ZXJ0ZXggZnJvbSB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZFBvaW50ID0gc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQ7CiAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVswXV0sIHdvcmxkUG9pbnQpOwogICAgICAgIHdvcmxkUG9pbnQudmFkZCh4aiwgd29ybGRQb2ludCk7IC8vIEdldCBhIHBvaW50IG9uIHRoZSBzcGhlcmUsIGNsb3Nlc3QgdG8gdGhlIGZhY2Ugbm9ybWFsCgogICAgICAgIGNvbnN0IHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmU7CiAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7CiAgICAgICAgeGkudmFkZCh3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7IC8vIFZlY3RvciBmcm9tIGEgZmFjZSBwb2ludCB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgc3BoZXJlCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjOwogICAgICAgIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZS52c3ViKHdvcmxkUG9pbnQsIHBlbmV0cmF0aW9uVmVjKTsgLy8gVGhlIHBlbmV0cmF0aW9uLiBOZWdhdGl2ZSB2YWx1ZSBtZWFucyBvdmVybGFwLgoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uVmVjLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3Qgd29ybGRQb2ludFRvU3BoZXJlID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludDsKICAgICAgICB4aS52c3ViKHdvcmxkUG9pbnQsIHdvcmxkUG9pbnRUb1NwaGVyZSk7CgogICAgICAgIGlmIChwZW5ldHJhdGlvbiA8IDAgJiYgd29ybGRQb2ludFRvU3BoZXJlLmRvdCh3b3JsZE5vcm1hbCkgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgaWYgdGhlIHNwaGVyZSBpcyBpbnNpZGUgdGhlIGZhY2UgcG9seWdvbgogICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gW107IC8vIEZhY2UgdmVydGljZXMsIGluIHdvcmxkIGNvb3JkcwoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOdmVydHMgPSBmYWNlLmxlbmd0aDsgaiAhPT0gTnZlcnRzOyBqKyspIHsKICAgICAgICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2Vbal1dLCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIHhqLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgZmFjZVZlcnRzLnB1c2god29ybGRWZXJ0ZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb2ludEluUG9seWdvbihmYWNlVmVydHMsIHdvcmxkTm9ybWFsLCB4aSkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlIHNwaGVyZSBjZW50ZXIgaW4gdGhlIGZhY2UgcG9seWdvbj8KICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCByLnJpKTsgLy8gQ29udGFjdCBvZmZzZXQsIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0CgogICAgICAgICAgICB3b3JsZE5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBwb2ludGluZyBvdXQgb2Ygc3BoZXJlCgogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYzIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1wZW5ldHJhdGlvbiwgcGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25TcGhlcmVQb2ludCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOyAvL3hpLnZzdWIoeGopLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCkudmFkZChwZW5ldHJhdGlvblZlYzIgLCByLnJqKTsKCiAgICAgICAgICAgIHhpLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblZlYzIsIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsgLy8gV2Ugb25seSBleHBlY3QgKm9uZSogZmFjZSBjb250YWN0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFZGdlPwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZmFjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIEdldCB0d28gd29ybGQgdHJhbnNmb3JtZWQgdmVydGljZXMKICAgICAgICAgICAgICBjb25zdCB2MSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMSkgJSBmYWNlLmxlbmd0aF1dLCB2MSk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDIpICUgZmFjZS5sZW5ndGhdXSwgdjIpOwogICAgICAgICAgICAgIHhqLnZhZGQodjEsIHYxKTsKICAgICAgICAgICAgICB4ai52YWRkKHYyLCB2Mik7IC8vIENvbnN0cnVjdCBlZGdlIHZlY3RvcgoKICAgICAgICAgICAgICBjb25zdCBlZGdlID0gc3BoZXJlQ29udmV4X2VkZ2U7CiAgICAgICAgICAgICAgdjIudnN1Yih2MSwgZWRnZSk7IC8vIENvbnN0cnVjdCB0aGUgc2FtZSB2ZWN0b3IsIGJ1dCBub3JtYWxpemVkCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2VVbml0ID0gc3BoZXJlQ29udmV4X2VkZ2VVbml0OwogICAgICAgICAgICAgIGVkZ2UudW5pdChlZGdlVW5pdCk7IC8vIHAgaXMgeGkgcHJvamVjdGVkIG9udG8gdGhlIGVkZ2UKCiAgICAgICAgICAgICAgY29uc3QgcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MV90b194aSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICB4aS52c3ViKHYxLCB2MV90b194aSk7CiAgICAgICAgICAgICAgY29uc3QgZG90ID0gdjFfdG9feGkuZG90KGVkZ2VVbml0KTsKICAgICAgICAgICAgICBlZGdlVW5pdC5zY2FsZShkb3QsIHApOwogICAgICAgICAgICAgIHAudmFkZCh2MSwgcCk7IC8vIENvbXB1dGUgYSB2ZWN0b3IgZnJvbSBwIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQoKICAgICAgICAgICAgICBjb25zdCB4aV90b19wID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHAudnN1Yih4aSwgeGlfdG9fcCk7IC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAvLyBBTkQgaWYgcCBpcyBpbiBiZXR3ZWVuIHYxIGFuZCB2MgoKICAgICAgICAgICAgICBpZiAoZG90ID4gMCAmJiBkb3QgKiBkb3QgPCBlZGdlLmxlbmd0aFNxdWFyZWQoKSAmJiB4aV90b19wLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgICAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgICAvLyBFZGdlIGNvbnRhY3QhCiAgICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICAgICAgcC52c3ViKHhpLCByLm5pKTsKICAgICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICByLm5pLnNjYWxlKFIsIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcGxhbmVDb252ZXgocGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHBsYW5lUG9zaXRpb24sIGNvbnZleFBvc2l0aW9uLCBwbGFuZVF1YXQsIGNvbnZleFF1YXQsIHBsYW5lQm9keSwgY29udmV4Qm9keSwgc2ksIHNqLCBqdXN0VGVzdCkgewogICAgICAvLyBTaW1wbHkgcmV0dXJuIHRoZSBwb2ludHMgYmVoaW5kIHRoZSBwbGFuZS4KICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSBwbGFuZUNvbnZleF92OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHBsYW5lQ29udmV4X25vcm1hbDsKICAgICAgd29ybGROb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwogICAgICBjb25zdCByZWxwb3MgPSBwbGFuZUNvbnZleF9yZWxwb3M7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gY29udmV4U2hhcGUudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgY29udmV4IHZlcnRleAogICAgICAgIHdvcmxkVmVydGV4LmNvcHkoY29udmV4U2hhcGUudmVydGljZXNbaV0pOwogICAgICAgIGNvbnZleFF1YXQudm11bHQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICBjb252ZXhQb3NpdGlvbi52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgd29ybGRWZXJ0ZXgudnN1YihwbGFuZVBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIGNvbnZleEJvZHksIHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBzaSwgc2opOyAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lQ29udmV4X3Byb2plY3RlZDsKICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7CiAgICAgICAgICBwcm9qZWN0ZWQudnN1YihwbGFuZVBvc2l0aW9uLCByLnJpKTsgLy8gRnJvbSBwbGFuZSB0byB2ZXJ0ZXggcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgci5uaS5jb3B5KHdvcmxkTm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbCBvdXQgZnJvbSBwbGFuZQogICAgICAgICAgLy8gcmogaXMgbm93IGp1c3QgdGhlIHZlY3RvciBmcm9tIHRoZSBjb252ZXggY2VudGVyIHRvIHRoZSB2ZXJ0ZXgKCiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKGNvbnZleFBvc2l0aW9uLCByLnJqKTsgLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKICAgICAgICAgIHIucmkudmFkZChwbGFuZVBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai52YWRkKGNvbnZleFBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihjb252ZXhCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgIH0KICAgIH0KCiAgICBib3hDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlSGVpZ2h0ZmllbGQoc3BoZXJlU2hhcGUsIGhmU2hhcGUsIHNwaGVyZVBvcywgaGZQb3MsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgcmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAyOyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlIGNhbid0IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxTcGhlcmVQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbFNwaGVyZVBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBudW1Db250YWN0c0JlZm9yZSA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHMgPSByZXN1bHQubGVuZ3RoIC0gbnVtQ29udGFjdHNCZWZvcmU7CgogICAgICAgICAgaWYgKG51bUNvbnRhY3RzID4gMikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICAvLyBTa2lwIGFsbCBidXQgMQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG51bUNvbnRhY3RzIC0gMTsgaysrKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICovCgogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJveEhlaWdodGZpZWxkKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHJhZGl1cyA9IGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDI7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3Q7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbENvbnZleFBvcyA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBjb252ZXhQb3MsIGxvY2FsQ29udmV4UG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UncmUgY2FudCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsQ29udmV4UG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxDb252ZXhQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBUaGUgbm9ybWFsIGlzIHRoZSB1bml0IHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gcGFydGljbGUgY2VudGVyCiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlU3BoZXJlX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgeGkudnN1Yih4aiwgbm9ybWFsKTsKICAgICAgY29uc3QgbGVuZ3RoU3F1YXJlZCA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobGVuZ3RoU3F1YXJlZCA8PSBzai5yYWRpdXMgKiBzai5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHIucmouY29weShub3JtYWwpOwogICAgICAgIHIucmouc2NhbGUoc2oucmFkaXVzLCByLnJqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIHBsYW5lUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVQbGFuZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIGJqLnF1YXRlcm5pb24udm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGNvbnN0IHJlbHBvcyA9IHBhcnRpY2xlUGxhbmVfcmVscG9zOwogICAgICB4aS52c3ViKGJqLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCiAgICAgICAgLy8gR2V0IHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZDsKICAgICAgICBub3JtYWwuc2NhbGUobm9ybWFsLmRvdCh4aSksIHByb2plY3RlZCk7CiAgICAgICAgeGkudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vcHJvamVjdGVkLnZhZGQoYmoucG9zaXRpb24scHJvamVjdGVkKTsKICAgICAgICAvLyByaiBpcyBub3cgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICByLnJqLmNvcHkocHJvamVjdGVkKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveFBhcnRpY2xlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgbGV0IHBlbmV0cmF0ZWRGYWNlSW5kZXggPSAtMTsKICAgICAgY29uc3QgcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbDsKICAgICAgY29uc3Qgd29ybGRQZW5ldHJhdGlvblZlYyA9IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWM7CiAgICAgIGxldCBtaW5QZW5ldHJhdGlvbiA9IG51bGw7CiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQoKICBjb25zdCBhdmVyYWdlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQxID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB0bXBRdWF0MiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdjIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90bXAgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVfdG9fc3BoZXJlX29ydGhvID0gbmV3IFZlYzMoKTsgLy8gU2VlIGh0dHA6Ly9idWxsZXRwaHlzaWNzLmNvbS9CdWxsZXQvQnVsbGV0RnVsbC9TcGhlcmVUcmlhbmdsZURldGVjdG9yXzhjcHBfc291cmNlLmh0bWwKCiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fdnRwID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gcG9pbnRJblBvbHlnb24odmVydHMsIG5vcm1hbCwgcCkgewogICAgbGV0IHBvc2l0aXZlUmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IE4gPSB2ZXJ0cy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIEdldCBlZGdlIHRvIHRoZSBuZXh0IHZlcnRleAoKICAgICAgY29uc3QgZWRnZSA9IHBvaW50SW5Qb2x5Z29uX2VkZ2U7CiAgICAgIHZlcnRzWyhpICsgMSkgJSBOXS52c3ViKHYsIGVkZ2UpOyAvLyBHZXQgY3Jvc3MgcHJvZHVjdCBiZXR3ZWVuIHBvbHlnb24gbm9ybWFsIGFuZCB0aGUgZWRnZQoKICAgICAgY29uc3QgZWRnZV94X25vcm1hbCA9IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWw7IC8vY29uc3QgZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CgogICAgICBlZGdlLmNyb3NzKG5vcm1hbCwgZWRnZV94X25vcm1hbCk7IC8vIEdldCB2ZWN0b3IgYmV0d2VlbiBwb2ludCBhbmQgY3VycmVudCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IHZlcnRleF90b19wID0gcG9pbnRJblBvbHlnb25fdnRwOwogICAgICBwLnZzdWIodiwgdmVydGV4X3RvX3ApOyAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgIGNvbnN0IHIgPSBlZGdlX3hfbm9ybWFsLmRvdCh2ZXJ0ZXhfdG9fcCk7IC8vIElmIGFsbCBzdWNoIGRvdCBwcm9kdWN0cyBoYXZlIHNhbWUgc2lnbiwgd2UgYXJlIGluc2lkZSB0aGUgcG9seWdvbi4KCiAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCB8fCByID4gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gdHJ1ZSB8fCByIDw9IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3NpdGl2ZVJlc3VsdCA9IHIgPiAwOwogICAgICAgIH0KCiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgIH0KICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGNvbnN0IGJveF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIGNvbnN0IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZVVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdCA9IFswXTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKCiAgY2xhc3MgT3ZlcmxhcEtlZXBlciB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmN1cnJlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJldmlvdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CiAgICAvKiogZ2V0ICovCgoKICAgIGdldChpLCBqKSB7CiAgICAgIGlmIChpID4gaikgewogICAgICAgIC8vIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZGF0YVtpICsgIi0iICsgal07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBpZiAoaSA+IGopIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgY29uc3Qga2V5ID0gaSArICItIiArIGo7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiByZXNldCAqLwoKCiAgICByZXNldCgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3Qga2V5cyA9IGRhdGEua2V5czsKCiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBrZXkgPSBrZXlzLnBvcCgpOwogICAgICAgIGRlbGV0ZSBkYXRhW2tleV07CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIFRoZSBwaHlzaWNzIHdvcmxkCiAgICovCgoKICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYnJvYWRwaGFzZSBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgTmFpdmVCcm9hZHBoYXNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBib2RpZXMgaW4gdGhpcyB3b3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBUcnVlIGlmIGFueSBib2RpZXMgYXJlIG5vdCBzbGVlcGluZywgZmFsc2UgaWYgZXZlcnkgYm9keSBpcyBzbGVlcGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHNvbHZlciBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgR1NTb2x2ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uTWF0cml4CiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbGxpc2lvbk1hdHJpeCBmcm9tIHRoZSBwcmV2aW91cyBzdGVwLgogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgbWF0ZXJpYWxzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqIEB0b2RvIFJlbW92ZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgY29udGFjdG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogVXNlZCB0byBsb29rIHVwIGEgQ29udGFjdE1hdGVyaWFsIGdpdmVuIHR3byBpbnN0YW5jZXMgb2YgTWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG9mIHRoZSBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoaXMgY29udGFjdCBtYXRlcmlhbCBpcyB1c2VkIGlmIG5vIHN1aXRhYmxlIGNvbnRhY3RtYXRlcmlhbCBpcyBmb3VuZCBmb3IgYSBjb250YWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaW1lIGFjY3VtdWxhdG9yIGZvciBpbnRlcnBvbGF0aW9uLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL2dhbWUtcGh5c2ljcy9maXgteW91ci10aW1lc3RlcC8KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdvcmxkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kdCA9IHZvaWQgMDsKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RzID0gdm9pZCAwOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVTa2lwID0gdm9pZCAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gdm9pZCAwOwogICAgICB0aGlzLnRpbWUgPSB2b2lkIDA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IHZvaWQgMDsKICAgICAgdGhpcy5kZWZhdWx0X2R0ID0gdm9pZCAwOwogICAgICB0aGlzLm5leHRJZCA9IHZvaWQgMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9kaWVzID0gdm9pZCAwOwogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IHZvaWQgMDsKICAgICAgdGhpcy5zb2x2ZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSB2b2lkIDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4ID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlciA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5kb1Byb2ZpbGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy5wcm9maWxlID0gdm9pZCAwOwogICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdm9pZCAwOwogICAgICB0aGlzLnN1YnN5c3RlbXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50ID0gdm9pZCAwOwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHZvaWQgMDsKICAgICAgdGhpcy5pZFRvQm9keU1hcCA9IHZvaWQgMDsKICAgICAgdGhpcy5kdCA9IC0xOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSAhIW9wdGlvbnMuYWxsb3dTbGVlcDsKICAgICAgdGhpcy5jb250YWN0cyA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gW107CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgPSBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwIDogMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgOiBmYWxzZTsKICAgICAgdGhpcy50aW1lID0gMC4wOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSAwOwogICAgICB0aGlzLmRlZmF1bHRfZHQgPSAxIC8gNjA7CiAgICAgIHRoaXMubmV4dElkID0gMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmdyYXZpdHkpIHsKICAgICAgICB0aGlzLmdyYXZpdHkuY29weShvcHRpb25zLmdyYXZpdHkpOwogICAgICB9CgogICAgICB0aGlzLmJyb2FkcGhhc2UgPSBvcHRpb25zLmJyb2FkcGhhc2UgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYnJvYWRwaGFzZSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKICAgICAgdGhpcy5ib2RpZXMgPSBbXTsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKICAgICAgdGhpcy5zb2x2ZXIgPSBvcHRpb25zLnNvbHZlciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5zb2x2ZXIgOiBuZXcgR1NTb2x2ZXIoKTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gbmV3IE5hcnJvd3BoYXNlKHRoaXMpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gbmV3IEFycmF5Q29sbGlzaW9uTWF0cml4KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlciA9IG5ldyBPdmVybGFwS2VlcGVyKCk7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW107CiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlID0gbmV3IFR1cGxlRGljdGlvbmFyeSgpOwogICAgICB0aGlzLmRlZmF1bHRNYXRlcmlhbCA9IG5ldyBNYXRlcmlhbCgnZGVmYXVsdCcpOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSBuZXcgQ29udGFjdE1hdGVyaWFsKHRoaXMuZGVmYXVsdE1hdGVyaWFsLCB0aGlzLmRlZmF1bHRNYXRlcmlhbCwgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMAogICAgICB9KTsKICAgICAgdGhpcy5kb1Byb2ZpbGluZyA9IGZhbHNlOwogICAgICB0aGlzLnByb2ZpbGUgPSB7CiAgICAgICAgc29sdmU6IDAsCiAgICAgICAgbWFrZUNvbnRhY3RDb25zdHJhaW50czogMCwKICAgICAgICBicm9hZHBoYXNlOiAwLAogICAgICAgIGludGVncmF0ZTogMCwKICAgICAgICBuYXJyb3dwaGFzZTogMAogICAgICB9OwogICAgICB0aGlzLmFjY3VtdWxhdG9yID0gMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gW107CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdhZGRCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdyZW1vdmVCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB7fTsKICAgICAgdGhpcy5icm9hZHBoYXNlLnNldFdvcmxkKHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbnRhY3QgbWF0ZXJpYWwgYmV0d2VlbiBtYXRlcmlhbHMgbTEgYW5kIG0yCiAgICAgKiBAcmV0dXJuIFRoZSBjb250YWN0IG1hdGVyaWFsIGlmIGl0IHdhcyBmb3VuZC4KICAgICAqLwoKCiAgICBnZXRDb250YWN0TWF0ZXJpYWwobTEsIG0yKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmdldChtMS5pZCwgbTIuaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbnVtYmVyIG9mIG9iamVjdHMgaW4gdGhlIHdvcmxkLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwoKCiAgICBudW1PYmplY3RzKCkgewogICAgICByZXR1cm4gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgfQogICAgLyoqCiAgICAgKiBTdG9yZSBvbGQgY29sbGlzaW9uIHN0YXRlIGluZm8KICAgICAqLwoKCiAgICBjb2xsaXNpb25NYXRyaXhUaWNrKCkgewogICAgICBjb25zdCB0ZW1wID0gdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91czsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHRoaXMuY29sbGlzaW9uTWF0cml4OwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHRlbXA7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnJlc2V0KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci50aWNrKCk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIGNvbnN0cmFpbnQgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgYWRkQ29uc3RyYWludChjKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHMucHVzaChjKTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnN0cmFpbnQKICAgICAqLwoKCiAgICByZW1vdmVDb25zdHJhaW50KGMpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb25zdHJhaW50cy5pbmRleE9mKGMpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmNvbnN0cmFpbnRzLnNwbGljZShpZHgsIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheWNhc3QgdGVzdAogICAgICogQGRlcHJlY2F0ZWQgVXNlIC5yYXljYXN0QWxsLCAucmF5Y2FzdENsb3Nlc3Qgb3IgLnJheWNhc3RBbnkgaW5zdGVhZC4KICAgICAqLwoKCiAgICByYXlUZXN0KGZyb20sIHRvLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFJheWNhc3RSZXN1bHQpIHsKICAgICAgICAvLyBEbyByYXljYXN0Q2xvc2VzdAogICAgICAgIHRoaXMucmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIERvIHJheWNhc3RBbGwKICAgICAgICB0aGlzLnJheWNhc3RBbGwoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0IGFnYWluc3QgYWxsIGJvZGllcy4gVGhlIHByb3ZpZGVkIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggaGl0IHdpdGggYSBSYXljYXN0UmVzdWx0IGFzIHNpbmdsZSBhcmd1bWVudC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbGwoZnJvbSwgdG8sIG9wdGlvbnMgPSB7fSwgY2FsbGJhY2spIHsKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFMTDsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLmNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0LCBhbmQgc3RvcCBhdCB0aGUgZmlyc3QgcmVzdWx0LiBOb3RlIHRoYXQgdGhlIG9yZGVyIGlzIHJhbmRvbSAtIGJ1dCB0aGUgbWV0aG9kIGlzIGZhc3QuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QW55KGZyb20sIHRvLCBvcHRpb25zID0ge30sIHJlc3VsdCkgewogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucyA9IHt9LCByZXN1bHQpIHsKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkNMT1NFU1Q7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHJpZ2lkIGJvZHkgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKiBAdG9kbyBJZiB0aGUgc2ltdWxhdGlvbiBoYXMgbm90IHlldCBzdGFydGVkLCB3aHkgcmVjcmV0ZSBhbmQgY29weSBhcnJheXMgZm9yIGVhY2ggYm9keT8gQWNjdW11bGF0ZSBpbiBkeW5hbWljIGFycmF5cyBpbiB0aGlzIGNhc2UuCiAgICAgKiBAdG9kbyBBZGRpbmcgYW4gYXJyYXkgb2YgYm9kaWVzIHNob3VsZCBiZSBwb3NzaWJsZS4gVGhpcyB3b3VsZCBzYXZlIHNvbWUgbG9vcHMgdG9vCiAgICAgKi8KCgogICAgYWRkQm9keShib2R5KSB7CiAgICAgIGlmICh0aGlzLmJvZGllcy5pbmNsdWRlcyhib2R5KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgYm9keS5pbmRleCA9IHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgICAgdGhpcy5ib2RpZXMucHVzaChib2R5KTsKICAgICAgYm9keS53b3JsZCA9IHRoaXM7CiAgICAgIGJvZHkuaW5pdFBvc2l0aW9uLmNvcHkoYm9keS5wb3NpdGlvbik7CiAgICAgIGJvZHkuaW5pdFZlbG9jaXR5LmNvcHkoYm9keS52ZWxvY2l0eSk7CiAgICAgIGJvZHkudGltZUxhc3RTbGVlcHkgPSB0aGlzLnRpbWU7CgogICAgICBpZiAoYm9keSBpbnN0YW5jZW9mIEJvZHkpIHsKICAgICAgICBib2R5LmluaXRBbmd1bGFyVmVsb2NpdHkuY29weShib2R5LmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgICAgYm9keS5pbml0UXVhdGVybmlvbi5jb3B5KGJvZHkucXVhdGVybmlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldE51bU9iamVjdHModGhpcy5ib2RpZXMubGVuZ3RoKTsKICAgICAgdGhpcy5hZGRCb2R5RXZlbnQuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXBbYm9keS5pZF0gPSBib2R5OwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5hZGRCb2R5RXZlbnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSByaWdpZCBib2R5IGZyb20gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgcmVtb3ZlQm9keShib2R5KSB7CiAgICAgIGJvZHkud29ybGQgPSBudWxsOwogICAgICBjb25zdCBuID0gdGhpcy5ib2RpZXMubGVuZ3RoIC0gMTsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IGlkeCA9IGJvZGllcy5pbmRleE9mKGJvZHkpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICBib2RpZXMuc3BsaWNlKGlkeCwgMSk7IC8vIFRvZG86IHNob3VsZCB1c2UgYSBnYXJiYWdlIGZyZWUgbWV0aG9kCiAgICAgICAgLy8gUmVjb21wdXRlIGluZGV4CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS5pbmRleCA9IGk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKG4pOwogICAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICAgIGRlbGV0ZSB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdOwogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLnJlbW92ZUJvZHlFdmVudCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRCb2R5QnlJZChpZCkgewogICAgICByZXR1cm4gdGhpcy5pZFRvQm9keU1hcFtpZF07CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE1ha2UgYSBmYXN0ZXIgbWFwCiAgICAgKi8KCgogICAgZ2V0U2hhcGVCeUlkKGlkKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZXMgPSBib2RpZXNbaV0uc2hhcGVzOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbal07CgogICAgICAgICAgaWYgKHNoYXBlLmlkID09PSBpZCkgewogICAgICAgICAgICByZXR1cm4gc2hhcGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQWRkcyBhIG1hdGVyaWFsIHRvIHRoZSBXb3JsZC4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKiBAdG9kbyBSZW1vdmUKICAgICAqLwoKCiAgICBhZGRNYXRlcmlhbChtKSB7CiAgICAgIHRoaXMubWF0ZXJpYWxzLnB1c2gobSk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogU3RlcCB0aGUgcGh5c2ljcyB3b3JsZCBmb3J3YXJkIGluIHRpbWUuCiAgICAgKgogICAgICogVGhlcmUgYXJlIHR3byBtb2Rlcy4gVGhlIHNpbXBsZSBtb2RlIGlzIGZpeGVkIHRpbWVzdGVwcGluZyB3aXRob3V0IGludGVycG9sYXRpb24uIEluIHRoaXMgY2FzZSB5b3Ugb25seSB1c2UgdGhlIGZpcnN0IGFyZ3VtZW50LiBUaGUgc2Vjb25kIGNhc2UgdXNlcyBpbnRlcnBvbGF0aW9uLiBJbiB0aGF0IHlvdSBhbHNvIHByb3ZpZGUgdGhlIHRpbWUgc2luY2UgdGhlIGZ1bmN0aW9uIHdhcyBsYXN0IHVzZWQsIGFzIHdlbGwgYXMgdGhlIG1heGltdW0gZml4ZWQgdGltZXN0ZXBzIHRvIHRha2UuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UuCiAgICAgKiBAcGFyYW0gdGltZVNpbmNlTGFzdENhbGxlZCBUaGUgdGltZSBlbGFwc2VkIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCBjYWxsZWQuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbC4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMgPSAxMCkgewogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlJDEubm93KCk7CiAgICAgICAgbGV0IHN1YnN0ZXBzID0gMDsKCiAgICAgICAgd2hpbGUgKHRoaXMuYWNjdW11bGF0b3IgPj0gZHQgJiYgc3Vic3RlcHMgPCBtYXhTdWJTdGVwcykgewogICAgICAgICAgLy8gRG8gZml4ZWQgc3RlcHMgdG8gY2F0Y2ggdXAKICAgICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsKICAgICAgICAgIHRoaXMuYWNjdW11bGF0b3IgLT0gZHQ7CiAgICAgICAgICBzdWJzdGVwcysrOwoKICAgICAgICAgIGlmIChwZXJmb3JtYW5jZSQxLm5vdygpIC0gdDAgPiBkdCAqIDEwMDApIHsKICAgICAgICAgICAgLy8gVGhlIGZyYW1lcmF0ZSBpcyBub3QgaW50ZXJhY3RpdmUgYW55bW9yZS4KICAgICAgICAgICAgLy8gV2UgYXJlIGJlbG93IHRoZSB0YXJnZXQgZnJhbWVyYXRlLgogICAgICAgICAgICAvLyBCZXR0ZXIgYmFpbCBvdXQuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIHRoZSBleGNlc3MgYWNjdW11bGF0b3IsIHNpbmNlIHdlIG1heSBub3QKICAgICAgICAvLyBoYXZlIGhhZCBlbm91Z2ggc3Vic3RlcHMgYXZhaWxhYmxlIHRvIGNhdGNoIHVwCgoKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdGhpcy5hY2N1bXVsYXRvciAlIGR0OwogICAgICAgIGNvbnN0IHQgPSB0aGlzLmFjY3VtdWxhdG9yIC8gZHQ7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSB0aGlzLmJvZGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgYiA9IHRoaXMuYm9kaWVzW2pdOwogICAgICAgICAgYi5wcmV2aW91c1Bvc2l0aW9uLmxlcnAoYi5wb3NpdGlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRQb3NpdGlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5zbGVycChiLnF1YXRlcm5pb24sIHQsIGIuaW50ZXJwb2xhdGVkUXVhdGVybmlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5ub3JtYWxpemUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGltZSArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICB9CiAgICB9CgogICAgaW50ZXJuYWxTdGVwKGR0KSB7CiAgICAgIHRoaXMuZHQgPSBkdDsKICAgICAgY29uc3QgY29udGFjdHMgPSB0aGlzLmNvbnRhY3RzOwogICAgICBjb25zdCBwMSA9IFdvcmxkX3N0ZXBfcDE7CiAgICAgIGNvbnN0IHAyID0gV29ybGRfc3RlcF9wMjsKICAgICAgY29uc3QgTiA9IHRoaXMubnVtT2JqZWN0cygpOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZSQxLm5vdygpOwogICAgICB9IC8vIEFkZCBncmF2aXR5IHRvIGFsbCBvYmplY3RzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlID09PSBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgZiA9IGJpLmZvcmNlOwogICAgICAgICAgY29uc3QgbSA9IGJpLm1hc3M7CiAgICAgICAgICBmLnggKz0gbSAqIGd4OwogICAgICAgICAgZi55ICs9IG0gKiBneTsKICAgICAgICAgIGYueiArPSBtICogZ3o7CiAgICAgICAgfQogICAgICB9IC8vIFVwZGF0ZSBzdWJzeXN0ZW1zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIE5zdWJzeXN0ZW1zID0gdGhpcy5zdWJzeXN0ZW1zLmxlbmd0aDsgaSAhPT0gTnN1YnN5c3RlbXM7IGkrKykgewogICAgICAgIHRoaXMuc3Vic3lzdGVtc1tpXS51cGRhdGUoKTsKICAgICAgfSAvLyBDb2xsaXNpb24gZGV0ZWN0aW9uCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZSQxLm5vdygpOwogICAgICB9CgogICAgICBwMS5sZW5ndGggPSAwOyAvLyBDbGVhbiB1cCBwYWlyIGFycmF5cyBmcm9tIGxhc3Qgc3RlcAoKICAgICAgcDIubGVuZ3RoID0gMDsKICAgICAgdGhpcy5icm9hZHBoYXNlLmNvbGxpc2lvblBhaXJzKHRoaXMsIHAxLCBwMik7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmJyb2FkcGhhc2UgPSBwZXJmb3JtYW5jZSQxLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2UkMS5ub3coKTsKICAgICAgfQoKICAgICAgY29uc3Qgb2xkY29udGFjdHMgPSBXb3JsZF9zdGVwX29sZENvbnRhY3RzOwogICAgICBjb25zdCBOb2xkQ29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkQ29udGFjdHM7IGkrKykgewogICAgICAgIG9sZGNvbnRhY3RzLnB1c2goY29udGFjdHNbaV0pOwogICAgICB9CgogICAgICBjb250YWN0cy5sZW5ndGggPSAwOyAvLyBUcmFuc2ZlciBGcmljdGlvbkVxdWF0aW9uIGZyb20gY3VycmVudCBsaXN0IHRvIHRoZSBwb29sIGZvciByZXVzZQoKICAgICAgY29uc3QgTm9sZEZyaWN0aW9uRXF1YXRpb25zID0gdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkRnJpY3Rpb25FcXVhdGlvbnM7IGkrKykgewogICAgICAgIGZyaWN0aW9uRXF1YXRpb25Qb29sLnB1c2godGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5uYXJyb3dwaGFzZS5nZXRDb250YWN0cyhwMSwgcDIsIHRoaXMsIGNvbnRhY3RzLCBvbGRjb250YWN0cywgLy8gVG8gYmUgcmV1c2VkCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMsIGZyaWN0aW9uRXF1YXRpb25Qb29sKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubmFycm93cGhhc2UgPSBwZXJmb3JtYW5jZSQxLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gTG9vcCBvdmVyIGFsbCBjb2xsaXNpb25zCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZSQxLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2UkMS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2UkMS5ub3coKTsKICAgICAgfSAvLyBXYWtlIHVwIGJvZGllcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSkgewogICAgICAgICAgYmkud2FrZVVwKCk7CiAgICAgICAgICBiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IC8vIEFkZCB1c2VyLWFkZGVkIGNvbnN0cmFpbnRzCgoKICAgICAgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CiAgICAgICAgYy51cGRhdGUoKTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5lcSA9IGMuZXF1YXRpb25zLmxlbmd0aDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGVxID0gYy5lcXVhdGlvbnNbal07CiAgICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24oZXEpOwogICAgICAgIH0KICAgICAgfSAvLyBTb2x2ZSB0aGUgY29uc3RyYWluZWQgc3lzdGVtCgoKICAgICAgc29sdmVyLnNvbHZlKGR0LCB0aGlzKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuc29sdmUgPSBwZXJmb3JtYW5jZSQxLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIEludm9rZSBwcmUtc3RlcCBjYWxsYmFja3MKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkucHJlU3RlcCkgewogICAgICAgICAgYmkucHJlU3RlcC5jYWxsKGJpKTsKICAgICAgICB9CiAgICAgIH0gLy8gTGVhcCBmcm9nCiAgICAgIC8vIHZuZXcgPSB2ICsgaCpmL20KICAgICAgLy8geG5ldyA9IHggKyBoKnZuZXcKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlJDEubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHN0ZXBudW1iZXIgPSB0aGlzLnN0ZXBudW1iZXI7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemUgPSBzdGVwbnVtYmVyICUgKHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgKyAxKSA9PT0gMDsKICAgICAgY29uc3QgcXVhdE5vcm1hbGl6ZUZhc3QgPSB0aGlzLnF1YXROb3JtYWxpemVGYXN0OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgYm9kaWVzW2ldLmludGVncmF0ZShkdCwgcXVhdE5vcm1hbGl6ZSwgcXVhdE5vcm1hbGl6ZUZhc3QpOwogICAgICB9CgogICAgICB0aGlzLmNsZWFyRm9yY2VzKCk7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5kaXJ0eSA9IHRydWU7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmludGVncmF0ZSA9IHBlcmZvcm1hbmNlJDEubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBVcGRhdGUgc3RlcCBudW1iZXIKCgogICAgICB0aGlzLnN0ZXBudW1iZXIgKz0gMTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCk7IC8vIEludm9rZSBwb3N0LXN0ZXAgY2FsbGJhY2tzCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBwb3N0U3RlcCA9IGJpLnBvc3RTdGVwOwoKICAgICAgICBpZiAocG9zdFN0ZXApIHsKICAgICAgICAgIHBvc3RTdGVwLmNhbGwoYmkpOwogICAgICAgIH0KICAgICAgfSAvLyBTbGVlcGluZyB1cGRhdGUKCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgoKICBuZXcgQUFCQigpOwogIGNvbnN0IHRtcFJheSA9IG5ldyBSYXkoKTsgLy8gcGVyZm9ybWFuY2Uubm93KCkgZmFsbGJhY2sgb24gRGF0ZS5ub3coKQoKICBjb25zdCBwZXJmb3JtYW5jZSQxID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZSQxLm5vdykgewogICAgbGV0IG5vd09mZnNldCA9IERhdGUubm93KCk7CgogICAgaWYgKHBlcmZvcm1hbmNlJDEudGltaW5nICYmIHBlcmZvcm1hbmNlJDEudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZSQxLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7CiAgICB9CgogICAgcGVyZm9ybWFuY2UkMS5ub3cgPSAoKSA9PiBEYXRlLm5vdygpIC0gbm93T2Zmc2V0OwogIH0gLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCgogIGNvbnN0IFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwb3N0U3RlcCcKICB9OyAvLyBEaXNwYXRjaGVkIGJlZm9yZSB0aGUgd29ybGQgc3RlcHMgZm9yd2FyZCBpbiB0aW1lLgoKICBjb25zdCBXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwcmVTdGVwJwogIH07CiAgY29uc3QgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQgPSB7CiAgICB0eXBlOiBCb2R5LkNPTExJREVfRVZFTlRfTkFNRSwKICAgIGJvZHk6IG51bGwsCiAgICBjb250YWN0OiBudWxsCiAgfTsgLy8gUG9vbHMgZm9yIHVudXNlZCBvYmplY3RzCgogIGNvbnN0IFdvcmxkX3N0ZXBfb2xkQ29udGFjdHMgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX2ZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107IC8vIFJldXNhYmxlIGFycmF5cyBmb3IgY29sbGlzaW9uIHBhaXJzCgogIGNvbnN0IFdvcmxkX3N0ZXBfcDEgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX3AyID0gW107IC8vIFN0dWZmIGZvciBlbWl0Q29udGFjdEV2ZW50cwoKICBjb25zdCBhZGRpdGlvbnMgPSBbXTsKICBjb25zdCByZW1vdmFscyA9IFtdOwogIGNvbnN0IGJlZ2luQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBlbmRDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBiZWdpblNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwogIGNvbnN0IGVuZFNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZFNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKCiAgY29uc3QgbWFrZVZlYzMgPSAoW3gsIHksIHpdKSA9PiBuZXcgVmVjMyh4LCB5LCB6KTsKCiAgY29uc3QgcHJlcGFyZVNwaGVyZSA9IGFyZ3MgPT4gQXJyYXkuaXNBcnJheShhcmdzKSA/IGFyZ3MgOiBbYXJnc107CgogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gKFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdKSA9PiBbewogICAgdmVydGljZXM6IHYgPyB2Lm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICBmYWNlcywKICAgIG5vcm1hbHM6IG4gPyBuLm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICBheGVzOiBhID8gYS5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICB9XTsKCiAgZnVuY3Rpb24gY3JlYXRlU2hhcGUodHlwZSwgYXJncykgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ0JveCc6CiAgICAgICAgcmV0dXJuIG5ldyBCb3gobmV3IFZlYzMoLi4uYXJncy5tYXAodiA9PiB2IC8gMikpKTsKICAgICAgLy8gZXh0ZW50cyA9PiBoYWxmRXh0ZW50cwoKICAgICAgY2FzZSAnQ29udmV4UG9seWhlZHJvbic6CiAgICAgICAgcmV0dXJuIG5ldyBDb252ZXhQb2x5aGVkcm9uKC4uLnByZXBhcmVDb252ZXhQb2x5aGVkcm9uKGFyZ3MpKTsKCiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCgogICAgICBjYXNlICdIZWlnaHRmaWVsZCc6CiAgICAgICAgcmV0dXJuIG5ldyBIZWlnaHRmaWVsZCguLi5hcmdzKTsKICAgICAgLy8gWyBBcnJheSBkYXRhLCBvcHRpb25zOiB7bWluVmFsdWUsIG1heFZhbHVlLCBlbGVtZW50U2l6ZX0gIF0gPSBhcmdzCgogICAgICBjYXNlICdQYXJ0aWNsZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSgpOwogICAgICAvLyBubyBhcmdzCgogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CgogICAgICBjYXNlICdTcGhlcmUnOgogICAgICAgIHJldHVybiBuZXcgU3BoZXJlKC4uLnByZXBhcmVTcGhlcmUoYXJncykpOwogICAgICAvLyByYWRpdXMgPSBhcmdzCgogICAgICBjYXNlICdUcmltZXNoJzoKICAgICAgICByZXR1cm4gbmV3IFRyaW1lc2goLi4uYXJncyk7CiAgICAgIC8vIFt2ZXJ0aWNlcywgaW5kaWNlc10gPSBhcmdzCiAgICB9CiAgfQogIC8qKgogICAqCiAgICogQHBhcmFtIHV1aWQge3N0cmluZ30KICAgKiBAcGFyYW0gcHJvcHMge0JvZHlQcm9wc30KICAgKiBAcGFyYW0gdHlwZSB7Qm9keVNoYXBlVHlwZX0KICAgKiBAcmV0dXJuIHttb2R1bGU6b2JqZWN0cy9Cb2R5LkJvZHl9CiAgICovCgoKICBjb25zdCBwcm9wc1RvQm9keSA9ICh1dWlkLCBwcm9wcywgdHlwZSkgPT4gewogICAgY29uc3QgewogICAgICBhcmdzID0gW10sCiAgICAgIHBvc2l0aW9uID0gWzAsIDAsIDBdLAogICAgICByb3RhdGlvbiA9IFswLCAwLCAwXSwKICAgICAgdmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFuZ3VsYXJWZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgbGluZWFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICB0eXBlOiBib2R5VHlwZSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIHNoYXBlcywKICAgICAgb25Db2xsaWRlLAogICAgICBjb2xsaXNpb25SZXNwb25zZSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7IC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgdHlwZTogYm9keVR5cGUgPyBCb2R5W2JvZHlUeXBlLnRvVXBwZXJDYXNlKCldIDogdW5kZWZpbmVkLAogICAgICBtYXRlcmlhbDogbWF0ZXJpYWwgPyBuZXcgTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkCiAgICB9KTsKICAgIGJvZHkudXVpZCA9IHV1aWQ7CgogICAgaWYgKGNvbGxpc2lvblJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgYm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGNvbGxpc2lvblJlc3BvbnNlOwogICAgfQoKICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKCh7CiAgICAgICAgdHlwZSwKICAgICAgICBhcmdzLAogICAgICAgIHBvc2l0aW9uLAogICAgICAgIHJvdGF0aW9uLAogICAgICAgIG1hdGVyaWFsLAogICAgICAgIC4uLmV4dHJhCiAgICAgIH0pID0+IHsKICAgICAgICBjb25zdCBzaGFwZUJvZHkgPSBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpLCBwb3NpdGlvbiA/IG5ldyBWZWMzKC4uLnBvc2l0aW9uKSA6IHVuZGVmaW5lZCwgcm90YXRpb24gPyBuZXcgUXVhdGVybmlvbigpLnNldEZyb21FdWxlciguLi5yb3RhdGlvbikgOiB1bmRlZmluZWQpOwogICAgICAgIGlmIChtYXRlcmlhbCkgc2hhcGVCb2R5Lm1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQoKICAgIGJvZHkucG9zaXRpb24uc2V0KHBvc2l0aW9uWzBdLCBwb3NpdGlvblsxXSwgcG9zaXRpb25bMl0pOwogICAgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihyb3RhdGlvblswXSwgcm90YXRpb25bMV0sIHJvdGF0aW9uWzJdKTsKICAgIGJvZHkudmVsb2NpdHkuc2V0KHZlbG9jaXR5WzBdLCB2ZWxvY2l0eVsxXSwgdmVsb2NpdHlbMl0pOwogICAgYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KGFuZ3VsYXJWZWxvY2l0eVswXSwgYW5ndWxhclZlbG9jaXR5WzFdLCBhbmd1bGFyVmVsb2NpdHlbMl0pOwogICAgYm9keS5saW5lYXJGYWN0b3Iuc2V0KGxpbmVhckZhY3RvclswXSwgbGluZWFyRmFjdG9yWzFdLCBsaW5lYXJGYWN0b3JbMl0pOwogICAgYm9keS5hbmd1bGFyRmFjdG9yLnNldChhbmd1bGFyRmFjdG9yWzBdLCBhbmd1bGFyRmFjdG9yWzFdLCBhbmd1bGFyRmFjdG9yWzJdKTsKICAgIHJldHVybiBib2R5OwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIHZlaGljbGVzOiB7fSwKICAgIHNwcmluZ3M6IHt9LAogICAgc3ByaW5nSW5zdGFuY2VzOiB7fSwKICAgIHJheXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpLAogICAgY29uZmlnOiB7CiAgICAgIHN0ZXA6IDEgLyA2MAogICAgfSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdGVtcFZlY3RvcjogbmV3IFZlYzMoKSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGxhc3RDYWxsVGltZTogdW5kZWZpbmVkCiAgfTsKCiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGFjYywgYm9keSkgPT4gKHsgLi4uYWNjLAogICAgICBbYm9keS51dWlkXTogYm9keQogICAgfSksIHt9KTsKICB9CgogIGZ1bmN0aW9uIGVtaXRCZWdpbkNvbnRhY3QoewogICAgYm9keUEsCiAgICBib2R5QgogIH0pIHsKICAgIGlmICghYm9keUEgfHwgIWJvZHlCKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlQmVnaW4nLAogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZW1pdEVuZENvbnRhY3QoewogICAgYm9keUEsCiAgICBib2R5QgogIH0pIHsKICAgIGlmICghYm9keUEgfHwgIWJvZHlCKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJywKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkCiAgICB9KTsKICB9CgogIHNlbGYub25tZXNzYWdlID0gZSA9PiB7CiAgICBjb25zdCB7CiAgICAgIG9wLAogICAgICB1dWlkLAogICAgICB0eXBlLAogICAgICBwb3NpdGlvbnMsCiAgICAgIHF1YXRlcm5pb25zLAogICAgICBwcm9wcwogICAgfSA9IGUuZGF0YTsKICAgIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICAgIFNBUEJyb2FkcGhhc2UKICAgIH07CgogICAgc3dpdGNoIChvcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGdyYXZpdHksCiAgICAgICAgICAgIHRvbGVyYW5jZSwKICAgICAgICAgICAgc3RlcCwKICAgICAgICAgICAgaXRlcmF0aW9ucywKICAgICAgICAgICAgYWxsb3dTbGVlcCwKICAgICAgICAgICAgYnJvYWRwaGFzZSwKICAgICAgICAgICAgYXhpc0luZGV4LAogICAgICAgICAgICBkZWZhdWx0Q29udGFjdE1hdGVyaWFsLAogICAgICAgICAgICBxdWF0Tm9ybWFsaXplRmFzdCwKICAgICAgICAgICAgcXVhdE5vcm1hbGl6ZVNraXAsCiAgICAgICAgICAgIHNvbHZlcgogICAgICAgICAgfSA9IHByb3BzOwogICAgICAgICAgc3RhdGUud29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChncmF2aXR5WzBdLCBncmF2aXR5WzFdLCBncmF2aXR5WzJdKTsKICAgICAgICAgIHN0YXRlLndvcmxkLnF1YXROb3JtYWxpemVGYXN0ID0gcXVhdE5vcm1hbGl6ZUZhc3Q7CiAgICAgICAgICBzdGF0ZS53b3JsZC5xdWF0Tm9ybWFsaXplU2tpcCA9IHF1YXROb3JtYWxpemVTa2lwOwoKICAgICAgICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbYnJvYWRwaGFzZSArICdCcm9hZHBoYXNlJ10gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGF4aXNJbmRleCA9PT0gdW5kZWZpbmVkIHx8IGF4aXNJbmRleCA9PT0gbnVsbCA/IDAgOiBheGlzSW5kZXg7CiAgICAgICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgICAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICAgICAgICBPYmplY3QuYXNzaWduKHN0YXRlLndvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogICAgICAgICAgc3RhdGUuY29uZmlnLnN0ZXAgPSBzdGVwOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgY29uc3Qgbm93ID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOwoKICAgICAgICAgIGlmICghc3RhdGUubGFzdENhbGxUaW1lKSB7CiAgICAgICAgICAgIHN0YXRlLndvcmxkLnN0ZXAoc3RhdGUuY29uZmlnLnN0ZXApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENhbGwgPSBub3cgLSBzdGF0ZS5sYXN0Q2FsbFRpbWU7CiAgICAgICAgICAgIHN0YXRlLndvcmxkLnN0ZXAoc3RhdGUuY29uZmlnLnN0ZXAsIHRpbWVTaW5jZUxhc3RDYWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBzdGF0ZS5sYXN0Q2FsbFRpbWUgPSBub3c7CiAgICAgICAgICBjb25zdCBudW1iZXJPZkJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5sZW5ndGg7CgogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkJvZGllczsgaSsrKSB7CiAgICAgICAgICAgIGxldCBiID0gc3RhdGUud29ybGQuYm9kaWVzW2ldLAogICAgICAgICAgICAgICAgcCA9IGIucG9zaXRpb24sCiAgICAgICAgICAgICAgICBxID0gYi5xdWF0ZXJuaW9uOwogICAgICAgICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgICAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICAgICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICAgICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICAgICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICAgICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwoKICAgICAgICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXMoc3RhdGUuc3Vic2NyaXB0aW9ucykpIHsKICAgICAgICAgICAgbGV0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgICAgICAgbGV0IG9iamVjdCA9IHN0YXRlW3RhcmdldF07CiAgICAgICAgICAgIGlmICghb2JqZWN0IHx8ICFvYmplY3RbdXVpZF0pIGNvbnRpbnVlOwogICAgICAgICAgICBsZXQgdmFsdWUgPSBvYmplY3RbdXVpZF1bdHlwZV07CiAgICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFZlYzMpIHZhbHVlID0gdmFsdWUudG9BcnJheSgpO2Vsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgUXVhdGVybmlvbikgewogICAgICAgICAgICAgIHZhbHVlLnRvRXVsZXIoc3RhdGUudGVtcFZlY3Rvcik7CiAgICAgICAgICAgICAgdmFsdWUgPSBzdGF0ZS50ZW1wVmVjdG9yLnRvQXJyYXkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvYnNlcnZhdGlvbnMucHVzaChbaWQsIHZhbHVlXSk7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgICAgICAgb3A6ICdmcmFtZScsCiAgICAgICAgICAgIHBvc2l0aW9ucywKICAgICAgICAgICAgcXVhdGVybmlvbnMsCiAgICAgICAgICAgIG9ic2VydmF0aW9ucywKICAgICAgICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMKICAgICAgICAgIH07CgogICAgICAgICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgICAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLm1hcChib2R5ID0+IGJvZHkudXVpZCk7CiAgICAgICAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9zaXRpb25zLmJ1ZmZlciwgcXVhdGVybmlvbnMuYnVmZmVyXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXVpZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBib2R5ID0gcHJvcHNUb0JvZHkodXVpZFtpXSwgcHJvcHNbaV0sIHR5cGUpOwogICAgICAgICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICAgICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCAoewogICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgICB0YXJnZXQsCiAgICAgICAgICAgICAgY29udGFjdAogICAgICAgICAgICB9KSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgICAgbmksCiAgICAgICAgICAgICAgICByaSwKICAgICAgICAgICAgICAgIHJqLAogICAgICAgICAgICAgICAgYmksCiAgICAgICAgICAgICAgICBiaiwKICAgICAgICAgICAgICAgIGlkCiAgICAgICAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgICAgICAgY29udGFjdDogewogICAgICAgICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICAgICAgICByajogcmoudG9BcnJheSgpLAogICAgICAgICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgICAgICAgIGltcGFjdFZlbG9jaXR5OiBjb250YWN0LmdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSwKICAgICAgICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQm9kaWVzJzoKICAgICAgICB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHN0YXRlLndvcmxkLnJlbW92ZUJvZHkoc3RhdGUuYm9kaWVzW3V1aWRbaV1dKTsKCiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIHRhcmdldAogICAgICAgICAgfSA9IHByb3BzOwogICAgICAgICAgc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF0gPSBbdXVpZCwgdHlwZSwgdGFyZ2V0XTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1twcm9wc107CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRQb3NpdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLnBvc2l0aW9uLnNldChwcm9wc1swXSwgcHJvcHNbMV0sIHByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFF1YXRlcm5pb24nOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihwcm9wc1swXSwgcHJvcHNbMV0sIHByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0udmVsb2NpdHkuc2V0KHByb3BzWzBdLCBwcm9wc1sxXSwgcHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYW5ndWxhclZlbG9jaXR5LnNldChwcm9wc1swXSwgcHJvcHNbMV0sIHByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldExpbmVhckZhY3Rvcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmxpbmVhckZhY3Rvci5zZXQocHJvcHNbMF0sIHByb3BzWzFdLCBwcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYW5ndWxhckZhY3Rvci5zZXQocHJvcHNbMF0sIHByb3BzWzFdLCBwcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICAvLyBhc3N1bWUgdGhhdCBhbiB1cGRhdGUgZnJvbSB6ZXJvLW1hc3MgaW1wbGllcyBhIG5lZWQgZm9yIGR5bmFtaWNzIG9uIHN0YXRpYyBvYmouCiAgICAgICAgaWYgKHByb3BzICE9PSAwICYmIHN0YXRlLmJvZGllc1t1dWlkXS50eXBlID09PSAwKSBzdGF0ZS5ib2RpZXNbdXVpZF0udHlwZSA9IDE7CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLm1hc3MgPSBwcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0udXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldExpbmVhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5saW5lYXJEYW1waW5nID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmFuZ3VsYXJEYW1waW5nID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbGxvd1NsZWVwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYWxsb3dTbGVlcCA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0U2xlZXBTcGVlZExpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFRpbWVMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLnNsZWVwVGltZUxpbWl0ID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJHcm91cCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJNYXNrJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uUmVzcG9uc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Rml4ZWRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmZpeGVkUm90YXRpb24gPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLmlzVHJpZ2dlciA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQocHJvcHNbMF0sIHByb3BzWzFdLCBwcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRUb2xlcmFuY2UnOgogICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBwcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFN0ZXAnOgogICAgICAgIHN0YXRlLmNvbmZpZy5zdGVwID0gcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRJdGVyYXRpb25zJzoKICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IHByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbcHJvcHMgKyAnQnJvYWRwaGFzZSddIHx8IE5haXZlQnJvYWRwaGFzZSkoc3RhdGUud29ybGQpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IHByb3BzID09PSB1bmRlZmluZWQgfHwgcHJvcHMgPT09IG51bGwgPyAwIDogcHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYXBwbHlGb3JjZShuZXcgVmVjMyguLi5wcm9wc1swXSksIG5ldyBWZWMzKC4uLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4ucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYXBwbHlMb2NhbEZvcmNlKG5ldyBWZWMzKC4uLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4ucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbdXVpZF0uYXBwbHlMb2NhbEltcHVsc2UobmV3IFZlYzMoLi4ucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlUb3JxdWUnOgogICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5wcm9wc1swXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkQ29uc3RyYWludCc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JvZHlBLCBib2R5Qiwgb3B0bnNdID0gcHJvcHM7CiAgICAgICAgICBsZXQgewogICAgICAgICAgICBwaXZvdEEsCiAgICAgICAgICAgIHBpdm90QiwKICAgICAgICAgICAgYXhpc0EsCiAgICAgICAgICAgIGF4aXNCLAogICAgICAgICAgICAuLi5vcHRpb25zCiAgICAgICAgICB9ID0gb3B0bnM7IC8vIGlzIHRoZXJlIGEgYmV0dGVyIHdheSB0byBlbmZvcmNlIGRlZmF1bHRzPwoKICAgICAgICAgIHBpdm90QSA9IEFycmF5LmlzQXJyYXkocGl2b3RBKSA/IG5ldyBWZWMzKC4uLnBpdm90QSkgOiB1bmRlZmluZWQ7CiAgICAgICAgICBwaXZvdEIgPSBBcnJheS5pc0FycmF5KHBpdm90QikgPyBuZXcgVmVjMyguLi5waXZvdEIpIDogdW5kZWZpbmVkOwogICAgICAgICAgYXhpc0EgPSBBcnJheS5pc0FycmF5KGF4aXNBKSA/IG5ldyBWZWMzKC4uLmF4aXNBKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIGF4aXNCID0gQXJyYXkuaXNBcnJheShheGlzQikgPyBuZXcgVmVjMyguLi5heGlzQikgOiB1bmRlZmluZWQ7CiAgICAgICAgICBsZXQgY29uc3RyYWludDsKCiAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnUG9pbnRUb1BvaW50JzoKICAgICAgICAgICAgICBjb25zdHJhaW50ID0gbmV3IFBvaW50VG9Qb2ludENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgcGl2b3RBLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBwaXZvdEIsIG9wdG5zLm1heEZvcmNlKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0NvbmVUd2lzdCc6CiAgICAgICAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25lVHdpc3RDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgICAgICAgIHBpdm90QSwKICAgICAgICAgICAgICAgIHBpdm90QiwKICAgICAgICAgICAgICAgIGF4aXNBLAogICAgICAgICAgICAgICAgYXhpc0IsCiAgICAgICAgICAgICAgICAuLi5vcHRpb25zCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgICAgICAgcGl2b3RBLAogICAgICAgICAgICAgICAgcGl2b3RCLAogICAgICAgICAgICAgICAgYXhpc0EsCiAgICAgICAgICAgICAgICBheGlzQiwKICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBvcHRucy5kaXN0YW5jZSwgb3B0bnMubWF4Rm9yY2UpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnTG9jayc6CiAgICAgICAgICAgICAgY29uc3RyYWludCA9IG5ldyBMb2NrQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBvcHRucyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBvcHRucyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3RyYWludC51dWlkID0gdXVpZDsKICAgICAgICAgIHN0YXRlLndvcmxkLmFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gc3RhdGUud29ybGQucmVtb3ZlQ29uc3RyYWludChjKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdlbmFibGVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gYy5lbmFibGUoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKCh7CiAgICAgICAgICB1dWlkOiB0aGlzSWQKICAgICAgICB9KSA9PiB0aGlzSWQgPT09IHV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKCh7CiAgICAgICAgICB1dWlkOiB0aGlzSWQKICAgICAgICB9KSA9PiB0aGlzSWQgPT09IHV1aWQpLm1hcChjID0+IGMuZW5hYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoKHsKICAgICAgICAgIHV1aWQ6IHRoaXNJZAogICAgICAgIH0pID0+IHRoaXNJZCA9PT0gdXVpZCkubWFwKGMgPT4gYy5kaXNhYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JTcGVlZCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKCh7CiAgICAgICAgICB1dWlkOiB0aGlzSWQKICAgICAgICB9KSA9PiB0aGlzSWQgPT09IHV1aWQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChwcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yTWF4Rm9yY2UnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcigoewogICAgICAgICAgdXVpZDogdGhpc0lkCiAgICAgICAgfSkgPT4gdGhpc0lkID09PSB1dWlkKS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UocHJvcHMpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FkZFNwcmluZyc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JvZHlBLCBib2R5Qiwgb3B0bnNdID0gcHJvcHM7CiAgICAgICAgICBsZXQgewogICAgICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgICAgIHdvcmxkQW5jaG9yQiwKICAgICAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgICAgICBsb2NhbEFuY2hvckIsCiAgICAgICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgICAgIHN0aWZmbmVzcywKICAgICAgICAgICAgZGFtcGluZwogICAgICAgICAgfSA9IG9wdG5zOwogICAgICAgICAgd29ybGRBbmNob3JBID0gQXJyYXkuaXNBcnJheSh3b3JsZEFuY2hvckEpID8gbmV3IFZlYzMoLi4ud29ybGRBbmNob3JBKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIHdvcmxkQW5jaG9yQiA9IEFycmF5LmlzQXJyYXkod29ybGRBbmNob3JCKSA/IG5ldyBWZWMzKC4uLndvcmxkQW5jaG9yQikgOiB1bmRlZmluZWQ7CiAgICAgICAgICBsb2NhbEFuY2hvckEgPSBBcnJheS5pc0FycmF5KGxvY2FsQW5jaG9yQSkgPyBuZXcgVmVjMyguLi5sb2NhbEFuY2hvckEpIDogdW5kZWZpbmVkOwogICAgICAgICAgbG9jYWxBbmNob3JCID0gQXJyYXkuaXNBcnJheShsb2NhbEFuY2hvckIpID8gbmV3IFZlYzMoLi4ubG9jYWxBbmNob3JCKSA6IHVuZGVmaW5lZDsKICAgICAgICAgIGxldCBzcHJpbmcgPSBuZXcgU3ByaW5nKHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgICAgd29ybGRBbmNob3JBLAogICAgICAgICAgICB3b3JsZEFuY2hvckIsCiAgICAgICAgICAgIGxvY2FsQW5jaG9yQSwKICAgICAgICAgICAgbG9jYWxBbmNob3JCLAogICAgICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgICAgICBzdGlmZm5lc3MsCiAgICAgICAgICAgIGRhbXBpbmcKICAgICAgICAgIH0pOwogICAgICAgICAgc3ByaW5nLnV1aWQgPSB1dWlkOwoKICAgICAgICAgIGxldCBwb3N0U3RlcFNwcmluZyA9ICgpID0+IHNwcmluZy5hcHBseUZvcmNlKCk7CgogICAgICAgICAgc3RhdGUuc3ByaW5nc1t1dWlkXSA9IHBvc3RTdGVwU3ByaW5nOwogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW3V1aWRdID0gc3ByaW5nOyAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKCiAgICAgICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbdXVpZF0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nU3RpZmZuZXNzJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0uc3RpZmZuZXNzID0gcHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdSZXN0TGVuZ3RoJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0ucmVzdExlbmd0aCA9IHByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nRGFtcGluZyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW3V1aWRdLmRhbXBpbmcgPSBwcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZVNwcmluZyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW3V1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZFJheSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBmcm9tLAogICAgICAgICAgICB0bywKICAgICAgICAgICAgLi4ub3B0aW9ucwogICAgICAgICAgfSA9IHByb3BzOwogICAgICAgICAgY29uc3QgcmF5ID0gbmV3IFJheShmcm9tID8gbmV3IFZlYzMoLi4uZnJvbSkgOiB1bmRlZmluZWQsIHRvID8gbmV3IFZlYzMoLi4udG8pIDogdW5kZWZpbmVkKTsKICAgICAgICAgIG9wdGlvbnMubW9kZSA9IFJheVtvcHRpb25zLm1vZGUudG9VcHBlckNhc2UoKV07CiAgICAgICAgICBvcHRpb25zLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CgogICAgICAgICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgIGJvZHksCiAgICAgICAgICAgICAgc2hhcGUsCiAgICAgICAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAgICAgICAuLi5yZXN0CiAgICAgICAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgICAgICAgcmF5OiB7CiAgICAgICAgICAgICAgICBmcm9tLAogICAgICAgICAgICAgICAgdG8sCiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJheS5kaXJlY3Rpb24udG9BcnJheSgpLAogICAgICAgICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICAgICAgdXVpZAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYm9keTogYm9keSA/IGJvZHkudXVpZCA6IG51bGwsCiAgICAgICAgICAgICAgc2hhcGU6IHNoYXBlID8geyAuLi5zaGFwZSwKICAgICAgICAgICAgICAgIGJvZHk6IGJvZHkudXVpZAogICAgICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgICAgICAgIC4uLnJlc3QKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW3V1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZVJheSc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbdXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2NoYXNzaXNCb2R5LCB3aGVlbHMsIHdoZWVsSW5mb3MsIGluZGV4Rm9yd2FyZEF4aXMsIGluZGV4UmlnaHRBeGlzLCBpbmRleFVwQXhpc10gPSBwcm9wczsKICAgICAgICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICAgICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgICAgICAgaW5kZXhGb3J3YXJkQXhpczogaW5kZXhGb3J3YXJkQXhpcywKICAgICAgICAgICAgaW5kZXhSaWdodEF4aXM6IGluZGV4UmlnaHRBeGlzLAogICAgICAgICAgICBpbmRleFVwQXhpczogaW5kZXhVcEF4aXMKICAgICAgICAgIH0pOwogICAgICAgICAgdmVoaWNsZS53b3JsZCA9IHN0YXRlLndvcmxkOwoKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCB3aGVlbEluZm8gPSB3aGVlbEluZm9zW2ldOwogICAgICAgICAgICB3aGVlbEluZm8uZGlyZWN0aW9uTG9jYWwgPSBuZXcgVmVjMyguLi53aGVlbEluZm8uZGlyZWN0aW9uTG9jYWwpOwogICAgICAgICAgICB3aGVlbEluZm8uY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsID0gbmV3IFZlYzMoLi4ud2hlZWxJbmZvLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCk7CiAgICAgICAgICAgIHdoZWVsSW5mby5heGxlTG9jYWwgPSBuZXcgVmVjMyguLi53aGVlbEluZm8uYXhsZUxvY2FsKTsKICAgICAgICAgICAgdmVoaWNsZS5hZGRXaGVlbCh3aGVlbEluZm8pOwogICAgICAgICAgfQoKICAgICAgICAgIHZlaGljbGUucHJlU3RlcCA9ICgpID0+IHsKICAgICAgICAgICAgc3RhdGUudmVoaWNsZXNbdXVpZF0udXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZlaGljbGUucG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhdGUudmVoaWNsZXNbdXVpZF0ud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHN0YXRlLnZlaGljbGVzW3V1aWRdLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICAgICAgICAgIGNvbnN0IHQgPSBzdGF0ZS52ZWhpY2xlc1t1dWlkXS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgc3RhdGUudmVoaWNsZXNbdXVpZF0gPSB2ZWhpY2xlOwogICAgICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnZlaGljbGVzW3V1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5wb3N0U3RlcCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnZlaGljbGVzW3V1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5wb3N0U3RlcCk7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1t1dWlkXS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbdXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBwcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW3V1aWRdLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYXBwbHlSYXljYXN0VmVoaWNsZUVuZ2luZUZvcmNlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gcHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1t1dWlkXS5hcHBseUVuZ2luZUZvcmNlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFJheWNhc3RWZWhpY2xlQnJha2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFticmFrZSwgd2hlZWxJbmRleF0gPSBwcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW3V1aWRdLnNldEJyYWtlKGJyYWtlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW3V1aWRdLndha2VVcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2xlZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1t1dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KCkpOwoK",null,!1);var v=new A.Vector3,b=new A.Vector3(1,1,1),y=new A.Quaternion,B=new A.Matrix4;function G(e,t,n){return void 0!==e?(B.compose(v.fromArray(t.positions,3*e),y.fromArray(t.quaternions,4*e),n?n.scale:b),n&&(n.matrixAutoUpdate=!1,n.matrix.copy(B)),B):B.identity()}function w(e){var t=e.children,n=e.shouldInvalidate,r=void 0===n||n,a=e.step,i=void 0===a?1/60:a,o=e.gravity,s=void 0===o?[0,-10,0]:o,c=e.tolerance,h=void 0===c?.001:c,f=e.iterations,p=void 0===f?5:f,v=e.allowSleep,b=void 0!==v&&v,y=e.broadphase,B=void 0===y?"Naive":y,w=e.axisIndex,_=void 0===w?0:w,Z=e.quatNormalizeFast,S=void 0!==Z&&Z,x=e.quatNormalizeSkip,R=void 0===x?0:x,M=e.solver,k=void 0===M?"GS":M,E=e.defaultContactMaterial,W=void 0===E?{contactEquationStiffness:1e6}:E,V=e.size,F=void 0===V?1e3:V,X=Object(I.useThree)().invalidate,H=Object(g.useState)((function(){return new m})),O=Object(l.a)(H,1)[0],L=Object(g.useState)({}),N=Object(l.a)(L,1)[0],Y=Object(g.useState)((function(){return{positions:new Float32Array(3*F),quaternions:new Float32Array(4*F)}})),T=Object(l.a)(Y,1)[0],z=Object(g.useState)({}),K=Object(l.a)(z,1)[0],j=Object(g.useState)({}),D=Object(l.a)(j,1)[0],U=Object(g.useRef)({}),Q=Object(g.useCallback)((function(){0!==T.positions.byteLength&&0!==T.quaternions.byteLength&&O.postMessage(Object(u.a)({op:"step"},T),[T.positions.buffer,T.quaternions.buffer])}),[]);Object(I.useFrame)(Q),Object(g.useLayoutEffect)((function(){O.postMessage({op:"init",props:{gravity:s,tolerance:h,step:i,iterations:p,broadphase:B,allowSleep:b,axisIndex:_,defaultContactMaterial:W,quatNormalizeFast:S,quatNormalizeSkip:R,solver:k}});var e,t=0;return O.onmessage=function(n){switch(n.data.op){case"frame":if(T.positions=n.data.positions,T.quaternions=n.data.quaternions,n.data.bodies)for(t=0;t<n.data.bodies.length;t++)e=n.data.bodies[t],U.current[e]=n.data.bodies.indexOf(e);if(n.data.observations.forEach((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];D[n]&&D[n](r)})),n.data.active){for(var a=0,i=Object.values(N);a<i.length;a++){var o=i[a];if(o instanceof A.InstancedMesh)for(var s=0;s<o.count;s++){var c=U.current["".concat(o.uuid,"/").concat(s)];void 0!==c&&o.setMatrixAt(s,G(c,T)),o.instanceMatrix.needsUpdate=!0}else G(U.current[o.uuid],T,o)}r&&X()}break;case"event":switch(n.data.type){case"collide":K[n.data.target](Object(u.a)(Object(u.a)({},n.data),{},{target:N[n.data.target],body:N[n.data.body],contact:Object(u.a)(Object(u.a)({},n.data.contact),{},{bi:N[n.data.contact.bi],bj:N[n.data.contact.bj]})}));break;case"collideBegin":K[n.data.bodyA]&&K[n.data.bodyA]({op:"event",type:"collideBegin",target:N[n.data.bodyA],body:N[n.data.bodyB]}),K[n.data.bodyB]&&K[n.data.bodyB]({op:"event",type:"collideBegin",target:N[n.data.bodyB],body:N[n.data.bodyA]});break;case"collideEnd":K[n.data.bodyA]&&K[n.data.bodyA]({op:"event",type:"collideEnd",target:N[n.data.bodyA],body:N[n.data.bodyB]}),K[n.data.bodyB]&&K[n.data.bodyB]({op:"event",type:"collideEnd",target:N[n.data.bodyB],body:N[n.data.bodyA]});break;case"rayhit":if(!K[n.data.ray.uuid])break;K[n.data.ray.uuid](Object(u.a)(Object(u.a)({},n.data),{},{body:n.data.body?N[n.data.body]:null}))}}},function(){return O.terminate()}}),[]),function(e){var t=e.worker,n=e.gravity,r=e.tolerance,a=e.step,i=e.iterations,o=e.broadphase,s=e.axisIndex;Object(g.useEffect)((function(){t.postMessage({op:"setGravity",props:n})}),[n]),Object(g.useEffect)((function(){t.postMessage({op:"setTolerance",props:r})}),[r]),Object(g.useEffect)((function(){t.postMessage({op:"setStep",props:a})}),[a]),Object(g.useEffect)((function(){t.postMessage({op:"setIterations",props:i})}),[i]),Object(g.useEffect)((function(){t.postMessage({op:"setBroadphase",props:o})}),[o]),Object(g.useEffect)((function(){t.postMessage({op:"setAxisIndex",props:s})}),[s])}({worker:O,axisIndex:_,broadphase:B,gravity:s,iterations:p,step:i,tolerance:h});var P=Object(g.useMemo)((function(){return{worker:O,bodies:U,refs:N,buffers:T,events:K,subscriptions:D}}),[O,U,N,T,K,D]);return d.a.createElement(C.Provider,{value:P},t)}var _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0];Object(s.a)(this,e),this.elements=void 0,this.elements=t}return Object(c.a)(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S,t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S,n=this.elements,r=e.x,a=e.y,i=e.z;return t.x=n[0]*r+n[1]*a+n[2]*i,t.y=n[3]*r+n[4]*a+n[5]*i,t.z=n[6]*r+n[7]*a+n[8]*i,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,r=this.elements,a=t.elements,i=n.elements,o=r[0],s=r[1],c=r[2],u=r[3],l=r[4],g=r[5],d=r[6],I=r[7],A=r[8],h=a[0],C=a[1],f=a[2],p=a[3],m=a[4],v=a[5],b=a[6],y=a[7],B=a[8];return i[0]=o*h+s*p+c*b,i[1]=o*C+s*m+c*y,i[2]=o*f+s*v+c*B,i[3]=u*h+l*p+g*b,i[4]=u*C+l*m+g*y,i[5]=u*f+l*v+g*B,i[6]=d*h+I*p+A*b,i[7]=d*C+I*m+A*y,i[8]=d*f+I*v+A*B,n}},{key:"scale",value:function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,r=this.elements,a=n.elements,i=0;3!==i;i++)a[3*i+0]=t.x*r[3*i+0],a[3*i+1]=t.y*r[3*i+1],a[3*i+2]=t.z*r[3*i+2];return n}},{key:"solve",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S,a=3,i=4,o=[];for(t=0;t<a*i;t++)o.push(0);for(t=0;t<3;t++)for(n=0;n<3;n++)o[t+i*n]=this.elements[t+3*n];o[3]=e.x,o[7]=e.y,o[11]=e.z;var s,c,u=3,l=u,g=4;do{if(0===o[(t=l-u)+i*t])for(n=t+1;n<l;n++)if(0!==o[t+i*n]){s=g;do{o[(c=g-s)+i*t]+=o[c+i*n]}while(--s);break}if(0!==o[t+i*t])for(n=t+1;n<l;n++){var d=o[t+i*n]/o[t+i*t];s=g;do{o[(c=g-s)+i*n]=c<=t?0:o[c+i*n]-o[c+i*t]*d}while(--s)}}while(--u);if(r.z=o[2*i+3]/o[2*i+2],r.y=(o[1*i+3]-o[1*i+2]*r.z)/o[1*i+1],r.x=(o[0*i+3]-o[0*i+2]*r.z-o[0*i+1]*r.y)/o[0*i+0],isNaN(r.x)||isNaN(r.y)||isNaN(r.z)||r.x===1/0||r.y===1/0||r.z===1/0)throw"Could not solve equation! Got x=["+r.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return r}},{key:"e",value:function(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e}},{key:"reverse",value:function(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,a=3,i=6,o=Z;for(t=0;t<3;t++)for(n=0;n<3;n++)o[t+i*n]=this.elements[t+3*n];o[3]=1,o[9]=0,o[15]=0,o[4]=0,o[10]=1,o[16]=0,o[5]=0,o[11]=0,o[17]=1;var s,c,u=3,l=u,g=i;do{if(0===o[(t=l-u)+i*t])for(n=t+1;n<l;n++)if(0!==o[t+i*n]){s=g;do{o[(c=g-s)+i*t]+=o[c+i*n]}while(--s);break}if(0!==o[t+i*t])for(n=t+1;n<l;n++){var d=o[t+i*n]/o[t+i*t];s=g;do{o[(c=g-s)+i*n]=c<=t?0:o[c+i*n]-o[c+i*t]*d}while(--s)}}while(--u);t=2;do{n=t-1;do{var I=o[t+i*n]/o[t+i*t];s=i;do{o[(c=i-s)+i*n]=o[c+i*n]-o[c+i*t]*I}while(--s)}while(n--)}while(--t);t=2;do{var A=1/o[t+i*t];s=i;do{o[(c=i-s)+i*t]=o[c+i*t]*A}while(--s)}while(t--);t=2;do{n=2;do{if(c=o[a+n+i*t],isNaN(c)||c===1/0)throw"Could not reverse! A=["+this.toString()+"]";r.e(t,n,c)}while(n--)}while(t--);return r}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,n=e.y,r=e.z,a=e.w,i=t+t,o=n+n,s=r+r,c=t*i,u=t*o,l=t*s,g=n*o,d=n*s,I=r*s,A=a*i,h=a*o,C=a*s,f=this.elements;return f[0]=1-(g+I),f[1]=u-C,f[2]=l+h,f[3]=u+C,f[4]=1-(c+I),f[5]=d-A,f[6]=l-h,f[7]=d+A,f[8]=1-(c+g),this}},{key:"transpose",value:function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,r=this.elements,a=n.elements;return a[0]=r[0],a[4]=r[4],a[8]=r[8],t=r[1],a[1]=r[3],a[3]=t,t=r[2],a[2]=r[6],a[6]=t,t=r[5],a[5]=r[7],a[7]=t,n}}]),e}(),Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s.a)(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.x=t,this.y=n,this.z=r}return Object(c.a)(e,[{key:"cross",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,r=t.x,a=t.y,i=t.z,o=this.x,s=this.y,c=this.z;return n.x=s*i-c*a,n.y=c*r-o*i,n.z=o*a-s*r,n}},{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,n){if(!n)return new e(this.x+t.x,this.y+t.y,this.z+t.z);n.x=t.x+this.x,n.y=t.y+this.y,n.z=t.z+this.z}},{key:"vsub",value:function(t,n){if(!n)return new e(this.x-t.x,this.y-t.y,this.z-t.z);n.x=this.x-t.x,n.y=this.y-t.y,n.z=this.z-t.z}},{key:"crossmat",value:function(){return new _([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,n=this.z,r=Math.sqrt(e*e+t*t+n*n);if(r>0){var a=1/r;this.x*=a,this.y*=a,this.z*=a}else this.x=0,this.y=0,this.z=0;return r}},{key:"unit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,n=this.x,r=this.y,a=this.z,i=Math.sqrt(n*n+r*r+a*a);return i>0?(i=1/i,t.x=n*i,t.y=r*i,t.z=a*i):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z;return Math.sqrt((a-t)*(a-t)+(i-n)*(i-n)+(o-r)*(o-r))}},{key:"distanceSquared",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z;return(a-t)*(a-t)+(i-n)*(i-n)+(o-r)*(o-r)}},{key:"scale",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,r=this.x,a=this.y,i=this.z;return n.x=t*r,n.y=t*a,n.z=t*i,n}},{key:"vmul",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return n.x=t.x*this.x,n.y=t.y*this.y,n.z=t.z*this.z,n}},{key:"addScaledVector",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e;return r.x=this.x+t*n.x,r.y=this.y+t*n.y,r.z=this.z+t*n.z,r}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var n=this.length();if(n>0){var r=x,a=1/n;r.set(this.x*a,this.y*a,this.z*a);var i=R;Math.abs(r.x)<.9?(i.set(1,0,0),r.cross(i,e)):(i.set(0,1,0),r.cross(i,e)),r.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,n){var r=this.x,a=this.y,i=this.z;n.x=r+(e.x-r)*t,n.y=a+(e.y-a)*t,n.z=i+(e.z-i)*t}},{key:"almostEquals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-6;return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(M),M.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();S.ZERO=void 0,S.UNIT_X=void 0,S.UNIT_Y=void 0,S.UNIT_Z=void 0,S.ZERO=new S(0,0,0),S.UNIT_X=new S(1,0,0),S.UNIT_Y=new S(0,1,0),S.UNIT_Z=new S(0,0,1);var x=new S,R=new S,M=new S,k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new S,this.upperBound=new S,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return Object(c.a)(e,[{key:"setFromPoints",value:function(e,t,n,r){var a=this.lowerBound,i=this.upperBound,o=n;a.copy(e[0]),o&&o.vmult(a,a),i.copy(a);for(var s=1;s<e.length;s++){var c=e[s];o&&(o.vmult(c,E),c=E),c.x>i.x&&(i.x=c.x),c.x<a.x&&(a.x=c.x),c.y>i.y&&(i.y=c.y),c.y<a.y&&(a.y=c.y),c.z>i.z&&(i.z=c.z),c.z<a.z&&(a.z=c.z)}return t&&(t.vadd(a,a),t.vadd(i,i)),r&&(a.x-=r,a.y-=r,a.z-=r,i.x+=r,i.y+=r,i.z+=r),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,n=this.upperBound,r=e.lowerBound,a=e.upperBound,i=r.x<=n.x&&n.x<=a.x||t.x<=a.x&&a.x<=n.x,o=r.y<=n.y&&n.y<=a.y||t.y<=a.y&&a.y<=n.y,s=r.z<=n.z&&n.z<=a.z||t.z<=a.z&&a.z<=n.z;return i&&o&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,n=this.upperBound,r=e.lowerBound,a=e.upperBound;return t.x<=r.x&&n.x>=a.x&&t.y<=r.y&&n.y>=a.y&&t.z<=r.z&&n.z>=a.z}},{key:"getCorners",value:function(e,t,n,r,a,i,o,s){var c=this.lowerBound,u=this.upperBound;e.copy(c),t.set(u.x,c.y,c.z),n.set(u.x,u.y,c.z),r.set(c.x,u.y,u.z),a.set(u.x,c.y,u.z),i.set(c.x,u.y,c.z),o.set(c.x,c.y,u.z),s.copy(u)}},{key:"toLocalFrame",value:function(e,t){var n=W,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=n[5],u=n[6],l=n[7];this.getCorners(r,a,i,o,s,c,u,l);for(var g=0;8!==g;g++){var d=n[g];e.pointToLocal(d,d)}return t.setFromPoints(n)}},{key:"toWorldFrame",value:function(e,t){var n=W,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=n[5],u=n[6],l=n[7];this.getCorners(r,a,i,o,s,c,u,l);for(var g=0;8!==g;g++){var d=n[g];e.pointToWorld(d,d)}return t.setFromPoints(n)}},{key:"overlapsRay",value:function(e){var t=e.direction,n=e.from,r=1/t.x,a=1/t.y,i=1/t.z,o=(this.lowerBound.x-n.x)*r,s=(this.upperBound.x-n.x)*r,c=(this.lowerBound.y-n.y)*a,u=(this.upperBound.y-n.y)*a,l=(this.lowerBound.z-n.z)*i,g=(this.upperBound.z-n.z)*i,d=Math.max(Math.max(Math.min(o,s),Math.min(c,u)),Math.min(l,g)),I=Math.min(Math.min(Math.max(o,s),Math.max(c,u)),Math.max(l,g));return!(I<0)&&!(d>I)}}]),e}(),E=new S,W=[new S,new S,new S,new S,new S,new S,new S,new S],V=function(){function e(){Object(s.a)(this,e),this._listeners=void 0}return Object(c.a)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}},{key:"hasAnyEventListener",value:function(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}},{key:"removeEventListener",value:function(e,t){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[e])return this;var r=n[e].indexOf(t);return-1!==r&&n[e].splice(r,1),this}},{key:"dispatchEvent",value:function(e){if(void 0===this._listeners)return this;var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=0,r=t.length;n<r;n++)t[n].call(this,e)}return this}}]),e}(),F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(s.a)(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=t,this.y=n,this.z=r,this.w=a}return Object(c.a)(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z+","+this.w}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S;this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var n=X,r=H;e.tangents(n,r),this.setFromAxisAngle(n,Math.PI)}else{var a=e.cross(t);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,r=this.x,a=this.y,i=this.z,o=this.w,s=t.x,c=t.y,u=t.z,l=t.w;return n.x=r*l+o*s+a*u-i*c,n.y=a*l+o*c+i*s-r*u,n.z=i*l+o*u+r*c-a*s,n.w=o*l-r*s-a*c-i*u,n}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,n=this.x,r=this.y,a=this.z,i=this.w;this.conjugate(t);var o=1/(n*n+r*r+a*a+i*i);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S,n=e.x,r=e.y,a=e.z,i=this.x,o=this.y,s=this.z,c=this.w,u=c*n+o*a-s*r,l=c*r+s*n-i*a,g=c*a+i*r-o*n,d=-i*n-o*r-s*a;return t.x=u*c+d*-i+l*-s-g*-o,t.y=l*c+d*-o+g*-i-u*-s,t.z=g*c+d*-s+u*-o-l*-i,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e){var t,n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YZX",i=this.x,o=this.y,s=this.z,c=this.w;if("YZX"!==a)throw new Error("Euler order "+a+" not supported yet.");var u=i*o+s*c;if(u>.499&&(t=2*Math.atan2(i,c),n=Math.PI/2,r=0),u<-.499&&(t=-2*Math.atan2(i,c),n=-Math.PI/2,r=0),void 0===t){var l=i*i,g=o*o,d=s*s;t=Math.atan2(2*o*c-2*i*s,1-2*g-2*d),n=Math.asin(2*u),r=Math.atan2(2*i*c-2*o*s,1-2*l-2*d)}e.y=t,e.z=n,e.x=r}},{key:"setFromEuler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",a=Math.cos(e/2),i=Math.cos(t/2),o=Math.cos(n/2),s=Math.sin(e/2),c=Math.sin(t/2),u=Math.sin(n/2);return"XYZ"===r?(this.x=s*i*o+a*c*u,this.y=a*c*o-s*i*u,this.z=a*i*u+s*c*o,this.w=a*i*o-s*c*u):"YXZ"===r?(this.x=s*i*o+a*c*u,this.y=a*c*o-s*i*u,this.z=a*i*u-s*c*o,this.w=a*i*o+s*c*u):"ZXY"===r?(this.x=s*i*o-a*c*u,this.y=a*c*o+s*i*u,this.z=a*i*u+s*c*o,this.w=a*i*o-s*c*u):"ZYX"===r?(this.x=s*i*o-a*c*u,this.y=a*c*o+s*i*u,this.z=a*i*u-s*c*o,this.w=a*i*o+s*c*u):"YZX"===r?(this.x=s*i*o+a*c*u,this.y=a*c*o+s*i*u,this.z=a*i*u-s*c*o,this.w=a*i*o-s*c*u):"XZY"===r&&(this.x=s*i*o-a*c*u,this.y=a*c*o-s*i*u,this.z=a*i*u+s*c*o,this.w=a*i*o+s*c*u),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,n){var r,a,i,o,s,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e,u=this.x,l=this.y,g=this.z,d=this.w,I=t.x,A=t.y,h=t.z,C=t.w;return(a=u*I+l*A+g*h+d*C)<0&&(a=-a,I=-I,A=-A,h=-h,C=-C),1-a>1e-6?(r=Math.acos(a),i=Math.sin(r),o=Math.sin((1-n)*r)/i,s=Math.sin(n*r)/i):(o=1-n,s=n),c.x=o*u+s*I,c.y=o*l+s*A,c.z=o*g+s*h,c.w=o*d+s*C,c}},{key:"integrate",value:function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e,i=t.x*r.x,o=t.y*r.y,s=t.z*r.z,c=this.x,u=this.y,l=this.z,g=this.w,d=.5*n;return a.x+=d*(i*g+o*l-s*u),a.y+=d*(o*g+s*c-i*l),a.z+=d*(s*g+i*u-o*c),a.w+=d*(-i*c-o*u-s*l),a}}]),e}(),X=new S,H=new S,O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return Object(c.a)(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}},{key:"volume",value:function(){throw"volume() not implemented for shape type "+this.type}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}},{key:"calculateWorldAABB",value:function(e,t,n,r){throw"calculateWorldAABB() not implemented for shape type "+this.type}}]),e}();O.idCounter=0,O.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};var L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.position=void 0,this.quaternion=void 0,this.position=new S,this.quaternion=new F,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return Object(c.a)(e,[{key:"pointToLocal",value:function(t,n){return e.pointToLocalFrame(this.position,this.quaternion,t,n)}},{key:"pointToWorld",value:function(t,n){return e.pointToWorldFrame(this.position,this.quaternion,t,n)}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S;return n.vsub(e,r),t.conjugate(N),N.vmult(r,r),r}},{key:"pointToWorldFrame",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S;return t.vmult(n,r),r.vadd(e,r),r}},{key:"vectorToWorldFrame",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S;return e.vmult(t,n),n}},{key:"vectorToLocalFrame",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S;return t.w*=-1,t.vmult(n,r),t.w*=-1,r}}]),e}(),N=new F,Y=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,n);var a=r.vertices,i=void 0===a?[]:a,o=r.faces,c=void 0===o?[]:o,u=r.normals,l=void 0===u?[]:u,g=r.axes,d=r.boundingSphereRadius;return(e=t.call(this,{type:O.types.CONVEXPOLYHEDRON})).vertices=void 0,e.faces=void 0,e.faceNormals=void 0,e.worldVertices=void 0,e.worldVerticesNeedsUpdate=void 0,e.worldFaceNormals=void 0,e.worldFaceNormalsNeedsUpdate=void 0,e.uniqueAxes=void 0,e.uniqueEdges=void 0,e.vertices=i,e.faces=c,e.faceNormals=l,0===e.faceNormals.length&&e.computeNormals(),d?e.boundingSphereRadius=d:e.updateBoundingSphereRadius(),e.worldVertices=[],e.worldVerticesNeedsUpdate=!0,e.worldFaceNormals=[],e.worldFaceNormalsNeedsUpdate=!0,e.uniqueAxes=g?g.slice():null,e.uniqueEdges=[],e.computeEdges(),e}return Object(c.a)(n,[{key:"computeEdges",value:function(){var e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;for(var r=new S,a=0;a!==e.length;a++)for(var i=e[a],o=i.length,s=0;s!==o;s++){var c=(s+1)%o;t[i[s]].vsub(t[i[c]],r),r.normalize();for(var u=!1,l=0;l!==n.length;l++)if(n[l].almostEquals(r)||n[l].almostEquals(r)){u=!0;break}u||n.push(r.clone())}}},{key:"computeNormals",value:function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var n=this.faceNormals[e]||new S;this.getFaceNormal(e,n),n.negate(n),this.faceNormals[e]=n;var r=this.vertices[this.faces[e][0]];if(n.dot(r)<0){console.error(".faceNormals["+e+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var a=0;a<this.faces[e].length;a++)console.warn(".vertices["+this.faces[e][a]+"] = Vec3("+this.vertices[this.faces[e][a]].toString()+")")}}}},{key:"getFaceNormal",value:function(e,t){var r=this.faces[e],a=this.vertices[r[0]],i=this.vertices[r[1]],o=this.vertices[r[2]];n.computeNormal(a,i,o,t)}},{key:"clipAgainstHull",value:function(e,t,n,r,a,i,o,s,c){for(var u=new S,l=-1,g=-Number.MAX_VALUE,d=0;d<n.faces.length;d++){u.copy(n.faceNormals[d]),a.vmult(u,u);var I=u.dot(i);I>g&&(g=I,l=d)}for(var A=[],h=0;h<n.faces[l].length;h++){var C=n.vertices[n.faces[l][h]],f=new S;f.copy(C),a.vmult(f,f),r.vadd(f,f),A.push(f)}l>=0&&this.clipFaceAgainstHull(i,e,t,A,o,s,c)}},{key:"findSeparatingAxis",value:function(e,t,n,r,a,i,o,s){var c=new S,u=new S,l=new S,g=new S,d=new S,I=new S,A=Number.MAX_VALUE,h=this;if(h.uniqueAxes)for(var C=0;C!==h.uniqueAxes.length;C++){n.vmult(h.uniqueAxes[C],c);var f=h.testSepAxis(c,e,t,n,r,a);if(!1===f)return!1;f<A&&(A=f,i.copy(c))}else for(var p=o?o.length:h.faces.length,m=0;m<p;m++){var v=o?o[m]:m;c.copy(h.faceNormals[v]),n.vmult(c,c);var b=h.testSepAxis(c,e,t,n,r,a);if(!1===b)return!1;b<A&&(A=b,i.copy(c))}if(e.uniqueAxes)for(var y=0;y!==e.uniqueAxes.length;y++){a.vmult(e.uniqueAxes[y],u);var B=h.testSepAxis(u,e,t,n,r,a);if(!1===B)return!1;B<A&&(A=B,i.copy(u))}else for(var G=s?s.length:e.faces.length,w=0;w<G;w++){var _=s?s[w]:w;u.copy(e.faceNormals[_]),a.vmult(u,u);var Z=h.testSepAxis(u,e,t,n,r,a);if(!1===Z)return!1;Z<A&&(A=Z,i.copy(u))}for(var x=0;x!==h.uniqueEdges.length;x++){n.vmult(h.uniqueEdges[x],g);for(var R=0;R!==e.uniqueEdges.length;R++)if(a.vmult(e.uniqueEdges[R],d),g.cross(d,I),!I.almostZero()){I.normalize();var M=h.testSepAxis(I,e,t,n,r,a);if(!1===M)return!1;M<A&&(A=M,i.copy(I))}}return r.vsub(t,l),l.dot(i)>0&&i.negate(i),!0}},{key:"testSepAxis",value:function(e,t,r,a,i,o){n.project(this,e,r,a,T),n.project(t,e,i,o,z);var s=T[0],c=T[1],u=z[0],l=z[1];if(s<l||u<c)return!1;var g=s-l,d=u-c;return g<d?g:d}},{key:"calculateLocalInertia",value:function(e,t){var n=new S,r=new S;this.computeLocalAABB(r,n);var a=n.x-r.x,i=n.y-r.y,o=n.z-r.z;t.x=1/12*e*(2*i*2*i+2*o*2*o),t.y=1/12*e*(2*a*2*a+2*o*2*o),t.z=1/12*e*(2*i*2*i+2*a*2*a)}},{key:"getPlaneConstantOfFace",value:function(e){var t=this.faces[e],n=this.faceNormals[e],r=this.vertices[t[0]];return-n.dot(r)}},{key:"clipFaceAgainstHull",value:function(e,t,n,r,a,i,o){for(var s=new S,c=new S,u=new S,l=new S,g=new S,d=new S,I=new S,A=new S,h=this,C=r,f=[],p=-1,m=Number.MAX_VALUE,v=0;v<h.faces.length;v++){s.copy(h.faceNormals[v]),n.vmult(s,s);var b=s.dot(e);b<m&&(m=b,p=v)}if(!(p<0)){var y=h.faces[p];y.connectedFaces=[];for(var B=0;B<h.faces.length;B++)for(var G=0;G<h.faces[B].length;G++)-1!==y.indexOf(h.faces[B][G])&&B!==p&&-1===y.connectedFaces.indexOf(B)&&y.connectedFaces.push(B);for(var w=y.length,_=0;_<w;_++){var Z=h.vertices[y[_]],x=h.vertices[y[(_+1)%w]];Z.vsub(x,c),u.copy(c),n.vmult(u,u),t.vadd(u,u),l.copy(this.faceNormals[p]),n.vmult(l,l),t.vadd(l,l),u.cross(l,g),g.negate(g),d.copy(Z),n.vmult(d,d),t.vadd(d,d);var R=y.connectedFaces[_];I.copy(this.faceNormals[R]);var M=this.getPlaneConstantOfFace(R);A.copy(I),n.vmult(A,A);var k=M-A.dot(t);for(this.clipFaceAgainstPlane(C,f,A,k);C.length;)C.shift();for(;f.length;)C.push(f.shift())}I.copy(this.faceNormals[p]);var E=this.getPlaneConstantOfFace(p);A.copy(I),n.vmult(A,A);for(var W=E-A.dot(t),V=0;V<C.length;V++){var F=A.dot(C[V])+W;if(F<=a&&(console.log("clamped: depth="+F+" to minDist="+a),F=a),F<=i){var X=C[V];if(F<=1e-6){var H={point:X,normal:A,depth:F};o.push(H)}}}}}},{key:"clipFaceAgainstPlane",value:function(e,t,n,r){var a,i,o=e.length;if(o<2)return t;var s=e[e.length-1],c=e[0];a=n.dot(s)+r;for(var u=0;u<o;u++){if(c=e[u],i=n.dot(c)+r,a<0)if(i<0){var l=new S;l.copy(c),t.push(l)}else{var g=new S;s.lerp(c,a/(a-i),g),t.push(g)}else if(i<0){var d=new S;s.lerp(c,a/(a-i),d),t.push(d),t.push(c)}s=c,a=i}return t}},{key:"computeWorldVertices",value:function(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new S);for(var n=this.vertices,r=this.worldVertices,a=0;a!==this.vertices.length;a++)t.vmult(n[a],r[a]),e.vadd(r[a],r[a]);this.worldVerticesNeedsUpdate=!1}},{key:"computeLocalAABB",value:function(e,t){var n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<this.vertices.length;r++){var a=n[r];a.x<e.x?e.x=a.x:a.x>t.x&&(t.x=a.x),a.y<e.y?e.y=a.y:a.y>t.y&&(t.y=a.y),a.z<e.z?e.z=a.z:a.z>t.z&&(t.z=a.z)}}},{key:"computeWorldFaceNormals",value:function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new S);for(var n=this.faceNormals,r=this.worldFaceNormals,a=0;a!==t;a++)e.vmult(n[a],r[a]);this.worldFaceNormalsNeedsUpdate=!1}},{key:"updateBoundingSphereRadius",value:function(){for(var e=0,t=this.vertices,n=0;n!==t.length;n++){var r=t[n].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}},{key:"calculateWorldAABB",value:function(e,t,n,r){for(var a,i,o,s,c,u,l=this.vertices,g=new S,d=0;d<l.length;d++){g.copy(l[d]),t.vmult(g,g),e.vadd(g,g);var I=g;(void 0===a||I.x<a)&&(a=I.x),(void 0===s||I.x>s)&&(s=I.x),(void 0===i||I.y<i)&&(i=I.y),(void 0===c||I.y>c)&&(c=I.y),(void 0===o||I.z<o)&&(o=I.z),(void 0===u||I.z>u)&&(u=I.z)}n.set(a,i,o),r.set(s,c,u)}},{key:"volume",value:function(){return 4*Math.PI*this.boundingSphereRadius/3}},{key:"getAveragePointLocal",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S,t=this.vertices,n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}},{key:"transformAllPoints",value:function(e,t){var n=this.vertices.length,r=this.vertices;if(t){for(var a=0;a<n;a++){var i=r[a];t.vmult(i,i)}for(var o=0;o<this.faceNormals.length;o++){var s=this.faceNormals[o];t.vmult(s,s)}}if(e)for(var c=0;c<n;c++){var u=r[c];u.vadd(e,u)}}},{key:"pointIsInside",value:function(e){var t=this.vertices,n=this.faces,r=this.faceNormals,a=new S;this.getAveragePointLocal(a);for(var i=0;i<this.faces.length;i++){var o=r[i],s=t[n[i][0]],c=new S;e.vsub(s,c);var u=o.dot(c),l=new S;a.vsub(s,l);var g=o.dot(l);if(u<0&&g>0||u>0&&g<0)return!1}return-1}}],[{key:"computeNormal",value:function(e,t,n,r){var a=new S,i=new S;t.vsub(e,i),n.vsub(t,a),a.cross(i,r),r.isZero()||r.normalize()}},{key:"project",value:function(e,t,n,r,a){var i=e.vertices.length,o=K,s=0,c=0,u=j,l=e.vertices;u.setZero(),L.vectorToLocalFrame(n,r,t,o),L.pointToLocalFrame(n,r,u,u);var g=u.dot(o);c=s=l[0].dot(o);for(var d=1;d<i;d++){var I=l[d].dot(o);I>s&&(s=I),I<c&&(c=I)}if((c-=g)>(s-=g)){var A=c;c=s,s=A}a[0]=s,a[1]=c}}]),n}(O),T=[],z=[],K=new S,j=new S,D=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,{type:O.types.BOX})).halfExtents=void 0,r.convexPolyhedronRepresentation=void 0,r.halfExtents=e,r.convexPolyhedronRepresentation=null,r.updateConvexPolyhedronRepresentation(),r.updateBoundingSphereRadius(),r}return Object(c.a)(n,[{key:"updateConvexPolyhedronRepresentation",value:function(){var e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,r=S,a=[new r(-e,-t,-n),new r(e,-t,-n),new r(e,t,-n),new r(-e,t,-n),new r(-e,-t,n),new r(e,-t,n),new r(e,t,n),new r(-e,t,n)],i=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],o=new Y({vertices:a,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:i});this.convexPolyhedronRepresentation=o,o.material=this.material}},{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return n.calculateInertia(this.halfExtents,e,t),t}},{key:"getSideNormals",value:function(e,t){var n=e,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),void 0!==t)for(var a=0;a!==n.length;a++)t.vmult(n[a],n[a]);return n}},{key:"volume",value:function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.halfExtents.length()}},{key:"forEachWorldCorner",value:function(e,t,n){for(var r=this.halfExtents,a=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]],i=0;i<a.length;i++)U.set(a[i][0],a[i][1],a[i][2]),t.vmult(U,U),e.vadd(U,U),n(U.x,U.y,U.z)}},{key:"calculateWorldAABB",value:function(e,t,n,r){var a=this.halfExtents;Q[0].set(a.x,a.y,a.z),Q[1].set(-a.x,a.y,a.z),Q[2].set(-a.x,-a.y,a.z),Q[3].set(-a.x,-a.y,-a.z),Q[4].set(a.x,-a.y,-a.z),Q[5].set(a.x,a.y,-a.z),Q[6].set(-a.x,a.y,-a.z),Q[7].set(a.x,-a.y,a.z);var i=Q[0];t.vmult(i,i),e.vadd(i,i),r.copy(i),n.copy(i);for(var o=1;o<8;o++){var s=Q[o];t.vmult(s,s),e.vadd(s,s);var c=s.x,u=s.y,l=s.z;c>r.x&&(r.x=c),u>r.y&&(r.y=u),l>r.z&&(r.z=l),c<n.x&&(n.x=c),u<n.y&&(n.y=u),l<n.z&&(n.z=l)}}}],[{key:"calculateInertia",value:function(e,t,n){var r=e;n.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x)}}]),n}(O),U=new S,Q=[new S,new S,new S,new S,new S,new S,new S,new S],P=1,J=2,q=4,$=0,ee=1,te=2,ne=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,n),(e=t.call(this)).id=void 0,e.index=void 0,e.world=void 0,e.preStep=void 0,e.postStep=void 0,e.vlambda=void 0,e.collisionFilterGroup=void 0,e.collisionFilterMask=void 0,e.collisionResponse=void 0,e.position=void 0,e.previousPosition=void 0,e.interpolatedPosition=void 0,e.initPosition=void 0,e.velocity=void 0,e.initVelocity=void 0,e.force=void 0,e.mass=void 0,e.invMass=void 0,e.material=void 0,e.linearDamping=void 0,e.type=void 0,e.allowSleep=void 0,e.sleepState=void 0,e.sleepSpeedLimit=void 0,e.sleepTimeLimit=void 0,e.timeLastSleepy=void 0,e.wakeUpAfterNarrowphase=void 0,e.torque=void 0,e.quaternion=void 0,e.initQuaternion=void 0,e.previousQuaternion=void 0,e.interpolatedQuaternion=void 0,e.angularVelocity=void 0,e.initAngularVelocity=void 0,e.shapes=void 0,e.shapeOffsets=void 0,e.shapeOrientations=void 0,e.inertia=void 0,e.invInertia=void 0,e.invInertiaWorld=void 0,e.invMassSolve=void 0,e.invInertiaSolve=void 0,e.invInertiaWorldSolve=void 0,e.fixedRotation=void 0,e.angularDamping=void 0,e.linearFactor=void 0,e.angularFactor=void 0,e.aabb=void 0,e.aabbNeedsUpdate=void 0,e.boundingRadius=void 0,e.wlambda=void 0,e.isTrigger=void 0,e.id=n.idCounter++,e.index=-1,e.world=null,e.preStep=null,e.postStep=null,e.vlambda=new S,e.collisionFilterGroup="number"===typeof r.collisionFilterGroup?r.collisionFilterGroup:1,e.collisionFilterMask="number"===typeof r.collisionFilterMask?r.collisionFilterMask:-1,e.collisionResponse="boolean"!==typeof r.collisionResponse||r.collisionResponse,e.position=new S,e.previousPosition=new S,e.interpolatedPosition=new S,e.initPosition=new S,r.position&&(e.position.copy(r.position),e.previousPosition.copy(r.position),e.interpolatedPosition.copy(r.position),e.initPosition.copy(r.position)),e.velocity=new S,r.velocity&&e.velocity.copy(r.velocity),e.initVelocity=new S,e.force=new S;var a="number"===typeof r.mass?r.mass:0;return e.mass=a,e.invMass=a>0?1/a:0,e.material=r.material||null,e.linearDamping="number"===typeof r.linearDamping?r.linearDamping:.01,e.type=a<=0?n.STATIC:n.DYNAMIC,typeof r.type===typeof n.STATIC&&(e.type=r.type),e.allowSleep="undefined"===typeof r.allowSleep||r.allowSleep,e.sleepState=n.AWAKE,e.sleepSpeedLimit="undefined"!==typeof r.sleepSpeedLimit?r.sleepSpeedLimit:.1,e.sleepTimeLimit="undefined"!==typeof r.sleepTimeLimit?r.sleepTimeLimit:1,e.timeLastSleepy=0,e.wakeUpAfterNarrowphase=!1,e.torque=new S,e.quaternion=new F,e.initQuaternion=new F,e.previousQuaternion=new F,e.interpolatedQuaternion=new F,r.quaternion&&(e.quaternion.copy(r.quaternion),e.initQuaternion.copy(r.quaternion),e.previousQuaternion.copy(r.quaternion),e.interpolatedQuaternion.copy(r.quaternion)),e.angularVelocity=new S,r.angularVelocity&&e.angularVelocity.copy(r.angularVelocity),e.initAngularVelocity=new S,e.shapes=[],e.shapeOffsets=[],e.shapeOrientations=[],e.inertia=new S,e.invInertia=new S,e.invInertiaWorld=new _,e.invMassSolve=0,e.invInertiaSolve=new S,e.invInertiaWorldSolve=new _,e.fixedRotation="undefined"!==typeof r.fixedRotation&&r.fixedRotation,e.angularDamping="undefined"!==typeof r.angularDamping?r.angularDamping:.01,e.linearFactor=new S(1,1,1),r.linearFactor&&e.linearFactor.copy(r.linearFactor),e.angularFactor=new S(1,1,1),r.angularFactor&&e.angularFactor.copy(r.angularFactor),e.aabb=new k,e.aabbNeedsUpdate=!0,e.boundingRadius=0,e.wlambda=new S,e.isTrigger=Boolean(r.isTrigger),r.shape&&e.addShape(r.shape),e.updateMassProperties(),e}return Object(c.a)(n,[{key:"wakeUp",value:function(){var e=this.sleepState;this.sleepState=n.AWAKE,this.wakeUpAfterNarrowphase=!1,e===n.SLEEPING&&this.dispatchEvent(n.wakeupEvent)}},{key:"sleep",value:function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}},{key:"sleepTick",value:function(e){if(this.allowSleep){var t=this.sleepState,r=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),a=Math.pow(this.sleepSpeedLimit,2);t===n.AWAKE&&r<a?(this.sleepState=n.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(n.sleepyEvent)):t===n.SLEEPY&&r>a?this.wakeUp():t===n.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}}},{key:"updateSolveMassProperties",value:function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}},{key:"pointToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}},{key:"vectorToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return this.quaternion.conjugate().vmult(e,t),t}},{key:"pointToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;return this.quaternion.vmult(e,t),t}},{key:"addShape",value:function(e,t,n){var r=new S,a=new F;return t&&r.copy(t),n&&a.copy(n),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}},{key:"updateBoundingRadius",value:function(){for(var e=this.shapes,t=this.shapeOffsets,n=e.length,r=0,a=0;a!==n;a++){var i=e[a];i.updateBoundingSphereRadius();var o=t[a].length(),s=i.boundingSphereRadius;o+s>r&&(r=o+s)}this.boundingRadius=r}},{key:"updateAABB",value:function(){for(var e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,r=e.length,a=re,i=ae,o=this.quaternion,s=this.aabb,c=ie,u=0;u!==r;u++){var l=e[u];o.vmult(t[u],a),a.vadd(this.position,a),o.mult(n[u],i),l.calculateWorldAABB(a,i,c.lowerBound,c.upperBound),0===u?s.copy(c):s.extend(c)}this.aabbNeedsUpdate=!1}},{key:"updateInertiaWorld",value:function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var n=oe,r=se;n.setRotationFromQuaternion(this.quaternion),n.transpose(r),n.scale(t,n),n.mmult(r,this.invInertiaWorld)}else;}},{key:"applyForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;if(this.type===n.DYNAMIC){this.sleepState===n.SLEEPING&&this.wakeUp();var r=ce;t.cross(e,r),this.force.vadd(e,this.force),this.torque.vadd(r,this.torque)}}},{key:"applyLocalForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;if(this.type===n.DYNAMIC){var r=ue,a=le;this.vectorToWorldFrame(e,r),this.vectorToWorldFrame(t,a),this.applyForce(r,a)}}},{key:"applyTorque",value:function(e){this.type===n.DYNAMIC&&(this.sleepState===n.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}},{key:"applyImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;if(this.type===n.DYNAMIC){this.sleepState===n.SLEEPING&&this.wakeUp();var r=t,a=ge;a.copy(e),a.scale(this.invMass,a),this.velocity.vadd(a,this.velocity);var i=de;r.cross(e,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}}},{key:"applyLocalImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;if(this.type===n.DYNAMIC){var r=Ie,a=Ae;this.vectorToWorldFrame(e,r),this.vectorToWorldFrame(t,a),this.applyImpulse(r,a)}}},{key:"updateMassProperties",value:function(){var e=he;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),D.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}},{key:"getVelocityAtWorldPoint",value:function(e,t){var n=new S;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}},{key:"integrate",value:function(e,t,r){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===n.DYNAMIC||this.type===n.KINEMATIC)&&this.sleepState!==n.SLEEPING){var a=this.velocity,i=this.angularVelocity,o=this.position,s=this.force,c=this.torque,u=this.quaternion,l=this.invMass,g=this.invInertiaWorld,d=this.linearFactor,I=l*e;a.x+=s.x*I*d.x,a.y+=s.y*I*d.y,a.z+=s.z*I*d.z;var A=g.elements,h=this.angularFactor,C=c.x*h.x,f=c.y*h.y,p=c.z*h.z;i.x+=e*(A[0]*C+A[1]*f+A[2]*p),i.y+=e*(A[3]*C+A[4]*f+A[5]*p),i.z+=e*(A[6]*C+A[7]*f+A[8]*p),o.x+=a.x*e,o.y+=a.y*e,o.z+=a.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(r?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}}]),n}(V);ne.idCounter=0,ne.COLLIDE_EVENT_NAME="collide",ne.DYNAMIC=P,ne.STATIC=J,ne.KINEMATIC=q,ne.AWAKE=$,ne.SLEEPY=ee,ne.SLEEPING=te,ne.wakeupEvent={type:"wakeup"},ne.sleepyEvent={type:"sleepy"},ne.sleepEvent={type:"sleep"};var re=new S,ae=new F,ie=new k,oe=new _,se=new _,ce=new S,ue=new S,le=new S,ge=new S,de=new S,Ie=new S,Ae=new S,he=new S;new S,new S;var Ce=function(){function e(){Object(s.a)(this,e),this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new S,this.rayToWorld=new S,this.hitNormalWorld=new S,this.hitPointWorld=new S,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return Object(c.a)(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,n,r,a,i,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=a,this.body=i,this.distance=o}}]),e}(),fe=1,pe=2,me=4,ve=function(e,t,n,r,a,i,o){function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S;Object(s.a)(this,u),this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new S,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=u.ANY,this.result=new Ce,this.hasHit=!1,this.callback=function(e){}}return Object(c.a)(u,[{key:e,get:function(){return this._intersectSphere}},{key:t,get:function(){return this._intersectPlane}},{key:n,get:function(){return this._intersectBox}},{key:r,get:function(){return this._intersectConvex}},{key:a,get:function(){return this._intersectConvex}},{key:i,get:function(){return this._intersectHeightfield}},{key:o,get:function(){return this._intersectTrimesh}},{key:"intersectWorld",value:function(e,t){return this.mode=t.mode||u.ANY,this.result=t.result||new Ce,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!==typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse="undefined"===typeof t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(be),ye.length=0,e.broadphase.aabbQuery(e,be,ye),this.intersectBodies(ye),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var n=this.checkCollisionResponse;if((!n||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var r=we,a=_e,i=0,o=e.shapes.length;i<o;i++){var s=e.shapes[i];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[i],a),e.quaternion.vmult(e.shapeOffsets[i],r),r.vadd(e.position,r),this.intersectShape(s,a,r,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var n=0,r=e.length;!this.result.shouldStop&&n<r;n++)this.intersectBody(e[n])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,n,r){var a=function(e,t,n){n.vsub(e,De);var r=De.dot(t);return t.scale(r,Ue),Ue.vadd(e,Ue),n.distanceTo(Ue)}(this.from,this.direction,n);if(!(a>e.boundingSphereRadius)){var i=this[e.type];i&&i.call(this,e,t,n,r,e)}}},{key:"_intersectBox",value:function(e,t,n,r,a){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,r,a)}},{key:"_intersectPlane",value:function(e,t,n,r,a){var i=this.from,o=this.to,s=this.direction,c=new S(0,0,1);t.vmult(c,c);var u=new S;i.vsub(n,u);var l=u.dot(c);if(o.vsub(n,u),!(l*u.dot(c)>0)&&!(i.distanceTo(o)<l)){var g=c.dot(s);if(!(Math.abs(g)<this.precision)){var d=new S,I=new S,A=new S;i.vsub(n,d);var h=-c.dot(d)/g;s.scale(h,I),i.vadd(I,A),this.reportIntersection(c,A,a,r,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,n=e.upperBound,r=this.to,a=this.from;t.x=Math.min(r.x,a.x),t.y=Math.min(r.y,a.y),t.z=Math.min(r.z,a.z),n.x=Math.max(r.x,a.x),n.y=Math.max(r.y,a.y),n.z=Math.max(r.z,a.z)}},{key:"_intersectHeightfield",value:function(e,t,n,r,a){e.data,e.elementSize;var i=Ee;i.from.copy(this.from),i.to.copy(this.to),L.pointToLocalFrame(n,t,i.from,i.from),L.pointToLocalFrame(n,t,i.to,i.to),i.updateDirection();var o,s,c,u,l=We;o=s=0,c=u=e.data.length-1;var g=new k;i.getAABB(g),e.getIndexOfPosition(g.lowerBound.x,g.lowerBound.y,l,!0),o=Math.max(o,l[0]),s=Math.max(s,l[1]),e.getIndexOfPosition(g.upperBound.x,g.upperBound.y,l,!0),c=Math.min(c,l[0]+1),u=Math.min(u,l[1]+1);for(var d=o;d<c;d++)for(var I=s;I<u;I++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(d,I,g),g.overlapsRay(i)){if(e.getConvexTrianglePillar(d,I,!1),L.pointToWorldFrame(n,t,e.pillarOffset,ke),this._intersectConvex(e.pillarConvex,t,ke,r,a,Me),this.result.shouldStop)return;e.getConvexTrianglePillar(d,I,!0),L.pointToWorldFrame(n,t,e.pillarOffset,ke),this._intersectConvex(e.pillarConvex,t,ke,r,a,Me)}}}},{key:"_intersectSphere",value:function(e,t,n,r,a){var i=this.from,o=this.to,s=e.radius,c=Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)+Math.pow(o.z-i.z,2),u=2*((o.x-i.x)*(i.x-n.x)+(o.y-i.y)*(i.y-n.y)+(o.z-i.z)*(i.z-n.z)),l=Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)+Math.pow(i.z-n.z,2)-Math.pow(s,2),g=Math.pow(u,2)-4*c*l,d=Ve,I=Fe;if(!(g<0))if(0===g)i.lerp(o,g,d),d.vsub(n,I),I.normalize(),this.reportIntersection(I,d,a,r,-1);else{var A=(-u-Math.sqrt(g))/(2*c),h=(-u+Math.sqrt(g))/(2*c);if(A>=0&&A<=1&&(i.lerp(o,A,d),d.vsub(n,I),I.normalize(),this.reportIntersection(I,d,a,r,-1)),this.result.shouldStop)return;h>=0&&h<=1&&(i.lerp(o,h,d),d.vsub(n,I),I.normalize(),this.reportIntersection(I,d,a,r,-1))}}},{key:"_intersectConvex",value:function(e,t,n,r,a,i){for(var o=Xe,s=He,c=i&&i.faceList||null,l=e.faces,g=e.vertices,d=e.faceNormals,I=this.direction,A=this.from,h=this.to,C=A.distanceTo(h),f=c?c.length:l.length,p=this.result,m=0;!p.shouldStop&&m<f;m++){var v=c?c[m]:m,b=l[v],y=d[v],B=t,G=n;s.copy(g[b[0]]),B.vmult(s,s),s.vadd(G,s),s.vsub(A,s),B.vmult(y,o);var w=I.dot(o);if(!(Math.abs(w)<this.precision)){var _=o.dot(s)/w;if(!(_<0)){I.scale(_,Ze),Ze.vadd(A,Ze),Se.copy(g[b[0]]),B.vmult(Se,Se),G.vadd(Se,Se);for(var Z=1;!p.shouldStop&&Z<b.length-1;Z++){xe.copy(g[b[Z]]),Re.copy(g[b[Z+1]]),B.vmult(xe,xe),B.vmult(Re,Re),G.vadd(xe,xe),G.vadd(Re,Re);var S=Ze.distanceTo(A);!u.pointInTriangle(Ze,Se,xe,Re)&&!u.pointInTriangle(Ze,xe,Se,Re)||S>C||this.reportIntersection(o,Ze,a,r,v)}}}}}},{key:"_intersectTrimesh",value:function(e,t,n,r,a,i){var o=Oe,s=Ke,c=je,l=He,g=Le,d=Ne,I=Ye,A=ze,h=Te,C=e.indices;e.vertices;var f=this.from,p=this.to,m=this.direction;c.position.copy(n),c.quaternion.copy(t),L.vectorToLocalFrame(n,t,m,g),L.pointToLocalFrame(n,t,f,d),L.pointToLocalFrame(n,t,p,I),I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,I.vsub(d,g),g.normalize();var v=d.distanceSquared(I);e.tree.rayQuery(this,c,s);for(var b=0,y=s.length;!this.result.shouldStop&&b!==y;b++){var B=s[b];e.getNormal(B,o),e.getVertex(C[3*B],Se),Se.vsub(d,l);var G=g.dot(o),w=o.dot(l)/G;if(!(w<0)){g.scale(w,Ze),Ze.vadd(d,Ze),e.getVertex(C[3*B+1],xe),e.getVertex(C[3*B+2],Re);var _=Ze.distanceSquared(d);!u.pointInTriangle(Ze,xe,Se,Re)&&!u.pointInTriangle(Ze,Se,xe,Re)||_>v||(L.vectorToWorldFrame(t,o,h),L.pointToWorldFrame(n,t,Ze,A),this.reportIntersection(h,A,a,r,B))}}s.length=0}},{key:"reportIntersection",value:function(e,t,n,r,a){var i=this.from,o=this.to,s=i.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(c.hitFaceIndex="undefined"!==typeof a?a:-1,this.mode){case u.ALL:this.hasHit=!0,c.set(i,o,e,t,n,r,s),c.hasHit=!0,this.callback(c);break;case u.CLOSEST:(s<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(i,o,e,t,n,r,s));break;case u.ANY:this.hasHit=!0,c.hasHit=!0,c.set(i,o,e,t,n,r,s),c.shouldStop=!0}}}],[{key:"pointInTriangle",value:function(e,t,n,r){r.vsub(t,De),n.vsub(t,Be),e.vsub(t,Ge);var a,i,o=De.dot(De),s=De.dot(Be),c=De.dot(Ge),u=Be.dot(Be),l=Be.dot(Ge);return(a=u*c-s*l)>=0&&(i=o*l-s*c)>=0&&a+i<o*u-s*s}}]),u}(O.types.SPHERE,O.types.PLANE,O.types.BOX,O.types.CYLINDER,O.types.CONVEXPOLYHEDRON,O.types.HEIGHTFIELD,O.types.TRIMESH);ve.CLOSEST=fe,ve.ANY=pe,ve.ALL=me;var be=new k,ye=[],Be=new S,Ge=new S,we=new S,_e=new F,Ze=new S,Se=new S,xe=new S,Re=new S,Me={faceList:[0]},ke=new S,Ee=new ve,We=[],Ve=new S,Fe=new S,Xe=new S,He=new S,Oe=new S,Le=new S,Ne=new S,Ye=new S,Te=new S,ze=new S;new k;var Ke=[],je=new L,De=new S,Ue=new S;new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S;var Qe=Object(c.a)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;var n="";"string"===typeof t&&(n=t,t={}),this.name=n,this.id=e.idCounter++,this.friction="undefined"!==typeof t.friction?t.friction:-1,this.restitution="undefined"!==typeof t.restitution?t.restitution:-1}));Qe.idCounter=0,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new ve,new S,new S,new S(1,0,0),new S(0,1,0),new S(0,0,1),new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S;new S,new S,new S,new S,new S,new S,new S,new S,new S;new S,new S,new S,new S,new S,new S,new S,new S,new S,new S;new S,new k,new S,new k,new S,new S,new S,new S,new S,new S,new S,new k,new S,new L,new k;O.types.SPHERE,O.types.SPHERE,O.types.PLANE,O.types.BOX,O.types.BOX,O.types.SPHERE,O.types.BOX,O.types.PLANE,O.types.BOX,O.types.CONVEXPOLYHEDRON,O.types.SPHERE,O.types.CONVEXPOLYHEDRON,O.types.PLANE,O.types.CONVEXPOLYHEDRON,O.types.BOX,O.types.CONVEXPOLYHEDRON,O.types.SPHERE,O.types.HEIGHTFIELD,O.types.BOX,O.types.HEIGHTFIELD,O.types.CONVEXPOLYHEDRON,O.types.HEIGHTFIELD,O.types.PARTICLE,O.types.SPHERE,O.types.PLANE,O.types.PARTICLE,O.types.BOX,O.types.PARTICLE,O.types.PARTICLE,O.types.CONVEXPOLYHEDRON,O.types.CYLINDER,O.types.SPHERE,O.types.CYLINDER,O.types.PLANE,O.types.CYLINDER,O.types.BOX,O.types.CYLINDER,O.types.CONVEXPOLYHEDRON,O.types.CYLINDER,O.types.HEIGHTFIELD,O.types.CYLINDER,O.types.PARTICLE,O.types.CYLINDER,O.types.SPHERE,O.types.TRIMESH,O.types.PLANE,O.types.TRIMESH,new S,new S,new S,new S,new S,new F,new F,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new k,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new S,new F,new S,new S,new S,new S,new S,new S,new S,new S,new k,new ve;var Pe=globalThis.performance||{};if(!Pe.now){var Je=Date.now();Pe.timing&&Pe.timing.navigationStart&&(Je=Pe.timing.navigationStart),Pe.now=function(){return Date.now()-Je}}new A.Vector3,new A.Vector3(1,1,1),new A.Quaternion;var qe=new A.Object3D;function $e(e,t){return e+t.charAt(0).toUpperCase()+t.slice(1)}function et(e,t){return void 0!==t?"".concat(e.current.uuid,"/").concat(t):e.current.uuid}function tt(e,t,n,r,a){return e.current&&t.postMessage({op:n,uuid:et(e,r),props:a})}function nt(e,t,n,r,a,i){return function(o){var s=it++;return n[s]=o,tt(e,t,"subscribe",a,{id:s,type:r,target:void 0===i||null===i?"bodies":i}),function(){delete n[s],t.postMessage({op:"unsubscribe",props:s})}}}function rt(e,t){var n,r;e.userData=t.userData||{},(n=e.position).set.apply(n,Object(a.a)(t.position||[0,0,0])),(r=e.rotation).set.apply(r,Object(a.a)(t.rotation||[0,0,0])),e.updateMatrix()}function at(e,t,n){var r=t.onCollide,a=t.onCollideBegin,i=t.onCollideEnd;(r||a||i)&&(e[n]=function(e){switch(e.type){case"collide":r&&r(e);break;case"collideBegin":a&&a(e);break;case"collideEnd":i&&i(e)}})}var it=0;function ot(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=Object(g.useRef)(null),s=a||o,c=Object(g.useContext)(C),l=c.worker,d=c.refs,I=c.events,p=c.subscriptions,m=Object(g.useContext)(f);Object(g.useLayoutEffect)((function(){s.current||(s.current=new A.Object3D);var a=s.current,i=l,o=a instanceof A.InstancedMesh?(a.instanceMatrix.setUsage(A.DynamicDrawUsage),a.count):1,c=a instanceof A.InstancedMesh?new Array(o).fill(0).map((function(e,t){return"".concat(a.uuid,"/").concat(t)})):[a.uuid],g=a instanceof A.InstancedMesh?c.map((function(r,i){var o=t(i);return rt(qe,o),a.setMatrixAt(i,qe.matrix),a.instanceMatrix.needsUpdate=!0,d[r]=a,m&&m.add(r,o,e),at(I,o,r),Object(u.a)(Object(u.a)({},o),{},{args:n(o.args)})})):c.map((function(r,i){var o=t(i);return rt(a,o),d[r]=a,m&&m.add(r,o,e),at(I,o,r),Object(u.a)(Object(u.a)({},o),{},{args:n(o.args)})}));return i.postMessage({op:"addBodies",type:e,uuid:c,props:g.map((function(e){var t=e.onCollide,n=(e.onCollideBegin,e.onCollideEnd,Object(r.a)(e,h));return Object(u.a)({onCollide:Boolean(t)},n)}))}),function(){c.forEach((function(e){delete d[e],m&&m.remove(e),delete I[e]})),i.postMessage({op:"removeBodies",uuid:c})}}),i);var v=Object(g.useMemo)((function(){var e=function(e,t){return{set:function(n,r,a){return tt(s,l,$e("set",e),t,[n,r,a])},copy:function(n){var r=n.x,a=n.y,i=n.z;return tt(s,l,$e("set",e),t,[r,a,i])},subscribe:nt(s,l,p,e,t)}},t=function(e,t){return{set:function(n){return tt(s,l,$e("set",e),t,n)},subscribe:nt(s,l,p,e,t)}};function n(n){return{position:e("position",n),rotation:e("quaternion",n),velocity:e("velocity",n),angularVelocity:e("angularVelocity",n),linearFactor:e("linearFactor",n),angularFactor:e("angularFactor",n),mass:t("mass",n),linearDamping:t("linearDamping",n),angularDamping:t("angularDamping",n),allowSleep:t("allowSleep",n),sleepSpeedLimit:t("sleepSpeedLimit",n),sleepTimeLimit:t("sleepTimeLimit",n),collisionFilterGroup:t("collisionFilterGroup",n),collisionFilterMask:t("collisionFilterMask",n),collisionResponse:t("collisionResponse",n),fixedRotation:t("fixedRotation",n),userData:t("userData",n),isTrigger:t("isTrigger",n),applyForce:function(e,t){tt(s,l,"applyForce",n,[e,t])},applyImpulse:function(e,t){tt(s,l,"applyImpulse",n,[e,t])},applyLocalForce:function(e,t){tt(s,l,"applyLocalForce",n,[e,t])},applyLocalImpulse:function(e,t){tt(s,l,"applyLocalImpulse",n,[e,t])},applyTorque:function(e){tt(s,l,"applyTorque",n,[e])},wakeUp:function(){tt(s,l,"wakeUp",n)},sleep:function(){tt(s,l,"sleep",n)}}}var r={};return Object(u.a)(Object(u.a)({},n(void 0)),{},{at:function(e){return r[e]||(r[e]=n(e))}})}),[]);return[s,v]}function st(e,t,n){return ot("Plane",e,(function(){return[]}),t,n)}function ct(e,t,n){var r=[1,1,1];return ot("Box",e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return e}),t,n)}function ut(e,t,n){return ot("Sphere",e,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return[e]}),t,n)}function lt(e){return d.a.createElement(g.Suspense,{fallback:null},d.a.createElement(w,e))}},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,t){for(var n,s,c=o(e),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))a.call(n,l)&&(c[l]=n[l]);if(r){s=r(n);for(var g=0;g<s.length;g++)i.call(n,s[g])&&(c[s[g]]=n[s[g]])}}return c}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log_level_t=t.instant_world_tracker_transform_orientation_t=t.face_landmark_name_t=t.barcode_format_t=void 0,function(e){e[e.UNKNOWN=131072]="UNKNOWN",e[e.AZTEC=1]="AZTEC",e[e.CODABAR=2]="CODABAR",e[e.CODE_39=4]="CODE_39",e[e.CODE_93=8]="CODE_93",e[e.CODE_128=16]="CODE_128",e[e.DATA_MATRIX=32]="DATA_MATRIX",e[e.EAN_8=64]="EAN_8",e[e.EAN_13=128]="EAN_13",e[e.ITF=256]="ITF",e[e.MAXICODE=512]="MAXICODE",e[e.PDF_417=1024]="PDF_417",e[e.QR_CODE=2048]="QR_CODE",e[e.RSS_14=4096]="RSS_14",e[e.RSS_EXPANDED=8192]="RSS_EXPANDED",e[e.UPC_A=16384]="UPC_A",e[e.UPC_E=32768]="UPC_E",e[e.UPC_EAN_EXTENSION=65536]="UPC_EAN_EXTENSION",e[e.ALL=131071]="ALL"}(t.barcode_format_t||(t.barcode_format_t={})),function(e){e[e.EYE_LEFT=0]="EYE_LEFT",e[e.EYE_RIGHT=1]="EYE_RIGHT",e[e.EAR_LEFT=2]="EAR_LEFT",e[e.EAR_RIGHT=3]="EAR_RIGHT",e[e.NOSE_BRIDGE=4]="NOSE_BRIDGE",e[e.NOSE_TIP=5]="NOSE_TIP",e[e.NOSE_BASE=6]="NOSE_BASE",e[e.LIP_TOP=7]="LIP_TOP",e[e.LIP_BOTTOM=8]="LIP_BOTTOM",e[e.MOUTH_CENTER=9]="MOUTH_CENTER",e[e.CHIN=10]="CHIN",e[e.EYEBROW_LEFT=11]="EYEBROW_LEFT",e[e.EYEBROW_RIGHT=12]="EYEBROW_RIGHT"}(t.face_landmark_name_t||(t.face_landmark_name_t={})),function(e){e[e.WORLD=3]="WORLD",e[e.MINUS_Z_AWAY_FROM_USER=4]="MINUS_Z_AWAY_FROM_USER",e[e.MINUS_Z_HEADING=5]="MINUS_Z_HEADING",e[e.UNCHANGED=6]="UNCHANGED"}(t.instant_world_tracker_transform_orientation_t||(t.instant_world_tracker_transform_orientation_t={})),function(e){e[e.LOG_LEVEL_NONE=0]="LOG_LEVEL_NONE",e[e.LOG_LEVEL_ERROR=1]="LOG_LEVEL_ERROR",e[e.LOG_LEVEL_WARNING=2]="LOG_LEVEL_WARNING",e[e.LOG_LEVEL_VERBOSE=3]="LOG_LEVEL_VERBOSE"}(t.log_level_t||(t.log_level_t={}))},function(e,t,n){"use strict";var r=n(20).default,a=n(19).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.glContextLost=t.glContextSet=t.HTMLElementSource=t.CameraSource=t.InstantWorldTracker=t.FaceTracker=t.BarcodeFinder=t.ImageTracker=t.getDefaultPipeline=t.onFrameUpdate=void 0;var s,c=n(44),u=n(45);function l(){return s||(s=new c.Pipeline).onFrameUpdate.bind((function(){return t.onFrameUpdate.emit()})),s}t.onFrameUpdate=new u.Event,t.getDefaultPipeline=l;var g=function(e){i(n,e);var t=o(n);function n(e,r){return a(this,n),t.call(this,r||l(),e)}return r(n)}(c.ImageTracker);t.ImageTracker=g;var d=function(e){i(n,e);var t=o(n);function n(e){return a(this,n),t.call(this,e||l())}return r(n)}(c.BarcodeFinder);t.BarcodeFinder=d;var I=function(e){i(n,e);var t=o(n);function n(e){return a(this,n),t.call(this,e||l())}return r(n)}(c.FaceTracker);t.FaceTracker=I;var A=function(e){i(n,e);var t=o(n);function n(e){return a(this,n),t.call(this,e||l())}return r(n)}(c.InstantWorldTracker);t.InstantWorldTracker=A;var h=function(e){i(n,e);var t=o(n);function n(e,r){return a(this,n),t.call(this,r||l(),e)}return r(n)}(c.CameraSource);t.CameraSource=h;var C=function(e){i(n,e);var t=o(n);function n(e,r){return a(this,n),t.call(this,r||l(),e)}return r(n)}(c.HTMLElementSource);t.HTMLElementSource=C,t.glContextSet=function(e){l().glContextSet(e)},t.glContextLost=function(){l().glContextLost()}},function(e,t,n){"use strict";n.d(t,"useSpring",(function(){return He}));var r=n(3),a=n(16),i=n(10),o=n(12),s=n(11),c=n(6),u=n(7),l=n(55),g=n(32),d=n(5),I=n(4),A=n(22),h=n(17),C=n.n(h),f=n(8);n.d(t,"Globals",(function(){return f.b}));var p=n(1),m=n(26);n(92),n(93);function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return f.s.fun(e)?e.apply(void 0,n):e}var y=function(e,t){return!0===e||!!(t&&e&&(f.s.fun(e)?e(t):Object(f.y)(e).includes(t)))},B=function(e,t){return f.s.obj(e)?t&&e[t]:e},G=function(e,t){return!0===e.default?e[t]:e.default?e.default[t]:void 0},w=function(e){return e},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w,n=Z;e.default&&!0!==e.default&&(e=e.default,n=Object.keys(e));var r,a={},i=Object(A.a)(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=t(e[o],o);f.s.und(s)||(a[o]=s)}}catch(c){i.e(c)}finally{i.f()}return a},Z=["config","onProps","onStart","onChange","onPause","onResume","onRest"],S={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function x(e){var t=function(e){var t={},n=0;if(Object(f.l)(e,(function(e,r){S[r]||(t[r]=e,n++)})),n)return t}(e);if(t){var n={to:t};return Object(f.l)(e,(function(e,r){return r in t||(n[r]=e)})),n}return v({},e)}function R(e){return e=Object(f.q)(e),f.s.arr(e)?e.map(R):Object(f.t)(e)?f.b.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function M(e){for(var t in e)return!0;return!1}function k(e){return f.s.fun(e)||f.s.arr(e)&&f.s.obj(e[0])}function E(e,t){var n;null==(n=e.ref)||n.delete(e),null==t||t.delete(e)}function W(e,t){var n;t&&e.ref!==t&&(null==(n=e.ref)||n.delete(e),t.add(e),e.ref=t)}var V=1.70158,F=1.525*V,X=V+1,H=2*Math.PI/3,O=2*Math.PI/4.5,L=function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},N=v({},{tension:170,friction:26},{mass:1,damping:1,easing:{linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return 1-(1-e)*(1-e)},easeInOutQuad:function(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return 1-Math.pow(1-e,3)},easeInOutCubic:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1-Math.pow(1-e,4)},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1-Math.pow(1-e,5)},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2},easeInSine:function(e){return 1-Math.cos(e*Math.PI/2)},easeOutSine:function(e){return Math.sin(e*Math.PI/2)},easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2},easeInExpo:function(e){return 0===e?0:Math.pow(2,10*e-10)},easeOutExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},easeInOutExpo:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2},easeInCirc:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2},easeInBack:function(e){return X*e*e*e-V*e*e},easeOutBack:function(e){return 1+X*Math.pow(e-1,3)+V*Math.pow(e-1,2)},easeInOutBack:function(e){return e<.5?Math.pow(2*e,2)*(7.189819*e-F)/2:(Math.pow(2*e-2,2)*((F+1)*(2*e-2)+F)+2)/2},easeInElastic:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*H)},easeOutElastic:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*H)+1},easeInOutElastic:function(e){return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*O)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*O)/2+1},easeInBounce:function(e){return 1-L(1-e)},easeOutBounce:L,easeInOutBounce:function(e){return e<.5?(1-L(1-2*e))/2:(1+L(2*e-1))/2}}.linear,clamp:!1}),Y=Object(d.a)((function e(){Object(I.a)(this,e),this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,N)}));function T(e,t){if(f.s.und(t.decay)){var n=!f.s.und(t.tension)||!f.s.und(t.friction);!n&&f.s.und(t.frequency)&&f.s.und(t.damping)&&f.s.und(t.mass)||(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}else e.duration=void 0}var z=[],K=Object(d.a)((function e(){Object(I.a)(this,e),this.changed=!1,this.values=z,this.toValues=null,this.fromValues=z,this.to=void 0,this.from=void 0,this.config=new Y,this.immediate=!1}));function j(e,t){var n=t.key,r=t.props,a=t.defaultProps,i=t.state,o=t.actions;return new Promise((function(t,s){var c,u,l,g=y(null!=(c=r.cancel)?c:null==a?void 0:a.cancel,n);if(g)h();else{f.s.und(r.pause)||(i.paused=y(r.pause,n));var d=null==a?void 0:a.pause;!0!==d&&(d=i.paused||y(d,n)),u=b(r.delay||0,n),d?(i.resumeQueue.add(A),o.pause()):(o.resume(),A())}function I(){i.resumeQueue.add(A),i.timeouts.delete(l),l.cancel(),u=l.time-f.w.now()}function A(){u>0&&!f.b.skipAnimation?(i.delayed=!0,l=f.w.setTimeout(h,u),i.pauseQueue.add(I),i.timeouts.add(l)):h()}function h(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(I),i.timeouts.delete(l),e<=(i.cancelId||0)&&(g=!0);try{o.start(v({},r,{callId:e,cancel:g}),t)}catch(n){s(n)}}}))}var D=function(e,t){return 1==t.length?t[0]:t.some((function(e){return e.cancelled}))?P(e.get()):t.every((function(e){return e.noop}))?U(e.get()):Q(e.get(),t.every((function(e){return e.finished})))},U=function(e){return{value:e,noop:!0,finished:!0,cancelled:!1}},Q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{value:e,finished:t,cancelled:n}},P=function(e){return{value:e,cancelled:!0,finished:!1}};function J(e,t,n,r){var a=t.callId,i=t.parentId,o=t.onRest,s=n.asyncTo,c=n.promise;return i||e!==s||t.reset?n.promise=Object(g.a)(C.a.mark((function u(){var l,d,I,h,p,m,b,y;return C.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(n.asyncId=a,n.asyncTo=e,l=_(t,(function(e,t){return"onRest"===t?void 0:e})),h=new Promise((function(e,t){return d=e,I=t})),p=function(e){var t=a<=(n.cancelId||0)&&P(r)||a!==n.asyncId&&Q(r,!1);if(t)throw e.result=t,I(e),e},m=function(e,t){var i=new $,o=new ee;return Object(g.a)(C.a.mark((function s(){var c,u;return C.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!f.b.skipAnimation){s.next=5;break}throw q(n),o.result=Q(r,!1),I(o),o;case 5:return p(i),(c=f.s.obj(e)?v({},e):v({},t,{to:e})).parentId=a,Object(f.l)(l,(function(e,t){f.s.und(c[t])&&(c[t]=e)})),s.next=11,r.start(c);case 11:if(u=s.sent,p(i),!n.paused){s.next=16;break}return s.next=16,new Promise((function(e){n.resumeQueue.add(e)}));case 16:return s.abrupt("return",u);case 17:case"end":return s.stop()}}),s)})))()},!f.b.skipAnimation){u.next=9;break}return q(n),u.abrupt("return",Q(r,!1));case 9:return u.prev=9,y=f.s.arr(e)?function(){var e=Object(g.a)(C.a.mark((function e(t){var n,r,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(A.a)(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return a=r.value,e.next=7,m(a);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()(e):Promise.resolve(e(m,r.stop.bind(r))),u.next=13,Promise.all([y.then(d),h]);case 13:b=Q(r.get(),!0,!1),u.next=27;break;case 16:if(u.prev=16,u.t0=u.catch(9),!(u.t0 instanceof $)){u.next=22;break}b=u.t0.result,u.next=27;break;case 22:if(!(u.t0 instanceof ee)){u.next=26;break}b=u.t0.result,u.next=27;break;case 26:throw u.t0;case 27:return u.prev=27,a==n.asyncId&&(n.asyncId=i,n.asyncTo=i?s:void 0,n.promise=i?c:void 0),u.finish(27);case 30:return f.s.fun(o)&&f.w.batchedUpdates((function(){o(b,r,r.item)})),u.abrupt("return",b);case 32:case"end":return u.stop()}}),u,null,[[9,16,27,30]])})))():c}function q(e,t){Object(f.m)(e.timeouts,(function(e){return e.cancel()})),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var $=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(I.a)(this,n),(e=t.call(this,"An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")).result=void 0,e}return Object(d.a)(n)}(Object(l.a)(Error)),ee=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(I.a)(this,n),(e=t.call(this,"SkipAnimationSignal")).result=void 0,e}return Object(d.a)(n)}(Object(l.a)(Error)),te=function(e){return e instanceof re},ne=1,re=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(I.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).id=ne++,e.key=void 0,e._priority=0,e}return Object(d.a)(n,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}},{key:"get",value:function(){var e=Object(m.d)(this);return e&&e.getValue()}},{key:"to",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.b.to(this,t)}},{key:"interpolate",value:function(){Object(f.j)();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return f.b.to(this,t)}},{key:"toJSON",value:function(){return this.get()}},{key:"observerAdded",value:function(e){1==e&&this._attach()}},{key:"observerRemoved",value:function(e){0==e&&this._detach()}},{key:"_attach",value:function(){}},{key:"_detach",value:function(){}},{key:"_onChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(f.d)(this,{type:"change",parent:this,value:e,idle:t})}},{key:"_onPriorityChange",value:function(e){this.idle||f.o.sort(this),Object(f.d)(this,{type:"priority",parent:this,priority:e})}}]),n}(f.a),ae=Symbol.for("SpringPhase"),ie=function(e){return(1&e[ae])>0},oe=function(e){return(2&e[ae])>0},se=function(e){return(4&e[ae])>0},ce=function(e,t){return t?e[ae]|=3:e[ae]&=-3},ue=function(e,t){return t?e[ae]|=4:e[ae]&=-5},le=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;if(Object(I.a)(this,n),(a=t.call(this)).key=void 0,a.animation=new K,a.queue=void 0,a.defaultProps={},a._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},a._pendingCalls=new Set,a._lastCallId=0,a._lastToId=0,a._memoizedDuration=0,!f.s.und(e)||!f.s.und(r)){var i=f.s.obj(e)?v({},e):v({},r,{from:e});f.s.und(i.default)&&(i.default=!0),a.start(i)}return a}return Object(d.a)(n,[{key:"idle",get:function(){return!(oe(this)||this._state.asyncTo)||se(this)}},{key:"goal",get:function(){return Object(f.q)(this.animation.to)}},{key:"velocity",get:function(){var e=Object(m.d)(this);return e instanceof m.b?e.lastVelocity||0:e.getPayload().map((function(e){return e.lastVelocity||0}))}},{key:"hasAnimated",get:function(){return ie(this)}},{key:"isAnimating",get:function(){return oe(this)}},{key:"isPaused",get:function(){return se(this)}},{key:"isDelayed",get:function(){return this._state.delayed}},{key:"advance",value:function(e){var t=this,n=!0,r=!1,a=this.animation,i=a.config,o=a.toValues,s=Object(m.f)(a.to);!s&&Object(f.r)(a.to)&&(o=Object(f.y)(Object(f.q)(a.to))),a.values.forEach((function(c,u){if(!c.done){var l=c.constructor==m.a?1:s?s[u].lastPosition:o[u],g=a.immediate,d=l;if(!g){if(d=c.lastPosition,i.tension<=0)return void(c.done=!0);var I,A=c.elapsedTime+=e,h=a.fromValues[u],C=null!=c.v0?c.v0:c.v0=f.s.arr(i.velocity)?i.velocity[u]:i.velocity;if(f.s.und(i.duration))if(i.decay){var p=!0===i.decay?.998:i.decay,v=Math.exp(-(1-p)*A);d=h+C/(1-p)*(1-v),g=Math.abs(c.lastPosition-d)<.1,I=C*v}else{I=null==c.lastVelocity?C:c.lastVelocity;for(var b=i.precision||(h==l?.005:Math.min(1,.001*Math.abs(l-h))),y=i.restVelocity||b/10,B=i.clamp?0:i.bounce,G=!f.s.und(B),w=h==l?c.v0>0:h<l,_=Math.ceil(e/1),Z=0;Z<_&&(Math.abs(I)>y||!(g=Math.abs(l-d)<=b));++Z){G&&(d==l||d>l==w)&&(I=-I*B,d=l),d+=1*(I+=1*((1e-6*-i.tension*(d-l)+.001*-i.friction*I)/i.mass))}}else{var S=1;i.duration>0&&(t._memoizedDuration!==i.duration&&(t._memoizedDuration=i.duration,c.durationProgress>0&&(c.elapsedTime=i.duration*c.durationProgress,A=c.elapsedTime+=e)),S=(S=(i.progress||0)+A/t._memoizedDuration)>1?1:S<0?0:S,c.durationProgress=S),I=((d=h+i.easing(S)*(l-h))-c.lastPosition)/e,g=1==S}c.lastVelocity=I,Number.isNaN(d)&&(console.warn("Got NaN while animating:",t),g=!0)}s&&!s[u].done&&(g=!1),g?c.done=!0:n=!1,c.setValue(d,i.round)&&(r=!0)}}));var c=Object(m.d)(this),u=c.getValue();if(n){var l=Object(f.q)(a.to);u===l&&!r||i.decay?r&&i.decay&&this._onChange(u):(c.setValue(l),this._onChange(l)),this._stop()}else r&&this._onChange(u)}},{key:"set",value:function(e){var t=this;return f.w.batchedUpdates((function(){t._stop(),t._focus(e),t._set(e)})),this}},{key:"pause",value:function(){this._update({pause:!0})}},{key:"resume",value:function(){this._update({pause:!1})}},{key:"finish",value:function(){var e=this;if(oe(this)){var t=this.animation,n=t.to,r=t.config;f.w.batchedUpdates((function(){e._onStart(),r.decay||e._set(n,!1),e._stop()}))}return this}},{key:"update",value:function(e){return(this.queue||(this.queue=[])).push(e),this}},{key:"start",value:function(e,t){var n,r=this;return f.s.und(e)?(n=this.queue||[],this.queue=[]):n=[f.s.obj(e)?e:v({},t,{to:e})],Promise.all(n.map((function(e){return r._update(e)}))).then((function(e){return D(r,e)}))}},{key:"stop",value:function(e){var t=this,n=this.animation.to;return this._focus(this.get()),q(this._state,e&&this._lastCallId),f.w.batchedUpdates((function(){return t._stop(n,e)})),this}},{key:"reset",value:function(){this._update({reset:!0})}},{key:"eventObserved",value:function(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}},{key:"_prepareNode",value:function(e){var t=this.key||"",n=e.to,r=e.from;(null==(n=f.s.obj(n)?n[t]:n)||k(n))&&(n=void 0),null==(r=f.s.obj(r)?r[t]:r)&&(r=void 0);var a={to:n,from:r};if(!ie(this)){if(e.reverse){var i=[r,n];n=i[0],r=i[1]}r=Object(f.q)(r),f.s.und(r)?Object(m.d)(this)||this._set(n):this._set(r)}return a}},{key:"_update",value:function(e,t){var n=this,r=v({},e),a=this.key,i=this.defaultProps;r.default&&Object.assign(i,_(r,(function(e,t){return/^on/.test(t)?B(e,a):e}))),fe(this,r,"onProps"),pe(this,"onProps",r,this);var o=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");var s=this._state;return j(++this._lastCallId,{key:a,props:r,defaultProps:i,state:s,actions:{pause:function(){se(n)||(ue(n,!0),Object(f.n)(s.pauseQueue),pe(n,"onPause",Q(n,ge(n,n.animation.to)),n))},resume:function(){se(n)&&(ue(n,!1),oe(n)&&n._resume(),Object(f.n)(s.resumeQueue),pe(n,"onResume",Q(n,ge(n,n.animation.to)),n))},start:this._merge.bind(this,o)}}).then((function(e){if(r.loop&&e.finished&&(!t||!e.noop)){var a=de(r);if(a)return n._update(a,!0)}return e}))}},{key:"_merge",value:function(e,t,n){var r=this;if(t.cancel)return this.stop(!0),n(P(this));var a=!f.s.und(e.to),i=!f.s.und(e.from);if(a||i){if(!(t.callId>this._lastToId))return n(P(this));this._lastToId=t.callId}var o=this.key,s=this.defaultProps,c=this.animation,u=c.to,l=c.from,g=e.to,d=void 0===g?u:g,I=e.from,A=void 0===I?l:I;if(!i||a||t.default&&!f.s.und(d)||(d=A),t.reverse){var h=[A,d];d=h[0],A=h[1]}var C=!Object(f.u)(A,l);C&&(c.from=A),A=Object(f.q)(A);var p=!Object(f.u)(d,u);p&&this._focus(d);var B=k(t.to),G=c.config,w=G.decay,_=G.velocity;(a||i)&&(G.velocity=0),t.config&&!B&&function(e,t,n){for(var r in n&&(T(n=v({},n),t),t=v({},n,t)),T(e,t),Object.assign(e,t),N)null==e[r]&&(e[r]=N[r]);var a=e.mass,i=e.frequency,o=e.damping;f.s.und(i)||(i<.01&&(i=.01),o<0&&(o=0),e.tension=Math.pow(2*Math.PI/i,2)*a,e.friction=4*Math.PI*o*a/i)}(G,b(t.config,o),t.config!==s.config?b(s.config,o):void 0);var Z=Object(m.d)(this);if(!Z||f.s.und(d))return n(Q(this,!0));var S=f.s.und(t.reset)?i&&!t.default:!f.s.und(A)&&y(t.reset,o),x=S?A:this.get(),M=R(d),E=f.s.num(M)||f.s.arr(M)||Object(f.t)(M),W=!B&&(!E||y(s.immediate||t.immediate,o));if(p){var V=Object(m.e)(d);if(V!==Z.constructor){if(!W)throw Error("Cannot animate between ".concat(Z.constructor.name," and ").concat(V.name,', as the "to" prop suggests'));Z=this._set(M)}}var F=Z.constructor,X=Object(f.r)(d),H=!1;if(!X){var O=S||!ie(this)&&C;(p||O)&&(X=!(H=Object(f.u)(R(x),M))),(Object(f.u)(c.immediate,W)||W)&&Object(f.u)(G.decay,w)&&Object(f.u)(G.velocity,_)||(X=!0)}if(H&&oe(this)&&(c.changed&&!S?X=!0:X||this._stop(u)),!B&&((X||Object(f.r)(u))&&(c.values=Z.getPayload(),c.toValues=Object(f.r)(d)?null:F==m.a?[1]:Object(f.y)(M)),c.immediate!=W&&(c.immediate=W,W||S||this._set(u)),X)){var L=c.onRest;Object(f.k)(Ce,(function(e){return fe(r,t,e)}));var Y=Q(this,ge(this,u));Object(f.n)(this._pendingCalls,Y),this._pendingCalls.add(n),c.changed&&f.w.batchedUpdates((function(){c.changed=!S,null==L||L(Y,r),S?b(s.onRest,Y):null==c.onStart||c.onStart(Y,r)}))}S&&this._set(x),B?n(J(t.to,t,this._state,this)):X?this._start():oe(this)&&!p?this._pendingCalls.add(n):n(U(x))}},{key:"_focus",value:function(e){var t=this.animation;e!==t.to&&(Object(f.p)(this)&&this._detach(),t.to=e,Object(f.p)(this)&&this._attach())}},{key:"_attach",value:function(){var e=0,t=this.animation.to;Object(f.r)(t)&&(Object(f.c)(t,this),te(t)&&(e=t.priority+1)),this.priority=e}},{key:"_detach",value:function(){var e=this.animation.to;Object(f.r)(e)&&Object(f.x)(e,this)}},{key:"_set",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Object(f.q)(e);if(!f.s.und(r)){var a=Object(m.d)(this);if(!a||!Object(f.u)(r,a.getValue())){var i=Object(m.e)(r);a&&a.constructor==i?a.setValue(r):Object(m.g)(this,i.create(r)),a&&f.w.batchedUpdates((function(){t._onChange(r,n)}))}}return Object(m.d)(this)}},{key:"_onStart",value:function(){var e=this.animation;e.changed||(e.changed=!0,pe(this,"onStart",Q(this,ge(this,e.to)),this))}},{key:"_onChange",value:function(e,t){t||(this._onStart(),b(this.animation.onChange,e,this)),b(this.defaultProps.onChange,e,this),Object(o.a)(Object(s.a)(n.prototype),"_onChange",this).call(this,e,t)}},{key:"_start",value:function(){var e=this.animation;Object(m.d)(this).reset(Object(f.q)(e.to)),e.immediate||(e.fromValues=e.values.map((function(e){return e.lastPosition}))),oe(this)||(ce(this,!0),se(this)||this._resume())}},{key:"_resume",value:function(){f.b.skipAnimation?this.finish():f.o.start(this)}},{key:"_stop",value:function(e,t){if(oe(this)){ce(this,!1);var n=this.animation;Object(f.k)(n.values,(function(e){e.done=!0})),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),Object(f.d)(this,{type:"idle",parent:this});var r=t?P(this.get()):Q(this.get(),ge(this,null!=e?e:n.to));Object(f.n)(this._pendingCalls,r),n.changed&&(n.changed=!1,pe(this,"onRest",r,this))}}}]),n}(re);function ge(e,t){var n=R(t),r=R(e.get());return Object(f.u)(r,n)}function de(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.loop,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.to,r=b(t);if(r){var a=!0!==r&&x(r),i=(a||e).reverse,o=!a||a.reset;return Ie(v({},e,{loop:t,default:!1,pause:void 0,to:!i||k(n)?n:void 0,from:o?e.from:void 0,reset:o},a))}}function Ie(e){var t=e=x(e),n=t.to,r=t.from,a=new Set;return f.s.obj(n)&&he(n,a),f.s.obj(r)&&he(r,a),e.keys=a.size?Array.from(a):null,e}function Ae(e){var t=Ie(e);return f.s.und(t.default)&&(t.default=_(t)),t}function he(e,t){Object(f.l)(e,(function(e,n){return null!=e&&t.add(n)}))}var Ce=["onStart","onRest","onChange","onPause","onResume"];function fe(e,t,n){e.animation[n]=t[n]!==G(t,n)?B(t[n],e.key):void 0}function pe(e,t){for(var n,r,a,i,o,s,c=arguments.length,u=new Array(c>2?c-2:0),l=2;l<c;l++)u[l-2]=arguments[l];null==(a=(i=e.animation)[t])||(n=a).call.apply(n,[i].concat(u)),null==(o=(s=e.defaultProps)[t])||(r=o).call.apply(r,[s].concat(u))}var me=["onStart","onChange","onRest"],ve=1,be=function(){function e(t,n){Object(I.a)(this,e),this.id=ve++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),t&&this.start(v({default:!0},t))}return Object(d.a)(e,[{key:"idle",get:function(){return!this._state.asyncTo&&Object.values(this.springs).every((function(e){return e.idle&&!e.isDelayed&&!e.isPaused}))}},{key:"item",get:function(){return this._item},set:function(e){this._item=e}},{key:"get",value:function(){var e={};return this.each((function(t,n){return e[n]=t.get()})),e}},{key:"set",value:function(e){for(var t in e){var n=e[t];f.s.und(n)||this.springs[t].set(n)}}},{key:"update",value:function(e){return e&&this.queue.push(Ie(e)),this}},{key:"start",value:function(e){var t=this.queue;return e?t=Object(f.y)(e).map(Ie):this.queue=[],this._flush?this._flush(this,t):(xe(this,t),ye(this,t))}},{key:"stop",value:function(e,t){if(e!==!!e&&(t=e),t){var n=this.springs;Object(f.k)(Object(f.y)(t),(function(t){return n[t].stop(!!e)}))}else q(this._state,this._lastAsyncId),this.each((function(t){return t.stop(!!e)}));return this}},{key:"pause",value:function(e){if(f.s.und(e))this.start({pause:!0});else{var t=this.springs;Object(f.k)(Object(f.y)(e),(function(e){return t[e].pause()}))}return this}},{key:"resume",value:function(e){if(f.s.und(e))this.start({pause:!1});else{var t=this.springs;Object(f.k)(Object(f.y)(e),(function(e){return t[e].resume()}))}return this}},{key:"each",value:function(e){Object(f.l)(this.springs,e)}},{key:"_onFrame",value:function(){var e=this,t=this._events,n=t.onStart,r=t.onChange,a=t.onRest,o=this._active.size>0,s=this._changed.size>0;(o&&!this._started||s&&!this._started)&&(this._started=!0,Object(f.m)(n,(function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];a.value=e.get(),r(a,e,e._item)})));var c=!o&&this._started,u=s||c&&a.size?this.get():null;s&&r.size&&Object(f.m)(r,(function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];a.value=u,r(a,e,e._item)})),c&&(this._started=!1,Object(f.m)(a,(function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];a.value=u,r(a,e,e._item)})))}},{key:"eventObserved",value:function(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}f.w.onFrame(this._onFrame)}}]),e}();function ye(e,t){return Promise.all(t.map((function(t){return Be(e,t)}))).then((function(t){return D(e,t)}))}function Be(e,t,n){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(g.a)(C.a.mark((function e(t,n,r){var a,i,o,s,c,u,l,g,d,I,A,h,p;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.keys,i=n.to,o=n.from,s=n.loop,c=n.onRest,u=n.onResolve,l=f.s.obj(n.default)&&n.default,s&&(n.loop=!1),!1===i&&(n.to=null),!1===o&&(n.from=null),(g=f.s.arr(i)||f.s.fun(i)?i:void 0)?(n.to=void 0,n.onRest=void 0,l&&(l.onRest=void 0)):Object(f.k)(me,(function(e){var r=n[e];if(f.s.fun(r)){var a=t._events[e];n[e]=function(e){var t=e.finished,n=e.cancelled,i=a.get(r);i?(t||(i.finished=!1),n&&(i.cancelled=!0)):a.set(r,{value:null,finished:t||!1,cancelled:n||!1})},l&&(l[e]=n[e])}})),d=t._state,n.pause===!d.paused?(d.paused=n.pause,Object(f.n)(n.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(n.pause=!0),I=(a||Object.keys(t.springs)).map((function(e){return t.springs[e].start(n)})),A=!0===n.cancel||!0===G(n,"cancel"),(g||A&&d.asyncId)&&I.push(j(++t._lastAsyncId,{props:n,state:d,actions:{pause:f.v,resume:f.v,start:function(e,n){A?(q(d,t._lastAsyncId),n(P(t))):(e.onRest=c,n(J(g,e,d,t)))}}})),!d.paused){e.next=15;break}return e.next=15,new Promise((function(e){d.resumeQueue.add(e)}));case 15:return e.t0=D,e.t1=t,e.next=19,Promise.all(I);case 19:if(e.t2=e.sent,h=(0,e.t0)(e.t1,e.t2),!s||!h.finished||r&&h.noop){e.next=26;break}if(!(p=de(n,s,i))){e.next=26;break}return xe(t,[p]),e.abrupt("return",Be(t,p,!0));case 26:return u&&f.w.batchedUpdates((function(){return u(h,t,t.item)})),e.abrupt("return",h);case 28:case"end":return e.stop()}}),e)}))),Ge.apply(this,arguments)}function we(e,t){var n=v({},e.springs);return t&&Object(f.k)(Object(f.y)(t),(function(e){f.s.und(e.keys)&&(e=Ie(e)),f.s.obj(e.to)||(e=v({},e,{to:void 0})),Se(n,e,(function(e){return Ze(e)}))})),_e(e,n),n}function _e(e,t){Object(f.l)(t,(function(t,n){e.springs[n]||(e.springs[n]=t,Object(f.c)(t,e))}))}function Ze(e,t){var n=new le;return n.key=e,t&&Object(f.c)(n,t),n}function Se(e,t,n){t.keys&&Object(f.k)(t.keys,(function(r){(e[r]||(e[r]=n(r)))._prepareNode(t)}))}function xe(e,t){Object(f.k)(t,(function(t){Se(e.springs,t,(function(t){return Ze(t,e)}))}))}function Re(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var Me,ke,Ee=["children"],We=function(e){var t=e.children,n=Re(e,Ee),r=Object(p.useContext)(Ve),a=n.pause||!!r.pause,i=n.immediate||!!r.immediate;n=Object(f.B)((function(){return{pause:a,immediate:i}}),[a,i]);var o=Ve.Provider;return p.createElement(o,{value:n},t)},Ve=(Me=We,ke={},Object.assign(Me,p.createContext(ke)),Me.Provider._context=Me,Me.Consumer._context=Me,Me);We.Provider=Ve.Provider,We.Consumer=Ve.Consumer;var Fe=function(){var e=[],t=function(t){Object(f.i)();var r=[];return Object(f.k)(e,(function(e,a){if(f.s.und(t))r.push(e.start());else{var i=n(t,e,a);i&&r.push(e.start(i))}})),r};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){var n=e.indexOf(t);~n&&e.splice(n,1)},t.pause=function(){var t=arguments;return Object(f.k)(e,(function(e){return e.pause.apply(e,Object(a.a)(t))})),this},t.resume=function(){var t=arguments;return Object(f.k)(e,(function(e){return e.resume.apply(e,Object(a.a)(t))})),this},t.set=function(t){Object(f.k)(e,(function(e){return e.set(t)}))},t.start=function(t){var n=this,r=[];return Object(f.k)(e,(function(e,a){if(f.s.und(t))r.push(e.start());else{var i=n._getProps(t,e,a);i&&r.push(e.start(i))}})),r},t.stop=function(){var t=arguments;return Object(f.k)(e,(function(e){return e.stop.apply(e,Object(a.a)(t))})),this},t.update=function(t){var n=this;return Object(f.k)(e,(function(e,r){return e.update(n._getProps(t,e,r))})),this};var n=function(e,t,n){return f.s.fun(e)?e(n,t):e};return t._getProps=n,t};function Xe(e,t,n){var r=arguments,i=f.s.fun(t)&&t;i&&!n&&(n=[]);var o=Object(p.useMemo)((function(){return i||3==r.length?Fe():void 0}),[]),s=Object(p.useRef)(0),c=Object(f.z)(),u=Object(p.useMemo)((function(){return{ctrls:[],queue:[],flush:function(e,t){var n=we(e,t);return s.current>0&&!u.queue.length&&!Object.keys(n).some((function(t){return!e.springs[t]}))?ye(e,t):new Promise((function(r){_e(e,n),u.queue.push((function(){r(ye(e,t))})),c()}))}}}),[]),l=Object(p.useRef)(Object(a.a)(u.ctrls)),g=[],d=Object(f.D)(e)||0;function I(e,n){for(var r=e;r<n;r++){var a=l.current[r]||(l.current[r]=new be(null,u.flush)),o=i?i(r,a):t[r];o&&(g[r]=Ae(o))}}Object(p.useMemo)((function(){Object(f.k)(l.current.slice(e,d),(function(e){E(e,o),e.stop(!0)})),l.current.length=e,I(d,e)}),[e]),Object(p.useMemo)((function(){I(0,Math.min(d,e))}),n);var A=l.current.map((function(e,t){return we(e,g[t])})),h=Object(p.useContext)(We),C=Object(f.D)(h),m=h!==C&&M(h);Object(f.A)((function(){s.current++,u.ctrls=l.current;var e=u.queue;e.length&&(u.queue=[],Object(f.k)(e,(function(e){return e()}))),Object(f.k)(l.current,(function(e,t){null==o||o.add(e),m&&e.start({default:h});var n=g[t];n&&(W(e,n.ref),e.ref?e.queue.push(n):e.start(n))}))})),Object(f.C)((function(){return function(){Object(f.k)(u.ctrls,(function(e){return e.stop(!0)}))}}));var b=A.map((function(e){return v({},e)}));return o?[b,o]:b}function He(e,t){var n=f.s.fun(e),r=Xe(1,n?e:[e],n?t||[]:t),a=Object(i.a)(r,2),o=Object(i.a)(a[0],1),s=o[0],c=a[1];return n||2==arguments.length?[s,c]:s}var Oe;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(Oe||(Oe={}));var Le=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,i){var o;Object(I.a)(this,n),(o=t.call(this)).key=void 0,o.idle=!0,o.calc=void 0,o._active=new Set,o.source=e,o.calc=f.f.apply(void 0,Object(a.a)(i));var s=o._get(),c=Object(m.e)(s);return Object(m.g)(Object(r.a)(o),c.create(s)),o}return Object(d.a)(n,[{key:"advance",value:function(e){var t=this._get(),n=this.get();Object(f.u)(t,n)||(Object(m.d)(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&Ye(this._active)&&Te(this)}},{key:"_get",value:function(){var e=f.s.arr(this.source)?this.source.map(f.q):Object(f.y)(Object(f.q)(this.source));return this.calc.apply(this,Object(a.a)(e))}},{key:"_start",value:function(){var e=this;this.idle&&!Ye(this._active)&&(this.idle=!1,Object(f.k)(Object(m.f)(this),(function(e){e.done=!1})),f.b.skipAnimation?(f.w.batchedUpdates((function(){return e.advance()})),Te(this)):f.o.start(this))}},{key:"_attach",value:function(){var e=this,t=1;Object(f.k)(Object(f.y)(this.source),(function(n){Object(f.r)(n)&&Object(f.c)(n,e),te(n)&&(n.idle||e._active.add(n),t=Math.max(t,n.priority+1))})),this.priority=t,this._start()}},{key:"_detach",value:function(){var e=this;Object(f.k)(Object(f.y)(this.source),(function(t){Object(f.r)(t)&&Object(f.x)(t,e)})),this._active.clear(),Te(this)}},{key:"eventObserved",value:function(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=Object(f.y)(this.source).reduce((function(e,t){return Math.max(e,(te(t)?t.priority:0)+1)}),0))}}]),n}(re);function Ne(e){return!1!==e.idle}function Ye(e){return!e.size||Array.from(e).every(Ne)}function Te(e){e.idle||(e.idle=!0,Object(f.k)(Object(m.f)(e),(function(e){e.done=!0})),Object(f.d)(e,{type:"idle",parent:e}))}f.b.assign({createStringInterpolator:f.g,to:function(e,t){return new Le(e,t)}});f.o.advance},function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){(function(t){var n=9007199254740991,r="[object Arguments]",a="[object Function]",i="[object GeneratorFunction]",o="[object Symbol]",s="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=s||c||Function("return this")();function l(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function g(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}var d=Object.prototype,I=d.hasOwnProperty,A=d.toString,h=u.Symbol,C=d.propertyIsEnumerable,f=h?h.isConcatSpreadable:void 0,p=Math.max;function m(e,t,n,r,a){var i=-1,o=e.length;for(n||(n=v),a||(a=[]);++i<o;){var s=e[i];t>0&&n(s)?t>1?m(s,t-1,n,r,a):g(a,s):r||(a[a.length]=s)}return a}function v(e){return y(e)||function(e){return function(e){return B(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?A.call(e):"";return t==a||t==i}(e)}(e)}(e)&&I.call(e,"callee")&&(!C.call(e,"callee")||A.call(e)==r)}(e)||!!(f&&e&&e[f])}function b(e){if("string"==typeof e||function(e){return"symbol"==typeof e||B(e)&&A.call(e)==o}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var y=Array.isArray;function B(e){return!!e&&"object"==typeof e}var G,w,_=(G=function(e,t){return null==e?{}:function(e,t){return function(e,t,n){for(var r=-1,a=t.length,i={};++r<a;){var o=t[r],s=e[o];n(s,o)&&(i[o]=s)}return i}(e=Object(e),t,(function(t,n){return n in e}))}(e,function(e,t){for(var n=-1,r=e?e.length:0,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}(m(t,1),b))},w=p(void 0===w?G.length-1:w,0),function(){for(var e=arguments,t=-1,n=p(e.length-w,0),r=Array(n);++t<n;)r[t]=e[w+t];t=-1;for(var a=Array(w+1);++t<w;)a[t]=e[t];return a[w]=r,l(G,this,a)});e.exports=_}).call(this,n(74))},function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,"a",(function(){return i}));var a=n(3);function i(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(a.a)(e)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCompatibility=t.Loader=t.ZapparCanvas=t.ZapparCamera=t.InstantTracker=t.ImageTracker=t.HeadMaskMesh=t.FaceTracker=t.FaceLandmark=t.FaceBufferGeometry=t.setLogLevel=t.LogLevel=t.Pipeline=t.browserIncompatible=void 0;var a=r(n(111));console.log("Zappar for React Three v".concat(a.default));var i=n(34);Object.defineProperty(t,"browserIncompatible",{enumerable:!0,get:function(){return i.browserIncompatible}}),Object.defineProperty(t,"Pipeline",{enumerable:!0,get:function(){return i.Pipeline}}),Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return i.LogLevel}}),Object.defineProperty(t,"setLogLevel",{enumerable:!0,get:function(){return i.setLogLevel}});var o=n(164);Object.defineProperty(t,"FaceBufferGeometry",{enumerable:!0,get:function(){return r(o).default}});var s=n(170);Object.defineProperty(t,"FaceLandmark",{enumerable:!0,get:function(){return r(s).default}});var c=n(172);Object.defineProperty(t,"FaceTracker",{enumerable:!0,get:function(){return r(c).default}});var u=n(173);Object.defineProperty(t,"HeadMaskMesh",{enumerable:!0,get:function(){return r(u).default}});var l=n(174);Object.defineProperty(t,"ImageTracker",{enumerable:!0,get:function(){return r(l).default}});var g=n(175);Object.defineProperty(t,"InstantTracker",{enumerable:!0,get:function(){return r(g).default}});var d=n(188);Object.defineProperty(t,"ZapparCamera",{enumerable:!0,get:function(){return r(d).default}});var I=n(189);Object.defineProperty(t,"ZapparCanvas",{enumerable:!0,get:function(){return r(I).default}});var A=n(190);Object.defineProperty(t,"Loader",{enumerable:!0,get:function(){return r(A).default}});var h=n(191);Object.defineProperty(t,"BrowserCompatibility",{enumerable:!0,get:function(){return r(h).default}})},function(e,t,n){var r=n(78);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cameraRotationForScreenOrientation=t.projectionMatrix=void 0;var r=n(36);function a(e){if(window.screen.orientation)switch(window.screen.orientation.type){case"portrait-primary":return e?90:270;case"landscape-secondary":return 180;case"portrait-secondary":return e?270:90;default:return 0}else if(void 0!==window.orientation)switch(window.orientation){case 0:return e?90:270;case 90:return 0;case 180:return e?270:90;case-90:return 180}return 0}t.projectionMatrix=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,s=2*e[2],c=2*e[3],u=r.mat4.create();r.mat4.frustum(u,i*(-.5-e[2])/e[0],i*(s-.5-e[2])/e[0],i*(c-.5-e[3])/e[1],i*(-.5-e[3])/e[1],i,o),u[4]*=-1,u[5]*=-1,u[6]*=-1,u[7]*=-1;var l=r.mat4.create();r.mat4.fromScaling(l,[.5*s,.5*c,1]),r.mat4.multiply(u,l,u),r.mat4.fromRotation(l,a(!1)*Math.PI/180,[0,0,1]),r.mat4.multiply(u,l,u);var g=r.vec3.create();g[0]=s,g[1]=c,g[2]=0,r.vec3.transformMat4(g,g,l);var d=Math.abs(g[0]),I=Math.abs(g[1]),A=1;return A=d/t>I/n?n/I:t/d,r.mat4.fromScaling(l,[A,A,1]),r.mat4.multiply(u,l,u),r.mat4.fromScaling(l,[2/t,2/n,1]),r.mat4.multiply(u,l,u),r.mat4.fromRotation(l,a(!1)*Math.PI/-180,[0,0,1]),r.mat4.multiply(u,u,l),u},t.cameraRotationForScreenOrientation=a},function(e,t,n){"use strict";var r=n(50).default,a=n(19).default,i=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.applyScreenCounterRotation=t.Pipeline=void 0;var o=n(132),s=n(36),c=n(71),u=n(133),l=n(134),g=n(79),d=n(80),I=n(46),A=new Map,h=function(){function e(t,n,r){a(this,e),this._client=t,this._impl=n,this._mgr=r,this.pendingMessages=[],this.cameraTokens=new Map,this.nextCameraToken=1,this.tokensInFlight=0,this.videoTextures=[],this.cameraPixelArrays=[],this.onGLContextReset=new d.Event}return i(e,[{key:"frameUpdate",value:function(e){var t,n=r(this.pendingMessages);try{for(n.s();!(t=n.n()).done;){var a=t.value;e.processMessages(a),this._mgr.postOutgoingMessage({t:"buf",p:this._impl,d:a},[a])}}catch(u){n.e(u)}finally{n.f()}this.pendingMessages=[];var i=this._client.pipeline_camera_frame_user_data(this._impl);if(i){var o,s=r(this.cameraTokens);try{for(s.s();!(o=s.n()).done;){var c=o.value;c[0]<i&&(c[1].texture&&this.videoTextures.push(c[1].texture),this.cameraTokens.delete(c[0]))}}catch(u){s.e(u)}finally{s.f()}}}},{key:"cameraTokenReturn",value:function(e,t){this.cameraPixelArrays.push(t),this.tokensInFlight--}},{key:"getVideoTexture",value:function(){return this.videoTextures.pop()}},{key:"destroy",value:function(){this._client.pipeline_destroy(this._impl),A.delete(this._impl)}},{key:"getCurrentCameraInfo",value:function(){var e=this._client.pipeline_camera_frame_user_data(this._impl);if(e)return this.cameraTokens.get(e)}},{key:"cameraFrameDrawGL",value:function(e,t,n){if(this.glContext){var r=this.getCurrentCameraInfo();r&&(this._cameraDraw||(this._cameraDraw=new o.CameraDraw(this.glContext)),this._cameraDraw.drawCameraFrame(e,t,r,!0===n))}}},{key:"glContextLost",value:function(){this._cameraDraw&&this._cameraDraw.dispose(),this._faceDraw&&this._faceDraw.dispose(),this._faceProjectDraw&&this._faceProjectDraw.dispose(),delete this._cameraDraw,delete this._faceDraw,delete this._faceProjectDraw,g.disposeDrawPlane(),this.onGLContextReset.emit();var e,t=r(this.videoTextures);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.glContext&&this.glContext.deleteTexture(n)}}catch(s){t.e(s)}finally{t.f()}this.videoTextures=[];var a,i=r(this.cameraTokens);try{for(i.s();!(a=i.n()).done;){var o=a.value;this.glContext&&o[1].texture&&this.glContext.deleteTexture(o[1].texture),o[1].texture=void 0}}catch(s){i.e(s)}finally{i.f()}this.glContext=void 0}},{key:"glContextSet",value:function(e,t){this.glContextLost(),this.glContext=e,t=t||[];for(var n=0;n<4;n++){var r=t[n]||e.createTexture();r&&(e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),this.videoTextures.push(r))}e.bindTexture(e.TEXTURE_2D,null)}},{key:"drawFace",value:function(e,t,n,r){if(this.glContext){this._faceDraw||(this._faceDraw=new u.FaceDraw(this.glContext));var a=s.mat4.create();s.mat4.multiply(a,e,t),s.mat4.multiply(a,a,n),this._faceDraw.drawFace(a,r)}}},{key:"drawFaceProject",value:function(e,t,n,r,a,i){this.glContext&&(this._faceProjectDraw||(this._faceProjectDraw=new l.FaceDrawProject(this.glContext)),this._faceProjectDraw.drawFace(e,t,n,r,a,i))}},{key:"cameraFrameTexture",value:function(){var e;return null===(e=this.getCurrentCameraInfo())||void 0===e?void 0:e.texture}},{key:"cameraFrameTextureMatrix",value:function(e,t,n){var r=this.getCurrentCameraInfo();return r?o.cameraFrameTextureMatrix(r.dataWidth,r.dataHeight,e,t,r.uvTransform,n):s.mat4.create()}},{key:"cameraFrameUserFacing",value:function(){var e;return(null===(e=this.getCurrentCameraInfo())||void 0===e?void 0:e.userFacing)||!1}},{key:"cameraPoseWithAttitude",value:function(e){var t=C(this.getCurrentCameraInfo(),this._client.pipeline_camera_frame_camera_attitude(this._impl));if(e){var n=s.mat4.create();s.mat4.fromScaling(n,[-1,1,1]),s.mat4.multiply(t,n,t),s.mat4.multiply(t,t,n)}return s.mat4.invert(t,t),t}},{key:"processGL",value:function(){if(this.glContext){if(this.currentCameraSource)if(this.tokensInFlight>0)this.currentCameraSource.getFrame(!0);else{var e=this.currentCameraSource.getFrame(!1);if(e){var t=this.nextCameraToken++;this.cameraTokens.set(t,e);var n={d:e.data,p:this._impl,width:e.dataWidth,height:e.dataHeight,token:t,userFacing:e.userFacing,t:"cameraFrameC2S"};this.tokensInFlight++,this._mgr.postOutgoingMessage(n,[e.data])}}}else I.zcerr("no GL context for camera frames - please call pipeline_gl_context_set")}},{key:"motionAccelerometerSubmit",value:function(e,t,n,r){this._client.pipeline_motion_accelerometer_submit(this._impl,e,t,n,r)}},{key:"motionRotationRateSubmit",value:function(e,t,n,r){this._client.pipeline_motion_rotation_rate_submit(this._impl,e,t,n,r)}},{key:"motionAttitudeSubmit",value:function(e,t,n,r){this._client.pipeline_motion_attitude_submit(this._impl,e,t,n,r)}}],[{key:"create",value:function(t,n){var r=t.pipeline_create();return A.set(r,new e(t,r,n)),r}},{key:"get",value:function(e){return A.get(e)}}]),e}();function C(e,t){var n;n=!!e&&e.userFacing;var r=s.mat4.create();return s.mat4.fromRotation(r,c.cameraRotationForScreenOrientation(n)*Math.PI/180,[0,0,1]),s.mat4.multiply(r,r,t),r}t.Pipeline=h,t.applyScreenCounterRotation=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.default=function(e,t){(0,r.useEffect)((function(){e&&void 0!==t&&(e.enabled=t)}),[e,t])}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t){function n(e,t,n){var r,a,i,o,s;function c(){var u=Date.now()-o;u<t&&u>=0?r=setTimeout(c,t-u):(r=null,n||(s=e.apply(i,a),i=a=null))}null==t&&(t=100);var u=function(){i=this,a=arguments,o=Date.now();var u=n&&!r;return r||(r=setTimeout(c,t)),u&&(s=e.apply(i,a),i=a=null),s};return u.clear=function(){r&&(clearTimeout(r),r=null)},u.flush=function(){r&&(s=e.apply(i,a),i=a=null,clearTimeout(r),r=null)},u}n.debounce=n,e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(9),a=n(62);n.o(a,"useSpring")&&n.d(t,"useSpring",(function(){return a.useSpring}));var i=n(8),o=n(26),s=n(0),c=["primitive"].concat(Object.keys(s).filter((function(e){return/^[A-Z]/.test(e)})).map((function(e){return e[0].toLowerCase()+e.slice(1)})));a.Globals.assign({createStringInterpolator:i.g,colors:i.e,frameLoop:"demand"}),Object(r.addEffect)((function(){i.w.advance()}));var u=Object(o.c)(c,{applyAnimatedValues:r.applyProps}).animated},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(16),a=n(22),i=n(4),o=n(5),s=n(10),c=n(21);function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l={target:function(e){if(e)return function(){return"current"in e?e.current:e}},enabled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e},window:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.c.isBrowser?window:void 0;return e})),eventOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.passive,n=void 0===t||t,r=e.capture,a=void 0!==r&&r;return{passive:n,capture:a}},transform:function(e){return e}},g=["target","eventOptions","window","enabled","transform"];function d(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={},r=0,a=Object.entries(t);r<a.length;r++){var i=Object(s.a)(a[r],2),o=i[0],c=i[1];switch(typeof c){case"function":n[o]=c.call(n,e[o],o,e);break;case"object":n[o]=d(e[o],c);break;case"boolean":c&&(n[o]=e[o])}}return n}var I=function(){function e(t){Object(i.a)(this,e),Object(c.e)(this,"_listeners",[]),this._ctrl=t}return Object(o.a)(e,[{key:"add",value:function(e,t,n,r,a){var i=Object(c.q)(t,n),o=Object(c.d)(Object(c.d)({},this._ctrl.config.shared.eventOptions),a);e.addEventListener(i,r,o),this._listeners.push((function(){return e.removeEventListener(i,r,o)}))}},{key:"clean",value:function(){this._listeners.forEach((function(e){return e()})),this._listeners=[]}}]),e}(),A=function(){function e(){Object(i.a)(this,e),Object(c.e)(this,"_timeouts",new Map)}return Object(o.a)(e,[{key:"add",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:140;this.remove(e);for(var a=arguments.length,i=new Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];this._timeouts.set(e,(n=window).setTimeout.apply(n,[t,r].concat(i)))}},{key:"remove",value:function(e){var t=this._timeouts.get(e);t&&window.clearTimeout(t)}},{key:"clean",value:function(){this._timeouts.forEach((function(e){window.clearTimeout(e)})),this._timeouts.clear()}}]),e}(),h=function(){function e(t){Object(i.a)(this,e),Object(c.e)(this,"gestures",new Set),Object(c.e)(this,"_targetEventStore",new I(this)),Object(c.e)(this,"gestureEventStores",{}),Object(c.e)(this,"gestureTimeoutStores",{}),Object(c.e)(this,"handlers",{}),Object(c.e)(this,"config",{}),Object(c.e)(this,"pointerIds",new Set),Object(c.e)(this,"touchIds",new Set),Object(c.e)(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&C(e,"drag");t.wheel&&C(e,"wheel");t.scroll&&C(e,"scroll");t.move&&C(e,"move");t.pinch&&C(e,"pinch");t.hover&&C(e,"hover")}(this,t)}return Object(o.a)(e,[{key:"setEventIds",value:function(e){Object(c.l)(e)?this.touchIds=new Set(Object(c.f)(e)):"pointerId"in e&&("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId))}},{key:"applyHandlers",value:function(e,t){this.handlers=e,this.nativeHandlers=t}},{key:"applyConfig",value:function(e,t){this.config=function(e,t){var n=e,r=n.target,a=n.eventOptions,i=n.window,o=n.enabled,s=n.transform,I=u(n,g),A={shared:d({target:r,eventOptions:a,window:i,enabled:o,transform:s},l)};if(t){var h=c.a.get(t);A[t]=d(Object(c.d)({shared:A.shared},I),h)}else for(var C in I){var f=c.a.get(C);f&&(A[C]=d(Object(c.d)({shared:A.shared},I[C]),f))}return A}(e,t)}},{key:"clean",value:function(){this._targetEventStore.clean();var e,t=Object(a.a)(this.gestures);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.gestureEventStores[n].clean(),this.gestureTimeoutStores[n].clean()}}catch(r){t.e(r)}finally{t.f()}}},{key:"effect",value:function(){var e=this;return this.config.shared.target&&this.bind(),function(){return e._targetEventStore.clean()}}},{key:"bind",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o,s=this.config.shared,u=s.eventOptions,l={};if(!s.target||(o=s.target())){var g=f(l,u,!!o);if(s.enabled){var d,I=Object(a.a)(this.gestures);try{for(I.s();!(d=I.n()).done;){var A=d.value;if(this.config[A].enabled){var h=c.b.get(A);new h(this,n,A).bind(g)}}}catch(w){I.e(w)}finally{I.f()}var C=function(t){g(t,"",(function(r){return e.nativeHandlers[t](Object(c.d)(Object(c.d)({},e.state.shared),{},{event:r,args:n}))}),void 0,!0)};for(var p in this.nativeHandlers)C(p)}for(var m in l)l[m]=c.g.apply(void 0,Object(r.a)(l[m]));if(!o)return l;for(var v in l){var b=Object(c.n)(v),y=b.device,B=b.capture,G=b.passive;this._targetEventStore.add(o,y,"",l[v],{capture:B,passive:G})}}}}]),e}();function C(e,t){e.gestures.add(t),e.gestureEventStores[t]=new I(e),e.gestureTimeoutStores[t]=new A}var f=function(e,t,n){return function(r,a,i){var o,s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=null!==(o=u.capture)&&void 0!==o?o:t.capture,d=null!==(s=u.passive)&&void 0!==s?s:t.passive,I=l?r:Object(c.h)(r,a,g);n&&d&&(I+="Passive"),e[I]=e[I]||[],e[I].push(i)}},p=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function m(e,t,n,r,a,i){if(e.has(n)&&c.b.has(r)){var o=n+"Start",s=n+"End";a[r]=function(e){var r=void 0;return e.first&&o in t&&t[o](e),n in t&&(r=t[n](e)),e.last&&s in t&&t[s](e),r},i[r]=i[r]||{}}}function v(e,t){var n=function(e){var t={},n={},r=new Set;for(var a in e)p.test(a)?(r.add(RegExp.lastMatch),n[a]=e[a]):t[a]=e[a];return[n,t,r]}(e),r=Object(s.a)(n,3),a=r[0],i=r[1],o=r[2],c={};return m(o,a,"onDrag","drag",c,t),m(o,a,"onWheel","wheel",c,t),m(o,a,"onScroll","scroll",c,t),m(o,a,"onPinch","pinch",c,t),m(o,a,"onMove","move",c,t),m(o,a,"onHover","hover",c,t),{handlers:c,config:t,nativeHandlers:i}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawPlane=t.disposeDrawPlane=void 0;var r,a,i,o=n(52),s={};function c(e){if(i)return i;if(!(i=e.createBuffer()))throw new Error("Unable to create buffer object");return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,1,1,0]),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),i}t.disposeDrawPlane=function(){r=void 0,a=void 0,i=void 0,s={}},t.drawPlane=function(e,t,n,r,i){var o=u(e),l=function(e){if(a)return a;if(!(a=e.createBuffer()))throw new Error("Unable to create buffer object");return e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-.5,.125,0,-.5,-.125,0,.5,.125,0,.5,-.125,0]),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),a}(e),g=c(e);e.disable(e.DEPTH_TEST),e.useProgram(o.prog),e.uniformMatrix4fv(o.unif_proj,!1,t),e.uniformMatrix4fv(o.unif_camera,!1,n),e.uniformMatrix4fv(o.unif_matrix,!1,r),e.bindBuffer(e.ARRAY_BUFFER,l),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,function(e,t){if(s[t])return s[t];var n=e.createTexture();if(!n)throw new Error("Unable to create texture");s[t]=n,e.bindTexture(e.TEXTURE_2D,n);var r=0,a=e.RGBA,i=1,o=1,c=0,u=e.RGBA,l=e.UNSIGNED_BYTE,g=new Uint8Array([0,0,255,255]);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,r,a,i,o,c,u,l,g);var d=new Image;return d.onload=function(){e.bindTexture(e.TEXTURE_2D,n),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,r,a,u,l,d),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)},d.src=t,n}(e,i)),e.uniform1i(o.unif_skinSampler,0),e.vertexAttribPointer(o.attr_position,3,e.FLOAT,!1,12,0),e.enableVertexAttribArray(o.attr_position),e.bindBuffer(e.ARRAY_BUFFER,g),e.vertexAttribPointer(o.attr_textureCoord,2,e.FLOAT,!1,8,0),e.enableVertexAttribArray(o.attr_textureCoord),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.disableVertexAttribArray(o.attr_position),e.bindBuffer(e.ARRAY_BUFFER,null)};function u(e){if(r)return r;var t=e.createProgram();if(!t)throw new Error("Unable to create program");var n=o.compileShader(e,e.VERTEX_SHADER,"\n#ifndef GL_ES\n#define highp\n#define mediump\n#define lowp\n#endif\n\nuniform mat4 projMatrix;\nuniform mat4 cameraMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec4 position;\nattribute vec2 textureCoord;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main()\n{\n    gl_Position = projMatrix * cameraMatrix * modelViewMatrix * position;\n    vTextureCoord = textureCoord;\n}"),a=o.compileShader(e,e.FRAGMENT_SHADER,"\n#define highp mediump\n#ifdef GL_ES\n    // define default precision for float, vec, mat.\n    precision highp float;\n#else\n#define highp\n#define mediump\n#define lowp\n#endif\n\nvarying highp vec2 vTextureCoord;\nuniform sampler2D skinSampler;\n\nvoid main()\n{\n    gl_FragColor = texture2D(skinSampler, vTextureCoord);\n}");e.attachShader(t,n),e.attachShader(t,a),o.linkProgram(e,t);var i=e.getUniformLocation(t,"projMatrix");if(!i)throw new Error("Unable to get uniform location projMatrix");var s=e.getUniformLocation(t,"modelViewMatrix");if(!s)throw new Error("Unable to get uniform location modelViewMatrix");var c=e.getUniformLocation(t,"cameraMatrix");if(!c)throw new Error("Unable to get uniform location cameraMatrix");var u=e.getUniformLocation(t,"skinSampler");if(!u)throw new Error("Unable to get uniform location skinSampler");return r={prog:t,unif_matrix:s,unif_proj:i,unif_camera:c,unif_skinSampler:u,attr_position:e.getAttribLocation(t,"position"),attr_textureCoord:e.getAttribLocation(t,"textureCoord")}}},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Event5=t.Event3=t.Event2=t.Event1=t.Event=void 0;var i=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(){for(var e=0,t=this._funcs.length;e<t;e++)this._funcs[e]()}}]),e}();t.Event=i;var o=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e){for(var t=0,n=this._funcs.length;t<n;t++)this._funcs[t](e)}}]),e}();t.Event1=o;var s=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t){for(var n=0,r=this._funcs.length;n<r;n++)this._funcs[n](e,t)}}]),e}();t.Event2=s;var c=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t,n){for(var r=0,a=this._funcs.length;r<a;r++)this._funcs[r](e,t,n)}}]),e}();t.Event3=c;var u=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t,n,r,a){for(var i=0,o=this._funcs.length;i<o;i++)this._funcs[i](e,t,n,r,a)}}]),e}();t.Event5=u},function(e,t,n){var r;!function(a,i){"use strict";var o="function",s="undefined",c="object",u="string",l="model",g="name",d="type",I="vendor",A="version",h="architecture",C="console",f="mobile",p="tablet",m="smarttv",v="wearable",b="embedded",y="Amazon",B="Apple",G="ASUS",w="BlackBerry",_="Firefox",Z="Google",S="Huawei",x="LG",R="Microsoft",M="Motorola",k="Opera",E="Samsung",W="Sony",V="Xiaomi",F="Zebra",X="Facebook",H=function(e){var t={};for(var n in e)t[e[n].toUpperCase()]=e[n];return t},O=function(e,t){return typeof e===u&&-1!==L(t).indexOf(L(e))},L=function(e){return e.toLowerCase()},N=function(e,t){if(typeof e===u)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===s?e:e.substring(0,255)},Y=function(e,t){for(var n,r,a,s,u,l,g=0;g<t.length&&!u;){var d=t[g],I=t[g+1];for(n=r=0;n<d.length&&!u;)if(u=d[n++].exec(e))for(a=0;a<I.length;a++)l=u[++r],typeof(s=I[a])===c&&s.length>0?2==s.length?typeof s[1]==o?this[s[0]]=s[1].call(this,l):this[s[0]]=s[1]:3==s.length?typeof s[1]!==o||s[1].exec&&s[1].test?this[s[0]]=l?l.replace(s[1],s[2]):i:this[s[0]]=l?s[1].call(this,l,s[2]):i:4==s.length&&(this[s[0]]=l?s[3].call(this,l.replace(s[1],s[2])):i):this[s]=l||i;g+=2}},T=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(O(t[n][r],e))return"?"===n?i:n}else if(O(t[n],e))return"?"===n?i:n;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[g,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[g,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[g,A],[/opios[\/ ]+([\w\.]+)/i],[A,[g,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[A,[g,k]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[g,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[g,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[A,[g,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[A,[g,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[g,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[g,"IE"]],[/yabrowser\/([\w\.]+)/i],[A,[g,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[g,/(.+)/,"$1 Secure Browser"],A],[/\bfocus\/([\w\.]+)/i],[A,[g,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[A,[g,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[g,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[g,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[g,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[g,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[A,[g,_]],[/\bqihu|(qi?ho?o?|360)browser/i],[[g,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[g,/(.+)/,"$1 Browser"],A],[/(comodo_dragon)\/([\w\.]+)/i],[[g,/_/g," "],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[g,A],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[g],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[g,X],A],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[g,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[g,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[g,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[g,"Chrome WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[g,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[g,A],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[A,[g,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[A,g],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[g,[A,T,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[g,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[g,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[g,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[g,A]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,L]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",L]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,L]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[I,E],[d,p]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[I,E],[d,f]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[I,B],[d,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[I,B],[d,p]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[I,S],[d,p]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[l,[I,S],[d,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[I,V],[d,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[I,V],[d,p]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007)\b/i],[l,[I,"OPPO"],[d,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[I,"Vivo"],[d,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[I,"Realme"],[d,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[I,M],[d,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[I,M],[d,p]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[I,x],[d,p]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[I,x],[d,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[I,"Lenovo"],[d,p]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[I,"Nokia"],[d,f]],[/(pixel c)\b/i],[l,[I,Z],[d,p]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[I,Z],[d,f]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[I,W],[d,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[I,W],[d,p]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[I,"OnePlus"],[d,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[I,y],[d,p]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[I,y],[d,f]],[/(playbook);[-\w\),; ]+(rim)/i],[l,I,[d,p]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[I,w],[d,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[I,G],[d,p]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[I,G],[d,f]],[/(nexus 9)/i],[l,[I,"HTC"],[d,p]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[I,[l,/_/g," "],[d,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[I,"Acer"],[d,p]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[I,"Meizu"],[d,f]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[I,"Sharp"],[d,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[I,l,[d,f]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[I,l,[d,p]],[/(surface duo)/i],[l,[I,R],[d,p]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[I,"Fairphone"],[d,f]],[/(u304aa)/i],[l,[I,"AT&T"],[d,f]],[/\bsie-(\w*)/i],[l,[I,"Siemens"],[d,f]],[/\b(rct\w+) b/i],[l,[I,"RCA"],[d,p]],[/\b(venue[\d ]{2,7}) b/i],[l,[I,"Dell"],[d,p]],[/\b(q(?:mv|ta)\w+) b/i],[l,[I,"Verizon"],[d,p]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[I,"Barnes & Noble"],[d,p]],[/\b(tm\d{3}\w+) b/i],[l,[I,"NuVision"],[d,p]],[/\b(k88) b/i],[l,[I,"ZTE"],[d,p]],[/\b(nx\d{3}j) b/i],[l,[I,"ZTE"],[d,f]],[/\b(gen\d{3}) b.+49h/i],[l,[I,"Swiss"],[d,f]],[/\b(zur\d{3}) b/i],[l,[I,"Swiss"],[d,p]],[/\b((zeki)?tb.*\b) b/i],[l,[I,"Zeki"],[d,p]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[I,"Dragon Touch"],l,[d,p]],[/\b(ns-?\w{0,9}) b/i],[l,[I,"Insignia"],[d,p]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[I,"NextBook"],[d,p]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[I,"Voice"],l,[d,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[I,"LvTel"],l,[d,f]],[/\b(ph-1) /i],[l,[I,"Essential"],[d,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[I,"Envizen"],[d,p]],[/\b(trio[-\w\. ]+) b/i],[l,[I,"MachSpeed"],[d,p]],[/\btu_(1491) b/i],[l,[I,"Rotor"],[d,p]],[/(shield[\w ]+) b/i],[l,[I,"Nvidia"],[d,p]],[/(sprint) (\w+)/i],[I,l,[d,f]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[I,R],[d,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[I,F],[d,p]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[I,F],[d,f]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[I,l,[d,C]],[/droid.+; (shield) bui/i],[l,[I,"Nvidia"],[d,C]],[/(playstation [345portablevi]+)/i],[l,[I,W],[d,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[I,R],[d,C]],[/smart-tv.+(samsung)/i],[I,[d,m]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[I,E],[d,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[I,x],[d,m]],[/(apple) ?tv/i],[I,[l,"Apple TV"],[d,m]],[/crkey/i],[[l,"Chromecast"],[I,Z],[d,m]],[/droid.+aft(\w)( bui|\))/i],[l,[I,y],[d,m]],[/\(dtv[\);].+(aquos)/i],[l,[I,"Sharp"],[d,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[I,N],[l,N],[d,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,m]],[/((pebble))app/i],[I,l,[d,v]],[/droid.+; (glass) \d/i],[l,[I,Z],[d,v]],[/droid.+; (wt63?0{2,3})\)/i],[l,[I,F],[d,v]],[/(quest( 2)?)/i],[l,[I,X],[d,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[I,[d,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[d,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[d,p]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,p]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[d,f]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[I,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[g,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[g,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[g,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,g]],os:[[/microsoft (windows) (vista|xp)/i],[g,A],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[g,[A,T,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,"Windows"],[A,T,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[g,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[g,"Mac OS"],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[A,g],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[g,A],[/\(bb(10);/i],[A,[g,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[g,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[g,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[g,"webOS"]],[/crkey\/([\d\.]+)/i],[A,[g,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[g,"Chromium OS"],A],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[g,A],[/(sunos) ?([\w\.\d]*)/i],[[g,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[g,A]]},j=function e(t,n){if(typeof t===c&&(n=t,t=i),!(this instanceof e))return new e(t,n).getResult();var r=t||(typeof a!==s&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),o=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2===0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(K,n):K;return this.getBrowser=function(){var e,t={};return t.name=i,t.version=i,Y.call(t,r,o.browser),t.major=typeof(e=t.version)===u?e.replace(/[^\d\.]/g,"").split(".")[0]:i,t},this.getCPU=function(){var e={};return e.architecture=i,Y.call(e,r,o.cpu),e},this.getDevice=function(){var e={};return e.vendor=i,e.model=i,e.type=i,Y.call(e,r,o.device),e},this.getEngine=function(){var e={};return e.name=i,e.version=i,Y.call(e,r,o.engine),e},this.getOS=function(){var e={};return e.name=i,e.version=i,Y.call(e,r,o.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===u&&e.length>255?N(e,255):e,this},this.setUA(r),this};j.VERSION="0.7.30",j.BROWSER=H([g,A,"major"]),j.CPU=H([h]),j.DEVICE=H([l,I,d,C,f,m,p,v,b]),j.ENGINE=j.OS=H([g,A]),typeof t!==s?(typeof e!==s&&e.exports&&(t=e.exports=j),t.UAParser=j):n(130)?(r=function(){return j}.call(t,n,t,e))===i||(e.exports=r):typeof a!==s&&(a.UAParser=j);var D=typeof a!==s&&(a.jQuery||a.Zepto);if(D&&!D.ua){var U=new j;D.ua=U.getResult(),D.ua.get=function(){return U.getUA()},D.ua.set=function(e){U.setUA(e);var t=U.getResult();for(var n in t)D.ua[n]=t[n]}}}("object"===typeof window?window:this)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log_level_t=t.instant_world_tracker_transform_orientation_t=t.face_landmark_name_t=t.barcode_format_t=void 0;var r=n(60);Object.defineProperty(t,"barcode_format_t",{enumerable:!0,get:function(){return r.barcode_format_t}});var a=n(60);Object.defineProperty(t,"face_landmark_name_t",{enumerable:!0,get:function(){return a.face_landmark_name_t}});var i=n(60);Object.defineProperty(t,"instant_world_tracker_transform_orientation_t",{enumerable:!0,get:function(){return i.instant_world_tracker_transform_orientation_t}});var o=n(60);Object.defineProperty(t,"log_level_t",{enumerable:!0,get:function(){return o.log_level_t}})},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(59).default,o=n(29).default,s=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementSource=void 0;var c=n(72),u=n(136),l=n(84),g=n(52),d=n(36),I=n(46),A=n(137),h=1,C=new Map,f=function(e){o(n,e);var t=s(n);function n(e,a){var o;r(this,n),(o=t.call(this))._video=e,o._pipeline=a,o._isPaused=!0,o._hadFrames=!1,o._isUserFacing=!1,o._cameraToScreenRotation=0,o._isUploadFrame=!0,o._computedTransformRotation=-1,o._computedFrontCameraRotation=!1,o._cameraUvTransform=d.mat4.create(),o._cameraVertexTransform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o._framebufferWidth=0,o._framebufferHeight=0,o._framebufferId=null,o._renderTexture=null;var s=o._video;o._video instanceof HTMLVideoElement?s.addEventListener("loadedmetadata",(function(){o._hadFrames=!0})):o._hadFrames=!0,o._resetGLContext=o._resetGLContext.bind(i(o));var u=c.Pipeline.get(o._pipeline);return u&&u.onGLContextReset.bind(o._resetGLContext),o}return a(n,[{key:"_resetGLContext",value:function(){this._currentVideoTexture=void 0,this._framebufferId=null,this._renderTexture=null,this._vertexBuffer=void 0,this._indexBuffer=void 0,this._greyscaleShader=void 0}},{key:"destroy",value:function(){var e=c.Pipeline.get(this._pipeline);e&&e.onGLContextReset.unbind(this._resetGLContext),this.pause(),this._resetGLContext()}},{key:"pause",value:function(){this._isPaused=!0;var e=c.Pipeline.get(this._pipeline);e&&e.currentCameraSource===this&&(e.currentCameraSource=void 0)}},{key:"start",value:function(){var e;this._isPaused&&(this._isUploadFrame=!0,this._video instanceof HTMLVideoElement&&(this._hadFrames=!1)),this._isPaused=!1;var t=c.Pipeline.get(this._pipeline);t&&t.currentCameraSource!==this&&(null===(e=t.currentCameraSource)||void 0===e||e.pause(),t.currentCameraSource=this)}},{key:"getFrame",value:function(e){var t=c.Pipeline.get(this._pipeline);if(t){var n=t.glContext;if(n&&!this._isPaused&&this._hadFrames)try{return this._processFrame(n,this._cameraToScreenRotation,e)}catch(r){console.log("Unable to process frame")}}}},{key:"_processFrame",value:function(e,t,n){var r=c.Pipeline.get(this._pipeline);if(r){if(this._isUploadFrame)return this._currentVideoTexture||(this._currentVideoTexture=r.getVideoTexture()),this._uploadFrame(t,this._isUserFacing),void(this._isUploadFrame=!this._isUploadFrame);if(!n)return this._isUploadFrame=!this._isUploadFrame,this._readFrame(r,e)}}},{key:"_uploadFrame",value:function(e,t){if(this._currentVideoTexture){var n=c.Pipeline.get(this._pipeline);if(n){var r=n.glContext;if(r){var a=A.GLStateManager.get(r);a.push();var i=r.isEnabled(r.SCISSOR_TEST),o=r.isEnabled(r.DEPTH_TEST),s=r.isEnabled(r.BLEND),u=r.isEnabled(r.CULL_FACE),g=r.getParameter(r.ACTIVE_TEXTURE),d=r.getParameter(r.UNPACK_FLIP_Y_WEBGL),I=r.getParameter(r.CURRENT_PROGRAM);r.activeTexture(r.TEXTURE0);var h=r.getParameter(r.TEXTURE_BINDING_2D),C=r.getParameter(r.FRAMEBUFFER_BINDING),f=r.getParameter(r.ARRAY_BUFFER_BINDING),p=r.getParameter(r.ELEMENT_ARRAY_BUFFER_BINDING);r.disable(r.SCISSOR_TEST),r.disable(r.DEPTH_TEST),r.disable(r.BLEND),r.disable(r.CULL_FACE),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.bindTexture(r.TEXTURE_2D,this._currentVideoTexture);var m=r.RGBA,v=r.RGBA,b=r.UNSIGNED_BYTE;r.texImage2D(r.TEXTURE_2D,0,m,v,b,this._video);var y=0,B=0;this._video instanceof HTMLVideoElement?(y=this._video.videoWidth,B=this._video.videoHeight):(y=this._video.width,B=this._video.height),B>y&&(B=[y,y=B][0]),this._updateTransforms(e,t);var G=this._getFramebuffer(r,l.profile.dataWidth/4,l.profile.dataHeight),w=this._getVertexBuffer(r),_=this._getIndexBuffer(r),Z=this._getGreyscaleShader(r),S=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_SIZE),x=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_TYPE),R=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_NORMALIZED),M=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_STRIDE),k=r.getVertexAttribOffset(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_POINTER),E=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_ENABLED),W=r.getVertexAttrib(Z.aVertexPositionLoc,r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING),V=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_SIZE),F=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_TYPE),X=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_NORMALIZED),H=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_STRIDE),O=r.getVertexAttribOffset(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_POINTER),L=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_ENABLED),N=r.getVertexAttrib(Z.aTextureCoordLoc,r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING);r.bindFramebuffer(r.FRAMEBUFFER,G),r.viewport(0,0,this._framebufferWidth,this._framebufferHeight),r.clear(r.COLOR_BUFFER_BIT),r.bindBuffer(r.ARRAY_BUFFER,w),r.vertexAttribPointer(Z.aVertexPositionLoc,2,r.FLOAT,!1,16,0),r.enableVertexAttribArray(Z.aVertexPositionLoc),r.vertexAttribPointer(Z.aTextureCoordLoc,2,r.FLOAT,!1,16,8),r.enableVertexAttribArray(Z.aTextureCoordLoc),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,_),r.useProgram(Z.program),r.uniform1f(Z.uTexWidthLoc,l.profile.dataWidth),r.uniformMatrix4fv(Z.uUvTransformLoc,!1,this._cameraUvTransform),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._currentVideoTexture),r.uniform1i(Z.uSamplerLoc,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,W),r.vertexAttribPointer(Z.aVertexPositionLoc,S,x,R,M,k),r.bindBuffer(r.ARRAY_BUFFER,N),r.vertexAttribPointer(Z.aTextureCoordLoc,V,F,X,H,O),r.bindBuffer(r.ARRAY_BUFFER,f),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),E||r.disableVertexAttribArray(Z.aVertexPositionLoc),L||r.disableVertexAttribArray(Z.aTextureCoordLoc),r.bindFramebuffer(r.FRAMEBUFFER,C),r.useProgram(I),r.bindTexture(r.TEXTURE_2D,h),r.activeTexture(g),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,d),s&&r.enable(r.BLEND),u&&r.enable(r.CULL_FACE),o&&r.enable(r.DEPTH_TEST),i&&r.enable(r.SCISSOR_TEST),a.pop()}}}}},{key:"_readFrame",value:function(e,t){if(!this._currentVideoTexture)throw new Error("No video texture");var n=this._currentVideoTexture;this._currentVideoTexture=void 0;for(var r=l.profile.dataWidth*l.profile.dataHeight,a=e.cameraPixelArrays.pop();a&&a.byteLength!==r;)a=e.cameraPixelArrays.pop();a||(a=new ArrayBuffer(r));var i=new Uint8Array(a),o=t.getParameter(t.FRAMEBUFFER_BINDING),s=this._getFramebuffer(t,l.profile.dataWidth/4,l.profile.dataHeight);return t.bindFramebuffer(t.FRAMEBUFFER,s),t.readPixels(0,0,this._framebufferWidth,this._framebufferHeight,t.RGBA,t.UNSIGNED_BYTE,i),t.bindFramebuffer(t.FRAMEBUFFER,o),{uvTransform:this._cameraUvTransform,data:a,texture:n,dataWidth:l.profile.dataWidth,dataHeight:l.profile.dataHeight,userFacing:this._computedFrontCameraRotation}}},{key:"_updateTransforms",value:function(e,t){e==this._computedTransformRotation&&t==this._computedFrontCameraRotation||(this._computedTransformRotation=e,this._computedFrontCameraRotation=t,this._cameraUvTransform=this._getCameraUvTransform(),this._cameraVertexTransform=this._getCameraVertexTransform())}},{key:"_getCameraUvTransform",value:function(){switch(this._computedTransformRotation){case 270:return new Float32Array([0,1,0,0,-1,0,0,0,0,0,1,0,1,0,0,1]);case 180:return new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,1,1,0,1]);case 90:return new Float32Array([0,-1,0,0,1,0,0,0,0,0,1,0,0,1,0,1])}return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"_getCameraVertexTransform",value:function(){var e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(!this._computedFrontCameraRotation)return e;switch(this._computedTransformRotation){case 0:case 90:case 180:e[0]=-1;break;case 270:e[5]=-1}return e}},{key:"_getFramebuffer",value:function(e,t,n){if(this._framebufferWidth===t&&this._framebufferHeight===n&&this._framebufferId)return this._framebufferId;if(this._framebufferId&&(e.deleteFramebuffer(this._framebufferId),this._framebufferId=null),this._renderTexture&&(e.deleteTexture(this._renderTexture),this._renderTexture=null),this._framebufferId=e.createFramebuffer(),!this._framebufferId)throw new Error("Unable to create framebuffer");if(e.bindFramebuffer(e.FRAMEBUFFER,this._framebufferId),this._renderTexture=e.createTexture(),!this._renderTexture)throw new Error("Unable to create render texture");e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._renderTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._renderTexture,0);var r=e.checkFramebufferStatus(e.FRAMEBUFFER);if(r!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer not complete: "+r.toString());return this._framebufferWidth=t,this._framebufferHeight=n,e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this._framebufferId}},{key:"_getVertexBuffer",value:function(e){if(this._vertexBuffer)return this._vertexBuffer;if(this._vertexBuffer=e.createBuffer(),!this._vertexBuffer)throw new Error("Unable to create vertex buffer");e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);var t=new Float32Array([-1,-1,0,0,-1,1,0,1,1,1,1,1,1,-1,1,0]);return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this._vertexBuffer}},{key:"_getIndexBuffer",value:function(e){if(this._indexBuffer)return this._indexBuffer;if(this._indexBuffer=e.createBuffer(),!this._indexBuffer)throw new Error("Unable to create index buffer");e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);var t=new Uint16Array([0,1,2,0,2,3]);return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this._indexBuffer}},{key:"_getGreyscaleShader",value:function(e){if(this._greyscaleShader)return this._greyscaleShader;var t=e.createProgram();if(!t)throw new Error("Unable to create program");var n=g.compileShader(e,e.VERTEX_SHADER,p),r=g.compileShader(e,e.FRAGMENT_SHADER,m);e.attachShader(t,n),e.attachShader(t,r),g.linkProgram(e,t);var a=e.getUniformLocation(t,"uTexWidth");if(!a)throw new Error("Unable to get uniform location uTexWidth");var i=e.getUniformLocation(t,"uUvTransform");if(!i)throw new Error("Unable to get uniform location uUvTransform");var o=e.getUniformLocation(t,"uSampler");if(!o)throw new Error("Unable to get uniform location uSampler");return this._greyscaleShader={program:t,aVertexPositionLoc:e.getAttribLocation(t,"aVertexPosition"),aTextureCoordLoc:e.getAttribLocation(t,"aTextureCoord"),uTexWidthLoc:a,uUvTransformLoc:i,uSamplerLoc:o},this._greyscaleShader}}],[{key:"createVideoElementSource",value:function(e,t){var r=h++;return C.set(r,new n(t,e)),I.zcout("html_element_source_t initialized"),r}},{key:"getVideoElementSource",value:function(e){return C.get(e)}}]),n}(u.Source);t.HTMLElementSource=f;var p="\n    attribute vec4 aVertexPosition;\n    attribute vec2 aTextureCoord;\n\n    varying highp vec2 vTextureCoord1;\n    varying highp vec2 vTextureCoord2;\n    varying highp vec2 vTextureCoord3;\n    varying highp vec2 vTextureCoord4;\n\n    uniform float uTexWidth;\n\tuniform mat4 uUvTransform;\n\n    void main(void) {\n      highp vec2 offset1 = vec2(1.5 / uTexWidth, 0);\n      highp vec2 offset2 = vec2(0.5 / uTexWidth, 0);\n\n      gl_Position = aVertexPosition;\n      vTextureCoord1 = (uUvTransform * vec4(aTextureCoord - offset1, 0, 1)).xy;\n      vTextureCoord2 = (uUvTransform * vec4(aTextureCoord - offset2, 0, 1)).xy;\n      vTextureCoord3 = (uUvTransform * vec4(aTextureCoord + offset2, 0, 1)).xy;\n      vTextureCoord4 = (uUvTransform * vec4(aTextureCoord + offset1, 0, 1)).xy;\n    }\n",m="\n  varying highp vec2 vTextureCoord1;\n  varying highp vec2 vTextureCoord2;\n  varying highp vec2 vTextureCoord3;\n  varying highp vec2 vTextureCoord4;\n\n  uniform sampler2D uSampler;\n\n  const lowp vec3 colorWeights = vec3(77.0 / 256.0, 150.0 / 256.0, 29.0 / 256.0);\n\n  void main(void) {\n    lowp vec4 outpx;\n\n    outpx.r = dot(colorWeights, texture2D(uSampler, vTextureCoord1).xyz);\n    outpx.g = dot(colorWeights, texture2D(uSampler, vTextureCoord2).xyz);\n    outpx.b = dot(colorWeights, texture2D(uSampler, vTextureCoord3).xyz);\n    outpx.a = dot(colorWeights, texture2D(uSampler, vTextureCoord4).xyz);\n\n    gl_FragColor = outpx;\n  }\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.profile=t.EmbeddedVideoImplementation=void 0;var r=n(81);!function(e){e[e.OBJECT_URL=0]="OBJECT_URL",e[e.SRC_OBJECT=1]="SRC_OBJECT"}(t.EmbeddedVideoImplementation||(t.EmbeddedVideoImplementation={})),t.profile={deviceMotionMutliplier:-1,blacklisted:!1,showGyroPermissionsWarningIfNecessary:!1,showSafariPermissionsResetIfNecessary:!1,requestHighFrameRate:!1,videoWidth:640,videoHeight:480,dataWidth:320,dataHeight:240,videoElementInDOM:!1},window.zeeProfile=t.profile;var a=new r.UAParser,i=(a.getOS().name||"unknown").toLowerCase(),o=(a.getEngine().name||"unknown").toLowerCase();("webkit"===o&&"ios"!==i&&(t.profile.deviceMotionMutliplier=1,void 0!==window.orientation&&s("15.0")),"webkit"===o&&"ios"===i)&&(t.profile.deviceMotionMutliplier=1,s(a.getOS().version||"15.0"));function s(e){var n=e.split(".");if(n.length>=2){var r=parseInt(n[0]),a=parseInt(n[1]);(r<11||11===r&&a<3)&&(t.profile.blacklisted=!0),(r<12||12===r&&a<2)&&(t.profile.videoElementInDOM=!0),(12===r&&a>=2||r>=13)&&(t.profile.showGyroPermissionsWarningIfNecessary=!0),r>=13&&(t.profile.showSafariPermissionsResetIfNecessary=!0),(r>=12&&a>1||r>=13)&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().frameRate&&(t.profile.requestHighFrameRate=!0,t.profile.videoHeight=360,t.profile.dataHeight=180)}}},function(e,t,n){"use strict";n.r(t),t.default=n.p+"b4f46e148a3b3b5aef90717d8d60e3fc.zbin"},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraTexture=void 0;var s=n(42),c=n(31),u=function(e){i(n,e);var t=o(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).MirrorMode=s.CameraMirrorMode.None,e.isVideoTexture=!0,e}return a(n,[{key:"update",value:function(){}},{key:"updateFromPipeline",value:function(e,t){this.encoding=e.outputEncoding,t.cameraFrameUploadGL();var n=t.cameraFrameTextureGL();if(n){var r=e.properties.get(this);r.__webglTexture=n,r.__webglInit=!0;var a=new c.THREE.Matrix4;a.fromArray(t.cameraFrameTextureMatrix(e.domElement.width,e.domElement.height,this.MirrorMode===s.CameraMirrorMode.Poses));var i=new c.THREE.Matrix3;i.setFromMatrix4(a),i.elements[6]=a.elements[12],i.elements[7]=a.elements[13],i.elements[8]=1,this.matrixAutoUpdate=!1,this.matrix=i}}}]),n}(c.THREE.Texture);t.CameraTexture=u},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceBufferGeometry=void 0;var s,c=n(31),u=n(88),l=function(e){i(n,e);var t=o(n);function n(e){var a;return r(this,n),(a=t.call(this)).hasSetIndices=!1,a.hasSetUVs=!1,a.recalculateNormals=!0,a.setIndex([]),a.setAttribute("position",new c.THREE.Float32BufferAttribute([],3)),a.setAttribute("normal",new c.THREE.Float32BufferAttribute([],3)),a.setAttribute("uv",new c.THREE.Float32BufferAttribute([],2)),e||(s||(s=(new u.FaceMeshLoader).load()),e=s),a._faceMesh=e,a}return a(n,[{key:"_updateIndices",value:function(){this.hasSetIndices||0!==this._faceMesh.indices.length&&(this.setIndex(new c.THREE.Uint16BufferAttribute(this._faceMesh.indices,1)),this.hasSetIndices=!0)}},{key:"_updateUVs",value:function(){this.hasSetUVs||0!==this._faceMesh.uvs.length&&(this.setAttribute("uv",new c.THREE.BufferAttribute(this._faceMesh.uvs,2)),this.hasSetUVs=!0)}},{key:"calculateNormals",get:function(){return this.recalculateNormals},set:function(e){this.recalculateNormals=e,this.recalculateNormals||("function"===typeof this.removeAttribute&&this.removeAttribute("normal"),delete this.normals)}},{key:"updateFromFaceAnchorGroup",value:function(e){0!==this._faceMesh.vertices.length&&e.currentAnchor&&this.updateFromFaceAnchor(e.currentAnchor)}},{key:"updateFromFaceAnchor",value:function(e){this.updateFromIdentityExpression(e.identity,e.expression)}},{key:"updateFromIdentityExpression",value:function(e,t){0!==this._faceMesh.vertices.length&&(this._updateIndices(),this._updateUVs(),this._faceMesh.updateFromIdentityExpression(e,t),this.vertices||(this.vertices=new Float32Array(this._faceMesh.vertices.length),this.verticesAttribute=new c.THREE.BufferAttribute(this.vertices,3),this.setAttribute("position",this.verticesAttribute)),this.vertices.set(this._faceMesh.vertices),this.verticesAttribute&&(this.verticesAttribute.needsUpdate=!0),this.computeBoundingSphere(),this.calculateNormals&&(this.normals||(this.normals=new Float32Array(this._faceMesh.normals.length),this.normalsAttribute=new c.THREE.BufferAttribute(this.normals,3),this.setAttribute("normal",this.normalsAttribute)),this.normals.set(this._faceMesh.normals),this.normalsAttribute&&(this.normalsAttribute.needsUpdate=!0)))}}]),n}(c.THREE.BufferGeometry);t.FaceBufferGeometry=l},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceMeshLoader=void 0;var s=n(44),c=function(e){i(n,e);var t=o(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new s.FaceMesh,o="__zappar_threejs_face_mesh_".concat(JSON.stringify(e||"default"));return this.manager.itemStart(o),(e?"string"===typeof e?i.load(e):e.customModel?i.load(e.customModel,e.fillMouth,e.fillEyeLeft,e.fillEyeRight,e.fillNeck):i.loadDefaultFace(e.fillMouth,e.fillEyeLeft,e.fillEyeRight):i.loadDefaultFace()).then((function(){null===t||void 0===t||t(i),a.manager.itemEnd(o)})).catch((function(e){null===r||void 0===r||r(e),a.manager.itemError(o),a.manager.itemEnd(o)})),i}},{key:"loadFace",value:function(e,t,n,r){var a=this,i=new s.FaceMesh,o="__zappar_threejs_face_mesh_face_".concat(JSON.stringify(e||"default"));return(e?e.customModel?i.load(e.customModel,e.fillMouth,e.fillEyeLeft,e.fillEyeRight,e.fillNeck):i.loadDefaultFace(e.fillMouth,e.fillEyeLeft,e.fillEyeRight):i.loadDefaultFace()).then((function(){null===t||void 0===t||t(i),a.manager.itemEnd(o)})).catch((function(e){null===r||void 0===r||r(e),a.manager.itemError(o),a.manager.itemEnd(o)})),i}},{key:"loadFullHeadSimplified",value:function(e,t,n,r){var a=this,i=new s.FaceMesh,o="__zappar_threejs_face_mesh_full_head_".concat(JSON.stringify(e||"default"));return(e?e.customModel?i.load(e.customModel,e.fillMouth,e.fillEyeLeft,e.fillEyeRight,e.fillNeck):i.loadDefaultFullHeadSimplified(e.fillMouth,e.fillEyeLeft,e.fillEyeRight,e.fillNeck):i.loadDefaultFullHeadSimplified()).then((function(){null===t||void 0===t||t(i),a.manager.itemEnd(o)})).catch((function(e){null===r||void 0===r||r(e),a.manager.itemError(o),a.manager.itemEnd(o)})),i}},{key:"parse",value:function(){}}]),n}(n(31).THREE.Loader);t.FaceMeshLoader=c},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(59).default,o=n(29).default,s=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HeadMaskMesh=void 0;var c=n(44),u=n(31),l=n(87),g=function(e){o(n,e);var t=s(n);function n(e,a){var o;return r(this,n),(o=t.call(this)).onLoad=e,o.onError=a,o.faceMesh=new c.FaceMesh,o.faceBufferGeometry=new l.FaceBufferGeometry(o.faceMesh),o.geometry=o.faceBufferGeometry,o.material=new u.THREE.MeshBasicMaterial({colorWrite:!1}),o.faceMesh.loadDefaultFullHeadSimplified(!0,!0,!0,!0).then((function(){var e;return null===(e=o.onLoad)||void 0===e?void 0:e.call(i(o))})).catch((function(){var e;return null===(e=o.onError)||void 0===e?void 0:e.call(i(o))})),o.renderOrder=Number.MIN_SAFE_INTEGER,o}return a(n,[{key:"updateFromFaceAnchorGroup",value:function(e){this.faceBufferGeometry.updateFromFaceAnchorGroup(e)}},{key:"updateFromFaceAnchor",value:function(e){this.faceBufferGeometry.updateFromFaceAnchor(e)}},{key:"updateFromIdentityExpression",value:function(e,t){this.faceBufferGeometry.updateFromIdentityExpression(e,t)}},{key:"dispose",value:function(){this.faceMesh.destroy(),this.faceBufferGeometry.dispose()}}]),n}(u.THREE.Mesh);t.HeadMaskMesh=g},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryLoader=void 0;var s=n(34),c=n(31),u="__zappar_threejs_library",l=function(e){i(n,e);var t=o(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"load",value:function(e,t,n){var r=this;this.manager.itemStart(u),(0,s.loadedPromise)().then((function(){null===e||void 0===e||e(),r.manager.itemEnd(u)})).catch((function(e){null===n||void 0===n||n(),r.manager.itemError(u),r.manager.itemEnd(u)}))}},{key:"parse",value:function(){}}]),n}(c.THREE.Loader);t.LibraryLoader=l},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(13),a=n(10),i=n(14),o=n(15),s=n(1),c=n(41),u=n(0),l=n(9),g=["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents"],d=new u.Vector3,I=new u.Vector3,A=new u.Vector3;function h(e,t,n){var r=d.setFromMatrixPosition(e.matrixWorld);r.project(t);var a=n.width/2,i=n.height/2;return[r.x*a+a,-r.y*i+i]}var C=function(e){return Math.abs(e)<1e-10?0:e};function f(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r="matrix3d(",a=0;16!==a;a++)r+=C(t[a]*e.elements[a])+(15!==a?",":")");return n+r}var p,m=(p=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return f(e,p)}),v=function(e,t){return f(e,[1/(n=t),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n},b=s.forwardRef((function(e,t){var n,f=e.children,p=e.eps,b=void 0===p?.001:p,y=e.style,B=e.className,G=e.prepend,w=e.center,_=e.fullscreen,Z=e.portal,S=e.distanceFactor,x=e.sprite,R=void 0!==x&&x,M=e.transform,k=void 0!==M&&M,E=e.occlude,W=e.onOcclude,V=e.zIndexRange,F=void 0===V?[16777271,0]:V,X=e.calculatePosition,H=void 0===X?h:X,O=e.as,L=void 0===O?"div":O,N=e.wrapperClass,Y=e.pointerEvents,T=void 0===Y?"auto":Y,z=Object(i.a)(e,g),K=Object(l.useThree)((function(e){return e.gl})),j=Object(l.useThree)((function(e){return e.camera})),D=Object(l.useThree)((function(e){return e.scene})),U=Object(l.useThree)((function(e){return e.size})),Q=Object(l.useThree)((function(e){return e.raycaster})),P=s.useState((function(){return document.createElement(L)})),J=Object(a.a)(P,1)[0],q=s.useRef(null),$=s.useRef(0),ee=s.useRef([0,0]),te=s.useRef(null),ne=s.useRef(null),re=null!==(n=null==Z?void 0:Z.current)&&void 0!==n?n:K.domElement.parentNode;s.useEffect((function(){if(q.current){if(D.updateMatrixWorld(),k)J.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=H(q.current,j,U);J.style.cssText="position:absolute;top:0;left:0;transform:translate3d(".concat(e[0],"px,").concat(e[1],"px,0);transform-origin:0 0;")}return re&&(G?re.prepend(J):re.appendChild(J)),function(){re&&re.removeChild(J),c.unmountComponentAtNode(J)}}}),[re,k]),s.useLayoutEffect((function(){N&&(J.className=N)}),[N]);var ae=s.useMemo((function(){return k?{position:"absolute",top:0,left:0,width:U.width,height:U.height,transformStyle:"preserve-3d",pointerEvents:"none"}:Object(r.a)(Object(r.a)({position:"absolute",transform:w?"translate3d(-50%,-50%,0)":"none"},_&&{top:-U.height/2,left:-U.width/2,width:U.width,height:U.height}),y)}),[y,w,_,U,k]),ie=s.useMemo((function(){return{position:"absolute",pointerEvents:T}}),[T]);s.useLayoutEffect((function(){k?c.render(s.createElement("div",{ref:te,style:ae},s.createElement("div",{ref:ne,style:ie},s.createElement("div",{ref:t,className:B,style:y,children:f}))),J):c.render(s.createElement("div",{ref:t,style:ae,className:B,children:f}),J)}));var oe=s.useRef(!0);return Object(l.useFrame)((function(){if(q.current){j.updateMatrixWorld(),q.current.updateWorldMatrix(!0,!1);var e=k?ee.current:H(q.current,j,U);if(k||Math.abs($.current-j.zoom)>b||Math.abs(ee.current[0]-e[0])>b||Math.abs(ee.current[1]-e[1])>b){var t=function(e,t){var n=d.setFromMatrixPosition(e.matrixWorld),r=I.setFromMatrixPosition(t.matrixWorld),a=n.sub(r),i=t.getWorldDirection(A);return a.angleTo(i)>Math.PI/2}(q.current,j),n=!1;"boolean"===typeof E?!0===E&&(n=[D]):Array.isArray(E)&&(n=E.map((function(e){return e.current})));var r=oe.current;if(n){var a=function(e,t,n,r){var a=d.setFromMatrixPosition(e.matrixWorld),i=a.clone();i.project(t),n.setFromCamera(i,t);var o=n.intersectObjects(r,!0);if(o.length){var s=o[0].distance;return a.distanceTo(n.ray.origin)<s}return!0}(q.current,j,Q,n);oe.current=a&&!t}else oe.current=!t;if(r!==oe.current&&(W?W(!oe.current):J.style.display=oe.current?"block":"none"),J.style.zIndex="".concat(function(e,t,n){if(t instanceof u.PerspectiveCamera||t instanceof u.OrthographicCamera){var r=d.setFromMatrixPosition(e.matrixWorld),a=I.setFromMatrixPosition(t.matrixWorld),i=r.distanceTo(a),o=(n[1]-n[0])/(t.far-t.near),s=n[1]-o*t.far;return Math.round(o*i+s)}}(q.current,j,F)),k){var i=U.width/2,o=U.height/2,s=j.projectionMatrix.elements[5]*o,c=j.isOrthographicCamera,l=j.top,g=j.left,h=j.bottom,f=j.right,p=m(j.matrixWorldInverse),y=c?"scale(".concat(s,")translate(").concat(C(-(f+g)/2),"px,").concat(C((l+h)/2),"px)"):"translateZ(".concat(s,"px)"),B=q.current.matrixWorld;R&&((B=j.matrixWorldInverse.clone().transpose().copyPosition(B).scale(q.current.scale)).elements[3]=B.elements[7]=B.elements[11]=0,B.elements[15]=1),J.style.width=U.width+"px",J.style.height=U.height+"px",J.style.perspective=c?"":"".concat(s,"px"),te.current&&ne.current&&(te.current.style.transform="".concat(y).concat(p,"translate(").concat(i,"px,").concat(o,"px)"),ne.current.style.transform=v(B,1/((S||10)/400)))}else{var G=void 0===S?1:function(e,t){if(t instanceof u.OrthographicCamera)return t.zoom;if(t instanceof u.PerspectiveCamera){var n=d.setFromMatrixPosition(e.matrixWorld),r=I.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,i=n.distanceTo(r);return 1/(2*Math.tan(a/2)*i)}return 1}(q.current,j)*S;J.style.transform="translate3d(".concat(e[0],"px,").concat(e[1],"px,0) scale(").concat(G,")")}ee.current=e,$.current=j.zoom}}})),s.createElement("group",Object(o.a)({},z,{ref:q}))}))},function(e,t){},function(e,t){},function(e,t,n){},function(e,t){},function(e,t,n){"use strict";(function(e){var r=n(183),a=n(184),i=n(185);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return g(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|A(t,n),a=(e=s(e,r)).write(t,n);a!==r&&(e=e.slice(0,a));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|I(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):d(e,t);if("Buffer"===t.type&&i(t.data))return d(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function g(e,t){if(l(t),e=s(e,t<0?0:0|I(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|I(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function I(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function A(e,t){if(c.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(e).length;default:if(r)return N(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function C(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function f(e,t,n,r,a){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"===typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:p(e,t,n,r,a);if("number"===typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):p(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function p(e,t,n,r,a){var i,o=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var l=-1;for(i=n;i<s;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var g=!0,d=0;d<c;d++)if(u(e,i+d)!==u(t,d)){g=!1;break}if(g)return i}return-1}function m(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;if(i%2!==0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function v(e,t,n,r){return T(N(t,e.length-n),e,n,r)}function b(e,t,n,r){return T(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function y(e,t,n,r){return b(e,t,n,r)}function B(e,t,n,r){return T(Y(t),e,n,r)}function G(e,t,n,r){return T(function(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function w(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function _(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,c,u=e[a],l=null,g=u>239?4:u>223?3:u>191?2:1;if(a+g<=n)switch(g){case 1:u<128&&(l=u);break;case 2:128===(192&(i=e[a+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[a+1],o=e[a+2],128===(192&i)&&128===(192&o)&&(c=(15&u)<<12|(63&i)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128===(192&i)&&128===(192&o)&&128===(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,g=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=g}return function(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return g(null,e)},c.allocUnsafeSlow=function(e){return g(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},c.byteLength=A,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)C(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)C(this,t,t+3),C(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)C(this,t,t+7),C(this,t+1,t+6),C(this,t+2,t+5),C(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?_(this,0,e):h.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,a){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),u=this.slice(r,a),l=e.slice(t,n),g=0;g<s;++g)if(u[g]!==l[g]){i=u[g],o=l[g];break}return i<o?-1:o<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return f(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return f(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return y(this,e,t,n);case"base64":return B(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;function S(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function R(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=L(e[i]);return a}function M(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function k(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function E(e,t,n,r,a,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function W(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function V(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function F(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function X(e,t,n,r,i){return i||F(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function H(e,t,n,r,i){return i||F(e,0,n,8),a.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var a=t-e;n=new c(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},c.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),a.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),a.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),a.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),a.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||E(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||E(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):W(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):W(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):V(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):V(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);E(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);E(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):W(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):W(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):V(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||E(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):V(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return X(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return X(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return H(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return H(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=c.isBuffer(e)?e:N(new c(e,r).toString()),s=o.length;for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function Y(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(O,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function T(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}}).call(this,n(74))},function(e,t,n){"use strict";n.r(t),n.d(t,"Html",(function(){return r.a})),n.d(t,"CycleRaycast",(function(){return s})),n.d(t,"useCursor",(function(){return c})),n.d(t,"Loader",(function(){return C})),n.d(t,"Scroll",(function(){return x})),n.d(t,"ScrollControls",(function(){return _})),n.d(t,"useScroll",(function(){return w})),n.d(t,"PresentationControls",(function(){return k})),n.d(t,"Select",(function(){return L})),n.d(t,"useSelect",(function(){return N})),n.d(t,"Billboard",(function(){return T})),n.d(t,"QuadraticBezierLine",(function(){return oe})),n.d(t,"CubicBezierLine",(function(){return ue})),n.d(t,"Line",(function(){return re})),n.d(t,"PositionalAudio",(function(){return ge})),n.d(t,"Text",(function(){return at})),n.d(t,"Effects",(function(){return Ct})),n.d(t,"isWebGL2Available",(function(){return ht})),n.d(t,"GradientTexture",(function(){return pt})),n.d(t,"Image",(function(){return Gt})),n.d(t,"Edges",(function(){return _t})),n.d(t,"Trail",(function(){return Wt})),n.d(t,"useTrail",(function(){return Et})),n.d(t,"Sampler",(function(){return Xt})),n.d(t,"ComputedAttribute",(function(){return Ot})),n.d(t,"Clone",(function(){return Kt})),n.d(t,"OrthographicCamera",(function(){return Dt})),n.d(t,"PerspectiveCamera",(function(){return Qt})),n.d(t,"CubeCamera",(function(){return Jt})),n.d(t,"DeviceOrientationControls",(function(){return en})),n.d(t,"FlyControls",(function(){return an})),n.d(t,"MapControls",(function(){return ln})),n.d(t,"OrbitControls",(function(){return dn})),n.d(t,"TrackballControls",(function(){return hn})),n.d(t,"ArcballControls",(function(){return wn})),n.d(t,"TransformControls",(function(){return En})),n.d(t,"PointerLockControls",(function(){return Xn})),n.d(t,"FirstPersonControls",(function(){return Ln})),n.d(t,"GizmoHelper",(function(){return Jn})),n.d(t,"useGizmoContext",(function(){return Tn})),n.d(t,"GizmoViewcube",(function(){return gr})),n.d(t,"GizmoViewport",(function(){return Cr})),n.d(t,"useCubeTexture",(function(){return fr})),n.d(t,"useFBX",(function(){return fa})),n.d(t,"useGLTF",(function(){return Gi})),n.d(t,"useProgress",(function(){return A})),n.d(t,"IsObject",(function(){return vt})),n.d(t,"useTexture",(function(){return bt})),n.d(t,"useKTX2",(function(){return Vi})),n.d(t,"Stats",(function(){return Oi})),n.d(t,"useDepthBuffer",(function(){return Yi})),n.d(t,"useAspect",(function(){return Ti})),n.d(t,"useCamera",(function(){return Nn})),n.d(t,"useDetectGPU",(function(){return no})),n.d(t,"useHelper",(function(){return ro})),n.d(t,"useBVH",(function(){return Vs})),n.d(t,"useContextBridge",(function(){return Fs})),n.d(t,"useAnimations",(function(){return Xs})),n.d(t,"useFBO",(function(){return Ni})),n.d(t,"useIntersect",(function(){return Hs})),n.d(t,"useBoxProjectedEnv",(function(){return Ls})),n.d(t,"CurveModifier",(function(){return Ds})),n.d(t,"MeshDistortMaterial",(function(){return Ps})),n.d(t,"MeshWobbleMaterial",(function(){return $s})),n.d(t,"MeshReflectorMaterial",(function(){return ac})),n.d(t,"PointMaterial",(function(){return oc})),n.d(t,"PointMaterialImpl",(function(){return ic})),n.d(t,"shaderMaterial",(function(){return mt})),n.d(t,"softShadows",(function(){return cc})),n.d(t,"Box",(function(){return gc})),n.d(t,"Circle",(function(){return dc})),n.d(t,"Cone",(function(){return Ic})),n.d(t,"Cylinder",(function(){return Ac})),n.d(t,"Dodecahedron",(function(){return wc})),n.d(t,"Extrude",(function(){return _c})),n.d(t,"Icosahedron",(function(){return Bc})),n.d(t,"Lathe",(function(){return Zc})),n.d(t,"Octahedron",(function(){return Gc})),n.d(t,"Plane",(function(){return Cc})),n.d(t,"Polyhedron",(function(){return yc})),n.d(t,"Ring",(function(){return bc})),n.d(t,"Sphere",(function(){return hc})),n.d(t,"Tetrahedron",(function(){return vc})),n.d(t,"Torus",(function(){return pc})),n.d(t,"TorusKnot",(function(){return mc})),n.d(t,"Tube",(function(){return fc})),n.d(t,"RoundedBox",(function(){return Rc})),n.d(t,"ScreenQuad",(function(){return Ec})),n.d(t,"Center",(function(){return Vc})),n.d(t,"Bounds",(function(){return Hc})),n.d(t,"useBounds",(function(){return Oc})),n.d(t,"CameraShake",(function(){return Nc})),n.d(t,"Float",(function(){return Tc})),n.d(t,"Stage",(function(){return ru})),n.d(t,"Backdrop",(function(){return ou})),n.d(t,"Shadow",(function(){return cu})),n.d(t,"ContactShadows",(function(){return eu})),n.d(t,"Reflector",(function(){return lu})),n.d(t,"SpotLight",(function(){return Au})),n.d(t,"Environment",(function(){return Dc})),n.d(t,"EnvironmentCube",(function(){return Pc})),n.d(t,"EnvironmentMap",(function(){return Uc})),n.d(t,"EnvironmentPortal",(function(){return Qc})),n.d(t,"Lightformer",(function(){return Cu})),n.d(t,"Sky",(function(){return vu})),n.d(t,"calcPosFromAngles",(function(){return mu})),n.d(t,"Stars",(function(){return Bu})),n.d(t,"Cloud",(function(){return wu})),n.d(t,"useMatcapTexture",(function(){return xu})),n.d(t,"useNormalTexture",(function(){return ku})),n.d(t,"Point",(function(){return Du})),n.d(t,"Points",(function(){return Qu})),n.d(t,"PointsBuffer",(function(){return Uu})),n.d(t,"Instance",(function(){return dl})),n.d(t,"Instances",(function(){return Il})),n.d(t,"Merged",(function(){return Al})),n.d(t,"Segment",(function(){return vl})),n.d(t,"Segments",(function(){return pl})),n.d(t,"Detailed",(function(){return yl})),n.d(t,"Preload",(function(){return Bl})),n.d(t,"BakeShadows",(function(){return Gl})),n.d(t,"meshBounds",(function(){return xl})),n.d(t,"AdaptiveDpr",(function(){return Rl})),n.d(t,"AdaptiveEvents",(function(){return Ml}));var r=n(91),a=n(16),i=n(1),o=n(9);function s(e){var t=e.onChanged,n=e.portal,r=e.preventDefault,s=void 0===r||r,c=e.scroll,u=void 0===c||c,l=e.keyCode,g=void 0===l?9:l,d=i.useRef(0),I=Object(o.useThree)((function(e){return e.raycaster})),A=Object(o.useThree)((function(e){return e.get})),h=Object(o.useThree)((function(e){return e.gl}));return i.useEffect((function(){var e,r=[],i=void 0,o=I.filter,c=null!==(e=null==n?void 0:n.current)&&void 0!==e?e:h.domElement.parentNode,l=function(){return c&&t&&t(r,Math.round(d.current)%r.length)};I.filter=function(e,t){var n=Object(a.a)(e);n.length===r.length&&r.every((function(e){return n.map((function(e){return e.object.uuid})).includes(e.object.uuid)}))||(d.current=0,r=n,l()),o&&(n=o(n,t));for(var i=0;i<Math.round(d.current)%n.length;i++){var s=n.shift();n=[].concat(Object(a.a)(n),[s])}return n};var C=function(e){var t,n;d.current=e(d.current),null==(t=A().events.handlers)||t.onPointerCancel(void 0),null==(n=A().events.handlers)||n.onPointerMove(i),l()},f=function(e){(e.keyCode||e.which===g)&&(s&&e.preventDefault(),r.length>1&&C((function(e){return e+1})))},p=function(e){s&&e.preventDefault();var t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),r.length>1&&C((function(e){return Math.abs(e-t)}))},m=function(e){return i=e};return document.addEventListener("pointermove",m,{passive:!0}),u&&document.addEventListener("wheel",p),void 0!==g&&document.addEventListener("keydown",f),function(){I.filter=o,void 0!==g&&document.removeEventListener("keydown",f),u&&document.removeEventListener("wheel",p),document.removeEventListener("pointermove",m)}}),[h,A,I,s,u,g]),null}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pointer",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";i.useEffect((function(){if(e)return document.body.style.cursor=t,function(){document.body.style.cursor=n}}),[e])}var u=n(13),l=n(10),g=n(0),d=n(101),I=0,A=n.n(d)()((function(e){return g.DefaultLoadingManager.onStart=function(t,n,r){e({active:!0,item:t,loaded:n,total:r,progress:(n-I)/(r-I)*100})},g.DefaultLoadingManager.onLoad=function(){e({active:!1})},g.DefaultLoadingManager.onError=function(t){return e((function(e){return{errors:[].concat(Object(a.a)(e.errors),[t])}}))},g.DefaultLoadingManager.onProgress=function(t,n,r){n===r&&(I=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-I)/(r-I)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}})),h=function(e){return"Loading ".concat(e.toFixed(2),"%")};function C(e){var t=e.containerStyles,n=e.innerStyles,r=e.barStyles,a=e.dataStyles,o=e.dataInterpolation,s=void 0===o?h:o,c=e.initialState,g=void 0===c?function(e){return e}:c,d=A(),I=d.active,C=d.progress,p=i.useRef(0),m=i.useRef(0),v=i.useRef(null),b=i.useState(g(I)),y=Object(l.a)(b,2),B=y[0],G=y[1];i.useEffect((function(){var e;return I!==B&&(e=setTimeout((function(){return G(I)}),300)),function(){return clearTimeout(e)}}),[B,I]);var w=i.useCallback((function(){v.current&&(p.current+=(C-p.current)/2,(p.current>.95*C||100===C)&&(p.current=C),v.current.innerText=s(p.current),p.current<C&&(m.current=requestAnimationFrame(w)))}),[s,C]);return i.useEffect((function(){return w(),function(){return cancelAnimationFrame(m.current)}}),[w]),B?i.createElement("div",{style:Object(u.a)(Object(u.a)({},f.container),{},{opacity:I?1:0},t)},i.createElement("div",null,i.createElement("div",{style:Object(u.a)(Object(u.a)({},f.inner),n)},i.createElement("div",{style:Object(u.a)(Object(u.a)({},f.bar),{},{transform:"scaleX(".concat(C/100,")")},r)}),i.createElement("span",{ref:v,style:Object(u.a)(Object(u.a)({},f.data),a)})))):null}var f={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},p=n(14),m=n(15),v=n(41),b=n(18),y=["children","style"],B=["html"],G=i.createContext(null);function w(){return i.useContext(G)}function _(e){var t=e.eps,n=void 0===t?1e-5:t,r=e.enabled,a=void 0===r||r,s=e.infinite,c=e.horizontal,u=e.pages,d=void 0===u?1:u,I=e.distance,A=void 0===I?1:I,h=e.damping,C=void 0===h?4:h,f=e.style,p=void 0===f?{}:f,m=e.children,v=Object(o.useThree)(),b=v.gl,y=v.size,B=v.invalidate,w=v.events,_=v.raycaster,Z=i.useState((function(){return document.createElement("div")})),S=Object(l.a)(Z,1)[0],x=i.useState((function(){return document.createElement("div")})),R=Object(l.a)(x,1)[0],M=i.useState((function(){return document.createElement("div")})),k=Object(l.a)(M,1)[0],E=b.domElement.parentNode,W=i.useRef(0),V=i.useMemo((function(){var e={el:S,eps:n,fill:R,fixed:k,horizontal:c,damping:C,offset:0,delta:0,scroll:W,pages:d,range:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e-n,a=r+t+2*n;return this.offset<r?0:this.offset>a?1:(this.offset-r)/(a-r)},curve:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.sin(this.range(e,t,n)*Math.PI)},visible:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e-n,a=r+t+2*n;return this.offset>=r&&this.offset<=a}};return e}),[n,C,c,d]);i.useEffect((function(){for(var e in S.style.position="absolute",S.style.width="100%",S.style.height="100%",S.style[c?"overflowX":"overflowY"]="auto",S.style[c?"overflowY":"overflowX"]="hidden",S.style.top="0px",S.style.left="0px",p)S.style[e]=p[e];k.style.position="sticky",k.style.top="0px",k.style.left="0px",k.style.width="100%",k.style.height="100%",k.style.overflow="hidden",S.appendChild(k),R.style.height=c?"100%":"".concat(d*A*100,"%"),R.style.width=c?"".concat(d*A*100,"%"):"100%",R.style.pointerEvents="none",S.appendChild(R),E.appendChild(S),S[c?"scrollLeft":"scrollTop"]=1;var t=w.connected||b.domElement;requestAnimationFrame((function(){return null==w.connect?void 0:w.connect(S)}));var n=_.computeOffsets;return _.computeOffsets=function(e){var t=e.clientX,n=e.clientY;return{offsetX:t-E.offsetLeft,offsetY:n-E.offsetTop}},function(){E.removeChild(S),_.computeOffsets=n,null==w.connect||w.connect(t)}}),[d,A,c,S,R,k,E]),i.useEffect((function(){var e=y[c?"width":"height"],t=S[c?"scrollWidth":"scrollHeight"],n=t-e,r=0,i=!0,o=!0,u=function(){if(a&&!o&&(B(),r=S[c?"scrollLeft":"scrollTop"],W.current=r/n,s)){if(!i)if(r>=n){var e=1-V.offset;S[c?"scrollLeft":"scrollTop"]=1,W.current=V.offset=-e,i=!0}else if(r<=0){var u=1+V.offset;S[c?"scrollLeft":"scrollTop"]=t,W.current=V.offset=u,i=!0}i&&setTimeout((function(){return i=!1}),40)}};S.addEventListener("scroll",u,{passive:!0}),requestAnimationFrame((function(){return o=!1}));var l=function(e){return S.scrollLeft+=e.deltaY/2};return c&&S.addEventListener("wheel",l,{passive:!0}),function(){S.removeEventListener("scroll",u),c&&S.removeEventListener("wheel",l)}}),[S,y,s,V,B,c,a]);var F=0;return Object(o.useFrame)((function(e,t){V.offset=g.MathUtils.damp(F=V.offset,W.current,C,t),V.delta=g.MathUtils.damp(V.delta,Math.abs(F-V.offset),C,t),V.delta>n&&B()})),i.createElement(G.Provider,{value:V},m)}var Z=i.forwardRef((function(e,t){var n=e.children,r=i.useRef(null),a=w(),s=Object(o.useThree)((function(e){return e.viewport})),c=s.width,u=s.height;return Object(o.useFrame)((function(){r.current.position.x=a.horizontal?-c*(a.pages-1)*a.offset:0,r.current.position.y=a.horizontal?0:u*(a.pages-1)*a.offset})),i.createElement("group",{ref:Object(b.default)([t,r])},n)})),S=i.forwardRef((function(e,t){var n=e.children,r=e.style,a=Object(p.a)(e,y),s=w(),c=i.useRef(null),l=Object(o.useThree)((function(e){return e.size})),g=l.width,d=l.height,I=i.useContext(o.context);return Object(o.useFrame)((function(){s.delta>s.eps&&(c.current.style.transform="translate3d(".concat(s.horizontal?-g*(s.pages-1)*s.offset:0,"px,").concat(s.horizontal?0:d*(s.pages-1)*-s.offset,"px,0)"))})),v.render(i.createElement("div",Object(m.a)({ref:Object(b.default)([t,c]),style:Object(u.a)(Object(u.a)({},r),{},{position:"absolute",top:0,left:0,willChange:"transform"})},a),i.createElement(G.Provider,{value:s},i.createElement(o.context.Provider,{value:I},n))),s.fixed),null})),x=i.forwardRef((function(e,t){var n=e.html,r=Object(p.a)(e,B),a=n?S:Z;return i.createElement(a,Object(m.a)({ref:t},r))})),R=n(76),M=n(102);function k(e){var t=e.snap,n=e.global,r=e.cursor,s=void 0===r||r,c=e.children,d=e.speed,I=void 0===d?1:d,A=e.rotation,h=void 0===A?[0,0,0]:A,C=e.zoom,f=void 0===C?1:C,p=e.polar,v=void 0===p?[0,Math.PI/2]:p,b=e.azimuth,y=void 0===b?[-1/0,1/0]:b,B=e.config,G=void 0===B?{mass:1,tension:170,friction:26}:B,w=Object(o.useThree)(),_=w.size,Z=w.gl,S=i.useMemo((function(){return[h[0]+v[0],h[0]+v[1]]}),[h[0],v[0],v[1]]),x=i.useMemo((function(){return[h[1]+y[0],h[1]+y[1]]}),[h[1],y[0],y[1]]),k=i.useMemo((function(){return[g.MathUtils.clamp.apply(g.MathUtils,[h[0]].concat(Object(a.a)(S))),g.MathUtils.clamp.apply(g.MathUtils,[h[1]].concat(Object(a.a)(x))),h[2]]}),[h[0],h[1],h[2],S,x]),E=Object(R.useSpring)((function(){return{scale:1,rotation:k,config:G}})),W=Object(l.a)(E,2),V=W[0],F=W[1];i.useEffect((function(){F.start({scale:1,rotation:k,config:G})}),[k]),i.useEffect((function(){n&&s&&(Z.domElement.style.cursor="grab")}),[n,s,Z.domElement]);var X=Object(M.useGesture)({onHover:function(e){var t=e.last;s&&!n&&(Z.domElement.style.cursor=t?"auto":"grab")},onDrag:function(e){var n=e.down,r=Object(l.a)(e.delta,2),i=r[0],o=r[1],c=e.memo;c=void 0===c?V.rotation.animation.to||k:c;var d=Object(l.a)(c,2),A=d[0],h=d[1];s&&(Z.domElement.style.cursor=n?"grabbing":"grab"),i=g.MathUtils.clamp.apply(g.MathUtils,[h+i/_.width*Math.PI*I].concat(Object(a.a)(x))),o=g.MathUtils.clamp.apply(g.MathUtils,[A+o/_.height*Math.PI*I].concat(Object(a.a)(S)));var C=t&&!n&&"boolean"!==typeof t?t:G;return F.start({scale:n&&o>S[1]/2?f:1,rotation:t&&!n?k:[o,i,0],config:function(e){return"scale"===e?Object(u.a)(Object(u.a)({},C),{},{friction:3*C.friction}):C}}),[o,i]}},{target:n?Z.domElement:void 0});return i.createElement(R.a.group,Object(m.a)({},null==X?void 0:X(),V),c)}var E=n(4),W=n(5),V=function(){var e=new g.Frustum,t=new g.Vector3,n=new g.Vector3,r=new g.Vector3,a=new g.Vector3,i=new g.Vector3,o=new g.Vector3,s=new g.Vector3,c=new g.Vector3,u=new g.Vector3,l=new g.Vector3,d=new g.Vector3,I=new g.Vector3,A=new g.Vector3,h=new g.Vector3,C=function(){function C(e,t,n){Object(E.a)(this,C),this.camera=e,this.scene=t,this.startPoint=new g.Vector3,this.endPoint=new g.Vector3,this.collection=[],this.deep=n||Number.MAX_VALUE}return Object(W.a)(C,[{key:"select",value:function(t,n){return this.startPoint=t||this.startPoint,this.endPoint=n||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection}},{key:"updateFrustum",value:function(t,g){if(t=t||this.startPoint,g=g||this.endPoint,t.x===g.x&&(g.x+=Number.EPSILON),t.y===g.y&&(g.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)n.copy(t),n.x=Math.min(t.x,g.x),n.y=Math.max(t.y,g.y),g.x=Math.max(t.x,g.x),g.y=Math.min(t.y,g.y),r.setFromMatrixPosition(this.camera.matrixWorld),a.copy(n),i.set(g.x,n.y,0),o.copy(g),s.set(n.x,g.y,0),a.unproject(this.camera),i.unproject(this.camera),o.unproject(this.camera),s.unproject(this.camera),I.copy(a).sub(r),A.copy(i).sub(r),h.copy(o).sub(r),I.normalize(),A.normalize(),h.normalize(),I.multiplyScalar(this.deep),A.multiplyScalar(this.deep),h.multiplyScalar(this.deep),I.add(r),A.add(r),h.add(r),(C=e.planes)[0].setFromCoplanarPoints(r,a,i),C[1].setFromCoplanarPoints(r,i,o),C[2].setFromCoplanarPoints(o,s,r),C[3].setFromCoplanarPoints(s,a,r),C[4].setFromCoplanarPoints(i,o,s),C[5].setFromCoplanarPoints(h,A,I),C[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){var C,f=Math.min(t.x,g.x),p=Math.max(t.y,g.y),m=Math.max(t.x,g.x),v=Math.min(t.y,g.y);a.set(f,p,-1),i.set(m,p,-1),o.set(m,v,-1),s.set(f,v,-1),c.set(f,p,1),u.set(m,p,1),l.set(m,v,1),d.set(f,v,1),a.unproject(this.camera),i.unproject(this.camera),o.unproject(this.camera),s.unproject(this.camera),c.unproject(this.camera),u.unproject(this.camera),l.unproject(this.camera),d.unproject(this.camera),(C=e.planes)[0].setFromCoplanarPoints(a,c,u),C[1].setFromCoplanarPoints(i,u,l),C[2].setFromCoplanarPoints(l,d,s),C[3].setFromCoplanarPoints(d,c,a),C[4].setFromCoplanarPoints(i,o,s),C[5].setFromCoplanarPoints(l,u,c),C[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}},{key:"searchChildInFrustum",value:function(e,n){if((n.isMesh||n.isLine||n.isPoints)&&void 0!==n.material&&(null===n.geometry.boundingSphere&&n.geometry.computeBoundingSphere(),t.copy(n.geometry.boundingSphere.center),t.applyMatrix4(n.matrixWorld),e.containsPoint(t)&&this.collection.push(n)),n.children.length>0)for(var r=0;r<n.children.length;r++)this.searchChildInFrustum(e,n.children[r])}}]),C}();return C}(),F=n(103),X=n.n(F),H=["box","multiple","children","onChange","border","backgroundColor","filter"],O=i.createContext([]);function L(e){var t=e.box,n=e.multiple,r=e.children,s=e.onChange,c=e.border,u=void 0===c?"1px solid #55aaff":c,d=e.backgroundColor,I=void 0===d?"rgba(75, 160, 255, 0.1)":d,A=e.filter,h=void 0===A?function(e){return e}:A,C=Object(p.a)(e,H),f=Object(o.useThree)(),v=f.camera,b=f.raycaster,y=f.gl,B=f.controls,G=f.size,w=f.get,_=i.useState(!1),Z=Object(l.a)(_,2),S=Z[0],x=Z[1],R=i.useReducer((function(e,t){var n=t.object,r=t.shift;return void 0===n?[]:Array.isArray(n)?n:r?e.includes(n)?e.filter((function(e){return e!==n})):[n].concat(Object(a.a)(e)):e[0]===n?[]:[n]}),[]),M=Object(l.a)(R,2),k=M[0],E=M[1];i.useEffect((function(){null==s||s(k)}),[k]);var W=i.useCallback((function(e){e.stopPropagation(),E({object:h([e.object])[0],shift:n&&e.shiftKey})}),[]),F=i.useCallback((function(e){return!S&&E({})}),[S]),L=i.useRef(null);return i.useEffect((function(){if(t&&n){var e=new V(v,L.current),r=document.createElement("div");r.style.pointerEvents="none",r.style.border=u,r.style.backgroundColor=I,r.style.position="fixed";var a=new g.Vector2,i=new g.Vector2,o=new g.Vector2,s=b.enabled,c=null==B?void 0:B.enabled,l=!1,d=[];return document.addEventListener("pointerdown",C,{passive:!0}),document.addEventListener("pointermove",f,{passive:!0,capture:!0}),document.addEventListener("pointerup",p,{passive:!0}),function(){document.removeEventListener("pointerdown",C),document.removeEventListener("pointermove",f),document.removeEventListener("pointerup",p)}}function A(e,t){var n,r=null!==(n=null==b.computeOffsets?void 0:b.computeOffsets(e,w()))&&void 0!==n?n:e,a=r.offsetX,i=r.offsetY,o=G.width,s=G.height;t.set(a/o*2-1,-i/s*2+1)}function C(t){t.shiftKey&&(!function(e){var t;B&&(B.enabled=!1),b.enabled=!1,l=!0,null==(t=y.domElement.parentElement)||t.appendChild(r),r.style.left="".concat(e.clientX,"px"),r.style.top="".concat(e.clientY,"px"),r.style.width="0px",r.style.height="0px",a.x=e.clientX,a.y=e.clientY}(t),A(t,e.startPoint))}function f(t){if(l){!function(e){o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),i.x=Math.min(a.x,e.clientX),i.y=Math.min(a.y,e.clientY),r.style.left="".concat(i.x,"px"),r.style.top="".concat(i.y,"px"),r.style.width="".concat(o.x-i.x,"px"),r.style.height="".concat(o.y-i.y,"px")}(t),A(t,e.endPoint);var n=e.select().sort((function(e){return e.uuid})).filter((function(e){return e.isMesh}));X()(n,d)||(d=n,E({object:h(n)}))}}function p(e){l&&function(){var e;l&&(B&&(B.enabled=c),b.enabled=s,l=!1,null==(e=r.parentElement)||e.removeChild(r))}()}}),[G,b,v,B,y]),i.createElement("group",Object(m.a)({ref:L,onClick:W,onPointerOver:function(){return x(!0)},onPointerOut:function(){return x(!1)},onPointerMissed:F},C),i.createElement(O.Provider,{value:k},r))}function N(){return i.useContext(O)}var Y=["follow","lockX","lockY","lockZ"],T=i.forwardRef((function(e,t){var n=e.follow,r=void 0===n||n,a=e.lockX,s=void 0!==a&&a,c=e.lockY,u=void 0!==c&&c,l=e.lockZ,g=void 0!==l&&l,d=Object(p.a)(e,Y),I=i.useRef();return Object(o.useFrame)((function(e){var t=e.camera;if(r&&I.current){var n=I.current.rotation.clone();I.current.quaternion.copy(t.quaternion),s&&(I.current.rotation.x=n.x),u&&(I.current.rotation.y=n.y),g&&(I.current.rotation.z=n.z)}})),i.createElement("group",Object(m.a)({ref:Object(b.default)([I,t])},d))})),z=n(3),K=n(6),j=n(7),D=n(2),U=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n),e=t.call(this),Object(D.a)(Object(z.a)(e),"isLineSegmentsGeometry",!0),Object(D.a)(Object(z.a)(e),"type","LineSegmentsGeometry"),Object(D.a)(Object(z.a)(e),"boundingBox",null),Object(D.a)(Object(z.a)(e),"boundingSphere",null),Object(D.a)(Object(z.a)(e),"box",new g.Box3),Object(D.a)(Object(z.a)(e),"vector",new g.Vector3);return e.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),e.setAttribute("position",new g.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),e.setAttribute("uv",new g.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2)),e}return Object(W.a)(n,[{key:"applyMatrix4",value:function(e){var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"setPositions",value:function(e){var t;if(e instanceof Float32Array)t=e;else{if(!Array.isArray(e))return console.error("LineSegmentsGeometry.setPosition requires either a Float32Array or regular array of numbers"),this;t=new Float32Array(e)}var n=new g.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new g.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new g.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}},{key:"setColors",value:function(e){var t;if(e instanceof Float32Array)t=e;else{if(!Array.isArray(e))return console.error("LineSegmentsGeometry.setColors requires either a Float32Array or regular array of numbers"),this;t=new Float32Array(e)}var n=new g.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new g.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new g.InterleavedBufferAttribute(n,3,3)),this}},{key:"fromWireframeGeometry",value:function(e){return this.setPositions(Array.from(e.attributes.position.array)),this}},{key:"fromEdgesGeometry",value:function(e){return this.setPositions(Array.from(e.attributes.position.array)),this}},{key:"fromMesh",value:function(e){return this.fromWireframeGeometry(new g.WireframeGeometry(e.geometry)),this}},{key:"fromLineSegments",value:function(e){var t=e.geometry;return t.isBufferGeometry&&this.setPositions(Array.from(t.attributes.position.array)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new g.Box3);var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new g.Sphere),null===this.boundingBox&&this.computeBoundingBox();var e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){var n=this.boundingSphere.center;this.boundingBox&&this.boundingBox.getCenter(n);for(var r=0,a=0,i=e.count;a<i;a++)this.vector.fromBufferAttribute(e,a),r=Math.max(r,n.distanceToSquared(this.vector)),this.vector.fromBufferAttribute(t,a),r=Math.max(r,n.distanceToSquared(this.vector));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}},{key:"toJSON",value:function(){}}]),n}(g.InstancedBufferGeometry),Q={linewidth:{value:1},resolution:{value:new g.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}};g.ShaderLib.line={uniforms:g.UniformsUtils.merge([g.UniformsLib.common,g.UniformsLib.fog,Q]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef ALPHA_TO_COVERAGE\n\n\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\tfloat a = vUv.x;\n\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\tfloat len2 = a * a + b * b;\n\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t}\n\n\t\t\t#else\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var P=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(E.a)(this,n),e=t.call(this,{uniforms:g.UniformsUtils.clone(g.ShaderLib.line.uniforms),vertexShader:g.ShaderLib.line.vertexShader,fragmentShader:g.ShaderLib.line.fragmentShader,clipping:!0}),Object(D.a)(Object(z.a)(e),"isLineMaterial",!0),Object(D.a)(Object(z.a)(e),"dashed",!1),Object(D.a)(Object(z.a)(e),"color",new g.Color(0)),Object(D.a)(Object(z.a)(e),"lineWidth",0),Object(D.a)(Object(z.a)(e),"dashScale",0),Object(D.a)(Object(z.a)(e),"dashOffset",0),Object(D.a)(Object(z.a)(e),"dashSize",0),Object(D.a)(Object(z.a)(e),"opacity",0),Object(D.a)(Object(z.a)(e),"resolution",new g.Vector2),Object(D.a)(Object(z.a)(e),"alphaToCoverage",!1),Object.defineProperties(Object(z.a)(e),{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){var t=new g.Color(e);this.uniforms.diffuse.value=t.getHex()}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),e?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set:function(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),e?this.defines.USE_DASH="":delete this.defines.USE_DASH}}}),e.setValues(r),e}return Object(W.a)(n)}(g.ShaderMaterial),J=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new U,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P({color:16777215*Math.random()});return Object(E.a)(this,n),e=t.call(this,r,a),Object(D.a)(Object(z.a)(e),"type","LineSegments2"),Object(D.a)(Object(z.a)(e),"isLineSegments2",!0),Object(D.a)(Object(z.a)(e),"distStart",new g.Vector3),Object(D.a)(Object(z.a)(e),"distEnd",new g.Vector3),Object(D.a)(Object(z.a)(e),"computeLineDistances",(function(){for(var t=e.geometry,n=t.attributes.instanceStart,r=t.attributes.instanceEnd,a=new Float32Array(2*n.data.count),i=0,o=0,s=n.data.count;i<s;i++,o+=2)e.distStart.fromBufferAttribute(n,i),e.distEnd.fromBufferAttribute(r,i),a[o]=0===o?0:a[o-1],a[o+1]=a[o]+e.distStart.distanceTo(e.distEnd);var c=new g.InstancedInterleavedBuffer(a,2,1);return t.setAttribute("instanceDistanceStart",new g.InterleavedBufferAttribute(c,1,0)),t.setAttribute("instanceDistanceEnd",new g.InterleavedBufferAttribute(c,1,1)),Object(z.a)(e)})),Object(D.a)(Object(z.a)(e),"rayStart",new g.Vector4),Object(D.a)(Object(z.a)(e),"rayEnd",new g.Vector4),Object(D.a)(Object(z.a)(e),"ssOrigin",new g.Vector4),Object(D.a)(Object(z.a)(e),"ssOrigin3",new g.Vector3),Object(D.a)(Object(z.a)(e),"mvMatrix",new g.Matrix4),Object(D.a)(Object(z.a)(e),"line",new g.Line3),Object(D.a)(Object(z.a)(e),"closestPoint",new g.Vector3),Object(D.a)(Object(z.a)(e),"raycast",(function(t,n){null===t.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var r=t.ray,a=t.camera,i=a.projectionMatrix,o=e.geometry,s=e.material,c=s.resolution,u=s.linewidth+0,l=o.attributes.instanceStart,d=o.attributes.instanceEnd,I=-a.near;r.at(1,e.ssOrigin),e.ssOrigin.w=1,e.ssOrigin.applyMatrix4(a.matrixWorldInverse),e.ssOrigin.applyMatrix4(i),e.ssOrigin.multiplyScalar(1/e.ssOrigin.w),e.ssOrigin.x*=c.x/2,e.ssOrigin.y*=c.y/2,e.ssOrigin.z=0,e.ssOrigin3.set(e.ssOrigin.x,e.ssOrigin.y,e.ssOrigin.z);var A=e.matrixWorld;e.mvMatrix.multiplyMatrices(a.matrixWorldInverse,A);for(var h=0,C=l.count;h<C;h++){if(e.rayStart.fromBufferAttribute(l,h),e.rayEnd.fromBufferAttribute(d,h),e.rayStart.w=1,e.rayEnd.w=1,e.rayStart.applyMatrix4(e.mvMatrix),e.rayEnd.applyMatrix4(e.mvMatrix),!(e.rayStart.z>I&&e.rayEnd.z>I)){if(e.rayStart.z>I){var f=e.rayStart.z-e.rayEnd.z,p=(e.rayStart.z-I)/f;e.rayStart.lerp(e.rayEnd,p)}else if(e.rayEnd.z>I){var m=e.rayEnd.z-e.rayStart.z,v=(e.rayEnd.z-I)/m;e.rayEnd.lerp(e.rayStart,v)}e.rayStart.applyMatrix4(i),e.rayEnd.applyMatrix4(i),e.rayStart.multiplyScalar(1/e.rayStart.w),e.rayEnd.multiplyScalar(1/e.rayEnd.w),e.rayStart.x*=c.x/2,e.rayStart.y*=c.y/2,e.rayEnd.x*=c.x/2,e.rayEnd.y*=c.y/2,e.line.start.set(e.rayStart.x,e.rayStart.y,e.rayStart.z),e.line.start.z=0,e.line.end.set(e.rayEnd.x,e.rayEnd.y,e.rayEnd.z),e.line.end.z=0;var b=e.line.closestPointToPointParameter(e.ssOrigin3,!0);e.line.at(b,e.closestPoint);var y=g.MathUtils.lerp(e.rayStart.z,e.rayEnd.z,b),B=y>=-1&&y<=1,G=e.ssOrigin3.distanceTo(e.closestPoint)<.5*u;if(B&&G){e.line.start.fromBufferAttribute(l,h),e.line.end.fromBufferAttribute(d,h),e.line.start.applyMatrix4(A),e.line.end.applyMatrix4(A);var w=new g.Vector3,_=new g.Vector3;r.distanceSqToSegment(e.line.start,e.line.end,_,w),n.push({distance:r.origin.distanceTo(_),point:_,face:null,faceIndex:h,object:Object(z.a)(e),uv:void 0,pointOnLine:w})}}}})),e}return Object(W.a)(n)}(g.Mesh),q=n(12),$=n(11),ee=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r;return Object(E.a)(this,n),r=t.call(this),Object(D.a)(Object(z.a)(r),"type","LineGeometry"),Object(D.a)(Object(z.a)(r),"isLineGeometry",!0),Object(D.a)(Object(z.a)(r),"setColors",(function(t){for(var a=t.length-3,i=new Float32Array(2*a),o=0;o<a;o+=3)i[2*o]=t[o],i[2*o+1]=t[o+1],i[2*o+2]=t[o+2],i[2*o+3]=t[o+3],i[2*o+4]=t[o+4],i[2*o+5]=t[o+5];return Object(q.a)((e=Object(z.a)(r),Object($.a)(n.prototype)),"setColors",e).call(e,i),Object(z.a)(r)})),Object(D.a)(Object(z.a)(r),"fromLine",(function(e){var t=e.geometry;return t.isBufferGeometry&&r.setPositions(Array.from(t.attributes.position.array)),Object(z.a)(r)})),Object(D.a)(Object(z.a)(r),"copy",(function(){return Object(z.a)(r)})),r}return Object(W.a)(n,[{key:"setPositions",value:function(e){for(var t=e.length-3,r=new Float32Array(2*t),a=0;a<t;a+=3)r[2*a]=e[a],r[2*a+1]=e[a+1],r[2*a+2]=e[a+2],r[2*a+3]=e[a+3],r[2*a+4]=e[a+4],r[2*a+5]=e[a+5];return Object(q.a)(Object($.a)(n.prototype),"setPositions",this).call(this,r),this}}]),n}(U),te=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ee,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P({color:16777215*Math.random()});return Object(E.a)(this,n),e=t.call(this,r,a),Object(D.a)(Object(z.a)(e),"type","Line2"),Object(D.a)(Object(z.a)(e),"isLine2",!0),e}return Object(W.a)(n)}(J),ne=["points","color","vertexColors","lineWidth","dashed"],re=i.forwardRef((function(e,t){var n=e.points,r=e.color,a=void 0===r?"black":r,o=e.vertexColors,s=e.lineWidth,c=e.dashed,u=Object(p.a)(e,ne),d=i.useState((function(){return new te})),I=Object(l.a)(d,1)[0],A=i.useState((function(){return new P})),h=Object(l.a)(A,1)[0],C=i.useState((function(){return new g.Vector2(512,512)})),f=Object(l.a)(C,1)[0],v=i.useMemo((function(){var e=new ee,t=n.map((function(e){return e instanceof g.Vector3?e.toArray():e}));if(e.setPositions(t.flat()),o){var r=o.map((function(e){return e instanceof g.Color?e.toArray():e}));e.setColors(r.flat())}return e}),[n,o]);return i.useLayoutEffect((function(){I.computeLineDistances()}),[n,I]),i.useLayoutEffect((function(){c?h.defines.USE_DASH="":delete h.defines.USE_DASH,h.needsUpdate=!0}),[c,h]),i.useEffect((function(){return function(){return v.dispose()}}),[v]),i.createElement("primitive",Object(m.a)({object:I,ref:t},u),i.createElement("primitive",{object:v,attach:"geometry"}),i.createElement("primitive",Object(m.a)({object:h,attach:"material",color:a,vertexColors:Boolean(o),resolution:f,linewidth:s,dashed:c},u)))})),ae=["start","end","mid","segments"],ie=new g.Vector3,oe=i.forwardRef((function(e,t){var n=e.start,r=void 0===n?[0,0,0]:n,o=e.end,s=void 0===o?[0,0,0]:o,c=e.mid,u=e.segments,d=void 0===u?20:u,I=Object(p.a)(e,ae),A=i.useRef(null),h=i.useState((function(){return new g.QuadraticBezierCurve3(void 0,void 0,void 0)})),C=Object(l.a)(h,1)[0],f=i.useCallback((function(e,t,n){var r,i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;return e instanceof g.Vector3?C.v0.copy(e):(r=C.v0).set.apply(r,Object(a.a)(e)),t instanceof g.Vector3?C.v2.copy(t):(i=C.v2).set.apply(i,Object(a.a)(t)),n instanceof g.Vector3?C.v1.copy(n):C.v1.copy(C.v0.clone().add(C.v2.clone().sub(C.v0)).add(ie.set(0,C.v0.y-C.v2.y,0))),C.getPoints(o)}),[]);i.useLayoutEffect((function(){A.current.setPoints=function(e,t,n){var r=f(e,t,n);A.current.geometry&&A.current.geometry.setPositions(r.map((function(e){return e.toArray()})).flat())}}),[]);var v=i.useMemo((function(){return f(r,s,c,d)}),[r,s,c,d]);return i.createElement(re,Object(m.a)({ref:Object(b.default)([A,t]),points:v},I))})),se=n(25),ce=["start","end","midA","midB","segments"],ue=i.forwardRef((function(e,t){var n=e.start,r=e.end,o=e.midA,s=e.midB,c=e.segments,u=void 0===c?20:c,l=Object(p.a)(e,ce),d=i.useMemo((function(){var e=n instanceof g.Vector3?n:Object(se.a)(g.Vector3,Object(a.a)(n)),t=r instanceof g.Vector3?r:Object(se.a)(g.Vector3,Object(a.a)(r)),i=o instanceof g.Vector3?o:Object(se.a)(g.Vector3,Object(a.a)(o)),c=s instanceof g.Vector3?s:Object(se.a)(g.Vector3,Object(a.a)(s));return new g.CubicBezierCurve3(e,i,c,t).getPoints(u)}),[n,r,o,s,u]);return i.createElement(re,Object(m.a)({ref:t,points:d},l))})),le=["url","distance","loop","autoplay"],ge=i.forwardRef((function(e,t){var n=e.url,r=e.distance,a=void 0===r?1:r,s=e.loop,c=void 0===s||s,u=e.autoplay,d=Object(p.a)(e,le),I=i.useRef(),A=Object(o.useThree)((function(e){return e.camera})),h=i.useState((function(){return new g.AudioListener})),C=Object(l.a)(h,1)[0],f=Object(o.useLoader)(g.AudioLoader,n);return i.useEffect((function(){var e=I.current;e&&(e.setBuffer(f),e.setRefDistance(a),e.setLoop(c),u&&!e.isPlaying&&e.play())}),[f,A,a,c]),i.useEffect((function(){var e=I.current;return A.add(C),function(){A.remove(C),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}}),[]),i.createElement("positionalAudio",Object(m.a)({ref:Object(b.default)([I,t]),args:[C]},d))})),de=n(35);function Ie(){var e=function(e){function t(e,t,n,r,a,i,o,s){var c=1-o;s.x=c*c*e+2*c*o*n+o*o*a,s.y=c*c*t+2*c*o*r+o*o*i}function n(e,t,n,r,a,i,o,s,c,u){var l=1-c;u.x=l*l*l*e+3*l*l*c*n+3*l*c*c*a+c*c*c*o,u.y=l*l*l*t+3*l*l*c*r+3*l*c*c*i+c*c*c*s}function r(e,t){for(var n,r,a,i,o,s=/([MLQCZ])([^MLQCZ]*)/g;n=s.exec(e);){var c=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(n[1]){case"M":i=r=c[0],o=a=c[1];break;case"L":c[0]===i&&c[1]===o||t("L",i,o,i=c[0],o=c[1]);break;case"Q":t("Q",i,o,i=c[2],o=c[3],c[0],c[1]);break;case"C":t("C",i,o,i=c[4],o=c[5],c[0],c[1],c[2],c[3]);break;case"Z":i===r&&o===a||t("L",i,o,r,a)}}}function a(e,a,i){void 0===i&&(i=16);var o={x:0,y:0};r(e,(function(e,r,s,c,u,l,g,d,I){switch(e){case"L":a(r,s,c,u);break;case"Q":for(var A=r,h=s,C=1;C<i;C++)t(r,s,l,g,c,u,C/(i-1),o),a(A,h,o.x,o.y),A=o.x,h=o.y;break;case"C":for(var f=r,p=s,m=1;m<i;m++)n(r,s,l,g,d,I,c,u,m/(i-1),o),a(f,p,o.x,o.y),f=o.x,p=o.y}}))}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",o=new WeakMap,s={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function c(e,t){var n=e.getContext?e.getContext("webgl",s):e,r=o.get(n);if(!r){var a=function(e){var t=l[e];if(!t&&!(t=l[e]=n.getExtension(e)))throw new Error(e+" not supported");return t},i=function(e,t){var r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r},c=function(){l={},g={},d={},I=-1,A.length=0},u="undefined"!==typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,l={},g={},d={},I=-1,A=[];n.canvas.addEventListener("webglcontextlost",(function(e){c(),e.preventDefault()}),!1),o.set(n,r={gl:n,isWebGL2:u,getExtension:a,withProgram:function(e,t,r,o){if(!g[e]){var s={},c={},l=n.createProgram();n.attachShader(l,i(t,n.VERTEX_SHADER)),n.attachShader(l,i(r,n.FRAGMENT_SHADER)),n.linkProgram(l),g[e]={program:l,transaction:function(e){n.useProgram(l),e({setUniform:function(e,t){for(var r=[],a=arguments.length-2;a-- >0;)r[a]=arguments[a+2];var i=c[t]||(c[t]=n.getUniformLocation(l,t));n["uniform"+e].apply(n,[i].concat(r))},setAttribute:function(e,t,r,i,o){var c=s[e];c||(c=s[e]={buf:n.createBuffer(),loc:n.getAttribLocation(l,e),data:null}),n.bindBuffer(n.ARRAY_BUFFER,c.buf),n.vertexAttribPointer(c.loc,t,n.FLOAT,!1,0,0),n.enableVertexAttribArray(c.loc),u?n.vertexAttribDivisor(c.loc,i):a("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c.loc,i),o!==c.data&&(n.bufferData(n.ARRAY_BUFFER,o,r),c.data=o)}})}}}g[e].transaction(o)},withTexture:function(e,t){I++;try{n.activeTexture(n.TEXTURE0+I);var r=d[e];r||(r=d[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),t(r,I)}finally{I--}},withTextureFramebuffer:function(e,t,r){var a=n.createFramebuffer();A.push(a),n.bindFramebuffer(n.FRAMEBUFFER,a),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{r(a)}finally{n.deleteFramebuffer(a),n.bindFramebuffer(n.FRAMEBUFFER,A[--A.length-1]||null)}},handleContextLoss:c})}t(r)}function u(e,t,n,r,a,o,s,u){void 0===s&&(s=15),void 0===u&&(u=null),c(e,(function(e){var c=e.gl,l=e.withProgram;(0,e.withTexture)("copy",(function(e,g){c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,o,0,c.RGBA,c.UNSIGNED_BYTE,t),l("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",(function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,c.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",g),c.bindFramebuffer(c.FRAMEBUFFER,u||null),c.disable(c.BLEND),c.colorMask(8&s,4&s,2&s,1&s),c.viewport(n,r,a,o),c.scissor(n,r,a,o),c.drawArrays(c.TRIANGLES,0,3)}))}))}))}var l=Object.freeze({__proto__:null,withWebGLContext:c,renderImageData:u,resizeWebGLCanvasWithoutClearing:function(e,t,n){var r=e.width,a=e.height;c(e,(function(i){var o=i.gl,s=new Uint8Array(r*a*4);o.readPixels(0,0,r,a,o.RGBA,o.UNSIGNED_BYTE,s),e.width=t,e.height=n,u(o,s,0,0,r,a)}))}});function g(e,t,n,r,i,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),c=r[2]-r[0],u=r[3]-r[1],l=[];a(n,(function(e,t,n,r){l.push({x1:e,y1:t,x2:n,y2:r,minX:Math.min(e,n),minY:Math.min(t,r),maxX:Math.max(e,n),maxY:Math.max(t,r)})})),l.sort((function(e,t){return e.maxX-t.maxX}));for(var g=0;g<e;g++)for(var d=0;d<t;d++){var I=C(r[0]+c*(g+.5)/e,r[1]+u*(d+.5)/t),h=Math.pow(1-Math.abs(I)/i,o)/2;I<0&&(h=1-h),h=Math.max(0,Math.min(255,Math.round(255*h))),s[d*e+g]=h}return s;function C(e,t){for(var n=1/0,r=1/0,a=l.length;a--;){var i=l[a];if(i.maxX+r<=e)break;if(e+r>i.minX&&t-r<i.maxY&&t+r>i.minY){var o=A(e,t,i.x1,i.y1,i.x2,i.y2);o<n&&(n=o,r=Math.sqrt(n))}}return function(e,t){for(var n=0,r=l.length;r--;){var a=l[r];if(a.maxX<=e)break;a.y1>t!==a.y2>t&&e<(a.x2-a.x1)*(t-a.y1)/(a.y2-a.y1)+a.x1&&(n+=a.y1<a.y2?1:-1)}return 0!==n}(e,t)&&(r=-r),r}}function d(e,t,n,r,a,i,o,s,c,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===u&&(u=0),I(e,t,n,r,a,i,o,null,s,c,u)}function I(e,t,n,r,a,i,o,s,c,l,d){void 0===i&&(i=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===d&&(d=0);for(var I=g(e,t,n,r,a,i),A=new Uint8Array(4*I.length),h=0;h<I.length;h++)A[4*h+d]=I[h];u(o,A,c,l,e,t,1<<3-d,s)}function A(e,t,n,r,a,i){var o=a-n,s=i-r,c=o*o+s*s,u=c?Math.max(0,Math.min(1,((e-n)*o+(t-r)*s)/c)):0,l=e-(n+u*o),g=t-(r+u*s);return l*l+g*g}var h=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:d,generateIntoFramebuffer:I}),C=new Float32Array([0,0,2,0,0,2]),f=null,p=!1,m={},v=new WeakMap;function b(e){if(!p&&!w(e))throw new Error("WebGL generation not supported")}function y(e,t,n,r,a,i,o){if(void 0===i&&(i=1),void 0===o&&(o=null),!o&&!(o=f)){var s="function"===typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!==typeof document?document.createElement("canvas"):null;if(!s)throw new Error("OffscreenCanvas or DOM canvas not supported");o=f=s.getContext("webgl",{depth:!1})}b(o);var u=new Uint8Array(e*t*4);c(o,(function(o){var s=o.gl,c=o.withTexture,l=o.withTextureFramebuffer;c("readable",(function(o,c){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),l(o,c,(function(o){G(e,t,n,r,a,i,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,u)}))}))}));for(var l=new Uint8Array(e*t),g=0,d=0;g<u.length;g+=4)l[d++]=u[g];return l}function B(e,t,n,r,a,i,o,s,c,u){void 0===i&&(i=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===u&&(u=0),G(e,t,n,r,a,i,o,null,s,c,u)}function G(e,t,n,r,o,s,u,l,g,d,I){void 0===s&&(s=1),void 0===g&&(g=0),void 0===d&&(d=0),void 0===I&&(I=0),b(u);var A=[];a(n,(function(e,t,n,r){A.push(e,t,n,r)})),A=new Float32Array(A),c(u,(function(n){var a=n.gl,c=n.isWebGL2,u=n.getExtension,h=n.withProgram,f=n.withTexture,p=n.withTextureFramebuffer,m=n.handleContextLoss;if(f("rawDistances",(function(n,f){e===n._lastWidth&&t===n._lastHeight||a.texImage2D(a.TEXTURE_2D,0,a.RGBA,n._lastWidth=e,n._lastHeight=t,0,a.RGBA,a.UNSIGNED_BYTE,null),h("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",(function(i){var l=i.setAttribute,g=i.setUniform,d=!c&&u("ANGLE_instanced_arrays"),I=!c&&u("EXT_blend_minmax");l("aUV",2,a.STATIC_DRAW,0,C),l("aLineSegment",4,a.DYNAMIC_DRAW,1,A),g.apply(void 0,["4f","uGlyphBounds"].concat(r)),g("1f","uMaxDistance",o),g("1f","uExponent",s),p(n,f,(function(n){a.enable(a.BLEND),a.colorMask(!0,!0,!0,!0),a.viewport(0,0,e,t),a.scissor(0,0,e,t),a.blendFunc(a.ONE,a.ONE),a.blendEquationSeparate(a.FUNC_ADD,c?a.MAX:I.MAX_EXT),a.clear(a.COLOR_BUFFER_BIT),c?a.drawArraysInstanced(a.TRIANGLES,0,3,A.length/4):d.drawArraysInstancedANGLE(a.TRIANGLES,0,3,A.length/4)}))})),h("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",(function(n){n.setAttribute("aUV",2,a.STATIC_DRAW,0,C),n.setUniform("1i","tex",f),a.bindFramebuffer(a.FRAMEBUFFER,l),a.disable(a.BLEND),a.colorMask(0===I,1===I,2===I,3===I),a.viewport(g,d,e,t),a.scissor(g,d,e,t),a.drawArrays(a.TRIANGLES,0,3)}))})),a.isContextLost())throw m(),new Error("webgl context lost")}))}function w(e){var t=e&&e!==f?e.canvas||e:m,n=v.get(t);if(void 0===n){p=!0;var r=null;try{var a=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],i=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(n=i&&a.length===i.length&&i.every((function(e,t){return e===a[t]})))||(r="bad trial run results",console.info(a,i))}catch(o){n=!1,r=o.message}r&&console.warn("WebGL SDF generation not supported:",r),p=!1,v.set(t,n)}return n}var _=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:B,generateIntoFramebuffer:G,isSupported:w});return e.forEachPathCommand=r,e.generate=function(e,t,n,r,a,i){void 0===a&&(a=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===i&&(i=1);try{return y.apply(_,arguments)}catch(o){return console.info("WebGL SDF generation failed, falling back to JS",o),g.apply(h,arguments)}},e.generateIntoCanvas=function(e,t,n,r,a,i,o,s,c,u){void 0===a&&(a=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===i&&(i=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===u&&(u=0);try{return B.apply(_,arguments)}catch(l){return console.info("WebGL SDF generation failed, falling back to JS",l),d.apply(h,arguments)}},e.javascript=h,e.pathToLineSegments=a,e.webgl=_,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}var Ae=function(){var e=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach((function(e,t){n[e]=1<<t+1,r[n[e]]=e})),Object.freeze(n);var a=n.LRI|n.RLI|n.FSI,i=n.L|n.R|n.AL,o=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,s=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|a|n.PDI|s,u=null;function l(e){return function(){if(!u){u=new Map;var e=function(e){if(t.hasOwnProperty(e)){var r=0;t[e].split(",").forEach((function(t){var a=t.split("+"),i=a[0],o=a[1];i=parseInt(i,36),o=o?parseInt(o,36):0,u.set(r+=i,n[e]);for(var s=0;s<o;s++)u.set(++r,n[e])}))}};for(var r in t)e(r)}}(),u.get(e.codePointAt(0))||n.L}var g,d,I,A="14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",h="6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye";function C(e,t){var n,r=0,a=new Map,i=t&&new Map;return e.split(",").forEach((function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(n);else{n=o;var c=o.split(">"),u=c[0],l=c[1];u=String.fromCodePoint(r+=parseInt(u,36)),l=String.fromCodePoint(r+=parseInt(l,36)),a.set(u,l),t&&i.set(l,u)}})),{map:a,reverseMap:i}}function f(){if(!g){var e=C(A,!0),t=e.map,n=e.reverseMap;g=t,d=n,I=C(h,!1).map}}function p(e){return f(),g.get(e)||null}function m(e){return f(),d.get(e)||null}function v(e){return f(),I.get(e)||null}var b=n.L,y=n.R,B=n.EN,G=n.ES,w=n.ET,_=n.AN,Z=n.CS,S=n.B,x=n.S,R=n.ON,M=n.BN,k=n.NSM,E=n.AL,W=n.LRO,V=n.RLO,F=n.LRE,X=n.RLE,H=n.PDF,O=n.LRI,L=n.RLI,N=n.FSI,Y=n.PDI;var T;function z(e){return function(){if(!T){var e=C("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),t=e.map;e.reverseMap.forEach((function(e,n){t.set(n,e)})),T=t}}(),T.get(e)||null}function K(e,t,n,r){var a=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(a-1,null==r?a-1:+r);var i=[];return t.paragraphs.forEach((function(a){var o=Math.max(n,a.start),s=Math.min(r,a.end);if(o<s){for(var u=t.levels.slice(o,s+1),g=s;g>=o&&l(e[g])&c;g--)u[g]=a.level;for(var d=a.level,I=1/0,A=0;A<u.length;A++){var h=u[A];h>d&&(d=h),h<I&&(I=1|h)}for(var C=d;C>=I;C--)for(var f=0;f<u.length;f++)if(u[f]>=C){for(var p=f;f+1<u.length&&u[f+1]>=C;)f++;f>p&&i.push([p+n,f+n])}}})),i}function j(e,t,n,r){for(var a=K(e,t,n,r),i=[],o=0;o<e.length;o++)i[o]=o;return a.forEach((function(e){for(var t=e[0],n=e[1],r=i.slice(t,n+1),a=r.length;a--;)i[n-a]=r[a]})),i}return e.closingToOpeningBracket=m,e.getBidiCharType=l,e.getBidiCharTypeName=function(e){return r[l(e)]},e.getCanonicalBracket=v,e.getEmbeddingLevels=function(e,t){for(var n=new Uint32Array(e.length),r=0;r<e.length;r++)n[r]=l(e[r]);var u=new Map;function g(e,t){var r=n[e];n[e]=t,u.set(r,u.get(r)-1),r&o&&u.set(o,u.get(o)-1),u.set(t,(u.get(t)||0)+1),t&o&&u.set(o,(u.get(o)||0)+1)}for(var d=new Uint8Array(e.length),I=new Map,A=[],h=null,C=0;C<e.length;C++)h||A.push(h={start:C,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:Nt(C,!1)}),n[C]&S&&(h.end=C,h=null);for(var f=X|F|V|W|a|Y|H|S,T=function(e){return e+(1&e?1:2)},z=function(e){return e+(1&e?2:1)},K=0;K<A.length;K++){var j=[{_level:(h=A[K]).level,_override:0,_isolate:0}],D=void 0,U=0,Q=0,P=0;u.clear();for(var J=h.start;J<=h.end;J++){var q=n[J];if(D=j[j.length-1],u.set(q,(u.get(q)||0)+1),q&o&&u.set(o,(u.get(o)||0)+1),q&f)if(q&(X|F)){d[J]=D._level;var $=(q===X?z:T)(D._level);$<=125&&!U&&!Q?j.push({_level:$,_override:0,_isolate:0}):U||Q++}else if(q&(V|W)){d[J]=D._level;var ee=(q===V?z:T)(D._level);ee<=125&&!U&&!Q?j.push({_level:ee,_override:q&V?y:b,_isolate:0}):U||Q++}else if(q&a){q&N&&(q=1===Nt(J+1,!0)?L:O),d[J]=D._level,D._override&&g(J,D._override);var te=(q===L?z:T)(D._level);te<=125&&0===U&&0===Q?(P++,j.push({_level:te,_override:0,_isolate:1,_isolInitIndex:J})):U++}else if(q&Y){if(U>0)U--;else if(P>0){for(Q=0;!j[j.length-1]._isolate;)j.pop();var ne=j[j.length-1]._isolInitIndex;null!=ne&&(I.set(ne,J),I.set(J,ne)),j.pop(),P--}D=j[j.length-1],d[J]=D._level,D._override&&g(J,D._override)}else q&H?(0===U&&(Q>0?Q--:!D._isolate&&j.length>1&&(j.pop(),D=j[j.length-1])),d[J]=D._level):q&S&&(d[J]=h.level);else d[J]=D._level,D._override&&q!==M&&g(J,D._override)}for(var re=[],ae=null,ie=h.start;ie<=h.end;ie++){var oe=n[ie];if(!(oe&s)){var se=d[ie],ce=oe&a,ue=oe===Y;ae&&se===ae._level?(ae._end=ie,ae._endsWithIsolInit=ce):re.push(ae={_start:ie,_end:ie,_level:se,_startsWithPDI:ue,_endsWithIsolInit:ce})}}for(var le=[],ge=0;ge<re.length;ge++){var de=re[ge];if(!de._startsWithPDI||de._startsWithPDI&&!I.has(de._start)){for(var Ie=[ae=de],Ae=void 0;ae&&ae._endsWithIsolInit&&null!=(Ae=I.get(ae._end));)for(var he=ge+1;he<re.length;he++)if(re[he]._start===Ae){Ie.push(ae=re[he]);break}for(var Ce=[],fe=0;fe<Ie.length;fe++)for(var pe=Ie[fe],me=pe._start;me<=pe._end;me++)Ce.push(me);for(var ve=d[Ce[0]],be=h.level,ye=Ce[0]-1;ye>=0;ye--)if(!(n[ye]&s)){be=d[ye];break}var Be=Ce[Ce.length-1],Ge=d[Be],we=h.level;if(!(n[Be]&a))for(var _e=Be+1;_e<=h.end;_e++)if(!(n[_e]&s)){we=d[_e];break}le.push({_seqIndices:Ce,_sosType:Math.max(be,ve)%2?y:b,_eosType:Math.max(we,Ge)%2?y:b})}}for(var Ze=0;Ze<le.length;Ze++){var Se=le[Ze],xe=Se._seqIndices,Re=Se._sosType,Me=Se._eosType;if(u.get(k))for(var ke=0;ke<xe.length;ke++){var Ee=xe[ke];if(n[Ee]&k){for(var We=Re,Ve=ke-1;Ve>=0;Ve--)if(!(n[xe[Ve]]&s)){We=n[xe[Ve]];break}g(Ee,We&(a|Y)?R:We)}}if(u.get(B))for(var Fe=0;Fe<xe.length;Fe++){var Xe=xe[Fe];if(n[Xe]&B)for(var He=Fe-1;He>=-1;He--){var Oe=-1===He?Re:n[xe[He]];if(Oe&i){Oe===E&&g(Xe,_);break}}}if(u.get(E))for(var Le=0;Le<xe.length;Le++){var Ne=xe[Le];n[Ne]&E&&g(Ne,y)}if(u.get(G)||u.get(Z))for(var Ye=1;Ye<xe.length-1;Ye++){var Te=xe[Ye];if(n[Te]&(G|Z)){for(var ze=0,Ke=0,je=Ye-1;je>=0&&(ze=n[xe[je]])&s;je--);for(var De=Ye+1;De<xe.length&&(Ke=n[xe[De]])&s;De++);ze===Ke&&(n[Te]===G?ze===B:ze&(B|_))&&g(Te,ze)}}if(u.get(B))for(var Ue=0;Ue<xe.length;Ue++){var Qe=xe[Ue];if(n[Qe]&B){for(var Pe=Ue-1;Pe>=0&&n[xe[Pe]]&(w|s);Pe--)g(xe[Pe],B);for(var Je=Ue+1;Je<xe.length&&n[xe[Je]]&(w|s);Je++)g(xe[Je],B)}}if(u.get(w)||u.get(G)||u.get(Z))for(var qe=0;qe<xe.length;qe++){var $e=xe[qe];if(n[$e]&(w|G|Z)){g($e,R);for(var et=qe-1;et>=0&&n[xe[et]]&s;et--)g(xe[et],R);for(var tt=qe+1;tt<xe.length&&n[xe[tt]]&s;tt++)g(xe[tt],R)}}if(u.get(B))for(var nt=0,rt=Re;nt<xe.length;nt++){var at=xe[nt],it=n[at];it&B?rt===b&&g(at,b):it&i&&(rt=it)}if(u.get(o)){for(var ot=y|B|_,st=ot|b,ct=[],ut=[],lt=0;lt<xe.length;lt++)if(n[xe[lt]]&o){var gt=e[xe[lt]],dt=void 0;if(null!==p(gt)){if(!(ut.length<63))break;ut.push({char:gt,seqIndex:lt})}else if(null!==(dt=m(gt)))for(var It=ut.length-1;It>=0;It--){var At=ut[It].char;if(At===dt||At===m(v(gt))||p(v(At))===gt){ct.push([ut[It].seqIndex,lt]),ut.length=It;break}}}ct.sort((function(e,t){return e[0]-t[0]}));for(var ht=0;ht<ct.length;ht++){for(var Ct=ct[ht],ft=Ct[0],pt=Ct[1],mt=!1,vt=0,bt=ft+1;bt<pt;bt++){var yt=xe[bt];if(n[yt]&st){mt=!0;var Bt=n[yt]&ot?y:b;if(Bt===Tt(yt)){vt=Bt;break}}}if(mt&&!vt){vt=Re;for(var Gt=ft-1;Gt>=0;Gt--){var wt=xe[Gt];if(n[wt]&st){var _t=n[wt]&ot?y:b;vt=_t!==Tt(wt)?_t:Tt(wt);break}}}if(vt){if(n[xe[ft]]=n[xe[pt]]=vt,vt!==Tt(xe[ft]))for(var Zt=ft+1;Zt<xe.length;Zt++)if(!(n[xe[Zt]]&s)){l(e[xe[Zt]])&k&&(n[xe[Zt]]=vt);break}if(vt!==Tt(xe[pt]))for(var St=pt+1;St<xe.length;St++)if(!(n[xe[St]]&s)){l(e[xe[St]])&k&&(n[xe[St]]=vt);break}}}for(var xt=0;xt<xe.length;xt++)if(n[xe[xt]]&o){for(var Rt=xt,Mt=xt,kt=Re,Et=xt-1;Et>=0;Et--){if(!(n[xe[Et]]&s)){kt=n[xe[Et]]&ot?y:b;break}Rt=Et}for(var Wt=Me,Vt=xt+1;Vt<xe.length;Vt++){if(!(n[xe[Vt]]&(o|s))){Wt=n[xe[Vt]]&ot?y:b;break}Mt=Vt}for(var Ft=Rt;Ft<=Mt;Ft++)n[xe[Ft]]=kt===Wt?kt:Tt(xe[Ft]);xt=Mt}}}for(var Xt=h.start;Xt<=h.end;Xt++){var Ht=d[Xt],Ot=n[Xt];if(1&Ht?Ot&(b|B|_)&&d[Xt]++:Ot&y?d[Xt]++:Ot&(_|B)&&(d[Xt]+=2),Ot&s&&(d[Xt]=0===Xt?h.level:d[Xt-1]),Xt===h.end||l(e[Xt])&(x|S))for(var Lt=Xt;Lt>=0&&l(e[Lt])&c;Lt--)d[Lt]=h.level}}return{levels:d,paragraphs:A};function Nt(t,r){for(var i=t;i<e.length;i++){var o=n[i];if(o&(y|E))return 1;if(o&(S|b)||r&&o===Y)return 0;if(o&a){var s=Yt(i);i=-1===s?e.length:s}}return 0}function Yt(t){for(var r=1,i=t+1;i<e.length;i++){var o=n[i];if(o&S)break;if(o&Y){if(0===--r)return i}else o&a&&r++}return-1}function Tt(e){return 1&d[e]?y:b}},e.getMirroredCharacter=z,e.getMirroredCharactersMap=function(e,t,n,r){var a=e.length;n=Math.max(0,null==n?0:+n),r=Math.min(a-1,null==r?a-1:+r);for(var i=new Map,o=n;o<=r;o++)if(1&t[o]){var s=z(e[o]);null!==s&&i.set(o,s)}return i},e.getReorderSegments=K,e.getReorderedIndices=j,e.getReorderedString=function(e,t,n,r){var a=j(e,t,n,r),i=[].concat(e);return a.forEach((function(n,r){i[r]=(1&t.levels[n]?z(e[n]):null)||e[n]})),i.join("")},e.openingToClosingBracket=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e},he=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Ce(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,(function(e,t){var n=g.ShaderChunk[t];return n?Ce(n):e}))}for(var fe=[],pe=0;pe<256;pe++)fe[pe]=(pe<16?"0":"")+pe.toString(16);var me=Object.assign||function(){for(var e=arguments[0],t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])}return e},ve=Date.now(),be=new WeakMap,ye=new Map,Be=1e10;function Ge(e,t){var n=function(e){var t=JSON.stringify(e,_e),n=Se.get(t);null==n&&Se.set(t,n=++Ze);return n}(t),r=be.get(e);if(r||be.set(e,r=Object.create(null)),r[n])return new r[n];var a="_onBeforeCompile".concat(n),i=function(r){e.onBeforeCompile.call(this,r);var i=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader,o=ye[i];if(!o){var s=function(e,t,n){var r=e.vertexShader,a=e.fragmentShader,i=t.vertexDefs,o=t.vertexMainIntro,s=t.vertexMainOutro,c=t.vertexTransform,u=t.fragmentDefs,l=t.fragmentMainIntro,g=t.fragmentMainOutro,d=t.fragmentColorTransform,I=t.customRewriter,A=t.timeUniform;i=i||"",o=o||"",s=s||"",u=u||"",l=l||"",g=g||"",(c||I)&&(r=Ce(r));(d||I)&&(a=Ce(a=a.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n")));if(I){var h=I({vertexShader:r,fragmentShader:a});r=h.vertexShader,a=h.fragmentShader}if(d){var C=[];a=a.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,(function(e){return C.push(e),""})),g="".concat(d,"\n").concat(C.join("\n"),"\n").concat(g)}if(A){var f="\nuniform float ".concat(A,";\n");i=f+i,u=f+u}c&&(r="vec3 troika_position_".concat(n,";\nvec3 troika_normal_").concat(n,";\nvec2 troika_uv_").concat(n,";\n").concat(r,"\n"),i="".concat(i,"\nvoid troikaVertexTransform").concat(n,"(inout vec3 position, inout vec3 normal, inout vec2 uv) {\n  ").concat(c,"\n}\n"),o="\ntroika_position_".concat(n," = vec3(position);\ntroika_normal_").concat(n," = vec3(normal);\ntroika_uv_").concat(n," = vec2(uv);\ntroikaVertexTransform").concat(n,"(troika_position_").concat(n,", troika_normal_").concat(n,", troika_uv_").concat(n,");\n").concat(o,"\n"),r=r.replace(/\b(position|normal|uv)\b/g,(function(e,t,r,a){return/\battribute\s+vec[23]\s+$/.test(a.substr(0,r))?t:"troika_".concat(t,"_").concat(n)})));return r=we(r,n,i,o,s),a=we(a,n,u,l,g),{vertexShader:r,fragmentShader:a}}(r,t,n);o=ye[i]=s}r.vertexShader=o.vertexShader,r.fragmentShader=o.fragmentShader,me(r.uniforms,this.uniforms),t.timeUniform&&(r.uniforms[t.timeUniform]={get value(){return Date.now()-ve}}),this[a]&&this[a](r)},o=function(){return s(t.chained?e:e.clone())},s=function(r){var a=Object.create(r,c);return Object.defineProperty(a,"baseMaterial",{value:e}),Object.defineProperty(a,"id",{value:Be++}),a.uuid=function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(fe[255&e]+fe[e>>8&255]+fe[e>>16&255]+fe[e>>24&255]+"-"+fe[255&t]+fe[t>>8&255]+"-"+fe[t>>16&15|64]+fe[t>>24&255]+"-"+fe[63&n|128]+fe[n>>8&255]+"-"+fe[n>>16&255]+fe[n>>24&255]+fe[255&r]+fe[r>>8&255]+fe[r>>16&255]+fe[r>>24&255]).toUpperCase()}(),a.uniforms=me({},r.uniforms,t.uniforms),a.defines=me({},r.defines,t.defines),a.defines["TROIKA_DERIVED_MATERIAL_".concat(n)]="",a.extensions=me({},r.extensions,t.extensions),a._listeners=void 0,a},c={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:function(){return i},set:function(e){this[a]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(me(this.extensions,t.extensions),me(this.defines,t.defines),me(this.uniforms,g.UniformsUtils.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){var t=new e.constructor;return s(t).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){var n=this._depthMaterial;return n||((n=this._depthMaterial=Ge(e.isDerivedMaterial?e.getDepthMaterial():new g.MeshDepthMaterial({depthPacking:g.RGBADepthPacking}),t)).defines.IS_DEPTH_MATERIAL="",n.uniforms=this.uniforms),n}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){var n=this._distanceMaterial;return n||((n=this._distanceMaterial=Ge(e.isDerivedMaterial?e.getDistanceMaterial():new g.MeshDistanceMaterial,t)).defines.IS_DISTANCE_MATERIAL="",n.uniforms=this.uniforms),n}},dispose:{writable:!0,configurable:!0,value:function(){var t=this._depthMaterial,n=this._distanceMaterial;t&&t.dispose(),n&&n.dispose(),e.dispose.call(this)}}};return r[n]=o,new o}function we(e,t,n,r,a){return(r||a||n)&&(e=e.replace(he,"\n".concat(n,"\nvoid troikaOrigMain").concat(t,"() {")),e+="\nvoid main() {\n  ".concat(r,"\n  troikaOrigMain").concat(t,"();\n  ").concat(a,"\n}")),e}function _e(e,t){return"uniforms"===e?void 0:"function"===typeof t?t.toString():t}var Ze=0,Se=new Map;var xe=null,Re=new g.MeshStandardMaterial({color:16777215,side:g.DoubleSide});g.Mesh;var Me,ke=function(){return(self.performance||Date).now()},Ee=Ie();var We=function(){var e=[],t=0;function n(){for(var r=ke();e.length&&ke()-r<5;)e.shift()();t=e.length?setTimeout(n,0):0}return function(){for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];var o=Object(de.a)();return e.push((function(){var e=ke();try{var t;(t=Ee.webgl).generateIntoCanvas.apply(t,a),o.resolve({timing:ke()-e})}catch(n){o.reject(n)}})),t||(t=setTimeout(n,0)),o}}(),Ve=function(){var e={},t=0;return function(n,r,a,i,o,s,c,u,l,g){var d="TroikaTextSDFGenerator_JS_"+t++%4,I=e[d];return I||(I=e[d]={workerModule:Object(de.c)({name:d,workerId:d,dependencies:[Ie,ke],init:function(e,t){var n=e().javascript.generate;return function(){var e=t(),r=n.apply(void 0,arguments);return{textureData:r,timing:t()-e}}},getTransferables:function(e){return[e.textureData.buffer]}}),requests:0,idleTimer:null}),I.requests++,clearTimeout(I.idleTimer),I.workerModule(n,r,a,i,o,s).then((function(e){for(var t=e.textureData,a=e.timing,i=ke(),o=new Uint8Array(4*t.length),s=0;s<t.length;s++)o[4*s+g]=t[s];return Ee.webglUtils.renderImageData(c,o,u,l,n,r,1<<3-g),a+=ke()-i,0===--I.requests&&(I.idleTimer=setTimeout((function(){Object(de.d)(d)}),2e3)),{timing:a}}))}}();var Fe=Ee.webglUtils.resizeWebGLCanvasWithoutClearing;var Xe=Object(de.c)({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(e){var t={parse:function(e){var n=t._bin,r=new Uint8Array(e);if("ttcf"==n.readASCII(r,0,4)){var a=4;n.readUshort(r,a),a+=2,n.readUshort(r,a),a+=2;var i=n.readUint(r,a);a+=4;for(var o=[],s=0;s<i;s++){var c=n.readUint(r,a);a+=4,o.push(t._readFont(r,c))}return o}return[t._readFont(r,0)]},_readFont:function(e,n){var r=t._bin,a=n;r.readFixed(e,n),n+=4;var i=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:e,_offset:a},c={},u=0;u<i;u++){var l=r.readASCII(e,n,4);n+=4,r.readUint(e,n),n+=4;var g=r.readUint(e,n);n+=4;var d=r.readUint(e,n);n+=4,c[l]={offset:g,length:d}}for(u=0;u<o.length;u++){var I=o[u];c[I]&&(s[I.trim()]=t[I.trim()].parse(e,c[I].offset,c[I].length,s))}return s},_tabOffset:function(e,n,r){for(var a=t._bin,i=a.readUshort(e,r+4),o=r+12,s=0;s<i;s++){var c=a.readASCII(e,o,4);o+=4,a.readUint(e,o),o+=4;var u=a.readUint(e,o);if(o+=4,a.readUint(e,o),o+=4,c==n)return u}return 0}};t._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,n){return t._bin.readShort(e,n)/16384},readInt:function(e,n){return t._bin._view(e).getInt32(n)},readInt8:function(e,n){return t._bin._view(e).getInt8(n)},readShort:function(e,n){return t._bin._view(e).getInt16(n)},readUshort:function(e,n){return t._bin._view(e).getUint16(n)},readUshorts:function(e,n,r){for(var a=[],i=0;i<r;i++)a.push(t._bin.readUshort(e,n+2*i));return a},readUint:function(e,n){return t._bin._view(e).getUint32(n)},readUint64:function(e,n){return 4294967296*t._bin.readUint(e,n)+t._bin.readUint(e,n+4)},readASCII:function(e,t,n){for(var r="",a=0;a<n;a++)r+=String.fromCharCode(e[t+a]);return r},readUnicode:function(e,t,n){for(var r="",a=0;a<n;a++){var i=e[t++]<<8|e[t++];r+=String.fromCharCode(i)}return r},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,n,r){var a=t._bin._tdec;return a&&0==n&&r==e.length?a.decode(e):t._bin.readASCII(e,n,r)},readBytes:function(e,t,n){for(var r=[],a=0;a<n;a++)r.push(e[t+a]);return r},readASCIIArray:function(e,t,n){for(var r=[],a=0;a<n;a++)r.push(String.fromCharCode(e[t+a]));return r},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,n,r,a,i){var o=t._bin,s={},c=n;o.readFixed(e,n),n+=4;var u=o.readUshort(e,n);n+=2;var l=o.readUshort(e,n);n+=2;var g=o.readUshort(e,n);return n+=2,s.scriptList=t._lctf.readScriptList(e,c+u),s.featureList=t._lctf.readFeatureList(e,c+l),s.lookupList=t._lctf.readLookupList(e,c+g,i),s},t._lctf.readLookupList=function(e,n,r){var a=t._bin,i=n,o=[],s=a.readUshort(e,n);n+=2;for(var c=0;c<s;c++){var u=a.readUshort(e,n);n+=2;var l=t._lctf.readLookupTable(e,i+u,r);o.push(l)}return o},t._lctf.readLookupTable=function(e,n,r){var a=t._bin,i=n,o={tabs:[]};o.ltype=a.readUshort(e,n),n+=2,o.flag=a.readUshort(e,n),n+=2;var s=a.readUshort(e,n);n+=2;for(var c=o.ltype,u=0;u<s;u++){var l=a.readUshort(e,n);n+=2;var g=r(e,c,i+l,o);o.tabs.push(g)}return o},t._lctf.numOfOnes=function(e){for(var t=0,n=0;n<32;n++)0!=(e>>>n&1)&&t++;return t},t._lctf.readClassDef=function(e,n){var r=t._bin,a=[],i=r.readUshort(e,n);if(n+=2,1==i){var o=r.readUshort(e,n);n+=2;var s=r.readUshort(e,n);n+=2;for(var c=0;c<s;c++)a.push(o+c),a.push(o+c),a.push(r.readUshort(e,n)),n+=2}if(2==i){var u=r.readUshort(e,n);for(n+=2,c=0;c<u;c++)a.push(r.readUshort(e,n)),n+=2,a.push(r.readUshort(e,n)),n+=2,a.push(r.readUshort(e,n)),n+=2}return a},t._lctf.getInterval=function(e,t){for(var n=0;n<e.length;n+=3){var r=e[n],a=e[n+1];if(e[n+2],r<=t&&t<=a)return n}return-1},t._lctf.readCoverage=function(e,n){var r=t._bin,a={};a.fmt=r.readUshort(e,n),n+=2;var i=r.readUshort(e,n);return n+=2,1==a.fmt&&(a.tab=r.readUshorts(e,n,i)),2==a.fmt&&(a.tab=r.readUshorts(e,n,3*i)),a},t._lctf.coverageIndex=function(e,n){var r=e.tab;if(1==e.fmt)return r.indexOf(n);if(2==e.fmt){var a=t._lctf.getInterval(r,n);if(-1!=a)return r[a+2]+(n-r[a])}return-1},t._lctf.readFeatureList=function(e,n){var r=t._bin,a=n,i=[],o=r.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var c=r.readASCII(e,n,4);n+=4;var u=r.readUshort(e,n);n+=2;var l=t._lctf.readFeatureTable(e,a+u);l.tag=c.trim(),i.push(l)}return i},t._lctf.readFeatureTable=function(e,n){var r=t._bin,a=n,i={},o=r.readUshort(e,n);n+=2,o>0&&(i.featureParams=a+o);var s=r.readUshort(e,n);n+=2,i.tab=[];for(var c=0;c<s;c++)i.tab.push(r.readUshort(e,n+2*c));return i},t._lctf.readScriptList=function(e,n){var r=t._bin,a=n,i={},o=r.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var c=r.readASCII(e,n,4);n+=4;var u=r.readUshort(e,n);n+=2,i[c.trim()]=t._lctf.readScriptTable(e,a+u)}return i},t._lctf.readScriptTable=function(e,n){var r=t._bin,a=n,i={},o=r.readUshort(e,n);n+=2,i.default=t._lctf.readLangSysTable(e,a+o);var s=r.readUshort(e,n);n+=2;for(var c=0;c<s;c++){var u=r.readASCII(e,n,4);n+=4;var l=r.readUshort(e,n);n+=2,i[u.trim()]=t._lctf.readLangSysTable(e,a+l)}return i},t._lctf.readLangSysTable=function(e,n){var r=t._bin,a={};r.readUshort(e,n),n+=2,a.reqFeature=r.readUshort(e,n),n+=2;var i=r.readUshort(e,n);return n+=2,a.features=r.readUshorts(e,n,i),a},t.CFF={},t.CFF.parse=function(e,n,r){var a=t._bin;(e=new Uint8Array(e.buffer,n,r))[n=0],e[++n],e[++n],e[++n],n++;var i=[];n=t.CFF.readIndex(e,n,i);for(var o=[],s=0;s<i.length-1;s++)o.push(a.readASCII(e,n+i[s],i[s+1]-i[s]));n+=i[i.length-1];var c=[];n=t.CFF.readIndex(e,n,c);var u=[];for(s=0;s<c.length-1;s++)u.push(t.CFF.readDict(e,n+c[s],n+c[s+1]));n+=c[c.length-1];var l=u[0],g=[];n=t.CFF.readIndex(e,n,g);var d=[];for(s=0;s<g.length-1;s++)d.push(a.readASCII(e,n+g[s],g[s+1]-g[s]));if(n+=g[g.length-1],t.CFF.readSubrs(e,n,l),l.CharStrings){n=l.CharStrings,g=[],n=t.CFF.readIndex(e,n,g);var I=[];for(s=0;s<g.length-1;s++)I.push(a.readBytes(e,n+g[s],g[s+1]-g[s]));l.CharStrings=I}if(l.ROS){n=l.FDArray;var A=[];for(n=t.CFF.readIndex(e,n,A),l.FDArray=[],s=0;s<A.length-1;s++){var h=t.CFF.readDict(e,n+A[s],n+A[s+1]);t.CFF._readFDict(e,h,d),l.FDArray.push(h)}n+=A[A.length-1],n=l.FDSelect,l.FDSelect=[];var C=e[n];if(n++,3!=C)throw C;var f=a.readUshort(e,n);for(n+=2,s=0;s<f+1;s++)l.FDSelect.push(a.readUshort(e,n),e[n+2]),n+=3}return l.Encoding&&(l.Encoding=t.CFF.readEncoding(e,l.Encoding,l.CharStrings.length)),l.charset&&(l.charset=t.CFF.readCharset(e,l.charset,l.CharStrings.length)),t.CFF._readFDict(e,l,d),l},t.CFF._readFDict=function(e,n,r){var a;for(var i in n.Private&&(a=n.Private[1],n.Private=t.CFF.readDict(e,a,a+n.Private[0]),n.Private.Subrs&&t.CFF.readSubrs(e,a+n.Private.Subrs,n.Private)),n)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(i)&&(n[i]=r[n[i]-426+35])},t.CFF.readSubrs=function(e,n,r){var a=t._bin,i=[];n=t.CFF.readIndex(e,n,i);var o,s=i.length;o=s<1240?107:s<33900?1131:32768,r.Bias=o,r.Subrs=[];for(var c=0;c<i.length-1;c++)r.Subrs.push(a.readBytes(e,n+i[c],i[c+1]-i[c]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var n=0;n<e.charset.length;n++)if(e.charset[n]==t)return n;return-1},t.CFF.glyphBySE=function(e,n){return n<0||n>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[n])},t.CFF.readEncoding=function(e,n,r){t._bin;var a=[".notdef"],i=e[n];if(n++,0!=i)throw"error: unknown encoding format: "+i;var o=e[n];n++;for(var s=0;s<o;s++)a.push(e[n+s]);return a},t.CFF.readCharset=function(e,n,r){var a=t._bin,i=[".notdef"],o=e[n];if(n++,0==o)for(var s=0;s<r;s++){var c=a.readUshort(e,n);n+=2,i.push(c)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;i.length<r;){c=a.readUshort(e,n),n+=2;var u=0;for(1==o?(u=e[n],n++):(u=a.readUshort(e,n),n+=2),s=0;s<=u;s++)i.push(c),c++}}return i},t.CFF.readIndex=function(e,n,r){var a=t._bin,i=a.readUshort(e,n)+1,o=e[n+=2];if(n++,1==o)for(var s=0;s<i;s++)r.push(e[n+s]);else if(2==o)for(s=0;s<i;s++)r.push(a.readUshort(e,n+2*s));else if(3==o)for(s=0;s<i;s++)r.push(16777215&a.readUint(e,n+3*s-1));else if(1!=i)throw"unsupported offset size: "+o+", count: "+i;return(n+=i*o)-1},t.CFF.getCharString=function(e,n,r){var a=t._bin,i=e[n],o=e[n+1];e[n+2],e[n+3],e[n+4];var s=1,c=null,u=null;i<=20&&(c=i,s=1),12==i&&(c=100*i+o,s=2),21<=i&&i<=27&&(c=i,s=1),28==i&&(u=a.readShort(e,n+1),s=3),29<=i&&i<=31&&(c=i,s=1),32<=i&&i<=246&&(u=i-139,s=1),247<=i&&i<=250&&(u=256*(i-247)+o+108,s=2),251<=i&&i<=254&&(u=256*-(i-251)-o-108,s=2),255==i&&(u=a.readInt(e,n+1)/65535,s=5),r.val=null!=u?u:"o"+c,r.size=s},t.CFF.readCharString=function(e,n,r){for(var a=n+r,i=t._bin,o=[];n<a;){var s=e[n],c=e[n+1];e[n+2],e[n+3],e[n+4];var u=1,l=null,g=null;s<=20&&(l=s,u=1),12==s&&(l=100*s+c,u=2),19!=s&&20!=s||(l=s,u=2),21<=s&&s<=27&&(l=s,u=1),28==s&&(g=i.readShort(e,n+1),u=3),29<=s&&s<=31&&(l=s,u=1),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+c+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-c-108,u=2),255==s&&(g=i.readInt(e,n+1)/65535,u=5),o.push(null!=g?g:"o"+l),n+=u}return o},t.CFF.readDict=function(e,n,r){for(var a=t._bin,i={},o=[];n<r;){var s=e[n],c=e[n+1];e[n+2],e[n+3],e[n+4];var u=1,l=null,g=null;if(28==s&&(g=a.readShort(e,n+1),u=3),29==s&&(g=a.readInt(e,n+1),u=5),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+c+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-c-108,u=2),255==s)throw g=a.readInt(e,n+1)/65535,u=5,"unknown number";if(30==s){var d=[];for(u=1;;){var I=e[n+u];u++;var A=I>>4,h=15&I;if(15!=A&&d.push(A),15!=h&&d.push(h),15==h)break}for(var C="",f=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],p=0;p<d.length;p++)C+=f[d[p]];g=parseFloat(C)}s<=21&&(l=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,12==s&&(l=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],u=2)),null!=l?(i[l]=1==o.length?o[0]:o,o=[]):o.push(g),n+=u}return i},t.cmap={},t.cmap.parse=function(e,n,r){e=new Uint8Array(e.buffer,n,r),n=0;var a=t._bin,i={};a.readUshort(e,n),n+=2;var o=a.readUshort(e,n);n+=2;var s=[];i.tables=[];for(var c=0;c<o;c++){var u=a.readUshort(e,n);n+=2;var l=a.readUshort(e,n);n+=2;var g=a.readUint(e,n);n+=4;var d="p"+u+"e"+l,I=s.indexOf(g);if(-1==I){var A;I=i.tables.length,s.push(g);var h=a.readUshort(e,g);0==h?A=t.cmap.parse0(e,g):4==h?A=t.cmap.parse4(e,g):6==h?A=t.cmap.parse6(e,g):12==h?A=t.cmap.parse12(e,g):console.debug("unknown format: "+h,u,l,g),i.tables.push(A)}if(null!=i[d])throw"multiple tables for one platform+encoding";i[d]=I}return i},t.cmap.parse0=function(e,n){var r=t._bin,a={};a.format=r.readUshort(e,n),n+=2;var i=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2,a.map=[];for(var o=0;o<i-6;o++)a.map.push(e[n+o]);return a},t.cmap.parse4=function(e,n){var r=t._bin,a=n,i={};i.format=r.readUshort(e,n),n+=2;var o=r.readUshort(e,n);n+=2,r.readUshort(e,n),n+=2;var s=r.readUshort(e,n);n+=2;var c=s/2;i.searchRange=r.readUshort(e,n),n+=2,i.entrySelector=r.readUshort(e,n),n+=2,i.rangeShift=r.readUshort(e,n),n+=2,i.endCount=r.readUshorts(e,n,c),n+=2*c,n+=2,i.startCount=r.readUshorts(e,n,c),n+=2*c,i.idDelta=[];for(var u=0;u<c;u++)i.idDelta.push(r.readShort(e,n)),n+=2;for(i.idRangeOffset=r.readUshorts(e,n,c),n+=2*c,i.glyphIdArray=[];n<a+o;)i.glyphIdArray.push(r.readUshort(e,n)),n+=2;return i},t.cmap.parse6=function(e,n){var r=t._bin,a={};a.format=r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,r.readUshort(e,n),n+=2,a.firstCode=r.readUshort(e,n),n+=2;var i=r.readUshort(e,n);n+=2,a.glyphIdArray=[];for(var o=0;o<i;o++)a.glyphIdArray.push(r.readUshort(e,n)),n+=2;return a},t.cmap.parse12=function(e,n){var r=t._bin,a={};a.format=r.readUshort(e,n),n+=2,n+=2,r.readUint(e,n),n+=4,r.readUint(e,n),n+=4;var i=r.readUint(e,n);n+=4,a.groups=[];for(var o=0;o<i;o++){var s=n+12*o,c=r.readUint(e,s+0),u=r.readUint(e,s+4),l=r.readUint(e,s+8);a.groups.push([c,u,l])}return a},t.glyf={},t.glyf.parse=function(e,t,n,r){for(var a=[],i=0;i<r.maxp.numGlyphs;i++)a.push(null);return a},t.glyf._parseGlyf=function(e,n){var r=t._bin,a=e._data,i=t._tabOffset(a,"glyf",e._offset)+e.loca[n];if(e.loca[n]==e.loca[n+1])return null;var o={};if(o.noc=r.readShort(a,i),i+=2,o.xMin=r.readShort(a,i),i+=2,o.yMin=r.readShort(a,i),i+=2,o.xMax=r.readShort(a,i),i+=2,o.yMax=r.readShort(a,i),i+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var s=0;s<o.noc;s++)o.endPts.push(r.readUshort(a,i)),i+=2;var c=r.readUshort(a,i);if(i+=2,a.length-i<c)return null;o.instructions=r.readBytes(a,i,c),i+=c;var u=o.endPts[o.noc-1]+1;for(o.flags=[],s=0;s<u;s++){var l=a[i];if(i++,o.flags.push(l),0!=(8&l)){var g=a[i];i++;for(var d=0;d<g;d++)o.flags.push(l),s++}}for(o.xs=[],s=0;s<u;s++){var I=0!=(2&o.flags[s]),A=0!=(16&o.flags[s]);I?(o.xs.push(A?a[i]:-a[i]),i++):A?o.xs.push(0):(o.xs.push(r.readShort(a,i)),i+=2)}for(o.ys=[],s=0;s<u;s++)I=0!=(4&o.flags[s]),A=0!=(32&o.flags[s]),I?(o.ys.push(A?a[i]:-a[i]),i++):A?o.ys.push(0):(o.ys.push(r.readShort(a,i)),i+=2);var h=0,C=0;for(s=0;s<u;s++)h+=o.xs[s],C+=o.ys[s],o.xs[s]=h,o.ys[s]=C}else{var f;o.parts=[];do{f=r.readUshort(a,i),i+=2;var p={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(p),p.glyphIndex=r.readUshort(a,i),i+=2,1&f){var m=r.readShort(a,i);i+=2;var v=r.readShort(a,i);i+=2}else m=r.readInt8(a,i),i++,v=r.readInt8(a,i),i++;2&f?(p.m.tx=m,p.m.ty=v):(p.p1=m,p.p2=v),8&f?(p.m.a=p.m.d=r.readF2dot14(a,i),i+=2):64&f?(p.m.a=r.readF2dot14(a,i),i+=2,p.m.d=r.readF2dot14(a,i),i+=2):128&f&&(p.m.a=r.readF2dot14(a,i),i+=2,p.m.b=r.readF2dot14(a,i),i+=2,p.m.c=r.readF2dot14(a,i),i+=2,p.m.d=r.readF2dot14(a,i),i+=2)}while(32&f);if(256&f){var b=r.readUshort(a,i);for(i+=2,o.instr=[],s=0;s<b;s++)o.instr.push(a[i]),i++}}return o},t.GPOS={},t.GPOS.parse=function(e,n,r,a){return t._lctf.parse(e,n,r,a,t.GPOS.subt)},t.GPOS.subt=function(e,n,r,a){var i=t._bin,o=r,s={};if(s.fmt=i.readUshort(e,r),r+=2,1==n||2==n||3==n||7==n||8==n&&s.fmt<=2){var c=i.readUshort(e,r);r+=2,s.coverage=t._lctf.readCoverage(e,c+o)}if(1==n&&1==s.fmt){var u=i.readUshort(e,r);r+=2;var l=t._lctf.numOfOnes(u);0!=u&&(s.pos=t.GPOS.readValueRecord(e,r,u))}else if(2==n&&s.fmt>=1&&s.fmt<=2){u=i.readUshort(e,r),r+=2;var g=i.readUshort(e,r);r+=2,l=t._lctf.numOfOnes(u);var d=t._lctf.numOfOnes(g);if(1==s.fmt){s.pairsets=[];var I=i.readUshort(e,r);r+=2;for(var A=0;A<I;A++){var h=o+i.readUshort(e,r);r+=2;var C=i.readUshort(e,h);h+=2;for(var f=[],p=0;p<C;p++){var m=i.readUshort(e,h);h+=2,0!=u&&(w=t.GPOS.readValueRecord(e,h,u),h+=2*l),0!=g&&(_=t.GPOS.readValueRecord(e,h,g),h+=2*d),f.push({gid2:m,val1:w,val2:_})}s.pairsets.push(f)}}if(2==s.fmt){var v=i.readUshort(e,r);r+=2;var b=i.readUshort(e,r);r+=2;var y=i.readUshort(e,r);r+=2;var B=i.readUshort(e,r);for(r+=2,s.classDef1=t._lctf.readClassDef(e,o+v),s.classDef2=t._lctf.readClassDef(e,o+b),s.matrix=[],A=0;A<y;A++){var G=[];for(p=0;p<B;p++){var w=null,_=null;0!=u&&(w=t.GPOS.readValueRecord(e,r,u),r+=2*l),0!=g&&(_=t.GPOS.readValueRecord(e,r,g),r+=2*d),G.push({val1:w,val2:_})}s.matrix.push(G)}}}else{if(9==n&&1==s.fmt){var Z=i.readUshort(e,r);r+=2;var S=i.readUint(e,r);if(r+=4,9==a.ltype)a.ltype=Z;else if(a.ltype!=Z)throw"invalid extension substitution";return t.GPOS.subt(e,a.ltype,o+S)}console.debug("unsupported GPOS table LookupType",n,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(e,n,r){var a=t._bin,i=[];return i.push(1&r?a.readShort(e,n):0),n+=1&r?2:0,i.push(2&r?a.readShort(e,n):0),n+=2&r?2:0,i.push(4&r?a.readShort(e,n):0),n+=4&r?2:0,i.push(8&r?a.readShort(e,n):0),n+=8&r?2:0,i},t.GSUB={},t.GSUB.parse=function(e,n,r,a){return t._lctf.parse(e,n,r,a,t.GSUB.subt)},t.GSUB.subt=function(e,n,r,a){var i=t._bin,o=r,s={};if(s.fmt=i.readUshort(e,r),r+=2,1!=n&&4!=n&&5!=n&&6!=n)return null;if(1==n||4==n||5==n&&s.fmt<=2||6==n&&s.fmt<=2){var c=i.readUshort(e,r);r+=2,s.coverage=t._lctf.readCoverage(e,o+c)}if(1==n&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=i.readShort(e,r),r+=2;else if(2==s.fmt){var u=i.readUshort(e,r);r+=2,s.newg=i.readUshorts(e,r,u),r+=2*s.newg.length}}else if(4==n){s.vals=[],u=i.readUshort(e,r),r+=2;for(var l=0;l<u;l++){var g=i.readUshort(e,r);r+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+g))}}else if(5==n&&2==s.fmt){if(2==s.fmt){var d=i.readUshort(e,r);r+=2,s.cDef=t._lctf.readClassDef(e,o+d),s.scset=[];var I=i.readUshort(e,r);for(r+=2,l=0;l<I;l++){var A=i.readUshort(e,r);r+=2,s.scset.push(0==A?null:t.GSUB.readSubClassSet(e,o+A))}}}else if(6==n&&3==s.fmt){if(3==s.fmt){for(l=0;l<3;l++){u=i.readUshort(e,r),r+=2;for(var h=[],C=0;C<u;C++)h.push(t._lctf.readCoverage(e,o+i.readUshort(e,r+2*C)));r+=2*u,0==l&&(s.backCvg=h),1==l&&(s.inptCvg=h),2==l&&(s.ahedCvg=h)}u=i.readUshort(e,r),r+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,r,u)}}else{if(7==n&&1==s.fmt){var f=i.readUshort(e,r);r+=2;var p=i.readUint(e,r);if(r+=4,9==a.ltype)a.ltype=f;else if(a.ltype!=f)throw"invalid extension substitution";return t.GSUB.subt(e,a.ltype,o+p)}console.debug("unsupported GSUB table LookupType",n,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(e,n){var r=t._bin.readUshort,a=n,i=[],o=r(e,n);n+=2;for(var s=0;s<o;s++){var c=r(e,n);n+=2,i.push(t.GSUB.readSubClassRule(e,a+c))}return i},t.GSUB.readSubClassRule=function(e,n){var r=t._bin.readUshort,a={},i=r(e,n),o=r(e,n+=2);n+=2,a.input=[];for(var s=0;s<i-1;s++)a.input.push(r(e,n)),n+=2;return a.substLookupRecords=t.GSUB.readSubstLookupRecords(e,n,o),a},t.GSUB.readSubstLookupRecords=function(e,n,r){for(var a=t._bin.readUshort,i=[],o=0;o<r;o++)i.push(a(e,n),a(e,n+2)),n+=4;return i},t.GSUB.readChainSubClassSet=function(e,n){var r=t._bin,a=n,i=[],o=r.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var c=r.readUshort(e,n);n+=2,i.push(t.GSUB.readChainSubClassRule(e,a+c))}return i},t.GSUB.readChainSubClassRule=function(e,n){for(var r=t._bin,a={},i=["backtrack","input","lookahead"],o=0;o<i.length;o++){var s=r.readUshort(e,n);n+=2,1==o&&s--,a[i[o]]=r.readUshorts(e,n,s),n+=2*a[i[o]].length}return s=r.readUshort(e,n),n+=2,a.subst=r.readUshorts(e,n,2*s),n+=2*a.subst.length,a},t.GSUB.readLigatureSet=function(e,n){var r=t._bin,a=n,i=[],o=r.readUshort(e,n);n+=2;for(var s=0;s<o;s++){var c=r.readUshort(e,n);n+=2,i.push(t.GSUB.readLigature(e,a+c))}return i},t.GSUB.readLigature=function(e,n){var r=t._bin,a={chain:[]};a.nglyph=r.readUshort(e,n),n+=2;var i=r.readUshort(e,n);n+=2;for(var o=0;o<i-1;o++)a.chain.push(r.readUshort(e,n)),n+=2;return a},t.head={},t.head.parse=function(e,n,r){var a=t._bin,i={};return a.readFixed(e,n),n+=4,i.fontRevision=a.readFixed(e,n),n+=4,a.readUint(e,n),n+=4,a.readUint(e,n),n+=4,i.flags=a.readUshort(e,n),n+=2,i.unitsPerEm=a.readUshort(e,n),n+=2,i.created=a.readUint64(e,n),n+=8,i.modified=a.readUint64(e,n),n+=8,i.xMin=a.readShort(e,n),n+=2,i.yMin=a.readShort(e,n),n+=2,i.xMax=a.readShort(e,n),n+=2,i.yMax=a.readShort(e,n),n+=2,i.macStyle=a.readUshort(e,n),n+=2,i.lowestRecPPEM=a.readUshort(e,n),n+=2,i.fontDirectionHint=a.readShort(e,n),n+=2,i.indexToLocFormat=a.readShort(e,n),n+=2,i.glyphDataFormat=a.readShort(e,n),n+=2,i},t.hhea={},t.hhea.parse=function(e,n,r){var a=t._bin,i={};return a.readFixed(e,n),n+=4,i.ascender=a.readShort(e,n),n+=2,i.descender=a.readShort(e,n),n+=2,i.lineGap=a.readShort(e,n),n+=2,i.advanceWidthMax=a.readUshort(e,n),n+=2,i.minLeftSideBearing=a.readShort(e,n),n+=2,i.minRightSideBearing=a.readShort(e,n),n+=2,i.xMaxExtent=a.readShort(e,n),n+=2,i.caretSlopeRise=a.readShort(e,n),n+=2,i.caretSlopeRun=a.readShort(e,n),n+=2,i.caretOffset=a.readShort(e,n),n+=2,n+=8,i.metricDataFormat=a.readShort(e,n),n+=2,i.numberOfHMetrics=a.readUshort(e,n),n+=2,i},t.hmtx={},t.hmtx.parse=function(e,n,r,a){for(var i=t._bin,o={aWidth:[],lsBearing:[]},s=0,c=0,u=0;u<a.maxp.numGlyphs;u++)u<a.hhea.numberOfHMetrics&&(s=i.readUshort(e,n),n+=2,c=i.readShort(e,n),n+=2),o.aWidth.push(s),o.lsBearing.push(c);return o},t.kern={},t.kern.parse=function(e,n,r,a){var i=t._bin,o=i.readUshort(e,n);if(n+=2,1==o)return t.kern.parseV1(e,n-2,r,a);var s=i.readUshort(e,n);n+=2;for(var c={glyph1:[],rval:[]},u=0;u<s;u++){n+=2,r=i.readUshort(e,n),n+=2;var l=i.readUshort(e,n);n+=2;var g=l>>>8;if(0!=(g&=15))throw"unknown kern table format: "+g;n=t.kern.readFormat0(e,n,c)}return c},t.kern.parseV1=function(e,n,r,a){var i=t._bin;i.readFixed(e,n),n+=4;var o=i.readUint(e,n);n+=4;for(var s={glyph1:[],rval:[]},c=0;c<o;c++){i.readUint(e,n),n+=4;var u=i.readUshort(e,n);n+=2,i.readUshort(e,n),n+=2;var l=u>>>8;if(0!=(l&=15))throw"unknown kern table format: "+l;n=t.kern.readFormat0(e,n,s)}return s},t.kern.readFormat0=function(e,n,r){var a=t._bin,i=-1,o=a.readUshort(e,n);n+=2,a.readUshort(e,n),n+=2,a.readUshort(e,n),n+=2,a.readUshort(e,n),n+=2;for(var s=0;s<o;s++){var c=a.readUshort(e,n);n+=2;var u=a.readUshort(e,n);n+=2;var l=a.readShort(e,n);n+=2,c!=i&&(r.glyph1.push(c),r.rval.push({glyph2:[],vals:[]}));var g=r.rval[r.rval.length-1];g.glyph2.push(u),g.vals.push(l),i=c}return n},t.loca={},t.loca.parse=function(e,n,r,a){var i=t._bin,o=[],s=a.head.indexToLocFormat,c=a.maxp.numGlyphs+1;if(0==s)for(var u=0;u<c;u++)o.push(i.readUshort(e,n+(u<<1))<<1);if(1==s)for(u=0;u<c;u++)o.push(i.readUint(e,n+(u<<2)));return o},t.maxp={},t.maxp.parse=function(e,n,r){var a=t._bin,i={},o=a.readUint(e,n);return n+=4,i.numGlyphs=a.readUshort(e,n),n+=2,65536==o&&(i.maxPoints=a.readUshort(e,n),n+=2,i.maxContours=a.readUshort(e,n),n+=2,i.maxCompositePoints=a.readUshort(e,n),n+=2,i.maxCompositeContours=a.readUshort(e,n),n+=2,i.maxZones=a.readUshort(e,n),n+=2,i.maxTwilightPoints=a.readUshort(e,n),n+=2,i.maxStorage=a.readUshort(e,n),n+=2,i.maxFunctionDefs=a.readUshort(e,n),n+=2,i.maxInstructionDefs=a.readUshort(e,n),n+=2,i.maxStackElements=a.readUshort(e,n),n+=2,i.maxSizeOfInstructions=a.readUshort(e,n),n+=2,i.maxComponentElements=a.readUshort(e,n),n+=2,i.maxComponentDepth=a.readUshort(e,n),n+=2),i},t.name={},t.name.parse=function(e,n,r){var a=t._bin,i={};a.readUshort(e,n),n+=2;var o=a.readUshort(e,n);n+=2,a.readUshort(e,n);for(var s,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=n+=2,l=0;l<o;l++){var g=a.readUshort(e,n);n+=2;var d=a.readUshort(e,n);n+=2;var I=a.readUshort(e,n);n+=2;var A=a.readUshort(e,n);n+=2;var h=a.readUshort(e,n);n+=2;var C=a.readUshort(e,n);n+=2;var f,p=c[A],m=u+12*o+C;if(0==g)f=a.readUnicode(e,m,h/2);else if(3==g&&0==d)f=a.readUnicode(e,m,h/2);else if(0==d)f=a.readASCII(e,m,h);else if(1==d)f=a.readUnicode(e,m,h/2);else if(3==d)f=a.readUnicode(e,m,h/2);else{if(1!=g)throw"unknown encoding "+d+", platformID: "+g;f=a.readASCII(e,m,h),console.debug("reading unknown MAC encoding "+d+" as ASCII")}var v="p"+g+","+I.toString(16);null==i[v]&&(i[v]={}),i[v][void 0!==p?p:A]=f,i[v]._lang=I}for(var b in i)if(null!=i[b].postScriptName&&1033==i[b]._lang)return i[b];for(var b in i)if(null!=i[b].postScriptName&&0==i[b]._lang)return i[b];for(var b in i)if(null!=i[b].postScriptName&&3084==i[b]._lang)return i[b];for(var b in i)if(null!=i[b].postScriptName)return i[b];for(var b in i){s=b;break}return console.debug("returning name table with languageID "+i[s]._lang),i[s]},t["OS/2"]={},t["OS/2"].parse=function(e,n,r){var a=t._bin.readUshort(e,n);n+=2;var i={};if(0==a)t["OS/2"].version0(e,n,i);else if(1==a)t["OS/2"].version1(e,n,i);else if(2==a||3==a||4==a)t["OS/2"].version2(e,n,i);else{if(5!=a)throw"unknown OS/2 table version: "+a;t["OS/2"].version5(e,n,i)}return i},t["OS/2"].version0=function(e,n,r){var a=t._bin;return r.xAvgCharWidth=a.readShort(e,n),n+=2,r.usWeightClass=a.readUshort(e,n),n+=2,r.usWidthClass=a.readUshort(e,n),n+=2,r.fsType=a.readUshort(e,n),n+=2,r.ySubscriptXSize=a.readShort(e,n),n+=2,r.ySubscriptYSize=a.readShort(e,n),n+=2,r.ySubscriptXOffset=a.readShort(e,n),n+=2,r.ySubscriptYOffset=a.readShort(e,n),n+=2,r.ySuperscriptXSize=a.readShort(e,n),n+=2,r.ySuperscriptYSize=a.readShort(e,n),n+=2,r.ySuperscriptXOffset=a.readShort(e,n),n+=2,r.ySuperscriptYOffset=a.readShort(e,n),n+=2,r.yStrikeoutSize=a.readShort(e,n),n+=2,r.yStrikeoutPosition=a.readShort(e,n),n+=2,r.sFamilyClass=a.readShort(e,n),n+=2,r.panose=a.readBytes(e,n,10),n+=10,r.ulUnicodeRange1=a.readUint(e,n),n+=4,r.ulUnicodeRange2=a.readUint(e,n),n+=4,r.ulUnicodeRange3=a.readUint(e,n),n+=4,r.ulUnicodeRange4=a.readUint(e,n),n+=4,r.achVendID=[a.readInt8(e,n),a.readInt8(e,n+1),a.readInt8(e,n+2),a.readInt8(e,n+3)],n+=4,r.fsSelection=a.readUshort(e,n),n+=2,r.usFirstCharIndex=a.readUshort(e,n),n+=2,r.usLastCharIndex=a.readUshort(e,n),n+=2,r.sTypoAscender=a.readShort(e,n),n+=2,r.sTypoDescender=a.readShort(e,n),n+=2,r.sTypoLineGap=a.readShort(e,n),n+=2,r.usWinAscent=a.readUshort(e,n),n+=2,r.usWinDescent=a.readUshort(e,n),n+2},t["OS/2"].version1=function(e,n,r){var a=t._bin;return n=t["OS/2"].version0(e,n,r),r.ulCodePageRange1=a.readUint(e,n),n+=4,r.ulCodePageRange2=a.readUint(e,n),n+4},t["OS/2"].version2=function(e,n,r){var a=t._bin;return n=t["OS/2"].version1(e,n,r),r.sxHeight=a.readShort(e,n),n+=2,r.sCapHeight=a.readShort(e,n),n+=2,r.usDefault=a.readUshort(e,n),n+=2,r.usBreak=a.readUshort(e,n),n+=2,r.usMaxContext=a.readUshort(e,n),n+2},t["OS/2"].version5=function(e,n,r){var a=t._bin;return n=t["OS/2"].version2(e,n,r),r.usLowerOpticalPointSize=a.readUshort(e,n),n+=2,r.usUpperOpticalPointSize=a.readUshort(e,n),n+2},t.post={},t.post.parse=function(e,n,r){var a=t._bin,i={};return i.version=a.readFixed(e,n),n+=4,i.italicAngle=a.readFixed(e,n),n+=4,i.underlinePosition=a.readShort(e,n),n+=2,i.underlineThickness=a.readShort(e,n),n+=2,i},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var n=e.cmap,r=-1;if(null!=n.p0e4?r=n.p0e4:null!=n.p3e1?r=n.p3e1:null!=n.p1e0?r=n.p1e0:null!=n.p0e3&&(r=n.p0e3),-1==r)throw"no familiar platform and encoding!";var a=n.tables[r];if(0==a.format)return t>=a.map.length?0:a.map[t];if(4==a.format){for(var i=-1,o=0;o<a.endCount.length;o++)if(t<=a.endCount[o]){i=o;break}return-1==i||a.startCount[i]>t?0:65535&(0!=a.idRangeOffset[i]?a.glyphIdArray[t-a.startCount[i]+(a.idRangeOffset[i]>>1)-(a.idRangeOffset.length-i)]:t+a.idDelta[i])}if(12==a.format){if(t>a.groups[a.groups.length-1][1])return 0;for(o=0;o<a.groups.length;o++){var s=a.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(e,n){var r={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[n]){var a=e.SVG.entries[n];return null==a?r:("string"==typeof a&&(a=t.SVG.toPath(a),e.SVG.entries[n]=a),a)}if(e.CFF){var i={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var c=0;o.FDSelect[c+2]<=n;)c+=2;s=o.FDArray[o.FDSelect[c+1]].Private}t.U._drawCFF(e.CFF.CharStrings[n],i,o,s,r)}else e.glyf&&t.U._drawGlyf(n,e,r);return r},t.U._drawGlyf=function(e,n,r){var a=n.glyf[e];null==a&&(a=n.glyf[e]=t.glyf._parseGlyf(n,e)),null!=a&&(a.noc>-1?t.U._simpleGlyph(a,r):t.U._compoGlyph(a,n,r))},t.U._simpleGlyph=function(e,n){for(var r=0;r<e.noc;r++){for(var a=0==r?0:e.endPts[r-1]+1,i=e.endPts[r],o=a;o<=i;o++){var s=o==a?i:o-1,c=o==i?a:o+1,u=1&e.flags[o],l=1&e.flags[s],g=1&e.flags[c],d=e.xs[o],I=e.ys[o];if(o==a)if(u){if(!l){t.U.P.moveTo(n,d,I);continue}t.U.P.moveTo(n,e.xs[s],e.ys[s])}else l?t.U.P.moveTo(n,e.xs[s],e.ys[s]):t.U.P.moveTo(n,(e.xs[s]+d)/2,(e.ys[s]+I)/2);u?l&&t.U.P.lineTo(n,d,I):g?t.U.P.qcurveTo(n,d,I,e.xs[c],e.ys[c]):t.U.P.qcurveTo(n,d,I,(d+e.xs[c])/2,(I+e.ys[c])/2)}t.U.P.closePath(n)}},t.U._compoGlyph=function(e,n,r){for(var a=0;a<e.parts.length;a++){var i={cmds:[],crds:[]},o=e.parts[a];t.U._drawGlyf(o.glyphIndex,n,i);for(var s=o.m,c=0;c<i.crds.length;c+=2){var u=i.crds[c],l=i.crds[c+1];r.crds.push(u*s.a+l*s.b+s.tx),r.crds.push(u*s.c+l*s.d+s.ty)}for(c=0;c<i.cmds.length;c++)r.cmds.push(i.cmds[c])}},t.U._getGlyphClass=function(e,n){var r=t._lctf.getInterval(n,e);return-1==r?0:n[r+2]},t.U.getPairAdjustment=function(e,n,r){var a=0,i=!1;if(e.GPOS)for(var o=e.GPOS,s=o.lookupList,c=o.featureList,u=[],l=0;l<c.length;l++){var g=c[l];if("kern"==g.tag){i=!0;for(var d=0;d<g.tab.length;d++)if(!u[g.tab[d]]){u[g.tab[d]]=!0;for(var I=s[g.tab[d]],A=0;A<I.tabs.length;A++)if(null!=I.tabs[A]){var h,C=I.tabs[A];if(!C.coverage||-1!=(h=t._lctf.coverageIndex(C.coverage,n)))if(1==I.ltype);else if(2==I.ltype){var f;if(1==C.fmt){var p=C.pairsets[h];for(l=0;l<p.length;l++)p[l].gid2==r&&(f=p[l])}else if(2==C.fmt){var m=t.U._getGlyphClass(n,C.classDef1),v=t.U._getGlyphClass(r,C.classDef2);f=C.matrix[m][v]}f&&f.val1&&f.val1[2]&&(a+=f.val1[2]),f&&f.val2&&f.val2[0]&&(a+=f.val2[0])}}}}}if(e.kern&&!i){var b=e.kern.glyph1.indexOf(n);if(-1!=b){var y=e.kern.rval[b].glyph2.indexOf(r);-1!=y&&(a+=e.kern.rval[b].vals[y])}}return a},t.U._applySubs=function(e,n,r,a){for(var i=e.length-n-1,o=0;o<r.tabs.length;o++)if(null!=r.tabs[o]){var s,c=r.tabs[o];if(!c.coverage||-1!=(s=t._lctf.coverageIndex(c.coverage,e[n])))if(1==r.ltype)e[n],1==c.fmt?e[n]=e[n]+c.delta:e[n]=c.newg[s];else if(4==r.ltype)for(var u=c.vals[s],l=0;l<u.length;l++){var g=u[l],d=g.chain.length;if(!(d>i)){for(var I=!0,A=0,h=0;h<d;h++){for(;-1==e[n+A+(1+h)];)A++;g.chain[h]!=e[n+A+(1+h)]&&(I=!1)}if(I){for(e[n]=g.nglyph,h=0;h<d+A;h++)e[n+h+1]=-1;break}}}else if(5==r.ltype&&2==c.fmt)for(var C=t._lctf.getInterval(c.cDef,e[n]),f=c.cDef[C+2],p=c.scset[f],m=0;m<p.length;m++){var v=p[m],b=v.input;if(!(b.length>i)){for(I=!0,h=0;h<b.length;h++){var y=t._lctf.getInterval(c.cDef,e[n+1+h]);if(-1==C&&c.cDef[y+2]!=b[h]){I=!1;break}}if(I){var B=v.substLookupRecords;for(l=0;l<B.length;l+=2)B[l],B[l+1]}}}else if(6==r.ltype&&3==c.fmt){if(!t.U._glsCovered(e,c.backCvg,n-c.backCvg.length))continue;if(!t.U._glsCovered(e,c.inptCvg,n))continue;if(!t.U._glsCovered(e,c.ahedCvg,n+c.inptCvg.length))continue;var G=c.lookupRec;for(m=0;m<G.length;m+=2){C=G[m];var w=a[G[m+1]];t.U._applySubs(e,n+C,w,a)}}}},t.U._glsCovered=function(e,n,r){for(var a=0;a<n.length;a++)if(-1==t._lctf.coverageIndex(n[a],e[r+a]))return!1;return!0},t.U.glyphsToPath=function(e,n,r){for(var a={cmds:[],crds:[]},i=0,o=0;o<n.length;o++){var s=n[o];if(-1!=s){for(var c=o<n.length-1&&-1!=n[o+1]?n[o+1]:0,u=t.U.glyphToPath(e,s),l=0;l<u.crds.length;l+=2)a.crds.push(u.crds[l]+i),a.crds.push(u.crds[l+1]);for(r&&a.cmds.push(r),l=0;l<u.cmds.length;l++)a.cmds.push(u.cmds[l]);r&&a.cmds.push("X"),i+=e.hmtx.aWidth[s],o<n.length-1&&(i+=t.U.getPairAdjustment(e,s,c))}}return a},t.U.P={},t.U.P.moveTo=function(e,t,n){e.cmds.push("M"),e.crds.push(t,n)},t.U.P.lineTo=function(e,t,n){e.cmds.push("L"),e.crds.push(t,n)},t.U.P.curveTo=function(e,t,n,r,a,i,o){e.cmds.push("C"),e.crds.push(t,n,r,a,i,o)},t.U.P.qcurveTo=function(e,t,n,r,a){e.cmds.push("Q"),e.crds.push(t,n,r,a)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,n,r,a,i){for(var o=n.stack,s=n.nStems,c=n.haveWidth,u=n.width,l=n.open,g=0,d=n.x,I=n.y,A=0,h=0,C=0,f=0,p=0,m=0,v=0,b=0,y=0,B=0,G={val:0,size:0};g<e.length;){t.CFF.getCharString(e,g,G);var w=G.val;if(g+=G.size,"o1"==w||"o18"==w)o.length%2!=0&&!c&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,c=!0;else if("o3"==w||"o23"==w)o.length%2!=0&&!c&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,c=!0;else if("o4"==w)o.length>1&&!c&&(u=o.shift()+a.nominalWidthX,c=!0),l&&t.U.P.closePath(i),I+=o.pop(),t.U.P.moveTo(i,d,I),l=!0;else if("o5"==w)for(;o.length>0;)d+=o.shift(),I+=o.shift(),t.U.P.lineTo(i,d,I);else if("o6"==w||"o7"==w)for(var _=o.length,Z="o6"==w,S=0;S<_;S++){var x=o.shift();Z?d+=x:I+=x,Z=!Z,t.U.P.lineTo(i,d,I)}else if("o8"==w||"o24"==w){_=o.length;for(var R=0;R+6<=_;)A=d+o.shift(),h=I+o.shift(),C=A+o.shift(),f=h+o.shift(),d=C+o.shift(),I=f+o.shift(),t.U.P.curveTo(i,A,h,C,f,d,I),R+=6;"o24"==w&&(d+=o.shift(),I+=o.shift(),t.U.P.lineTo(i,d,I))}else{if("o11"==w)break;if("o1234"==w||"o1235"==w||"o1236"==w||"o1237"==w)"o1234"==w&&(h=I,C=(A=d+o.shift())+o.shift(),B=f=h+o.shift(),m=f,b=I,d=(v=(p=(y=C+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(i,A,h,C,f,y,B),t.U.P.curveTo(i,p,m,v,b,d,I)),"o1235"==w&&(A=d+o.shift(),h=I+o.shift(),C=A+o.shift(),f=h+o.shift(),y=C+o.shift(),B=f+o.shift(),p=y+o.shift(),m=B+o.shift(),v=p+o.shift(),b=m+o.shift(),d=v+o.shift(),I=b+o.shift(),o.shift(),t.U.P.curveTo(i,A,h,C,f,y,B),t.U.P.curveTo(i,p,m,v,b,d,I)),"o1236"==w&&(A=d+o.shift(),h=I+o.shift(),C=A+o.shift(),B=f=h+o.shift(),m=f,v=(p=(y=C+o.shift())+o.shift())+o.shift(),b=m+o.shift(),d=v+o.shift(),t.U.P.curveTo(i,A,h,C,f,y,B),t.U.P.curveTo(i,p,m,v,b,d,I)),"o1237"==w&&(A=d+o.shift(),h=I+o.shift(),C=A+o.shift(),f=h+o.shift(),y=C+o.shift(),B=f+o.shift(),p=y+o.shift(),m=B+o.shift(),v=p+o.shift(),b=m+o.shift(),Math.abs(v-d)>Math.abs(b-I)?d=v+o.shift():I=b+o.shift(),t.U.P.curveTo(i,A,h,C,f,y,B),t.U.P.curveTo(i,p,m,v,b,d,I));else if("o14"==w){if(o.length>0&&!c&&(u=o.shift()+r.nominalWidthX,c=!0),4==o.length){var M=o.shift(),k=o.shift(),E=o.shift(),W=o.shift(),V=t.CFF.glyphBySE(r,E),F=t.CFF.glyphBySE(r,W);t.U._drawCFF(r.CharStrings[V],n,r,a,i),n.x=M,n.y=k,t.U._drawCFF(r.CharStrings[F],n,r,a,i)}l&&(t.U.P.closePath(i),l=!1)}else if("o19"==w||"o20"==w)o.length%2!=0&&!c&&(u=o.shift()+a.nominalWidthX),s+=o.length>>1,o.length=0,c=!0,g+=s+7>>3;else if("o21"==w)o.length>2&&!c&&(u=o.shift()+a.nominalWidthX,c=!0),I+=o.pop(),d+=o.pop(),l&&t.U.P.closePath(i),t.U.P.moveTo(i,d,I),l=!0;else if("o22"==w)o.length>1&&!c&&(u=o.shift()+a.nominalWidthX,c=!0),d+=o.pop(),l&&t.U.P.closePath(i),t.U.P.moveTo(i,d,I),l=!0;else if("o25"==w){for(;o.length>6;)d+=o.shift(),I+=o.shift(),t.U.P.lineTo(i,d,I);A=d+o.shift(),h=I+o.shift(),C=A+o.shift(),f=h+o.shift(),d=C+o.shift(),I=f+o.shift(),t.U.P.curveTo(i,A,h,C,f,d,I)}else if("o26"==w)for(o.length%2&&(d+=o.shift());o.length>0;)A=d,h=I+o.shift(),d=C=A+o.shift(),I=(f=h+o.shift())+o.shift(),t.U.P.curveTo(i,A,h,C,f,d,I);else if("o27"==w)for(o.length%2&&(I+=o.shift());o.length>0;)h=I,C=(A=d+o.shift())+o.shift(),f=h+o.shift(),d=C+o.shift(),I=f,t.U.P.curveTo(i,A,h,C,f,d,I);else if("o10"==w||"o29"==w){var X="o10"==w?a:r;if(0==o.length)console.debug("error: empty stack");else{var H=o.pop(),O=X.Subrs[H+X.Bias];n.x=d,n.y=I,n.nStems=s,n.haveWidth=c,n.width=u,n.open=l,t.U._drawCFF(O,n,r,a,i),d=n.x,I=n.y,s=n.nStems,c=n.haveWidth,u=n.width,l=n.open}}else if("o30"==w||"o31"==w){var L=o.length,N=(R=0,"o31"==w);for(R+=L-(_=-3&L);R<_;)N?(h=I,C=(A=d+o.shift())+o.shift(),I=(f=h+o.shift())+o.shift(),_-R==5?(d=C+o.shift(),R++):d=C,N=!1):(A=d,h=I+o.shift(),C=A+o.shift(),f=h+o.shift(),d=C+o.shift(),_-R==5?(I=f+o.shift(),R++):I=f,N=!0),t.U.P.curveTo(i,A,h,C,f,d,I),R+=4}else{if("o"==(w+"").charAt(0))throw console.debug("Unknown operation: "+w,e),w;o.push(w)}}}n.x=d,n.y=I,n.nStems=s,n.haveWidth=c,n.width=u,n.open=l};var n=t,r={Typr:n};return e.Typr=n,e.default=r,Object.defineProperty(e,"__esModule",{value:!0}),e}({}).Typr},function(){return function(e){var t=Uint8Array,n=Uint16Array,r=Uint32Array,a=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var a=new n(31),i=0;i<31;++i)a[i]=t+=1<<e[i-1];var o=new r(a[30]);for(i=1;i<30;++i)for(var s=a[i];s<a[i+1];++s)o[s]=s-a[i]<<5|i;return[a,o]},c=s(a,2),u=c[0],l=c[1];u[28]=258,l[258]=28;for(var g=s(i,0)[0],d=new n(32768),I=0;I<32768;++I){var A=(43690&I)>>>1|(21845&I)<<1;A=(61680&(A=(52428&A)>>>2|(13107&A)<<2))>>>4|(3855&A)<<4,d[I]=((65280&A)>>>8|(255&A)<<8)>>>1}var h=function(e,t,r){for(var a=e.length,i=0,o=new n(t);i<a;++i)++o[e[i]-1];var s,c=new n(t);for(i=0;i<t;++i)c[i]=c[i-1]+o[i-1]<<1;if(r){s=new n(1<<t);var u=15-t;for(i=0;i<a;++i)if(e[i])for(var l=i<<4|e[i],g=t-e[i],I=c[e[i]-1]++<<g,A=I|(1<<g)-1;I<=A;++I)s[d[I]>>>u]=l}else for(s=new n(a),i=0;i<a;++i)e[i]&&(s[i]=d[c[e[i]-1]++]>>>15-e[i]);return s},C=new t(288);for(I=0;I<144;++I)C[I]=8;for(I=144;I<256;++I)C[I]=9;for(I=256;I<280;++I)C[I]=7;for(I=280;I<288;++I)C[I]=8;var f=new t(32);for(I=0;I<32;++I)f[I]=5;var p=h(C,9,1),m=h(f,5,1),v=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},b=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},y=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},B=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],G=function e(t,n,r){var a=new Error(n||B[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,e),!r)throw a;return a},w=function(e,s,c){var l=e.length;if(!l||c&&!c.l&&l<5)return s||new t(0);var d=!s||c,I=!c||c.i;c||(c={}),s||(s=new t(3*l));var A,C=function(e){var n=s.length;if(e>n){var r=new t(Math.max(2*n,e));r.set(s),s=r}},f=c.f||0,B=c.p||0,w=c.b||0,_=c.l,Z=c.d,S=c.m,x=c.n,R=8*l;do{if(!_){c.f=f=b(e,B,1);var M=b(e,B+1,3);if(B+=3,!M){var k=e[(T=((A=B)/8|0)+(7&A&&1)+4)-4]|e[T-3]<<8,E=T+k;if(E>l){I&&G(0);break}d&&C(w+k),s.set(e.subarray(T,E),w),c.b=w+=k,c.p=B=8*E;continue}if(1==M)_=p,Z=m,S=9,x=5;else if(2==M){var W=b(e,B,31)+257,V=b(e,B+10,15)+4,F=W+b(e,B+5,31)+1;B+=14;for(var X=new t(F),H=new t(19),O=0;O<V;++O)H[o[O]]=b(e,B+3*O,7);B+=3*V;var L=v(H),N=(1<<L)-1,Y=h(H,L,1);for(O=0;O<F;){var T,z=Y[b(e,B,N)];if(B+=15&z,(T=z>>>4)<16)X[O++]=T;else{var K=0,j=0;for(16==T?(j=3+b(e,B,3),B+=2,K=X[O-1]):17==T?(j=3+b(e,B,7),B+=3):18==T&&(j=11+b(e,B,127),B+=7);j--;)X[O++]=K}}var D=X.subarray(0,W),U=X.subarray(W);S=v(D),x=v(U),_=h(D,S,1),Z=h(U,x,1)}else G(1);if(B>R){I&&G(0);break}}d&&C(w+131072);for(var Q=(1<<S)-1,P=(1<<x)-1,J=B;;J=B){var q=(K=_[y(e,B)&Q])>>>4;if((B+=15&K)>R){I&&G(0);break}if(K||G(2),q<256)s[w++]=q;else{if(256==q){J=B,_=null;break}var $=q-254;if(q>264){var ee=a[O=q-257];$=b(e,B,(1<<ee)-1)+u[O],B+=ee}var te=Z[y(e,B)&P],ne=te>>>4;if(te||G(3),B+=15&te,U=g[ne],ne>3&&(ee=i[ne],U+=y(e,B)&(1<<ee)-1,B+=ee),B>R){I&&G(0);break}d&&C(w+131072);for(var re=w+$;w<re;w+=4)s[w]=s[w-U],s[w+1]=s[w+1-U],s[w+2]=s[w+2-U],s[w+3]=s[w+3-U];w=re}}c.l=_,c.p=J,c.b=w,_&&(f=1,c.m=S,c.d=Z,c.n=x)}while(!f);return w==s.length?s:function(e,a,i){(null==a||a<0)&&(a=0),(null==i||i>e.length)&&(i=e.length);var o=new(e instanceof n?n:e instanceof r?r:t)(i-a);return o.set(e.subarray(a,i)),o}(s,0,w)},_=new t(0),Z="undefined"!=typeof TextDecoder&&new TextDecoder;try{Z.decode(_,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),n=0;function r(){var e=t.getUint16(n);return n+=2,e}function a(){var e=t.getUint32(n);return n+=4,e}function i(e){f.setUint16(p,e),p+=2}function o(e){f.setUint32(p,e),p+=4}for(var s={signature:a(),flavor:a(),length:a(),numTables:r(),reserved:r(),totalSfntSize:a(),majorVersion:r(),minorVersion:r(),metaOffset:a(),metaLength:a(),metaOrigLength:a(),privOffset:a(),privLength:a()},c=0;Math.pow(2,c)<=s.numTables;)c++;c--;for(var u=16*Math.pow(2,c),l=16*s.numTables-u,g=12,d=[],I=0;I<s.numTables;I++)d.push({tag:a(),offset:a(),compLength:a(),origLength:a(),origChecksum:a()}),g+=16;var A,h=new Uint8Array(12+16*d.length+d.reduce((function(e,t){return e+t.origLength+4}),0)),C=h.buffer,f=new DataView(C),p=0;return o(s.flavor),i(s.numTables),i(u),i(c),i(l),d.forEach((function(e){o(e.tag),o(e.origChecksum),o(g),o(e.origLength),e.outOffset=g,(g+=e.origLength)%4!=0&&(g+=4-g%4)})),d.forEach((function(t){var n,r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var a=new Uint8Array(t.origLength);n=new Uint8Array(r,2),w(n,a)}else a=new Uint8Array(r);h.set(a,t.outOffset);var i=0;(g=t.outOffset+t.origLength)%4!=0&&(i=4-g%4),h.set(new Uint8Array(i).buffer,t.outOffset+t.origLength),A=g+i})),C.slice(0,A)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){var n,r={M:2,L:2,Q:4,C:6,Z:0},a={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=[null,"isol","init","fina","medi"];function o(e){for(var t,r=new Uint8Array(e.length),i=32,o=1,s=-1,c=0;c<e.length;c++){var u=e.codePointAt(c),g=0|(t=u,n||function(){var e={R:2,L:1,D:4,C:16,U:32,T:8};n=new Map;var t=function(t){var r=0;a[t].split(",").forEach((function(a){var i=a.split("+"),o=Object(l.a)(i,2),s=o[0],c=o[1];s=parseInt(s,36),c=c?parseInt(c,36):0,n.set(r+=s,e[t]);for(var u=c;u--;)n.set(++r,e[t])}))};for(var r in a)t(r)}(),n.get(t)||32),d=1;8&g||(21&i?22&g?(d=3,1!==o&&3!==o||r[s]++):33&g&&(2!==o&&4!==o||r[s]--):34&i&&(2!==o&&4!==o||r[s]--),o=r[c]=d,i=g,s=c,u>65535&&c++)}return r}function s(t){var n=Object.create(null),a={unitsPerEm:t.head.unitsPerEm,ascender:t.hhea.ascender,descender:t.hhea.descender,forEachGlyph:function(s,c,u,l){var g=0,d=1/a.unitsPerEm*c,I=function(t,n){for(var r=[],a=0;a<n.length;a++){var s=n.codePointAt(a);s>65535&&a++,r.push(e.U.codeToGlyph(t,s))}var c=t.GSUB;if(c){var u,l=c.lookupList,g=c.featureList,d=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,I=[];g.forEach((function(t){if(d.test(t.tag))for(var a=0;a<t.tab.length;a++)if(!I[t.tab[a]]){I[t.tab[a]]=!0;var s=l[t.tab[a]],c=/^(isol|init|fina|medi)$/.test(t.tag);c&&!u&&(u=o(n));for(var g=0;g<r.length;g++)u&&c&&i[u[g]]!==t.tag||e.U._applySubs(r,g,s,l)}}))}return r}(t,s),A=0,h=-1;return I.forEach((function(a,i){if(-1!==a){var o=n[a];if(!o){for(var I,C,f,p,m=e.U.glyphToPath(t,a),v=m.cmds,b=m.crds,y="",B=0,G=0,w=v.length;G<w;G++){var _=r[v[G]];y+=v[G];for(var Z=1;Z<=_;Z++)y+=(Z>1?",":"")+b[B++]}if(b.length){I=C=1/0,f=p=-1/0;for(var S=0,x=b.length;S<x;S+=2){var R=b[S],M=b[S+1];R<I&&(I=R),M<C&&(C=M),R>f&&(f=R),M>p&&(p=M)}}else I=f=C=p=0;o=n[a]={index:a,advanceWidth:t.hmtx.aWidth[a],xMin:I,yMin:C,xMax:f,yMax:p,path:y,pathCommandCount:v.length}}-1!==h&&(g+=e.U.getPairAdjustment(t,h,a)*d),l.call(null,o,g,A),o.advanceWidth&&(g+=o.advanceWidth*d),u&&(g+=u*c),h=a}A+=s.codePointAt(A)>65535?2:1})),g}};return a}return function(n){var r=new Uint8Array(n,0,4),a=e._bin.readASCII(r,0,4);if("wOFF"===a)n=t(n);else if("wOF2"===a)throw new Error("woff2 fonts not supported");return s(e.parse(n)[0])}}],init:function(e,t,n){return n(e(),t())}}),He={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Oe=new g.Color;function Le(){return(self.performance||Date).now()}var Ne,Ye=Object.create(null);function Te(e,t){!0,e=Ke({},e);var n=Le();if(e.font=function(e){Ne||(Ne="undefined"===typeof document?{}:document.createElement("a"));return Ne.href=e,Ne.href}(e.font||He.defaultFontURL),e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||He.sdfGlyphSize,null!=e.colorRanges){var r={};for(var a in e.colorRanges)if(e.colorRanges.hasOwnProperty(a)){var i=e.colorRanges[a];"number"!==typeof i&&(i=Oe.set(i).getHex()),r[a]=i}e.colorRanges=r}Object.freeze(e);var o=He.textureWidth,s=He.sdfExponent,c=e.sdfGlyphSize,u=o/c*4,d=Ye[c];if(!d){var I=document.createElement("canvas");I.width=o,I.height=256*c/u,function(e){var t=e.sdfTexture.image;t.addEventListener("webglcontextlost",(function(t){console.log("Context Lost",t),t.preventDefault(),e.contextLost=!0})),t.addEventListener("webglcontextrestored",(function(t){console.log("Context Restored",t),e.contextLost=!1;var n=[];e.glyphsByFont.forEach((function(t){t.forEach((function(t){n.push(ze(t,e,!0))}))})),de.a.all(n).then((function(){e.sdfTexture.needsUpdate=!0}))}))}(d=Ye[c]={glyphCount:0,sdfGlyphSize:c,sdfTexture:new g.CanvasTexture(I,void 0,void 0,void 0,g.LinearFilter,g.LinearFilter),contextLost:!1,glyphsByFont:new Map})}var A=d.sdfTexture,h=d.glyphsByFont.get(e.font);h||d.glyphsByFont.set(e.font,h=new Map),De(e).then((function(r){var a=r.glyphIds,i=r.glyphPositions,g=r.fontSize,I=r.unitsPerEm,C=r.timings,f=[],p=new Float32Array(4*a.length),m=g/I,v=0,b=0,y=Le();a.forEach((function(e,t){var n=h.get(e);if(!n){var o=r.glyphData[e],s=o.path,u=o.pathBounds,l=Math.max(u[2]-u[0],u[3]-u[1])/c*(He.sdfMargin*c+.5),g=d.glyphCount++,I=[u[0]-l,u[1]-l,u[2]+l,u[3]+l];h.set(e,n={path:s,atlasIndex:g,sdfViewBox:I}),f.push(n)}var A=n.sdfViewBox,C=i[b++],y=i[b++];p[v++]=C+A[0]*m,p[v++]=y+A[1]*m,p[v++]=C+A[2]*m,p[v++]=y+A[3]*m,a[t]=n.atlasIndex})),C.quads=(C.quads||0)+(Le()-y);var B=Le();C.sdf={};var G=A.image.height,w=Math.ceil(d.glyphCount/u),_=Math.pow(2,Math.ceil(Math.log2(w*c)));_>G&&(console.info("Increasing SDF texture size ".concat(G,"->").concat(_)),Fe(A.image,o,_),A.dispose()),de.a.all(f.map((function(t){return ze(t,d,e.gpuAccelerateSDF).then((function(e){var n=e.timing;C.sdf[t.atlasIndex]=n}))}))).then((function(){C.sdfTotal=Le()-B,C.total=Le()-n,f.length&&!d.contextLost&&(A.needsUpdate=!0),t(Object.freeze({parameters:e,sdfTexture:A,sdfGlyphSize:c,sdfExponent:s,glyphBounds:p,glyphAtlasIndices:a,glyphColors:r.glyphColors,caretPositions:r.caretPositions,caretHeight:r.caretHeight,chunkedBounds:r.chunkedBounds,ascender:r.ascender,descender:r.descender,lineHeight:r.lineHeight,topBaseline:r.topBaseline,blockBounds:r.blockBounds,visibleBounds:r.visibleBounds,timings:r.timings,get totalBounds(){return console.log("totalBounds deprecated, use blockBounds instead"),r.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");var e=Object(l.a)(r.blockBounds,4),t=e[0],n=e[1];return[e[2]-t,e[3]-n]}}))}))})),de.a.all([]).then((function(){d.contextLost||function(e){e._warm||(Ee.webgl.isSupported(e),e._warm=!0)}(A.image)}))}function ze(e,t,n){var r=e.path,a=e.atlasIndex,i=e.sdfViewBox,o=t.sdfGlyphSize,s=t.sdfTexture;if(t.contextLost)return Promise.resolve({timing:-1});var c=He.textureWidth,u=He.sdfExponent,l=Math.max(i[2]-i[0],i[3]-i[1]),g=Math.floor(a/4),d=g%(c/o)*o,I=Math.floor(g/(c/o))*o,A=a%4;return function(e,t,n,r,a,i,o,s,c,u){return arguments.length>10&&void 0!==arguments[10]&&!arguments[10]?Ve(e,t,n,r,a,i,o,s,c,u):We(e,t,n,r,a,i,o,s,c,u).then(null,(function(l){return Me||(console.warn("WebGL SDF generation failed, falling back to JS",l),Me=!0),Ve(e,t,n,r,a,i,o,s,c,u)}))}(o,o,r,i,l,u,s.image,d,I,A,n)}function Ke(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var je=Object(de.c)({name:"Typesetter",dependencies:[He,Xe,function(e,t,n){var r=n.defaultFontURL,a=Object.create(null),i=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s=/[\s\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/;function c(t,n){t||(t=r);var i=a[t];i?i.pending?i.pending.push(n):n(i):(a[t]={pending:[n]},function(t,n){!function a(){var i=function(e){console.error("Failure loading font ".concat(t).concat(t===r?"":"; trying fallback"),e),t!==r&&(t=r,a())};try{var o=new XMLHttpRequest;o.open("get",t,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)i(new Error(o.statusText));else if(o.status>0)try{var t=e(o.response);n(t)}catch(r){i(r)}},o.onerror=i,o.send()}catch(s){i(s)}}()}(t,(function(e){var n=a[t].pending;a[t]=e,n.forEach((function(t){return t(e)}))})))}function u(e,n){var a=e.text,u=void 0===a?"":a,h=e.font,C=void 0===h?r:h,f=(e.sdfGlyphSize,e.fontSize),p=void 0===f?1:f,m=e.letterSpacing,v=void 0===m?0:m,b=e.lineHeight,y=void 0===b?"normal":b,B=e.maxWidth,G=void 0===B?i:B,w=e.direction,_=e.textAlign,Z=void 0===_?"left":_,S=e.textIndent,x=void 0===S?0:S,R=e.whiteSpace,M=void 0===R?"normal":R,k=e.overflowWrap,E=void 0===k?"normal":k,W=e.anchorX,V=void 0===W?0:W,F=e.anchorY,X=void 0===F?0:F,H=e.includeCaretPositions,O=void 0!==H&&H,L=e.chunkedBoundsSize,N=void 0===L?8192:L,Y=e.colorRanges,T=void 0===Y?null:Y,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],K=I(),j={fontLoad:0,typesetting:0};u.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),u=u.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),p=+p,v=+v,G=+G,y=y||"normal",x=+x,c(C,(function(e){var r=isFinite(G),a=null,c=null,h=null,C=null,f=null,m=null,b=null,B=0,_=0,S="nowrap"!==M,R=e.ascender,k=e.descender,W=e.unitsPerEm;j.fontLoad=I()-K;var F=I(),H=p/W;"normal"===y&&(y=(R-k)/W);var L=((y*=p)-(R-k)*H)/2,Y=-(R*H+L),D=Math.min(y,(R-k)*H),U=(R+k)/2*H-D/2,Q=x,P=new A,J=[P];e.forEachGlyph(u,p,v,(function(e,t,n){var a,i=u.charAt(n),c=e.advanceWidth*H,l=P.count;if("isEmpty"in e||(e.isWhitespace=!!i&&/\s/.test(i),e.canBreakAfter=!!i&&s.test(i),e.isEmpty=e.xMin===e.xMax||e.yMin===e.yMax||o.test(i)),e.isWhitespace||e.isEmpty||_++,S&&r&&!e.isWhitespace&&t+c+Q>G&&l){if(P.glyphAt(l-1).glyphObj.canBreakAfter)a=new A,Q=-t;else for(var g=l;g--;){if(0===g&&"break-word"===E){a=new A,Q=-t;break}if(P.glyphAt(g).glyphObj.canBreakAfter){var d=(a=P.splitAt(g+1)).glyphAt(0).x;Q-=d;for(var I=a.count;I--;)a.glyphAt(I).x-=d;break}}a&&(P.isSoftWrapped=!0,P=a,J.push(P),B=G)}var h=P.glyphAt(P.count);h.glyphObj=e,h.x=t+Q,h.width=c,h.charIndex=n,"\n"===i&&(P=new A,J.push(P),Q=-(t+c+v*p)+x)})),J.forEach((function(e){for(var t=e.count;t--;){var n=e.glyphAt(t),r=n.glyphObj,a=n.x,i=n.width;if(!r.isWhitespace)return e.width=a+i,void(e.width>B&&(B=e.width))}}));var q=0,$=0;if(V&&("number"===typeof V?q=-V:"string"===typeof V&&(q=-B*("left"===V?0:"center"===V?.5:"right"===V?1:g(V)))),X)if("number"===typeof X)$=-X;else if("string"===typeof X){var ee=J.length*y;$="top"===X?0:"top-baseline"===X?-Y:"middle"===X?ee/2:"bottom"===X?ee:"bottom-baseline"===X?ee-L+k*H:g(X)*ee}if(!z){var te=t.getEmbeddingLevels(u,w);a=new Uint16Array(_),c=new Float32Array(2*_),h={},m=[i,i,-1/0,-1/0],b=[];var ne=Y;O&&(f=new Float32Array(3*u.length)),T&&(C=new Uint8Array(3*_));var re,ae,ie=0,oe=-1,se=-1;if(J.forEach((function(n,r){var o=n.count,s=n.width;if(o>0){for(var g=0,I=o;I--&&n.glyphAt(I).glyphObj.isWhitespace;)g++;var A=0,p=0;if("center"===Z)A=(B-s)/2;else if("right"===Z)A=B-s;else if("justify"===Z&&n.isSoftWrapped){for(var v=0,G=o-g;G--;)n.glyphAt(G).glyphObj.isWhitespace&&v++;p=(B-s)/v}if(p||A)for(var w=0,_=0;_<o;_++){var S=n.glyphAt(_),x=S.glyphObj;S.x+=A+w,0!==p&&x.isWhitespace&&_<o-g&&(w+=p,S.width+=p)}for(var R,M=t.getReorderSegments(u,te,n.glyphAt(0).charIndex,n.glyphAt(n.count-1).charIndex),k=0;k<M.length;k++)for(var E=Object(l.a)(M[k],2),W=E[0],V=E[1],F=1/0,X=-1/0,L=0;L<o;L++)if(n.glyphAt(L).charIndex>=W){for(var Y=L,z=L;z<o;z++){var K=n.glyphAt(z);if(K.charIndex>V)break;z<o-g&&(F=Math.min(F,K.x),X=Math.max(X,K.x+K.width))}for(var j=Y;j<z;j++){var D=n.glyphAt(j);D.x=X-(D.x+D.width-F)}break}for(var Q=function(e){return R=e},P=0;P<o;P++){var J=n.glyphAt(P),ee=(R=J.glyphObj).index,ce=1&te.levels[J.charIndex];if(ce){var ue=t.getMirroredCharacter(u[J.charIndex]);ue&&e.forEachGlyph(ue,0,0,Q)}if(O){var le=J.charIndex,ge=J.x+q,de=J.x+J.width+q;f[3*le]=ce?de:ge,f[3*le+1]=ce?ge:de,f[3*le+2]=ne+U+$;var Ie=le-oe;Ie>1&&d(f,oe,Ie),oe=le}if(T)for(var Ae=J.charIndex;Ae>se;)se++,T.hasOwnProperty(se)&&(ae=T[se]);if(!R.isWhitespace&&!R.isEmpty){var he=ie++;h[ee]||(h[ee]={path:R.path,pathBounds:[R.xMin,R.yMin,R.xMax,R.yMax]});var Ce=J.x+q,fe=ne+$;c[2*he]=Ce,c[2*he+1]=fe;var pe=Ce+R.xMin*H,me=fe+R.yMin*H,ve=Ce+R.xMax*H,be=fe+R.yMax*H;pe<m[0]&&(m[0]=pe),me<m[1]&&(m[1]=me),ve>m[2]&&(m[2]=ve),be>m[3]&&(m[3]=be),he%N===0&&(re={start:he,end:he,rect:[i,i,-1/0,-1/0]},b.push(re)),re.end++;var ye=re.rect;if(pe<ye[0]&&(ye[0]=pe),me<ye[1]&&(ye[1]=me),ve>ye[2]&&(ye[2]=ve),be>ye[3]&&(ye[3]=be),a[he]=ee,T){var Be=3*he;C[Be]=ae>>16&255,C[Be+1]=ae>>8&255,C[Be+2]=255&ae}}}}ne-=y})),f){var ce=u.length-oe;ce>1&&d(f,oe,ce)}}j.typesetting=I()-F,n({glyphIds:a,glyphPositions:c,glyphData:h,caretPositions:f,caretHeight:D,glyphColors:C,chunkedBounds:b,fontSize:p,unitsPerEm:W,ascender:R*H,descender:k*H,lineHeight:y,topBaseline:Y,blockBounds:[q,$-J.length*y,q+B,$],visibleBounds:m,timings:j})}))}function g(e){var t=e.match(/^([\d.]+)%$/),n=t?parseFloat(t[1]):NaN;return isNaN(n)?0:n/100}function d(e,t,n){for(var r=e[3*t],a=e[3*t+1],i=e[3*t+2],o=(a-r)/n,s=0;s<n;s++){var c=3*(t+s);e[c]=r+o*s,e[c+1]=r+o*(s+1),e[c+2]=i}}function I(){return(self.performance||Date).now()}function A(){this.data=[]}var h=["glyphObj","x","width","charIndex"];return A.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt:function(e){var t=A.flyweight;return t.data=this.data,t.index=e,t},splitAt:function(e){var t=new A;return t.data=this.data.splice(e*h.length),t}},A.flyweight=h.reduce((function(e,t,n,r){return Object.defineProperty(e,t,{get:function(){return this.data[this.index*h.length+n]},set:function(e){this.data[this.index*h.length+n]=e}}),e}),{data:null,index:0}),{typeset:u,measure:function(e,t){u(e,(function(e){var n=Object(l.a)(e.blockBounds,4),r=n[0],a=n[1],i=n[2],o=n[3];t({width:i-r,height:o-a})}),{metricsOnly:!0})},loadFont:c}},Ae],init:function(e,t,n,r){var a=e.defaultFontURL;return n(t,r(),{defaultFontURL:a})}}),De=Object(de.c)({name:"Typesetter",dependencies:[je,de.b],init:function(e,t){return function(n){var r=new t;return e.typeset(n,r.resolve),r}},getTransferables:function(e){var t=[e.glyphPositions.buffer,e.glyphIds.buffer];return e.caretPositions&&t.push(e.caretPositions.buffer),e.glyphColors&&t.push(e.glyphColors.buffer),t}});var Ue=function(){var e={};var t="aTroikaGlyphIndex",n=function(n){Object(K.a)(s,n);var o=Object(j.a)(s);function s(){var e;return Object(E.a)(this,s),(e=o.call(this)).detail=1,e.curveRadius=0,e.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],e.boundingSphere=new g.Sphere,e.boundingBox=new g.Box3,e}return Object(W.a)(s,[{key:"computeBoundingSphere",value:function(){}},{key:"computeBoundingBox",value:function(){}},{key:"setSide",value:function(e){var t=this.getIndex().count;this.setDrawRange(e===g.BackSide?t/2:0,e===g.DoubleSide?t:t/2)}},{key:"detail",get:function(){return this._detail},set:function(t){var n=this;if(t!==this._detail){this._detail=t,("number"!==typeof t||t<1)&&(t=1);var r=function(t){var n=e[t];if(!n){for(var r=new g.PlaneBufferGeometry(1,1,t,t),i=r.clone(),o=r.attributes,s=i.attributes,c=new g.BufferGeometry,u=o.uv.count,l=0;l<u;l++)s.position.array[3*l]*=-1,s.normal.array[3*l+2]*=-1;["position","normal","uv"].forEach((function(e){c.setAttribute(e,new g.Float32BufferAttribute([].concat(Object(a.a)(o[e].array),Object(a.a)(s[e].array)),o[e].itemSize))})),c.setIndex([].concat(Object(a.a)(r.index.array),Object(a.a)(i.index.array.map((function(e){return e+u}))))),c.translate(.5,.5,0),n=e[t]=c}return n}(t);["position","normal","uv"].forEach((function(e){n.attributes[e]=r.attributes[e].clone()})),this.setIndex(r.getIndex().clone())}}},{key:"curveRadius",get:function(){return this._curveRadius},set:function(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}},{key:"updateGlyphs",value:function(e,n,a,o,s){r(this,"aTroikaGlyphBounds",e,4),r(this,t,n,1),r(this,"aTroikaGlyphColor",s,3),this._blockBounds=a,this._chunkedBounds=o,i(this,n.length),this._updateBounds()}},{key:"_updateBounds",value:function(){var e=this._blockBounds;if(e){var t=this.curveRadius,n=this.boundingBox;if(t){var r=Math.PI,a=Math.floor,i=Math.min,o=Math.max,s=Math.sin,c=Math.cos,u=r/2,l=2*r,g=Math.abs(t),d=e[0]/g,I=e[2]/g,A=a((d+u)/l)!==a((I+u)/l)?-g:i(s(d)*g,s(I)*g),h=a((d-u)/l)!==a((I-u)/l)?g:o(s(d)*g,s(I)*g),C=a((d+r)/l)!==a((I+r)/l)?2*g:o(g-c(d)*g,g-c(I)*g);n.min.set(A,e[1],t<0?-C:0),n.max.set(h,e[3],t<0?0:C)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}},{key:"applyClipRect",value:function(e){var n=this.getAttribute(t).count,r=this._chunkedBounds;if(r)for(var a=r.length;a--;){n=r[a].end;var o=r[a].rect;if(o[1]<e.w&&o[3]>e.y&&o[0]<e.z&&o[2]>e.x)break}i(this,n)}}]),s}(g.InstancedBufferGeometry);function r(e,t,n,r){var a=e.getAttribute(t);n?a&&a.array.length===n.length?(a.array.set(n),a.needsUpdate=!0):(e.setAttribute(t,new g.InstancedBufferAttribute(n,r)),delete e._maxInstanceCount,e.dispose()):a&&e.deleteAttribute(t)}function i(e,t){e[e.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=t}return n.prototype.setAttribute||(n.prototype.setAttribute=function(e,t){return this.attributes[e]=t,this}),n}(),Qe="\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n".concat("\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n"),Pe="\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  ".concat("\n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  ","\n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  ","\n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n");var Je=function(){var e=new g.MeshBasicMaterial({color:16777215,side:g.DoubleSide,transparent:!0}),t=8421504,n=new g.Matrix4,r=new g.Vector3,a=new g.Vector3,i=[],o=new g.Vector3,s="+x+y";function c(e){return Array.isArray(e)?e[0]:e}var u=function(){var t=new g.Mesh(new g.PlaneBufferGeometry(1,1),e);return u=function(){return t},t},d=function(){var t=new g.Mesh(new g.PlaneBufferGeometry(1,1,32,1),e);return d=function(){return t},t},I={type:"syncstart"},A={type:"synccomplete"},h=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],C=h.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail"),f=function(h){Object(K.a)(p,h);var f=Object(j.a)(p);function p(){var e;Object(E.a)(this,p);var n=new Ue;return(e=f.call(this,n,null)).text="",e.anchorX=0,e.anchorY=0,e.curveRadius=0,e.direction="auto",e.font=null,e.fontSize=.1,e.letterSpacing=0,e.lineHeight="normal",e.maxWidth=1/0,e.overflowWrap="normal",e.textAlign="left",e.textIndent=0,e.whiteSpace="normal",e.material=null,e.color=null,e.colorRanges=null,e.outlineWidth=0,e.outlineColor=0,e.outlineOpacity=1,e.outlineBlur=0,e.outlineOffsetX=0,e.outlineOffsetY=0,e.strokeWidth=0,e.strokeColor=t,e.strokeOpacity=1,e.fillOpacity=1,e.depthOffset=0,e.clipRect=null,e.orientation=s,e.glyphGeometryDetail=1,e.sdfGlyphSize=null,e.gpuAccelerateSDF=!0,e.debugSDF=!1,e}return Object(W.a)(p,[{key:"sync",value:function(e){var t=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(I),Te({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},(function(n){t._isSyncing=!1,t._textRenderInfo=n,t.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);var r=t._queuedSyncs;r&&(t._queuedSyncs=null,t._needsSync=!0,t.sync((function(){r.forEach((function(e){return e&&e()}))}))),t.dispatchEvent(A),e&&e()}))))}},{key:"onBeforeRender",value:function(e,t,n,r,a,i){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a),a._hadOwnSide=a.hasOwnProperty("side"),this.geometry.setSide(a._actualSide=a.side),a.side=g.FrontSide}},{key:"onAfterRender",value:function(e,t,n,r,a,i){a._hadOwnSide?a.side=a._actualSide:delete a.side}},{key:"dispose",value:function(){this.geometry.dispose()}},{key:"textRenderInfo",get:function(){return this._textRenderInfo||null}},{key:"material",get:function(){var t=this._derivedMaterial,n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=e.clone());if(t&&t.baseMaterial===n||(t=this._derivedMaterial=function(e){var t=Ge(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new g.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new g.Vector4(0,0,0,0)},uTroikaClipRect:{value:new g.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new g.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new g.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new g.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",vertexTransform:Qe,fragmentDefs:Pe,fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",customRewriter:function(e){var t=e.vertexShader,n=e.fragmentShader,r=/\buniform\s+vec3\s+diffuse\b/;return r.test(n)&&(n=n.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(he,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:t,fragmentShader:n}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get:function(){return this.side},set:function(){}}}),t}(n),n.addEventListener("dispose",(function e(){n.removeEventListener("dispose",e),t.dispose()}))),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){var r=t._outlineMtl;return r||((r=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}})).isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,t.addEventListener("dispose",(function e(){t.removeEventListener("dispose",e),r.dispose()}))),[r,t]}return t},set:function(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}},{key:"glyphGeometryDetail",get:function(){return this.geometry.detail},set:function(e){this.geometry.detail=e}},{key:"curveRadius",get:function(){return this.geometry.curveRadius},set:function(e){this.geometry.curveRadius=e}},{key:"customDepthMaterial",get:function(){return c(this.material).getDepthMaterial()}},{key:"customDistanceMaterial",get:function(){return c(this.material).getDistanceMaterial()}},{key:"_prepareForRender",value:function(e){var i=e.isTextOutlineMaterial,c=e.uniforms,u=this.textRenderInfo;if(u){var d=u.sdfTexture,I=u.blockBounds;c.uTroikaSDFTexture.value=d,c.uTroikaSDFTextureSize.value.set(d.image.width,d.image.height),c.uTroikaSDFGlyphSize.value=u.sdfGlyphSize,c.uTroikaSDFExponent.value=u.sdfExponent,c.uTroikaTotalBounds.value.fromArray(I),c.uTroikaUseGlyphColors.value=!i&&!!u.glyphColors;var A,h,C,f=0,p=0,m=0,v=0,b=0;if(i){var y=this.outlineWidth,B=this.outlineOffsetX,G=this.outlineOffsetY,w=this.outlineBlur,_=this.outlineOpacity;f=this._parsePercent(y)||0,p=Math.max(0,this._parsePercent(w)||0),A=_,v=this._parsePercent(B)||0,b=this._parsePercent(G)||0}else(m=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(C=this.strokeColor,c.uTroikaStrokeColor.value.set(null==C?t:C),null==(h=this.strokeOpacity)&&(h=1)),A=this.fillOpacity;c.uTroikaDistanceOffset.value=f,c.uTroikaPositionOffset.value.set(v,b),c.uTroikaBlurRadius.value=p,c.uTroikaStrokeWidth.value=m,c.uTroikaStrokeOpacity.value=h,c.uTroikaFillOpacity.value=null==A?1:A,c.uTroikaCurveRadius.value=this.curveRadius||0;var Z=this.clipRect;if(Z&&Array.isArray(Z)&&4===Z.length)c.uTroikaClipRect.value.fromArray(Z);else{var S=100*(this.fontSize||.1);c.uTroikaClipRect.value.set(I[0]-S,I[1]-S,I[2]+S,I[3]+S)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;var x=i?this.outlineColor||0:this.color;if(null==x)delete e.color;else{var R=e.hasOwnProperty("color")?e.color:e.color=new g.Color;x===R._input&&"object"!==typeof x||R.set(R._input=x)}var M=this.orientation||s;if(M!==e._orientation){var k=c.uTroikaOrient.value,E=(M=M.replace(/[^-+xyz]/g,""))!==s&&M.match(/^([-+])([xyz])([-+])([xyz])$/);if(E){var W=Object(l.a)(E,5),V=W[1],F=W[2],X=W[3],H=W[4];r.set(0,0,0)[F]="-"===V?1:-1,a.set(0,0,0)[H]="-"===X?-1:1,n.lookAt(o,r.cross(a),a),k.setFromMatrix4(n)}else k.identity();e._orientation=M}}},{key:"_parsePercent",value:function(e){if("string"===typeof e){var t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}},{key:"localPositionToTextCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.Vector2;t.copy(e);var n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}},{key:"worldPositionToTextCoords",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.Vector2;return r.copy(e),this.localPositionToTextCoords(this.worldToLocal(r),t)}},{key:"raycast",value:function(e,t){var n=this.textRenderInfo,r=this.curveRadius;if(n){for(var a=n.blockBounds,o=r?d():u(),s=o.geometry,c=s.attributes,l=c.position,g=c.uv,I=0;I<g.count;I++){var A=a[0]+g.getX(I)*(a[2]-a[0]),h=a[1]+g.getY(I)*(a[3]-a[1]),C=0;r&&(C=r-Math.cos(A/r)*r,A=Math.sin(A/r)*r),l.setXYZ(I,A,h,C)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,i.length=0,o.raycast(e,i);for(var f=0;f<i.length;f++)i[f].object=this,t.push(i[f])}}},{key:"copy",value:function(e){var t=this,n=this.geometry;return Object(q.a)(Object($.a)(p.prototype),"copy",this).call(this,e),this.geometry=n,C.forEach((function(n){t[n]=e[n]})),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),p}(g.Mesh);h.forEach((function(e){var t="_private_"+e;Object.defineProperty(f.prototype,e,{get:function(){return this[t]},set:function(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}));var p=!1;return Object.defineProperty(f.prototype,"anchor",{get:function(){return this._deprecated_anchor},set:function(e){this._deprecated_anchor=e,p||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),p=!0),Array.isArray(e)?(this.anchorX="".concat(100*(+e[0]||0),"%"),this.anchorY="".concat(100*(+e[1]||0),"%")):this.anchorX=this.anchorY=0}}),f}();new WeakMap;new WeakMap;var qe=n(22);function $e(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;var r=e.length;if(t.length!==r)return!1;for(var a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}var et=[];function tt(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=Object(qe.a)(et);try{for(o.s();!(n=o.n()).done;){var s=n.value;if($e(t,s.keys,s.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return s.response;if(!r)throw s.promise}}}catch(u){o.e(u)}finally{o.f()}var c={keys:t,equal:i.equal,promise:e.apply(void 0,Object(a.a)(t)).then((function(e){return c.response=e})).then((function(){i.lifespan&&i.lifespan>0&&setTimeout((function(){var e=et.indexOf(c);-1!==e&&et.splice(e,1)}),i.lifespan)})).catch((function(e){return c.error=e}))};if(et.push(c),!r)throw c.promise}var nt=function(e,t,n){return tt(e,t,!1,n)},rt=["anchorX","anchorY","font","children","characters","onSync"],at=i.forwardRef((function(e,t){var n=e.anchorX,r=void 0===n?"center":n,a=e.anchorY,s=void 0===a?"middle":a,c=e.font,u=e.children,g=e.characters,d=e.onSync,I=Object(p.a)(e,rt),A=Object(o.useThree)((function(e){return e.invalidate})),h=i.useState((function(){return new Je})),C=Object(l.a)(h,1)[0],f=i.useMemo((function(){var e=[],t="";return i.Children.forEach(u,(function(n){"string"===typeof n||"number"===typeof n?t+=n:e.push(n)})),[e,t]}),[u]),v=Object(l.a)(f,2),b=v[0],y=v[1];return nt((function(){return new Promise((function(e){return function(e,t){var n=e.font,r=e.characters;Te({font:n,sdfGlyphSize:e.sdfGlyphSize,text:Array.isArray(r)?r.join("\n"):""+r},t)}({font:c,characters:g},e)}))}),["troika-text",c,g]),i.useLayoutEffect((function(){C.sync((function(){A(),d&&d(C)}))})),i.useEffect((function(){return function(){return C.dispose()}}),[C]),i.createElement("primitive",Object(m.a)({object:C,ref:t,font:c,text:y,anchorX:r,anchorY:s},I),b)})),it={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},ot=function(){function e(){Object(E.a)(this,e),Object(D.a)(this,"enabled",!0),Object(D.a)(this,"needsSwap",!0),Object(D.a)(this,"clear",!1),Object(D.a)(this,"renderToScreen",!1)}return Object(W.a)(e,[{key:"setSize",value:function(e,t){}},{key:"render",value:function(e,t,n,r,a){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),e}(),st=function(){function e(t){Object(E.a)(this,e),Object(D.a)(this,"camera",new g.OrthographicCamera(-1,1,1,-1,0,1)),Object(D.a)(this,"geometry",new g.PlaneGeometry(2,2)),Object(D.a)(this,"mesh",void 0),this.mesh=new g.Mesh(this.geometry,t)}return Object(W.a)(e,[{key:"material",get:function(){return this.mesh.material},set:function(e){this.mesh.material=e}},{key:"dispose",value:function(){this.mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this.mesh,this.camera)}}]),e}(),ct=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tDiffuse";return Object(E.a)(this,n),r=t.call(this),Object(D.a)(Object(z.a)(r),"textureID",void 0),Object(D.a)(Object(z.a)(r),"uniforms",void 0),Object(D.a)(Object(z.a)(r),"material",void 0),Object(D.a)(Object(z.a)(r),"fsQuad",void 0),r.textureID=a,e instanceof g.ShaderMaterial?(r.uniforms=e.uniforms,r.material=e):(r.uniforms=g.UniformsUtils.clone(e.uniforms),r.material=new g.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:r.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),r.fsQuad=new st(r.material),r}return Object(W.a)(n,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}]),n}(ot),ut=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"scene",void 0),Object(D.a)(Object(z.a)(a),"camera",void 0),Object(D.a)(Object(z.a)(a),"inverse",void 0),a.scene=e,a.camera=r,a.clear=!0,a.needsSwap=!1,a.inverse=!1,a}return Object(W.a)(n,[{key:"render",value:function(e,t,n){var r,a,i=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(r=0,a=1):(r=1,a=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),o.buffers.stencil.setClear(a),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}]),n}(ot),lt=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).needsSwap=!1,e}return Object(W.a)(n,[{key:"render",value:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}]),n}(ot),gt=function(){function e(t,n){if(Object(E.a)(this,e),Object(D.a)(this,"renderer",void 0),Object(D.a)(this,"_pixelRatio",void 0),Object(D.a)(this,"_width",void 0),Object(D.a)(this,"_height",void 0),Object(D.a)(this,"renderTarget1",void 0),Object(D.a)(this,"renderTarget2",void 0),Object(D.a)(this,"writeBuffer",void 0),Object(D.a)(this,"readBuffer",void 0),Object(D.a)(this,"renderToScreen",void 0),Object(D.a)(this,"passes",[]),Object(D.a)(this,"copyPass",void 0),Object(D.a)(this,"clock",void 0),this.renderer=t,void 0===n){var r={minFilter:g.LinearFilter,magFilter:g.LinearFilter,format:g.RGBAFormat},a=t.getSize(new g.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=a.width,this._height=a.height,(n=new g.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===it&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===ct&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ct(it),this.clock=new g.Clock}return Object(W.a)(e,[{key:"swapBuffers",value:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}},{key:"addPass",value:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}},{key:"render",value:function(e){void 0===e&&(e=this.clock.getDelta());for(var t=this.renderer.getRenderTarget(),n=!1,r=this.passes.length,a=0;a<r;a++){var i=this.passes[a];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==ut&&(i instanceof ut?n=!0:i instanceof lt&&(n=!1))}}this.renderer.setRenderTarget(t)}},{key:"reset",value:function(e){if(void 0===e){var t=this.renderer.getSize(new g.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var a=0;a<this.passes.length;a++)this.passes[a].setSize(n,r)}},{key:"setPixelRatio",value:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}]),e}(),dt=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r,a,i){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(E.a)(this,n),o=t.call(this),Object(D.a)(Object(z.a)(o),"scene",void 0),Object(D.a)(Object(z.a)(o),"camera",void 0),Object(D.a)(Object(z.a)(o),"overrideMaterial",void 0),Object(D.a)(Object(z.a)(o),"clearColor",void 0),Object(D.a)(Object(z.a)(o),"clearAlpha",void 0),Object(D.a)(Object(z.a)(o),"clearDepth",!1),Object(D.a)(Object(z.a)(o),"_oldClearColor",new g.Color),o.scene=e,o.camera=r,o.overrideMaterial=a,o.clearColor=i,o.clearAlpha=s,o.clear=!0,o.needsSwap=!1,o}return Object(W.a)(n,[{key:"render",value:function(e,t,n){var r,a=e.autoClear;e.autoClear=!1;var i=null;void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),e.autoClear=a}}]),n}(ot),It={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")},At=["children","multisamping","renderIndex","disableGamma","disableRenderPass"];Object(o.extend)({EffectComposer:gt,RenderPass:dt,ShaderPass:ct});var ht=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(t){return!1}},Ct=i.forwardRef((function(e,t){var n=e.children,r=e.multisamping,a=void 0===r?8:r,s=e.renderIndex,c=void 0===s?1:s,u=e.disableGamma,d=void 0!==u&&u,I=e.disableRenderPass,A=void 0!==I&&I,h=Object(p.a)(e,At),C=i.useRef(),f=Object(o.useThree)((function(e){return e.scene})),v=Object(o.useThree)((function(e){return e.camera})),y=Object(o.useThree)((function(e){return e.gl})),B=Object(o.useThree)((function(e){return e.size})),G=i.useState((function(){if(ht()&&a>0){var e=new g.WebGLRenderTarget(B.width,B.height,{format:g.RGBAFormat,encoding:g.sRGBEncoding});return e.samples=8,e}})),w=Object(l.a)(G,1)[0];return i.useEffect((function(){var e,t;null==(e=C.current)||e.setSize(B.width,B.height),null==(t=C.current)||t.setPixelRatio(y.getPixelRatio())}),[y,B]),Object(o.useFrame)((function(){var e;return null==(e=C.current)?void 0:e.render()}),c),i.createElement("effectComposer",Object(m.a)({ref:Object(b.default)([t,C]),args:[y,w]},h),!A&&i.createElement("renderPass",{attachArray:"passes",args:[f,v]}),!d&&i.createElement("shaderPass",{attachArray:"passes",args:[It]}),n)})),ft=["stops","colors","size"];function pt(e){var t=e.stops,n=e.colors,r=e.size,a=void 0===r?1024:r,s=Object(p.a)(e,ft),c=Object(o.useThree)((function(e){return e.gl})),u=i.useMemo((function(){var e=document.createElement("canvas"),r=e.getContext("2d");e.width=16,e.height=a;for(var i=r.createLinearGradient(0,0,0,a),o=t.length;o--;)i.addColorStop(t[o],n[o]);r.fillStyle=i,r.fillRect(0,0,16,a);var s=new g.Texture(e);return s.needsUpdate=!0,s}),[t]);return i.useEffect((function(){return function(){u.dispose()}}),[u]),i.createElement("primitive",Object(m.a)({object:u,attach:"map",encoding:c.outputEncoding},s))}function mt(e,t,n,r){return function(a){Object(K.a)(o,a);var i=Object(j.a)(o);function o(){var a;Object(E.a)(this,o);var s=Object.entries(e);return a=i.call(this,{uniforms:s.reduce((function(e,t){var n=Object(l.a)(t,2),r=n[0],a=n[1],i=g.UniformsUtils.clone(Object(D.a)({},r,{value:a}));return Object(u.a)(Object(u.a)({},e),i)}),{}),vertexShader:t,fragmentShader:n}),s.forEach((function(e){var t=Object(l.a)(e,1)[0];return Object.defineProperty(Object(z.a)(a),t,{get:function(){return a.uniforms[t].value},set:function(e){return a.uniforms[t].value=e}})})),r&&r(Object(z.a)(a)),a}return Object(W.a)(o)}(g.ShaderMaterial)}var vt=function(e){return e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e};function bt(e){var t=Object(o.useThree)((function(e){return e.gl})),n=Object(o.useLoader)(g.TextureLoader,vt(e)?Object.values(e):e);if(Object(i.useEffect)((function(){(Array.isArray(n)?n:[n]).forEach(t.initTexture)}),[t,n]),vt(e)){var r=Object.keys(e),a={};return r.forEach((function(e){return Object.assign(a,Object(D.a)({},e,n[r.indexOf(e)]))})),a}return n}bt.preload=function(e){return o.useLoader.preload(g.TextureLoader,e)},bt.clear=function(e){return o.useLoader.clear(g.TextureLoader,e)};var yt=["children","color","segments","scale","zoom","grayscale","url","toneMapped"],Bt=mt({color:new g.Color("white"),scale:[1,1],imageBounds:[1,1],map:null,zoom:1,grayscale:0},"\n  varying vec2 vUv;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n  }\n","\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float zoom;\n  uniform float grayscale;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, 1.0), grayscale);\n    \n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n  }\n"),Gt=i.forwardRef((function(e,t){var n=e.children,r=e.color,a=e.segments,s=void 0===a?1:a,c=e.scale,u=void 0===c?1:c,l=e.zoom,g=void 0===l?1:l,d=e.grayscale,I=void 0===d?0:d,A=e.url,h=e.toneMapped,C=Object(p.a)(e,yt);Object(o.extend)({ImageMaterial:Bt});var f=bt(A),v=Array.isArray(u)?[u[0],u[1]]:[u,u],b=[f.image.width,f.image.height];return i.createElement("mesh",Object(m.a)({ref:t,scale:u},C),i.createElement("planeGeometry",{args:[1,1,s,s]}),i.createElement("imageMaterial",{color:r,map:f,zoom:g,grayscale:I,scale:v,imageBounds:b,toneMapped:h}),n)})),wt=["userData","children","geometry","threshold","color"];function _t(e){e.userData;var t=e.children,n=e.geometry,r=e.threshold,a=void 0===r?15:r,o=e.color,s=void 0===o?"black":o,c=Object(p.a)(e,wt),u=i.useRef(null);return i.useLayoutEffect((function(){var e=u.current.parent;if(e){var t=n||e.geometry;t===u.current.userData.currentGeom&&a===u.current.userData.currentThreshold||(u.current.userData.currentGeom=t,u.current.userData.currentThreshold=a,u.current.geometry=new g.EdgesGeometry(t,a))}})),i.createElement("lineSegments",Object(m.a)({ref:u,raycast:function(){return null}},c),t||i.createElement("lineBasicMaterial",{color:s}))}function Zt(e,t){var n=new g.Matrix4,r=new g.Ray,a=new g.Sphere,i=new g.Vector3,o=this.geometry;if(a.copy(o.boundingSphere),a.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(a,i)){n.copy(this.matrixWorld).invert(),r.copy(e.ray).applyMatrix4(n);var s=new g.Vector3,c=new g.Vector3,u=new g.Vector3,l=this instanceof g.LineSegments?2:1,d=o.index,I=o.attributes;if(null!==d)for(var A=d.array,h=I.position.array,C=I.width.array,f=0,p=A.length-1;f<p;f+=l){var m=A[f],v=A[f+1];s.fromArray(h,3*m),c.fromArray(h,3*v);var b=null!=C[Math.floor(f/3)]?C[Math.floor(f/3)]:1,y=e.params.Line.threshold+this.material.lineWidth*b/2,B=y*y;if(!(r.distanceSqToSegment(s,c,i,u)>B)){i.applyMatrix4(this.matrixWorld);var G=e.ray.origin.distanceTo(i);G<e.near||G>e.far||(t.push({distance:G,point:u.clone().applyMatrix4(this.matrixWorld),index:f,face:null,faceIndex:null,object:this}),f=p)}}}}function St(e,t,n,r,a){var i;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,a&&t+a):e.slice(t,a&&t+a):e,n.set)n.set(e,r);else for(i=0;i<e.length;i++)n[i+r]=e[i];return n}var xt=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).type="MeshLine",e.isMeshLine=!0,e.positions=[],e.raycast=Zt,e.previous=[],e.next=[],e.side=[],e.width=[],e.indices_array=[],e.uvs=[],e.counters=[],e._points=[],e._geom=null,e.widthCallback=null,e.matrixWorld=new g.Matrix4,Object.defineProperties(Object(z.a)(e),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}}),e}return Object(W.a)(n,[{key:"setMatrixWorld",value:function(e){this.matrixWorld=e}},{key:"setGeometry",value:function(e,t){this._geometry=e,e instanceof g.BufferGeometry?this.setPoints(e.getAttribute("position").array,t):this.setPoints(e,t)}},{key:"setPoints",value:function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof g.Vector3)for(var n=0;n<e.length;n++){var r=e[n],a=n/e.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(a),this.counters.push(a)}else for(n=0;n<e.length;n+=3)a=n/e.length,this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(a),this.counters.push(a);this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")}},{key:"compareV3",value:function(e,t){var n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}},{key:"copyV3",value:function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}},{key:"process",value:function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var a=2*r;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new g.BufferAttribute(new Float32Array(this.positions),3),previous:new g.BufferAttribute(new Float32Array(this.previous),3),next:new g.BufferAttribute(new Float32Array(this.next),3),side:new g.BufferAttribute(new Float32Array(this.side),1),width:new g.BufferAttribute(new Float32Array(this.width),1),uv:new g.BufferAttribute(new Float32Array(this.uvs),2),index:new g.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new g.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}},{key:"advance",value:function(e){var t=e.x,n=e.y,r=e.z,a=this._attributes.position.array,i=this._attributes.previous.array,o=this._attributes.next.array,s=a.length;St(a,0,i,0,s),St(a,6,a,0,s-6),a[s-6]=t,a[s-5]=n,a[s-4]=r,a[s-3]=t,a[s-2]=n,a[s-1]=r,St(a,6,o,0,s-6),o[s-6]=t,o[s-5]=n,o[s-4]=r,o[s-3]=t,o[s-2]=n,o[s-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}]),n}(g.BufferGeometry);g.ShaderChunk.meshline_vert=["","#include <common>","",g.ShaderChunk.logdepthbuf_pars_vertex,g.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",g.ShaderChunk.logdepthbuf_vertex,g.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",g.ShaderChunk.fog_vertex,"}"].join("\n"),g.ShaderChunk.meshline_frag=["",g.ShaderChunk.fog_pars_fragment,g.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",g.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",g.ShaderChunk.fog_fragment,"}"].join("\n");var Rt=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,{uniforms:Object.assign({},g.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new g.Color(16777215)},opacity:{value:1},resolution:{value:new g.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new g.Vector2(1,1)}}),vertexShader:g.ShaderChunk.meshline_vert,fragmentShader:g.ShaderChunk.meshline_frag})).type="MeshLineMaterial",Object.defineProperties(Object(z.a)(r),{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}}}),r.setValues(e),r}return Object(W.a)(n,[{key:"copy",value:function(e){return Object(q.a)(Object($.a)(n.prototype),"copy",this).call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}]),n}(g.ShaderMaterial),Mt={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},kt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.set(e.subarray(t)),e.fill(-1/0,-t),e};function Et(e,t){var n=Object(u.a)(Object(u.a)({},Mt),t),r=n.length,a=n.local,s=n.decay,c=n.interval,d=n.stride,I=i.useRef(),A=i.useState((function(){return new g.Vector3})),h=Object(l.a)(A,1)[0];i.useLayoutEffect((function(){e&&(I.current=Float32Array.from({length:10*r*3},(function(t,n){return e.position.getComponent(n%3)})))}),[r,e]);var C=i.useRef(new g.Vector3),f=i.useRef(0);return Object(o.useFrame)((function(){if(e&&I.current){if(0===f.current){var t;a?t=e.position:(e.getWorldPosition(h),t=h);for(var n=1*s,r=0;r<n;r++)t.distanceTo(C.current)<d||(kt(I.current,3),I.current.set(t.toArray(),I.current.length-3));C.current.copy(t)}f.current++,f.current=f.current%c}})),I}var Wt=i.forwardRef((function(e,t){var n=e.children,r=Object(u.a)(Object(u.a)({},Mt),e),a=r.width,s=r.length,c=r.decay,d=r.local,I=r.stride,A=r.interval,h=e.color,C=void 0===h?"hotpink":h,f=e.attenuation,p=e.target,m=Object(o.useThree)((function(e){return e.size})),v=i.useRef(null),b=i.useState(null),y=Object(l.a)(b,2),B=y[0],G=y[1],w=Et(B,{length:s,decay:c,local:d,stride:I,interval:A});i.useEffect((function(){var e=(null==p?void 0:p.current)||v.current.children.find((function(e){return e instanceof g.Object3D}));e&&G(e)}),[w,p]);var _=i.useMemo((function(){return new xt}),[]),Z=i.useMemo((function(){var e,t,r=new Rt({lineWidth:.1*a,color:C,sizeAttenuation:1,resolution:new g.Vector2(m.width,m.height)});if(n)if(Array.isArray(n))t=n.find((function(e){var t=e;return"string"===typeof t.type&&"meshLineMaterial"===t.type}));else{var i=n;"string"===typeof i.type&&"meshLineMaterial"===i.type&&(t=i)}return"object"===typeof(null==(e=t)?void 0:e.props)&&r.setValues(t.props),r}),[a,C,m,n]);return i.useEffect((function(){Z.uniforms.resolution.value.set(m.width,m.height)}),[m]),Object(o.useFrame)((function(){w.current&&_.setPoints(w.current,f)})),i.createElement("group",null,i.createElement("mesh",{ref:t,geometry:_,material:Z}),i.createElement("group",{ref:v},n))})),Vt=function(){var e=new g.Triangle,t=new g.Vector3;function n(e){var t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}return n.prototype={constructor:n,setWeightAttribute:function(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this},build:function(){for(var t=this.positionAttribute,n=this.weightAttribute,r=new Float32Array(t.count/3),a=0;a<t.count;a+=3){var i=1;n&&(i=n.getX(a)+n.getX(a+1)+n.getX(a+2)),e.a.fromBufferAttribute(t,a),e.b.fromBufferAttribute(t,a+1),e.c.fromBufferAttribute(t,a+2),i*=e.getArea(),r[a/3]=i}this.distribution=new Float32Array(t.count/3);for(var o=0,s=0;s<r.length;s++)o+=r[s],this.distribution[s]=o;return this},setRandomGenerator:function(e){return this.randomFunction=e,this},sample:function(e,t,n){var r=this.distribution[this.distribution.length-1],a=this.binarySearch(this.randomFunction()*r);return this.sampleFace(a,e,t,n)},binarySearch:function(e){for(var t=this.distribution,n=0,r=t.length-1,a=-1;n<=r;){var i=Math.ceil((n+r)/2);if(0===i||t[i-1]<=e&&t[i]>e){a=i;break}e<t[i]?r=i-1:n=i+1}return a},sampleFace:function(n,r,a,i){var o=this.randomFunction(),s=this.randomFunction();return o+s>1&&(o=1-o,s=1-s),e.a.fromBufferAttribute(this.positionAttribute,3*n),e.b.fromBufferAttribute(this.positionAttribute,3*n+1),e.c.fromBufferAttribute(this.positionAttribute,3*n+2),r.set(0,0,0).addScaledVector(e.a,o).addScaledVector(e.b,s).addScaledVector(e.c,1-(o+s)),void 0!==a&&e.getNormal(a),void 0!==i&&void 0!==this.colorAttribute&&(e.a.fromBufferAttribute(this.colorAttribute,3*n),e.b.fromBufferAttribute(this.colorAttribute,3*n+1),e.c.fromBufferAttribute(this.colorAttribute,3*n+2),t.set(0,0,0).addScaledVector(e.a,o).addScaledVector(e.b,s).addScaledVector(e.c,1-(o+s)),i.r=t.x,i.g=t.y,i.b=t.z),this}},n}(),Ft=["children","weight","transform","instances","mesh"],Xt=function(e){var t=e.children,n=e.weight,r=e.transform,a=e.instances,o=e.mesh,s=Object(p.a)(e,Ft),c=i.useRef(null),u=i.useRef(null),l=i.useRef(null);return i.useEffect((function(){var e,t;u.current=null!==(e=null==a?void 0:a.current)&&void 0!==e?e:c.current.children.find((function(e){return e.hasOwnProperty("instanceMatrix")})),l.current=null!==(t=null==o?void 0:o.current)&&void 0!==t?t:c.current.children.find((function(e){return"Mesh"===e.type}))}),[t,null==o?void 0:o.current,null==a?void 0:a.current]),i.useEffect((function(){if("undefined"!==typeof l.current&&"undefined"!==typeof u.current){var e=new Vt(l.current);n&&e.setWeightAttribute(n),e.build();var t=new g.Vector3,a=new g.Vector3,i=new g.Color,o=new g.Object3D;l.current.updateMatrixWorld(!0);for(var s=0;s<u.current.count;s++)e.sample(t,a,i),"function"===typeof r?r({dummy:o,sampledMesh:l.current,position:t,normal:a,color:i},s):o.position.copy(t),o.updateMatrix(),u.current.setMatrixAt(s,o.matrix);u.current.instanceMatrix.needsUpdate=!0}}),[t,null==o?void 0:o.current,null==a?void 0:a.current]),i.createElement("group",Object(m.a)({ref:c},s),t)},Ht=["compute","name"],Ot=function(e){var t=e.compute,n=e.name,r=Object(p.a)(e,Ht),a=i.useState((function(){return new g.BufferAttribute(new Float32Array(0),1)})),o=Object(l.a)(a,1)[0],s=i.useRef(null);return i.useLayoutEffect((function(){if(s.current){var e,n=null!==(e=s.current.parent)&&void 0!==e?e:s.current.__r3f.parent,r=t(n);s.current.copy(r)}}),[t]),i.createElement("primitive",Object(m.a)({ref:s,object:o,attachObject:["attributes",n]},r))},Lt=n(67),Nt=n.n(Lt),Yt=["object","children","deep","castShadow","receiveShadow","inject","keys"],Tt=["children"];function zt(e,t){var n=t.keys,r=void 0===n?["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData"]:n,a=t.deep,o=t.inject,s=t.castShadow,c=t.receiveShadow,l=Nt()(e,r);return a&&(l.geometry&&"materialsOnly"!==a&&(l.geometry=l.geometry.clone()),l.material&&"geometriesOnly"!==a&&(l.material=l.material.clone())),o&&(l="function"===typeof o?Object(u.a)(Object(u.a)({},l),{},{children:o(e)}):i.isValidElement(o)?Object(u.a)(Object(u.a)({},l),{},{children:o}):Object(u.a)(Object(u.a)({},l),o)),"Mesh"===e.type&&(s&&(l.castShadow=!0),c&&(l.receiveShadow=!0)),l}var Kt=i.forwardRef((function(e,t){var n=e.object,r=e.children,a=e.deep,o=e.castShadow,s=e.receiveShadow,c=e.inject,l=e.keys,g=Object(p.a)(e,Yt),d={keys:l,deep:a,inject:c,castShadow:o,receiveShadow:s};if(Array.isArray(n))return i.createElement("group",Object(m.a)({},g,{ref:t}),n.map((function(e){return i.createElement(Kt,Object(m.a)({key:e.uuid,object:e},d))})),r);var I=zt(n,d),A=I.children,h=Object(p.a)(I,Tt),C=n.type[0].toLowerCase()+n.type.slice(1);return i.createElement(C,Object(m.a)({},h,g,{ref:t}),(null==n?void 0:n.children).map((function(e){var t={},n=e.type[0].toLowerCase()+e.type.slice(1);return"group"===n||"object3D"===n?(n=Kt,t=Object(u.a)({object:e},d)):t=zt(e,d),i.createElement(n,Object(m.a)({key:e.uuid},t))})),r,A)})),jt=["makeDefault"],Dt=i.forwardRef((function(e,t){var n=e.makeDefault,r=Object(p.a)(e,jt),a=Object(o.useThree)((function(e){return e.set})),s=Object(o.useThree)((function(e){return e.camera})),c=Object(o.useThree)((function(e){return e.size})),u=i.useRef();return i.useLayoutEffect((function(){u.current&&!r.manual&&u.current.updateProjectionMatrix()}),[c,r]),i.useLayoutEffect((function(){if(n&&u.current){var e=s;return a((function(){return{camera:u.current}})),function(){return a((function(){return{camera:e}}))}}}),[s,u,n,a]),i.createElement("orthographicCamera",Object(m.a)({left:c.width/-2,right:c.width/2,top:c.height/2,bottom:c.height/-2,ref:Object(b.default)([u,t])},r))})),Ut=["makeDefault"],Qt=i.forwardRef((function(e,t){var n=e.makeDefault,r=Object(p.a)(e,Ut),a=Object(o.useThree)((function(e){return e.set})),s=Object(o.useThree)((function(e){return e.camera})),c=Object(o.useThree)((function(e){return e.size})),u=i.useRef();return i.useLayoutEffect((function(){var e=u.current;e&&!r.manual&&(e.aspect=c.width/c.height,e.updateProjectionMatrix())}),[c,r]),i.useLayoutEffect((function(){if(n&&u.current){var e=s;return a((function(){return{camera:u.current}})),function(){return a((function(){return{camera:e}}))}}}),[s,u,n,a]),i.createElement("perspectiveCamera",Object(m.a)({ref:Object(b.default)([u,t])},r))})),Pt=["children","fog","frames","resolution","near","far"];function Jt(e){var t=e.children,n=e.fog,r=e.frames,a=void 0===r?1/0:r,s=e.resolution,c=void 0===s?256:s,u=e.near,d=void 0===u?1:u,I=e.far,A=void 0===I?1e3:I,h=Object(p.a)(e,Pt),C=i.useRef(),f=i.useState(),m=Object(l.a)(f,2),v=m[0],b=m[1],y=Object(o.useThree)((function(e){return e.scene})),B=Object(o.useThree)((function(e){return e.gl})),G=i.useMemo((function(){var e=new g.WebGLCubeRenderTarget(c);return e.texture.type=g.HalfFloatType,e}),[c]),w=0;return Object(o.useFrame)((function(){if(v&&C.current&&(a===1/0||w<a)){C.current.traverse((function(e){return e.visible=!1}));var e=y.fog;y.fog=n||e,v.update(B,y),y.fog=e,C.current.traverse((function(e){return e.visible=!0})),w++}})),i.createElement("group",h,i.createElement("cubeCamera",{ref:b,args:[d,A,G]}),i.createElement("group",{ref:C},t(G.texture)))}var qt=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),r=t.call(this),Object(D.a)(Object(z.a)(r),"object",void 0),Object(D.a)(Object(z.a)(r),"changeEvent",{type:"change"}),Object(D.a)(Object(z.a)(r),"EPS",1e-6),Object(D.a)(Object(z.a)(r),"enabled",!0),Object(D.a)(Object(z.a)(r),"deviceOrientation",{alpha:0,beta:0,gamma:0}),Object(D.a)(Object(z.a)(r),"screenOrientation",0),Object(D.a)(Object(z.a)(r),"alphaOffset",0),Object(D.a)(Object(z.a)(r),"onDeviceOrientationChangeEvent",(function(e){r.deviceOrientation=e})),Object(D.a)(Object(z.a)(r),"onScreenOrientationChangeEvent",(function(){r.screenOrientation=window.orientation||0})),Object(D.a)(Object(z.a)(r),"zee",new g.Vector3(0,0,1)),Object(D.a)(Object(z.a)(r),"euler",new g.Euler),Object(D.a)(Object(z.a)(r),"q0",new g.Quaternion),Object(D.a)(Object(z.a)(r),"q1",new g.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),Object(D.a)(Object(z.a)(r),"setObjectQuaternion",(function(e,t,n,a,i){r.euler.set(n,t,-a,"YXZ"),e.setFromEuler(r.euler),e.multiply(r.q1),e.multiply(r.q0.setFromAxisAngle(r.zee,-i))})),Object(D.a)(Object(z.a)(r),"connect",(function(){r.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"===typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then((function(e){"granted"==e&&(window.addEventListener("orientationchange",r.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",r.onDeviceOrientationChangeEvent))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(window.addEventListener("orientationchange",r.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",r.onDeviceOrientationChangeEvent)),r.enabled=!0})),Object(D.a)(Object(z.a)(r),"disconnect",(function(){window.removeEventListener("orientationchange",r.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",r.onDeviceOrientationChangeEvent),r.enabled=!1})),Object(D.a)(Object(z.a)(r),"lastQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"update",(function(){if(!1!==r.enabled){var e=r.deviceOrientation;if(e){var t=e.alpha?g.MathUtils.degToRad(e.alpha)+r.alphaOffset:0,n=e.beta?g.MathUtils.degToRad(e.beta):0,a=e.gamma?g.MathUtils.degToRad(e.gamma):0,i=r.screenOrientation?g.MathUtils.degToRad(r.screenOrientation):0;r.setObjectQuaternion(r.object.quaternion,t,n,a,i),8*(1-r.lastQuaternion.dot(r.object.quaternion))>r.EPS&&(r.lastQuaternion.copy(r.object.quaternion),r.dispatchEvent(r.changeEvent))}}})),Object(D.a)(Object(z.a)(r),"dispose",(function(){return r.disconnect()})),r.object=e,r.object.rotation.reorder("YXZ"),r.connect(),r}return Object(W.a)(n)}(g.EventDispatcher),$t=["camera","onChange"],en=i.forwardRef((function(e,t){var n=e.camera,r=e.onChange,a=Object(p.a)(e,$t),s=Object(o.useThree)((function(e){return e.camera})),c=Object(o.useThree)((function(e){return e.invalidate})),u=n||s,g=i.useState((function(){return new qt(u)})),d=Object(l.a)(g,1)[0];return i.useEffect((function(){var e=function(e){c(),r&&r(e)};return null==d||null==d.addEventListener||d.addEventListener("change",e),function(){return null==d||null==d.removeEventListener?void 0:d.removeEventListener("change",e)}}),[r,d,c]),Object(o.useFrame)((function(){return null==d?void 0:d.update()})),i.useEffect((function(){var e=d;return null==e||e.connect(),function(){return null==e?void 0:e.dispose()}}),[d]),d?i.createElement("primitive",Object(m.a)({ref:t,dispose:void 0,object:d},a)):null}));function tn(e){e.preventDefault()}var nn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"object",void 0),Object(D.a)(Object(z.a)(a),"domElement",void 0),Object(D.a)(Object(z.a)(a),"movementSpeed",1),Object(D.a)(Object(z.a)(a),"rollSpeed",.005),Object(D.a)(Object(z.a)(a),"dragToLook",!1),Object(D.a)(Object(z.a)(a),"autoForward",!1),Object(D.a)(Object(z.a)(a),"changeEvent",{type:"change"}),Object(D.a)(Object(z.a)(a),"EPS",1e-6),Object(D.a)(Object(z.a)(a),"tmpQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(a),"mouseStatus",0),Object(D.a)(Object(z.a)(a),"movementSpeedMultiplier",1),Object(D.a)(Object(z.a)(a),"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),Object(D.a)(Object(z.a)(a),"moveVector",new g.Vector3(0,0,0)),Object(D.a)(Object(z.a)(a),"rotationVector",new g.Vector3(0,0,0)),Object(D.a)(Object(z.a)(a),"keydown",(function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":a.movementSpeedMultiplier=.1;break;case"KeyW":a.moveState.forward=1;break;case"KeyS":a.moveState.back=1;break;case"KeyA":a.moveState.left=1;break;case"KeyD":a.moveState.right=1;break;case"KeyR":a.moveState.up=1;break;case"KeyF":a.moveState.down=1;break;case"ArrowUp":a.moveState.pitchUp=1;break;case"ArrowDown":a.moveState.pitchDown=1;break;case"ArrowLeft":a.moveState.yawLeft=1;break;case"ArrowRight":a.moveState.yawRight=1;break;case"KeyQ":a.moveState.rollLeft=1;break;case"KeyE":a.moveState.rollRight=1}a.updateMovementVector(),a.updateRotationVector()}})),Object(D.a)(Object(z.a)(a),"keyup",(function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":a.movementSpeedMultiplier=1;break;case"KeyW":a.moveState.forward=0;break;case"KeyS":a.moveState.back=0;break;case"KeyA":a.moveState.left=0;break;case"KeyD":a.moveState.right=0;break;case"KeyR":a.moveState.up=0;break;case"KeyF":a.moveState.down=0;break;case"ArrowUp":a.moveState.pitchUp=0;break;case"ArrowDown":a.moveState.pitchDown=0;break;case"ArrowLeft":a.moveState.yawLeft=0;break;case"ArrowRight":a.moveState.yawRight=0;break;case"KeyQ":a.moveState.rollLeft=0;break;case"KeyE":a.moveState.rollRight=0}a.updateMovementVector(),a.updateRotationVector()})),Object(D.a)(Object(z.a)(a),"mousedown",(function(e){if(a.dragToLook)a.mouseStatus++;else{switch(e.button){case 0:a.moveState.forward=1;break;case 2:a.moveState.back=1}a.updateMovementVector()}})),Object(D.a)(Object(z.a)(a),"mousemove",(function(e){if(!a.dragToLook||a.mouseStatus>0){var t=a.getContainerDimensions(),n=t.size[0]/2,r=t.size[1]/2;a.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,a.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,a.updateRotationVector()}})),Object(D.a)(Object(z.a)(a),"mouseup",(function(e){if(a.dragToLook)a.mouseStatus--,a.moveState.yawLeft=a.moveState.pitchDown=0;else{switch(e.button){case 0:a.moveState.forward=0;break;case 2:a.moveState.back=0}a.updateMovementVector()}a.updateRotationVector()})),Object(D.a)(Object(z.a)(a),"lastQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(a),"lastPosition",new g.Vector3),Object(D.a)(Object(z.a)(a),"update",(function(e){var t=e*a.movementSpeed,n=e*a.rollSpeed;a.object.translateX(a.moveVector.x*t),a.object.translateY(a.moveVector.y*t),a.object.translateZ(a.moveVector.z*t),a.tmpQuaternion.set(a.rotationVector.x*n,a.rotationVector.y*n,a.rotationVector.z*n,1).normalize(),a.object.quaternion.multiply(a.tmpQuaternion),(a.lastPosition.distanceToSquared(a.object.position)>a.EPS||8*(1-a.lastQuaternion.dot(a.object.quaternion))>a.EPS)&&(a.dispatchEvent(a.changeEvent),a.lastQuaternion.copy(a.object.quaternion),a.lastPosition.copy(a.object.position))})),Object(D.a)(Object(z.a)(a),"updateMovementVector",(function(){var e=a.moveState.forward||a.autoForward&&!a.moveState.back?1:0;a.moveVector.x=-a.moveState.left+a.moveState.right,a.moveVector.y=-a.moveState.down+a.moveState.up,a.moveVector.z=-e+a.moveState.back})),Object(D.a)(Object(z.a)(a),"updateRotationVector",(function(){a.rotationVector.x=-a.moveState.pitchDown+a.moveState.pitchUp,a.rotationVector.y=-a.moveState.yawRight+a.moveState.yawLeft,a.rotationVector.z=-a.moveState.rollRight+a.moveState.rollLeft})),Object(D.a)(Object(z.a)(a),"getContainerDimensions",(function(){return a.domElement==document||a.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[a.domElement.offsetWidth,a.domElement.offsetHeight],offset:[a.domElement.offsetLeft,a.domElement.offsetTop]}})),Object(D.a)(Object(z.a)(a),"dispose",(function(){a.domElement.removeEventListener("contextmenu",tn),a.domElement.removeEventListener("mousemove",a.mousemove),a.domElement.removeEventListener("mousedown",a.mousedown),a.domElement.removeEventListener("mouseup",a.mouseup),window.removeEventListener("keydown",a.keydown),window.removeEventListener("keyup",a.keyup)})),void 0===r&&(console.warn('THREE.FlyControls: The second parameter "domElement" is now mandatory.'),r=document),a.object=e,a.domElement=r,!r||r instanceof Document||r.setAttribute("tabindex",-1),a.domElement.addEventListener("contextmenu",tn),a.domElement.addEventListener("mousemove",a.mousemove),a.domElement.addEventListener("mousedown",a.mousedown),a.domElement.addEventListener("mouseup",a.mouseup),window.addEventListener("keydown",a.keydown),window.addEventListener("keyup",a.keyup),a.updateMovementVector(),a.updateRotationVector(),a}return Object(W.a)(n)}(g.EventDispatcher),rn=["onChange"],an=i.forwardRef((function(e,t){var n=e.onChange,r=Object(p.a)(e,rn),a=Object(o.useThree)((function(e){return e.invalidate})),s=Object(o.useThree)((function(e){return e.camera})),c=Object(o.useThree)((function(e){return e.gl})),u=i.useState((function(){return new nn(s,c.domElement)})),g=Object(l.a)(u,1)[0];return i.useEffect((function(){var e=function(e){a(),n&&n(e)};return null==g||null==g.addEventListener||g.addEventListener("change",e),function(){return null==g||null==g.removeEventListener?void 0:g.removeEventListener("change",e)}}),[n,g,a]),Object(o.useFrame)((function(e,t){return null==g?void 0:g.update(t)})),g?i.createElement("primitive",Object(m.a)({ref:t,dispose:void 0,object:g},r)):null})),on=function(e,t){return(e%t+t)%t},sn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"object",void 0),Object(D.a)(Object(z.a)(a),"domElement",void 0),Object(D.a)(Object(z.a)(a),"enabled",!0),Object(D.a)(Object(z.a)(a),"target",new g.Vector3),Object(D.a)(Object(z.a)(a),"minDistance",0),Object(D.a)(Object(z.a)(a),"maxDistance",1/0),Object(D.a)(Object(z.a)(a),"minZoom",0),Object(D.a)(Object(z.a)(a),"maxZoom",1/0),Object(D.a)(Object(z.a)(a),"minPolarAngle",0),Object(D.a)(Object(z.a)(a),"maxPolarAngle",Math.PI),Object(D.a)(Object(z.a)(a),"minAzimuthAngle",-1/0),Object(D.a)(Object(z.a)(a),"maxAzimuthAngle",1/0),Object(D.a)(Object(z.a)(a),"enableDamping",!1),Object(D.a)(Object(z.a)(a),"dampingFactor",.05),Object(D.a)(Object(z.a)(a),"enableZoom",!0),Object(D.a)(Object(z.a)(a),"zoomSpeed",1),Object(D.a)(Object(z.a)(a),"enableRotate",!0),Object(D.a)(Object(z.a)(a),"rotateSpeed",1),Object(D.a)(Object(z.a)(a),"enablePan",!0),Object(D.a)(Object(z.a)(a),"panSpeed",1),Object(D.a)(Object(z.a)(a),"screenSpacePanning",!0),Object(D.a)(Object(z.a)(a),"keyPanSpeed",7),Object(D.a)(Object(z.a)(a),"autoRotate",!1),Object(D.a)(Object(z.a)(a),"autoRotateSpeed",2),Object(D.a)(Object(z.a)(a),"reverseOrbit",!1),Object(D.a)(Object(z.a)(a),"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Object(D.a)(Object(z.a)(a),"mouseButtons",{LEFT:g.MOUSE.ROTATE,MIDDLE:g.MOUSE.DOLLY,RIGHT:g.MOUSE.PAN}),Object(D.a)(Object(z.a)(a),"touches",{ONE:g.TOUCH.ROTATE,TWO:g.TOUCH.DOLLY_PAN}),Object(D.a)(Object(z.a)(a),"target0",void 0),Object(D.a)(Object(z.a)(a),"position0",void 0),Object(D.a)(Object(z.a)(a),"zoom0",void 0),Object(D.a)(Object(z.a)(a),"_domElementKeyEvents",null),Object(D.a)(Object(z.a)(a),"getPolarAngle",void 0),Object(D.a)(Object(z.a)(a),"getAzimuthalAngle",void 0),Object(D.a)(Object(z.a)(a),"setPolarAngle",void 0),Object(D.a)(Object(z.a)(a),"setAzimuthalAngle",void 0),Object(D.a)(Object(z.a)(a),"getDistance",void 0),Object(D.a)(Object(z.a)(a),"listenToKeyEvents",void 0),Object(D.a)(Object(z.a)(a),"saveState",void 0),Object(D.a)(Object(z.a)(a),"reset",void 0),Object(D.a)(Object(z.a)(a),"update",void 0),Object(D.a)(Object(z.a)(a),"connect",void 0),Object(D.a)(Object(z.a)(a),"dispose",void 0),a.object=e,a.domElement=r,a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.zoom0=a.object instanceof g.PerspectiveCamera?a.object.zoom:1,a.getPolarAngle=function(){return I.phi},a.getAzimuthalAngle=function(){return I.theta},a.setPolarAngle=function(e){var t=on(e,2*Math.PI),n=I.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),A.phi=t-n,i.update()},a.setAzimuthalAngle=function(e){var t=on(e,2*Math.PI),n=I.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),A.theta=t-n,i.update()},a.getDistance=function(){return i.object.position.distanceTo(i.target)},a.listenToKeyEvents=function(e){e.addEventListener("keydown",$),a._domElementKeyEvents=e},a.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object instanceof g.PerspectiveCamera?i.object.zoom:1},a.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object instanceof g.PerspectiveCamera&&(i.object.zoom=i.zoom0,i.object.updateProjectionMatrix()),i.dispatchEvent(o),i.update(),l=u.NONE},a.update=function(){var t=new g.Vector3,n=(new g.Quaternion).setFromUnitVectors(e.up,new g.Vector3(0,1,0)),r=n.clone().invert(),a=new g.Vector3,s=new g.Quaternion,c=2*Math.PI;return function(){var e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(n),I.setFromVector3(t),i.autoRotate&&l===u.NONE&&R(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(I.theta+=A.theta*i.dampingFactor,I.phi+=A.phi*i.dampingFactor):(I.theta+=A.theta,I.phi+=A.phi);var g=i.minAzimuthAngle,p=i.maxAzimuthAngle;return isFinite(g)&&isFinite(p)&&(g<-Math.PI?g+=c:g>Math.PI&&(g-=c),p<-Math.PI?p+=c:p>Math.PI&&(p-=c),I.theta=g<=p?Math.max(g,Math.min(p,I.theta)):I.theta>(g+p)/2?Math.max(g,I.theta):Math.min(p,I.theta)),I.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,I.phi)),I.makeSafe(),I.radius*=h,I.radius=Math.max(i.minDistance,Math.min(i.maxDistance,I.radius)),!0===i.enableDamping?i.target.addScaledVector(C,i.dampingFactor):i.target.add(C),t.setFromSpherical(I),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(A.theta*=1-i.dampingFactor,A.phi*=1-i.dampingFactor,C.multiplyScalar(1-i.dampingFactor)):(A.set(0,0,0),C.set(0,0,0)),h=1,!!(f||a.distanceToSquared(i.object.position)>d||8*(1-s.dot(i.object.quaternion))>d)&&(i.dispatchEvent(o),a.copy(i.object.position),s.copy(i.object.quaternion),f=!1,!0)}}(),a.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=e,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",ee),i.domElement.addEventListener("pointerdown",U),i.domElement.addEventListener("pointercancel",J),i.domElement.addEventListener("wheel",q)},a.dispose=function(){var e,t,n,r,a,o;null===(e=i.domElement)||void 0===e||e.removeEventListener("contextmenu",ee),null===(t=i.domElement)||void 0===t||t.removeEventListener("pointerdown",U),null===(n=i.domElement)||void 0===n||n.removeEventListener("pointercancel",J),null===(r=i.domElement)||void 0===r||r.removeEventListener("wheel",q),null===(a=i.domElement)||void 0===a||a.ownerDocument.removeEventListener("pointermove",Q),null===(o=i.domElement)||void 0===o||o.ownerDocument.removeEventListener("pointerup",P),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",$)};var i=Object(z.a)(a),o={type:"change"},s={type:"start"},c={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=u.NONE,d=1e-6,I=new g.Spherical,A=new g.Spherical,h=1,C=new g.Vector3,f=!1,p=new g.Vector2,m=new g.Vector2,v=new g.Vector2,b=new g.Vector2,y=new g.Vector2,B=new g.Vector2,G=new g.Vector2,w=new g.Vector2,_=new g.Vector2,Z=[],S={};function x(){return Math.pow(.95,i.zoomSpeed)}function R(e){i.reverseOrbit?A.theta+=e:A.theta-=e}function M(e){i.reverseOrbit?A.phi+=e:A.phi-=e}var k=function(){var e=new g.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),C.add(e)}}(),W=function(){var e=new g.Vector3;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),C.add(e)}}(),V=function(){var e=new g.Vector3;return function(t,n){var r=i.domElement;if(r&&i.object instanceof g.PerspectiveCamera&&i.object.isPerspectiveCamera){var a=i.object.position;e.copy(a).sub(i.target);var o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),k(2*t*o/r.clientHeight,i.object.matrix),W(2*n*o/r.clientHeight,i.object.matrix)}else r&&i.object instanceof g.OrthographicCamera&&i.object.isOrthographicCamera?(k(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),W(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function F(e){i.object instanceof g.PerspectiveCamera&&i.object.isPerspectiveCamera?h/=e:i.object instanceof g.OrthographicCamera&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function X(e){i.object instanceof g.PerspectiveCamera&&i.object.isPerspectiveCamera?h*=e:i.object instanceof g.OrthographicCamera&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function H(e){p.set(e.clientX,e.clientY)}function O(e){b.set(e.clientX,e.clientY)}function L(){if(1==Z.length)p.set(Z[0].pageX,Z[0].pageY);else{var e=.5*(Z[0].pageX+Z[1].pageX),t=.5*(Z[0].pageY+Z[1].pageY);p.set(e,t)}}function N(){if(1==Z.length)b.set(Z[0].pageX,Z[0].pageY);else{var e=.5*(Z[0].pageX+Z[1].pageX),t=.5*(Z[0].pageY+Z[1].pageY);b.set(e,t)}}function Y(){var e=Z[0].pageX-Z[1].pageX,t=Z[0].pageY-Z[1].pageY,n=Math.sqrt(e*e+t*t);G.set(0,n)}function T(e){if(1==Z.length)m.set(e.pageX,e.pageY);else{var t=re(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}v.subVectors(m,p).multiplyScalar(i.rotateSpeed);var a=i.domElement;a&&(R(2*Math.PI*v.x/a.clientHeight),M(2*Math.PI*v.y/a.clientHeight)),p.copy(m)}function K(e){if(1==Z.length)y.set(e.pageX,e.pageY);else{var t=re(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(n,r)}B.subVectors(y,b).multiplyScalar(i.panSpeed),V(B.x,B.y),b.copy(y)}function j(e){var t=re(e),n=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(n*n+r*r);w.set(0,a),_.set(0,Math.pow(w.y/G.y,i.zoomSpeed)),F(_.y),G.copy(w)}function U(e){if(!1!==i.enabled){var t,n;if(0===Z.length)null===(t=i.domElement)||void 0===t||t.ownerDocument.addEventListener("pointermove",Q),null===(n=i.domElement)||void 0===n||n.ownerDocument.addEventListener("pointerup",P);!function(e){Z.push(e)}(e),"touch"===e.pointerType?function(e){switch(ne(e),Z.length){case 1:switch(i.touches.ONE){case g.TOUCH.ROTATE:if(!1===i.enableRotate)return;L(),l=u.TOUCH_ROTATE;break;case g.TOUCH.PAN:if(!1===i.enablePan)return;N(),l=u.TOUCH_PAN;break;default:l=u.NONE}break;case 2:switch(i.touches.TWO){case g.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&Y(),i.enablePan&&N(),l=u.TOUCH_DOLLY_PAN;break;case g.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&Y(),i.enableRotate&&L(),l=u.TOUCH_DOLLY_ROTATE;break;default:l=u.NONE}break;default:l=u.NONE}l!==u.NONE&&i.dispatchEvent(s)}(e):function(e){var t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case g.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){G.set(e.clientX,e.clientY)}(e),l=u.DOLLY;break;case g.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;O(e),l=u.PAN}else{if(!1===i.enableRotate)return;H(e),l=u.ROTATE}break;case g.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;H(e),l=u.ROTATE}else{if(!1===i.enablePan)return;O(e),l=u.PAN}break;default:l=u.NONE}l!==u.NONE&&i.dispatchEvent(s)}(e)}}function Q(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(ne(e),l){case u.TOUCH_ROTATE:if(!1===i.enableRotate)return;T(e),i.update();break;case u.TOUCH_PAN:if(!1===i.enablePan)return;K(e),i.update();break;case u.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&j(e),i.enablePan&&K(e)}(e),i.update();break;case u.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&j(e),i.enableRotate&&T(e)}(e),i.update();break;default:l=u.NONE}}(e):function(e){if(!1===i.enabled)return;switch(l){case u.ROTATE:if(!1===i.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,p).multiplyScalar(i.rotateSpeed);var t=i.domElement;t&&(R(2*Math.PI*v.x/t.clientHeight),M(2*Math.PI*v.y/t.clientHeight)),p.copy(m),i.update()}(e);break;case u.DOLLY:if(!1===i.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,G),_.y>0?F(x()):_.y<0&&X(x()),G.copy(w),i.update()}(e);break;case u.PAN:if(!1===i.enablePan)return;!function(e){y.set(e.clientX,e.clientY),B.subVectors(y,b).multiplyScalar(i.panSpeed),V(B.x,B.y),b.copy(y),i.update()}(e)}}(e))}function P(e){var t,n,r;(te(e),0===Z.length)&&(null===(t=i.domElement)||void 0===t||t.releasePointerCapture(e.pointerId),null===(n=i.domElement)||void 0===n||n.ownerDocument.removeEventListener("pointermove",Q),null===(r=i.domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerup",P));i.dispatchEvent(c),l=u.NONE}function J(e){te(e)}function q(e){!1===i.enabled||!1===i.enableZoom||l!==u.NONE&&l!==u.ROTATE||(e.preventDefault(),i.dispatchEvent(s),function(e){e.deltaY<0?X(x()):e.deltaY>0&&F(x()),i.update()}(e),i.dispatchEvent(c))}function $(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){var t=!1;switch(e.code){case i.keys.UP:V(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:V(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:V(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:V(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function ee(e){!1!==i.enabled&&e.preventDefault()}function te(e){delete S[e.pointerId];for(var t=0;t<Z.length;t++)if(Z[t].pointerId==e.pointerId)return void Z.splice(t,1)}function ne(e){var t=S[e.pointerId];void 0===t&&(t=new g.Vector2,S[e.pointerId]=t),t.set(e.pageX,e.pageY)}function re(e){var t=e.pointerId===Z[0].pointerId?Z[1]:Z[0];return S[t.pointerId]}return void 0!==r&&a.connect(r),a.update(),a}return Object(W.a)(n)}(g.EventDispatcher),cn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),(a=t.call(this,e,r)).screenSpacePanning=!1,a.mouseButtons.LEFT=g.MOUSE.PAN,a.mouseButtons.RIGHT=g.MOUSE.ROTATE,a.touches.ONE=g.TOUCH.PAN,a.touches.TWO=g.TOUCH.DOLLY_ROTATE,a}return Object(W.a)(n)}(sn),un=["camera","onChange","onStart","onEnd"],ln=i.forwardRef((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableDamping:!0},t=arguments.length>1?arguments[1]:void 0,n=e.camera,r=e.onChange,a=e.onStart,s=e.onEnd,c=Object(p.a)(e,un),u=Object(o.useThree)((function(e){return e.invalidate})),l=Object(o.useThree)((function(e){return e.camera})),g=Object(o.useThree)((function(e){return e.gl.domElement})),d=n||l,I=i.useMemo((function(){return new cn(d)}),[d]);return i.useEffect((function(){I.connect(g);var e=function(e){u(),r&&r(e)};return I.addEventListener("change",e),a&&I.addEventListener("start",a),s&&I.addEventListener("end",s),function(){I.dispose(),I.removeEventListener("change",e),a&&I.removeEventListener("start",a),s&&I.removeEventListener("end",s)}}),[r,a,s,I,u,g]),Object(o.useFrame)((function(){return I.update()})),i.createElement("primitive",Object(m.a)({ref:t,dispose:void 0,object:I,enableDamping:!0},c))})),gn=["makeDefault","camera","regress","domElement","enableDamping","onChange","onStart","onEnd"],dn=i.forwardRef((function(e,t){var n=e.makeDefault,r=e.camera,a=e.regress,s=e.domElement,c=e.enableDamping,u=void 0===c||c,l=e.onChange,g=e.onStart,d=e.onEnd,I=Object(p.a)(e,gn),A=Object(o.useThree)((function(e){return e.invalidate})),h=Object(o.useThree)((function(e){return e.camera})),C=Object(o.useThree)((function(e){return e.gl})),f=Object(o.useThree)((function(e){return e.events})),v=Object(o.useThree)((function(e){return e.set})),b=Object(o.useThree)((function(e){return e.get})),y=Object(o.useThree)((function(e){return e.performance})),B=r||h,G=s||f.connected||C.domElement,w=i.useMemo((function(){return new sn(B)}),[B]);return Object(o.useFrame)((function(){w.enabled&&w.update()})),i.useEffect((function(){return w.connect(G),function(){w.dispose()}}),[G,a,w,A]),i.useEffect((function(){var e=function(e){A(),a&&y.regress(),l&&l(e)};return w.addEventListener("change",e),g&&w.addEventListener("start",g),d&&w.addEventListener("end",d),function(){g&&w.removeEventListener("start",g),d&&w.removeEventListener("end",d),w.removeEventListener("change",e)}}),[l,g,d]),i.useEffect((function(){if(n){var e=b().controls;return v({controls:w}),function(){return v({controls:e})}}}),[n,w]),i.createElement("primitive",Object(m.a)({ref:t,object:w,enableDamping:u},I))})),In=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"enabled",!0),Object(D.a)(Object(z.a)(a),"screen",{left:0,top:0,width:0,height:0}),Object(D.a)(Object(z.a)(a),"rotateSpeed",1),Object(D.a)(Object(z.a)(a),"zoomSpeed",1.2),Object(D.a)(Object(z.a)(a),"panSpeed",.3),Object(D.a)(Object(z.a)(a),"noRotate",!1),Object(D.a)(Object(z.a)(a),"noZoom",!1),Object(D.a)(Object(z.a)(a),"noPan",!1),Object(D.a)(Object(z.a)(a),"staticMoving",!1),Object(D.a)(Object(z.a)(a),"dynamicDampingFactor",.2),Object(D.a)(Object(z.a)(a),"minDistance",0),Object(D.a)(Object(z.a)(a),"maxDistance",1/0),Object(D.a)(Object(z.a)(a),"keys",["KeyA","KeyS","KeyD"]),Object(D.a)(Object(z.a)(a),"mouseButtons",{LEFT:g.MOUSE.ROTATE,MIDDLE:g.MOUSE.DOLLY,RIGHT:g.MOUSE.PAN}),Object(D.a)(Object(z.a)(a),"object",void 0),Object(D.a)(Object(z.a)(a),"domElement",void 0),Object(D.a)(Object(z.a)(a),"cursorZoom",!1),Object(D.a)(Object(z.a)(a),"target",new g.Vector3),Object(D.a)(Object(z.a)(a),"mousePosition",new g.Vector2),Object(D.a)(Object(z.a)(a),"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),Object(D.a)(Object(z.a)(a),"EPS",1e-6),Object(D.a)(Object(z.a)(a),"lastZoom",1),Object(D.a)(Object(z.a)(a),"lastPosition",new g.Vector3),Object(D.a)(Object(z.a)(a),"cursorVector",new g.Vector3),Object(D.a)(Object(z.a)(a),"targetVector",new g.Vector3),Object(D.a)(Object(z.a)(a),"_state",a.STATE.NONE),Object(D.a)(Object(z.a)(a),"_keyState",a.STATE.NONE),Object(D.a)(Object(z.a)(a),"_eye",new g.Vector3),Object(D.a)(Object(z.a)(a),"_movePrev",new g.Vector2),Object(D.a)(Object(z.a)(a),"_moveCurr",new g.Vector2),Object(D.a)(Object(z.a)(a),"_lastAxis",new g.Vector3),Object(D.a)(Object(z.a)(a),"_lastAngle",0),Object(D.a)(Object(z.a)(a),"_zoomStart",new g.Vector2),Object(D.a)(Object(z.a)(a),"_zoomEnd",new g.Vector2),Object(D.a)(Object(z.a)(a),"_touchZoomDistanceStart",0),Object(D.a)(Object(z.a)(a),"_touchZoomDistanceEnd",0),Object(D.a)(Object(z.a)(a),"_panStart",new g.Vector2),Object(D.a)(Object(z.a)(a),"_panEnd",new g.Vector2),Object(D.a)(Object(z.a)(a),"target0",void 0),Object(D.a)(Object(z.a)(a),"position0",void 0),Object(D.a)(Object(z.a)(a),"up0",void 0),Object(D.a)(Object(z.a)(a),"zoom0",void 0),Object(D.a)(Object(z.a)(a),"changeEvent",{type:"change"}),Object(D.a)(Object(z.a)(a),"startEvent",{type:"start"}),Object(D.a)(Object(z.a)(a),"endEvent",{type:"end"}),Object(D.a)(Object(z.a)(a),"onScreenVector",new g.Vector2),Object(D.a)(Object(z.a)(a),"getMouseOnScreen",(function(e,t){return a.onScreenVector.set((e-a.screen.left)/a.screen.width,(t-a.screen.top)/a.screen.height),a.onScreenVector})),Object(D.a)(Object(z.a)(a),"onCircleVector",new g.Vector2),Object(D.a)(Object(z.a)(a),"getMouseOnCircle",(function(e,t){return a.onCircleVector.set((e-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-t))/a.screen.width),a.onCircleVector})),Object(D.a)(Object(z.a)(a),"axis",new g.Vector3),Object(D.a)(Object(z.a)(a),"quaternion",new g.Quaternion),Object(D.a)(Object(z.a)(a),"eyeDirection",new g.Vector3),Object(D.a)(Object(z.a)(a),"objectUpDirection",new g.Vector3),Object(D.a)(Object(z.a)(a),"objectSidewaysDirection",new g.Vector3),Object(D.a)(Object(z.a)(a),"moveDirection",new g.Vector3),Object(D.a)(Object(z.a)(a),"angle",0),Object(D.a)(Object(z.a)(a),"rotateCamera",(function(){a.moveDirection.set(a._moveCurr.x-a._movePrev.x,a._moveCurr.y-a._movePrev.y,0),a.angle=a.moveDirection.length(),a.angle?(a._eye.copy(a.object.position).sub(a.target),a.eyeDirection.copy(a._eye).normalize(),a.objectUpDirection.copy(a.object.up).normalize(),a.objectSidewaysDirection.crossVectors(a.objectUpDirection,a.eyeDirection).normalize(),a.objectUpDirection.setLength(a._moveCurr.y-a._movePrev.y),a.objectSidewaysDirection.setLength(a._moveCurr.x-a._movePrev.x),a.moveDirection.copy(a.objectUpDirection.add(a.objectSidewaysDirection)),a.axis.crossVectors(a.moveDirection,a._eye).normalize(),a.angle*=a.rotateSpeed,a.quaternion.setFromAxisAngle(a.axis,a.angle),a._eye.applyQuaternion(a.quaternion),a.object.up.applyQuaternion(a.quaternion),a._lastAxis.copy(a.axis),a._lastAngle=a.angle):!a.staticMoving&&a._lastAngle&&(a._lastAngle*=Math.sqrt(1-a.dynamicDampingFactor),a._eye.copy(a.object.position).sub(a.target),a.quaternion.setFromAxisAngle(a._lastAxis,a._lastAngle),a._eye.applyQuaternion(a.quaternion),a.object.up.applyQuaternion(a.quaternion)),a._movePrev.copy(a._moveCurr)})),Object(D.a)(Object(z.a)(a),"zoomCamera",(function(){var e;if(a._state===a.STATE.TOUCH_ZOOM_PAN)e=a._touchZoomDistanceStart/a._touchZoomDistanceEnd,a._touchZoomDistanceStart=a._touchZoomDistanceEnd,a.object.isPerspectiveCamera?a._eye.multiplyScalar(e):a.object.isOrthographicCamera?(a.object.zoom/=e,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(e=1+(a._zoomEnd.y-a._zoomStart.y)*a.zoomSpeed,Math.abs(e-1)>a.EPS&&e>0&&(a.object.isPerspectiveCamera?(e>1&&a._eye.length()>=a.maxDistance-a.EPS&&(e=1),a._eye.multiplyScalar(e)):a.object.isOrthographicCamera?(e>1&&a.object.zoom<a.maxDistance*a.maxDistance&&(e=1),a.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),a.staticMoving?a._zoomStart.copy(a._zoomEnd):a._zoomStart.y+=(a._zoomEnd.y-a._zoomStart.y)*a.dynamicDampingFactor,a.cursorZoom){a.targetVector.copy(a.target).project(a.object);var t=a.cursorVector.set(a.mousePosition.x,a.mousePosition.y,a.targetVector.z).unproject(a.object);a.target.lerpVectors(t,a.target,e)}a.object.isOrthographicCamera&&a.object.updateProjectionMatrix()}})),Object(D.a)(Object(z.a)(a),"mouseChange",new g.Vector2),Object(D.a)(Object(z.a)(a),"objectUp",new g.Vector3),Object(D.a)(Object(z.a)(a),"pan",new g.Vector3),Object(D.a)(Object(z.a)(a),"panCamera",(function(){if(a.domElement&&(a.mouseChange.copy(a._panEnd).sub(a._panStart),a.mouseChange.lengthSq()>a.EPS)){if(a.object.isOrthographicCamera){var e=a.object,t=(e.right-e.left)/a.object.zoom,n=(e.top-e.bottom)/a.object.zoom;a.mouseChange.x*=t,a.mouseChange.y*=n}else a.mouseChange.multiplyScalar(a._eye.length()*a.panSpeed);a.pan.copy(a._eye).cross(a.object.up).setLength(a.mouseChange.x),a.pan.add(a.objectUp.copy(a.object.up).setLength(a.mouseChange.y)),a.object.position.add(a.pan),a.target.add(a.pan),a.staticMoving?a._panStart.copy(a._panEnd):a._panStart.add(a.mouseChange.subVectors(a._panEnd,a._panStart).multiplyScalar(a.dynamicDampingFactor))}})),Object(D.a)(Object(z.a)(a),"checkDistances",(function(){a.noZoom&&a.noPan||(a._eye.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,a._eye.setLength(a.maxDistance)),a._zoomStart.copy(a._zoomEnd)),a._eye.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,a._eye.setLength(a.minDistance)),a._zoomStart.copy(a._zoomEnd)))})),Object(D.a)(Object(z.a)(a),"handleResize",(function(){if(a.domElement){var e=a.domElement.getBoundingClientRect(),t=a.domElement.ownerDocument.documentElement;a.screen.left=e.left+window.pageXOffset-t.clientLeft,a.screen.top=e.top+window.pageYOffset-t.clientTop,a.screen.width=e.width,a.screen.height=e.height}})),Object(D.a)(Object(z.a)(a),"update",(function(){a._eye.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,a._eye),a.object.isPerspectiveCamera?(a.checkDistances(),a.object.lookAt(a.target),a.lastPosition.distanceToSquared(a.object.position)>a.EPS&&(a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position))):a.object.isOrthographicCamera?(a.object.lookAt(a.target),(a.lastPosition.distanceToSquared(a.object.position)>a.EPS||a.lastZoom!==a.object.zoom)&&(a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position),a.lastZoom=a.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")})),Object(D.a)(Object(z.a)(a),"reset",(function(){a._state=a.STATE.NONE,a._keyState=a.STATE.NONE,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),a._eye.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(a.changeEvent),a.lastPosition.copy(a.object.position),a.lastZoom=a.object.zoom})),Object(D.a)(Object(z.a)(a),"keydown",(function(e){!1!==a.enabled&&(window.removeEventListener("keydown",a.keydown),a._keyState===a.STATE.NONE&&(e.code!==a.keys[a.STATE.ROTATE]||a.noRotate?e.code!==a.keys[a.STATE.ZOOM]||a.noZoom?e.code!==a.keys[a.STATE.PAN]||a.noPan||(a._keyState=a.STATE.PAN):a._keyState=a.STATE.ZOOM:a._keyState=a.STATE.ROTATE))})),Object(D.a)(Object(z.a)(a),"onPointerDown",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseDown(e)}})),Object(D.a)(Object(z.a)(a),"onPointerMove",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseMove(e)}})),Object(D.a)(Object(z.a)(a),"onPointerUp",(function(e){if(!1!==a.enabled)switch(e.pointerType){case"mouse":case"pen":a.onMouseUp()}})),Object(D.a)(Object(z.a)(a),"keyup",(function(){!1!==a.enabled&&(a._keyState=a.STATE.NONE,window.addEventListener("keydown",a.keydown))})),Object(D.a)(Object(z.a)(a),"onMouseDown",(function(e){if(a.domElement){if(a._state===a.STATE.NONE)switch(e.button){case a.mouseButtons.LEFT:a._state=a.STATE.ROTATE;break;case a.mouseButtons.MIDDLE:a._state=a.STATE.ZOOM;break;case a.mouseButtons.RIGHT:a._state=a.STATE.PAN;break;default:a._state=a.STATE.NONE}var t=a._keyState!==a.STATE.NONE?a._keyState:a._state;t!==a.STATE.ROTATE||a.noRotate?t!==a.STATE.ZOOM||a.noZoom?t!==a.STATE.PAN||a.noPan||(a._panStart.copy(a.getMouseOnScreen(e.pageX,e.pageY)),a._panEnd.copy(a._panStart)):(a._zoomStart.copy(a.getMouseOnScreen(e.pageX,e.pageY)),a._zoomEnd.copy(a._zoomStart)):(a._moveCurr.copy(a.getMouseOnCircle(e.pageX,e.pageY)),a._movePrev.copy(a._moveCurr)),a.domElement.ownerDocument.addEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.addEventListener("pointerup",a.onPointerUp),a.dispatchEvent(a.startEvent)}})),Object(D.a)(Object(z.a)(a),"onMouseMove",(function(e){if(!1!==a.enabled){var t=a._keyState!==a.STATE.NONE?a._keyState:a._state;t!==a.STATE.ROTATE||a.noRotate?t!==a.STATE.ZOOM||a.noZoom?t!==a.STATE.PAN||a.noPan||a._panEnd.copy(a.getMouseOnScreen(e.pageX,e.pageY)):a._zoomEnd.copy(a.getMouseOnScreen(e.pageX,e.pageY)):(a._movePrev.copy(a._moveCurr),a._moveCurr.copy(a.getMouseOnCircle(e.pageX,e.pageY)))}})),Object(D.a)(Object(z.a)(a),"onMouseUp",(function(){a.domElement&&!1!==a.enabled&&(a._state=a.STATE.NONE,a.domElement.ownerDocument.removeEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.removeEventListener("pointerup",a.onPointerUp),a.dispatchEvent(a.endEvent))})),Object(D.a)(Object(z.a)(a),"mousewheel",(function(e){if(!1!==a.enabled&&!0!==a.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:a._zoomStart.y-=.025*e.deltaY;break;case 1:a._zoomStart.y-=.01*e.deltaY;break;default:a._zoomStart.y-=25e-5*e.deltaY}a.mousePosition.x=e.offsetX/a.screen.width*2-1,a.mousePosition.y=-e.offsetY/a.screen.height*2+1,a.dispatchEvent(a.startEvent),a.dispatchEvent(a.endEvent)}})),Object(D.a)(Object(z.a)(a),"touchstart",(function(e){if(!1!==a.enabled){if(e.preventDefault(),1===e.touches.length)a._state=a.STATE.TOUCH_ROTATE,a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),a._movePrev.copy(a._moveCurr);else{a._state=a.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;a._touchZoomDistanceEnd=a._touchZoomDistanceStart=Math.sqrt(t*t+n*n);var r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;a._panStart.copy(a.getMouseOnScreen(r,i)),a._panEnd.copy(a._panStart)}a.dispatchEvent(a.startEvent)}})),Object(D.a)(Object(z.a)(a),"touchmove",(function(e){if(!1!==a.enabled)if(e.preventDefault(),1===e.touches.length)a._movePrev.copy(a._moveCurr),a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;a._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);var r=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;a._panEnd.copy(a.getMouseOnScreen(r,i))}})),Object(D.a)(Object(z.a)(a),"touchend",(function(e){if(!1!==a.enabled){switch(e.touches.length){case 0:a._state=a.STATE.NONE;break;case 1:a._state=a.STATE.TOUCH_ROTATE,a._moveCurr.copy(a.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),a._movePrev.copy(a._moveCurr)}a.dispatchEvent(a.endEvent)}})),Object(D.a)(Object(z.a)(a),"contextmenu",(function(e){!1!==a.enabled&&e.preventDefault()})),Object(D.a)(Object(z.a)(a),"connect",(function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=e,a.domElement.addEventListener("contextmenu",a.contextmenu),a.domElement.addEventListener("pointerdown",a.onPointerDown),a.domElement.addEventListener("wheel",a.mousewheel),a.domElement.addEventListener("touchstart",a.touchstart),a.domElement.addEventListener("touchend",a.touchend),a.domElement.addEventListener("touchmove",a.touchmove),a.domElement.ownerDocument.addEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.addEventListener("pointerup",a.onPointerUp),window.addEventListener("keydown",a.keydown),window.addEventListener("keyup",a.keyup),a.handleResize()})),Object(D.a)(Object(z.a)(a),"dispose",(function(){a.domElement&&(a.domElement.removeEventListener("contextmenu",a.contextmenu),a.domElement.removeEventListener("pointerdown",a.onPointerDown),a.domElement.removeEventListener("wheel",a.mousewheel),a.domElement.removeEventListener("touchstart",a.touchstart),a.domElement.removeEventListener("touchend",a.touchend),a.domElement.removeEventListener("touchmove",a.touchmove),a.domElement.ownerDocument.removeEventListener("pointermove",a.onPointerMove),a.domElement.ownerDocument.removeEventListener("pointerup",a.onPointerUp),window.removeEventListener("keydown",a.keydown),window.removeEventListener("keyup",a.keyup))})),a.object=e,a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.up0=a.object.up.clone(),a.zoom0=a.object.zoom,void 0!==r&&a.connect(r),a.update(),a}return Object(W.a)(n)}(g.EventDispatcher),An=["makeDefault","camera","domElement","regress","onChange","onStart","onEnd"],hn=i.forwardRef((function(e,t){var n=e.makeDefault,r=e.camera,a=e.domElement,s=e.regress,c=e.onChange,u=e.onStart,l=e.onEnd,g=Object(p.a)(e,An),d=Object(o.useThree)(),I=d.invalidate,A=d.camera,h=d.gl,C=d.events,f=d.set,v=d.get,b=d.performance,y=d.viewport,B=r||A,G=a||C.connected||h.domElement,w=i.useMemo((function(){return new In(B)}),[B]);return Object(o.useFrame)((function(){w.enabled&&w.update()})),i.useEffect((function(){return w.connect(G),function(){w.dispose()}}),[G,s,w,I]),i.useEffect((function(){var e=function(e){I(),s&&b.regress(),c&&c(e)};return w.addEventListener("change",e),u&&w.addEventListener("start",u),l&&w.addEventListener("end",l),function(){u&&w.removeEventListener("start",u),l&&w.removeEventListener("end",l),w.removeEventListener("change",e)}}),[c,u,l]),i.useEffect((function(){w.handleResize()}),[y]),i.useEffect((function(){if(n){var e=v().controls;return f({controls:w}),function(){return f({controls:e})}}}),[n,w]),i.createElement("primitive",Object(m.a)({ref:t,object:w},g))})),Cn={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},fn={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},pn={x:0,y:0},mn={camera:new g.Matrix4,gizmos:new g.Matrix4},vn={type:"change"},bn={type:"start"},yn={type:"end"},Bn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(E.a)(this,n),r=t.call(this),Object(D.a)(Object(z.a)(r),"camera",void 0),Object(D.a)(Object(z.a)(r),"domElement",void 0),Object(D.a)(Object(z.a)(r),"scene",void 0),Object(D.a)(Object(z.a)(r),"mouseActions",void 0),Object(D.a)(Object(z.a)(r),"_mouseOp",void 0),Object(D.a)(Object(z.a)(r),"_v2_1",void 0),Object(D.a)(Object(z.a)(r),"_v3_1",void 0),Object(D.a)(Object(z.a)(r),"_v3_2",void 0),Object(D.a)(Object(z.a)(r),"_m4_1",void 0),Object(D.a)(Object(z.a)(r),"_m4_2",void 0),Object(D.a)(Object(z.a)(r),"_quat",void 0),Object(D.a)(Object(z.a)(r),"_translationMatrix",void 0),Object(D.a)(Object(z.a)(r),"_rotationMatrix",void 0),Object(D.a)(Object(z.a)(r),"_scaleMatrix",void 0),Object(D.a)(Object(z.a)(r),"_rotationAxis",void 0),Object(D.a)(Object(z.a)(r),"_cameraMatrixState",void 0),Object(D.a)(Object(z.a)(r),"_cameraProjectionState",void 0),Object(D.a)(Object(z.a)(r),"_fovState",void 0),Object(D.a)(Object(z.a)(r),"_upState",void 0),Object(D.a)(Object(z.a)(r),"_zoomState",void 0),Object(D.a)(Object(z.a)(r),"_nearPos",void 0),Object(D.a)(Object(z.a)(r),"_farPos",void 0),Object(D.a)(Object(z.a)(r),"_gizmoMatrixState",void 0),Object(D.a)(Object(z.a)(r),"_up0",void 0),Object(D.a)(Object(z.a)(r),"_zoom0",void 0),Object(D.a)(Object(z.a)(r),"_fov0",void 0),Object(D.a)(Object(z.a)(r),"_initialNear",void 0),Object(D.a)(Object(z.a)(r),"_nearPos0",void 0),Object(D.a)(Object(z.a)(r),"_initialFar",void 0),Object(D.a)(Object(z.a)(r),"_farPos0",void 0),Object(D.a)(Object(z.a)(r),"_cameraMatrixState0",void 0),Object(D.a)(Object(z.a)(r),"_gizmoMatrixState0",void 0),Object(D.a)(Object(z.a)(r),"_button",void 0),Object(D.a)(Object(z.a)(r),"_touchStart",void 0),Object(D.a)(Object(z.a)(r),"_touchCurrent",void 0),Object(D.a)(Object(z.a)(r),"_input",void 0),Object(D.a)(Object(z.a)(r),"_switchSensibility",void 0),Object(D.a)(Object(z.a)(r),"_startFingerDistance",void 0),Object(D.a)(Object(z.a)(r),"_currentFingerDistance",void 0),Object(D.a)(Object(z.a)(r),"_startFingerRotation",void 0),Object(D.a)(Object(z.a)(r),"_currentFingerRotation",void 0),Object(D.a)(Object(z.a)(r),"_devPxRatio",void 0),Object(D.a)(Object(z.a)(r),"_downValid",void 0),Object(D.a)(Object(z.a)(r),"_nclicks",void 0),Object(D.a)(Object(z.a)(r),"_downEvents",void 0),Object(D.a)(Object(z.a)(r),"_clickStart",void 0),Object(D.a)(Object(z.a)(r),"_maxDownTime",void 0),Object(D.a)(Object(z.a)(r),"_maxInterval",void 0),Object(D.a)(Object(z.a)(r),"_posThreshold",void 0),Object(D.a)(Object(z.a)(r),"_movementThreshold",void 0),Object(D.a)(Object(z.a)(r),"_currentCursorPosition",void 0),Object(D.a)(Object(z.a)(r),"_startCursorPosition",void 0),Object(D.a)(Object(z.a)(r),"_grid",void 0),Object(D.a)(Object(z.a)(r),"_gridPosition",void 0),Object(D.a)(Object(z.a)(r),"_gizmos",void 0),Object(D.a)(Object(z.a)(r),"_curvePts",void 0),Object(D.a)(Object(z.a)(r),"_timeStart",void 0),Object(D.a)(Object(z.a)(r),"_animationId",void 0),Object(D.a)(Object(z.a)(r),"focusAnimationTime",void 0),Object(D.a)(Object(z.a)(r),"_timePrev",void 0),Object(D.a)(Object(z.a)(r),"_timeCurrent",void 0),Object(D.a)(Object(z.a)(r),"_anglePrev",void 0),Object(D.a)(Object(z.a)(r),"_angleCurrent",void 0),Object(D.a)(Object(z.a)(r),"_cursorPosPrev",void 0),Object(D.a)(Object(z.a)(r),"_cursorPosCurr",void 0),Object(D.a)(Object(z.a)(r),"_wPrev",void 0),Object(D.a)(Object(z.a)(r),"_wCurr",void 0),Object(D.a)(Object(z.a)(r),"adjustNearFar",void 0),Object(D.a)(Object(z.a)(r),"scaleFactor",void 0),Object(D.a)(Object(z.a)(r),"dampingFactor",void 0),Object(D.a)(Object(z.a)(r),"wMax",void 0),Object(D.a)(Object(z.a)(r),"enableAnimations",void 0),Object(D.a)(Object(z.a)(r),"enableGrid",void 0),Object(D.a)(Object(z.a)(r),"cursorZoom",void 0),Object(D.a)(Object(z.a)(r),"minFov",void 0),Object(D.a)(Object(z.a)(r),"maxFov",void 0),Object(D.a)(Object(z.a)(r),"enabled",void 0),Object(D.a)(Object(z.a)(r),"enablePan",void 0),Object(D.a)(Object(z.a)(r),"enableRotate",void 0),Object(D.a)(Object(z.a)(r),"enableZoom",void 0),Object(D.a)(Object(z.a)(r),"minDistance",void 0),Object(D.a)(Object(z.a)(r),"maxDistance",void 0),Object(D.a)(Object(z.a)(r),"minZoom",void 0),Object(D.a)(Object(z.a)(r),"maxZoom",void 0),Object(D.a)(Object(z.a)(r),"target",void 0),Object(D.a)(Object(z.a)(r),"_currentTarget",void 0),Object(D.a)(Object(z.a)(r),"_tbRadius",void 0),Object(D.a)(Object(z.a)(r),"_state",void 0),Object(D.a)(Object(z.a)(r),"onWindowResize",(function(){var e=(r._gizmos.scale.x+r._gizmos.scale.y+r._gizmos.scale.z)/3;if(r.camera){var t=r.calculateTbRadius(r.camera);void 0!==t&&(r._tbRadius=t)}var n=r._tbRadius/e,a=new g.EllipseCurve(0,0,n,n).getPoints(r._curvePts),i=(new g.BufferGeometry).setFromPoints(a);for(var o in r._gizmos.children){r._gizmos.children[o].geometry=i}r.dispatchEvent(vn)})),Object(D.a)(Object(z.a)(r),"onContextMenu",(function(e){if(r.enabled)for(var t=0;t<r.mouseActions.length;t++)if(2==r.mouseActions[t].mouse){e.preventDefault();break}})),Object(D.a)(Object(z.a)(r),"onPointerCancel",(function(){r._touchStart.splice(0,r._touchStart.length),r._touchCurrent.splice(0,r._touchCurrent.length),r._input=fn.NONE})),Object(D.a)(Object(z.a)(r),"onPointerDown",(function(e){if(0==e.button&&e.isPrimary?(r._downValid=!0,r._downEvents.push(e)):r._downValid=!1,"touch"==e.pointerType&&r._input!=fn.CURSOR)switch(r._touchStart.push(e),r._touchCurrent.push(e),r._input){case fn.NONE:r._input=fn.ONE_FINGER,r.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",r.onPointerMove),window.addEventListener("pointerup",r.onPointerUp);break;case fn.ONE_FINGER:case fn.ONE_FINGER_SWITCHED:r._input=fn.TWO_FINGER,r.onRotateStart(),r.onPinchStart(),r.onDoublePanStart();break;case fn.TWO_FINGER:r._input=fn.MULT_FINGER,r.onTriplePanStart()}else if("touch"!=e.pointerType&&r._input==fn.NONE){var t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),r._mouseOp=r.getOpFromAction(e.button,t),r._mouseOp&&(window.addEventListener("pointermove",r.onPointerMove),window.addEventListener("pointerup",r.onPointerUp),r._input=fn.CURSOR,r._button=e.button,r.onSinglePanStart(e,r._mouseOp))}})),Object(D.a)(Object(z.a)(r),"onPointerMove",(function(e){if("touch"==e.pointerType&&r._input!=fn.CURSOR)switch(r._input){case fn.ONE_FINGER:r.updateTouchEvent(e),r.onSinglePanMove(e,Cn.ROTATE);break;case fn.ONE_FINGER_SWITCHED:if(r.calculatePointersDistance(r._touchCurrent[0],e)*r._devPxRatio>=r._switchSensibility){r._input=fn.ONE_FINGER,r.updateTouchEvent(e),r.onSinglePanStart(e,"ROTATE");break}break;case fn.TWO_FINGER:r.updateTouchEvent(e),r.onRotateMove(),r.onPinchMove(),r.onDoublePanMove();break;case fn.MULT_FINGER:r.updateTouchEvent(e),r.onTriplePanMove()}else if("touch"!=e.pointerType&&r._input==fn.CURSOR){var t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");var n=r.getOpStateFromAction(r._button,t);n&&r.onSinglePanMove(e,n)}r._downValid&&(r.calculatePointersDistance(r._downEvents[r._downEvents.length-1],e)*r._devPxRatio>r._movementThreshold&&(r._downValid=!1))})),Object(D.a)(Object(z.a)(r),"onPointerUp",(function(e){if("touch"==e.pointerType&&r._input!=fn.CURSOR){for(var t=r._touchCurrent.length,n=0;n<t;n++)if(r._touchCurrent[n].pointerId==e.pointerId){r._touchCurrent.splice(n,1),r._touchStart.splice(n,1);break}switch(r._input){case fn.ONE_FINGER:case fn.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",r.onPointerMove),window.removeEventListener("pointerup",r.onPointerUp),r._input=fn.NONE,r.onSinglePanEnd();break;case fn.TWO_FINGER:r.onDoublePanEnd(),r.onPinchEnd(),r.onRotateEnd(),r._input=fn.ONE_FINGER_SWITCHED;break;case fn.MULT_FINGER:0==r._touchCurrent.length&&(window.removeEventListener("pointermove",r.onPointerMove),window.removeEventListener("pointerup",r.onPointerUp),r._input=fn.NONE,r.onTriplePanEnd())}}else"touch"!=e.pointerType&&r._input==fn.CURSOR&&(window.removeEventListener("pointermove",r.onPointerMove),window.removeEventListener("pointerup",r.onPointerUp),r._input=fn.NONE,r.onSinglePanEnd(),r._button=-1);if(e.isPrimary)if(r._downValid)if(e.timeStamp-r._downEvents[r._downEvents.length-1].timeStamp<=r._maxDownTime)if(0==r._nclicks)r._nclicks=1,r._clickStart=performance.now();else{var a=e.timeStamp-r._clickStart,i=r.calculatePointersDistance(r._downEvents[1],r._downEvents[0])*r._devPxRatio;a<=r._maxInterval&&i<=r._posThreshold?(r._nclicks=0,r._downEvents.splice(0,r._downEvents.length),r.onDoubleTap(e)):(r._nclicks=1,r._downEvents.shift(),r._clickStart=performance.now())}else r._downValid=!1,r._nclicks=0,r._downEvents.splice(0,r._downEvents.length);else r._nclicks=0,r._downEvents.splice(0,r._downEvents.length)})),Object(D.a)(Object(z.a)(r),"onWheel",(function(e){var t;if(r.enabled&&r.enableZoom&&r.domElement){var n=null;e.ctrlKey||e.metaKey?n="CTRL":e.shiftKey&&(n="SHIFT");var a=r.getOpFromAction("WHEEL",n);if(a){e.preventDefault(),r.dispatchEvent(bn);var i=e.deltaY/125,o=1;switch(i>0?o=1/r.scaleFactor:i<0&&(o=r.scaleFactor),a){case"ZOOM":if(r.updateTbState(Cn.SCALE,!0),i>0?o=1/Math.pow(r.scaleFactor,i):i<0&&(o=Math.pow(r.scaleFactor,-i)),r.cursorZoom&&r.enablePan){var s,c,u,l,d;if("OrthographicCamera"===(null===(s=r.camera)||void 0===s?void 0:s.type))u=null===(l=r.unprojectOnTbPlane(r.camera,e.clientX,e.clientY,r.domElement))||void 0===l?void 0:l.applyQuaternion(r.camera.quaternion).multiplyScalar(1/r.camera.zoom).add(r._gizmos.position);if("PerspectiveCamera"===(null===(c=r.camera)||void 0===c?void 0:c.type))u=null===(d=r.unprojectOnTbPlane(r.camera,e.clientX,e.clientY,r.domElement))||void 0===d?void 0:d.applyQuaternion(r.camera.quaternion).add(r._gizmos.position);void 0!==u&&r.applyTransformMatrix(r.applyScale(o,u))}else r.applyTransformMatrix(r.applyScale(o,r._gizmos.position));r._grid&&(r.disposeGrid(),r.drawGrid()),r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(vn),r.dispatchEvent(yn);break;case"FOV":if("PerspectiveCamera"===(null===(t=r.camera)||void 0===t?void 0:t.type)){r.updateTbState(Cn.FOV,!0),0!=e.deltaX&&(o=1,(i=e.deltaX/125)>0?o=1/Math.pow(r.scaleFactor,i):i<0&&(o=Math.pow(r.scaleFactor,-i))),r._v3_1.setFromMatrixPosition(r._cameraMatrixState);var I=r._v3_1.distanceTo(r._gizmos.position),A=I/o;A=g.MathUtils.clamp(A,r.minDistance,r.maxDistance);var h=I*Math.tan(g.MathUtils.DEG2RAD*r.camera.fov*.5),C=g.MathUtils.RAD2DEG*(2*Math.atan(h/A));C>r.maxFov?C=r.maxFov:C<r.minFov&&(C=r.minFov),o=I/(h/Math.tan(g.MathUtils.DEG2RAD*(C/2))),r.setFov(C),r.applyTransformMatrix(r.applyScale(o,r._gizmos.position,!1))}r._grid&&(r.disposeGrid(),r.drawGrid()),r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(vn),r.dispatchEvent(yn)}}}})),Object(D.a)(Object(z.a)(r),"onSinglePanStart",(function(e,t){var n;if(r.enabled&&r.domElement)switch(r.dispatchEvent(bn),r.setCenter(e.clientX,e.clientY),t){case"PAN":if(!r.enablePan)return;if(-1!=r._animationId&&(cancelAnimationFrame(r._animationId),r._animationId=-1,r._timeStart=-1,r.activateGizmos(!1),r.dispatchEvent(vn)),r.camera){r.updateTbState(Cn.PAN,!0);var a=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement);void 0!==a&&r._startCursorPosition.copy(a),r.enableGrid&&(r.drawGrid(),r.dispatchEvent(vn))}break;case"ROTATE":if(!r.enableRotate)return;if(-1!=r._animationId&&(cancelAnimationFrame(r._animationId),r._animationId=-1,r._timeStart=-1),r.camera){r.updateTbState(Cn.ROTATE,!0);var i=r.unprojectOnTbSurface(r.camera,pn.x,pn.y,r.domElement,r._tbRadius);void 0!==i&&r._startCursorPosition.copy(i),r.activateGizmos(!0),r.enableAnimations&&(r._timePrev=r._timeCurrent=performance.now(),r._angleCurrent=r._anglePrev=0,r._cursorPosPrev.copy(r._startCursorPosition),r._cursorPosCurr.copy(r._cursorPosPrev),r._wCurr=0,r._wPrev=r._wCurr)}r.dispatchEvent(vn);break;case"FOV":if(!r.enableZoom)return;"PerspectiveCamera"===(null===(n=r.camera)||void 0===n?void 0:n.type)&&(-1!=r._animationId&&(cancelAnimationFrame(r._animationId),r._animationId=-1,r._timeStart=-1,r.activateGizmos(!1),r.dispatchEvent(vn)),r.updateTbState(Cn.FOV,!0),r._startCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y),r._currentCursorPosition.copy(r._startCursorPosition));break;case"ZOOM":if(!r.enableZoom)return;-1!=r._animationId&&(cancelAnimationFrame(r._animationId),r._animationId=-1,r._timeStart=-1,r.activateGizmos(!1),r.dispatchEvent(vn)),r.updateTbState(Cn.SCALE,!0),r._startCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y),r._currentCursorPosition.copy(r._startCursorPosition)}})),Object(D.a)(Object(z.a)(r),"onSinglePanMove",(function(e,t){var n;if(r.enabled&&r.domElement){var a=t!=r._state;switch(r.setCenter(e.clientX,e.clientY),t){case Cn.PAN:if(r.enablePan&&r.camera)if(a){r.dispatchEvent(yn),r.dispatchEvent(bn),r.updateTbState(t,!0);var i=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement);void 0!==i&&r._startCursorPosition.copy(i),r.enableGrid&&r.drawGrid(),r.activateGizmos(!1)}else{var o=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement);void 0!==o&&r._currentCursorPosition.copy(o),r.applyTransformMatrix(r.pan(r._startCursorPosition,r._currentCursorPosition))}break;case Cn.ROTATE:if(r.enableRotate&&r.camera)if(a){r.dispatchEvent(yn),r.dispatchEvent(bn),r.updateTbState(t,!0);var s=r.unprojectOnTbSurface(r.camera,pn.x,pn.y,r.domElement,r._tbRadius);void 0!==s&&r._startCursorPosition.copy(s),r.enableGrid&&r.disposeGrid(),r.activateGizmos(!0)}else{var c=r.unprojectOnTbSurface(r.camera,pn.x,pn.y,r.domElement,r._tbRadius);void 0!==c&&r._currentCursorPosition.copy(c);var u=r._startCursorPosition.distanceTo(r._currentCursorPosition),l=r._startCursorPosition.angleTo(r._currentCursorPosition),d=Math.max(u/r._tbRadius,l);r.applyTransformMatrix(r.rotate(r.calculateRotationAxis(r._startCursorPosition,r._currentCursorPosition),d)),r.enableAnimations&&(r._timePrev=r._timeCurrent,r._timeCurrent=performance.now(),r._anglePrev=r._angleCurrent,r._angleCurrent=d,r._cursorPosPrev.copy(r._cursorPosCurr),r._cursorPosCurr.copy(r._currentCursorPosition),r._wPrev=r._wCurr,r._wCurr=r.calculateAngularSpeed(r._anglePrev,r._angleCurrent,r._timePrev,r._timeCurrent))}break;case Cn.SCALE:if(r.enableZoom)if(a)r.dispatchEvent(yn),r.dispatchEvent(bn),r.updateTbState(t,!0),r._startCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y),r._currentCursorPosition.copy(r._startCursorPosition),r.enableGrid&&r.disposeGrid(),r.activateGizmos(!1);else{r._currentCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y);var I=r._currentCursorPosition.y-r._startCursorPosition.y,A=1;I<0?A=1/Math.pow(r.scaleFactor,8*-I):I>0&&(A=Math.pow(r.scaleFactor,8*I)),r.applyTransformMatrix(r.applyScale(A,r._gizmos.position))}break;case Cn.FOV:if(r.enableZoom&&"PerspectiveCamera"===(null===(n=r.camera)||void 0===n?void 0:n.type))if(a)r.dispatchEvent(yn),r.dispatchEvent(bn),r.updateTbState(t,!0),r._startCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y),r._currentCursorPosition.copy(r._startCursorPosition),r.enableGrid&&r.disposeGrid(),r.activateGizmos(!1);else{r._currentCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y);var h=r._currentCursorPosition.y-r._startCursorPosition.y,C=1;h<0?C=1/Math.pow(r.scaleFactor,8*-h):h>0&&(C=Math.pow(r.scaleFactor,8*h)),r._v3_1.setFromMatrixPosition(r._cameraMatrixState);var f=r._v3_1.distanceTo(r._gizmos.position),p=f/C;p=g.MathUtils.clamp(p,r.minDistance,r.maxDistance);var m=f*Math.tan(g.MathUtils.DEG2RAD*r._fovState*.5),v=g.MathUtils.RAD2DEG*(2*Math.atan(m/p));v=g.MathUtils.clamp(v,r.minFov,r.maxFov);var b=m/Math.tan(g.MathUtils.DEG2RAD*(v/2));C=f/b,r._v3_2.setFromMatrixPosition(r._gizmoMatrixState),r.setFov(v),r.applyTransformMatrix(r.applyScale(C,r._v3_2,!1));var y=r._gizmos.position.clone().sub(r.camera.position).normalize().multiplyScalar(b/f);r._m4_1.makeTranslation(y.x,y.y,y.z)}}r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"onSinglePanEnd",(function(){if(r._state==Cn.ROTATE){if(!r.enableRotate)return;if(r.enableAnimations)if(performance.now()-r._timeCurrent<120){var e=Math.abs((r._wPrev+r._wCurr)/2),t=Object(z.a)(r);r._animationId=window.requestAnimationFrame((function(n){t.updateTbState(Cn.ANIMATION_ROTATE,!0);var r=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(n,r,Math.min(e,t.wMax))}))}else r.updateTbState(Cn.IDLE,!1),r.activateGizmos(!1),r.dispatchEvent(vn);else r.updateTbState(Cn.IDLE,!1),r.activateGizmos(!1),r.dispatchEvent(vn)}else r._state!=Cn.PAN&&r._state!=Cn.IDLE||(r.updateTbState(Cn.IDLE,!1),r.enableGrid&&r.disposeGrid(),r.activateGizmos(!1),r.dispatchEvent(vn));r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"onDoubleTap",(function(e){if(r.enabled&&r.enablePan&&r.scene&&r.camera&&r.domElement){r.dispatchEvent(bn),r.setCenter(e.clientX,e.clientY);var t=r.unprojectOnObj(r.getCursorNDC(pn.x,pn.y,r.domElement),r.camera);if(t&&r.enableAnimations){var n=Object(z.a)(r);-1!=r._animationId&&window.cancelAnimationFrame(r._animationId),r._timeStart=-1,r._animationId=window.requestAnimationFrame((function(e){n.updateTbState(Cn.ANIMATION_FOCUS,!0),n.onFocusAnim(e,t,n._cameraMatrixState,n._gizmoMatrixState)}))}else t&&!r.enableAnimations&&(r.updateTbState(Cn.FOCUS,!0),r.focus(t,r.scaleFactor),r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(vn))}r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"onDoublePanStart",(function(){if(r.enabled&&r.enablePan&&r.camera&&r.domElement){r.dispatchEvent(bn),r.updateTbState(Cn.PAN,!0),r.setCenter((r._touchCurrent[0].clientX+r._touchCurrent[1].clientX)/2,(r._touchCurrent[0].clientY+r._touchCurrent[1].clientY)/2);var e=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement,!0);void 0!==e&&r._startCursorPosition.copy(e),r._currentCursorPosition.copy(r._startCursorPosition),r.activateGizmos(!1)}})),Object(D.a)(Object(z.a)(r),"onDoublePanMove",(function(){if(r.enabled&&r.enablePan&&r.camera&&r.domElement){r.setCenter((r._touchCurrent[0].clientX+r._touchCurrent[1].clientX)/2,(r._touchCurrent[0].clientY+r._touchCurrent[1].clientY)/2),r._state!=Cn.PAN&&(r.updateTbState(Cn.PAN,!0),r._startCursorPosition.copy(r._currentCursorPosition));var e=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement,!0);void 0!==e&&r._currentCursorPosition.copy(e),r.applyTransformMatrix(r.pan(r._startCursorPosition,r._currentCursorPosition,!0)),r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"onDoublePanEnd",(function(){r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"onRotateStart",(function(){var e;r.enabled&&r.enableRotate&&(r.dispatchEvent(bn),r.updateTbState(Cn.ZROTATE,!0),r._startFingerRotation=r.getAngle(r._touchCurrent[1],r._touchCurrent[0])+r.getAngle(r._touchStart[1],r._touchStart[0]),r._currentFingerRotation=r._startFingerRotation,null===(e=r.camera)||void 0===e||e.getWorldDirection(r._rotationAxis),r.enablePan||r.enableZoom||r.activateGizmos(!0))})),Object(D.a)(Object(z.a)(r),"onRotateMove",(function(){if(r.enabled&&r.enableRotate&&r.camera&&r.domElement){var e;if(r.setCenter((r._touchCurrent[0].clientX+r._touchCurrent[1].clientX)/2,(r._touchCurrent[0].clientY+r._touchCurrent[1].clientY)/2),r._state!=Cn.ZROTATE&&(r.updateTbState(Cn.ZROTATE,!0),r._startFingerRotation=r._currentFingerRotation),r._currentFingerRotation=r.getAngle(r._touchCurrent[1],r._touchCurrent[0])+r.getAngle(r._touchStart[1],r._touchStart[0]),r.enablePan){if(r.camera){var t;r._v3_2.setFromMatrixPosition(r._gizmoMatrixState),e=null===(t=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement))||void 0===t?void 0:t.applyQuaternion(r.camera.quaternion).multiplyScalar(1/r.camera.zoom).add(r._v3_2)}}else e=(new g.Vector3).setFromMatrixPosition(r._gizmoMatrixState);var n=g.MathUtils.DEG2RAD*(r._startFingerRotation-r._currentFingerRotation);void 0!==e&&r.applyTransformMatrix(r.zRotate(e,n)),r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"onRotateEnd",(function(){r.updateTbState(Cn.IDLE,!1),r.activateGizmos(!1),r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"onPinchStart",(function(){r.enabled&&r.enableZoom&&(r.dispatchEvent(bn),r.updateTbState(Cn.SCALE,!0),r._startFingerDistance=r.calculatePointersDistance(r._touchCurrent[0],r._touchCurrent[1]),r._currentFingerDistance=r._startFingerDistance,r.activateGizmos(!1))})),Object(D.a)(Object(z.a)(r),"onPinchMove",(function(){if(r.enabled&&r.enableZoom&&r.domElement){r.setCenter((r._touchCurrent[0].clientX+r._touchCurrent[1].clientX)/2,(r._touchCurrent[0].clientY+r._touchCurrent[1].clientY)/2);r._state!=Cn.SCALE&&(r._startFingerDistance=r._currentFingerDistance,r.updateTbState(Cn.SCALE,!0)),r._currentFingerDistance=Math.max(r.calculatePointersDistance(r._touchCurrent[0],r._touchCurrent[1]),12*r._devPxRatio);var e,t,n,a,i=r._currentFingerDistance/r._startFingerDistance;if(r.enablePan){if("OrthographicCamera"===(null===(t=r.camera)||void 0===t?void 0:t.type))e=null===(a=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement))||void 0===a?void 0:a.applyQuaternion(r.camera.quaternion).multiplyScalar(1/r.camera.zoom).add(r._gizmos.position);else if("PerspectiveCamera"===(null===(n=r.camera)||void 0===n?void 0:n.type)){var o;e=null===(o=r.unprojectOnTbPlane(r.camera,pn.x,pn.y,r.domElement))||void 0===o?void 0:o.applyQuaternion(r.camera.quaternion).add(r._gizmos.position)}}else e=r._gizmos.position;void 0!==e&&r.applyTransformMatrix(r.applyScale(i,e)),r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"onPinchEnd",(function(){r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"onTriplePanStart",(function(){if(r.enabled&&r.enableZoom&&r.domElement){r.dispatchEvent(bn),r.updateTbState(Cn.SCALE,!0);for(var e=0,t=0,n=r._touchCurrent.length,a=0;a<n;a++)e+=r._touchCurrent[a].clientX,t+=r._touchCurrent[a].clientY;r.setCenter(e/n,t/n),r._startCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y),r._currentCursorPosition.copy(r._startCursorPosition)}})),Object(D.a)(Object(z.a)(r),"onTriplePanMove",(function(){if(r.enabled&&r.enableZoom&&r.camera&&r.domElement){for(var e=0,t=0,n=r._touchCurrent.length,a=0;a<n;a++)e+=r._touchCurrent[a].clientX,t+=r._touchCurrent[a].clientY;r.setCenter(e/n,t/n);r._currentCursorPosition.setY(.5*r.getCursorNDC(pn.x,pn.y,r.domElement).y);var i=r._currentCursorPosition.y-r._startCursorPosition.y,o=1;i<0?o=1/Math.pow(r.scaleFactor,8*-i):i>0&&(o=Math.pow(r.scaleFactor,8*i)),r._v3_1.setFromMatrixPosition(r._cameraMatrixState);var s=r._v3_1.distanceTo(r._gizmos.position),c=s/o;c=g.MathUtils.clamp(c,r.minDistance,r.maxDistance);var u=s*Math.tan(g.MathUtils.DEG2RAD*r._fovState*.5),l=g.MathUtils.RAD2DEG*(2*Math.atan(u/c));l=g.MathUtils.clamp(l,r.minFov,r.maxFov);var d=u/Math.tan(g.MathUtils.DEG2RAD*(l/2));o=s/d,r._v3_2.setFromMatrixPosition(r._gizmoMatrixState),r.setFov(l),r.applyTransformMatrix(r.applyScale(o,r._v3_2,!1));var I=r._gizmos.position.clone().sub(r.camera.position).normalize().multiplyScalar(d/s);r._m4_1.makeTranslation(I.x,I.y,I.z),r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"onTriplePanEnd",(function(){r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(yn)})),Object(D.a)(Object(z.a)(r),"setCenter",(function(e,t){pn.x=e,pn.y=t})),Object(D.a)(Object(z.a)(r),"initializeMouseActions",(function(){r.setMouseAction("PAN",0,"CTRL"),r.setMouseAction("PAN",2),r.setMouseAction("ROTATE",0),r.setMouseAction("ZOOM","WHEEL"),r.setMouseAction("ZOOM",1),r.setMouseAction("FOV","WHEEL","SHIFT"),r.setMouseAction("FOV",1,"SHIFT")})),Object(D.a)(Object(z.a)(r),"setMouseAction",(function(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=["PAN","ROTATE","ZOOM","FOV"],o=[0,1,2,"WHEEL"],s=["CTRL","SHIFT",null];if(!i.includes(e)||!o.includes(t)||!s.includes(a))return!1;if("WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":n=Cn.PAN;break;case"ROTATE":n=Cn.ROTATE;break;case"ZOOM":n=Cn.SCALE;break;case"FOV":n=Cn.FOV}for(var c={operation:e,mouse:t,key:a,state:n},u=0;u<r.mouseActions.length;u++)if(r.mouseActions[u].mouse==c.mouse&&r.mouseActions[u].key==c.key)return r.mouseActions.splice(u,1,c),!0;return r.mouseActions.push(c),!0})),Object(D.a)(Object(z.a)(r),"getOpFromAction",(function(e,t){for(var n,a=0;a<r.mouseActions.length;a++)if((n=r.mouseActions[a]).mouse==e&&n.key==t)return n.operation;if(t)for(var i=0;i<r.mouseActions.length;i++)if((n=r.mouseActions[i]).mouse==e&&null==n.key)return n.operation;return null})),Object(D.a)(Object(z.a)(r),"getOpStateFromAction",(function(e,t){for(var n,a=0;a<r.mouseActions.length;a++)if((n=r.mouseActions[a]).mouse==e&&n.key==t)return n.state;if(t)for(var i=0;i<r.mouseActions.length;i++)if((n=r.mouseActions[i]).mouse==e&&null==n.key)return n.state;return null})),Object(D.a)(Object(z.a)(r),"getAngle",(function(e,t){return 180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI})),Object(D.a)(Object(z.a)(r),"updateTouchEvent",(function(e){for(var t=0;t<r._touchCurrent.length;t++)if(r._touchCurrent[t].pointerId==e.pointerId){r._touchCurrent.splice(t,1,e);break}})),Object(D.a)(Object(z.a)(r),"calculateAngularSpeed",(function(e,t,n,r){var a=(r-n)/1e3;return 0==a?0:(t-e)/a})),Object(D.a)(Object(z.a)(r),"calculatePointersDistance",(function(e,t){return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))})),Object(D.a)(Object(z.a)(r),"calculateRotationAxis",(function(e,t){return r._rotationMatrix.extractRotation(r._cameraMatrixState),r._quat.setFromRotationMatrix(r._rotationMatrix),r._rotationAxis.crossVectors(e,t).applyQuaternion(r._quat),r._rotationAxis.normalize().clone()})),Object(D.a)(Object(z.a)(r),"calculateTbRadius",(function(e){var t=e.position.distanceTo(r._gizmos.position);if("PerspectiveCamera"==e.type){var n=g.MathUtils.DEG2RAD*e.fov*.5,a=Math.atan(e.aspect*Math.tan(n));return Math.tan(Math.min(n,a))*t*.67}if("OrthographicCamera"==e.type)return.67*Math.min(e.top,e.right)})),Object(D.a)(Object(z.a)(r),"focus",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(r.camera){var a=e.clone();a.sub(r._gizmos.position).multiplyScalar(n),r._translationMatrix.makeTranslation(a.x,a.y,a.z);var i=r._gizmoMatrixState.clone();r._gizmoMatrixState.premultiply(r._translationMatrix),r._gizmoMatrixState.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale);var o=r._cameraMatrixState.clone();r._cameraMatrixState.premultiply(r._translationMatrix),r._cameraMatrixState.decompose(r.camera.position,r.camera.quaternion,r.camera.scale),r.enableZoom&&r.applyTransformMatrix(r.applyScale(t,r._gizmos.position)),r._gizmoMatrixState.copy(i),r._cameraMatrixState.copy(o)}})),Object(D.a)(Object(z.a)(r),"drawGrid",(function(){if(r.scene){var e,t,n,a,i,o,s=8947848;if("OrthographicCamera"===(null===(e=r.camera)||void 0===e?void 0:e.type)){var c=r.camera.right-r.camera.left,u=r.camera.bottom-r.camera.top;o=(i=Math.max(c,u))/20,a=(n=i/r.camera.zoom*3)/o*r.camera.zoom}else if("PerspectiveCamera"===(null===(t=r.camera)||void 0===t?void 0:t.type)){var l=r.camera.position.distanceTo(r._gizmos.position),d=g.MathUtils.DEG2RAD*r.camera.fov*.5,I=Math.atan(r.camera.aspect*Math.tan(d));a=(n=3*(i=Math.tan(Math.max(d,I))*l*2))/(o=i/20)}null==r._grid&&r.camera&&(r._grid=new g.GridHelper(n,a,s,s),r._grid.position.copy(r._gizmos.position),r._gridPosition.copy(r._grid.position),r._grid.quaternion.copy(r.camera.quaternion),r._grid.rotateX(.5*Math.PI),r.scene.add(r._grid))}})),Object(D.a)(Object(z.a)(r),"connect",(function(e){e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",r.onContextMenu),r.domElement.addEventListener("pointerdown",r.onPointerDown),r.domElement.addEventListener("pointercancel",r.onPointerCancel),r.domElement.addEventListener("wheel",r.onWheel)})),Object(D.a)(Object(z.a)(r),"dispose",(function(){var e,t,n,a,i;-1!=r._animationId&&window.cancelAnimationFrame(r._animationId),null===(e=r.domElement)||void 0===e||e.removeEventListener("pointerdown",r.onPointerDown),null===(t=r.domElement)||void 0===t||t.removeEventListener("pointercancel",r.onPointerCancel),null===(n=r.domElement)||void 0===n||n.removeEventListener("wheel",r.onWheel),null===(a=r.domElement)||void 0===a||a.removeEventListener("contextmenu",r.onContextMenu),window.removeEventListener("pointermove",r.onPointerMove),window.removeEventListener("pointerup",r.onPointerUp),window.removeEventListener("resize",r.onWindowResize),null===(i=r.scene)||void 0===i||i.remove(r._gizmos),r.disposeGrid()})),Object(D.a)(Object(z.a)(r),"disposeGrid",(function(){r._grid&&r.scene&&(r.scene.remove(r._grid),r._grid=null)})),Object(D.a)(Object(z.a)(r),"easeOutCubic",(function(e){return 1-Math.pow(1-e,3)})),Object(D.a)(Object(z.a)(r),"activateGizmos",(function(e){var t,n=Object(qe.a)(r._gizmos.children);try{for(n.s();!(t=n.n()).done;){t.value.material.setValues({opacity:e?1:.6})}}catch(a){n.e(a)}finally{n.f()}})),Object(D.a)(Object(z.a)(r),"getCursorNDC",(function(e,t,n){var a=n.getBoundingClientRect();return r._v2_1.setX((e-a.left)/a.width*2-1),r._v2_1.setY((a.bottom-t)/a.height*2-1),r._v2_1.clone()})),Object(D.a)(Object(z.a)(r),"getCursorPosition",(function(e,t,n){var a;return r._v2_1.copy(r.getCursorNDC(e,t,n)),"OrthographicCamera"===(null===(a=r.camera)||void 0===a?void 0:a.type)&&(r._v2_1.x*=.5*(r.camera.right-r.camera.left),r._v2_1.y*=.5*(r.camera.top-r.camera.bottom)),r._v2_1.clone()})),Object(D.a)(Object(z.a)(r),"setCamera",(function(e){if(e){e.lookAt(r.target),e.updateMatrix(),"PerspectiveCamera"==(null===e||void 0===e?void 0:e.type)&&(r._fov0=e.fov,r._fovState=e.fov),r._cameraMatrixState0.copy(e.matrix),r._cameraMatrixState.copy(r._cameraMatrixState0),r._cameraProjectionState.copy(e.projectionMatrix),r._zoom0=e.zoom,r._zoomState=r._zoom0,r._initialNear=e.near,r._nearPos0=e.position.distanceTo(r.target)-e.near,r._nearPos=r._initialNear,r._initialFar=e.far,r._farPos0=e.position.distanceTo(r.target)-e.far,r._farPos=r._initialFar,r._up0.copy(e.up),r._upState.copy(e.up),r.camera=e,r.camera.updateProjectionMatrix();var t=r.calculateTbRadius(e);void 0!==t&&(r._tbRadius=t),r.makeGizmos(r.target,r._tbRadius)}})),Object(D.a)(Object(z.a)(r),"makeGizmos",(function(e,t){var n=new g.EllipseCurve(0,0,t,t).getPoints(r._curvePts),a=(new g.BufferGeometry).setFromPoints(n),i=new g.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),o=new g.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),s=new g.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),c=new g.Line(a,i),u=new g.Line(a,o),l=new g.Line(a,s),d=.5*Math.PI;if(c.rotation.x=d,u.rotation.y=d,r._gizmoMatrixState0.identity().setPosition(e),r._gizmoMatrixState.copy(r._gizmoMatrixState0),r.camera&&1!=r.camera.zoom){var I=1/r.camera.zoom;r._scaleMatrix.makeScale(I,I,I),r._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),r._gizmoMatrixState.premultiply(r._translationMatrix).premultiply(r._scaleMatrix),r._translationMatrix.makeTranslation(e.x,e.y,e.z),r._gizmoMatrixState.premultiply(r._translationMatrix)}r._gizmoMatrixState.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale),r._gizmos.clear(),r._gizmos.add(c),r._gizmos.add(u),r._gizmos.add(l)})),Object(D.a)(Object(z.a)(r),"onFocusAnim",(function(e,t,n,a){if(-1==r._timeStart&&(r._timeStart=e),r._state==Cn.ANIMATION_FOCUS){var i=(e-r._timeStart)/r.focusAnimationTime;if(r._gizmoMatrixState.copy(a),i>=1)r._gizmoMatrixState.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale),r.focus(t,r.scaleFactor),r._timeStart=-1,r.updateTbState(Cn.IDLE,!1),r.activateGizmos(!1),r.dispatchEvent(vn);else{var o=r.easeOutCubic(i),s=1-o+r.scaleFactor*o;r._gizmoMatrixState.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale),r.focus(t,s,o),r.dispatchEvent(vn);var c=Object(z.a)(r);r._animationId=window.requestAnimationFrame((function(e){c.onFocusAnim(e,t,n,a.clone())}))}}else r._animationId=-1,r._timeStart=-1})),Object(D.a)(Object(z.a)(r),"onRotationAnim",(function(e,t,n){if(-1==r._timeStart&&(r._anglePrev=0,r._angleCurrent=0,r._timeStart=e),r._state==Cn.ANIMATION_ROTATE){var a=(e-r._timeStart)/1e3;if(n+-r.dampingFactor*a>0){r._angleCurrent=.5*-r.dampingFactor*Math.pow(a,2)+n*a+0,r.applyTransformMatrix(r.rotate(t,r._angleCurrent)),r.dispatchEvent(vn);var i=Object(z.a)(r);r._animationId=window.requestAnimationFrame((function(e){i.onRotationAnim(e,t,n)}))}else r._animationId=-1,r._timeStart=-1,r.updateTbState(Cn.IDLE,!1),r.activateGizmos(!1),r.dispatchEvent(vn)}else r._animationId=-1,r._timeStart=-1,r._state!=Cn.ROTATE&&(r.activateGizmos(!1),r.dispatchEvent(vn))})),Object(D.a)(Object(z.a)(r),"pan",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r.camera){var a=e.clone().sub(t);if("OrthographicCamera"===r.camera.type&&a.multiplyScalar(1/r.camera.zoom),"PerspectiveCamera"===r.camera.type&&n){r._v3_1.setFromMatrixPosition(r._cameraMatrixState0),r._v3_2.setFromMatrixPosition(r._gizmoMatrixState0);var i=r._v3_1.distanceTo(r._v3_2)/r.camera.position.distanceTo(r._gizmos.position);a.multiplyScalar(1/i)}r._v3_1.set(a.x,a.y,0).applyQuaternion(r.camera.quaternion),r._m4_1.makeTranslation(r._v3_1.x,r._v3_1.y,r._v3_1.z),r.setTransformationMatrices(r._m4_1,r._m4_1)}return mn})),Object(D.a)(Object(z.a)(r),"reset",(function(){if(r.camera){r.camera.zoom=r._zoom0,"PerspectiveCamera"===r.camera.type&&(r.camera.fov=r._fov0),r.camera.near=r._nearPos,r.camera.far=r._farPos,r._cameraMatrixState.copy(r._cameraMatrixState0),r._cameraMatrixState.decompose(r.camera.position,r.camera.quaternion,r.camera.scale),r.camera.up.copy(r._up0),r.camera.updateMatrix(),r.camera.updateProjectionMatrix(),r._gizmoMatrixState.copy(r._gizmoMatrixState0),r._gizmoMatrixState0.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale),r._gizmos.updateMatrix();var e=r.calculateTbRadius(r.camera);void 0!==e&&(r._tbRadius=e),r.makeGizmos(r._gizmos.position,r._tbRadius),r.camera.lookAt(r._gizmos.position),r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(vn)}})),Object(D.a)(Object(z.a)(r),"rotate",(function(e,t){var n=r._gizmos.position;return r._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),r._rotationMatrix.makeRotationAxis(e,-t),r._m4_1.makeTranslation(n.x,n.y,n.z),r._m4_1.multiply(r._rotationMatrix),r._m4_1.multiply(r._translationMatrix),r.setTransformationMatrices(r._m4_1),mn})),Object(D.a)(Object(z.a)(r),"copyState",(function(){if(r.camera){var e,t=JSON.stringify("OrthographicCamera"===(null===(e=r.camera)||void 0===e?void 0:e.type)?{arcballState:{cameraFar:r.camera.far,cameraMatrix:r.camera.matrix,cameraNear:r.camera.near,cameraUp:r.camera.up,cameraZoom:r.camera.zoom,gizmoMatrix:r._gizmos.matrix}}:{arcballState:{cameraFar:r.camera.far,cameraFov:r.camera.fov,cameraMatrix:r.camera.matrix,cameraNear:r.camera.near,cameraUp:r.camera.up,cameraZoom:r.camera.zoom,gizmoMatrix:r._gizmos.matrix}});navigator.clipboard.writeText(t)}})),Object(D.a)(Object(z.a)(r),"pasteState",(function(){var e=Object(z.a)(r);navigator.clipboard.readText().then((function(t){e.setStateFromJSON(t)}))})),Object(D.a)(Object(z.a)(r),"saveState",(function(){r.camera&&(r._cameraMatrixState0.copy(r.camera.matrix),r._gizmoMatrixState0.copy(r._gizmos.matrix),r._nearPos=r.camera.near,r._farPos=r.camera.far,r._zoom0=r.camera.zoom,r._up0.copy(r.camera.up),"PerspectiveCamera"===r.camera.type&&(r._fov0=r.camera.fov))})),Object(D.a)(Object(z.a)(r),"applyScale",(function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(r.camera){var a=t.clone(),i=1/e;if("OrthographicCamera"===r.camera.type){r.camera.zoom=r._zoomState,r.camera.zoom*=e,r.camera.zoom>r.maxZoom?(r.camera.zoom=r.maxZoom,i=r._zoomState/r.maxZoom):r.camera.zoom<r.minZoom&&(r.camera.zoom=r.minZoom,i=r._zoomState/r.minZoom),r.camera.updateProjectionMatrix(),r._v3_1.setFromMatrixPosition(r._gizmoMatrixState),r._scaleMatrix.makeScale(i,i,i),r._translationMatrix.makeTranslation(-r._v3_1.x,-r._v3_1.y,-r._v3_1.z),r._m4_2.makeTranslation(r._v3_1.x,r._v3_1.y,r._v3_1.z).multiply(r._scaleMatrix),r._m4_2.multiply(r._translationMatrix),a.sub(r._v3_1);var o=a.clone().multiplyScalar(i);return a.sub(o),r._m4_1.makeTranslation(a.x,a.y,a.z),r._m4_2.premultiply(r._m4_1),r.setTransformationMatrices(r._m4_1,r._m4_2),mn}if("PerspectiveCamera"===r.camera.type){r._v3_1.setFromMatrixPosition(r._cameraMatrixState),r._v3_2.setFromMatrixPosition(r._gizmoMatrixState);var s=r._v3_1.distanceTo(a),c=s-s*i,u=s-c;u<r.minDistance?c=s-s*(i=r.minDistance/s):u>r.maxDistance&&(c=s-s*(i=r.maxDistance/s));var l=a.clone().sub(r._v3_1).normalize().multiplyScalar(c);if(r._m4_1.makeTranslation(l.x,l.y,l.z),n){var g=r._v3_2;c=(s=g.distanceTo(a))-s*i,l=a.clone().sub(r._v3_2).normalize().multiplyScalar(c),r._translationMatrix.makeTranslation(g.x,g.y,g.z),r._scaleMatrix.makeScale(i,i,i),r._m4_2.makeTranslation(l.x,l.y,l.z).multiply(r._translationMatrix),r._m4_2.multiply(r._scaleMatrix),r._translationMatrix.makeTranslation(-g.x,-g.y,-g.z),r._m4_2.multiply(r._translationMatrix),r.setTransformationMatrices(r._m4_1,r._m4_2)}else r.setTransformationMatrices(r._m4_1);return mn}}})),Object(D.a)(Object(z.a)(r),"setFov",(function(e){var t;"PerspectiveCamera"===(null===(t=r.camera)||void 0===t?void 0:t.type)&&(r.camera.fov=g.MathUtils.clamp(e,r.minFov,r.maxFov),r.camera.updateProjectionMatrix())})),Object(D.a)(Object(z.a)(r),"setTarget",(function(e,t,n){if(r.camera){r.target.set(e,t,n),r._gizmos.position.set(e,t,n);var a=r.calculateTbRadius(r.camera);void 0!==a&&(r._tbRadius=a),r.makeGizmos(r.target,r._tbRadius),r.camera.lookAt(r.target)}})),Object(D.a)(Object(z.a)(r),"zRotate",(function(e,t){return r._rotationMatrix.makeRotationAxis(r._rotationAxis,t),r._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),r._m4_1.makeTranslation(e.x,e.y,e.z),r._m4_1.multiply(r._rotationMatrix),r._m4_1.multiply(r._translationMatrix),r._v3_1.setFromMatrixPosition(r._gizmoMatrixState).sub(e),r._v3_2.copy(r._v3_1).applyAxisAngle(r._rotationAxis,t),r._v3_2.sub(r._v3_1),r._m4_2.makeTranslation(r._v3_2.x,r._v3_2.y,r._v3_2.z),r.setTransformationMatrices(r._m4_1,r._m4_2),mn})),Object(D.a)(Object(z.a)(r),"unprojectOnObj",(function(e,t){if(!r.scene)return null;var n=new g.Raycaster;n.near=t.near,n.far=t.far,n.setFromCamera(e,t);for(var a=n.intersectObjects(r.scene.children,!0),i=0;i<a.length;i++)if(a[i].object.uuid!=r._gizmos.uuid&&a[i].face)return a[i].point.clone();return null})),Object(D.a)(Object(z.a)(r),"unprojectOnTbSurface",(function(e,t,n,a,i){if("OrthographicCamera"==e.type){r._v2_1.copy(r.getCursorPosition(t,n,a)),r._v3_1.set(r._v2_1.x,r._v2_1.y,0);var o=Math.pow(r._v2_1.x,2),s=Math.pow(r._v2_1.y,2),c=Math.pow(r._tbRadius,2);return o+s<=.5*c?r._v3_1.setZ(Math.sqrt(c-(o+s))):r._v3_1.setZ(.5*c/Math.sqrt(o+s)),r._v3_1}if("PerspectiveCamera"==e.type){r._v2_1.copy(r.getCursorNDC(t,n,a)),r._v3_1.set(r._v2_1.x,r._v2_1.y,-1),r._v3_1.applyMatrix4(e.projectionMatrixInverse);var u=r._v3_1.clone().normalize(),l=e.position.distanceTo(r._gizmos.position),d=Math.pow(i,2),I=r._v3_1.z,A=Math.sqrt(Math.pow(r._v3_1.x,2)+Math.pow(r._v3_1.y,2));if(0==A)return u.set(r._v3_1.x,r._v3_1.y,i),u;var h=I/A,C=l,f=Math.pow(h,2)+1,p=2*h*C,m=Math.pow(C,2)-d,v=Math.pow(p,2)-4*f*m;if(v>=0)if(r._v2_1.setX((-p-Math.sqrt(v))/(2*f)),r._v2_1.setY(h*r._v2_1.x+C),g.MathUtils.RAD2DEG*r._v2_1.angle()>=45){var b=Math.sqrt(Math.pow(r._v2_1.x,2)+Math.pow(l-r._v2_1.y,2));return u.multiplyScalar(b),u.z+=l,u}f=h,p=C,m=.5*-d,v=Math.pow(p,2)-4*f*m,r._v2_1.setX((-p-Math.sqrt(v))/(2*f)),r._v2_1.setY(h*r._v2_1.x+C);var y=Math.sqrt(Math.pow(r._v2_1.x,2)+Math.pow(l-r._v2_1.y,2));return u.multiplyScalar(y),u.z+=l,u}})),Object(D.a)(Object(z.a)(r),"unprojectOnTbPlane",(function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("OrthographicCamera"==e.type)return r._v2_1.copy(r.getCursorPosition(t,n,a)),r._v3_1.set(r._v2_1.x,r._v2_1.y,0),r._v3_1.clone();if("PerspectiveCamera"==e.type){r._v2_1.copy(r.getCursorNDC(t,n,a)),r._v3_1.set(r._v2_1.x,r._v2_1.y,-1),r._v3_1.applyMatrix4(e.projectionMatrixInverse);var o,s=r._v3_1.clone().normalize(),c=r._v3_1.z,u=Math.sqrt(Math.pow(r._v3_1.x,2)+Math.pow(r._v3_1.y,2));if(o=i?r._v3_1.setFromMatrixPosition(r._cameraMatrixState0).distanceTo(r._v3_2.setFromMatrixPosition(r._gizmoMatrixState0)):e.position.distanceTo(r._gizmos.position),0==u)return s.set(0,0,0),s;var l=c/u,g=o,d=-g/l,I=Math.sqrt(Math.pow(g,2)+Math.pow(d,2));return s.multiplyScalar(I),s.z=0,s}})),Object(D.a)(Object(z.a)(r),"updateMatrixState",(function(){r.camera&&(r._cameraMatrixState.copy(r.camera.matrix),r._gizmoMatrixState.copy(r._gizmos.matrix),"OrthographicCamera"===r.camera.type&&(r._cameraProjectionState.copy(r.camera.projectionMatrix),r.camera.updateProjectionMatrix(),r._zoomState=r.camera.zoom),"PerspectiveCamera"===r.camera.type&&(r._fovState=r.camera.fov))})),Object(D.a)(Object(z.a)(r),"updateTbState",(function(e,t){r._state=e,t&&r.updateMatrixState()})),Object(D.a)(Object(z.a)(r),"update",(function(){var e=1e-6;if(!r.target.equals(r._currentTarget)&&r.camera){r._gizmos.position.set(r.target.x,r.target.y,r.target.z);var t=r.calculateTbRadius(r.camera);void 0!==t&&(r._tbRadius=t),r.makeGizmos(r.target,r._tbRadius),r._currentTarget.copy(r.target)}if(r.camera){if("OrthographicCamera"===r.camera.type&&(r.camera.zoom>r.maxZoom||r.camera.zoom<r.minZoom)){var n=g.MathUtils.clamp(r.camera.zoom,r.minZoom,r.maxZoom);r.applyTransformMatrix(r.applyScale(n/r.camera.zoom,r._gizmos.position,!0))}if("PerspectiveCamera"===r.camera.type){var a=r.camera.position.distanceTo(r._gizmos.position);if(a>r.maxDistance+e||a<r.minDistance-e){var i=g.MathUtils.clamp(a,r.minDistance,r.maxDistance);r.applyTransformMatrix(r.applyScale(i/a,r._gizmos.position)),r.updateMatrixState()}(r.camera.fov<r.minFov||r.camera.fov>r.maxFov)&&(r.camera.fov=g.MathUtils.clamp(r.camera.fov,r.minFov,r.maxFov),r.camera.updateProjectionMatrix());var o=r._tbRadius,s=r.calculateTbRadius(r.camera);if(void 0!==s&&(r._tbRadius=s),o<r._tbRadius-e||o>r._tbRadius+e){var c=(r._gizmos.scale.x+r._gizmos.scale.y+r._gizmos.scale.z)/3,u=r._tbRadius/c,l=new g.EllipseCurve(0,0,u,u).getPoints(r._curvePts),d=(new g.BufferGeometry).setFromPoints(l);for(var I in r._gizmos.children){r._gizmos.children[I].geometry=d}}}r.camera.lookAt(r._gizmos.position)}})),Object(D.a)(Object(z.a)(r),"setStateFromJSON",(function(e){var t=JSON.parse(e);if(t.arcballState&&r.camera){r._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),r._cameraMatrixState.decompose(r.camera.position,r.camera.quaternion,r.camera.scale),r.camera.up.copy(t.arcballState.cameraUp),r.camera.near=t.arcballState.cameraNear,r.camera.far=t.arcballState.cameraFar,r.camera.zoom=t.arcballState.cameraZoom,"PerspectiveCamera"===r.camera.type&&(r.camera.fov=t.arcballState.cameraFov),r._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),r._gizmoMatrixState.decompose(r._gizmos.position,r._gizmos.quaternion,r._gizmos.scale),r.camera.updateMatrix(),r.camera.updateProjectionMatrix(),r._gizmos.updateMatrix();var n=r.calculateTbRadius(r.camera);void 0!==n&&(r._tbRadius=n);var a=(new g.Matrix4).copy(r._gizmoMatrixState0);r.makeGizmos(r._gizmos.position,r._tbRadius),r._gizmoMatrixState0.copy(a),r.camera.lookAt(r._gizmos.position),r.updateTbState(Cn.IDLE,!1),r.dispatchEvent(vn)}})),r.camera=null,r.domElement=a,r.scene=i,r.mouseActions=[],r._mouseOp=null,r._v2_1=new g.Vector2,r._v3_1=new g.Vector3,r._v3_2=new g.Vector3,r._m4_1=new g.Matrix4,r._m4_2=new g.Matrix4,r._quat=new g.Quaternion,r._translationMatrix=new g.Matrix4,r._rotationMatrix=new g.Matrix4,r._scaleMatrix=new g.Matrix4,r._rotationAxis=new g.Vector3,r._cameraMatrixState=new g.Matrix4,r._cameraProjectionState=new g.Matrix4,r._fovState=1,r._upState=new g.Vector3,r._zoomState=1,r._nearPos=0,r._farPos=0,r._gizmoMatrixState=new g.Matrix4,r._up0=new g.Vector3,r._zoom0=1,r._fov0=0,r._initialNear=0,r._nearPos0=0,r._initialFar=0,r._farPos0=0,r._cameraMatrixState0=new g.Matrix4,r._gizmoMatrixState0=new g.Matrix4,r._button=-1,r._touchStart=[],r._touchCurrent=[],r._input=fn.NONE,r._switchSensibility=32,r._startFingerDistance=0,r._currentFingerDistance=0,r._startFingerRotation=0,r._currentFingerRotation=0,r._devPxRatio=0,r._downValid=!0,r._nclicks=0,r._downEvents=[],r._clickStart=0,r._maxDownTime=250,r._maxInterval=300,r._posThreshold=24,r._movementThreshold=24,r._currentCursorPosition=new g.Vector3,r._startCursorPosition=new g.Vector3,r._grid=null,r._gridPosition=new g.Vector3,r._gizmos=new g.Group,r._curvePts=128,r._timeStart=-1,r._animationId=-1,r.focusAnimationTime=500,r._timePrev=0,r._timeCurrent=0,r._anglePrev=0,r._angleCurrent=0,r._cursorPosPrev=new g.Vector3,r._cursorPosCurr=new g.Vector3,r._wPrev=0,r._wCurr=0,r.adjustNearFar=!1,r.scaleFactor=1.1,r.dampingFactor=25,r.wMax=20,r.enableAnimations=!0,r.enableGrid=!1,r.cursorZoom=!1,r.minFov=5,r.maxFov=90,r.enabled=!0,r.enablePan=!0,r.enableRotate=!0,r.enableZoom=!0,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.target=new g.Vector3(0,0,0),r._currentTarget=new g.Vector3(0,0,0),r._tbRadius=1,r._state=Cn.IDLE,r.setCamera(e),r.scene&&r.scene.add(r._gizmos),r._devPxRatio=window.devicePixelRatio,r.initializeMouseActions(),r.domElement&&r.connect(r.domElement),window.addEventListener("resize",r.onWindowResize),r}return Object(W.a)(n,[{key:"applyTransformMatrix",value:function(e){if(null!==e&&void 0!==e&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),this._state!=Cn.ROTATE&&this._state!=Cn.ZROTATE&&this._state!=Cn.ANIMATION_ROTATE||this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),null!==e&&void 0!==e&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==Cn.SCALE||this._state==Cn.FOCUS||this._state==Cn.ANIMATION_FOCUS)&&this.camera){var t=this.calculateTbRadius(this.camera);if(void 0!==t&&(this._tbRadius=t),this.adjustNearFar){var n=this.camera.position.distanceTo(this._gizmos.position),r=new g.Box3;r.setFromObject(this._gizmos);var a=new g.Sphere;r.getBoundingSphere(a);var i=Math.max(this._nearPos0,a.radius+a.center.length()),o=n-this._initialNear,s=Math.min(i,o);this.camera.near=n-s;var c=Math.min(this._farPos0,-a.radius+a.center.length()),u=n-this._initialFar,l=Math.min(c,u);this.camera.far=n-l,this.camera.updateProjectionMatrix()}else{var d=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,d=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,d=!0),d&&this.camera.updateProjectionMatrix()}}}},{key:"setGizmosVisible",value:function(e){this._gizmos.visible=e,this.dispatchEvent(vn)}},{key:"setTransformationMatrices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e?mn.camera?mn.camera.copy(e):mn.camera=e.clone():mn.camera=null,t?mn.gizmos?mn.gizmos.copy(t):mn.gizmos=t.clone():mn.gizmos=null}}]),n}(g.EventDispatcher),Gn=["camera","makeDefault","regress","domElement","onChange","onStart","onEnd"],wn=Object(i.forwardRef)((function(e,t){var n=e.camera,r=e.makeDefault,a=e.regress,s=e.domElement,c=e.onChange,u=e.onStart,l=e.onEnd,g=Object(p.a)(e,Gn),d=Object(o.useThree)((function(e){return e.invalidate})),I=Object(o.useThree)((function(e){return e.camera})),A=Object(o.useThree)((function(e){return e.gl})),h=Object(o.useThree)((function(e){return e.events})),C=Object(o.useThree)((function(e){return e.set})),f=Object(o.useThree)((function(e){return e.get})),v=Object(o.useThree)((function(e){return e.performance})),b=n||I,y=s||h.connected||A.domElement,B=Object(i.useMemo)((function(){return new Bn(b)}),[b]);return Object(o.useFrame)((function(){B.enabled&&B.update()})),Object(i.useEffect)((function(){return B.connect(y),function(){B.dispose()}}),[y,a,B,d]),Object(i.useEffect)((function(){var e=function(e){d(),a&&v.regress(),c&&c(e)};return B.addEventListener("change",e),u&&B.addEventListener("start",u),l&&B.addEventListener("end",l),function(){B.removeEventListener("change",e),u&&B.removeEventListener("start",u),l&&B.removeEventListener("end",l)}}),[c,u,l]),Object(i.useEffect)((function(){if(r){var e=f().controls;return C({controls:B}),function(){return C({controls:e})}}}),[r,B]),i.createElement("primitive",Object(m.a)({ref:t,object:B},g))})),_n=n(104),Zn=n.n(_n),Sn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a,i;Object(E.a)(this,n),i=t.call(this),Object(D.a)(Object(z.a)(i),"isTransformControls",!0),Object(D.a)(Object(z.a)(i),"visible",!1),Object(D.a)(Object(z.a)(i),"domElement",void 0),Object(D.a)(Object(z.a)(i),"raycaster",new g.Raycaster),Object(D.a)(Object(z.a)(i),"gizmo",void 0),Object(D.a)(Object(z.a)(i),"plane",void 0),Object(D.a)(Object(z.a)(i),"tempVector",new g.Vector3),Object(D.a)(Object(z.a)(i),"tempVector2",new g.Vector3),Object(D.a)(Object(z.a)(i),"tempQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(i),"unit",{X:new g.Vector3(1,0,0),Y:new g.Vector3(0,1,0),Z:new g.Vector3(0,0,1)}),Object(D.a)(Object(z.a)(i),"pointStart",new g.Vector3),Object(D.a)(Object(z.a)(i),"pointEnd",new g.Vector3),Object(D.a)(Object(z.a)(i),"offset",new g.Vector3),Object(D.a)(Object(z.a)(i),"rotationAxis",new g.Vector3),Object(D.a)(Object(z.a)(i),"startNorm",new g.Vector3),Object(D.a)(Object(z.a)(i),"endNorm",new g.Vector3),Object(D.a)(Object(z.a)(i),"rotationAngle",0),Object(D.a)(Object(z.a)(i),"cameraPosition",new g.Vector3),Object(D.a)(Object(z.a)(i),"cameraQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(i),"cameraScale",new g.Vector3),Object(D.a)(Object(z.a)(i),"parentPosition",new g.Vector3),Object(D.a)(Object(z.a)(i),"parentQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(i),"parentQuaternionInv",new g.Quaternion),Object(D.a)(Object(z.a)(i),"parentScale",new g.Vector3),Object(D.a)(Object(z.a)(i),"worldPositionStart",new g.Vector3),Object(D.a)(Object(z.a)(i),"worldQuaternionStart",new g.Quaternion),Object(D.a)(Object(z.a)(i),"worldScaleStart",new g.Vector3),Object(D.a)(Object(z.a)(i),"worldPosition",new g.Vector3),Object(D.a)(Object(z.a)(i),"worldQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(i),"worldQuaternionInv",new g.Quaternion),Object(D.a)(Object(z.a)(i),"worldScale",new g.Vector3),Object(D.a)(Object(z.a)(i),"eye",new g.Vector3),Object(D.a)(Object(z.a)(i),"positionStart",new g.Vector3),Object(D.a)(Object(z.a)(i),"quaternionStart",new g.Quaternion),Object(D.a)(Object(z.a)(i),"scaleStart",new g.Vector3),Object(D.a)(Object(z.a)(i),"camera",void 0),Object(D.a)(Object(z.a)(i),"object",void 0),Object(D.a)(Object(z.a)(i),"enabled",!0),Object(D.a)(Object(z.a)(i),"axis",null),Object(D.a)(Object(z.a)(i),"mode","translate"),Object(D.a)(Object(z.a)(i),"translationSnap",null),Object(D.a)(Object(z.a)(i),"rotationSnap",null),Object(D.a)(Object(z.a)(i),"scaleSnap",null),Object(D.a)(Object(z.a)(i),"space","world"),Object(D.a)(Object(z.a)(i),"size",1),Object(D.a)(Object(z.a)(i),"dragging",!1),Object(D.a)(Object(z.a)(i),"showX",!0),Object(D.a)(Object(z.a)(i),"showY",!0),Object(D.a)(Object(z.a)(i),"showZ",!0),Object(D.a)(Object(z.a)(i),"changeEvent",{type:"change"}),Object(D.a)(Object(z.a)(i),"mouseDownEvent",{type:"mouseDown",mode:i.mode}),Object(D.a)(Object(z.a)(i),"mouseUpEvent",{type:"mouseUp",mode:i.mode}),Object(D.a)(Object(z.a)(i),"objectChangeEvent",{type:"objectChange"}),Object(D.a)(Object(z.a)(i),"intersectObjectWithRay",(function(e,t,n){for(var r=t.intersectObject(e,!0),a=0;a<r.length;a++)if(r[a].object.visible||n)return r[a];return!1})),Object(D.a)(Object(z.a)(i),"attach",(function(e){return i.object=e,i.visible=!0,Object(z.a)(i)})),Object(D.a)(Object(z.a)(i),"detach",(function(){return i.object=void 0,i.visible=!1,i.axis=null,Object(z.a)(i)})),Object(D.a)(Object(z.a)(i),"updateMatrixWorld",(function(){void 0!==i.object&&(i.object.updateMatrixWorld(),null===i.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):i.object.parent.matrixWorld.decompose(i.parentPosition,i.parentQuaternion,i.parentScale),i.object.matrixWorld.decompose(i.worldPosition,i.worldQuaternion,i.worldScale),i.parentQuaternionInv.copy(i.parentQuaternion).invert(),i.worldQuaternionInv.copy(i.worldQuaternion).invert()),i.camera.updateMatrixWorld(),i.camera.matrixWorld.decompose(i.cameraPosition,i.cameraQuaternion,i.cameraScale),i.eye.copy(i.cameraPosition).sub(i.worldPosition).normalize(),Object(q.a)((a=Object(z.a)(i),Object($.a)(n.prototype)),"updateMatrixWorld",a).call(a)})),Object(D.a)(Object(z.a)(i),"pointerHover",(function(e){if(void 0!==i.object&&!0!==i.dragging){i.raycaster.setFromCamera(e,i.camera);var t=i.intersectObjectWithRay(i.gizmo.picker[i.mode],i.raycaster);i.axis=t?t.object.name:null}})),Object(D.a)(Object(z.a)(i),"pointerDown",(function(e){if(void 0!==i.object&&!0!==i.dragging&&0===e.button&&null!==i.axis){i.raycaster.setFromCamera(e,i.camera);var t=i.intersectObjectWithRay(i.plane,i.raycaster,!0);if(t){var n=i.space;if("scale"===i.mode?n="local":"E"!==i.axis&&"XYZE"!==i.axis&&"XYZ"!==i.axis||(n="world"),"local"===n&&"rotate"===i.mode){var r=i.rotationSnap;"X"===i.axis&&r&&(i.object.rotation.x=Math.round(i.object.rotation.x/r)*r),"Y"===i.axis&&r&&(i.object.rotation.y=Math.round(i.object.rotation.y/r)*r),"Z"===i.axis&&r&&(i.object.rotation.z=Math.round(i.object.rotation.z/r)*r)}i.object.updateMatrixWorld(),i.object.parent&&i.object.parent.updateMatrixWorld(),i.positionStart.copy(i.object.position),i.quaternionStart.copy(i.object.quaternion),i.scaleStart.copy(i.object.scale),i.object.matrixWorld.decompose(i.worldPositionStart,i.worldQuaternionStart,i.worldScaleStart),i.pointStart.copy(t.point).sub(i.worldPositionStart)}i.dragging=!0,i.mouseDownEvent.mode=i.mode,i.dispatchEvent(i.mouseDownEvent)}})),Object(D.a)(Object(z.a)(i),"pointerMove",(function(e){var t=i.axis,n=i.mode,r=i.object,a=i.space;if("scale"===n?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==r&&null!==t&&!1!==i.dragging&&-1===e.button){i.raycaster.setFromCamera(e,i.camera);var o=i.intersectObjectWithRay(i.plane,i.raycaster,!0);if(o){if(i.pointEnd.copy(o.point).sub(i.worldPositionStart),"translate"===n)i.offset.copy(i.pointEnd).sub(i.pointStart),"local"===a&&"XYZ"!==t&&i.offset.applyQuaternion(i.worldQuaternionInv),-1===t.indexOf("X")&&(i.offset.x=0),-1===t.indexOf("Y")&&(i.offset.y=0),-1===t.indexOf("Z")&&(i.offset.z=0),"local"===a&&"XYZ"!==t?i.offset.applyQuaternion(i.quaternionStart).divide(i.parentScale):i.offset.applyQuaternion(i.parentQuaternionInv).divide(i.parentScale),r.position.copy(i.offset).add(i.positionStart),i.translationSnap&&("local"===a&&(r.position.applyQuaternion(i.tempQuaternion.copy(i.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/i.translationSnap)*i.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/i.translationSnap)*i.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/i.translationSnap)*i.translationSnap),r.position.applyQuaternion(i.quaternionStart)),"world"===a&&(r.parent&&r.position.add(i.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/i.translationSnap)*i.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/i.translationSnap)*i.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/i.translationSnap)*i.translationSnap),r.parent&&r.position.sub(i.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var s=i.pointEnd.length()/i.pointStart.length();i.pointEnd.dot(i.pointStart)<0&&(s*=-1),i.tempVector2.set(s,s,s)}else i.tempVector.copy(i.pointStart),i.tempVector2.copy(i.pointEnd),i.tempVector.applyQuaternion(i.worldQuaternionInv),i.tempVector2.applyQuaternion(i.worldQuaternionInv),i.tempVector2.divide(i.tempVector),-1===t.search("X")&&(i.tempVector2.x=1),-1===t.search("Y")&&(i.tempVector2.y=1),-1===t.search("Z")&&(i.tempVector2.z=1);r.scale.copy(i.scaleStart).multiply(i.tempVector2),i.scaleSnap&&i.object&&(-1!==t.search("X")&&(i.object.scale.x=Math.round(r.scale.x/i.scaleSnap)*i.scaleSnap||i.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/i.scaleSnap)*i.scaleSnap||i.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/i.scaleSnap)*i.scaleSnap||i.scaleSnap))}else if("rotate"===n){i.offset.copy(i.pointEnd).sub(i.pointStart);var c=20/i.worldPosition.distanceTo(i.tempVector.setFromMatrixPosition(i.camera.matrixWorld));"E"===t?(i.rotationAxis.copy(i.eye),i.rotationAngle=i.pointEnd.angleTo(i.pointStart),i.startNorm.copy(i.pointStart).normalize(),i.endNorm.copy(i.pointEnd).normalize(),i.rotationAngle*=i.endNorm.cross(i.startNorm).dot(i.eye)<0?1:-1):"XYZE"===t?(i.rotationAxis.copy(i.offset).cross(i.eye).normalize(),i.rotationAngle=i.offset.dot(i.tempVector.copy(i.rotationAxis).cross(i.eye))*c):"X"!==t&&"Y"!==t&&"Z"!==t||(i.rotationAxis.copy(i.unit[t]),i.tempVector.copy(i.unit[t]),"local"===a&&i.tempVector.applyQuaternion(i.worldQuaternion),i.rotationAngle=i.offset.dot(i.tempVector.cross(i.eye).normalize())*c),i.rotationSnap&&(i.rotationAngle=Math.round(i.rotationAngle/i.rotationSnap)*i.rotationSnap),"local"===a&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(i.quaternionStart),r.quaternion.multiply(i.tempQuaternion.setFromAxisAngle(i.rotationAxis,i.rotationAngle)).normalize()):(i.rotationAxis.applyQuaternion(i.parentQuaternionInv),r.quaternion.copy(i.tempQuaternion.setFromAxisAngle(i.rotationAxis,i.rotationAngle)),r.quaternion.multiply(i.quaternionStart).normalize())}i.dispatchEvent(i.changeEvent),i.dispatchEvent(i.objectChangeEvent)}}})),Object(D.a)(Object(z.a)(i),"pointerUp",(function(e){0===e.button&&(i.dragging&&null!==i.axis&&(i.mouseUpEvent.mode=i.mode,i.dispatchEvent(i.mouseUpEvent)),i.dragging=!1,i.axis=null)})),Object(D.a)(Object(z.a)(i),"getPointer",(function(e){var t;if(i.domElement&&null!==(t=i.domElement.ownerDocument)&&void 0!==t&&t.pointerLockElement)return{x:0,y:0,button:e.button};var n,r=e.changedTouches?e.changedTouches[0]:e,a=null===(n=i.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(r.clientX-a.left)/a.width*2-1,y:-(r.clientY-a.top)/a.height*2+1,button:e.button}})),Object(D.a)(Object(z.a)(i),"onPointerHover",(function(e){if(i.enabled)switch(e.pointerType){case"mouse":case"pen":i.pointerHover(i.getPointer(e))}})),Object(D.a)(Object(z.a)(i),"onPointerDown",(function(e){i.enabled&&i.domElement&&(i.domElement.style.touchAction="none",i.domElement.ownerDocument.addEventListener("pointermove",i.onPointerMove),i.pointerHover(i.getPointer(e)),i.pointerDown(i.getPointer(e)))})),Object(D.a)(Object(z.a)(i),"onPointerMove",(function(e){i.enabled&&i.pointerMove(i.getPointer(e))})),Object(D.a)(Object(z.a)(i),"onPointerUp",(function(e){i.enabled&&i.domElement&&(i.domElement.style.touchAction="",i.domElement.ownerDocument.removeEventListener("pointermove",i.onPointerMove),i.pointerUp(i.getPointer(e)))})),Object(D.a)(Object(z.a)(i),"getMode",(function(){return i.mode})),Object(D.a)(Object(z.a)(i),"setMode",(function(e){i.mode=e})),Object(D.a)(Object(z.a)(i),"setTranslationSnap",(function(e){i.translationSnap=e})),Object(D.a)(Object(z.a)(i),"setRotationSnap",(function(e){i.rotationSnap=e})),Object(D.a)(Object(z.a)(i),"setScaleSnap",(function(e){i.scaleSnap=e})),Object(D.a)(Object(z.a)(i),"setSize",(function(e){i.size=e})),Object(D.a)(Object(z.a)(i),"setSpace",(function(e){i.space=e})),Object(D.a)(Object(z.a)(i),"update",(function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")})),Object(D.a)(Object(z.a)(i),"connect",(function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=e,i.domElement.addEventListener("pointerdown",i.onPointerDown),i.domElement.addEventListener("pointermove",i.onPointerHover),i.domElement.ownerDocument.addEventListener("pointerup",i.onPointerUp)})),Object(D.a)(Object(z.a)(i),"dispose",(function(){var e,t,n,r,a,o;null===(e=i.domElement)||void 0===e||e.removeEventListener("pointerdown",i.onPointerDown),null===(t=i.domElement)||void 0===t||t.removeEventListener("pointermove",i.onPointerHover),null===(n=i.domElement)||void 0===n||null===(r=n.ownerDocument)||void 0===r||r.removeEventListener("pointermove",i.onPointerMove),null===(a=i.domElement)||void 0===a||null===(o=a.ownerDocument)||void 0===o||o.removeEventListener("pointerup",i.onPointerUp),i.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))})),i.domElement=r,i.camera=e,i.gizmo=new xn,i.add(i.gizmo),i.plane=new Rn,i.add(i.plane);var o=function(e,t){var n=t;Object.defineProperty(Object(z.a)(i),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),i[e]=t,i.plane[e]=t,i.gizmo[e]=t};return o("camera",i.camera),o("object",i.object),o("enabled",i.enabled),o("axis",i.axis),o("mode",i.mode),o("translationSnap",i.translationSnap),o("rotationSnap",i.rotationSnap),o("scaleSnap",i.scaleSnap),o("space",i.space),o("size",i.size),o("dragging",i.dragging),o("showX",i.showX),o("showY",i.showY),o("showZ",i.showZ),o("worldPosition",i.worldPosition),o("worldPositionStart",i.worldPositionStart),o("worldQuaternion",i.worldQuaternion),o("worldQuaternionStart",i.worldQuaternionStart),o("cameraPosition",i.cameraPosition),o("cameraQuaternion",i.cameraQuaternion),o("pointStart",i.pointStart),o("pointEnd",i.pointEnd),o("rotationAxis",i.rotationAxis),o("rotationAngle",i.rotationAngle),o("eye",i.eye),void 0!==r&&i.connect(r),i}return Object(W.a)(n)}(g.Object3D),xn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r;Object(E.a)(this,n),r=t.call(this),Object(D.a)(Object(z.a)(r),"isTransformControlsGizmo",!0),Object(D.a)(Object(z.a)(r),"type","TransformControlsGizmo"),Object(D.a)(Object(z.a)(r),"tempVector",new g.Vector3(0,0,0)),Object(D.a)(Object(z.a)(r),"tempEuler",new g.Euler),Object(D.a)(Object(z.a)(r),"alignVector",new g.Vector3(0,1,0)),Object(D.a)(Object(z.a)(r),"zeroVector",new g.Vector3(0,0,0)),Object(D.a)(Object(z.a)(r),"lookAtMatrix",new g.Matrix4),Object(D.a)(Object(z.a)(r),"tempQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"tempQuaternion2",new g.Quaternion),Object(D.a)(Object(z.a)(r),"identityQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"unitX",new g.Vector3(1,0,0)),Object(D.a)(Object(z.a)(r),"unitY",new g.Vector3(0,1,0)),Object(D.a)(Object(z.a)(r),"unitZ",new g.Vector3(0,0,1)),Object(D.a)(Object(z.a)(r),"gizmo",void 0),Object(D.a)(Object(z.a)(r),"picker",void 0),Object(D.a)(Object(z.a)(r),"helper",void 0),Object(D.a)(Object(z.a)(r),"rotationAxis",new g.Vector3),Object(D.a)(Object(z.a)(r),"cameraPosition",new g.Vector3),Object(D.a)(Object(z.a)(r),"worldPositionStart",new g.Vector3),Object(D.a)(Object(z.a)(r),"worldQuaternionStart",new g.Quaternion),Object(D.a)(Object(z.a)(r),"worldPosition",new g.Vector3),Object(D.a)(Object(z.a)(r),"worldQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"eye",new g.Vector3),Object(D.a)(Object(z.a)(r),"camera",null),Object(D.a)(Object(z.a)(r),"enabled",!0),Object(D.a)(Object(z.a)(r),"axis",null),Object(D.a)(Object(z.a)(r),"mode","translate"),Object(D.a)(Object(z.a)(r),"space","world"),Object(D.a)(Object(z.a)(r),"size",1),Object(D.a)(Object(z.a)(r),"dragging",!1),Object(D.a)(Object(z.a)(r),"showX",!0),Object(D.a)(Object(z.a)(r),"showY",!0),Object(D.a)(Object(z.a)(r),"showZ",!0),Object(D.a)(Object(z.a)(r),"updateMatrixWorld",(function(){var t=r.space;"scale"===r.mode&&(t="local");var a="local"===t?r.worldQuaternion:r.identityQuaternion;r.gizmo.translate.visible="translate"===r.mode,r.gizmo.rotate.visible="rotate"===r.mode,r.gizmo.scale.visible="scale"===r.mode,r.helper.translate.visible="translate"===r.mode,r.helper.rotate.visible="rotate"===r.mode,r.helper.scale.visible="scale"===r.mode;var i=[];i=(i=(i=i.concat(r.picker[r.mode].children)).concat(r.gizmo[r.mode].children)).concat(r.helper[r.mode].children);for(var o=function(e){var t=i[e];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(r.worldPosition);var n=void 0;if(n=r.camera.isOrthographicCamera?(r.camera.top-r.camera.bottom)/r.camera.zoom:r.worldPosition.distanceTo(r.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*r.camera.fov/360)/r.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(n*r.size/7),"helper"===t.tag)return t.visible=!1,"AXIS"===t.name?(t.position.copy(r.worldPositionStart),t.visible=!!r.axis,"X"===r.axis&&(r.tempQuaternion.setFromEuler(r.tempEuler.set(0,0,0)),t.quaternion.copy(a).multiply(r.tempQuaternion),Math.abs(r.alignVector.copy(r.unitX).applyQuaternion(a).dot(r.eye))>.9&&(t.visible=!1)),"Y"===r.axis&&(r.tempQuaternion.setFromEuler(r.tempEuler.set(0,0,Math.PI/2)),t.quaternion.copy(a).multiply(r.tempQuaternion),Math.abs(r.alignVector.copy(r.unitY).applyQuaternion(a).dot(r.eye))>.9&&(t.visible=!1)),"Z"===r.axis&&(r.tempQuaternion.setFromEuler(r.tempEuler.set(0,Math.PI/2,0)),t.quaternion.copy(a).multiply(r.tempQuaternion),Math.abs(r.alignVector.copy(r.unitZ).applyQuaternion(a).dot(r.eye))>.9&&(t.visible=!1)),"XYZE"===r.axis&&(r.tempQuaternion.setFromEuler(r.tempEuler.set(0,Math.PI/2,0)),r.alignVector.copy(r.rotationAxis),t.quaternion.setFromRotationMatrix(r.lookAtMatrix.lookAt(r.zeroVector,r.alignVector,r.unitY)),t.quaternion.multiply(r.tempQuaternion),t.visible=r.dragging),"E"===r.axis&&(t.visible=!1)):"START"===t.name?(t.position.copy(r.worldPositionStart),t.visible=r.dragging):"END"===t.name?(t.position.copy(r.worldPosition),t.visible=r.dragging):"DELTA"===t.name?(t.position.copy(r.worldPositionStart),t.quaternion.copy(r.worldQuaternionStart),r.tempVector.set(1e-10,1e-10,1e-10).add(r.worldPositionStart).sub(r.worldPosition).multiplyScalar(-1),r.tempVector.applyQuaternion(r.worldQuaternionStart.clone().invert()),t.scale.copy(r.tempVector),t.visible=r.dragging):(t.quaternion.copy(a),r.dragging?t.position.copy(r.worldPositionStart):t.position.copy(r.worldPosition),r.axis&&(t.visible=-1!==r.axis.search(t.name))),"continue";if(t.quaternion.copy(a),"translate"===r.mode||"scale"===r.mode){var o=.99;"X"!==t.name&&"XYZX"!==t.name||Math.abs(r.alignVector.copy(r.unitX).applyQuaternion(a).dot(r.eye))>o&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Y"!==t.name&&"XYZY"!==t.name||Math.abs(r.alignVector.copy(r.unitY).applyQuaternion(a).dot(r.eye))>o&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Z"!==t.name&&"XYZZ"!==t.name||Math.abs(r.alignVector.copy(r.unitZ).applyQuaternion(a).dot(r.eye))>o&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XY"===t.name&&Math.abs(r.alignVector.copy(r.unitZ).applyQuaternion(a).dot(r.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"YZ"===t.name&&Math.abs(r.alignVector.copy(r.unitX).applyQuaternion(a).dot(r.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XZ"===t.name&&Math.abs(r.alignVector.copy(r.unitY).applyQuaternion(a).dot(r.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),-1!==t.name.search("X")&&(r.alignVector.copy(r.unitX).applyQuaternion(a).dot(r.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.x*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Y")&&(r.alignVector.copy(r.unitY).applyQuaternion(a).dot(r.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.y*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Z")&&(r.alignVector.copy(r.unitZ).applyQuaternion(a).dot(r.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.z*=-1:"bwd"===t.tag&&(t.visible=!1))}else"rotate"===r.mode&&(r.tempQuaternion2.copy(a),r.alignVector.copy(r.eye).applyQuaternion(r.tempQuaternion.copy(a).invert()),-1!==t.name.search("E")&&t.quaternion.setFromRotationMatrix(r.lookAtMatrix.lookAt(r.eye,r.zeroVector,r.unitY)),"X"===t.name&&(r.tempQuaternion.setFromAxisAngle(r.unitX,Math.atan2(-r.alignVector.y,r.alignVector.z)),r.tempQuaternion.multiplyQuaternions(r.tempQuaternion2,r.tempQuaternion),t.quaternion.copy(r.tempQuaternion)),"Y"===t.name&&(r.tempQuaternion.setFromAxisAngle(r.unitY,Math.atan2(r.alignVector.x,r.alignVector.z)),r.tempQuaternion.multiplyQuaternions(r.tempQuaternion2,r.tempQuaternion),t.quaternion.copy(r.tempQuaternion)),"Z"===t.name&&(r.tempQuaternion.setFromAxisAngle(r.unitZ,Math.atan2(r.alignVector.y,r.alignVector.x)),r.tempQuaternion.multiplyQuaternions(r.tempQuaternion2,r.tempQuaternion),t.quaternion.copy(r.tempQuaternion)));t.visible=t.visible&&(-1===t.name.indexOf("X")||r.showX),t.visible=t.visible&&(-1===t.name.indexOf("Y")||r.showY),t.visible=t.visible&&(-1===t.name.indexOf("Z")||r.showZ),t.visible=t.visible&&(-1===t.name.indexOf("E")||r.showX&&r.showY&&r.showZ),t.material.tempOpacity=t.material.tempOpacity||t.material.opacity,t.material.tempColor=t.material.tempColor||t.material.color.clone(),t.material.color.copy(t.material.tempColor),t.material.opacity=t.material.tempOpacity,r.enabled?r.axis&&(t.name===r.axis||r.axis.split("").some((function(e){return t.name===e}))?(t.material.opacity=1,t.material.color.lerp(new g.Color(1,1,1),.5)):(t.material.opacity*=.25,t.material.color.lerp(new g.Color(1,1,1),.5))):(t.material.opacity*=.5,t.material.color.lerp(new g.Color(1,1,1),.5))},s=0;s<i.length;s++)o(s);Object(q.a)((e=Object(z.a)(r),Object($.a)(n.prototype)),"updateMatrixWorld",e).call(e)}));var a=new g.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:g.DoubleSide,fog:!1,toneMapped:!1}),i=new g.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),o=a.clone();o.opacity=.15;var s=a.clone();s.opacity=.33;var c=a.clone();c.color.set(16711680);var u=a.clone();u.color.set(65280);var l=a.clone();l.color.set(255);var d=a.clone();d.opacity=.25;var I=d.clone();I.color.set(16776960);var A=d.clone();A.color.set(65535);var h=d.clone();h.color.set(16711935),a.clone().color.set(16776960);var C=i.clone();C.color.set(16711680);var f=i.clone();f.color.set(65280);var p=i.clone();p.color.set(255);var m=i.clone();m.color.set(65535);var v=i.clone();v.color.set(16711935);var b=i.clone();b.color.set(16776960);var y=i.clone();y.color.set(7895160);var B=b.clone();B.opacity=.25;var G=new g.CylinderGeometry(0,.05,.2,12,1,!1),w=new g.BoxGeometry(.125,.125,.125),_=new g.BufferGeometry;_.setAttribute("position",new g.Float32BufferAttribute([0,0,0,1,0,0],3));var Z=function(e,t){for(var n=new g.BufferGeometry,r=[],a=0;a<=64*t;++a)r.push(0,Math.cos(a/32*Math.PI)*e,Math.sin(a/32*Math.PI)*e);return n.setAttribute("position",new g.Float32BufferAttribute(r,3)),n},S={X:[[new g.Mesh(G,c),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new g.Mesh(G,c),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new g.Line(_,C)]],Y:[[new g.Mesh(G,u),[0,1,0],null,null,"fwd"],[new g.Mesh(G,u),[0,1,0],[Math.PI,0,0],null,"bwd"],[new g.Line(_,f),null,[0,0,Math.PI/2]]],Z:[[new g.Mesh(G,l),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new g.Mesh(G,l),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new g.Line(_,p),null,[0,-Math.PI/2,0]]],XYZ:[[new g.Mesh(new g.OctahedronGeometry(.1,0),d.clone()),[0,0,0],[0,0,0]]],XY:[[new g.Mesh(new g.PlaneGeometry(.295,.295),I.clone()),[.15,.15,0]],[new g.Line(_,b),[.18,.3,0],null,[.125,1,1]],[new g.Line(_,b),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new g.Mesh(new g.PlaneGeometry(.295,.295),A.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new g.Line(_,m),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new g.Line(_,m),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new g.Mesh(new g.PlaneGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new g.Line(_,v),[.18,0,.3],null,[.125,1,1]],[new g.Line(_,v),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},x={X:[[new g.Mesh(new g.CylinderGeometry(.2,0,1,4,1,!1),o),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new g.Mesh(new g.CylinderGeometry(.2,0,1,4,1,!1),o),[0,.6,0]]],Z:[[new g.Mesh(new g.CylinderGeometry(.2,0,1,4,1,!1),o),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new g.Mesh(new g.OctahedronGeometry(.2,0),o)]],XY:[[new g.Mesh(new g.PlaneGeometry(.4,.4),o),[.2,.2,0]]],YZ:[[new g.Mesh(new g.PlaneGeometry(.4,.4),o),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new g.Mesh(new g.PlaneGeometry(.4,.4),o),[.2,0,.2],[-Math.PI/2,0,0]]]},R={START:[[new g.Mesh(new g.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],END:[[new g.Mesh(new g.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],DELTA:[[new g.Line(function(){var e=new g.BufferGeometry;return e.setAttribute("position",new g.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),s),null,null,null,"helper"]],X:[[new g.Line(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new g.Line(_,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new g.Line(_,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={X:[[new g.Line(Z(1,.5),C)],[new g.Mesh(new g.OctahedronGeometry(.04,0),c),[0,0,.99],null,[1,3,1]]],Y:[[new g.Line(Z(1,.5),f),null,[0,0,-Math.PI/2]],[new g.Mesh(new g.OctahedronGeometry(.04,0),u),[0,0,.99],null,[3,1,1]]],Z:[[new g.Line(Z(1,.5),p),null,[0,Math.PI/2,0]],[new g.Mesh(new g.OctahedronGeometry(.04,0),l),[.99,0,0],null,[1,3,1]]],E:[[new g.Line(Z(1.25,1),B),null,[0,Math.PI/2,0]],[new g.Mesh(new g.CylinderGeometry(.03,0,.15,4,1,!1),B),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new g.Mesh(new g.CylinderGeometry(.03,0,.15,4,1,!1),B),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new g.Mesh(new g.CylinderGeometry(.03,0,.15,4,1,!1),B),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new g.Mesh(new g.CylinderGeometry(.03,0,.15,4,1,!1),B),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new g.Line(Z(1,1),y),null,[0,Math.PI/2,0]]]},k={AXIS:[[new g.Line(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},W={X:[[new g.Mesh(new g.TorusGeometry(1,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new g.Mesh(new g.TorusGeometry(1,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new g.Mesh(new g.TorusGeometry(1,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new g.Mesh(new g.TorusGeometry(1.25,.1,2,24),o)]],XYZE:[[new g.Mesh(new g.SphereGeometry(.7,10,8),o)]]},V={X:[[new g.Mesh(w,c),[.8,0,0],[0,0,-Math.PI/2]],[new g.Line(_,C),null,null,[.8,1,1]]],Y:[[new g.Mesh(w,u),[0,.8,0]],[new g.Line(_,f),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new g.Mesh(w,l),[0,0,.8],[Math.PI/2,0,0]],[new g.Line(_,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new g.Mesh(w,I),[.85,.85,0],null,[2,2,.2]],[new g.Line(_,b),[.855,.98,0],null,[.125,1,1]],[new g.Line(_,b),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new g.Mesh(w,A),[0,.85,.85],null,[.2,2,2]],[new g.Line(_,m),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new g.Line(_,m),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new g.Mesh(w,h),[.85,0,.85],null,[2,.2,2]],[new g.Line(_,v),[.855,0,.98],null,[.125,1,1]],[new g.Line(_,v),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new g.Mesh(new g.BoxGeometry(.125,.125,.125),d.clone()),[1.1,0,0]]],XYZY:[[new g.Mesh(new g.BoxGeometry(.125,.125,.125),d.clone()),[0,1.1,0]]],XYZZ:[[new g.Mesh(new g.BoxGeometry(.125,.125,.125),d.clone()),[0,0,1.1]]]},F={X:[[new g.Mesh(new g.CylinderGeometry(.2,0,.8,4,1,!1),o),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new g.Mesh(new g.CylinderGeometry(.2,0,.8,4,1,!1),o),[0,.5,0]]],Z:[[new g.Mesh(new g.CylinderGeometry(.2,0,.8,4,1,!1),o),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new g.Mesh(w,o),[.85,.85,0],null,[3,3,.2]]],YZ:[[new g.Mesh(w,o),[0,.85,.85],null,[.2,3,3]]],XZ:[[new g.Mesh(w,o),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new g.Mesh(new g.BoxGeometry(.2,.2,.2),o),[1.1,0,0]]],XYZY:[[new g.Mesh(new g.BoxGeometry(.2,.2,.2),o),[0,1.1,0]]],XYZZ:[[new g.Mesh(new g.BoxGeometry(.2,.2,.2),o),[0,0,1.1]]]},X={X:[[new g.Line(_,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new g.Line(_,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new g.Line(_,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H=function(e){var t=new g.Object3D;for(var n in e)for(var r=e[n].length;r--;){var a=e[n][r][0].clone(),i=e[n][r][1],o=e[n][r][2],s=e[n][r][3],c=e[n][r][4];a.name=n,a.tag=c,i&&a.position.set(i[0],i[1],i[2]),o&&a.rotation.set(o[0],o[1],o[2]),s&&a.scale.set(s[0],s[1],s[2]),a.updateMatrix();var u=a.geometry.clone();u.applyMatrix4(a.matrix),a.geometry=u,a.renderOrder=1/0,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),t.add(a)}return t};return r.gizmo={},r.picker={},r.helper={},r.add(r.gizmo.translate=H(S)),r.add(r.gizmo.rotate=H(M)),r.add(r.gizmo.scale=H(V)),r.add(r.picker.translate=H(x)),r.add(r.picker.rotate=H(W)),r.add(r.picker.scale=H(F)),r.add(r.helper.translate=H(R)),r.add(r.helper.rotate=H(k)),r.add(r.helper.scale=H(X)),r.picker.translate.visible=!1,r.picker.rotate.visible=!1,r.picker.scale.visible=!1,r}return Object(W.a)(n)}(g.Object3D),Rn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r;return Object(E.a)(this,n),r=t.call(this,new g.PlaneGeometry(1e5,1e5,2,2),new g.MeshBasicMaterial({visible:!1,wireframe:!0,side:g.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),Object(D.a)(Object(z.a)(r),"isTransformControlsPlane",!0),Object(D.a)(Object(z.a)(r),"type","TransformControlsPlane"),Object(D.a)(Object(z.a)(r),"unitX",new g.Vector3(1,0,0)),Object(D.a)(Object(z.a)(r),"unitY",new g.Vector3(0,1,0)),Object(D.a)(Object(z.a)(r),"unitZ",new g.Vector3(0,0,1)),Object(D.a)(Object(z.a)(r),"tempVector",new g.Vector3),Object(D.a)(Object(z.a)(r),"dirVector",new g.Vector3),Object(D.a)(Object(z.a)(r),"alignVector",new g.Vector3),Object(D.a)(Object(z.a)(r),"tempMatrix",new g.Matrix4),Object(D.a)(Object(z.a)(r),"identityQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"cameraQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"worldPosition",new g.Vector3),Object(D.a)(Object(z.a)(r),"worldQuaternion",new g.Quaternion),Object(D.a)(Object(z.a)(r),"eye",new g.Vector3),Object(D.a)(Object(z.a)(r),"axis",null),Object(D.a)(Object(z.a)(r),"mode","translate"),Object(D.a)(Object(z.a)(r),"space","world"),Object(D.a)(Object(z.a)(r),"updateMatrixWorld",(function(){var t=r.space;switch(r.position.copy(r.worldPosition),"scale"===r.mode&&(t="local"),r.unitX.set(1,0,0).applyQuaternion("local"===t?r.worldQuaternion:r.identityQuaternion),r.unitY.set(0,1,0).applyQuaternion("local"===t?r.worldQuaternion:r.identityQuaternion),r.unitZ.set(0,0,1).applyQuaternion("local"===t?r.worldQuaternion:r.identityQuaternion),r.alignVector.copy(r.unitY),r.mode){case"translate":case"scale":switch(r.axis){case"X":r.alignVector.copy(r.eye).cross(r.unitX),r.dirVector.copy(r.unitX).cross(r.alignVector);break;case"Y":r.alignVector.copy(r.eye).cross(r.unitY),r.dirVector.copy(r.unitY).cross(r.alignVector);break;case"Z":r.alignVector.copy(r.eye).cross(r.unitZ),r.dirVector.copy(r.unitZ).cross(r.alignVector);break;case"XY":r.dirVector.copy(r.unitZ);break;case"YZ":r.dirVector.copy(r.unitX);break;case"XZ":r.alignVector.copy(r.unitZ),r.dirVector.copy(r.unitY);break;case"XYZ":case"E":r.dirVector.set(0,0,0)}break;default:r.dirVector.set(0,0,0)}0===r.dirVector.length()?r.quaternion.copy(r.cameraQuaternion):(r.tempMatrix.lookAt(r.tempVector.set(0,0,0),r.dirVector,r.alignVector),r.quaternion.setFromRotationMatrix(r.tempMatrix)),Object(q.a)((e=Object(z.a)(r),Object($.a)(n.prototype)),"updateMatrixWorld",e).call(e)})),r}return Object(W.a)(n)}(g.Mesh),Mn=["children","domElement","onChange","onMouseDown","onMouseUp","onObjectChange","object"],kn=["camera"],En=i.forwardRef((function(e,t){var n=e.children,r=e.domElement,a=e.onChange,s=e.onMouseDown,c=e.onMouseUp,u=e.onObjectChange,l=e.object,d=Object(p.a)(e,Mn),I=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ"],A=d.camera,h=Object(p.a)(d,kn),C=Nt()(h,I),f=Zn()(h,I),v=Object(o.useThree)((function(e){return e.controls})),b=Object(o.useThree)((function(e){return e.gl})),y=Object(o.useThree)((function(e){return e.events})),B=Object(o.useThree)((function(e){return e.camera})),G=Object(o.useThree)((function(e){return e.invalidate})),w=A||B,_=r||y.connected||b.domElement,Z=i.useMemo((function(){return new Sn(w,_)}),[w,_]),S=i.useRef();return i.useLayoutEffect((function(){return l?Z.attach(l instanceof g.Object3D?l:l.current):S.current instanceof g.Object3D&&Z.attach(S.current),function(){Z.detach()}}),[l,n,Z]),i.useEffect((function(){if(v){var e=function(e){return v.enabled=!e.value};return Z.addEventListener("dragging-changed",e),function(){return Z.removeEventListener("dragging-changed",e)}}}),[Z,v]),i.useEffect((function(){var e=function(e){G(),a&&a(e)};return null==Z||null==Z.addEventListener||Z.addEventListener("change",e),s&&(null==Z||null==Z.addEventListener||Z.addEventListener("mouseDown",s)),c&&(null==Z||null==Z.addEventListener||Z.addEventListener("mouseUp",c)),u&&(null==Z||null==Z.addEventListener||Z.addEventListener("objectChange",u)),function(){null==Z||null==Z.removeEventListener||Z.removeEventListener("change",e),s&&(null==Z||null==Z.removeEventListener||Z.removeEventListener("mouseDown",s)),c&&(null==Z||null==Z.removeEventListener||Z.removeEventListener("mouseUp",c)),u&&(null==Z||null==Z.removeEventListener||Z.removeEventListener("objectChange",u))}}),[a,s,c,u,Z,G]),Z?i.createElement(i.Fragment,null,i.createElement("primitive",Object(m.a)({ref:t,dispose:void 0,object:Z},C)),i.createElement("group",Object(m.a)({ref:S},f),n)):null})),Wn=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"camera",void 0),Object(D.a)(Object(z.a)(a),"domElement",void 0),Object(D.a)(Object(z.a)(a),"isLocked",!1),Object(D.a)(Object(z.a)(a),"minPolarAngle",0),Object(D.a)(Object(z.a)(a),"maxPolarAngle",Math.PI),Object(D.a)(Object(z.a)(a),"changeEvent",{type:"change"}),Object(D.a)(Object(z.a)(a),"lockEvent",{type:"lock"}),Object(D.a)(Object(z.a)(a),"unlockEvent",{type:"unlock"}),Object(D.a)(Object(z.a)(a),"euler",new g.Euler(0,0,0,"YXZ")),Object(D.a)(Object(z.a)(a),"PI_2",Math.PI/2),Object(D.a)(Object(z.a)(a),"vec",new g.Vector3),Object(D.a)(Object(z.a)(a),"onMouseMove",(function(e){if(a.domElement&&!1!==a.isLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;a.euler.setFromQuaternion(a.camera.quaternion),a.euler.y-=.002*t,a.euler.x-=.002*n,a.euler.x=Math.max(a.PI_2-a.maxPolarAngle,Math.min(a.PI_2-a.minPolarAngle,a.euler.x)),a.camera.quaternion.setFromEuler(a.euler),a.dispatchEvent(a.changeEvent)}})),Object(D.a)(Object(z.a)(a),"onPointerlockChange",(function(){a.domElement&&(a.domElement.ownerDocument.pointerLockElement===a.domElement?(a.dispatchEvent(a.lockEvent),a.isLocked=!0):(a.dispatchEvent(a.unlockEvent),a.isLocked=!1))})),Object(D.a)(Object(z.a)(a),"onPointerlockError",(function(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")})),Object(D.a)(Object(z.a)(a),"connect",(function(e){a.domElement=e||a.domElement,a.domElement&&(a.domElement.ownerDocument.addEventListener("mousemove",a.onMouseMove),a.domElement.ownerDocument.addEventListener("pointerlockchange",a.onPointerlockChange),a.domElement.ownerDocument.addEventListener("pointerlockerror",a.onPointerlockError))})),Object(D.a)(Object(z.a)(a),"disconnect",(function(){a.domElement&&(a.domElement.ownerDocument.removeEventListener("mousemove",a.onMouseMove),a.domElement.ownerDocument.removeEventListener("pointerlockchange",a.onPointerlockChange),a.domElement.ownerDocument.removeEventListener("pointerlockerror",a.onPointerlockError))})),Object(D.a)(Object(z.a)(a),"dispose",(function(){a.disconnect()})),Object(D.a)(Object(z.a)(a),"getObject",(function(){return a.camera})),Object(D.a)(Object(z.a)(a),"direction",new g.Vector3(0,0,-1)),Object(D.a)(Object(z.a)(a),"getDirection",(function(e){return e.copy(a.direction).applyQuaternion(a.camera.quaternion)})),Object(D.a)(Object(z.a)(a),"moveForward",(function(e){a.vec.setFromMatrixColumn(a.camera.matrix,0),a.vec.crossVectors(a.camera.up,a.vec),a.camera.position.addScaledVector(a.vec,e)})),Object(D.a)(Object(z.a)(a),"moveRight",(function(e){a.vec.setFromMatrixColumn(a.camera.matrix,0),a.camera.position.addScaledVector(a.vec,e)})),Object(D.a)(Object(z.a)(a),"lock",(function(){a.domElement&&a.domElement.requestPointerLock()})),Object(D.a)(Object(z.a)(a),"unlock",(function(){a.domElement&&a.domElement.ownerDocument.exitPointerLock()})),a.domElement=r,a.camera=e,a.domElement&&a.connect(a.domElement),a}return Object(W.a)(n)}(g.EventDispatcher),Vn=["domElement","selector","onChange","onLock","onUnlock","enabled"],Fn=["camera"],Xn=i.forwardRef((function(e,t){var n=e.domElement,r=e.selector,a=e.onChange,s=e.onLock,c=e.onUnlock,u=e.enabled,g=void 0===u||u,d=Object(p.a)(e,Vn),I=d.camera,A=Object(p.a)(d,Fn),h=Object(o.useThree)((function(e){return e.gl})),C=Object(o.useThree)((function(e){return e.camera})),f=Object(o.useThree)((function(e){return e.invalidate})),v=Object(o.useThree)((function(e){return e.raycaster})),b=Object(o.useThree)((function(e){return e.events})),y=I||C,B=n||b.connected||h.domElement,G=i.useState((function(){return new Wn(y)})),w=Object(l.a)(G,1)[0];return i.useEffect((function(){if(g){w.connect(B);var e=v.computeOffsets;return v.computeOffsets=function(e){return{offsetX:e.target.width/2,offsetY:e.target.height/2}},function(){w.disconnect(),v.computeOffsets=e}}}),[g,w]),i.useEffect((function(){var e=function(e){f(),a&&a(e)};w.addEventListener("change",e),s&&w.addEventListener("lock",s),c&&w.addEventListener("unlock",c);var t=function(){return w.lock()},n=r?Array.from(document.querySelectorAll(r)):[document];return n.forEach((function(e){return e&&e.addEventListener("click",t)})),function(){w.removeEventListener("change",e),s&&w.addEventListener("lock",s),c&&w.addEventListener("unlock",c),n.forEach((function(e){return e?e.removeEventListener("click",t):void 0}))}}),[a,s,c,r]),i.createElement("primitive",Object(m.a)({ref:t,object:w},A))})),Hn=new g.Vector3,On=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r){var a;return Object(E.a)(this,n),a=t.call(this),Object(D.a)(Object(z.a)(a),"object",void 0),Object(D.a)(Object(z.a)(a),"domElement",void 0),Object(D.a)(Object(z.a)(a),"enabled",!0),Object(D.a)(Object(z.a)(a),"movementSpeed",1),Object(D.a)(Object(z.a)(a),"lookSpeed",.005),Object(D.a)(Object(z.a)(a),"lookVertical",!0),Object(D.a)(Object(z.a)(a),"autoForward",!1),Object(D.a)(Object(z.a)(a),"activeLook",!0),Object(D.a)(Object(z.a)(a),"heightSpeed",!1),Object(D.a)(Object(z.a)(a),"heightCoef",1),Object(D.a)(Object(z.a)(a),"heightMin",0),Object(D.a)(Object(z.a)(a),"heightMax",1),Object(D.a)(Object(z.a)(a),"constrainVertical",!1),Object(D.a)(Object(z.a)(a),"verticalMin",0),Object(D.a)(Object(z.a)(a),"verticalMax",Math.PI),Object(D.a)(Object(z.a)(a),"mouseDragOn",!1),Object(D.a)(Object(z.a)(a),"autoSpeedFactor",0),Object(D.a)(Object(z.a)(a),"mouseX",0),Object(D.a)(Object(z.a)(a),"mouseY",0),Object(D.a)(Object(z.a)(a),"moveForward",!1),Object(D.a)(Object(z.a)(a),"moveBackward",!1),Object(D.a)(Object(z.a)(a),"moveLeft",!1),Object(D.a)(Object(z.a)(a),"moveRight",!1),Object(D.a)(Object(z.a)(a),"moveUp",!1),Object(D.a)(Object(z.a)(a),"moveDown",!1),Object(D.a)(Object(z.a)(a),"viewHalfX",0),Object(D.a)(Object(z.a)(a),"viewHalfY",0),Object(D.a)(Object(z.a)(a),"lat",0),Object(D.a)(Object(z.a)(a),"lon",0),Object(D.a)(Object(z.a)(a),"lookDirection",new g.Vector3),Object(D.a)(Object(z.a)(a),"spherical",new g.Spherical),Object(D.a)(Object(z.a)(a),"target",new g.Vector3),Object(D.a)(Object(z.a)(a),"connect",(function(e){e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",a.contextmenu),e.addEventListener("mousemove",a.onMouseMove),e.addEventListener("mousedown",a.onMouseDown),e.addEventListener("mouseup",a.onMouseUp),a.domElement=e,window.addEventListener("keydown",a.onKeyDown),window.addEventListener("keyup",a.onKeyUp),a.handleResize()})),Object(D.a)(Object(z.a)(a),"dispose",(function(){var e,t,n,r;null===(e=a.domElement)||void 0===e||e.removeEventListener("contextmenu",a.contextmenu),null===(t=a.domElement)||void 0===t||t.removeEventListener("mousedown",a.onMouseDown),null===(n=a.domElement)||void 0===n||n.removeEventListener("mousemove",a.onMouseMove),null===(r=a.domElement)||void 0===r||r.removeEventListener("mouseup",a.onMouseUp),window.removeEventListener("keydown",a.onKeyDown),window.removeEventListener("keyup",a.onKeyUp)})),Object(D.a)(Object(z.a)(a),"handleResize",(function(){a.domElement&&(a.viewHalfX=a.domElement.offsetWidth/2,a.viewHalfY=a.domElement.offsetHeight/2)})),Object(D.a)(Object(z.a)(a),"onMouseDown",(function(e){var t;if(null===(t=a.domElement)||void 0===t||t.focus(),a.activeLook)switch(e.button){case 0:a.moveForward=!0;break;case 2:a.moveBackward=!0}a.mouseDragOn=!0})),Object(D.a)(Object(z.a)(a),"onMouseUp",(function(e){if(a.activeLook)switch(e.button){case 0:a.moveForward=!1;break;case 2:a.moveBackward=!1}a.mouseDragOn=!1})),Object(D.a)(Object(z.a)(a),"onMouseMove",(function(e){a.domElement&&(a.mouseX=e.pageX-a.domElement.offsetLeft-a.viewHalfX,a.mouseY=e.pageY-a.domElement.offsetTop-a.viewHalfY)})),Object(D.a)(Object(z.a)(a),"onKeyDown",(function(e){switch(e.code){case"ArrowUp":case"KeyW":a.moveForward=!0;break;case"ArrowLeft":case"KeyA":a.moveLeft=!0;break;case"ArrowDown":case"KeyS":a.moveBackward=!0;break;case"ArrowRight":case"KeyD":a.moveRight=!0;break;case"KeyR":a.moveUp=!0;break;case"KeyF":a.moveDown=!0}})),Object(D.a)(Object(z.a)(a),"onKeyUp",(function(e){switch(e.code){case"ArrowUp":case"KeyW":a.moveForward=!1;break;case"ArrowLeft":case"KeyA":a.moveLeft=!1;break;case"ArrowDown":case"KeyS":a.moveBackward=!1;break;case"ArrowRight":case"KeyD":a.moveRight=!1;break;case"KeyR":a.moveUp=!1;break;case"KeyF":a.moveDown=!1}})),Object(D.a)(Object(z.a)(a),"lookAt",(function(e,t,n){return e instanceof g.Vector3?a.target.copy(e):t&&n&&a.target.set(e,t,n),a.object.lookAt(a.target),a.setOrientation(),Object(z.a)(a)})),Object(D.a)(Object(z.a)(a),"update",(function(e){if(a.enabled){if(a.heightSpeed){var t=g.MathUtils.clamp(a.object.position.y,a.heightMin,a.heightMax)-a.heightMin;a.autoSpeedFactor=e*(t*a.heightCoef)}else a.autoSpeedFactor=0;var n=e*a.movementSpeed;(a.moveForward||a.autoForward&&!a.moveBackward)&&a.object.translateZ(-(n+a.autoSpeedFactor)),a.moveBackward&&a.object.translateZ(n),a.moveLeft&&a.object.translateX(-n),a.moveRight&&a.object.translateX(n),a.moveUp&&a.object.translateY(n),a.moveDown&&a.object.translateY(-n);var r=e*a.lookSpeed;a.activeLook||(r=0);var i=1;a.constrainVertical&&(i=Math.PI/(a.verticalMax-a.verticalMin)),a.lon-=a.mouseX*r,a.lookVertical&&(a.lat-=a.mouseY*r*i),a.lat=Math.max(-85,Math.min(85,a.lat));var o=g.MathUtils.degToRad(90-a.lat),s=g.MathUtils.degToRad(a.lon);a.constrainVertical&&(o=g.MathUtils.mapLinear(o,0,Math.PI,a.verticalMin,a.verticalMax));var c=a.object.position;Hn.setFromSphericalCoords(1,o,s).add(c),a.object.lookAt(Hn)}})),Object(D.a)(Object(z.a)(a),"contextmenu",(function(e){return e.preventDefault()})),Object(D.a)(Object(z.a)(a),"setOrientation",(function(){a.lookDirection.set(0,0,-1).applyQuaternion(a.object.quaternion),a.spherical.setFromVector3(a.lookDirection),a.lat=90-g.MathUtils.radToDeg(a.spherical.phi),a.lon=g.MathUtils.radToDeg(a.spherical.theta)})),a.object=e,a.domElement=r,a.setOrientation(),r&&a.connect(r),a}return Object(W.a)(n)}(g.EventDispatcher),Ln=i.forwardRef((function(e,t){var n=Object(o.useThree)((function(e){return e.camera})),r=Object(o.useThree)((function(e){return e.gl})),a=i.useState((function(){return new On(n,r.domElement)})),s=Object(l.a)(a,1)[0];return Object(o.useFrame)((function(e,t){s.update(t)})),s?i.createElement("primitive",Object(m.a)({ref:t,object:s},e)):null}));function Nn(e,t){var n=Object(o.useThree)((function(e){return e.mouse})),r=i.useState((function(){var r=new g.Raycaster;return t&&Object(o.applyProps)(r,t,{}),function(t,a){r.setFromCamera(n,e instanceof g.Camera?e:e.current);var i=this.constructor.prototype.raycast.bind(this);i&&i(r,a)}}));return Object(l.a)(r,1)[0]}var Yn=i.createContext({}),Tn=function(){return i.useContext(Yn)},zn=2*Math.PI,Kn=new g.Object3D,jn=new g.Matrix4,Dn=new g.Quaternion,Un=new g.Quaternion,Qn=new g.Vector3,Pn=new g.Vector3,Jn=function(e){var t=e.alignment,n=void 0===t?"bottom-right":t,r=e.margin,a=void 0===r?[80,80]:r,s=e.renderPriority,c=void 0===s?0:s,u=e.autoClear,d=void 0===u||u,I=e.onUpdate,A=e.onTarget,h=e.children,C=Object(o.useThree)((function(e){return e.size})),f=Object(o.useThree)((function(e){return e.camera})),p=Object(o.useThree)((function(e){return e.controls})),m=Object(o.useThree)((function(e){return e.gl})),v=Object(o.useThree)((function(e){return e.scene})),b=Object(o.useThree)((function(e){return e.invalidate})),y=i.useRef(),B=i.useRef(),G=i.useRef(null),w=i.useState((function(){return new g.Scene})),_=Object(l.a)(w,1)[0],Z=i.useRef(!1),S=i.useRef(0),x=i.useRef(new g.Vector3(0,0,0)),R=i.useCallback((function(e){Z.current=!0,(p||A)&&(x.current=(null==p?void 0:p.target)||(null==A?void 0:A())),S.current=f.position.distanceTo(Qn),Dn.copy(f.quaternion),Pn.copy(e).multiplyScalar(S.current).add(Qn),Kn.lookAt(Pn),Un.copy(Kn.quaternion),b()}),[p,f,A,b]);i.useEffect((function(){return v.background&&(y.current=v.background,v.background=null,_.background=y.current),function(){y.current&&(v.background=y.current)}}),[]),Object(o.useFrame)((function(e,t){if(G.current&&B.current){var n;if(Z.current)if(Dn.angleTo(Un)<.01)Z.current=!1;else{var r=t*zn;Dn.rotateTowards(Un,r),f.position.set(0,0,1).applyQuaternion(Dn).multiplyScalar(S.current).add(x.current),f.up.set(0,1,0).applyQuaternion(Dn).normalize(),f.quaternion.copy(Dn),I?I():p&&p.update(),b()}jn.copy(f.matrix).invert(),null==(n=B.current)||n.quaternion.setFromRotationMatrix(jn),d&&(m.autoClear=!1),m.clearDepth(),m.render(_,G.current)}}),c);var M=Nn(G),k=i.useMemo((function(){return{tweenCamera:R,raycast:M}}),[R]),E=Object(l.a)(a,2),W=E[0],V=E[1],F=n.endsWith("-left")?-C.width/2+W:C.width/2-W,X=n.startsWith("top-")?C.height/2-V:-C.height/2+V;return Object(o.createPortal)(i.createElement(Yn.Provider,{value:k},i.createElement(Dt,{ref:G,position:[0,0,200]}),i.createElement("group",{ref:B,position:[F,X,0]},h)),_)},qn="#f0f0f0",$n="#999",er="black",tr="black",nr=["Right","Left","Top","Bottom","Front","Back"],rr=function(e){return Object(se.a)(g.Vector3,Object(a.a)(e)).multiplyScalar(.38)},ar=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(rr),ir=[.25,.25,.25],or=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(rr),sr=or.map((function(e){return e.toArray().map((function(e){return 0==e?.5:.25}))})),cr=function(e){var t=e.hover,n=e.index,r=e.font,a=void 0===r?"20px Inter var, Arial, sans-serif":r,s=e.faces,c=void 0===s?nr:s,u=e.color,l=void 0===u?qn:u,d=e.hoverColor,I=void 0===d?$n:d,A=e.textColor,h=void 0===A?er:A,C=e.strokeColor,f=void 0===C?tr:C,p=e.opacity,m=void 0===p?1:p,v=Object(o.useThree)((function(e){return e.gl})),b=i.useMemo((function(){var e=document.createElement("canvas");e.width=128,e.height=128;var t=e.getContext("2d");return t.fillStyle=l,t.fillRect(0,0,e.width,e.height),t.strokeStyle=f,t.strokeRect(0,0,e.width,e.height),t.font=a,t.textAlign="center",t.fillStyle=h,t.fillText(c[n].toUpperCase(),64,76),new g.CanvasTexture(e)}),[n,c,a,l,h,f]);return i.createElement("meshLambertMaterial",{map:b,"map-anisotropy":v.capabilities.getMaxAnisotropy()||1,attachArray:"material",color:t?I:"white",transparent:!0,opacity:m})},ur=function(e){var t=Tn(),n=t.tweenCamera,r=t.raycast,o=i.useState(null),s=Object(l.a)(o,2),c=s[0],u=s[1];return i.createElement("mesh",{raycast:r,onPointerOut:function(e){e.stopPropagation(),u(null)},onPointerMove:function(e){e.stopPropagation(),u(Math.floor(e.faceIndex/2))},onClick:e.onClick||function(e){e.stopPropagation(),n(e.face.normal)}},Object(a.a)(Array(6)).map((function(t,n){return i.createElement(cr,Object(m.a)({key:n,index:n,hover:c===n},e))})),i.createElement("boxGeometry",null))},lr=function(e){var t=e.onClick,n=e.dimensions,r=e.position,a=e.hoverColor,o=void 0===a?$n:a,s=Tn(),c=s.tweenCamera,u=s.raycast,g=i.useState(!1),d=Object(l.a)(g,2),I=d[0],A=d[1];return i.createElement("mesh",{scale:1.01,position:r,raycast:u,onPointerOver:function(e){e.stopPropagation(),A(!0)},onPointerOut:function(e){e.stopPropagation(),A(!1)},onClick:t||function(e){e.stopPropagation(),c(r)}},i.createElement("meshBasicMaterial",{color:I?o:"white",transparent:!0,opacity:.6,visible:I}),i.createElement("boxGeometry",{args:n}))},gr=function(e){return i.createElement("group",{scale:[60,60,60]},i.createElement(ur,e),or.map((function(t,n){return i.createElement(lr,Object(m.a)({key:n,position:t,dimensions:sr[n]},e))})),ar.map((function(t,n){return i.createElement(lr,Object(m.a)({key:n,position:t,dimensions:ir},e))})),i.createElement("ambientLight",{intensity:.5}),i.createElement("pointLight",{position:[10,10,10],intensity:.5}))},dr=["onClick","font","disabled","arcStyle","label","labelColor","axisHeadScale"],Ir=["hideNegativeAxes","hideAxisHeads","disabled","font","axisColors","axisHeadScale","axisScale","labels","labelColor","onClick"];function Ar(e){var t=e.scale,n=void 0===t?[.8,.05,.05]:t,r=e.color,a=e.rotation;return i.createElement("group",{rotation:a},i.createElement("mesh",{position:[.4,0,0]},i.createElement("boxGeometry",{args:n}),i.createElement("meshBasicMaterial",{color:r,toneMapped:!1})))}function hr(e){var t=e.onClick,n=e.font,r=e.disabled,a=e.arcStyle,s=e.label,c=e.labelColor,u=e.axisHeadScale,d=void 0===u?1:u,I=Object(p.a)(e,dr),A=Object(o.useThree)((function(e){return e.gl})),h=i.useMemo((function(){var e=document.createElement("canvas");e.width=64,e.height=64;var t=e.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=a,t.fill(),s&&(t.font=n,t.textAlign="center",t.fillStyle=c,t.fillText(s,32,41)),new g.CanvasTexture(e)}),[a,s,c,n]),C=i.useState(!1),f=Object(l.a)(C,2),v=f[0],b=f[1],y=(s?1:.75)*(v?1.2:1)*d;return i.createElement("sprite",Object(m.a)({scale:y,onPointerOver:r?void 0:function(e){e.stopPropagation(),b(!0)},onPointerOut:r?void 0:t||function(e){e.stopPropagation(),b(!1)}},I),i.createElement("spriteMaterial",{map:h,"map-anisotropy":A.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}var Cr=function(e){var t=e.hideNegativeAxes,n=e.hideAxisHeads,r=e.disabled,a=e.font,o=void 0===a?"18px Inter var, Arial, sans-serif":a,s=e.axisColors,c=void 0===s?["#ff3653","#0adb50","#2c8fdf"]:s,u=e.axisHeadScale,g=void 0===u?1:u,d=e.axisScale,I=e.labels,A=void 0===I?["X","Y","Z"]:I,h=e.labelColor,C=void 0===h?"#000":h,f=e.onClick,v=Object(p.a)(e,Ir),b=Object(l.a)(c,3),y=b[0],B=b[1],G=b[2],w=Tn(),_=w.tweenCamera,Z={font:o,disabled:r,labelColor:C,raycast:w.raycast,onClick:f,axisHeadScale:g,onPointerDown:r?void 0:function(e){_(e.object.position),e.stopPropagation()}};return i.createElement("group",Object(m.a)({scale:40},v),i.createElement(Ar,{color:y,rotation:[0,0,0],scale:d}),i.createElement(Ar,{color:B,rotation:[0,0,Math.PI/2],scale:d}),i.createElement(Ar,{color:G,rotation:[0,-Math.PI/2,0],scale:d}),!n&&i.createElement(i.Fragment,null,i.createElement(hr,Object(m.a)({arcStyle:y,position:[1,0,0],label:A[0]},Z)),i.createElement(hr,Object(m.a)({arcStyle:B,position:[0,1,0],label:A[1]},Z)),i.createElement(hr,Object(m.a)({arcStyle:G,position:[0,0,1],label:A[2]},Z)),!t&&i.createElement(i.Fragment,null,i.createElement(hr,Object(m.a)({arcStyle:y,position:[-1,0,0]},Z)),i.createElement(hr,Object(m.a)({arcStyle:B,position:[0,-1,0]},Z)),i.createElement(hr,Object(m.a)({arcStyle:G,position:[0,0,-1]},Z)))),i.createElement("ambientLight",{intensity:.5}),i.createElement("pointLight",{position:[10,10,10],intensity:.5}))};function fr(e,t){var n=t.path,r=Object(o.useLoader)(g.CubeTextureLoader,[e],(function(e){return e.setPath(n)}));return Object(l.a)(r,1)[0]}fr.preload=function(e,t){var n=t.path;return o.useLoader.preload(g.CubeTextureLoader,[e],(function(e){return e.setPath(n)}))};var pr=Uint8Array,mr=Uint16Array,vr=Uint32Array,br=new pr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yr=new pr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Br=new pr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gr=function(e,t){for(var n=new mr(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var a=new vr(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return[n,a]},wr=Gr(br,2),_r=wr[0],Zr=wr[1];_r[28]=258,Zr[258]=28;for(var Sr=Gr(yr,0),xr=Sr[0],Rr=(Sr[1],new mr(32768)),Mr=0;Mr<32768;++Mr){var kr=(43690&Mr)>>>1|(21845&Mr)<<1;kr=(61680&(kr=(52428&kr)>>>2|(13107&kr)<<2))>>>4|(3855&kr)<<4,Rr[Mr]=((65280&kr)>>>8|(255&kr)<<8)>>>1}var Er=function(e,t,n){for(var r=e.length,a=0,i=new mr(t);a<r;++a)++i[e[a]-1];var o,s=new mr(t);for(a=0;a<t;++a)s[a]=s[a-1]+i[a-1]<<1;if(n){o=new mr(1<<t);var c=15-t;for(a=0;a<r;++a)if(e[a])for(var u=a<<4|e[a],l=t-e[a],g=s[e[a]-1]++<<l,d=g|(1<<l)-1;g<=d;++g)o[Rr[g]>>>c]=u}else for(o=new mr(r),a=0;a<r;++a)e[a]&&(o[a]=Rr[s[e[a]-1]++]>>>15-e[a]);return o},Wr=new pr(288);for(Mr=0;Mr<144;++Mr)Wr[Mr]=8;for(Mr=144;Mr<256;++Mr)Wr[Mr]=9;for(Mr=256;Mr<280;++Mr)Wr[Mr]=7;for(Mr=280;Mr<288;++Mr)Wr[Mr]=8;var Vr=new pr(32);for(Mr=0;Mr<32;++Mr)Vr[Mr]=5;var Fr=Er(Wr,9,1),Xr=Er(Vr,5,1),Hr=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Or=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Lr=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Nr=function(e){return(e/8|0)+(7&e&&1)},Yr=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof mr?mr:e instanceof vr?vr:pr)(n-t);return r.set(e.subarray(t,n)),r},Tr=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new pr(0);var a=!t||n,i=!n||n.i;n||(n={}),t||(t=new pr(3*r));var o=function(e){var n=t.length;if(e>n){var r=new pr(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,c=n.p||0,u=n.b||0,l=n.l,g=n.d,d=n.m,I=n.n,A=8*r;do{if(!l){n.f=s=Or(e,c,1);var h=Or(e,c+1,3);if(c+=3,!h){var C=e[(Z=Nr(c)+4)-4]|e[Z-3]<<8,f=Z+C;if(f>r){if(i)throw"unexpected EOF";break}a&&o(u+C),t.set(e.subarray(Z,f),u),n.b=u+=C,n.p=c=8*f;continue}if(1==h)l=Fr,g=Xr,d=9,I=5;else{if(2!=h)throw"invalid block type";var p=Or(e,c,31)+257,m=Or(e,c+10,15)+4,v=p+Or(e,c+5,31)+1;c+=14;for(var b=new pr(v),y=new pr(19),B=0;B<m;++B)y[Br[B]]=Or(e,c+3*B,7);c+=3*m;var G=Hr(y),w=(1<<G)-1,_=Er(y,G,1);for(B=0;B<v;){var Z,S=_[Or(e,c,w)];if(c+=15&S,(Z=S>>>4)<16)b[B++]=Z;else{var x=0,R=0;for(16==Z?(R=3+Or(e,c,3),c+=2,x=b[B-1]):17==Z?(R=3+Or(e,c,7),c+=3):18==Z&&(R=11+Or(e,c,127),c+=7);R--;)b[B++]=x}}var M=b.subarray(0,p),k=b.subarray(p);d=Hr(M),I=Hr(k),l=Er(M,d,1),g=Er(k,I,1)}if(c>A){if(i)throw"unexpected EOF";break}}a&&o(u+131072);for(var E=(1<<d)-1,W=(1<<I)-1,V=c;;V=c){var F=(x=l[Lr(e,c)&E])>>>4;if((c+=15&x)>A){if(i)throw"unexpected EOF";break}if(!x)throw"invalid length/literal";if(F<256)t[u++]=F;else{if(256==F){V=c,l=null;break}var X=F-254;if(F>264){var H=br[B=F-257];X=Or(e,c,(1<<H)-1)+_r[B],c+=H}var O=g[Lr(e,c)&W],L=O>>>4;if(!O)throw"invalid distance";c+=15&O;k=xr[L];if(L>3){H=yr[L];k+=Lr(e,c)&(1<<H)-1,c+=H}if(c>A){if(i)throw"unexpected EOF";break}a&&o(u+131072);for(var N=u+X;u<N;u+=4)t[u]=t[u-k],t[u+1]=t[u+1-k],t[u+2]=t[u+2-k],t[u+3]=t[u+3-k];u=N}}n.l=l,n.p=V,n.b=u,l&&(s=1,n.m=d,n.d=g,n.n=I)}while(!s);return u==t.length?t:Yr(t,0,u)},zr=new pr(0),Kr=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function jr(e,t){return Tr((Kr(e),e.subarray(2,-4)),t)}var Dr="undefined"!=typeof TextDecoder&&new TextDecoder;try{Dr.decode(zr,{stream:!0}),1}catch(kl){}var Ur,Qr,Pr,Jr=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r,a,i,o){var s;Object(E.a)(this,n),(s=t.call(this)).degree=e,s.knots=r,s.controlPoints=[],s.startKnot=i||0,s.endKnot=o||s.knots.length-1;for(var c=0;c<a.length;++c){var u=a[c];s.controlPoints[c]=new g.Vector4(u.x,u.y,u.z,u.w)}return s}return Object(W.a)(n,[{key:"getPoint",value:function(e,t){var n=t||new g.Vector3,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(e,t,n,r){for(var a=this.findSpan(e,r,t),i=this.calcBasisFunctions(a,r,e,t),o=new g.Vector4(0,0,0,0),s=0;s<=e;++s){var c=n[a-e+s],u=i[s],l=c.w*u;o.x+=c.x*l,o.y+=c.y*l,o.z+=c.z*l,o.w+=c.w*u}return o}(this.degree,this.knots,this.controlPoints,r);return 1!=a.w&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)}},{key:"getTangent",value:function(e,t){var n=t||new g.Vector3,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=function(e,t,n,r,a){var i=this.calcBSplineDerivatives(e,t,n,r,a);return this.calcRationalCurveDerivatives(i)}(this.degree,this.knots,this.controlPoints,r,1);return n.copy(a[1]).normalize(),n}}]),n}(g.Curve),qr=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){return Object(E.a)(this,n),t.call(this,e)}return Object(W.a)(n,[{key:"load",value:function(e,t,n,r){var a=this,i=""===a.path?g.LoaderUtils.extractUrlBase(e):a.path,o=new g.FileLoader(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,(function(n){try{t(a.parse(n,i))}catch(kl){r?r(kl):console.error(kl),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e,t){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===ha(e,0,t.length)}(e))Ur=(new ra).parse(e);else{var n=ha(e);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(t){var r=e[t-1];return e=e.slice(n+t),n++,r}for(var a=0;a<t.length;++a){if(r(1)===t[a])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(oa(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+oa(n));Ur=(new na).parse(n)}var r=new g.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new $r(r,this.manager).parse(Ur)}}]),n}(g.Loader),$r=function(){function e(t,n){Object(E.a)(this,e),this.textureLoader=t,this.manager=n}return Object(W.a)(e,[{key:"parse",value:function(){Qr=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),a=(new ea).parse(r);return this.parseScene(r,a,n),Pr}},{key:"parseConnections",value:function(){var e=new Map;"Connections"in Ur&&Ur.Connections.connections.forEach((function(t){var n=t[0],r=t[1],a=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var i={ID:r,relationship:a};e.get(n).parents.push(i),e.has(r)||e.set(r,{parents:[],children:[]});var o={ID:n,relationship:a};e.get(r).children.push(o)}));return e}},{key:"parseImages",value:function(){var e={},t={};if("Video"in Ur.Objects){var n=Ur.Objects.Video;for(var r in n){var a=n[r];if(e[parseInt(r)]=a.RelativeFilename||a.Filename,"Content"in a){var i=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o="string"===typeof a.Content&&""!==a.Content;if(i||o){var s=this.parseImage(n[r]);t[a.RelativeFilename||a.Filename]=s}}}}for(var c in e){var u=e[c];void 0!==t[u]?e[c]=t[u]:e[c]=e[c].split("\\").pop()}return e}},{key:"parseImage",value:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,a=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"===typeof n)return"data:"+t+";base64,"+n;var i=new Uint8Array(n);return window.URL.createObjectURL(new Blob([i],{type:t}))}},{key:"parseTextures",value:function(e){var t=new Map;if("Texture"in Ur.Objects){var n=Ur.Objects.Texture;for(var r in n){var a=this.parseTexture(n[r],e);t.set(parseInt(r),a)}}return t}},{key:"parseTexture",value:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,a=e.WrapModeV,i=void 0!==r?r.value:0,o=void 0!==a?a.value:0;if(n.wrapS=0===i?g.RepeatWrapping:g.ClampToEdgeWrapping,n.wrapT=0===o?g.RepeatWrapping:g.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n}},{key:"loadTexture",value:function(e,t){var n,r,a=this.textureLoader.path,i=Qr.get(e.id).children;void 0!==i&&i.length>0&&void 0!==t[i[0].ID]&&(0!==(n=t[i[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var o=e.FileName.slice(-3).toLowerCase();if("tga"===o){var s=this.manager.getHandler(".tga");null===s?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new g.Texture):(s.setPath(this.textureLoader.path),r=s.load(n))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new g.Texture):r=this.textureLoader.load(n);return this.textureLoader.setPath(a),r}},{key:"parseMaterials",value:function(e){var t=new Map;if("Material"in Ur.Objects){var n=Ur.Objects.Material;for(var r in n){var a=this.parseMaterial(n[r],e);null!==a&&t.set(parseInt(r),a)}}return t}},{key:"parseMaterial",value:function(e,t){var n=e.id,r=e.attrName,a=e.ShadingModel;if("object"===typeof a&&(a=a.value),!Qr.has(n))return null;var i,o=this.parseParameters(e,t,n);switch(a.toLowerCase()){case"phong":i=new g.MeshPhongMaterial;break;case"lambert":i=new g.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),i=new g.MeshPhongMaterial}return i.setValues(o),i.name=r,i}},{key:"parseParameters",value:function(e,t,n){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new g.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new g.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new g.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new g.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new g.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new g.Color).fromArray(e.SpecularColor.value));var a=this;return Qr.get(n).children.forEach((function(e){var n=e.relationship;switch(n){case"Bump":r.bumpMap=a.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(t,e.ID),void 0!==r.map&&(r.map.encoding=g.sRGBEncoding);break;case"DisplacementColor":r.displacementMap=a.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(t,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.encoding=g.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=a.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=g.EquirectangularReflectionMapping,r.envMap.encoding=g.sRGBEncoding);break;case"SpecularColor":r.specularMap=a.getTexture(t,e.ID),void 0!==r.specularMap&&(r.specularMap.encoding=g.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=a.getTexture(t,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}},{key:"getTexture",value:function(e,t){return"LayeredTexture"in Ur.Objects&&t in Ur.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Qr.get(t).children[0].ID),e.get(t)}},{key:"parseDeformers",value:function(){var e={},t={};if("Deformer"in Ur.Objects){var n=Ur.Objects.Deformer;for(var r in n){var a=n[r],i=Qr.get(parseInt(r));if("Skin"===a.attrType){var o=this.parseSkeleton(i,n);o.ID=r,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=i.parents[0].ID,e[r]=o}else if("BlendShape"===a.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(i,n),s.id=r,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=s}}}return{skeletons:e,morphTargets:t}}},{key:"parseSkeleton",value:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var a={ID:e.ID,indices:[],weights:[],transformLink:(new g.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(a.indices=r.Indexes.a,a.weights=r.Weights.a),n.push(a)}})),{rawBones:n,bones:[]}}},{key:"parseMorphTargets",value:function(e,t){for(var n=[],r=0;r<e.children.length;r++){var a=e.children[r],i=t[a.ID],o={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if("BlendShapeChannel"!==i.attrType)return;o.geoID=Qr.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(o)}return n}},{key:"parseScene",value:function(e,t,n){Pr=new g.Group;var r=this.parseModels(e.skeletons,t,n),a=Ur.Objects.Model,i=this;r.forEach((function(e){var t=a[e.ID];i.setLookAtProperties(e,t),Qr.get(e.ID).parents.forEach((function(t){var n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Pr.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),Pr.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=da(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var o=(new ta).parse();1===Pr.children.length&&Pr.children[0].isGroup&&(Pr.children[0].animations=o,Pr=Pr.children[0]),Pr.animations=o}},{key:"parseModels",value:function(e,t,n){var r=new Map,a=Ur.Objects.Model;for(var i in a){var o=parseInt(i),s=a[i],c=Qr.get(o),u=this.buildSkeleton(c,e,o,s.attrName);if(!u){switch(s.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new g.Bone;break;default:u=new g.Group}u.name=s.attrName?g.PropertyBinding.sanitizeNodeName(s.attrName):"",u.ID=o}this.getTransformData(u,s),r.set(o,u)}return r}},{key:"buildSkeleton",value:function(e,t,n,r){var a=null;return e.parents.forEach((function(e){var i=function(i){var o=t[i];o.rawBones.forEach((function(t,i){if(t.ID===e.ID){var s=a;(a=new g.Bone).matrixWorld.copy(t.transformLink),a.name=r?g.PropertyBinding.sanitizeNodeName(r):"",a.ID=n,o.bones[i]=a,null!==s&&a.add(s)}}))};for(var o in t)i(o)})),a}},{key:"createCamera",value:function(e){var t,n;if(e.children.forEach((function(e){var t=Ur.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new g.Object3D;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var i=1e3;void 0!==n.FarPlane&&(i=n.FarPlane.value/1e3);var o=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,s=n.AspectHeight.value);var c=o/s,u=45;void 0!==n.FieldOfView&&(u=n.FieldOfView.value);var l=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new g.PerspectiveCamera(u,c,a,i),null!==l&&t.setFocalLength(l);break;case 1:t=new g.OrthographicCamera(-o/2,o/2,s/2,-s/2,a,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new g.Object3D}}return t}},{key:"createLight",value:function(e){var t,n;if(e.children.forEach((function(e){var t=Ur.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new g.Object3D;else{var r;r=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new g.Color).fromArray(n.Color.value));var i=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(i=0);var o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(r){case 0:t=new g.PointLight(a,i,o,1);break;case 1:t=new g.DirectionalLight(a,i);break;case 2:var s=Math.PI/3;void 0!==n.InnerAngle&&(s=g.MathUtils.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=g.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new g.SpotLight(a,i,o,s,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new g.PointLight(a,i)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}},{key:"createMesh",value:function(e,t,n){var r,a=null,i=null,o=[];return e.children.forEach((function(e){t.has(e.ID)&&(a=t.get(e.ID)),n.has(e.ID)&&o.push(n.get(e.ID))})),o.length>1?i=o:o.length>0?i=o[0]:(i=new g.MeshPhongMaterial({color:13421772}),o.push(i)),"color"in a.attributes&&o.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(r=new g.SkinnedMesh(a,i)).normalizeSkinWeights():r=new g.Mesh(a,i),r}},{key:"createCurve",value:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new g.LineBasicMaterial({color:3342591,linewidth:1});return new g.Line(n,r)}},{key:"getTransformData",value:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Ia(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}},{key:"setLookAtProperties",value:function(e,t){"LookAtProperty"in t&&Qr.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var n=Ur.Objects.Model[t.ID];if("Lcl_Translation"in n){var r=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(r),Pr.add(e.target)):e.lookAt((new g.Vector3).fromArray(r))}}}))}},{key:"bindSkeleton",value:function(e,t,n){var r=this.parsePoseNodes(),a=function(a){var i=e[a];Qr.get(parseInt(i.ID)).parents.forEach((function(e){if(t.has(e.ID)){var a=e.ID;Qr.get(a).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new g.Skeleton(i.bones),r[e.ID])}))}}))};for(var i in e)a(i)}},{key:"parsePoseNodes",value:function(){var e={};if("Pose"in Ur.Objects){var t=Ur.Objects.Pose;for(var n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){var r=t[n].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new g.Matrix4).fromArray(t.Matrix.a)})):e[r.Node]=(new g.Matrix4).fromArray(r.Matrix.a)}}return e}},{key:"createAmbientLight",value:function(){if("GlobalSettings"in Ur&&"AmbientColor"in Ur.GlobalSettings){var e=Ur.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){var a=new g.Color(t,n,r);Pr.add(new g.AmbientLight(a,1))}}}}]),e}(),ea=function(){function e(){Object(E.a)(this,e)}return Object(W.a)(e,[{key:"parse",value:function(e){var t=new Map;if("Geometry"in Ur.Objects){var n=Ur.Objects.Geometry;for(var r in n){var a=Qr.get(parseInt(r)),i=this.parseGeometry(a,n[r],e);t.set(parseInt(r),i)}}return t}},{key:"parseGeometry",value:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}},{key:"parseMeshGeometry",value:function(e,t,n){var r=n.skeletons,a=[],i=e.parents.map((function(e){return Ur.Objects.Model[e.ID]}));if(0!==i.length){var o=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&a.push(n.morphTargets[e.ID])}));var s=i[0],c={};"RotationOrder"in s&&(c.eulerOrder=Ia(s.RotationOrder.value)),"InheritType"in s&&(c.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(c.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(c.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(c.scale=s.GeometricScaling.value);var u=da(c);return this.genGeometry(t,o,a,u)}}},{key:"genGeometry",value:function(e,t,n,r){var a=new g.BufferGeometry;e.attrName&&(a.name=e.attrName);var i=this.parseGeoNode(e,t),o=this.genBuffers(i),s=new g.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(r),a.setAttribute("position",s),o.colors.length>0&&a.setAttribute("color",new g.Float32BufferAttribute(o.colors,3)),t&&(a.setAttribute("skinIndex",new g.Uint16BufferAttribute(o.weightsIndices,4)),a.setAttribute("skinWeight",new g.Float32BufferAttribute(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){var c=(new g.Matrix3).getNormalMatrix(r),u=new g.Float32BufferAttribute(o.normal,3);u.applyNormalMatrix(c),a.setAttribute("normal",u)}if(o.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),a.setAttribute(n,new g.Float32BufferAttribute(o.uvs[t],2))})),i.material&&"AllSame"!==i.material.mappingType){var l=o.materialIndex[0],d=0;if(o.materialIndex.forEach((function(e,t){e!==l&&(a.addGroup(d,t-d,l),l=e,d=t)})),a.groups.length>0){var I=a.groups[a.groups.length-1],A=I.start+I.count;A!==o.materialIndex.length&&a.addGroup(A,o.materialIndex.length-A,l)}0===a.groups.length&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,n,r),a}},{key:"parseGeoNode",value:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,a){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[a]})}))}))),n}},{key:"genBuffers",value:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,a=!1,i=[],o=[],s=[],c=[],u=[],l=[],g=this;return e.vertexIndices.forEach((function(d,I){var A,h=!1;d<0&&(d^=-1,h=!0);var C=[],f=[];if(i.push(3*d,3*d+1,3*d+2),e.color){var p=ua(I,n,d,e.color);s.push(p[0],p[1],p[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){f.push(e.weight),C.push(e.id)})),f.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);var m=[0,0,0,0],v=[0,0,0,0];f.forEach((function(e,t){var n=e,r=C[t];v.forEach((function(e,t,a){if(n>e){a[t]=n,n=e;var i=m[t];m[t]=r,r=i}}))})),C=m,f=v}for(;f.length<4;)f.push(0),C.push(0);for(var b=0;b<4;++b)u.push(f[b]),l.push(C[b])}if(e.normal){var y=ua(I,n,d,e.normal);o.push(y[0],y[1],y[2])}e.material&&"AllSame"!==e.material.mappingType&&(A=ua(I,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){var r=ua(I,n,d,e);void 0===c[t]&&(c[t]=[]),c[t].push(r[0]),c[t].push(r[1])})),r++,h&&(g.genFace(t,e,i,A,o,s,c,u,l,r),n++,r=0,i=[],o=[],s=[],c=[],u=[],l=[])})),t}},{key:"genFace",value:function(e,t,n,r,a,i,o,s,c,u){for(var l=function(u){e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[3*(u-1)]),e.colors.push(i[3*(u-1)+1]),e.colors.push(i[3*(u-1)+2]),e.colors.push(i[3*u]),e.colors.push(i[3*u+1]),e.colors.push(i[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[3*(u-1)]),e.normal.push(a[3*(u-1)+1]),e.normal.push(a[3*(u-1)+2]),e.normal.push(a[3*u]),e.normal.push(a[3*u+1]),e.normal.push(a[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(u-1)]),e.uvs[n].push(o[n][2*(u-1)+1]),e.uvs[n].push(o[n][2*u]),e.uvs[n].push(o[n][2*u+1])}))},g=2;g<u;g++)l(g)}},{key:"addMorphTargets",value:function(e,t,n,r){if(0!==n.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var a=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var i=Ur.Objects.Geometry[n.geoID];void 0!==i&&a.genMorphGeometry(e,t,i,r,n.name)}))}))}}},{key:"genMorphGeometry",value:function(e,t,n,r,a){for(var i=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c),l=0;l<s.length;l++){var d=3*s[l];u[d]=o[3*l],u[d+1]=o[3*l+1],u[d+2]=o[3*l+2]}var I={vertexIndices:i,vertexPositions:u},A=this.genBuffers(I),h=new g.Float32BufferAttribute(A.vertex,3);h.name=a||n.attrName,h.applyMatrix4(r),e.morphAttributes.position.push(h)}},{key:"parseNormals",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,a=[];return"IndexToDirect"===n&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:a,mappingType:t,referenceType:n}}},{key:"parseUVs",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,a=[];return"IndexToDirect"===n&&(a=e.UVIndex.a),{dataSize:2,buffer:r,indices:a,mappingType:t,referenceType:n}}},{key:"parseVertexColors",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,a=[];return"IndexToDirect"===n&&(a=e.ColorIndex.a),{dataSize:4,buffer:r,indices:a,mappingType:t,referenceType:n}}},{key:"parseMaterialIndices",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,a=[],i=0;i<r.length;++i)a.push(i);return{dataSize:1,buffer:r,indices:a,mappingType:t,referenceType:n}}},{key:"parseNurbsGeometry",value:function(e){if(void 0===Jr)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new g.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new g.BufferGeometry;for(var n,r,a=t-1,i=e.KnotVector.a,o=[],s=e.Points.a,c=0,u=s.length;c<u;c+=4)o.push((new g.Vector4).fromArray(s,c));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){n=a,r=i.length-1-n;for(var l=0;l<a;++l)o.push(o[l])}var d=new Jr(a,i,o,n,r).getPoints(12*o.length);return(new g.BufferGeometry).setFromPoints(d)}}]),e}(),ta=function(){function e(){Object(E.a)(this,e)}return Object(W.a)(e,[{key:"parse",value:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],a=this.addClip(r);e.push(a)}return e}},{key:"parseClips",value:function(){if(void 0!==Ur.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}}},{key:"parseAnimationCurveNodes",value:function(){var e=Ur.Objects.AnimationCurveNode,t=new Map;for(var n in e){var r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var a={id:r.id,attr:r.attrName,curves:{}};t.set(a.id,a)}}return t}},{key:"parseAnimationCurves",value:function(e){var t=Ur.Objects.AnimationCurve;for(var n in t){var r={id:t[n].id,times:t[n].KeyTime.a.map(sa),values:t[n].KeyValueFloat.a},a=Qr.get(r.id);if(void 0!==a){var i=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(i).curves.x=r:o.match(/Y/)?e.get(i).curves.y=r:o.match(/Z/)?e.get(i).curves.z=r:o.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=r)}}}},{key:"parseAnimationLayers",value:function(e){var t=Ur.Objects.AnimationLayer,n=new Map,r=function(t){var r=[],a=Qr.get(parseInt(t));void 0!==a&&(a.children.forEach((function(t,n){if(e.has(t.ID)){var a=e.get(t.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===r[n]){var i=Qr.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==i){var o=Ur.Objects.Model[i.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",t);var s={modelName:o.attrName?g.PropertyBinding.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Pr.traverse((function(e){e.ID===o.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new g.Matrix4),"PreRotation"in o&&(s.preRotation=o.PreRotation.value),"PostRotation"in o&&(s.postRotation=o.PostRotation.value),r[n]=s}}r[n]&&(r[n][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===r[n]){var c=Qr.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,u=Qr.get(c).parents[0].ID,l=Qr.get(u).parents[0].ID,d=Qr.get(l).parents[0].ID,I=Ur.Objects.Model[d],A={modelName:I.attrName?g.PropertyBinding.sanitizeNodeName(I.attrName):"",morphName:Ur.Objects.Deformer[c].attrName};r[n]=A}r[n][a.attr]=a}}})),n.set(parseInt(t),r))};for(var a in t)r(a);return n}},{key:"parseAnimStacks",value:function(e){var t=Ur.Objects.AnimationStack,n={};for(var r in t){var a=Qr.get(parseInt(r)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var i=e.get(a[0].ID);n[r]={name:t[r].attrName,layer:i}}return n}},{key:"addClip",value:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new g.AnimationClip(e.name,-1,t)}},{key:"generateTracks",value:function(e){var t=[],n=new g.Vector3,r=new g.Quaternion,a=new g.Vector3;if(e.transform&&e.transform.decompose(n,r,a),n=n.toArray(),r=(new g.Euler).setFromQuaternion(r,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t}},{key:"generateVectorTrack",value:function(e,t,n,r){var a=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(a,t,n);return new g.VectorKeyframeTrack(e+"."+r,a,i)}},{key:"generateRotationTrack",value:function(e,t,n,r,a,i){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(g.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(g.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(g.MathUtils.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);void 0!==r&&((r=r.map(g.MathUtils.degToRad)).push(i),r=(new g.Euler).fromArray(r),r=(new g.Quaternion).setFromEuler(r)),void 0!==a&&((a=a.map(g.MathUtils.degToRad)).push(i),a=(new g.Euler).fromArray(a),a=(new g.Quaternion).setFromEuler(a).invert());for(var c=new g.Quaternion,u=new g.Euler,l=[],d=0;d<s.length;d+=3)u.set(s[d],s[d+1],s[d+2],i),c.setFromEuler(u),void 0!==r&&c.premultiply(r),void 0!==a&&c.multiply(a),c.toArray(l,d/3*4);return new g.QuaternionKeyframeTrack(e+".quaternion",o,l)}},{key:"generateMorphTrack",value:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=Pr.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new g.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}},{key:"getTimesForAllAxes",value:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var n=1,r=t[0],a=1;a<t.length;a++){var i=t[a];i!==r&&(t[n]=i,r=i,n++)}t=t.slice(0,n)}return t}},{key:"getKeyframeTrackValues",value:function(e,t,n){var r=n,a=[],i=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){var n=t.x.values[i];a.push(n),r[0]=n}else a.push(r[0]);if(-1!==o){var c=t.y.values[o];a.push(c),r[1]=c}else a.push(r[1]);if(-1!==s){var u=t.z.values[s];a.push(u),r[2]=u}else a.push(r[2])})),a}},{key:"interpolateRotations",value:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,a=Math.abs(r);if(a>=180){for(var i=a/180,o=r/i,s=n+o,c=e.times[t-1],u=(e.times[t]-c)/i,l=c+u,g=[],d=[];l<e.times[t];)g.push(l),l+=u,d.push(s),s+=o;e.times=Ca(e.times,t,g),e.values=Ca(e.values,t,d)}}}}]),e}(),na=function(){function e(){Object(E.a)(this,e)}return Object(W.a)(e,[{key:"getPrevNode",value:function(){return this.nodeStack[this.currentIndent-2]}},{key:"getCurrentNode",value:function(){return this.nodeStack[this.currentIndent-1]}},{key:"getCurrentProp",value:function(){return this.currentProp}},{key:"pushStack",value:function(e){this.nodeStack.push(e),this.currentIndent+=1}},{key:"popStack",value:function(){this.nodeStack.pop(),this.currentIndent-=1}},{key:"setCurrentProp",value:function(e,t){this.currentProp=e,this.currentPropName=t}},{key:"parse",value:function(e){this.currentIndent=0,this.allNodes=new ia,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var a=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!a&&!i){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,n[++r]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes}},{key:"parseNodeBegin",value:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:n},i=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,a):n in o?("PoseNode"===n?o.PoseNode.push(a):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==i.id&&(o[n][i.id]=a)):"number"===typeof i.id?(o[n]={},o[n][i.id]=a):"Properties70"!==n&&(o[n]="PoseNode"===n?[a]:a),"number"===typeof i.id&&(a.id=i.id),""!==i.name&&(a.attrName=i.name),""!==i.type&&(a.attrType=i.type),this.pushStack(a)}},{key:"parseNodeAttr",value:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}},{key:"parseNodeProperty",value:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===a&&(a=n.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===r){var o=a.split(",").slice(1),s=parseInt(o[0]),c=parseInt(o[1]),u=a.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,a=t.length;n<a;n++,r++)e[r]=t[n]}(a=[s,c],u=u.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===i[r]&&(i[r]=[])}"Node"===r&&(i.id=a),r in i&&Array.isArray(i[r])?i[r].push(a):"a"!==r?i[r]=a:i.a=a,this.setCurrentProp(i,r),"a"===r&&","!==a.slice(-1)&&(i.a=Aa(a))}else this.parseNodeSpecialProperty(e,r,a)}},{key:"parseNodePropertyContinued",value:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Aa(t.a))}},{key:"parseNodeSpecialProperty",value:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=r[0],i=r[1],o=r[2],s=r[3],c=r[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Aa(c)}this.getPrevNode()[a]={type:i,type2:o,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),a)}}]),e}(),ra=function(){function e(){Object(E.a)(this,e)}return Object(W.a)(e,[{key:"parse",value:function(e){var t=new aa(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new ia;!this.endOfContent(t);){var a=this.parseNode(t,n);null!==a&&r.add(a.name,a)}return r}},{key:"endOfContent",value:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}},{key:"parseNode",value:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var i=e.getUint8(),o=e.getString(i);if(0===r)return null;for(var s=[],c=0;c<a;c++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",l=s.length>1?s[1]:"",g=s.length>2?s[2]:"";for(n.singleProperty=1===a&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,n,d)}return n.propertyList=s,"number"===typeof u&&(n.id=u),""!==l&&(n.attrName=l),""!==g&&(n.attrType=g),""!==o&&(n.name=o),n}},{key:"parseSubNode",value:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var a=[];n.propertyList.forEach((function(e,t){0!==t&&a.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(a)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var i,o=n.propertyList[0],s=n.propertyList[1],c=n.propertyList[2],u=n.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),i="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[o]={type:s,type2:c,flag:u,value:i}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}},{key:"parseProperty",value:function(e){var t,n=e.getString(1);switch(n){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),a=e.getUint32(),i=e.getUint32();if(0===a)switch(n){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}var o=jr(new Uint8Array(e.getArrayBuffer(i))),s=new aa(o.buffer);switch(n){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+n)}}}]),e}(),aa=function(){function e(t,n){Object(E.a)(this,e),this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===n||n}return Object(W.a)(e,[{key:"getOffset",value:function(){return this.offset}},{key:"size",value:function(){return this.dv.buffer.byteLength}},{key:"skip",value:function(e){this.offset+=e}},{key:"getBoolean",value:function(){return 1===(1&this.getUint8())}},{key:"getBooleanArray",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t}},{key:"getUint8",value:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}},{key:"getInt16",value:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}},{key:"getInt32",value:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t}},{key:"getUint32",value:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}},{key:"getInt64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t}},{key:"getUint64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}},{key:"getFloat32",value:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getFloat32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t}},{key:"getFloat64",value:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}},{key:"getFloat64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t}},{key:"getArrayBuffer",value:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}},{key:"getString",value:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),g.LoaderUtils.decodeText(new Uint8Array(t))}}]),e}(),ia=function(){function e(){Object(E.a)(this,e)}return Object(W.a)(e,[{key:"add",value:function(e,t){this[e]=t}}]),e}();function oa(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function sa(e){return e/46186158e3}var ca=[];function ua(e,t,n,r){var a;switch(r.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=n;break;case"AllSame":a=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(a=r.indices[a]);var i=a*r.dataSize,o=i+r.dataSize;return function(e,t,n,r){for(var a=n,i=0;a<r;a++,i++)e[i]=t[a];return e}(ca,r.buffer,i,o)}var la=new g.Euler,ga=new g.Vector3;function da(e){var t=new g.Matrix4,n=new g.Matrix4,r=new g.Matrix4,a=new g.Matrix4,i=new g.Matrix4,o=new g.Matrix4,s=new g.Matrix4,c=new g.Matrix4,u=new g.Matrix4,l=new g.Matrix4,d=new g.Matrix4,I=new g.Matrix4,A=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(ga.fromArray(e.translation)),e.preRotation){var h=e.preRotation.map(g.MathUtils.degToRad);h.push(e.eulerOrder),n.makeRotationFromEuler(la.fromArray(h))}if(e.rotation){var C=e.rotation.map(g.MathUtils.degToRad);C.push(e.eulerOrder),r.makeRotationFromEuler(la.fromArray(C))}if(e.postRotation){var f=e.postRotation.map(g.MathUtils.degToRad);f.push(e.eulerOrder),a.makeRotationFromEuler(la.fromArray(f)),a.invert()}e.scale&&i.scale(ga.fromArray(e.scale)),e.scalingOffset&&s.setPosition(ga.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(ga.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(ga.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(ga.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),l.copy(e.parentMatrixWorld));var p=n.clone().multiply(r).multiply(a),m=new g.Matrix4;m.extractRotation(l);var v=new g.Matrix4;v.copyPosition(l);var b=v.clone().invert().multiply(l),y=m.clone().invert().multiply(b),B=i,G=new g.Matrix4;if(0===A)G.copy(m).multiply(p).multiply(y).multiply(B);else if(1===A)G.copy(m).multiply(y).multiply(p).multiply(B);else{var w=(new g.Matrix4).scale((new g.Vector3).setFromMatrixScale(d)).clone().invert(),_=y.clone().multiply(w);G.copy(m).multiply(p).multiply(_).multiply(B)}var Z=u.clone().invert(),S=o.clone().invert(),x=t.clone().multiply(c).multiply(u).multiply(n).multiply(r).multiply(a).multiply(Z).multiply(s).multiply(o).multiply(i).multiply(S),R=(new g.Matrix4).copyPosition(x),M=l.clone().multiply(R);return I.copyPosition(M),(x=I.clone().multiply(G)).premultiply(l.invert()),x}function Ia(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Aa(e){return e.split(",").map((function(e){return parseFloat(e)}))}function ha(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),g.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function Ca(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}function fa(e){return Object(o.useLoader)(qr,e)}fa.preload=function(e){return o.useLoader.preload(qr,e)},fa.clear=function(e){return o.useLoader.clear(qr,e)};var pa,ma=new WeakMap,va=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},r}return Object(W.a)(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,r){var a=this,i=new g.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(e){var n={attributeIDs:a.defaultAttributeIDs,attributeTypes:a.defaultAttributeTypes,useUniqueIDs:!1};a.decodeGeometry(e,n).then(t).catch(r)}),n,r)}},{key:"decodeDracoFile",value:function(e,t,n,r){var a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,a).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var r in t.attributeTypes){var a=t.attributeTypes[r];void 0!==a.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=a.name)}var i,o=JSON.stringify(t);if(ma.has(e)){var s=ma.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var c=this.workerNextTaskID++,u=e.byteLength,l=this._getWorker(c,u).then((function(n){return i=n,new Promise((function(n,r){i._callbacks[c]={resolve:n,reject:r},i.postMessage({type:"decode",id:c,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return l.catch((function(){return!0})).then((function(){i&&c&&n._releaseTask(i,c)})),ma.set(e,{key:o,promise:l}),l}},{key:"_createGeometry",value:function(e){var t=new g.BufferGeometry;e.index&&t.setIndex(new g.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],a=r.name,i=r.array,o=r.itemSize;t.setAttribute(a,new g.BufferAttribute(i,o))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new g.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var a=ba.toString(),i=["/* draco decoder */",r,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var a=n.workerPool[n.workerPool.length-1];return a._taskCosts[e]=t,a._taskLoad+=t,a}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(g.Loader);function ba(){var e,t;function n(e,t,n,r,a,i){var o=i.num_components(),s=n.num_points()*o,c=s*a.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,a),l=e._malloc(c);t.GetAttributeDataArrayForAllPoints(n,i,u,c,l);var g=new a(e.HEAPF32.buffer,l,s).slice();return e._free(l),{name:r,array:g,itemSize:o}}onmessage=function(r){var a=r.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var i=a.buffer,o=a.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(i),i.byteLength);try{var c=function(e,t,r,a){var i,o,s=a.attributeIDs,c=a.attributeTypes,u=t.GetEncodedGeometryType(r);if(u===e.TRIANGULAR_MESH)i=new e.Mesh,o=t.DecodeBufferToMesh(r,i);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");i=new e.PointCloud,o=t.DecodeBufferToPointCloud(r,i)}if(!o.ok()||0===i.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var l={index:null,attributes:[]};for(var g in s){var d=self[c[g]],I=void 0,A=void 0;if(a.useUniqueIDs)A=s[g],I=t.GetAttributeByUniqueId(i,A);else{if(-1===(A=t.GetAttributeId(i,e[s[g]])))continue;I=t.GetAttribute(i,A)}l.attributes.push(n(e,t,i,g,d,I))}u===e.TRIANGULAR_MESH&&(l.index=function(e,t,n){var r=3*n.num_faces(),a=4*r,i=e._malloc(a);t.GetTrianglesUInt32Array(n,a,i);var o=new Uint32Array(e.HEAPF32.buffer,i,r).slice();return e._free(i),{array:o,itemSize:1}}(e,t,i));return e.destroy(i),l}(t,r,s,o),u=c.attributes.map((function(e){return e.array.buffer}));c.index&&u.push(c.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:c},u)}catch(l){console.error(l),self.postMessage({type:"error",id:a.id,error:l.message})}finally{t.destroy(s),t.destroy(r)}}))}}}var ya=function(){if(pa)return pa;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!==typeof WebAssembly)return{supported:!1};var n,r="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(r="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");var a=WebAssembly.instantiate(function(e){for(var n=new Uint8Array(e.length),r=0;r<e.length;++r){var a=e.charCodeAt(r);n[r]=a>96?a-71:a>64?a-65:a>47?a+4:a>46?63:62}for(var i=0,o=0;o<e.length;++o)n[i++]=n[o]<60?t[n[o]]:64*(n[o]-60)+n[++o];return n.buffer.slice(0,i)}(r),{}).then((function(e){(n=e.instance).exports.__wasm_call_ctors()}));function i(e,t,r,a,i,o){var s=n.exports.sbrk,c=r+3&-4,u=s(c*a),l=s(i.length),g=new Uint8Array(n.exports.memory.buffer);g.set(i,l);var d=e(u,r,a,l,i.length);if(0===d&&o&&o(u,c,a),t.set(g.subarray(u,u+r*a)),s(u-s(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}var o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return pa={ready:a,supported:!0,decodeVertexBuffer:function(e,t,r,a,s){i(n.exports.meshopt_decodeVertexBuffer,e,t,r,a,n.exports[o[s]])},decodeIndexBuffer:function(e,t,r,a){i(n.exports.meshopt_decodeIndexBuffer,e,t,r,a)},decodeIndexSequence:function(e,t,r,a){i(n.exports.meshopt_decodeIndexSequence,e,t,r,a)},decodeGltfBuffer:function(e,t,r,a,c,u){i(n.exports[s[c]],e,t,r,a,n.exports[o[u]])}}},Ba=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).dracoLoader=null,r.ktx2Loader=null,r.meshoptDecoder=null,r.pluginCallbacks=[],r.register((function(e){return new Sa(e)})),r.register((function(e){return new Wa(e)})),r.register((function(e){return new Va(e)})),r.register((function(e){return new xa(e)})),r.register((function(e){return new Ra(e)})),r.register((function(e){return new Ma(e)})),r.register((function(e){return new ka(e)})),r.register((function(e){return new Ea(e)})),r.register((function(e){return new _a(e)})),r.register((function(e){return new Fa(e)})),r}return Object(W.a)(n,[{key:"load",value:function(e,t,n,r){var a,i=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:g.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},s=new g.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{i.parse(n,a,(function(n){t(n),i.manager.itemEnd(e)}),o)}catch(kl){o(kl)}}),n,o)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,r){var a,i={},o={};if("string"===typeof e)a=e;else if(g.LoaderUtils.decodeText(new Uint8Array(e,0,4))===Xa){try{i[wa.KHR_BINARY_GLTF]=new La(e)}catch(h){return void(r&&r(h))}a=i[wa.KHR_BINARY_GLTF].content}else a=g.LoaderUtils.decodeText(new Uint8Array(e));var s=JSON.parse(a);if(void 0===s.asset||s.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var c=new pi(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var l=this.pluginCallbacks[u](c);o[l.name]=l,i[l.name]=!0}if(s.extensionsUsed)for(var d=0;d<s.extensionsUsed.length;++d){var I=s.extensionsUsed[d],A=s.extensionsRequired||[];switch(I){case wa.KHR_MATERIALS_UNLIT:i[I]=new Za;break;case wa.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:i[I]=new za;break;case wa.KHR_DRACO_MESH_COMPRESSION:i[I]=new Na(s,this.dracoLoader);break;case wa.KHR_TEXTURE_TRANSFORM:i[I]=new Ya;break;case wa.KHR_MESH_QUANTIZATION:i[I]=new Ka;break;default:A.indexOf(I)>=0&&void 0===o[I]&&console.warn('THREE.GLTFLoader: Unknown extension "'+I+'".')}}c.setExtensions(i),c.setPlugins(o),c.parse(n,r)}}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(r,a){n.parse(e,t,r,a)}))}}]),n}(g.Loader);function Ga(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var wa={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},_a=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return Object(W.a)(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var a=t[n];a.extensions&&a.extensions[this.name]&&void 0!==a.extensions[this.name].light&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var a,i=t.json,o=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e],s=new g.Color(16777215);void 0!==o.color&&s.fromArray(o.color);var c=void 0!==o.range?o.range:0;switch(o.type){case"directional":(a=new g.DirectionalLight(s)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new g.PointLight(s)).distance=c;break;case"spot":(a=new g.SpotLight(s)).distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then((function(e){return n._getNodeRef(t.cache,a,e)}))}}]),e}(),Za=function(){function e(){Object(E.a)(this,e),this.name=wa.KHR_MATERIALS_UNLIT}return Object(W.a)(e,[{key:"getMaterialType",value:function(){return g.MeshBasicMaterial}},{key:"extendParams",value:function(e,t,n){var r=[];e.color=new g.Color(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var i=a.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==a.baseColorTexture&&r.push(n.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(r)}}]),e}(),Sa=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_CLEARCOAT}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[],i=r.extensions[this.name];if(void 0!==i.clearcoatFactor&&(t.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&a.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&a.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(a.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){var o=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new g.Vector2(o,o)}return Promise.all(a)}}]),e}(),xa=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_SHEEN}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[];t.sheenColor=new g.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;var i=r.extensions[this.name];return void 0!==i.sheenColorFactor&&t.sheenColor.fromArray(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&(t.sheenRoughness=i.sheenRoughnessFactor),void 0!==i.sheenColorTexture&&a.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture)),void 0!==i.sheenRoughnessTexture&&a.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(a)}}]),e}(),Ra=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_TRANSMISSION}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&a.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(a)}}]),e}(),Ma=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_VOLUME}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[],i=r.extensions[this.name];t.thickness=void 0!==i.thicknessFactor?i.thicknessFactor:0,void 0!==i.thicknessTexture&&a.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||0;var o=i.attenuationColor||[1,1,1];return t.attenuationColor=new g.Color(o[0],o[1],o[2]),Promise.all(a)}}]),e}(),ka=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_IOR}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}]),e}(),Ea=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_MATERIALS_SPECULAR}return Object(W.a)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?g.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var a=[],i=r.extensions[this.name];t.specularIntensity=void 0!==i.specularFactor?i.specularFactor:1,void 0!==i.specularTexture&&a.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));var o=i.specularColorFactor||[1,1,1];return t.specularColor=new g.Color(o[0],o[1],o[2]),void 0!==i.specularColorTexture&&a.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture).then((function(e){e.encoding=g.sRGBEncoding}))),Promise.all(a)}}]),e}(),Wa=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.KHR_TEXTURE_BASISU}return Object(W.a)(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var a=r.extensions[this.name],i=n.images[a.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i,o)}}]),e}(),Va=function(){function e(t){Object(E.a)(this,e),this.parser=t,this.name=wa.EXT_TEXTURE_WEBP,this.isSupported=null}return Object(W.a)(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;var i=a.extensions[t],o=r.images[i.source],s=n.textureLoader;if(o.uri){var c=n.options.manager.getHandler(o.uri);null!==c&&(s=c)}return this.detectSupport().then((function(a){if(a)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),Fa=function(){function e(t){Object(E.a)(this,e),this.name=wa.EXT_MESHOPT_COMPRESSION,this.parser=t}return Object(W.a)(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],a=this.parser.getDependency("buffer",r.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([a,i.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,a=r.count,o=r.byteStride,s=new ArrayBuffer(a*o),c=new Uint8Array(e[0],t,n);return i.decodeGltfBuffer(new Uint8Array(s),a,o,c,r.mode,r.filter),s}))}return null}}]),e}(),Xa="glTF",Ha=1313821514,Oa=5130562,La=Object(W.a)((function e(t){Object(E.a)(this,e),this.name=wa.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12);if(this.header={magic:g.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Xa)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-12,a=new DataView(t,12),i=0;i<r;){var o=a.getUint32(i,!0);i+=4;var s=a.getUint32(i,!0);if(i+=4,s===Ha){var c=new Uint8Array(t,12+i,o);this.content=g.LoaderUtils.decodeText(c)}else if(s===Oa){var u=12+i;this.body=t.slice(u,u+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),Na=function(){function e(t,n){if(Object(E.a)(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=wa.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return Object(W.a)(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},s={},c={};for(var u in i){var l=oi[u]||u.toLowerCase();o[l]=i[u]}for(var g in e.attributes){var d=oi[g]||g.toLowerCase();if(void 0!==i[g]){var I=n.accessors[e.attributes[g]],A=ni[I.componentType];c[d]=A,s[d]=!0===I.normalized}}return t.getDependency("bufferView",a).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],a=s[n];void 0!==a&&(r.normalized=a)}t(e)}),o,c)}))}))}}]),e}(),Ya=function(){function e(){Object(E.a)(this,e),this.name=wa.KHR_TEXTURE_TRANSFORM}return Object(W.a)(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),Ta=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;Object(E.a)(this,n),(r=t.call(this)).isGLTFSpecularGlossinessMaterial=!0;var a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),u={specular:{value:(new g.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return r._extraUniforms=u,r.onBeforeCompile=function(e){for(var t in u)e.uniforms[t]=u[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",c)},Object.defineProperties(Object(z.a)(r),{specular:{get:function(){return u.specular.value},set:function(e){u.specular.value=e}},specularMap:{get:function(){return u.specularMap.value},set:function(e){u.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return u.glossiness.value},set:function(e){u.glossiness.value=e}},glossinessMap:{get:function(){return u.glossinessMap.value},set:function(e){u.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete r.metalness,delete r.roughness,delete r.metalnessMap,delete r.roughnessMap,r.setValues(e),r}return Object(W.a)(n,[{key:"copy",value:function(e){return Object(q.a)(Object($.a)(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(g.MeshStandardMaterial),za=function(){function e(){Object(E.a)(this,e),this.name=wa.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return Object(W.a)(e,[{key:"getMaterialType",value:function(){return Ta}},{key:"extendParams",value:function(e,t,n){var r=t.extensions[this.name];e.color=new g.Color(1,1,1),e.opacity=1;var a=[];if(Array.isArray(r.diffuseFactor)){var i=r.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(void 0!==r.diffuseTexture&&a.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new g.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new g.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;a.push(n.assignTexture(e,"glossinessMap",o)),a.push(n.assignTexture(e,"specularMap",o))}return Promise.all(a)}},{key:"createMaterial",value:function(e){var t=new Ta(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=g.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),Ka=Object(W.a)((function e(){Object(E.a)(this,e),this.name=wa.KHR_MESH_QUANTIZATION})),ja=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e,r,a,i){return Object(E.a)(this,n),t.call(this,e,r,a,i)}return Object(W.a)(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r*3+r,i=0;i!==r;i++)t[i]=n[a+i];return t}}]),n}(g.Interpolant);ja.prototype.beforeStart_=ja.prototype.copySampleValue_,ja.prototype.afterEnd_=ja.prototype.copySampleValue_,ja.prototype.interpolate_=function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=2*o,c=3*o,u=r-t,l=(n-t)/u,g=l*l,d=g*l,I=e*c,A=I-c,h=-2*d+3*g,C=d-g,f=1-h,p=C-g+l,m=0;m!==o;m++){var v=i[A+m+o],b=i[A+m+s]*u,y=i[I+m+o],B=i[I+m]*u;a[m]=f*v+p*b+h*y+C*B}return a};var Da=new g.Quaternion,Ua=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(W.a)(n,[{key:"interpolate_",value:function(e,t,r,a){var i=Object(q.a)(Object($.a)(n.prototype),"interpolate_",this).call(this,e,t,r,a);return Da.fromArray(i).normalize().toArray(i),i}}]),n}(ja),Qa=0,Pa=1,Ja=2,qa=3,$a=4,ei=5,ti=6,ni={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ri={9728:g.NearestFilter,9729:g.LinearFilter,9984:g.NearestMipmapNearestFilter,9985:g.LinearMipmapNearestFilter,9986:g.NearestMipmapLinearFilter,9987:g.LinearMipmapLinearFilter},ai={33071:g.ClampToEdgeWrapping,33648:g.MirroredRepeatWrapping,10497:g.RepeatWrapping},ii={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},oi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},si={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ci={CUBICSPLINE:void 0,LINEAR:g.InterpolateLinear,STEP:g.InterpolateDiscrete},ui="OPAQUE",li="MASK",gi="BLEND";function di(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Ii(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Ai(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(var i=0,o=a.length;i<o;i++)e.morphTargetDictionary[a[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function hi(e){var t=e.extensions&&e.extensions[wa.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+Ci(t.attributes):e.indices+":"+Ci(e.attributes)+":"+e.mode}function Ci(e){for(var t="",n=Object.keys(e).sort(),r=0,a=n.length;r<a;r++)t+=n[r]+":"+e[n[r]]+";";return t}function fi(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var pi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(E.a)(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Ga,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new g.ImageBitmapLoader(this.options.manager):this.textureLoader=new g.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new g.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return Object(W.a)(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,r=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};di(a,i,r),Ii(i,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){e(i)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,a=t.length;r<a;r++)for(var i=t[r].joints,o=0,s=i.length;o<s;o++)e[i[o]].isBone=!0;for(var c=0,u=e.length;c<u;c++){var l=e[c];void 0!==l.mesh&&(this._addNodeRef(this.meshCache,l.mesh),void 0!==l.skin&&(n[l.mesh].isSkinnedMesh=!0)),void 0!==l.camera&&this._addNodeRef(this.cameraCache,l.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,n){var r=this;if(e.refs[t]<=1)return n;var a=n.clone();return function e(t,n){var a=r.associations.get(t);null!=a&&r.associations.set(n,a);var i,o=Object(qe.a)(t.children.entries());try{for(o.s();!(i=o.n()).done;){var s=Object(l.a)(i.value,2),c=s[0];e(s[1],n.children[c])}}catch(u){o.e(u)}finally{o.f()}}(n,a),a.name+="_instance_"+e.uses[t]++,a}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var a=e(t[r]);a&&n.push(a)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[wa.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,a){n.load(g.LoaderUtils.resolveURL(t.uri,r.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,i,o=e[0],s=ii[r.type],c=ni[r.componentType],u=c.BYTES_PER_ELEMENT,l=u*s,d=r.byteOffset||0,I=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,A=!0===r.normalized;if(I&&I!==l){var h=Math.floor(d/I),C="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+h+":"+r.count,f=t.cache.get(C);f||(a=new c(o,h*I,r.count*I/u),f=new g.InterleavedBuffer(a,I/u),t.cache.add(C,f)),i=new g.InterleavedBufferAttribute(f,s,d%I/u,A)}else a=null===o?new c(r.count*s):new c(o,d,r.count*s),i=new g.BufferAttribute(a,s,A);if(void 0!==r.sparse){var p=ii.SCALAR,m=ni[r.sparse.indices.componentType],v=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,y=new m(e[1],v,r.sparse.count*p),B=new c(e[2],b,r.sparse.count*s);null!==o&&(i=new g.BufferAttribute(i.array.slice(),i.itemSize,i.normalized));for(var G=0,w=y.length;G<w;G++){var _=y[G];if(i.setX(_,B[G*s]),s>=2&&i.setY(_,B[G*s+1]),s>=3&&i.setZ(_,B[G*s+2]),s>=4&&i.setW(_,B[G*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,r=t.textures[e],a=t.images[r.source],i=this.textureLoader;if(a.uri){var o=n.manager.getHandler(a.uri);null!==o&&(i=o)}return this.loadTextureImage(e,a,i)}},{key:"loadTextureImage",value:function(e,t,n){var r=this,a=this.json,i=this.options,o=a.textures[e],s=(t.uri||t.bufferView)+":"+o.sampler;if(this.textureCache[s])return this.textureCache[s];var c=self.URL||self.webkitURL,u=t.uri||"",l=!1;if(void 0!==t.bufferView)u=r.getDependency("bufferView",t.bufferView).then((function(e){l=!0;var n=new Blob([e],{type:t.mimeType});return u=c.createObjectURL(n)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var d=Promise.resolve(u).then((function(e){return new Promise((function(t,r){var a=t;!0===n.isImageBitmapLoader&&(a=function(e){var n=new g.Texture(e);n.needsUpdate=!0,t(n)}),n.load(g.LoaderUtils.resolveURL(e,i.path),a,void 0,r)}))})).then((function(t){!0===l&&c.revokeObjectURL(u),t.flipY=!1,o.name&&(t.name=o.name);var n=(a.samplers||{})[o.sampler]||{};return t.magFilter=ri[n.magFilter]||g.LinearFilter,t.minFilter=ri[n.minFilter]||g.LinearMipmapLinearFilter,t.wrapS=ai[n.wrapS]||g.RepeatWrapping,t.wrapT=ai[n.wrapT]||g.RepeatWrapping,r.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[s]=d,d}},{key:"assignTexture",value:function(e,t,n){var r=this;return this.getDependency("texture",n.index).then((function(a){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[wa.KHR_TEXTURE_TRANSFORM]){var i=void 0!==n.extensions?n.extensions[wa.KHR_TEXTURE_TRANSFORM]:void 0;if(i){var o=r.associations.get(a);a=r.extensions[wa.KHR_TEXTURE_TRANSFORM].extendTexture(a,i),r.associations.set(a,o)}}return e[t]=a,a}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,r=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,i=void 0===t.attributes.normal;if(e.isPoints){var o="PointsMaterial:"+n.uuid,s=this.cache.get(o);s||(s=new g.PointsMaterial,g.Material.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(o,s)),n=s}else if(e.isLine){var c="LineBasicMaterial:"+n.uuid,u=this.cache.get(c);u||(u=new g.LineBasicMaterial,g.Material.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(c,u)),n=u}if(r||a||i){var l="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(l+="specular-glossiness:"),r&&(l+="derivative-tangents:"),a&&(l+="vertex-colors:"),i&&(l+="flat-shading:");var d=this.cache.get(l);d||(d=n.clone(),a&&(d.vertexColors=!0),i&&(d.flatShading=!0),r&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(l,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return g.MeshStandardMaterial}},{key:"loadMaterial",value:function(e){var t,n=this,r=this.json,a=this.extensions,i=r.materials[e],o={},s=i.extensions||{},c=[];if(s[wa.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=a[wa.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),c.push(u.extendParams(o,i,n))}else if(s[wa.KHR_MATERIALS_UNLIT]){var l=a[wa.KHR_MATERIALS_UNLIT];t=l.getMaterialType(),c.push(l.extendParams(o,i,n))}else{var d=i.pbrMetallicRoughness||{};if(o.color=new g.Color(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){var I=d.baseColorFactor;o.color.fromArray(I),o.opacity=I[3]}void 0!==d.baseColorTexture&&c.push(n.assignTexture(o,"map",d.baseColorTexture)),o.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,o.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(n.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===i.doubleSided&&(o.side=g.DoubleSide);var A=i.alphaMode||ui;if(A===gi?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,A===li&&(o.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&t!==g.MeshBasicMaterial&&(c.push(n.assignTexture(o,"normalMap",i.normalTexture)),o.normalScale=new g.Vector2(1,1),void 0!==i.normalTexture.scale)){var h=i.normalTexture.scale;o.normalScale.set(h,h)}return void 0!==i.occlusionTexture&&t!==g.MeshBasicMaterial&&(c.push(n.assignTexture(o,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(o.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&t!==g.MeshBasicMaterial&&(o.emissive=(new g.Color).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&t!==g.MeshBasicMaterial&&c.push(n.assignTexture(o,"emissiveMap",i.emissiveTexture)),Promise.all(c).then((function(){var r;return r=t===Ta?a[wa.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),i.name&&(r.name=i.name),r.map&&(r.map.encoding=g.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=g.sRGBEncoding),Ii(r,i),n.associations.set(r,{materials:e}),i.extensions&&di(a,r,i),r}))}},{key:"createUniqueName",value:function(e){for(var t=g.PropertyBinding.sanitizeNodeName(e||""),n=t,r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,r=this.primitiveCache;function a(e){return n[wa.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return vi(n,e,t)}))}for(var i=[],o=0,s=e.length;o<s;o++){var c=e[o],u=hi(c),l=r[u];if(l)i.push(l.promise);else{var d=void 0;d=c.extensions&&c.extensions[wa.KHR_DRACO_MESH_COMPRESSION]?a(c):vi(new g.BufferGeometry,c,t),r[u]={primitive:c,promise:d},i.push(d)}}return Promise.all(i)}},{key:"loadMesh",value:function(e){for(var t,n=this,r=this.json,a=this.extensions,i=r.meshes[e],o=i.primitives,s=[],c=0,u=o.length;c<u;c++){var l=void 0===o[c].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new g.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:g.FrontSide})),t.DefaultMaterial):this.getDependency("material",o[c].material);s.push(l)}return s.push(n.loadGeometries(o)),Promise.all(s).then((function(t){for(var r=t.slice(0,t.length-1),s=t[t.length-1],c=[],u=0,l=s.length;u<l;u++){var d=s[u],I=o[u],A=void 0,h=r[u];if(I.mode===$a||I.mode===ei||I.mode===ti||void 0===I.mode)!0!==(A=!0===i.isSkinnedMesh?new g.SkinnedMesh(d,h):new g.Mesh(d,h)).isSkinnedMesh||A.geometry.attributes.skinWeight.normalized||A.normalizeSkinWeights(),I.mode===ei?A.geometry=bi(A.geometry,g.TriangleStripDrawMode):I.mode===ti&&(A.geometry=bi(A.geometry,g.TriangleFanDrawMode));else if(I.mode===Pa)A=new g.LineSegments(d,h);else if(I.mode===qa)A=new g.Line(d,h);else if(I.mode===Ja)A=new g.LineLoop(d,h);else{if(I.mode!==Qa)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+I.mode);A=new g.Points(d,h)}Object.keys(A.geometry.morphAttributes).length>0&&Ai(A,i),A.name=n.createUniqueName(i.name||"mesh_"+e),Ii(A,i),I.extensions&&di(a,A,I),n.assignFinalMaterial(A),c.push(A)}for(var C=0,f=c.length;C<f;C++)n.associations.set(c[C],{meshes:e,primitives:C});if(1===c.length)return c[0];var p=new g.Group;n.associations.set(p,{meshes:e});for(var m=0,v=c.length;m<v;m++)p.add(c[m]);return p}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new g.PerspectiveCamera(g.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new g.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ii(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],r=[],a=[],i=[],o=[],s=0,c=t.channels.length;s<c;s++){var u=t.channels[s],l=t.samplers[u.sampler],d=u.target,I=void 0!==d.node?d.node:d.id,A=void 0!==t.parameters?t.parameters[l.input]:l.input,h=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",I)),r.push(this.getDependency("accessor",A)),a.push(this.getDependency("accessor",h)),i.push(l),o.push(d)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(a),Promise.all(i),Promise.all(o)]).then((function(n){for(var r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],c=[],u=function(e,t){var n=r[e],u=a[e],l=i[e],d=o[e],I=s[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var A=void 0;switch(si[I.path]){case si.weights:A=g.NumberKeyframeTrack;break;case si.rotation:A=g.QuaternionKeyframeTrack;break;default:A=g.VectorKeyframeTrack}var h=n.name?n.name:n.uuid,C=void 0!==d.interpolation?ci[d.interpolation]:g.InterpolateLinear,f=[];si[I.path]===si.weights?n.traverse((function(e){e.morphTargetInfluences&&f.push(e.name?e.name:e.uuid)})):f.push(h);var p=l.array;if(l.normalized){for(var m=fi(p.constructor),v=new Float32Array(p.length),b=0,y=p.length;b<y;b++)v[b]=p[b]*m;p=v}for(var B=0,G=f.length;B<G;B++){var w=new A(f[B]+"."+si[I.path],u.array,p,C);"CUBICSPLINE"===d.interpolation&&(w.createInterpolant=function(e){return new(this instanceof g.QuaternionKeyframeTrack?Ua:ja)(this.times,this.values,this.getValueSize()/3,e)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(w)}},l=0,d=r.length;l<d;l++)u(l);var I=t.name?t.name:"animation_"+e;return new g.AnimationClip(I,void 0,c)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}},{key:"loadNode",value:function(e){var t=this.json,n=this.extensions,r=this,a=t.nodes[e],i=a.name?r.createUniqueName(a.name):"";return function(){var t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==a.camera&&t.push(r.getDependency("camera",a.camera).then((function(e){return r._getNodeRef(r.cameraCache,a.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var o;if((o=!0===a.isBone?new g.Bone:t.length>1?new g.Group:1===t.length?t[0]:new g.Object3D)!==t[0])for(var s=0,c=t.length;s<c;s++)o.add(t[s]);if(a.name&&(o.userData.name=a.name,o.name=i),Ii(o,a),a.extensions&&di(n,o,a),void 0!==a.matrix){var u=new g.Matrix4;u.fromArray(a.matrix),o.applyMatrix4(u)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o}))}},{key:"loadScene",value:function(e){var t=this.json,n=this.extensions,r=this.json.scenes[e],a=this,i=new g.Group;r.name&&(i.name=a.createUniqueName(r.name)),Ii(i,r),r.extensions&&di(n,i,r);for(var o=r.nodes||[],s=[],c=0,u=o.length;c<u;c++)s.push(mi(o[c],i,t,a));return Promise.all(s).then((function(){return a.associations=function(e){var t,n=new Map,r=Object(qe.a)(a.associations);try{for(r.s();!(t=r.n()).done;){var i=Object(l.a)(t.value,2),o=i[0],s=i[1];(o instanceof g.Material||o instanceof g.Texture)&&n.set(o,s)}}catch(c){r.e(c)}finally{r.f()}return e.traverse((function(e){var t=a.associations.get(e);null!=t&&n.set(e,t)})),n}(i),i}))}}]),e}();function mi(e,t,n,r){var a=n.nodes[e];return r.getDependency("node",e).then((function(e){return void 0===a.skin?e:r.getDependency("skin",a.skin).then((function(e){for(var n=[],a=0,i=(t=e).joints.length;a<i;a++)n.push(r.getDependency("node",t.joints[a]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],a=[],i=0,o=n.length;i<o;i++){var s=n[i];if(s){r.push(s);var c=new g.Matrix4;void 0!==t.inverseBindMatrices&&c.fromArray(t.inverseBindMatrices.array,16*i),a.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[i])}e.bind(new g.Skeleton(r,a),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var i=[];if(a.children)for(var o=a.children,s=0,c=o.length;s<c;s++){var u=o[s];i.push(mi(u,e,n,r))}return Promise.all(i)}))}function vi(e,t,n){var r=t.attributes,a=[];function i(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var o in r){var s=oi[o]||o.toLowerCase();s in e.attributes||a.push(i(r[o],s))}if(void 0!==t.indices&&!e.index){var c=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(c)}return Ii(e,t),function(e,t,n){var r=t.attributes,a=new g.Box3;if(void 0!==r.POSITION){var i=n.json.accessors[r.POSITION],o=i.min,s=i.max;if(void 0!==o&&void 0!==s){if(a.set(new g.Vector3(o[0],o[1],o[2]),new g.Vector3(s[0],s[1],s[2])),i.normalized){var c=fi(ni[i.componentType]);a.min.multiplyScalar(c),a.max.multiplyScalar(c)}var u=t.targets;if(void 0!==u){for(var l=new g.Vector3,d=new g.Vector3,I=0,A=u.length;I<A;I++){var h=u[I];if(void 0!==h.POSITION){var C=n.json.accessors[h.POSITION],f=C.min,p=C.max;if(void 0!==f&&void 0!==p){if(d.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),d.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),d.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),C.normalized){var m=fi(ni[C.componentType]);d.multiplyScalar(m)}l.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(l)}e.boundingBox=a;var v=new g.Sphere;a.getCenter(v.center),v.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=v}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,a=!1,i=0,o=t.length;i<o;i++){var s=t[i];if(void 0!==s.POSITION&&(r=!0),void 0!==s.NORMAL&&(a=!0),r&&a)break}if(!r&&!a)return Promise.resolve(e);for(var c=[],u=[],l=0,g=t.length;l<g;l++){var d=t[l];if(r){var I=void 0!==d.POSITION?n.getDependency("accessor",d.POSITION):e.attributes.position;c.push(I)}if(a){var A=void 0!==d.NORMAL?n.getDependency("accessor",d.NORMAL):e.attributes.normal;u.push(A)}}return Promise.all([Promise.all(c),Promise.all(u)]).then((function(t){var n=t[0],i=t[1];return r&&(e.morphAttributes.position=n),a&&(e.morphAttributes.normal=i),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function bi(e,t){var n=e.getIndex();if(null===n){var r=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var i=0;i<a.count;i++)r.push(i);e.setIndex(r),n=e.getIndex()}var o=n.count-2,s=[];if(t===g.TriangleFanDrawMode)for(var c=1;c<=o;c++)s.push(n.getX(0)),s.push(n.getX(c)),s.push(n.getX(c+1));else for(var u=0;u<o;u++)u%2===0?(s.push(n.getX(u)),s.push(n.getX(u+1)),s.push(n.getX(u+2))):(s.push(n.getX(u+2)),s.push(n.getX(u+1)),s.push(n.getX(u)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(s),l}var yi=null;function Bi(e,t,n){return function(r){n&&n(r),e&&(yi||(yi=new va),yi.setDecoderPath("string"===typeof e?e:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),r.setDRACOLoader(yi)),t&&r.setMeshoptDecoder(ya())}}function Gi(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=Object(o.useLoader)(Ba,e,Bi(t,n,r));return a}Gi.preload=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;return o.useLoader.preload(Ba,e,Bi(t,n,r))},Gi.clear=function(e){return o.useLoader.clear(Ba,e)};var wi=n(32),_i=n(17),Zi=n.n(_i),Si=new WeakMap,xi=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).transcoderPath="",r.transcoderBinary=null,r.transcoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.workerConfig=null,r}return Object(W.a)(n,[{key:"setTranscoderPath",value:function(e){return this.transcoderPath=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"detectSupport",value:function(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}},{key:"load",value:function(e,t,n,r){var a=this,i=new g.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);var o=new g.CompressedTexture;return i.load(e,(function(e){if(Si.has(e))return Si.get(e).promise.then(t).catch(r);a._createTexture([e]).then((function(e){o.copy(e),o.needsUpdate=!0,t&&t(o)})).catch(r)}),n,r),o}},{key:"parseInternalAsync",value:function(e){for(var t=e.levels,n=new Set,r=0;r<t.length;r++)n.add(t[r].data.buffer);return this._createTexture(Array.from(n),Object(u.a)(Object(u.a)({},e),{},{lowLevel:!0}))}},{key:"_createTexture",value:function(e){for(var t,n,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=a,o=0,s=0;s<e.length;s++)o+=e[s].byteLength;var c=this._allocateWorker(o).then((function(a){return t=a,n=r.workerNextTaskID++,new Promise((function(r,a){t._callbacks[n]={resolve:r,reject:a},t.postMessage({type:"transcode",id:n,buffers:e,taskConfig:i},e)}))})).then((function(e){var t=e.mipmaps,n=e.width,r=e.height,a=e.format,i=new g.CompressedTexture(t,n,r,a,g.UnsignedByteType);return i.minFilter=1===t.length?g.LinearFilter:g.LinearMipmapLinearFilter,i.magFilter=g.LinearFilter,i.generateMipmaps=!1,i.needsUpdate=!0,i}));return c.catch((function(){return!0})).then((function(){t&&n&&(t._taskLoad-=o,delete t._callbacks[n])})),Si.set(e[0],{promise:c}),c}},{key:"_initTranscoder",value:function(){var e=this;if(!this.transcoderPending){var t=new g.FileLoader(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);var r=new Promise((function(e,n){t.load("basis_transcoder.js",e,void 0,n)})),a=new g.FileLoader(this.manager);a.setPath(this.transcoderPath),a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);var i=new Promise((function(e,t){a.load("basis_transcoder.wasm",e,void 0,t)}));this.transcoderPending=Promise.all([r,i]).then((function(t){var r=Object(l.a)(t,2),a=r[0],i=r[1],o=n.BasisWorker.toString(),s=["/* constants */","let _EngineFormat = "+JSON.stringify(n.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(n.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(n.BasisFormat),"/* basis_transcoder.js */",a,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([s])),e.transcoderBinary=i}))}return this.transcoderPending}},{key:"_allocateWorker",value:function(e){var t=this;return this._initTranscoder().then((function(){if(t.workerPool.length<t.workerLimit){var n=new Worker(t.workerSourceURL);n._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:t.workerConfig,transcoderBinary:t.transcoderBinary}),n.onmessage=function(e){var t=e.data;switch(t.type){case"transcode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+t.type+'"')}},t.workerPool.push(n)}else t.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var r=t.workerPool[t.workerPool.length-1];return r._taskLoad+=e,r}))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;e++)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(g.Loader);xi.BasisFormat={ETC1S:0,UASTC_4x4:1},xi.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},xi.EngineFormat={RGBAFormat:g.RGBAFormat,RGBA_ASTC_4x4_Format:g.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:g.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:g.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:g.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:g.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:g.RGB_ETC1_Format,RGB_ETC2_Format:g.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:g.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:g.RGB_S3TC_DXT1_Format},xi.BasisWorker=function(){var e,t,n,r=_EngineFormat,a=_TranscoderFormat,i=_BasisFormat;onmessage=function(r){var a,o=r.data;switch(o.type){case"init":e=o.config,a=o.transcoderBinary,t=new Promise((function(e){n={wasmBinary:a,onRuntimeInitialized:e},BASIS(n)})).then((function(){n.initializeBasis()}));break;case"transcode":t.then((function(){try{for(var e=o.taskConfig.lowLevel?function(e){var t=e.basisFormat,r=e.width,a=e.height,o=e.hasAlpha,s=u(t,r,a,o),c=s.transcoderFormat,A=s.engineFormat,h=n.getBytesPerBlockOrPixel(c);l(n.isFormatSupported(c),"THREE.BasisTextureLoader: Unsupported format.");var C=[];if(t===i.ETC1S){var f=new n.LowLevelETC1SImageTranscoder,p=e.globalData,m=p.endpointCount,v=p.endpointsData,b=p.selectorCount,y=p.selectorsData,B=p.tablesData;try{l(f.decodePalettes(m,v,b,y),"THREE.BasisTextureLoader: decodePalettes() failed."),l(f.decodeTables(B),"THREE.BasisTextureLoader: decodeTables() failed.");for(var G=0;G<e.levels.length;G++){var w=e.levels[G],_=e.globalData.imageDescs[G],Z=I(c,w.width,w.height),S=new Uint8Array(Z);l(f.transcodeImage(c,S,Z/h,w.data,g(c,w.width),d(c,w.height),w.width,w.height,w.index,_.rgbSliceByteOffset,_.rgbSliceByteLength,_.alphaSliceByteOffset,_.alphaSliceByteLength,_.imageFlags,o,!1,0,0),"THREE.BasisTextureLoader: transcodeImage() failed for level "+w.index+"."),C.push({data:S,width:w.width,height:w.height})}}finally{f.delete()}}else for(var x=0;x<e.levels.length;x++){var R=e.levels[x],M=I(c,R.width,R.height),k=new Uint8Array(M);l(n.transcodeUASTCImage(c,k,M/h,R.data,g(c,R.width),d(c,R.height),R.width,R.height,R.index,0,R.data.byteLength,0,o,!1,0,0,-1,-1),"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+R.index+"."),C.push({data:k,width:R.width,height:R.height})}return{width:r,height:a,hasAlpha:o,mipmaps:C,format:A}}(o.taskConfig):function(e){var t=new n.BasisFile(new Uint8Array(e)),r=t.isUASTC()?i.UASTC_4x4:i.ETC1S,a=t.getImageWidth(0,0),o=t.getImageHeight(0,0),s=t.getNumLevels(0),c=t.getHasAlpha();function l(){t.close(),t.delete()}var g=u(r,a,o,c),d=g.transcoderFormat,I=g.engineFormat;if(!a||!o||!s)throw l(),new Error("THREE.BasisTextureLoader:\tInvalid texture");if(!t.startTranscoding())throw l(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");for(var A=[],h=0;h<s;h++){var C=t.getImageWidth(0,h),f=t.getImageHeight(0,h),p=new Uint8Array(t.getImageTranscodedSizeInBytes(0,h,d));if(!t.transcodeImage(p,0,h,d,0,c))throw l(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");A.push({data:p,width:C,height:f})}return l(),{width:a,height:o,hasAlpha:c,mipmaps:A,format:I}}(o.buffers[0]),t=e.width,r=e.height,a=e.hasAlpha,s=e.mipmaps,c=e.format,A=[],h=0;h<s.length;++h)A.push(s[h].data.buffer);self.postMessage({type:"transcode",id:o.id,width:t,height:r,hasAlpha:a,mipmaps:s,format:c},A)}catch(C){console.error(C),self.postMessage({type:"error",id:o.id,error:C.message})}}))}};var o=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC1],engineFormat:[r.RGB_ETC1_Format,r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),c=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function u(t,n,o,u){for(var l=t===i.ETC1S?s:c,g=0;g<l.length;g++){var d=l[g];if(e[d.if]&&(d.basisFormat.includes(t)&&(!d.needsPowerOfTwo||A(n)&&A(o))))return{transcoderFormat:d.transcoderFormat[u?1:0],engineFormat:d.engineFormat[u?1:0]}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:a.RGBA32,engineFormat:r.RGBAFormat}}function l(e,t){if(!e)throw new Error(t)}function g(e,t){return Math.ceil(t/n.getFormatBlockWidth(e))}function d(e,t){return Math.ceil(t/n.getFormatBlockHeight(e))}function I(e,t,r){var i=n.getBytesPerBlockOrPixel(e);if(n.formatIsUncompressed(e))return t*r*i;if(e===a.PVRTC1_4_RGB||e===a.PVRTC1_4_RGBA){var o=t+3&-4,s=r+3&-4;return(Math.max(8,o)*Math.max(8,s)*4+7)/8}return g(e,t)*d(e,r)*i}function A(e){return e<=2||0===(e&e-1)&&0!==e}};var Ri=n(105),Mi=n(37),ki=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).basisLoader=new xi(e),r.zstd=new Ri.a,r.zstd.init(),"undefined"!==typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.'),r}return Object(W.a)(n,[{key:"setTranscoderPath",value:function(e){return this.basisLoader.setTranscoderPath(e),this}},{key:"setWorkerLimit",value:function(e){return this.basisLoader.setWorkerLimit(e),this}},{key:"detectSupport",value:function(e){return this.basisLoader.detectSupport(e),this}},{key:"dispose",value:function(){return this.basisLoader.dispose(),this}},{key:"load",value:function(e,t,n,r){var a=this,i=new g.CompressedTexture;return new Promise((function(t,r){new g.FileLoader(a.manager).setPath(a.path).setResponseType("arraybuffer").load(e,t,n,r)})).then((function(e){a.parse(e,(function(e){i.copy(e),i.needsUpdate=!0,t&&t(i)}),r)})).catch(r),i}},{key:"parse",value:function(e,t,n){var r=this,a=Object(Mi.g)(new Uint8Array(e));if(a.pixelDepth>0)throw new Error("THREE.KTX2Loader: Only 2D textures are currently supported.");if(a.layerCount>1)throw new Error("THREE.KTX2Loader: Array textures are not currently supported.");if(a.faceCount>1)throw new Error("THREE.KTX2Loader: Cube textures are not currently supported.");var i=Ei.getBasicDFD(a);return Ei.createLevels(a,this.zstd).then((function(e){var t=i.colorModel===Mi.d.UASTC?xi.BasisFormat.UASTC_4x4:xi.BasisFormat.ETC1S,n={levels:e,width:a.pixelWidth,height:a.pixelHeight,basisFormat:t,hasAlpha:Ei.getAlpha(a)};return t===xi.BasisFormat.ETC1S&&(n.globalData=a.globalData),r.basisLoader.parseInternalAsync(n)})).then((function(e){e.encoding=i.transferFunction===Mi.f.SRGB?g.sRGBEncoding:g.LinearEncoding,e.premultiplyAlpha=Ei.getPremultiplyAlpha(a),t(e)})).catch(n),this}}]),n}(g.CompressedTextureLoader),Ei={createLevels:function(){var e=Object(wi.a)(Zi.a.mark((function e(t,n){var r,a,i,o,s,c,u;return Zi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.supercompressionScheme!==Mi.e.ZSTD){e.next=3;break}return e.next=3,n.init();case 3:for(r=[],a=t.pixelWidth,i=t.pixelHeight,o=0;o<t.levels.length;o++)s=Math.max(1,Math.floor(a/Math.pow(2,o))),c=Math.max(1,Math.floor(i/Math.pow(2,o))),u=t.levels[o].levelData,t.supercompressionScheme===Mi.e.ZSTD&&(u=n.decode(u,t.levels[o].uncompressedByteLength)),r.push({index:o,width:s,height:c,data:u});return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),getBasicDFD:function(e){return e.dataFormatDescriptor[0]},getAlpha:function(e){var t=this.getBasicDFD(e);return t.colorModel===Mi.d.UASTC?(15&t.samples[0].channelID)===Mi.b.RGBA:2===t.samples.length&&(15&t.samples[1].channelID)===Mi.a.AAA},getPremultiplyAlpha:function(e){return!!(this.getBasicDFD(e).flags&Mi.c.ALPHA_PREMULTIPLIED)}},Wi="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function Vi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Wi,"/basis/"),n=Object(o.useThree)((function(e){return e.gl})),r=Object(o.useLoader)(ki,vt(e)?Object.values(e):e,(function(e){e.detectSupport(n),e.setTranscoderPath(t)}));if(Object(i.useEffect)((function(){(Array.isArray(r)?r:[r]).forEach(n.initTexture)}),[n,r]),vt(e)){var a=Object.keys(e),s={};return a.forEach((function(e){return Object.assign(s,Object(D.a)({},e,r[a.indexOf(e)]))})),s}return r}Vi.preload=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Wi,"/basis/");return o.useLoader.preload(ki,e,(function(e){e.setTranscoderPath(t)}))},Vi.clear=function(e){return o.useLoader.clear(ki,e)};var Fi=n(106),Xi=n.n(Fi);function Hi(e,t){"function"===typeof e?e(t):null!=e&&(e.current=t)}function Oi(e){var t=e.showPanel,n=void 0===t?0:t,r=e.className,s=e.parent,c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=i.useState(),a=Object(l.a)(r,2),o=a[0],s=a[1];return i.useLayoutEffect((function(){var t=e();return s(t),Hi(n,t),function(){return Hi(n,null)}}),t),o}((function(){return new Xi.a}),[]);return i.useEffect((function(){if(c){var e,t=s&&s.current||document.body;c.showPanel(n),null==t||t.appendChild(c.dom),r&&(e=c.dom.classList).add.apply(e,Object(a.a)(r.split(" ").filter((function(e){return e}))));var i=Object(o.addEffect)((function(){return c.begin()})),u=Object(o.addAfterEffect)((function(){return c.end()}));return function(){null==t||t.removeChild(c.dom),i(),u()}}}),[s,c,r,n]),null}var Li=["samples"];function Ni(e,t,n){var r=Object(o.useThree)(),a=r.gl,s=r.size,c=i.useMemo((function(){return a.getPixelRatio()}),[a]),l="number"===typeof e?e:s.width*c,d="number"===typeof t?t:s.height*c,I=("number"===typeof e?n:e)||{},A=I.samples,h=Object(p.a)(I,Li),C=i.useMemo((function(){var e;return(e=new g.WebGLRenderTarget(l,d,Object(u.a)({minFilter:g.LinearFilter,magFilter:g.LinearFilter,encoding:a.outputEncoding,type:g.HalfFloatType},h))).samples=A,e}),[]);return i.useLayoutEffect((function(){C.setSize(l,d),A&&(C.samples=A)}),[A,C,l,d]),i.useEffect((function(){return function(){return C.dispose()}}),[]),C}function Yi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size,n=void 0===t?256:t,r=e.frames,a=void 0===r?1/0:r,s=Object(o.useThree)((function(e){return e.viewport.dpr})),c=Object(o.useThree)((function(e){return e.size})),u=c.width,l=c.height,d=n||u*s,I=n||l*s,A=i.useMemo((function(){var e=new g.DepthTexture(d,I);return e.format=g.DepthFormat,e.type=g.UnsignedShortType,{depthTexture:e}}),[d,I]),h=0,C=Ni(d,I,A);return Object(o.useFrame)((function(e){(a===1/0||h<a)&&(e.gl.setRenderTarget(C),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),h++)})),C.depthTexture}function Ti(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=Object(o.useThree)((function(e){return e.viewport})),a=t*(r.aspect>e/t?r.width/e:r.height/t),i=e*(r.aspect>e/t?r.width/e:r.height/t);return[i*n,a*n,1]}var zi=n(55);function Ki(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))}var ji=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Di(e){return e.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"")}var Ui="undefined"==typeof window,Qi=function(){if(!Ui){var e=window.navigator,t=e.userAgent,n=e.platform,r=e.maxTouchPoints,a=/(iphone|ipod|ipad)/i.test(t),i="iPad"===n||"MacIntel"===n&&r>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||a||i,isSafari12:/Version\/12.+Safari/.test(t)}}}();function Pi(e,t,n){if(!n)return[t];var r,a=function(e){var t=e.createShader(35633),n=e.createShader(35632),r=e.createProgram();if(n&&t&&r){e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(n,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(n),e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.detachShader(r,t),e.detachShader(r,n),e.deleteShader(t),e.deleteShader(n),e.useProgram(r);var a=e.createBuffer();e.bindBuffer(34962,a),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);var i=e.getAttribLocation(r,"aPosition");e.vertexAttribPointer(i,3,5126,!1,0,0),e.enableVertexAttribArray(i),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);var o=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,o),e.deleteProgram(r),e.deleteBuffer(a),o.join("")}}(e),i="801621810",o="8016218135",s="80162181161",c=(null==Qi?void 0:Qi.isIpad)?[["a7",s,12],["a8",o,15],["a8x",o,15],["a9",o,15],["a9x",o,15],["a10",o,15],["a10x",o,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["m1",i,15]]:[["a7",s,12],["a8",o,12],["a9",o,15],["a10",o,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15]];return"80162181255"===a?r=c.filter((function(e){return Object(l.a)(e,3)[2]>=14})):(r=c.filter((function(e){return Object(l.a)(e,2)[1]===a}))).length||(r=c),r.map((function(e){var t=Object(l.a)(e,1)[0];return"apple ".concat(t," gpu")}))}var Ji=[],qi=[];function $i(e,t){if(e===t)return 0;var n=e;e.length>t.length&&(e=t,t=n);for(var r=e.length,a=t.length;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-a);)r--,a--;for(var i,o=0;o<r&&e.charCodeAt(o)===t.charCodeAt(o);)o++;if(a-=o,0===(r-=o))return a;for(var s,c,u=0,l=0,g=0;l<r;)qi[l]=e.charCodeAt(o+l),Ji[l]=++l;for(;g<a;)for(i=t.charCodeAt(o+g),s=g++,u=g,l=0;l<r;l++)c=i===qi[l]?s:s+1,s=Ji[l],u=Ji[l]=s>u?c>u?u+1:c:c>s?s+1:c;return u}function eo(e){return null!=e}var to=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(z.a)(r),(this instanceof n?this.constructor:void 0).prototype),r}return Object(W.a)(n)}(Object(zi.a)(Error)),no=function(e){return nt((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mobileTiers,n=void 0===t?[0,15,30,60]:t,r=e.desktopTiers,a=void 0===r?[0,15,30,60]:r,i=e.override,o=void 0===i?{}:i,s=e.glContext,c=e.failIfMajorPerformanceCaveat,u=void 0!==c&&c,g=e.benchmarksURL,d=void 0===g?"https://unpkg.com/detect-gpu@4.0.15/dist/benchmarks":g;return Ki(void 0,void 0,void 0,Zi.a.mark((function e(){var t,r,i,c,g,I,A,h,C,f,p,m,v,b,y,B,G,w,_,Z,S,x,R,M;return Zi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},!Ui){e.next=3;break}return e.abrupt("return",{tier:0,type:"SSR"});case 3:if(r=o.isIpad,i=void 0===r?!!(null==Qi?void 0:Qi.isIpad):r,c=o.isMobile,g=void 0===c?!!(null==Qi?void 0:Qi.isMobile):c,I=o.screenSize,A=void 0===I?window.screen:I,h=o.loadBenchmarks,C=void 0===h?function(e){return G(void 0,void 0,void 0,Zi.a.mark((function t(){var n;return Zi.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(d,"/").concat(e)).then((function(e){return e.json()}));case 2:if(n=t.sent,!(parseInt(n.shift().split(".")[0],10)<4)){t.next=5;break}throw new to("Detect GPU benchmark data is out of date. Please update to version 4x");case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))}:h,f=o.renderer,p=function(e,t,n,r,a){return{device:a,fps:r,gpu:n,isMobile:g,tier:e,type:t}},v="",!f){e.next=11;break}f=Di(f),m=[f],e.next=18;break;case 11:if(b=s||function(e){var t={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:arguments.length>1&&void 0!==arguments[1]&&arguments[1],powerPreference:"high-performance",stencil:!1};e&&delete t.powerPreference;var n=window.document.createElement("canvas"),r=n.getContext("webgl",t)||n.getContext("experimental-webgl",t);return null!=r?r:void 0}(null==Qi?void 0:Qi.isSafari12,u),b){e.next=14;break}return e.abrupt("return",p(0,"WEBGL_UNSUPPORTED"));case 14:if((y=b.getExtension("WEBGL_debug_renderer_info"))&&(f=b.getParameter(y.UNMASKED_RENDERER_WEBGL)),f){e.next=17;break}return e.abrupt("return",p(1,"FALLBACK"));case 17:v=f,f=Di(f),m=function(e,t,n){return"apple gpu"===t?Pi(e,t,n):[t]}(b,f,g);case 18:return e.next=20,Promise.all(m.map((function(e){return G(void 0,void 0,void 0,Zi.a.mark((function n(){var r,a,o,s,c,u,d,I,h,f,p,m,v,b,y,B,G,w,_,Z,S,x,R,M,k,E,W,V,F;return Zi.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=function(e){for(var t=0,n=g?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","apple","amd","radeon","nvidia","geforce"];t<n.length;t++){var r=n[t];if(e.includes(r))return r}}(e),a){n.next=3;break}return n.abrupt("return");case 3:return o="".concat(g?"m":"d","-").concat(a).concat(i?"-ipad":"",".json"),s=t[o]=null!==(r=t[o])&&void 0!==r?r:C(o),n.prev=4,n.next=7,s;case 7:c=n.sent,n.next=15;break;case 10:if(n.prev=10,n.t0=n.catch(4),!(n.t0 instanceof to)){n.next=14;break}throw n.t0;case 14:return n.abrupt("return");case 15:if(u=function(e){var t,n=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==n?void 0:n.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""}(e),(d=c.filter((function(e){return Object(l.a)(e,2)[1]===u}))).length||(d=c.filter((function(t){return Object(l.a)(t,1)[0].includes(e)}))),0!==(I=d.length)){n.next=21;break}return n.abrupt("return");case 21:f=I>1?d.map((function(t){return[t,$i(e,t[0])]})).sort((function(e,t){return Object(l.a)(e,2)[1]-Object(l.a)(t,2)[1]}))[0][0]:d[0],p=Object(l.a)(f,4),m=p[0],v=p[3],b=Number.MAX_VALUE,y=window,B=y.devicePixelRatio,G=A.width*B*A.height*B,w=Object(qe.a)(v);try{for(w.s();!(_=w.n()).done;)Z=_.value,S=Object(l.a)(Z,2),x=S[0],R=S[1],M=x*R,(k=Math.abs(G-M))<b&&(b=k,h=Z)}catch(X){w.e(X)}finally{w.f()}if(h){n.next=27;break}return n.abrupt("return");case 27:return E=h,W=Object(l.a)(E,4),V=W[2],F=W[3],n.abrupt("return",[b,V,m,F]);case 29:case"end":return n.stop()}}),n,null,[[4,10]])})))})));case 20:if(B=e.sent.filter(eo).sort((function(e,t){var n=Object(l.a)(e,2),r=n[0],a=void 0===r?Number.MAX_VALUE:r,i=n[1],o=Object(l.a)(t,2),s=o[0],c=void 0===s?Number.MAX_VALUE:s,u=o[1];return a===c?i-u:a-c})),B.length){e.next=24;break}return G=ji.find((function(e){return f.includes(e)})),e.abrupt("return",G?p(0,"BLOCKLISTED",G):p(1,"FALLBACK","".concat(f," (").concat(v,")")));case 24:if(w=Object(l.a)(B[0],4),_=w[1],Z=w[2],S=w[3],-1!==_){e.next=27;break}return e.abrupt("return",p(0,"BLOCKLISTED",Z,_,S));case 27:for(x=g?n:a,R=0,M=0;M<x.length;M++)_>=x[M]&&(R=M);return e.abrupt("return",p(R,"BENCHMARK",Z,_,S));case 31:case"end":return e.stop()}}),e)})))}(e)}),["useDetectGPU"])};function ro(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var s=i.useRef(),c=Object(o.useThree)((function(e){return e.scene}));return i.useEffect((function(){return e&&t&&null!=e&&e.current&&(s.current=Object(se.a)(t,[e.current].concat(r)),s.current&&c.add(s.current)),!e&&s.current&&c.remove(s.current),function(){s.current&&c.remove(s.current)}}),[c,t,e,r]),Object(o.useFrame)((function(){var e;null!=(e=s.current)&&e.update&&s.current.update()})),s}var ao=new g.Vector3,io=new g.Vector3,oo=new g.Vector3,so=new g.Vector2,co=new g.Vector2,uo=new g.Vector2,lo=new g.Vector3;function go(e,t,n,r,a,i,o){ao.fromBufferAttribute(t,r),io.fromBufferAttribute(t,a),oo.fromBufferAttribute(t,i);var s=function(e,t,n,r,a,i){return null===(i===g.BackSide?e.intersectTriangle(r,n,t,!0,a):e.intersectTriangle(t,n,r,i!==g.DoubleSide,a))?null:{distance:e.origin.distanceTo(a),point:a.clone()}}(e,ao,io,oo,lo,o);if(s){n&&(so.fromBufferAttribute(n,r),co.fromBufferAttribute(n,a),uo.fromBufferAttribute(n,i),s.uv=g.Triangle.getUV(lo,ao,io,oo,so,co,uo,new g.Vector2));var c={a:r,b:a,c:i,normal:new g.Vector3,materialIndex:0};g.Triangle.getNormal(ao,io,oo,c.normal),s.face=c,s.faceIndex=r}return s}function Io(e,t,n,r,a){var i=3*r,o=e.index.getX(i),s=e.index.getX(i+1),c=e.index.getX(i+2),u=go(n,e.attributes.position,e.attributes.uv,o,s,c,t);return u?(u.faceIndex=r,a&&a.push(u),u):null}function Ao(e,t,n){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far?null:e)}var ho=1.25,Co=32,fo=65535,po=Math.pow(2,-24),mo=Object(W.a)((function e(){Object(E.a)(this,e)}));function vo(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function bo(e){for(var t=-1,n=-1/0,r=0;r<3;r++){var a=e[r+3]-e[r];a>n&&(n=a,t=r)}return t}function yo(e,t){t.set(e)}function Bo(e,t,n){for(var r,a,i=0;i<3;i++){var o=i+3;r=e[i],a=t[i],n[i]=r<a?r:a,r=e[o],a=t[o],n[o]=r>a?r:a}}function Go(e,t,n){for(var r=0;r<3;r++){var a=t[e+2*r],i=t[e+2*r+1],o=a-i,s=a+i;o<n[r]&&(n[r]=o),s>n[r+3]&&(n[r+3]=s)}}function wo(e){var t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}function _o(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=1/0,o=1/0,s=1/0,c=-1/0,u=-1/0,l=-1/0,g=1/0,d=1/0,I=1/0,A=-1/0,h=-1/0,C=-1/0,f=null!==a,p=6*t,m=6*(t+n);p<m;p+=6){var v=e[p+0],b=e[p+1],y=v-b,B=v+b;y<i&&(i=y),B>c&&(c=B),f&&v<g&&(g=v),f&&v>A&&(A=v);var G=e[p+2],w=e[p+3],_=G-w,Z=G+w;_<o&&(o=_),Z>u&&(u=Z),f&&G<d&&(d=G),f&&G>h&&(h=G);var S=e[p+4],x=e[p+5],R=S-x,M=S+x;R<s&&(s=R),M>l&&(l=M),f&&S<I&&(I=S),f&&S>C&&(C=S)}r[0]=i,r[1]=o,r[2]=s,r[3]=c,r[4]=u,r[5]=l,f&&(a[0]=g,a[1]=d,a[2]=I,a[3]=A,a[4]=h,a[5]=C)}function Zo(e,t,n,r,a){for(var i=n,o=n+r-1,s=a.pos,c=2*a.axis;;){for(;i<=o&&t[6*i+c]<s;)i++;for(;i<=o&&t[6*o+c]>=s;)o--;if(!(i<o))return i;for(var u=0;u<3;u++){var l=e[3*i+u];e[3*i+u]=e[3*o+u],e[3*o+u]=l;var g=t[6*i+2*u+0];t[6*i+2*u+0]=t[6*o+2*u+0],t[6*o+2*u+0]=g;var d=t[6*i+2*u+1];t[6*i+2*u+1]=t[6*o+2*u+1],t[6*o+2*u+1]=d}i++,o--}}var So=32,xo=function(e,t){return e.candidate-t.candidate},Ro=new Array(So).fill().map((function(){return{count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}})),Mo=new Float32Array(6);function ko(e,t,n,r,i,o){var s=-1,c=0;if(0===o)-1!==(s=bo(t))&&(c=(t[s]+t[s+3])/2);else if(1===o)-1!==(s=bo(e))&&(c=function(e,t,n,r){for(var a=0,i=t,o=t+n;i<o;i++)a+=e[6*i+2*r];return a/n}(n,r,i,s));else if(2===o)for(var u=wo(e),l=ho*i,g=6*r,d=6*(r+i),I=0;I<3;I++){var A=t[I],h=(t[I+3]-A)/So;if(i<8){var C=Object(a.a)(Ro);C.length=i;for(var f=0,p=g;p<d;p+=6,f++){var m=C[f];m.candidate=n[p+2*I],m.count=0;for(var v=m.bounds,b=m.leftCacheBounds,y=m.rightCacheBounds,B=0;B<3;B++)y[B]=1/0,y[B+3]=-1/0,b[B]=1/0,b[B+3]=-1/0,v[B]=1/0,v[B+3]=-1/0;Go(p,n,v)}C.sort(xo);for(var G=i,w=0;w<G;w++)for(var _=C[w];w+1<G&&C[w+1].candidate===_.candidate;)C.splice(w+1,1),G--;for(var Z=g;Z<d;Z+=6)for(var S=n[Z+2*I],x=0;x<G;x++){var R=C[x];S>=R.candidate?Go(Z,n,R.rightCacheBounds):(Go(Z,n,R.leftCacheBounds),R.count++)}for(var M=0;M<G;M++){var k=C[M],E=k.count,W=i-k.count,V=k.leftCacheBounds,F=k.rightCacheBounds,X=0;0!==E&&(X=wo(V)/u);var H=0;0!==W&&(H=wo(F)/u);var O=1+ho*(X*E+H*W);O<l&&(s=I,l=O,c=k.candidate)}}else{for(var L=0;L<So;L++){var N=Ro[L];N.count=0,N.candidate=A+h+L*h;for(var Y=N.bounds,T=0;T<3;T++)Y[T]=1/0,Y[T+3]=-1/0}for(var z=g;z<d;z+=6){var K=~~((n[z+2*I]-A)/h);K>=So&&(K=31);var j=Ro[K];j.count++,Go(z,n,j.bounds)}var D=Ro[31];yo(D.bounds,D.rightCacheBounds);for(var U=30;U>=0;U--){var Q=Ro[U],P=Ro[U+1];Bo(Q.bounds,P.rightCacheBounds,Q.rightCacheBounds)}for(var J=0,q=0;q<31;q++){var $=Ro[q],ee=$.count,te=$.bounds,ne=Ro[q+1].rightCacheBounds;0!==ee&&(0===J?yo(te,Mo):Bo(te,Mo,Mo));var re=0,ae=0;0!==(J+=ee)&&(re=wo(Mo)/u);var ie=i-J;0!==ie&&(ae=wo(ne)/u);var oe=1+ho*(re*J+ae*ie);oe<l&&(s=I,l=oe,c=$.candidate)}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(o," used."));return{axis:s,pos:c}}function Eo(e,t){function n(e){I&&I(e/A)}function r(t,a,g){var I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!h&&A>=c&&(h=!0,u&&(console.warn("MeshBVH: Max depth of ".concat(c," reached when generating BVH. Consider increasing maxDepth.")),console.warn(e))),g<=l||A>=c)return n(a+g),t.offset=a,t.count=g,t;var C=ko(t.boundingData,I,o,a,g,d);if(-1===C.axis)return n(a+g),t.offset=a,t.count=g,t;var f=Zo(s,o,a,g,C);if(f===a||f===a+g)n(a+g),t.offset=a,t.count=g;else{t.splitAxis=C.axis;var p=new mo,m=a,v=f-a;t.left=p,p.boundingData=new Float32Array(6),_o(o,m,v,p.boundingData,i),r(p,m,v,i,A+1);var b=new mo,y=f,B=g-v;t.right=b,b.boundingData=new Float32Array(6),_o(o,y,B,b.boundingData,i),r(b,y,B,i,A+1)}return t}!function(e,t){if(!e.index){var n,r=e.attributes.position.count,a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;n=r>65535?new Uint32Array(new a(4*r)):new Uint16Array(new a(2*r)),e.setIndex(new g.BufferAttribute(n,1));for(var i=0;i<r;i++)n[i]=i}}(e,t);var a=new Float32Array(6),i=new Float32Array(6),o=function(e,t){var n=e.attributes.position,r=n.array,a=e.index.array,i=a.length/3,o=new Float32Array(6*i),s=n.offset||0,c=3;n.isInterleavedBufferAttribute&&(c=n.data.stride);for(var u=0;u<i;u++)for(var l=3*u,g=6*u,d=a[l+0]*c+s,I=a[l+1]*c+s,A=a[l+2]*c+s,h=0;h<3;h++){var C=r[d+h],f=r[I+h],p=r[A+h],m=C;f<m&&(m=f),p<m&&(m=p);var v=C;f>v&&(v=f),p>v&&(v=p);var b=(v-m)/2,y=2*h;o[g+y+0]=m+b,o[g+y+1]=b+(Math.abs(m)+b)*po,m<t[h]&&(t[h]=m),v>t[h+3]&&(t[h+3]=v)}return o}(e,a),s=e.index.array,c=t.maxDepth,u=t.verbose,l=t.maxLeafTris,d=t.strategy,I=t.onProgress,A=e.index.count/3,h=!1,C=[],f=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];var t,n=[],r=new Set,a=Object(qe.a)(e.groups);try{for(a.s();!(t=a.n()).done;){var i=t.value;r.add(i.start),r.add(i.start+i.count)}}catch(l){a.e(l)}finally{a.f()}for(var o=Array.from(r.values()).sort((function(e,t){return e-t})),s=0;s<o.length-1;s++){var c=o[s],u=o[s+1];n.push({offset:c/3,count:(u-c)/3})}return n}(e);if(1===f.length){var p=f[0],m=new mo;m.boundingData=a,function(e,t,n,r){for(var a=1/0,i=1/0,o=1/0,s=-1/0,c=-1/0,u=-1/0,l=6*t,g=6*(t+n);l<g;l+=6){var d=e[l+0];d<a&&(a=d),d>s&&(s=d);var I=e[l+2];I<i&&(i=I),I>c&&(c=I);var A=e[l+4];A<o&&(o=A),A>u&&(u=A)}r[0]=a,r[1]=i,r[2]=o,r[3]=s,r[4]=c,r[5]=u}(o,p.offset,p.count,i),r(m,p.offset,p.count,i),C.push(m)}else{var v,b=Object(qe.a)(f);try{for(b.s();!(v=b.n()).done;){var y=v.value,B=new mo;B.boundingData=new Float32Array(6),_o(o,y.offset,y.count,B.boundingData,i),r(B,y.offset,y.count,i),C.push(B)}}catch(G){b.e(G)}finally{b.f()}}return C}function Wo(e,t){for(var n,r,a,i=Eo(e,t),o=[],s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,c=0;c<i.length;c++){var u=i[c],l=d(u),g=new s(Co*l);n=new Float32Array(g),r=new Uint32Array(g),a=new Uint16Array(g),I(0,u),o.push(g)}return o;function d(e){return e.count?1:1+d(e.left)+d(e.right)}function I(e,t){for(var i=e/4,o=e/2,s=!!t.count,c=t.boundingData,u=0;u<6;u++)n[i+u]=c[u];if(s){var l=t.offset,g=t.count;return r[i+6]=l,a[o+14]=g,a[o+15]=fo,e+Co}var d,A=t.left,h=t.right,C=t.splitAxis;if((d=I(e+Co,A))/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[i+6]=d/4,d=I(d,h),r[i+7]=C,d}}var Vo=function(){function e(){Object(E.a)(this,e),this.min=1/0,this.max=-1/0}return Object(W.a)(e,[{key:"setFromPointsField",value:function(e,t){for(var n=1/0,r=-1/0,a=0,i=e.length;a<i;a++){var o=e[a][t];n=o<n?o:n,r=o>r?o:r}this.min=n,this.max=r}},{key:"setFromPoints",value:function(e,t){for(var n=1/0,r=-1/0,a=0,i=t.length;a<i;a++){var o=t[a],s=e.dot(o);n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}},{key:"isSeparated",value:function(e){return this.min>e.max||e.min>this.max}}]),e}();Vo.prototype.setFromBox=function(){var e=new g.Vector3;return function(t,n){for(var r=n.min,a=n.max,i=1/0,o=-1/0,s=0;s<=1;s++)for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){e.x=r.x*s+a.x*(1-s),e.y=r.y*c+a.y*(1-c),e.z=r.z*u+a.z*(1-u);var l=t.dot(e);i=Math.min(l,i),o=Math.max(l,o)}this.min=i,this.max=o}}();!function(){var e=new Vo}();var Fo=function(){var e=new g.Vector3,t=new g.Vector3,n=new g.Vector3;return function(r,a,i){var o=r.start,s=e,c=a.start,u=t;n.subVectors(o,c),e.subVectors(r.end,a.start),t.subVectors(a.end,a.start);var l,g,d=n.dot(u),I=u.dot(s),A=u.dot(u),h=n.dot(s),C=s.dot(s)*A-I*I;g=(d+(l=0!==C?(d*I-h*A)/C:0)*I)/A,i.x=l,i.y=g}}(),Xo=function(){var e=new g.Vector2,t=new g.Vector3,n=new g.Vector3;return function(r,a,i,o){Fo(r,a,e);var s,c,u=e.x,l=e.y;if(u>=0&&u<=1&&l>=0&&l<=1)return r.at(u,i),void a.at(l,o);if(u>=0&&u<=1)return l<0?a.at(0,o):a.at(1,o),void r.closestPointToPoint(o,!0,i);if(l>=0&&l<=1)return u<0?r.at(0,i):r.at(1,i),void a.closestPointToPoint(i,!0,o);s=u<0?r.start:r.end,c=l<0?a.start:a.end;var g=t,d=n;return r.closestPointToPoint(c,!0,t),a.closestPointToPoint(s,!0,n),g.distanceToSquared(c)<=d.distanceToSquared(s)?(i.copy(g),void o.copy(c)):(i.copy(s),void o.copy(d))}}(),Ho=function(){var e=new g.Vector3,t=new g.Vector3,n=new g.Plane,r=new g.Line3;return function(a,i){var o=a.radius,s=a.center,c=i.a,u=i.b,l=i.c;if(r.start=c,r.end=u,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o)return!0;if(r.start=c,r.end=l,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o)return!0;if(r.start=u,r.end=l,r.closestPointToPoint(s,!0,e).distanceTo(s)<=o)return!0;var g=i.getPlane(n);if(Math.abs(g.distanceToPoint(s))<=o){var d=g.projectPoint(s,t);if(i.containsPoint(d))return!0}return!1}}(),Oo=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).isExtendedTriangle=!0,e.satAxes=new Array(4).fill().map((function(){return new g.Vector3})),e.satBounds=new Array(4).fill().map((function(){return new Vo})),e.points=[e.a,e.b,e.c],e.sphere=new g.Sphere,e.plane=new g.Plane,e.needsUpdate=!1,e}return Object(W.a)(n,[{key:"intersectsSphere",value:function(e){return Ho(e,this)}},{key:"update",value:function(){var e=this.a,t=this.b,n=this.c,r=this.points,a=this.satAxes,i=this.satBounds,o=a[0],s=i[0];this.getNormal(o),s.setFromPoints(o,r);var c=a[1],u=i[1];c.subVectors(e,t),u.setFromPoints(c,r);var l=a[2],g=i[2];l.subVectors(t,n),g.setFromPoints(l,r);var d=a[3],I=i[3];d.subVectors(n,e),I.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}]),n}(g.Triangle);Oo.prototype.closestPointToSegment=function(){var e=new g.Vector3,t=new g.Vector3,n=new g.Line3;return function(r){for(var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=r.start,c=r.end,u=this.points,l=1/0,g=0;g<3;g++){var d=(g+1)%3;n.start.copy(u[g]),n.end.copy(u[d]),Xo(n,r,e,t),(a=e.distanceToSquared(t))<l&&(l=a,i&&i.copy(e),o&&o.copy(t))}return this.closestPointToPoint(s,e),(a=s.distanceToSquared(e))<l&&(l=a,i&&i.copy(e),o&&o.copy(s)),this.closestPointToPoint(c,e),(a=c.distanceToSquared(e))<l&&(l=a,i&&i.copy(e),o&&o.copy(c)),Math.sqrt(l)}}(),Oo.prototype.intersectsTriangle=function(){var e=new Oo,t=new Array(3),n=new Array(3),r=new Vo,a=new Vo,i=new g.Vector3,o=new g.Vector3,s=new g.Vector3,c=new g.Vector3,u=new g.Line3,l=new g.Line3,d=new g.Line3;return function(g){var I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(e.copy(g),e.update(),g=e);var A=this.plane,h=g.plane;if(Math.abs(A.normal.dot(h.normal))>1-1e-10){var C=this.satBounds,f=this.satAxes;n[0]=g.a,n[1]=g.b,n[2]=g.c;for(var p=0;p<4;p++){var m=C[p],v=f[p];if(r.setFromPoints(v,n),m.isSeparated(r))return!1}var b=g.satBounds,y=g.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(var B=0;B<4;B++){var G=b[B],w=y[B];if(r.setFromPoints(w,t),G.isSeparated(r))return!1}for(var _=0;_<4;_++)for(var Z=f[_],S=0;S<4;S++){var x=y[S];if(i.crossVectors(Z,x),r.setFromPoints(i,t),a.setFromPoints(i,n),r.isSeparated(a))return!1}return I&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),I.start.set(0,0,0),I.end.set(0,0,0)),!0}for(var R=this.points,M=!1,k=0,E=0;E<3;E++){var W=R[E],V=R[(E+1)%3];if(u.start.copy(W),u.end.copy(V),u.delta(o),0===h.normal.dot(o)&&0===h.distanceToPoint(u.start)){l.copy(u),k=2;break}if(h.intersectLine(u,M?l.start:l.end)){if(k++,M)break;M=!0}}if(2!==k)return!1;for(var F=g.points,X=!1,H=0,O=0;O<3;O++){var L=F[O],N=F[(O+1)%3];if(u.start.copy(L),u.end.copy(N),u.delta(s),0===A.normal.dot(s)&&0===A.distanceToPoint(u.start)){d.copy(u),H=2;break}if(A.intersectLine(u,X?d.start:d.end)){if(H++,X)break;X=!0}}if(2!==H)return!1;if(l.delta(o),d.delta(s),o.dot(s)<0){var Y=d.start;d.start=d.end,d.end=Y}var T=l.start.dot(o),z=l.end.dot(o),K=d.start.dot(o),j=d.end.dot(o),D=z<K,U=T<j;return(T===j||K===z||D!==U)&&(I&&(c.subVectors(l.start,d.start),c.dot(o)>0?I.start.copy(l.start):I.start.copy(d.start),c.subVectors(l.end,d.end),c.dot(o)<0?I.end.copy(l.end):I.end.copy(d.end)),!0)}}(),Oo.prototype.distanceToPoint=function(){var e=new g.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Oo.prototype.distanceToTriangle=function(){var e=new g.Vector3,t=new g.Vector3,n=["a","b","c"],r=new g.Line3,a=new g.Line3;return function(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=o||s?r:null;if(this.intersectsTriangle(i,c))return(o||s)&&(o&&c.getCenter(o),s&&c.getCenter(s)),0;for(var u=1/0,l=0;l<3;l++){var g=void 0,d=n[l],I=i[d];this.closestPointToPoint(I,e),(g=I.distanceToSquared(e))<u&&(u=g,o&&o.copy(e),s&&s.copy(I));var A=this[d];i.closestPointToPoint(A,e),(g=A.distanceToSquared(e))<u&&(u=g,o&&o.copy(A),s&&s.copy(e))}for(var h=0;h<3;h++){var C=n[h],f=n[(h+1)%3];r.set(this[C],this[f]);for(var p=0;p<3;p++){var m=n[p],v=n[(p+1)%3];a.set(i[m],i[v]),Xo(r,a,e,t);var b=e.distanceToSquared(t);b<u&&(u=b,o&&o.copy(e),s&&s.copy(t))}}return Math.sqrt(u)}}();var Lo=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).isOrientedBox=!0,e.matrix=new g.Matrix4,e.invMatrix=new g.Matrix4,e.points=new Array(8).fill().map((function(){return new g.Vector3})),e.satAxes=new Array(3).fill().map((function(){return new g.Vector3})),e.satBounds=new Array(3).fill().map((function(){return new Vo})),e.alignedSatBounds=new Array(3).fill().map((function(){return new Vo})),e.needsUpdate=!1,e}return Object(W.a)(n,[{key:"set",value:function(e,t,r){Object(q.a)(Object($.a)(n.prototype),"set",this).call(this,e,t),this.matrix.copy(r),this.needsUpdate=!0}},{key:"copy",value:function(e){Object(q.a)(Object($.a)(n.prototype),"copy",this).call(this,e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}]),n}(g.Box3);function No(e,t,n,r){var a=e.a,i=e.b,o=e.c,s=t,c=t+1,u=t+2;n&&(s=n.getX(t),c=n.getX(t+1),u=n.getX(t+2)),a.x=r.getX(s),a.y=r.getY(s),a.z=r.getZ(s),i.x=r.getX(c),i.y=r.getY(c),i.z=r.getZ(c),o.x=r.getX(u),o.y=r.getY(u),o.z=r.getZ(u)}function Yo(e,t,n,r,a,i,o){for(var s=n.index,c=n.attributes.position,u=e,l=t+e;u<l;u++)if(No(o,3*u,s,c),o.needsUpdate=!0,r(o,u,a,i))return!0;return!1}Lo.prototype.update=function(){for(var e=this.matrix,t=this.min,n=this.max,r=this.points,a=0;a<=1;a++)for(var i=0;i<=1;i++)for(var o=0;o<=1;o++){var s=r[1*a|2*i|4*o];s.x=a?n.x:t.x,s.y=i?n.y:t.y,s.z=o?n.z:t.z,s.applyMatrix4(e)}for(var c=this.satBounds,u=this.satAxes,l=r[0],g=0;g<3;g++){var d=u[g],I=c[g],A=r[1<<g];d.subVectors(l,A),I.setFromPoints(d,r)}var h=this.alignedSatBounds;h[0].setFromPointsField(r,"x"),h[1].setFromPointsField(r,"y"),h[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Lo.prototype.intersectsBox=function(){var e=new Vo;return function(t){this.needsUpdate&&this.update();var n=t.min,r=t.max,a=this.satBounds,i=this.satAxes,o=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,o[0].isSeparated(e))return!1;if(e.min=n.y,e.max=r.y,o[1].isSeparated(e))return!1;if(e.min=n.z,e.max=r.z,o[2].isSeparated(e))return!1;for(var s=0;s<3;s++){var c=i[s],u=a[s];if(e.setFromBox(c,t),u.isSeparated(e))return!1}return!0}}(),Lo.prototype.intersectsTriangle=function(){var e=new Oo,t=new Array(3),n=new Vo,r=new Vo,a=new g.Vector3;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(e.copy(i),e.update(),i=e);var o=this.satBounds,s=this.satAxes;t[0]=i.a,t[1]=i.b,t[2]=i.c;for(var c=0;c<3;c++){var u=o[c],l=s[c];if(n.setFromPoints(l,t),u.isSeparated(n))return!1}for(var g=i.satBounds,d=i.satAxes,I=this.points,A=0;A<3;A++){var h=g[A],C=d[A];if(n.setFromPoints(C,I),h.isSeparated(n))return!1}for(var f=0;f<3;f++)for(var p=s[f],m=0;m<4;m++){var v=d[m];if(a.crossVectors(p,v),n.setFromPoints(a,t),r.setFromPoints(a,I),n.isSeparated(r))return!1}return!0}}(),Lo.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Lo.prototype.distanceToPoint=function(){var e=new g.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Lo.prototype.distanceToBox=function(){var e=["x","y","z"],t=new Array(12).fill().map((function(){return new g.Line3})),n=new Array(12).fill().map((function(){return new g.Line3})),r=new g.Vector3,a=new g.Vector3;return function(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(s||c)&&(i.getCenter(a),this.closestPointToPoint(a,r),i.closestPointToPoint(r,a),s&&s.copy(r),c&&c.copy(a)),0;for(var u=o*o,l=i.min,g=i.max,d=this.points,I=1/0,A=0;A<8;A++){var h=d[A];a.copy(h).clamp(l,g);var C=h.distanceToSquared(a);if(C<I&&(I=C,s&&s.copy(h),c&&c.copy(a),C<u))return Math.sqrt(C)}for(var f=0,p=0;p<3;p++)for(var m=0;m<=1;m++)for(var v=0;v<=1;v++){var b=(p+1)%3,y=(p+2)%3,B=m<<b|v<<y,G=1<<p|m<<b|v<<y,w=d[B],_=d[G],Z=t[f];Z.set(w,_);var S=e[p],x=e[b],R=e[y],M=n[f],k=M.start,E=M.end;k[S]=l[S],k[x]=m?l[x]:g[x],k[R]=v?l[R]:g[x],E[S]=g[S],E[x]=m?l[x]:g[x],E[R]=v?l[R]:g[x],f++}for(var W=0;W<=1;W++)for(var V=0;V<=1;V++)for(var F=0;F<=1;F++){a.x=W?g.x:l.x,a.y=V?g.y:l.y,a.z=F?g.z:l.z,this.closestPointToPoint(a,r);var X=a.distanceToSquared(r);if(X<I&&(I=X,s&&s.copy(r),c&&c.copy(a),X<u))return Math.sqrt(X)}for(var H=0;H<12;H++)for(var O=t[H],L=0;L<12;L++){var N=n[L];Xo(O,N,r,a);var Y=r.distanceToSquared(a);if(Y<I&&(I=Y,s&&s.copy(r),c&&c.copy(a),Y<u))return Math.sqrt(Y)}return Math.sqrt(I)}}();var To=function(){function e(t){Object(E.a)(this,e),this._getNewPrimitive=t,this._primitives=[]}return Object(W.a)(e,[{key:"getPrimitive",value:function(){var e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}},{key:"releasePrimitive",value:function(e){this._primitives.push(e)}}]),e}();function zo(e,t){return 65535===t[e+15]}function Ko(e,t){return t[e+6]}function jo(e,t){return t[e+14]}function Do(e){return e+8}function Uo(e,t){return t[e+6]}var Qo=new g.Box3,Po=new g.Vector3,Jo=["x","y","z"];function qo(e,t,n,r,a){var i=2*e,o=as,s=is,c=os;if(zo(i,s)){!function(e,t,n,r,a,i){for(var o=r,s=r+a;o<s;o++)Io(e,t,n,o,i)}(t,n,r,Ko(e,c),jo(i,s),a)}else{var u=Do(e);ns(u,o,r,Po)&&qo(u,t,n,r,a);var l=Uo(e,c);ns(l,o,r,Po)&&qo(l,t,n,r,a)}}function $o(e,t,n,r){var a=2*e,i=as,o=is,s=os;if(zo(a,o))return function(e,t,n,r,a){for(var i=1/0,o=null,s=r,c=r+a;s<c;s++){var u=Io(e,t,n,s);u&&u.distance<i&&(o=u,i=u.distance)}return o}(t,n,r,Ko(e,s),jo(a,o));var c,u,l=function(e,t){return t[e+7]}(e,s),g=Jo[l],d=r.direction[g]>=0;d?(c=Do(e),u=Uo(e,s)):(c=Uo(e,s),u=Do(e));var I=ns(c,i,r,Po)?$o(c,t,n,r):null;if(I){var A=I.point[g];if(d?A<=i[u+l]:A>=i[u+l+3])return I}var h=ns(u,i,r,Po)?$o(u,t,n,r):null;return I&&h?I.distance<=h.distance?I:h:I||h||null}var es=function(){var e,t,n=[],r=new To((function(){return new g.Box3}));return function(){e=r.getPrimitive(),t=r.getPrimitive(),n.push(e,t);var i=a.apply(void 0,arguments);r.releasePrimitive(e),r.releasePrimitive(t),n.pop(),n.pop();var o=n.length;return o>0&&(t=n[o-1],e=n[o-2]),i};function a(n,r,i,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function l(e){for(var t=2*e,n=is,r=os;!zo(t,n);)t=2*(e=Do(e));return Ko(e,r)}function g(e){for(var t=2*e,n=is,r=os;!zo(t,n);)t=2*(e=Uo(e,r));return Ko(e,r)+jo(t,n)}var d=2*n,I=as,A=is,h=os,C=zo(d,A);if(C){var f=Ko(n,h),p=jo(d,A);return vo(n,I,e),o(f,p,!1,u,c+n,e)}var m,v,b,y,B=Do(n),G=Uo(n,h),w=B,_=G;if(s&&(y=t,vo(w,I,b=e),vo(_,I,y),m=s(b),(v=s(y))<m)){w=G,_=B;var Z=m;m=v,v=Z,b=y}b||vo(w,I,b=e);var S,x=zo(2*w,A),R=i(b,x,m,u+1,c+w);if(2===R){var M=l(w),k=g(w),E=k-M;S=o(M,E,!0,u+1,c+w,b)}else S=R&&a(w,r,i,o,s,c,u+1);if(S)return!0;vo(_,I,y=t);var W,V=zo(2*_,A),F=i(y,V,v,u+1,c+_);if(2===F){var X=l(_),H=g(_),O=H-X;W=o(X,O,!0,u+1,c+_,y)}else W=F&&a(_,r,i,o,s,c,u+1);return!!W}}(),ts=function(){var e=new Oo,t=new Oo,n=new g.Matrix4,r=new Lo,a=new Lo;return function i(o,s,c,u){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=2*o,d=as,I=is,A=os;null===l&&(c.boundingBox||c.computeBoundingBox(),r.set(c.boundingBox.min,c.boundingBox.max,u),l=r);var h=zo(g,I);if(!h){var C=o+8,f=A[o+6];vo(C,d,Qo);var p=l.intersectsBox(Qo)&&i(C,s,c,u,l);if(p)return!0;vo(f,d,Qo);var m=l.intersectsBox(Qo)&&i(f,s,c,u,l);return!!m}var v=s,b=v.index,y=v.attributes.position,B=c.index,G=c.attributes.position,w=Ko(o,A),_=jo(g,I);if(n.copy(u).invert(),c.boundsTree){vo(o,d,a),a.matrix.copy(n),a.needsUpdate=!0;var Z=c.boundsTree.shapecast({intersectsBounds:function(e){return a.intersectsBox(e)},intersectsTriangle:function(e){e.a.applyMatrix4(u),e.b.applyMatrix4(u),e.c.applyMatrix4(u),e.needsUpdate=!0;for(var n=3*w,r=3*(_+w);n<r;n+=3)if(No(t,n,b,y),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});return Z}for(var S=3*w,x=_+3*w;S<x;S+=3){No(e,S,b,y),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(var R=0,M=B.count;R<M;R+=3)if(No(t,R,B,G),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}();function ns(e,t,n,r){return vo(e,t,Qo),n.intersectBox(Qo,r)}var rs,as,is,os,ss=[];function cs(e){rs&&ss.push(rs),rs=e,as=new Float32Array(e),is=new Uint16Array(e),os=new Uint32Array(e)}function us(){rs=null,as=null,is=null,os=null,ss.length&&cs(ss.pop())}var ls=Symbol("skip tree generation"),gs=new g.Box3,ds=new g.Box3,Is=new g.Matrix4,As=new Lo,hs=new Lo,Cs=new g.Vector3,fs=new g.Vector3,ps=new g.Vector3,ms=new g.Vector3,vs=new g.Vector3,bs=new g.Box3,ys=new To((function(){return new Oo})),Bs=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(E.a)(this,e),!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((n=Object.assign(Object(D.a)({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null},ls,!1),n)).useSharedArrayBuffer&&"undefined"===typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,n[ls]||(this._roots=Wo(t,n),!t.boundingBox&&n.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new g.Box3))),this.geometry=t}return Object(W.a)(e,[{key:"refit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Array.isArray(e)&&(e=new Set(e));var t,n,r,a,i=this.geometry,o=i.index.array,s=i.attributes.position,c=s.array,u=s.offset||0,l=3;s.isInterleavedBufferAttribute&&(l=s.data.stride);for(var g=0,d=this._roots,I=0,A=d.length;I<A;I++)t=d[I],n=new Uint32Array(t),r=new Uint16Array(t),a=new Float32Array(t),h(0,g),g+=t.byteLength;function h(t,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=2*t,d=r[g+15]===fo;if(d){for(var I=n[t+6],A=r[g+14],C=1/0,f=1/0,p=1/0,m=-1/0,v=-1/0,b=-1/0,y=3*I,B=3*(I+A);y<B;y++){var G=o[y]*l+u,w=c[G+0],_=c[G+1],Z=c[G+2];w<C&&(C=w),w>m&&(m=w),_<f&&(f=_),_>v&&(v=_),Z<p&&(p=Z),Z>b&&(b=Z)}return(a[t+0]!==C||a[t+1]!==f||a[t+2]!==p||a[t+3]!==m||a[t+4]!==v||a[t+5]!==b)&&(a[t+0]=C,a[t+1]=f,a[t+2]=p,a[t+3]=m,a[t+4]=v,a[t+5]=b,!0)}var S=t+8,x=n[t+6],R=S+i,M=x+i,k=s,E=!1,W=!1;e?k||(E=e.has(R),W=e.has(M),k=!E&&!W):(E=!0,W=!0);var V=k||E,F=k||W,X=!1;V&&(X=h(S,i,k));var H=!1;F&&(H=h(x,i,k));var O=X||H;if(O)for(var L=0;L<3;L++){var N=S+L,Y=x+L,T=a[N],z=a[N+3],K=a[Y],j=a[Y+3];a[t+L]=T<K?T:K,a[t+L+3]=z>j?z:j}return O}}},{key:"traverse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._roots[t],r=new Uint32Array(n),a=new Uint16Array(n);function i(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=2*t,c=a[s+15]===fo;if(c){var u=r[t+6],l=a[s+14];e(o,c,new Float32Array(n,4*t,6),u,l)}else{var g=t+8,d=r[t+6],I=r[t+7],A=e(o,c,new Float32Array(n,4*t,6),I);A||(i(g,o+1),i(d,o+1))}}i(0)}},{key:"raycast",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.FrontSide,n=this._roots,r=this.geometry,a=[],i=t.isMaterial,o=Array.isArray(t),s=r.groups,c=i?t.side:t,u=0,l=n.length;u<l;u++){var d=o?t[s[u].materialIndex].side:c,I=a.length;if(cs(n[u]),qo(0,r,d,e,a),us(),o)for(var A=s[u].materialIndex,h=I,C=a.length;h<C;h++)a[h].face.materialIndex=A}return a}},{key:"raycastFirst",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.FrontSide,n=this._roots,r=this.geometry,a=t.isMaterial,i=Array.isArray(t),o=null,s=r.groups,c=a?t.side:t,u=0,l=n.length;u<l;u++){var d=i?t[s[u].materialIndex].side:c;cs(n[u]);var I=$o(0,r,d,e);us(),null!=I&&(null==o||I.distance<o.distance)&&(o=I,i&&(I.face.materialIndex=s[u].materialIndex))}return o}},{key:"intersectsGeometry",value:function(e,t){var n,r=this.geometry,a=!1,i=Object(qe.a)(this._roots);try{for(i.s();!(n=i.n()).done;){if(cs(n.value),a=ts(0,r,e,t),us(),a)break}}catch(o){i.e(o)}finally{i.f()}return a}},{key:"shapecast",value:function(e,t,n){var r=this.geometry;if(e instanceof Function){if(t){var a=t;t=function(e,t,n,r){var i=3*t;return a(e,i,i+1,i+2,n,r)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}var i=ys.getPrimitive(),o=e,s=o.boundsTraverseOrder,c=o.intersectsBounds,u=o.intersectsRange,l=o.intersectsTriangle;if(u&&l){var g=u;u=function(e,t,n,a,o){return!!g(e,t,n,a,o)||Yo(e,t,r,l,n,a,i)}}else u||(u=l?function(e,t,n,a){return Yo(e,t,r,l,n,a,i)}:function(e,t,n){return n});var d,I=!1,A=0,h=Object(qe.a)(this._roots);try{for(h.s();!(d=h.n()).done;){var C=d.value;if(cs(C),I=es(0,r,c,u,s,A),us(),I)break;A+=C.byteLength}}catch(f){h.e(f)}finally{h.f()}return ys.releasePrimitive(i),I}},{key:"bvhcast",value:function(e,t,n){var r=n.intersectsRanges,a=n.intersectsTriangles,i=this.geometry.index,o=this.geometry.attributes.position,s=e.geometry.index,c=e.geometry.attributes.position;Is.copy(t).invert();var u=ys.getPrimitive(),l=ys.getPrimitive();if(a){var g=function(e,n,r,g,d,I,A,h){for(var C=r,f=r+g;C<f;C++){No(l,3*C,s,c),l.a.applyMatrix4(t),l.b.applyMatrix4(t),l.c.applyMatrix4(t),l.needsUpdate=!0;for(var p=e,m=e+n;p<m;p++)if(No(u,3*p,i,o),u.needsUpdate=!0,a(u,l,p,C,d,I,A,h))return!0}return!1};if(r){var d=r;r=function(e,t,n,r,a,i,o,s){return!!d(e,t,n,r,a,i,o,s)||g(e,t,n,r,a,i,o,s)}}else r=g}this.getBoundingBox(ds),ds.applyMatrix4(t);var I=this.shapecast({intersectsBounds:function(e){return ds.intersectsBox(e)},intersectsRange:function(t,n,a,i,o,s){return gs.copy(s),gs.applyMatrix4(Is),e.shapecast({intersectsBounds:function(e){return gs.intersectsBox(e)},intersectsRange:function(e,a,s,c,u){return r(t,n,e,a,i,o,c,u)}})}});return ys.releasePrimitive(u),ys.releasePrimitive(l),I}},{key:"intersectsBox",value:function(e,t){return As.set(e.min,e.max,t),As.needsUpdate=!0,this.shapecast({intersectsBounds:function(e){return As.intersectsBox(e)},intersectsTriangle:function(e){return As.intersectsTriangle(e)}})}},{key:"intersectsSphere",value:function(e){return this.shapecast({intersectsBounds:function(t){return e.intersectsBox(t)},intersectsTriangle:function(t){return t.intersectsSphere(e)}})}},{key:"closestPointToGeometry",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;e.boundingBox||e.computeBoundingBox(),As.set(e.boundingBox.min,e.boundingBox.max,t),As.needsUpdate=!0;var o=this.geometry,s=o.attributes.position,c=o.index,u=e.attributes.position,l=e.index,g=ys.getPrimitive(),d=ys.getPrimitive(),I=fs,A=ps,h=null,C=null;r&&(h=ms,C=vs);var f=1/0,p=null,m=null;return Is.copy(t).invert(),hs.matrix.copy(Is),this.shapecast({boundsTraverseOrder:function(e){return As.distanceToBox(e)},intersectsBounds:function(e,t,n){return n<f&&n<i&&(t&&(hs.min.copy(e.min),hs.max.copy(e.max),hs.needsUpdate=!0),!0)},intersectsRange:function(n,r){if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:function(e){return hs.distanceToBox(e)},intersectsBounds:function(e,t,n){return n<f&&n<i},intersectsRange:function(e,i){for(var o=3*e,v=3*(e+i);o<v;o+=3){No(d,o,l,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(var b=3*n,y=3*(n+r);b<y;b+=3){No(g,b,c,s),g.needsUpdate=!0;var B=g.distanceToTriangle(d,I,h);if(B<f&&(A.copy(I),C&&C.copy(h),f=B,p=b/3,m=o/3),B<a)return!0}}}});for(var o=0,v=l?l.count:u.count;o<v;o+=3){No(d,o,l,u),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(var b=3*n,y=3*(n+r);b<y;b+=3){No(g,b,c,s),g.needsUpdate=!0;var B=g.distanceToTriangle(d,I,h);if(B<f&&(A.copy(I),C&&C.copy(h),f=B,p=b/3,m=o/3),B<a)return!0}}}}),ys.releasePrimitive(g),ys.releasePrimitive(d),f===1/0?null:(n.point?n.point.copy(A):n.point=A.clone(),n.distance=f,n.faceIndex=p,r&&(r.point?r.point.copy(C):r.point=C.clone(),r.point.applyMatrix4(Is),A.applyMatrix4(Is),r.distance=A.sub(r.point).length(),r.faceIndex=m),n)}},{key:"closestPointToPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,a=n*n,i=r*r,o=1/0,s=null;if(this.shapecast({boundsTraverseOrder:function(t){return Cs.copy(e).clamp(t.min,t.max),Cs.distanceToSquared(e)},intersectsBounds:function(e,t,n){return n<o&&n<i},intersectsTriangle:function(t,n){t.closestPointToPoint(e,Cs);var r=e.distanceToSquared(Cs);return r<o&&(fs.copy(Cs),o=r,s=n),r<a}}),o===1/0)return null;var c=Math.sqrt(o);return t.point?t.point.copy(fs):t.point=fs.clone(),t.distance=c,t.faceIndex=s,t}},{key:"getBoundingBox",value:function(e){return e.makeEmpty(),this._roots.forEach((function(t){vo(0,new Float32Array(t),bs),e.union(bs)})),e}}],[{key:"serialize",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),e.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});n=Object(u.a)({cloneBuffers:!0},n);var r=t.geometry,a=t._roots,i=r.getIndex();return n.cloneBuffers?{roots:a.map((function(e){return e.slice()})),index:i.array.slice()}:{roots:a,index:i.array}}},{key:"deserialize",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"===typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),e.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r=Object(u.a)({setIndex:!0},r);var a=t.index,i=t.roots,o=new e(n,Object(u.a)(Object(u.a)({},r),{},Object(D.a)({},ls,!0)));if(o._roots=i,r.setIndex){var s=n.getIndex();if(null===s){var c=new g.BufferAttribute(t.index,1,!1);n.setIndex(c)}else s.array!==a&&(s.array.set(a),s.needsUpdate=!0)}return o}}]),e}(),Gs=Bs.prototype.raycast;Bs.prototype.raycast=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');var r=t[0],a=t[1],i=t[2],o=t[3],s=Gs.call(this,i,r.material);return s.forEach((function(e){(e=Ao(e,r,a))&&o.push(e)})),o}return Gs.apply(this,t)};var ws=Bs.prototype.raycastFirst;Bs.prototype.raycastFirst=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');var r=t[0],a=t[1],i=t[2];return Ao(ws.call(this,i,r.material),r,a)}return ws.apply(this,t)};var _s=Bs.prototype.closestPointToPoint;Bs.prototype.closestPointToPoint=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),t.unshift();var r=t[1],a={};return t[1]=a,_s.apply(this,t),r&&r.copy(a.point),a.distance}return _s.apply(this,t)};var Zs=Bs.prototype.closestPointToGeometry;Bs.prototype.closestPointToGeometry=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[2],a=t[3];if(r&&r.isVector3||a&&a.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');var i={},o={},s=t[1];return t[2]=i,t[3]=o,Zs.apply(this,t),r&&r.copy(i.point),a&&a.copy(o.point).applyMatrix4(s),i.distance}return Zs.apply(this,t)};var Ss=Bs.prototype.refit;Bs.prototype.refit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1];if(a&&(a instanceof Set||Array.isArray(a))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');var i=new Set;a.forEach((function(e){return i.add(e)})),r&&r.forEach((function(e){return i.add(e)})),Ss.call(this,i)}else Ss.apply(this,t)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach((function(e){var t=Bs.prototype[e];Bs.prototype[e]=function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(null===r[0]||r[0].isMesh)&&(r.shift(),console.warn('MeshBVH: The function signature for "'.concat(e,'" has changed and no longer takes Mesh. See docs for new signature.'))),t.apply(this,r)}}));var xs=new g.Ray,Rs=new g.Matrix4,Ms=g.Mesh.prototype.raycast;function ks(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;Rs.copy(this.matrixWorld).invert(),xs.copy(e.ray).applyMatrix4(Rs);var n=this.geometry.boundsTree;if(!0===e.firstHitOnly){var r=Ao(n.raycastFirst(xs,this.material),this,e);r&&t.push(r)}else for(var a=n.raycast(xs,this.material),i=0,o=a.length;i<o;i++){var s=Ao(a[i],this,e);s&&t.push(s)}}else Ms.call(this,e,t)}function Es(e){return this.boundsTree=new Bs(this,e),this.boundsTree}function Ws(){this.boundsTree=null}function Vs(e,t){i.useEffect((function(){if(e.current){e.current.raycast=ks;var n=e.current.geometry;return n.computeBoundsTree=Es,n.disposeBoundsTree=Ws,n.computeBoundsTree(t),function(){n.boundsTree&&n.disposeBoundsTree()}}}),[e,t])}function Fs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=i.useRef([]);return r.current=t.map((function(e){return i.useContext(e)})),i.useMemo((function(){return function(e){var n=e.children;return t.reduceRight((function(e,t,n){return i.createElement(t.Provider,{value:r.current[n],children:e})}),n)}}),[])}function Xs(e,t){var n=i.useRef(),r=i.useState((function(){return t?t instanceof g.Object3D?{current:t}:t:n})),a=Object(l.a)(r,1)[0],s=i.useState((function(){return new g.AnimationMixer(void 0)})),c=Object(l.a)(s,1)[0],u=i.useRef({}),d=i.useState((function(){var t={};return e.forEach((function(e){return Object.defineProperty(t,e.name,{enumerable:!0,get:function(){if(a.current)return u.current[e.name]||(u.current[e.name]=c.clipAction(e,a.current))}})})),{ref:a,clips:e,actions:t,names:e.map((function(e){return e.name})),mixer:c}})),I=Object(l.a)(d,1)[0];return Object(o.useFrame)((function(e,t){return c.update(t)})),i.useEffect((function(){var e=a.current;return function(){u.current={},Object.values(I.actions).forEach((function(t){e&&c.uncacheAction(t,e)}))}}),[e]),I}function Hs(e){var t=i.useRef(null),n=i.useRef(!1),r=i.useRef(!1);return i.useEffect((function(){var a=t.current;if(a){var i=Object(o.addEffect)((function(){return n.current=!1,!0})),s=a.onBeforeRender;a.onBeforeRender=function(){return n.current=!0};var c=Object(o.addAfterEffect)((function(){return n.current!==r.current&&e(r.current=n.current),!0}));return function(){a.onBeforeRender=s,i(),c()}}}),[]),t}function Os(e,t,n){e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:n},e.vertexShader="\n  varying vec3 vWorldPosition;\n  ".concat(e.vertexShader.replace("#include <worldpos_vertex>","\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n  #ifdef BOX_PROJECTED_ENV_MAP\n    vWorldPosition = worldPosition.xyz;\n  #endif\n#endif\n")),e.fragmentShader="\n    ".concat("\n#ifdef BOX_PROJECTED_ENV_MAP\n  uniform vec3 envMapSize;\n  uniform vec3 envMapPosition;\n  varying vec3 vWorldPosition;\n    \n  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n    vec3 nDir = normalize( v );\n    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbminmax;\n    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n    vec3 boxIntersection = vWorldPosition + nDir * correction;    \n    return boxIntersection - cubePos;\n  }\n#endif\n","\n    ").concat(e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",g.ShaderChunk.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n         ".concat("\n#ifdef BOX_PROJECTED_ENV_MAP\n  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );\n#endif\n","\n         ")).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );","reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n         ".concat("\n#ifdef BOX_PROJECTED_ENV_MAP\n  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );\n#endif\n","\n        ")))}function Ls(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g.Vector3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g.Vector3,n=i.useState((function(){return{position:new g.Vector3,size:new g.Vector3}})),r=Object(l.a)(n,1),s=r[0];Object(o.applyProps)(s,{position:e,size:t});var c=i.useRef(null),u=i.useMemo((function(){return{ref:c,onBeforeCompile:function(e){return Os(e,s.position,s.size)},customProgramCacheKey:function(){return JSON.stringify(s.position.toArray())+JSON.stringify(s.size.toArray())}}}),[].concat(Object(a.a)(s.position.toArray()),Object(a.a)(s.size.toArray())));return i.useLayoutEffect((function(){c.current.needsUpdate=!0}),[s]),u}var Ns=1024,Ys=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Float32Array(4096*e*4),n=new g.DataTexture(t,Ns,4*e,g.RGBAFormat,g.FloatType);return n.wrapS=g.RepeatWrapping,n.wrapT=g.RepeatWrapping,n.magFilter=g.NearestFilter,n.needsUpdate=!0,n},Ts=function(e,t,n,r,a,i){var o=e.image.data,s=4096*i;o[4*t+s+0]=n,o[4*t+s+1]=r,o[4*t+s+2]=a,o[4*t+s+3]=1};function zs(e){return{spineTexture:{value:e},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}function Ks(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.__ok||(e.__ok=!0,e.onBeforeCompile=function(e){if(!e.__modified){e.__modified=!0,Object.assign(e.uniforms,t);var r="\n\t\tuniform sampler2D spineTexture;\n\t\tuniform float pathOffset;\n\t\tuniform float pathSegment;\n\t\tuniform float spineOffset;\n\t\tuniform float spineLength;\n\t\tuniform int flow;\n\n\t\tfloat textureLayers = ".concat(4*n,".;\n\t\tfloat textureStacks = ").concat(1,".;\n\n\t\t").concat(e.vertexShader,"\n\t\t").replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,"\n        void main() {\n        #include <beginnormal_vertex>\n\n        vec4 worldPos = modelMatrix * vec4(position, 1.);\n\n        bool bend = flow > 0;\n        float xWeight = bend ? 0. : 1.;\n\n        #ifdef USE_INSTANCING\n        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];\n        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;\n        #else\n        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;\n        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;\n        #endif\n\n        mt = mod(mt, textureStacks);\n        float rowOffset = floor(mt);\n\n        #ifdef USE_INSTANCING\n        rowOffset += instanceMatrix[3][1] * ".concat(4,".;\n        #endif\n\n        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;\n        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;\n        mat3 basis = mat3(a, b, c);\n\n        vec3 transformed = basis\n          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)\n          + spinePos;\n\n        vec3 transformedNormal = normalMatrix * (basis * objectNormal);\n\t\t\t")).replace("#include <project_vertex>","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\t\t\t\tgl_Position = projectionMatrix * mvPosition;");e.vertexShader=r}})}var js=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(E.a)(this,e),Object(D.a)(this,"curveArray",void 0),Object(D.a)(this,"curveLengthArray",void 0),Object(D.a)(this,"object3D",void 0),Object(D.a)(this,"splineTexure",void 0),Object(D.a)(this,"uniforms",void 0);var r=t.clone(),a=Ys(n),i=zs(a);r.traverse((function(e){(e instanceof g.Mesh||e instanceof g.InstancedMesh)&&(e.material=e.material.clone(),Ks(e.material,i,n))})),this.curveArray=new Array(n),this.curveLengthArray=new Array(n),this.object3D=r,this.splineTexure=a,this.uniforms=i}return Object(W.a)(e,[{key:"updateCurve",value:function(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");var n=t.getLength();this.uniforms.spineLength.value=n,this.curveLengthArray[e]=n,this.curveArray[e]=t,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.floor(1024);t.arcLengthDivisions=r/2,t.updateArcLengths();for(var a=t.getSpacedPoints(r),i=t.computeFrenetFrames(r,!0),o=0;o<r;o++){var s=Math.floor(o/Ns),c=o%Ns,u=a[o];Ts(e,c,u.x,u.y,u.z,0+s+4*n),u=i.tangents[o],Ts(e,c,u.x,u.y,u.z,1+s+4*n),u=i.normals[o],Ts(e,c,u.x,u.y,u.z,2+s+4*n),u=i.binormals[o],Ts(e,c,u.x,u.y,u.z,3+s+4*n)}e.needsUpdate=!0}(this.splineTexure,t,e)}},{key:"moveAlongCurve",value:function(e){this.uniforms.pathOffset.value+=e}}]),e}(),Ds=(new g.Matrix4,i.forwardRef((function(e,t){var n=e.children,r=e.curve,a=i.useState((function(){return new g.Scene})),s=Object(l.a)(a,1)[0],c=i.useState(),u=Object(l.a)(c,2),d=u[0],I=u[1],A=i.useRef();return i.useEffect((function(){A.current=new js(s.children[0]),I(A.current.object3D)}),[n]),i.useEffect((function(){var e;r&&(null==(e=A.current)||e.updateCurve(0,r))}),[r]),i.useImperativeHandle(t,(function(){return{moveAlongCurve:function(e){var t;null==(t=A.current)||t.moveAlongCurve(e)}}})),i.createElement(i.Fragment,null,Object(o.createPortal)(n,s),d&&i.createElement("primitive",{object:d}))}))),Us=["speed"],Qs=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(E.a)(this,n),(e=t.call(this,r)).setValues(r),e._time={value:0},e._distort={value:.4},e._radius={value:1},e}return Object(W.a)(n,[{key:"onBeforeCompile",value:function(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader="\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      ".concat("#define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}","\n      ").concat(e.vertexShader,"\n    "),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}},{key:"time",get:function(){return this._time.value},set:function(e){this._time.value=e}},{key:"distort",get:function(){return this._distort.value},set:function(e){this._distort.value=e}},{key:"radius",get:function(){return this._radius.value},set:function(e){this._radius.value=e}}]),n}(g.MeshPhysicalMaterial),Ps=i.forwardRef((function(e,t){var n=e.speed,r=void 0===n?1:n,a=Object(p.a)(e,Us),s=i.useState((function(){return new Qs})),c=Object(l.a)(s,1)[0];return Object(o.useFrame)((function(e){return c&&(c.time=e.clock.getElapsedTime()*r)})),i.createElement("primitive",Object(m.a)({dispose:void 0,object:c,ref:t,attach:"material"},a))})),Js=["speed"],qs=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(E.a)(this,n),(e=t.call(this,r)).setValues(r),e._time={value:0},e._factor={value:1},e}return Object(W.a)(n,[{key:"onBeforeCompile",value:function(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader="\n      uniform float time;\n      uniform float factor;\n      ".concat(e.vertexShader,"\n    "),e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}},{key:"time",get:function(){return this._time.value},set:function(e){this._time.value=e}},{key:"factor",get:function(){return this._factor.value},set:function(e){this._factor.value=e}}]),n}(g.MeshStandardMaterial),$s=i.forwardRef((function(e,t){var n=e.speed,r=void 0===n?1:n,a=Object(p.a)(e,Js),s=i.useState((function(){return new qs})),c=Object(l.a)(s,1)[0];return Object(o.useFrame)((function(e){return c&&(c.time=e.clock.getElapsedTime()*r)})),i.createElement("primitive",Object(m.a)({dispose:void 0,object:c,ref:t,attach:"material"},a))})),ec=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g.Vector2;return Object(E.a)(this,n),(e=t.call(this,{uniforms:{inputBuffer:new g.Uniform(null),depthBuffer:new g.Uniform(null),resolution:new g.Uniform(new g.Vector2),texelSize:new g.Uniform(new g.Vector2),halfTexelSize:new g.Uniform(new g.Vector2),kernel:new g.Uniform(0),scale:new g.Uniform(1),cameraNear:new g.Uniform(0),cameraFar:new g.Uniform(1),minDepthThreshold:new g.Uniform(0),maxDepthThreshold:new g.Uniform(1),depthScale:new g.Uniform(0),depthToBlurRatioBias:new g.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:g.NoBlending,depthWrite:!1,depthTest:!1})).toneMapped=!1,e.setTexelSize(r.x,r.y),e.kernel=new Float32Array([0,1,2,2,3]),e}return Object(W.a)(n,[{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}},{key:"setResolution",value:function(e){this.uniforms.resolution.value.copy(e)}}]),n}(g.ShaderMaterial),tc=function(){function e(t){var n=t.gl,r=t.resolution,a=t.width,i=void 0===a?500:a,o=t.height,s=void 0===o?500:o,c=t.minDepthThreshold,u=void 0===c?0:c,l=t.maxDepthThreshold,d=void 0===l?1:l,I=t.depthScale,A=void 0===I?0:I,h=t.depthToBlurRatioBias,C=void 0===h?.25:h;Object(E.a)(this,e),this.renderToScreen=!1,this.renderTargetA=new g.WebGLRenderTarget(r,r,{minFilter:g.LinearFilter,magFilter:g.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:n.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new ec,this.convolutionMaterial.setTexelSize(1/i,1/s),this.convolutionMaterial.setResolution(new g.Vector2(i,s)),this.scene=new g.Scene,this.camera=new g.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=u,this.convolutionMaterial.uniforms.maxDepthThreshold.value=d,this.convolutionMaterial.uniforms.depthScale.value=A,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=C,this.convolutionMaterial.defines.USE_DEPTH=A>0;var f=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),p=new Float32Array([0,0,2,0,0,2]),m=new g.BufferGeometry;m.setAttribute("position",new g.BufferAttribute(f,3)),m.setAttribute("uv",new g.BufferAttribute(p,2)),this.screen=new g.Mesh(m,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}return Object(W.a)(e,[{key:"render",value:function(e,t,n){var r=this.scene,a=this.camera,i=this.renderTargetA,o=this.renderTargetB,s=this.convolutionMaterial,c=s.uniforms;c.depthBuffer.value=t.depthTexture;var u,l,g,d=s.kernel,I=t;for(l=0,g=d.length-1;l<g;++l)u=0===(1&l)?i:o,c.kernel.value=d[l],c.inputBuffer.value=I.texture,e.setRenderTarget(u),e.render(r,a),I=u;c.kernel.value=d[l],c.inputBuffer.value=I.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(r,a)}}]),e}(),nc=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(E.a)(this,n),(e=t.call(this,r))._tDepth={value:null},e._distortionMap={value:null},e._tDiffuse={value:null},e._tDiffuseBlur={value:null},e._textureMatrix={value:null},e._hasBlur={value:!1},e._mirror={value:0},e._mixBlur={value:0},e._blurStrength={value:.5},e._minDepthThreshold={value:.9},e._maxDepthThreshold={value:1},e._depthScale={value:0},e._depthToBlurRatioBias={value:.25},e._distortion={value:1},e._mixContrast={value:1},e.setValues(r),e}return Object(W.a)(n,[{key:"onBeforeCompile",value:function(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader="\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;     \n      ".concat(e.vertexShader),e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader="\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;        \n        ".concat(e.fragmentShader),e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n    \n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n      \n      vec4 merge = base;\n      \n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n  \n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n      \n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}},{key:"tDiffuse",get:function(){return this._tDiffuse.value},set:function(e){this._tDiffuse.value=e}},{key:"tDepth",get:function(){return this._tDepth.value},set:function(e){this._tDepth.value=e}},{key:"distortionMap",get:function(){return this._distortionMap.value},set:function(e){this._distortionMap.value=e}},{key:"tDiffuseBlur",get:function(){return this._tDiffuseBlur.value},set:function(e){this._tDiffuseBlur.value=e}},{key:"textureMatrix",get:function(){return this._textureMatrix.value},set:function(e){this._textureMatrix.value=e}},{key:"hasBlur",get:function(){return this._hasBlur.value},set:function(e){this._hasBlur.value=e}},{key:"mirror",get:function(){return this._mirror.value},set:function(e){this._mirror.value=e}},{key:"mixBlur",get:function(){return this._mixBlur.value},set:function(e){this._mixBlur.value=e}},{key:"mixStrength",get:function(){return this._blurStrength.value},set:function(e){this._blurStrength.value=e}},{key:"minDepthThreshold",get:function(){return this._minDepthThreshold.value},set:function(e){this._minDepthThreshold.value=e}},{key:"maxDepthThreshold",get:function(){return this._maxDepthThreshold.value},set:function(e){this._maxDepthThreshold.value=e}},{key:"depthScale",get:function(){return this._depthScale.value},set:function(e){this._depthScale.value=e}},{key:"depthToBlurRatioBias",get:function(){return this._depthToBlurRatioBias.value},set:function(e){this._depthToBlurRatioBias.value=e}},{key:"distortion",get:function(){return this._distortion.value},set:function(e){this._distortion.value=e}},{key:"mixContrast",get:function(){return this._mixContrast.value},set:function(e){this._mixContrast.value=e}}]),n}(g.MeshStandardMaterial),rc=["mixBlur","mixStrength","resolution","blur","minDepthThreshold","maxDepthThreshold","depthScale","depthToBlurRatioBias","mirror","distortion","mixContrast","distortionMap","reflectorOffset"];Object(o.extend)({MeshReflectorMaterialImpl:nc});var ac=i.forwardRef((function(e,t){var n=e.mixBlur,r=void 0===n?0:n,a=e.mixStrength,s=void 0===a?1:a,c=e.resolution,u=void 0===c?256:c,d=e.blur,I=void 0===d?[0,0]:d,A=e.minDepthThreshold,h=void 0===A?.9:A,C=e.maxDepthThreshold,f=void 0===C?1:C,v=e.depthScale,y=void 0===v?0:v,B=e.depthToBlurRatioBias,G=void 0===B?.25:B,w=e.mirror,_=void 0===w?0:w,Z=e.distortion,S=void 0===Z?1:Z,x=e.mixContrast,R=void 0===x?1:x,M=e.distortionMap,k=e.reflectorOffset,E=void 0===k?0:k,W=Object(p.a)(e,rc),V=Object(o.useThree)((function(e){return e.gl})),F=Object(o.useThree)((function(e){return e.camera})),X=Object(o.useThree)((function(e){return e.scene})),H=(I=Array.isArray(I)?I:[I,I])[0]+I[1]>0,O=i.useRef(null),L=i.useState((function(){return new g.Plane})),N=Object(l.a)(L,1)[0],Y=i.useState((function(){return new g.Vector3})),T=Object(l.a)(Y,1)[0],z=i.useState((function(){return new g.Vector3})),K=Object(l.a)(z,1)[0],j=i.useState((function(){return new g.Vector3})),D=Object(l.a)(j,1)[0],U=i.useState((function(){return new g.Matrix4})),Q=Object(l.a)(U,1)[0],P=i.useState((function(){return new g.Vector3(0,0,-1)})),J=Object(l.a)(P,1)[0],q=i.useState((function(){return new g.Vector4})),$=Object(l.a)(q,1)[0],ee=i.useState((function(){return new g.Vector3})),te=Object(l.a)(ee,1)[0],ne=i.useState((function(){return new g.Vector3})),re=Object(l.a)(ne,1)[0],ae=i.useState((function(){return new g.Vector4})),ie=Object(l.a)(ae,1)[0],oe=i.useState((function(){return new g.Matrix4})),se=Object(l.a)(oe,1)[0],ce=i.useState((function(){return new g.PerspectiveCamera})),ue=Object(l.a)(ce,1)[0],le=i.useCallback((function(){var e,t=O.current.parent||(null==(e=O.current)?void 0:e.__r3f.parent);if(t&&(K.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(F.matrixWorld),Q.extractRotation(t.matrixWorld),T.set(0,0,1),T.applyMatrix4(Q),K.addScaledVector(T,E),te.subVectors(K,D),!(te.dot(T)>0))){te.reflect(T).negate(),te.add(K),Q.extractRotation(F.matrixWorld),J.set(0,0,-1),J.applyMatrix4(Q),J.add(D),re.subVectors(K,J),re.reflect(T).negate(),re.add(K),ue.position.copy(te),ue.up.set(0,1,0),ue.up.applyMatrix4(Q),ue.up.reflect(T),ue.lookAt(re),ue.far=F.far,ue.updateMatrixWorld(),ue.projectionMatrix.copy(F.projectionMatrix),se.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),se.multiply(ue.projectionMatrix),se.multiply(ue.matrixWorldInverse),se.multiply(t.matrixWorld),N.setFromNormalAndCoplanarPoint(T,K),N.applyMatrix4(ue.matrixWorldInverse),$.set(N.normal.x,N.normal.y,N.normal.z,N.constant);var n=ue.projectionMatrix;ie.x=(Math.sign($.x)+n.elements[8])/n.elements[0],ie.y=(Math.sign($.y)+n.elements[9])/n.elements[5],ie.z=-1,ie.w=(1+n.elements[10])/n.elements[14],$.multiplyScalar(2/$.dot(ie)),n.elements[2]=$.x,n.elements[6]=$.y,n.elements[10]=$.z+1,n.elements[14]=$.w}}),[F,E]),ge=i.useMemo((function(){var e={minFilter:g.LinearFilter,magFilter:g.LinearFilter,encoding:V.outputEncoding,type:g.HalfFloatType},t=new g.WebGLRenderTarget(u,u,e);t.depthBuffer=!0,t.depthTexture=new g.DepthTexture(u,u),t.depthTexture.format=g.DepthFormat,t.depthTexture.type=g.UnsignedShortType;var n=new g.WebGLRenderTarget(u,u,e);return[t,n,new tc({gl:V,resolution:u,width:I[0],height:I[1],minDepthThreshold:h,maxDepthThreshold:f,depthScale:y,depthToBlurRatioBias:G}),{mirror:_,textureMatrix:se,mixBlur:r,tDiffuse:t.texture,tDepth:t.depthTexture,tDiffuseBlur:n.texture,hasBlur:H,mixStrength:s,minDepthThreshold:h,maxDepthThreshold:f,depthScale:y,depthToBlurRatioBias:G,transparent:!0,distortion:S,distortionMap:M,mixContrast:R,"defines-USE_BLUR":H?"":void 0,"defines-USE_DEPTH":y>0?"":void 0,"defines-USE_DISTORTION":M?"":void 0}]}),[V,I,se,u,_,H,r,s,h,f,y,G,S,M,R]),de=Object(l.a)(ge,4),Ie=de[0],Ae=de[1],he=de[2],Ce=de[3];return Object(o.useFrame)((function(){var e,t=O.current.parent||(null==(e=O.current)?void 0:e.__r3f.parent);if(t){t.visible=!1;var n=V.xr.enabled,r=V.shadowMap.autoUpdate;le(),V.xr.enabled=!1,V.shadowMap.autoUpdate=!1,V.setRenderTarget(Ie),V.state.buffers.depth.setMask(!0),V.autoClear||V.clear(),V.render(X,ue),H&&he.render(V,Ie,Ae),V.xr.enabled=n,V.shadowMap.autoUpdate=r,t.visible=!0,V.setRenderTarget(null)}})),i.createElement("meshReflectorMaterialImpl",Object(m.a)({attach:"material",key:"key"+Ce["defines-USE_BLUR"]+Ce["defines-USE_DEPTH"]+Ce["defines-USE_DISTORTION"],ref:Object(b.default)([O,t])},Ce,W))})),ic=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <output_fragment>","\n        #include <output_fragment>\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      ")},r}return Object(W.a)(n)}(g.PointsMaterial),oc=i.forwardRef((function(e,t){var n=i.useState((function(){return new ic(null)})),r=Object(l.a)(n,1)[0];return i.createElement("primitive",Object(m.a)({},e,{object:r,ref:t,attach:"material"}))})),sc=!1,cc=function(e){if(!sc){sc=!0;var t=g.ShaderChunk.shadowmap_pars_fragment;t=t.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.frustum,n=void 0===t?3.75:t,r=e.size,a=void 0===r?.005:r,i=e.near,o=void 0===i?9.5:i,s=e.samples,c=void 0===s?17:s,u=e.rings,l=void 0===u?11:u;return"#define LIGHT_WORLD_SIZE ".concat(a,"\n#define LIGHT_FRUSTUM_WIDTH ").concat(n,"\n#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n#define NEAR_PLANE ").concat(o,"\n\n#define NUM_SAMPLES ").concat(c,"\n#define NUM_RINGS ").concat(l,"\n#define BLOCKER_SEARCH_NUM_SAMPLES NUM_SAMPLES\n#define PCF_NUM_SAMPLES NUM_SAMPLES\n\nvec2 poissonDisk[NUM_SAMPLES];\n\nvoid initPoissonSamples(const in vec2 randomSeed) {\n  float ANGLE_STEP = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n  float INV_NUM_SAMPLES = 1.0 / float(NUM_SAMPLES);\n  float angle = rand(randomSeed) * PI2;\n  float radius = INV_NUM_SAMPLES;\n  float radiusStep = radius;\n  for (int i = 0; i < NUM_SAMPLES; i++) {\n    poissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\n    radius += radiusStep;\n    angle += ANGLE_STEP;\n  }\n}\n\nfloat penumbraSize(const in float zReceiver, const in float zBlocker) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver) {\n  float searchRadius = LIGHT_SIZE_UV * (zReceiver - NEAR_PLANE) / zReceiver;\n  float blockerDepthSum = 0.0;\n  int numBlockers = 0;\n  for (int i = 0; i < BLOCKER_SEARCH_NUM_SAMPLES; i++) {\n    float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n    if (shadowMapDepth < zReceiver) {\n      blockerDepthSum += shadowMapDepth;\n      numBlockers++;\n    }\n  }\n  if (numBlockers == 0) return -1.0;\n  return blockerDepthSum / float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\n  float sum = 0.0;\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[ i ] * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[ i ].yx * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  return sum / (2.0 * float(PCF_NUM_SAMPLES));\n}\n\nfloat PCSS(sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  initPoissonSamples(uv);\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n  if (avgBlockerDepth == -1.0) return 1.0;\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  float filterRadius = penumbraRatio * LIGHT_SIZE_UV * NEAR_PLANE / zReceiver;\n  return PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}")}(Object(u.a)({},e))),t=t.replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),g.ShaderChunk.shadowmap_pars_fragment=t}},uc=["args","children"];function lc(e){var t=e+"BufferGeometry";return i.forwardRef((function(e,n){var r=e.args,a=e.children,o=Object(p.a)(e,uc);return i.createElement("mesh",Object(m.a)({ref:n},o),i.createElement(t,{attach:"geometry",args:r}),a)}))}var gc=lc("box"),dc=lc("circle"),Ic=lc("cone"),Ac=lc("cylinder"),hc=lc("sphere"),Cc=lc("plane"),fc=lc("tube"),pc=lc("torus"),mc=lc("torusKnot"),vc=lc("tetrahedron"),bc=lc("ring"),yc=lc("polyhedron"),Bc=lc("icosahedron"),Gc=lc("octahedron"),wc=lc("dodecahedron"),_c=lc("extrude"),Zc=lc("lathe"),Sc=["args","radius","steps","smoothness","children"],xc=1e-5;var Rc=i.forwardRef((function(e,t){var n=e.args;n=void 0===n?[]:n;var r=Object(l.a)(n,3),a=r[0],o=void 0===a?1:a,s=r[1],c=void 0===s?1:s,u=r[2],d=void 0===u?1:u,I=e.radius,A=void 0===I?.05:I,h=e.steps,C=void 0===h?1:h,f=e.smoothness,v=void 0===f?4:f,b=e.children,y=Object(p.a)(e,Sc),B=i.useMemo((function(){return function(e,t,n){var r=new g.Shape,a=n-xc;return r.absarc(xc,xc,xc,-Math.PI/2,-Math.PI,!0),r.absarc(xc,t-2*a,xc,Math.PI,Math.PI/2,!0),r.absarc(e-2*a,t-2*a,xc,Math.PI/2,0,!0),r.absarc(e-2*a,xc,xc,0,-Math.PI/2,!0),r}(o,c,A)}),[o,c,A]),G=i.useMemo((function(){return{depth:d-2*A,bevelEnabled:!0,bevelSegments:2*v,steps:C,bevelSize:A-xc,bevelThickness:A,curveSegments:v}}),[d,A,v]),w=i.useRef();return i.useLayoutEffect((function(){w.current&&w.current.center()}),[B,G]),i.createElement("mesh",Object(m.a)({ref:t},y),i.createElement("extrudeBufferGeometry",{attach:"geometry",ref:w,args:[B,G]}),b)})),Mc=["children"];function kc(){var e=new g.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.setAttribute("position",new g.BufferAttribute(t,2)),e}var Ec=i.forwardRef((function(e,t){var n=e.children,r=Object(p.a)(e,Mc),a=i.useMemo(kc,[]);return i.createElement("mesh",Object(m.a)({ref:t,geometry:a,frustumCulled:!1},r),n)})),Wc=["children","alignTop"],Vc=i.forwardRef((function(e,t){var n=e.children,r=e.alignTop,a=Object(p.a)(e,Wc),o=i.useRef(null),s=i.useRef(null);return i.useLayoutEffect((function(){o.current.position.set(0,0,0),o.current.updateWorldMatrix(!0,!0);var e=(new g.Box3).setFromObject(s.current),t=new g.Vector3,n=new g.Sphere,a=e.max.y-e.min.y;e.getCenter(t),e.getBoundingSphere(n),o.current.position.set(-t.x,-t.y+(r?a/2:0),-t.z)}),[n]),i.createElement("group",Object(m.a)({ref:t},a),i.createElement("group",{ref:o},i.createElement("group",{ref:s},n)))})),Fc=function(e){return e&&e.isOrthographicCamera},Xc=i.createContext(null);function Hc(e){var t=e.children,n=e.damping,r=void 0===n?6:n,a=e.fit,s=e.clip,c=e.observe,u=e.margin,d=void 0===u?1.2:u,I=e.eps,A=void 0===I?.01:I,h=e.onFit,C=i.useRef(null),f=Object(o.useThree)(),p=f.camera,m=f.invalidate,v=f.size,b=f.controls,y=i.useRef(h);function B(e,t){return Math.abs(e.x-t.x)<A&&Math.abs(e.y-t.y)<A&&Math.abs(e.z-t.z)<A}function G(e,t,n,r){e.x=g.MathUtils.damp(e.x,t.x,n,r),e.y=g.MathUtils.damp(e.y,t.y,n,r),e.z=g.MathUtils.damp(e.z,t.z,n,r)}y.current=h;var w=i.useState((function(){return{animating:!1,focus:new g.Vector3,camera:new g.Vector3,zoom:1}})),_=Object(l.a)(w,1)[0],Z=i.useState((function(){return{focus:new g.Vector3,camera:new g.Vector3,zoom:1}})),S=Object(l.a)(Z,1)[0],x=i.useState((function(){return new g.Box3})),R=Object(l.a)(x,1)[0],M=i.useMemo((function(){function e(){var e=R.getSize(new g.Vector3),t=R.getCenter(new g.Vector3),n=Math.max(e.x,e.y,e.z),r=Fc(p)?4*n:n/(2*Math.atan(Math.PI*p.fov/360)),a=Fc(p)?4*n:r/p.aspect,i=d*Math.max(r,a);return{box:R,size:e,center:t,distance:i}}return{getSize:e,refresh:function(t){if((r=t)&&r.isBox3)R.copy(t);else{var n=t||C.current;n.updateWorldMatrix(!0,!0),R.setFromObject(n)}var r;if(R.isEmpty()){var a=p.position.length()||10;R.setFromCenterAndSize(new g.Vector3,new g.Vector3(a,a,a))}if("OrthographicTrackballControls"===(null==b?void 0:b.constructor.name)){var i=e().distance,o=p.position.clone().sub(b.target).normalize().multiplyScalar(i),s=b.target.clone().add(o);p.position.copy(s)}return this},clip:function(){var t=e().distance;return b&&(b.maxDistance=10*t),p.near=t/100,p.far=100*t,p.updateProjectionMatrix(),b&&b.update(),m(),this},fit:function(){_.camera.copy(p.position),b&&_.focus.copy(b.target);var t=e(),n=t.center,a=t.distance,i=n.clone().sub(p.position).normalize().multiplyScalar(a);if(S.camera.copy(n).sub(i),S.focus.copy(n),Fc(p)){_.zoom=p.zoom;var o=0,s=0,c=[new g.Vector3(R.min.x,R.min.y,R.min.z),new g.Vector3(R.min.x,R.max.y,R.min.z),new g.Vector3(R.min.x,R.min.y,R.max.z),new g.Vector3(R.min.x,R.max.y,R.max.z),new g.Vector3(R.max.x,R.max.y,R.max.z),new g.Vector3(R.max.x,R.max.y,R.min.z),new g.Vector3(R.max.x,R.min.y,R.max.z),new g.Vector3(R.max.x,R.min.y,R.min.z)];n.applyMatrix4(p.matrixWorldInverse);for(var u=0,l=c;u<l.length;u++){var I=l[u];I.applyMatrix4(p.matrixWorldInverse),o=Math.max(o,Math.abs(I.y-n.y)),s=Math.max(s,Math.abs(I.x-n.x))}o*=2,s*=2;var A=(p.top-p.bottom)/o,h=(p.right-p.left)/s;S.zoom=Math.min(A,h)/d,r||(p.zoom=S.zoom,p.updateProjectionMatrix())}return r?_.animating=!0:(p.position.copy(S.camera),p.lookAt(S.focus),b&&(b.target.copy(S.focus),b.update())),y.current&&y.current(this.getSize()),m(),this}}}),[R,p,b,d,r,m]);i.useLayoutEffect((function(){if(b){var e=function(){return _.animating=!1};return b.addEventListener("start",e),function(){return b.removeEventListener("start",e)}}}),[b]);var k=i.useRef(0);return i.useLayoutEffect((function(){(c||0===k.current++)&&(M.refresh(),a&&M.fit(),s&&M.clip())}),[v,s,a,c]),Object(o.useFrame)((function(e,t){if(_.animating){if(G(_.focus,S.focus,r,t),G(_.camera,S.camera,r,t),_.zoom=g.MathUtils.damp(_.zoom,S.zoom,r,t),p.position.copy(_.camera),Fc(p)&&(p.zoom=_.zoom,p.updateProjectionMatrix()),b?(b.target.copy(_.focus),b.update()):p.lookAt(_.focus),m(),Fc(p)&&!(Math.abs(_.zoom-S.zoom)<A))return;if(!Fc(p)&&!B(_.camera,S.camera))return;if(b&&!B(_.focus,S.focus))return;_.animating=!1}})),i.createElement("group",{ref:C},i.createElement(Xc.Provider,{value:M},t))}function Oc(){return i.useContext(Xc)}var Lc=Object(W.a)((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math;Object(E.a)(this,e),Object(D.a)(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),Object(D.a)(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),Object(D.a)(this,"p",[]),Object(D.a)(this,"perm",[]),Object(D.a)(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),Object(D.a)(this,"dot",(function(e,t,n){return e[0]*t+e[1]*n})),Object(D.a)(this,"dot3",(function(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r})),Object(D.a)(this,"dot4",(function(e,t,n,r,a){return e[0]*t+e[1]*n+e[2]*r+e[3]*a})),Object(D.a)(this,"noise",(function(e,n){var r=(e+n)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+r),i=Math.floor(n+r),o=(3-Math.sqrt(3))/6,s=(a+i)*o,c=e-(a-s),u=n-(i-s),l=0,g=1;c>u&&(l=1,g=0);var d=c-l+o,I=u-g+o,A=c-1+2*o,h=u-1+2*o,C=255&a,f=255&i,p=t.perm[C+t.perm[f]]%12,m=t.perm[C+l+t.perm[f+g]]%12,v=t.perm[C+1+t.perm[f+1]]%12,b=.5-c*c-u*u,y=.5-d*d-I*I,B=.5-A*A-h*h;return 70*((b<0?0:(b*=b)*b*t.dot(t.grad3[p],c,u))+(y<0?0:(y*=y)*y*t.dot(t.grad3[m],d,I))+(B<0?0:(B*=B)*B*t.dot(t.grad3[v],A,h)))})),Object(D.a)(this,"noise3d",(function(e,n,r){var a,i,o,s,c,u,l=(e+n+r)*(1/3),g=Math.floor(e+l),d=Math.floor(n+l),I=Math.floor(r+l),A=1/6,h=(g+d+I)*A,C=e-(g-h),f=n-(d-h),p=r-(I-h);C>=f?f>=p?(a=1,i=0,o=0,s=1,c=1,u=0):C>=p?(a=1,i=0,o=0,s=1,c=0,u=1):(a=0,i=0,o=1,s=1,c=0,u=1):f<p?(a=0,i=0,o=1,s=0,c=1,u=1):C<p?(a=0,i=1,o=0,s=0,c=1,u=1):(a=0,i=1,o=0,s=1,c=1,u=0);var m=C-a+A,v=f-i+A,b=p-o+A,y=C-s+2*A,B=f-c+2*A,G=p-u+2*A,w=C-1+.5,_=f-1+.5,Z=p-1+.5,S=255&g,x=255&d,R=255&I,M=t.perm[S+t.perm[x+t.perm[R]]]%12,k=t.perm[S+a+t.perm[x+i+t.perm[R+o]]]%12,E=t.perm[S+s+t.perm[x+c+t.perm[R+u]]]%12,W=t.perm[S+1+t.perm[x+1+t.perm[R+1]]]%12,V=.6-C*C-f*f-p*p,F=.6-m*m-v*v-b*b,X=.6-y*y-B*B-G*G,H=.6-w*w-_*_-Z*Z;return 32*((V<0?0:(V*=V)*V*t.dot3(t.grad3[M],C,f,p))+(F<0?0:(F*=F)*F*t.dot3(t.grad3[k],m,v,b))+(X<0?0:(X*=X)*X*t.dot3(t.grad3[E],y,B,G))+(H<0?0:(H*=H)*H*t.dot3(t.grad3[W],w,_,Z)))})),Object(D.a)(this,"noise4d",(function(e,n,r,a){var i,o,s,c,u,l,g,d,I,A,h,C,f=t.grad4,p=t.simplex,m=t.perm,v=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,y=(e+n+r+a)*v,B=Math.floor(e+y),G=Math.floor(n+y),w=Math.floor(r+y),_=Math.floor(a+y),Z=(B+G+w+_)*b,S=e-(B-Z),x=n-(G-Z),R=r-(w-Z),M=a-(_-Z),k=(S>x?32:0)+(S>R?16:0)+(x>R?8:0)+(S>M?4:0)+(x>M?2:0)+(R>M?1:0),E=S-(i=p[k][0]>=3?1:0)+b,W=x-(o=p[k][1]>=3?1:0)+b,V=R-(s=p[k][2]>=3?1:0)+b,F=M-(c=p[k][3]>=3?1:0)+b,X=S-(u=p[k][0]>=2?1:0)+2*b,H=x-(l=p[k][1]>=2?1:0)+2*b,O=R-(g=p[k][2]>=2?1:0)+2*b,L=M-(d=p[k][3]>=2?1:0)+2*b,N=S-(I=p[k][0]>=1?1:0)+3*b,Y=x-(A=p[k][1]>=1?1:0)+3*b,T=R-(h=p[k][2]>=1?1:0)+3*b,z=M-(C=p[k][3]>=1?1:0)+3*b,K=S-1+4*b,j=x-1+4*b,D=R-1+4*b,U=M-1+4*b,Q=255&B,P=255&G,J=255&w,q=255&_,$=m[Q+m[P+m[J+m[q]]]]%32,ee=m[Q+i+m[P+o+m[J+s+m[q+c]]]]%32,te=m[Q+u+m[P+l+m[J+g+m[q+d]]]]%32,ne=m[Q+I+m[P+A+m[J+h+m[q+C]]]]%32,re=m[Q+1+m[P+1+m[J+1+m[q+1]]]]%32,ae=.6-S*S-x*x-R*R-M*M,ie=.6-E*E-W*W-V*V-F*F,oe=.6-X*X-H*H-O*O-L*L,se=.6-N*N-Y*Y-T*T-z*z,ce=.6-K*K-j*j-D*D-U*U;return 27*((ae<0?0:(ae*=ae)*ae*t.dot4(f[$],S,x,R,M))+(ie<0?0:(ie*=ie)*ie*t.dot4(f[ee],E,W,V,F))+(oe<0?0:(oe*=oe)*oe*t.dot4(f[te],X,H,O,L))+(se<0?0:(se*=se)*se*t.dot4(f[ne],N,Y,T,z))+(ce<0?0:(ce*=ce)*ce*t.dot4(f[re],K,j,D,U)))}));for(var r=0;r<256;r++)this.p[r]=Math.floor(256*n.random());for(var a=0;a<512;a++)this.perm[a]=this.p[255&a]})),Nc=i.forwardRef((function(e,t){var n=e.intensity,r=void 0===n?1:n,a=e.decay,s=e.decayRate,c=void 0===s?.65:s,u=e.maxYaw,g=void 0===u?.1:u,d=e.maxPitch,I=void 0===d?.1:d,A=e.maxRoll,h=void 0===A?.1:A,C=e.yawFrequency,f=void 0===C?.1:C,p=e.pitchFrequency,m=void 0===p?.1:p,v=e.rollFrequency,b=void 0===v?.1:v,y=e.controls,B=Object(o.useThree)((function(e){return e.camera})),G=Object(o.useThree)((function(e){return e.controls})),w=i.useRef(r),_=i.useRef(B.rotation.clone()),Z=i.useState((function(){return new Lc})),S=Object(l.a)(Z,1)[0],x=i.useState((function(){return new Lc})),R=Object(l.a)(x,1)[0],M=i.useState((function(){return new Lc})),k=Object(l.a)(M,1)[0],E=function(){(w.current<0||w.current>1)&&(w.current=w.current<0?0:1)};return i.useImperativeHandle(t,(function(){return{getIntensity:function(){return w.current},setIntensity:function(e){w.current=e,E()}}}),[]),i.useEffect((function(){var e=G||(null==y?void 0:y.current),t=function(){_.current=B.rotation.clone()};return null==e||e.addEventListener("change",t),function(){null==e||e.removeEventListener("change",t)}}),[y,G]),Object(o.useFrame)((function(e,t){var n=e.clock,r=Math.pow(w.current,2),i=g*r*S.noise(n.elapsedTime*f,1),o=I*r*R.noise(n.elapsedTime*m,1),s=h*r*k.noise(n.elapsedTime*b,1);B.rotation.set(_.current.x+o,_.current.y+i,_.current.z+s),a&&w.current>0&&(w.current-=c*t,E())})),null})),Yc=["children","speed","rotationIntensity","floatIntensity"],Tc=i.forwardRef((function(e,t){var n=e.children,r=e.speed,a=void 0===r?1:r,s=e.rotationIntensity,c=void 0===s?1:s,u=e.floatIntensity,l=void 0===u?1:u,g=Object(p.a)(e,Yc),d=i.useRef(null),I=i.useRef(1e4*Math.random());return Object(o.useFrame)((function(e){var t=I.current+e.clock.getElapsedTime();d.current.rotation.x=Math.cos(t/4*a)/8*c,d.current.rotation.y=Math.sin(t/4*a)/8*c,d.current.rotation.z=Math.sin(t/4*a)/20*c,d.current.position.y=Math.sin(t/4*a)/10*l})),i.createElement("group",g,i.createElement("group",{ref:Object(b.default)([d,t])},n))})),zc=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(e){var r;return Object(E.a)(this,n),(r=t.call(this,e)).type=g.HalfFloatType,r}return Object(W.a)(n,[{key:"parse",value:function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var r=e.pos,a=-1,i=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));0>(a=s.indexOf("\n"))&&i<t&&r<e.byteLength;)o+=s,i+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<a&&(!1!==n&&(e.pos+=i+a+1),o+s.slice(0,a))},r=function(e,t,n,r){var a=e[t+3],i=Math.pow(2,a-128)/255;n[r+0]=e[t+0]*i,n[r+1]=e[t+1]*i,n[r+2]=e[t+2]*i,n[r+3]=1},a=function(e,t,n,r){var a=e[t+3],i=Math.pow(2,a-128)/255;n[r+0]=g.DataUtils.toHalfFloat(Math.min(e[t+0]*i,65504)),n[r+1]=g.DataUtils.toHalfFloat(Math.min(e[t+1]*i,65504)),n[r+2]=g.DataUtils.toHalfFloat(Math.min(e[t+2]*i,65504)),n[r+3]=g.DataUtils.toHalfFloat(1)},i=new Uint8Array(e);i.pos=0;var o=function(e){var r,a,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=n(e)))return t(1,"no header found");if(!(a=r.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=a[1],u.string+=r+"\n";!1!==(r=n(e));)if(u.string+=r+"\n","#"!==r.charAt(0)){if((a=r.match(i))&&(u.gamma=parseFloat(a[1])),(a=r.match(o))&&(u.exposure=parseFloat(a[1])),(a=r.match(s))&&(u.valid|=2,u.format=a[1]),(a=r.match(c))&&(u.valid|=4,u.height=parseInt(a[1],10),u.width=parseInt(a[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(-1!==o){var s=o.width,c=o.height,u=function(e,n,r){var a=n;if(a<8||a>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(a!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");var i=new Uint8Array(4*n*r);if(!i.length)return t(4,"unable to allocate buffer space");for(var o=0,s=0,c=4*a,u=new Uint8Array(4),l=new Uint8Array(c),g=r;g>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(u[0]=e[s++],u[1]=e[s++],u[2]=e[s++],u[3]=e[s++],2!=u[0]||2!=u[1]||(u[2]<<8|u[3])!=a)return t(3,"bad rgbe scanline format");for(var d=0,I=void 0;d<c&&s<e.byteLength;){var A=(I=e[s++])>128;if(A&&(I-=128),0===I||d+I>c)return t(3,"bad scanline data");if(A)for(var h=e[s++],C=0;C<I;C++)l[d++]=h;else l.set(e.subarray(s,s+I),d),d+=I,s+=I}for(var f=a,p=0;p<f;p++){var m=0;i[o]=l[p+m],m+=a,i[o+1]=l[p+m],m+=a,i[o+2]=l[p+m],m+=a,i[o+3]=l[p+m],o+=4}g--}return i}(i.subarray(i.pos),s,c);if(-1!==u){var l,d,I;switch(this.type){case g.FloatType:I=u.length/4;for(var A=new Float32Array(4*I),h=0;h<I;h++)r(u,4*h,A,4*h);l=A,d=g.FloatType;break;case g.HalfFloatType:I=u.length/4;for(var C=new Uint16Array(4*I),f=0;f<I;f++)a(u,4*f,C,4*f);l=C,d=g.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:c,data:l,header:o.string,gamma:o.gamma,exposure:o.exposure,format:undefined,type:d}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,t,r,a){return Object(q.a)(Object($.a)(n.prototype),"load",this).call(this,e,(function(e,n){switch(e.type){case g.FloatType:case g.HalfFloatType:e.encoding=g.LinearEncoding,e.minFilter=g.LinearFilter,e.magFilter=g.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),r,a)}}]),n}(g.DataTextureLoader),Kc={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},jc=function(e){return(t=e).current&&t.current.isScene?e.current:e;var t};function Dc(e){return e.map?i.createElement(Uc,e):e.children?i.createElement(Qc,e):i.createElement(Pc,e)}function Uc(e){var t=e.scene,n=e.background,r=void 0!==n&&n,a=e.map,s=Object(o.useThree)((function(e){return e.scene}));return i.useLayoutEffect((function(){if(a){var e=jc(t||s),n=e.background,i=e.environment;return"only"!==r&&(e.environment=a),r&&(e.background=a),function(){"only"!==r&&(e.environment=i),r&&(e.background=n)}}}),[t,a]),null}function Qc(e){var t=e.children,n=e.near,r=void 0===n?1:n,a=e.far,s=void 0===a?1e3:a,c=e.resolution,u=void 0===c?256:c,d=e.frames,I=void 0===d?1:d,A=e.background,h=void 0!==A&&A,C=e.scene,f=e.files,p=e.path,m=e.preset,v=void 0===m?void 0:m,b=e.extensions,y=Object(o.useThree)((function(e){return e.gl})),B=Object(o.useThree)((function(e){return e.scene})),G=i.useRef(null),w=i.useState((function(){return new g.Scene})),_=Object(l.a)(w,1)[0],Z=i.useMemo((function(){var e=new g.WebGLCubeRenderTarget(u);return e.texture.type=g.HalfFloatType,e}),[u]);i.useLayoutEffect((function(){1===I&&G.current.update(y,_);var e=jc(C||B),t=e.background,n=e.environment;return"only"!==h&&(e.environment=Z.texture),h&&(e.background=Z.texture),function(){"only"!==h&&(e.environment=n),h&&(e.background=t)}}),[t,C]);var S=1;return Object(o.useFrame)((function(){(I===1/0||S<I)&&(G.current.update(y,_),S++)})),i.createElement(i.Fragment,null,Object(o.createPortal)(i.createElement(i.Fragment,null,t,i.createElement("cubeCamera",{ref:G,args:[r,s,Z]}),(f||v)&&i.createElement(Uc,{background:!0,files:f,preset:v,path:p,extensions:b,scene:_})),_))}function Pc(e){var t=e.background,n=void 0!==t&&t,r=e.files,a=void 0===r?["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"]:r,s=e.path,c=void 0===s?"":s,u=e.preset,l=void 0===u?void 0:u,d=e.scene,I=e.extensions;if(l){if(!(l in Kc))throw new Error("Preset must be one of: "+Object.keys(Kc).join(", "));a=Kc[l],c="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}var A=Object(o.useThree)((function(e){return e.scene})),h=Array.isArray(a),C=h?g.CubeTextureLoader:zc,f=Object(o.useLoader)(C,h?[a]:a,(function(e){e.setPath(c),null==e.setDataType||e.setDataType(g.FloatType),I&&I(e)})),p=h?f[0]:f;return p.mapping=h?g.CubeReflectionMapping:g.EquirectangularReflectionMapping,i.useLayoutEffect((function(){var e=jc(d||A),t=e.background,r=e.environment;return"only"!==n&&(e.environment=p),n&&(e.background=p),function(){"only"!==n&&(e.environment=r),n&&(e.background=t)}}),[p,n,d]),null}var Jc={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n      }\n  ",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform float h;\n\n    varying vec2 vUv;\n\n    void main() {\n\n    \tvec4 sum = vec4( 0.0 );\n\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n    \tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n    \tgl_FragColor = sum;\n\n    }\n  "},qc={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n    varying vec2 vUv;\n\n    void main() {\n\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n    }\n  ",fragmentShader:"\n  \n  uniform sampler2D tDiffuse;\n  uniform float v;\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vec4 sum = vec4( 0.0 );\n\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n    gl_FragColor = sum;\n\n  }\n  "},$c=["scale","frames","opacity","width","height","blur","far","resolution","smooth","color"],eu=i.forwardRef((function(e,t){var n=e.scale,r=e.frames,a=void 0===r?1/0:r,s=e.opacity,c=void 0===s?1:s,d=e.width,I=void 0===d?1:d,A=e.height,h=void 0===A?1:A,C=e.blur,f=void 0===C?1:C,v=e.far,b=void 0===v?10:v,y=e.resolution,B=void 0===y?256:y,G=e.smooth,w=void 0===G||G,_=e.color,Z=void 0===_?"#000000":_,S=Object(p.a)(e,$c),x=Object(o.useThree)((function(e){return e.scene})),R=Object(o.useThree)((function(e){return e.gl})),M=i.useRef(null);I*=Array.isArray(n)?n[0]:n||1,h*=Array.isArray(n)?n[1]:n||1;var k=i.useMemo((function(){var e=new g.WebGLRenderTarget(B,B),t=new g.WebGLRenderTarget(B,B);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;var n=new g.PlaneBufferGeometry(I,h).rotateX(Math.PI/2),r=new g.Mesh(n),a=new g.MeshDepthMaterial;a.depthTest=a.depthWrite=!1,a.onBeforeCompile=function(e){e.uniforms=Object(u.a)(Object(u.a)({},e.uniforms),{},{ucolor:{value:new g.Color(Z).convertSRGBToLinear()}}),e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor, ( 1.0 - fragCoordZ ) * 1.0 );")};var i=new g.ShaderMaterial(Jc),o=new g.ShaderMaterial(qc);return o.depthTest=i.depthTest=!1,[e,n,a,r,i,o,t]}),[B,I,h,n]),E=Object(l.a)(k,7),W=E[0],V=E[1],F=E[2],X=E[3],H=E[4],O=E[5],L=E[6],N=i.useCallback((function(e){X.visible=!0,X.material=H,H.uniforms.tDiffuse.value=W.texture,H.uniforms.h.value=1*e/256,R.setRenderTarget(L),R.render(X,M.current),X.material=O,O.uniforms.tDiffuse.value=L.texture,O.uniforms.v.value=1*e/256,R.setRenderTarget(W),R.render(X,M.current),X.visible=!1}),[]),Y=0;return Object(o.useFrame)((function(){if(M.current&&(a===1/0||Y<a)){var e=x.background;x.background=null;var t=x.overrideMaterial;x.overrideMaterial=F,R.setRenderTarget(W),R.render(x,M.current),x.overrideMaterial=t,N(f),w&&N(.4*f),R.setRenderTarget(null),x.background=e,Y++}})),i.createElement("group",Object(m.a)({"rotation-x":Math.PI/2},S,{ref:t}),i.createElement("mesh",{geometry:V,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},i.createElement("meshBasicMaterial",{map:W.texture,transparent:!0,opacity:c})),i.createElement("orthographicCamera",{ref:M,args:[-I/2,I/2,h/2,-h/2,0,b]}))})),tu=["children","controls","shadows","adjustCamera","environment","intensity","preset","shadowBias","contactShadow"],nu={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function ru(e){var t=e.children,n=e.controls,r=e.shadows,a=void 0===r||r,s=e.adjustCamera,c=void 0===s||s,u=e.environment,d=void 0===u?"city":u,I=e.intensity,A=void 0===I?1:I,h=e.preset,C=void 0===h?"rembrandt":h,f=e.shadowBias,v=void 0===f?0:f,b=e.contactShadow,y=void 0===b?{blur:2,opacity:.5,position:[0,0,0]}:b,B=Object(p.a)(e,tu),G=nu[C],w=Object(o.useThree)((function(e){return e.camera})),_=Object(o.useThree)((function(e){return e.controls})),Z=i.useRef(null),S=i.useRef(null),x=i.useState({radius:0,width:0,height:0}),R=Object(l.a)(x,2),M=R[0],k=M.radius,E=M.width,W=M.height,V=R[1];return i.useLayoutEffect((function(){Z.current.position.set(0,0,0),Z.current.updateWorldMatrix(!0,!0);var e=(new g.Box3).setFromObject(S.current),t=new g.Vector3,n=new g.Sphere,r=e.max.y-e.min.y,a=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(n),V({radius:n.radius,width:a,height:r}),Z.current.position.set(-t.x,-t.y+r/2,-t.z)}),[t]),i.useLayoutEffect((function(){if(c){var e=k/(W>E?1.5:2.5);w.position.set(0,.5*k,2.5*k),w.near=.1,w.far=Math.max(5e3,4*k),w.lookAt(0,e,0);var t=_||(null==n?void 0:n.current);t&&(t.target.set(0,e,0),t.update())}}),[_,k,W,E,c]),i.createElement("group",B,i.createElement("group",{ref:Z},i.createElement("group",{ref:S},t)),y&&i.createElement(eu,Object(m.a)({scale:2*k,far:k/2},y)),d&&i.createElement(Dc,{preset:d}),i.createElement("ambientLight",{intensity:A/3}),i.createElement("spotLight",{penumbra:1,position:[G.main[0]*k,G.main[1]*k,G.main[2]*k],intensity:2*A,castShadow:a,"shadow-bias":v}),i.createElement("pointLight",{position:[G.fill[0]*k,G.fill[1]*k,G.fill[2]*k],intensity:A}))}var au=["children","floor","segments","receiveShadow"],iu=function(e){return 0===e?0:Math.pow(2,10*e-10)};function ou(e){var t=e.children,n=e.floor,r=void 0===n?.25:n,a=e.segments,o=void 0===a?20:a,s=e.receiveShadow,c=Object(p.a)(e,au),u=i.useRef(null);return i.useLayoutEffect((function(){for(var e=0,t=o/o/2,n=u.current.attributes.position,a=0;a<o+1;a++)for(var i=0;i<o+1;i++)n.setXYZ(e++,a/o-t+(0===a?-r:0),i/o-t,iu(a/o));n.needsUpdate=!0,u.current.computeVertexNormals()}),[o,r]),i.createElement("group",c,i.createElement("mesh",{receiveShadow:s,rotation:[-Math.PI/2,0,Math.PI/2]},i.createElement("planeGeometry",{ref:u,args:[1,1,o,o]}),t))}var su=["fog","colorStop","color","opacity"],cu=i.forwardRef((function(e,t){var n=e.fog,r=void 0!==n&&n,a=e.colorStop,o=void 0===a?0:a,s=e.color,c=void 0===s?"black":s,u=e.opacity,l=void 0===u?.5:u,d=Object(p.a)(e,su),I=i.useMemo((function(){var e=document.createElement("canvas");e.width=128,e.height=128;var t=e.getContext("2d"),n=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return n.addColorStop(o,new g.Color(c).getStyle()),n.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),e}),[c,o]);return i.createElement("mesh",Object(m.a)({ref:t},d),i.createElement("planeBufferGeometry",{attach:"geometry",args:[1,1]}),i.createElement("meshBasicMaterial",{attach:"material",transparent:!0,opacity:l,fog:r},i.createElement("canvasTexture",{attach:"map",args:[I]})))})),uu=["mixBlur","mixStrength","resolution","blur","args","minDepthThreshold","maxDepthThreshold","depthScale","depthToBlurRatioBias","mirror","children","debug","distortion","mixContrast","distortionMap"];Object(o.extend)({MeshReflectorMaterial:nc});var lu=i.forwardRef((function(e,t){var n=e.mixBlur,r=void 0===n?0:n,a=e.mixStrength,s=void 0===a?.5:a,c=e.resolution,u=void 0===c?256:c,d=e.blur,I=void 0===d?[0,0]:d,A=e.args,h=void 0===A?[1,1]:A,C=e.minDepthThreshold,f=void 0===C?.9:C,v=e.maxDepthThreshold,y=void 0===v?1:v,B=e.depthScale,G=void 0===B?0:B,w=e.depthToBlurRatioBias,_=void 0===w?.25:w,Z=e.mirror,S=void 0===Z?0:Z,x=e.children,R=e.debug,M=void 0===R?0:R,k=e.distortion,E=void 0===k?1:k,W=e.mixContrast,V=void 0===W?1:W,F=e.distortionMap,X=Object(p.a)(e,uu);i.useEffect((function(){console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);var H=Object(o.useThree)((function(e){return e.gl})),O=Object(o.useThree)((function(e){return e.camera})),L=Object(o.useThree)((function(e){return e.scene})),N=(I=Array.isArray(I)?I:[I,I])[0]+I[1]>0,Y=i.useRef(null),T=i.useState((function(){return new g.Plane})),z=Object(l.a)(T,1)[0],K=i.useState((function(){return new g.Vector3})),j=Object(l.a)(K,1)[0],D=i.useState((function(){return new g.Vector3})),U=Object(l.a)(D,1)[0],Q=i.useState((function(){return new g.Vector3})),P=Object(l.a)(Q,1)[0],J=i.useState((function(){return new g.Matrix4})),q=Object(l.a)(J,1)[0],$=i.useState((function(){return new g.Vector3(0,0,-1)})),ee=Object(l.a)($,1)[0],te=i.useState((function(){return new g.Vector4})),ne=Object(l.a)(te,1)[0],re=i.useState((function(){return new g.Vector3})),ae=Object(l.a)(re,1)[0],ie=i.useState((function(){return new g.Vector3})),oe=Object(l.a)(ie,1)[0],se=i.useState((function(){return new g.Vector4})),ce=Object(l.a)(se,1)[0],ue=i.useState((function(){return new g.Matrix4})),le=Object(l.a)(ue,1)[0],ge=i.useState((function(){return new g.PerspectiveCamera})),de=Object(l.a)(ge,1)[0],Ie=i.useCallback((function(){if(U.setFromMatrixPosition(Y.current.matrixWorld),P.setFromMatrixPosition(O.matrixWorld),q.extractRotation(Y.current.matrixWorld),j.set(0,0,1),j.applyMatrix4(q),ae.subVectors(U,P),!(ae.dot(j)>0)){ae.reflect(j).negate(),ae.add(U),q.extractRotation(O.matrixWorld),ee.set(0,0,-1),ee.applyMatrix4(q),ee.add(P),oe.subVectors(U,ee),oe.reflect(j).negate(),oe.add(U),de.position.copy(ae),de.up.set(0,1,0),de.up.applyMatrix4(q),de.up.reflect(j),de.lookAt(oe),de.far=O.far,de.updateMatrixWorld(),de.projectionMatrix.copy(O.projectionMatrix),le.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),le.multiply(de.projectionMatrix),le.multiply(de.matrixWorldInverse),le.multiply(Y.current.matrixWorld),z.setFromNormalAndCoplanarPoint(j,U),z.applyMatrix4(de.matrixWorldInverse),ne.set(z.normal.x,z.normal.y,z.normal.z,z.constant);var e=de.projectionMatrix;ce.x=(Math.sign(ne.x)+e.elements[8])/e.elements[0],ce.y=(Math.sign(ne.y)+e.elements[9])/e.elements[5],ce.z=-1,ce.w=(1+e.elements[10])/e.elements[14],ne.multiplyScalar(2/ne.dot(ce)),e.elements[2]=ne.x,e.elements[6]=ne.y,e.elements[10]=ne.z+1,e.elements[14]=ne.w}}),[]),Ae=i.useMemo((function(){var e={minFilter:g.LinearFilter,magFilter:g.LinearFilter,encoding:H.outputEncoding},t=new g.WebGLRenderTarget(u,u,e);t.depthBuffer=!0,t.depthTexture=new g.DepthTexture(u,u),t.depthTexture.format=g.DepthFormat,t.depthTexture.type=g.UnsignedShortType;var n=new g.WebGLRenderTarget(u,u,e);return[t,n,new tc({gl:H,resolution:u,width:I[0],height:I[1],minDepthThreshold:f,maxDepthThreshold:y,depthScale:G,depthToBlurRatioBias:_}),{mirror:S,textureMatrix:le,mixBlur:r,tDiffuse:t.texture,tDepth:t.depthTexture,tDiffuseBlur:n.texture,hasBlur:N,mixStrength:s,minDepthThreshold:f,maxDepthThreshold:y,depthScale:G,depthToBlurRatioBias:_,transparent:!0,debug:M,distortion:E,distortionMap:F,mixContrast:V,"defines-USE_BLUR":N?"":void 0,"defines-USE_DEPTH":G>0?"":void 0,"defines-USE_DISTORTION":F?"":void 0}]}),[H,I,le,u,S,N,r,s,f,y,G,_,M,E,F,V]),he=Object(l.a)(Ae,4),Ce=he[0],fe=he[1],pe=he[2],me=he[3];return Object(o.useFrame)((function(){if(null!=Y&&Y.current){Y.current.visible=!1;var e=H.xr.enabled,t=H.shadowMap.autoUpdate;Ie(),H.xr.enabled=!1,H.shadowMap.autoUpdate=!1,H.setRenderTarget(Ce),H.state.buffers.depth.setMask(!0),H.autoClear||H.clear(),H.render(L,de),N&&pe.render(H,Ce,fe),H.xr.enabled=e,H.shadowMap.autoUpdate=t,Y.current.visible=!0,H.setRenderTarget(null)}})),i.createElement("mesh",Object(m.a)({ref:Object(b.default)([Y,t])},X),i.createElement("planeBufferGeometry",{args:h}),x?x("meshReflectorMaterial",me):i.createElement("meshReflectorMaterial",me))})),gu=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){return Object(E.a)(this,n),t.call(this,{uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new g.Vector3(0,0,0)},lightColor:{value:new g.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new g.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform vec3 spotPosition;\n      uniform float attenuation;      \n\n      void main() {\n        // compute intensity\n        vNormal = normalize( normalMatrix * normal );\n        vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n        vec4 viewPosition = viewMatrix * worldPosition;\n        vViewZ = viewPosition.z;\n        float intensity\t= distance(worldPosition.xyz, spotPosition) / attenuation;\n        intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\n        vIntensity = intensity;        \n        // set gl_Position\n        gl_Position\t= projectionMatrix * viewPosition;\n\n      }",fragmentShader:"\n      #include <packing>\n\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      uniform vec3 lightColor;\n      uniform vec3 spotPosition;\n      uniform float attenuation;\n      uniform float anglePower;\n      uniform sampler2D depth;\n      uniform vec2 resolution;\n      uniform float cameraNear;\n      uniform float cameraFar;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform float opacity;\n\n      float readDepth( sampler2D depthSampler, vec2 coord ) {\n        float fragCoordZ = texture2D( depthSampler, coord ).x;\n        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n        return viewZ;\n      }\n\n      void main() {\n        float d = 1.0;\n        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n        if (isSoft) {\n          vec2 sUv = gl_FragCoord.xy / resolution;\n          d = readDepth(depth, sUv);\n        }\n        float intensity = vIntensity;\n        vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n        float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\n        intensity\t*= angleIntensity;\n        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n        if (isSoft) {\n          intensity\t*= smoothstep(0., 1., vViewZ - d);\n        }\n        gl_FragColor = vec4(lightColor, intensity * opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}return Object(W.a)(n)}(g.ShaderMaterial),du=["opacity","radiusTop","radiusBottom","depthBuffer","color","distance","angle","attenuation","anglePower"],Iu=new g.Vector3,Au=i.forwardRef((function(e,t){var n=e.opacity,r=void 0===n?1:n,a=e.radiusTop,s=e.radiusBottom,c=e.depthBuffer,u=e.color,d=void 0===u?"white":u,I=e.distance,A=void 0===I?5:I,h=e.angle,C=void 0===h?.15:h,f=e.attenuation,v=void 0===f?5:f,b=e.anglePower,y=void 0===b?5:b,B=Object(p.a)(e,du),G=i.useRef(null),w=Object(o.useThree)((function(e){return e.size})),_=Object(o.useThree)((function(e){return e.camera})),Z=Object(o.useThree)((function(e){return e.viewport.dpr})),S=i.useState((function(){return new gu})),x=Object(l.a)(S,1)[0];a=void 0===a?.1:a,s=void 0===s?7*C:s,Object(o.useFrame)((function(){x.uniforms.spotPosition.value.copy(G.current.getWorldPosition(Iu)),G.current.lookAt(G.current.parent.target.getWorldPosition(Iu))}));var R=i.useMemo((function(){var e=new g.CylinderGeometry(a,s,A,128,64,!0);return e.applyMatrix4((new g.Matrix4).makeTranslation(0,-A/2,0)),e.applyMatrix4((new g.Matrix4).makeRotationX(-Math.PI/2)),e}),[C,A,a,s]);return i.createElement("spotLight",Object(m.a)({ref:t,angle:C,color:d,distance:A},B),i.createElement("mesh",{ref:G,geometry:R,raycast:function(){return null}},i.createElement("primitive",{object:x,attach:"material","uniforms-opacity-value":r,"uniforms-lightColor-value":d,"uniforms-attenuation-value":v,"uniforms-anglePower-value":y,"uniforms-depth-value":c,"uniforms-cameraNear-value":_.near,"uniforms-cameraFar-value":_.far,"uniforms-resolution-value":c?[w.width*Z,w.height*Z]:[0,0]})))})),hu=["args","map","toneMapped","color","form","intensity","scale","target","children"],Cu=i.forwardRef((function(e,t){var n=e.args,r=e.map,s=e.toneMapped,c=void 0!==s&&s,u=e.color,l=void 0===u?"white":u,d=e.form,I=void 0===d?"rect":d,A=e.intensity,h=void 0===A?1:A,C=e.scale,f=void 0===C?1:C,v=e.target,y=e.children,B=Object(p.a)(e,hu),G=i.useRef(null);return i.useLayoutEffect((function(){y||B.material||(Object(o.applyProps)(G.current.material,{color:l}),G.current.material.color.multiplyScalar(h))}),[l,h,y,B.material]),i.useLayoutEffect((function(){v&&G.current.lookAt(Array.isArray(v)?Object(se.a)(g.Vector3,Object(a.a)(v)):v)}),[v]),f=Array.isArray(f)&&2===f.length?[f[0],f[1],1]:f,i.createElement("mesh",Object(m.a)({ref:Object(b.default)([G,t]),scale:f},B),"circle"===I?i.createElement("ringGeometry",{args:[0,1,64]}):"ring"===I?i.createElement("ringGeometry",{args:[.5,1,64]}):"rect"===I?i.createElement("planeGeometry",null):i.createElement(I,{args:n}),y||(B.material?null:i.createElement("meshBasicMaterial",{toneMapped:c,map:r,side:g.DoubleSide})))})),fu=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){return Object(E.a)(this,n),t.call(this,new g.BoxGeometry(1,1,1),n.material)}return Object(W.a)(n)}(g.Mesh);Object(D.a)(fu,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new g.Vector3},up:{value:new g.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( direction, vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join("\n")}),Object(D.a)(fu,"material",new g.ShaderMaterial({name:"SkyShader",fragmentShader:fu.SkyShader.fragmentShader,vertexShader:fu.SkyShader.vertexShader,uniforms:g.UniformsUtils.clone(fu.SkyShader.uniforms),side:g.BackSide,depthWrite:!1}));var pu=["inclination","azimuth","distance","mieCoefficient","mieDirectionalG","rayleigh","turbidity","sunPosition"];function mu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new g.Vector3,r=Math.PI*(e-.5),a=2*Math.PI*(t-.5);return n.x=Math.cos(a),n.y=Math.sin(r),n.z=Math.sin(a),n}var vu=i.forwardRef((function(e,t){var n=e.inclination,r=void 0===n?.6:n,a=e.azimuth,o=void 0===a?.1:a,s=e.distance,c=void 0===s?1e3:s,u=e.mieCoefficient,d=void 0===u?.005:u,I=e.mieDirectionalG,A=void 0===I?.8:I,h=e.rayleigh,C=void 0===h?.5:h,f=e.turbidity,v=void 0===f?10:f,b=e.sunPosition,y=void 0===b?mu(r,o):b,B=Object(p.a)(e,pu),G=i.useMemo((function(){return(new g.Vector3).setScalar(c)}),[c]),w=i.useState((function(){return new fu})),_=Object(l.a)(w,1)[0];return i.createElement("primitive",Object(m.a)({dispose:void 0,object:_,ref:t,"material-uniforms-mieCoefficient-value":d,"material-uniforms-mieDirectionalG-value":A,"material-uniforms-rayleigh-value":C,"material-uniforms-sunPosition-value":y,"material-uniforms-turbidity-value":v,scale:G},B))})),bu=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){return Object(E.a)(this,n),t.call(this,{uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}return Object(W.a)(n)}(g.ShaderMaterial),yu=function(e){return(new g.Vector3).setFromSpherical(new g.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI))},Bu=i.forwardRef((function(e,t){var n=e.radius,r=void 0===n?100:n,s=e.depth,c=void 0===s?50:s,u=e.count,d=void 0===u?5e3:u,I=e.saturation,A=void 0===I?0:I,h=e.factor,C=void 0===h?4:h,f=e.fade,p=void 0!==f&&f,m=i.useRef(),v=i.useMemo((function(){for(var e=[],t=[],n=Array.from({length:d},(function(){return(.5+.5*Math.random())*C})),i=new g.Color,o=r+c,s=c/d,u=0;u<d;u++)o-=s*Math.random(),e.push.apply(e,Object(a.a)(yu(o).toArray())),i.setHSL(u/d,A,.9),t.push(i.r,i.g,i.b);return[new Float32Array(e),new Float32Array(t),new Float32Array(n)]}),[d,c,C,r,A]),b=Object(l.a)(v,3),y=b[0],B=b[1],G=b[2];Object(o.useFrame)((function(e){return m.current&&(m.current.uniforms.time.value=e.clock.getElapsedTime())}));var w=i.useState((function(){return new bu})),_=Object(l.a)(w,1)[0];return i.createElement("points",{ref:t},i.createElement("bufferGeometry",{attach:"geometry"},i.createElement("bufferAttribute",{attachObject:["attributes","position"],args:[y,3]}),i.createElement("bufferAttribute",{attachObject:["attributes","color"],args:[B,3]}),i.createElement("bufferAttribute",{attachObject:["attributes","size"],args:[G,1]})),i.createElement("primitive",{dispose:void 0,ref:m,object:_,attach:"material",blending:g.AdditiveBlending,"uniforms-fade-value":p,transparent:!0,vertexColors:!0}))})),Gu=["opacity","speed","width","depth","segments","texture","color","depthTest"];function wu(e){var t=e.opacity,n=void 0===t?.5:t,r=e.speed,s=void 0===r?.4:r,c=e.width,u=void 0===c?10:c,l=e.depth,g=void 0===l?1.5:l,d=e.segments,I=void 0===d?20:d,A=e.texture,h=void 0===A?"https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png":A,C=e.color,f=void 0===C?"#ffffff":C,m=e.depthTest,v=void 0===m||m,b=Object(p.a)(e,Gu),y=i.useRef(),B=bt(h),G=i.useMemo((function(){return Object(a.a)(new Array(I)).map((function(e,t){return{x:u/2-Math.random()*u,y:u/2-Math.random()*u,scale:.4+Math.sin((t+1)/I*Math.PI)*(10*(.2+Math.random())),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*s}}))}),[u,I,s]);return Object(o.useFrame)((function(e){var t;return null==(t=y.current)?void 0:t.children.forEach((function(t,n){t.children[0].rotation.z+=G[n].rotation,t.children[0].scale.setScalar(G[n].scale+(1+Math.sin(e.clock.getElapsedTime()/10))/2*n/10)}))})),i.createElement("group",b,i.createElement("group",{position:[0,0,I/2*g],ref:y},G.map((function(e,t){var r=e.x,a=e.y,o=e.scale,s=e.density;return i.createElement(T,{key:t,position:[r,a,-t*g]},i.createElement(Cc,{scale:o,rotation:[0,0,0]},i.createElement("meshStandardMaterial",{map:B,transparent:!0,opacity:o/6*s*n,depthTest:v,color:f})))}))))}function _u(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}var Zu="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",Su="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function xu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=nt((function(){return fetch(Zu).then((function(e){return e.json()}))}),["matcapList"]),r=n[0],a=i.useMemo((function(){return Object.keys(n).length}),[]),o=i.useMemo((function(){return"string"===typeof e?e:"number"===typeof e?n[e]:null}),[e]),s="".concat(o||r).concat(_u(t),".png"),c="".concat(Su,"/").concat(t,"/").concat(s),u=bt(c);return[u,c,a]}var Ru="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",Mu="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function ku(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.repeat,r=void 0===n?[1,1]:n,a=t.anisotropy,o=void 0===a?1:a,s=t.offset,c=void 0===s?[0,0]:s,u=nt((function(){return fetch(Mu).then((function(e){return e.json()}))}),["normalsList"]),l=i.useMemo((function(){return Object.keys(u).length}),[]),d=u[0],I=u[e]||d,A="".concat(Ru,"/normals/").concat(I),h=bt(A);return i.useLayoutEffect((function(){h&&(h.wrapS=h.wrapT=g.RepeatWrapping,h.repeat=new g.Vector2(r[0],r[1]),h.offset=new g.Vector2(c[0],c[1]),h.anisotropy=o)}),[h,o,r,c]),[h,A,l]}var Eu,Wu,Vu=new g.Matrix4,Fu=new g.Matrix4,Xu=[],Hu=new g.Mesh,Ou=function(e){Object(K.a)(n,e);var t=Object(j.a)(n);function n(){var e;return Object(E.a)(this,n),(e=t.call(this)).color=new g.Color("white"),e.instance={current:void 0},e.instanceKey={current:void 0},e}return Object(W.a)(n,[{key:"geometry",get:function(){var e;return null==(e=this.instance.current)?void 0:e.geometry}},{key:"raycast",value:function(e,t){var n=this.instance.current;if(n&&n.geometry&&n.material){Hu.geometry=n.geometry;var r=n.matrixWorld,a=n.userData.instances.indexOf(this.instanceKey);if(!(-1===a||a>n.count)){n.getMatrixAt(a,Vu),Fu.multiplyMatrices(r,Vu),Hu.matrixWorld=Fu,Hu.raycast(e,Xu);for(var i=0,o=Xu.length;i<o;i++){var s=Xu[i];s.instanceId=a,s.object=this,t.push(s)}Xu.length=0}}}}]),n}(g.Group),Lu=["children","range","limit"],Nu=["children"],Yu=["children","positions","colors","sizes","stride"],Tu=i.createContext(null),zu=new g.Matrix4,Ku=new g.Vector3;new g.Color;var ju=i.forwardRef((function(e,t){var n=e.children,r=e.range,s=e.limit,c=void 0===s?1e3:s,d=Object(p.a)(e,Lu),I=i.useRef(null),A=i.useState([]),h=Object(l.a)(A,2),C=h[0],f=h[1],v=i.useState((function(){return[new Float32Array(3*c),Float32Array.from({length:3*c},(function(){return 1})),Float32Array.from({length:c},(function(){return 1}))]})),y=Object(l.a)(v,1),B=Object(l.a)(y[0],3),G=B[0],w=B[1],_=B[2];i.useLayoutEffect((function(){I.current.geometry.drawRange.count=Math.min(c,void 0!==r?r:c,C.length)}),[C,r]),i.useEffect((function(){I.current.geometry.attributes.position.needsUpdate=!0})),Object(o.useFrame)((function(){for(I.current.updateMatrix(),I.current.updateMatrixWorld(),zu.copy(I.current.matrixWorld).invert(),Eu=0;Eu<C.length;Eu++)Wu=C[Eu].current,Ku.toArray(G,3*Eu),I.current.geometry.attributes.position.needsUpdate=!0,Wu.matrixWorldNeedsUpdate=!0,Wu.color.toArray(w,3*Eu),I.current.geometry.attributes.color.needsUpdate=!0,_.set([Wu.size],Eu),I.current.geometry.attributes.size.needsUpdate=!0}));var Z=i.useMemo((function(){var e={};for(Eu=0;Eu<C.length;Eu++){var t;Object.assign(e,null==(t=C[Eu].current)?void 0:t.__r3f.handlers)}return Object.keys(e).reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),{},Object(D.a)({},t,(function(e){var n,r,a,i=null==(n=C[e.index])?void 0:n.current;return null==i||null==(r=i.__r3f)||null==(a=r.handlers)?void 0:a[t](Object(u.a)(Object(u.a)({},e),{},{object:i}))})))}),{})}),[n,C]),S=i.useMemo((function(){return{subscribe:function(e){return f((function(t){return[].concat(Object(a.a)(t),[e])})),function(){return f((function(t){return t.filter((function(t){return t.current!==e.current}))}))}}}}),[]);return i.createElement("points",Object(m.a)({matrixAutoUpdate:!1,ref:Object(b.default)([t,I])},Z,d),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attachObject:["attributes","position"],count:G.length/3,array:G,itemSize:3,usage:g.DynamicDrawUsage}),i.createElement("bufferAttribute",{attachObject:["attributes","color"],count:w.length/3,array:w,itemSize:3,usage:g.DynamicDrawUsage}),i.createElement("bufferAttribute",{attachObject:["attributes","size"],count:_.length,array:_,itemSize:1,usage:g.DynamicDrawUsage})),i.createElement(Tu.Provider,{value:S},n))})),Du=i.forwardRef((function(e,t){var n=e.children,r=Object(p.a)(e,Nu);i.useMemo((function(){return Object(o.extend)({Position:Ou})}),[]);var a=i.useRef(),s=i.useContext(Tu).subscribe;return i.useLayoutEffect((function(){return s(a)}),[]),i.createElement("position",Object(m.a)({ref:Object(b.default)([t,a])},r),n)})),Uu=i.forwardRef((function(e,t){var n=e.children,r=e.positions,a=e.colors,s=e.sizes,c=e.stride,u=void 0===c?3:c,l=Object(p.a)(e,Yu),d=i.useRef(null);return Object(o.useFrame)((function(){var e=d.current.geometry.attributes;e.position.needsUpdate=!0,a&&(e.color.needsUpdate=!0),s&&(e.size.needsUpdate=!0)})),i.createElement("points",Object(m.a)({ref:Object(b.default)([t,d])},l),i.createElement("bufferGeometry",null,i.createElement("bufferAttribute",{attachObject:["attributes","position"],count:r.length/u,array:r,itemSize:u,usage:g.DynamicDrawUsage}),a&&i.createElement("bufferAttribute",{attachObject:["attributes","color"],count:a.length/u,array:a,itemSize:3,usage:g.DynamicDrawUsage}),s&&i.createElement("bufferAttribute",{attachObject:["attributes","size"],count:s.length/u,array:s,itemSize:1,usage:g.DynamicDrawUsage})),n)})),Qu=i.forwardRef((function(e,t){return e.positions instanceof Float32Array?i.createElement(Uu,Object(m.a)({},e,{ref:t})):i.createElement(ju,Object(m.a)({},e,{ref:t}))})),Pu=n(49),Ju=n.n(Pu);function qu(e){return $u(e.children,e.components)}function $u(e,t,n){if(n=n||[],!t[0])return e(n);function r(r){return $u(e,t.slice(1),n.concat([r]))}return"function"===typeof t[0]?t[0]({results:n,render:r}):Object(i.cloneElement)(t[0],{children:r})}qu.propTypes={children:Ju.a.func.isRequired,components:Ju.a.arrayOf(Ju.a.oneOfType([Ju.a.element,Ju.a.func])).isRequired};var el,tl,nl=["context","children"],rl=["children","range","limit","frames"],al=["meshes","children"],il=i.createContext(null),ol=new g.Matrix4,sl=new g.Matrix4,cl=new g.Matrix4;new g.Color;var ul=new g.Vector3,ll=new g.Quaternion,gl=new g.Vector3,dl=i.forwardRef((function(e,t){var n=e.context,r=e.children,a=Object(p.a)(e,nl);i.useMemo((function(){return Object(o.extend)({Position:Ou})}),[]);var s=i.useRef(),c=i.useContext(n||il),u=c.subscribe,l=c.getParent;return i.useLayoutEffect((function(){return u(s)}),[]),i.createElement("position",Object(m.a)({instance:l(),instanceKey:s,ref:Object(b.default)([t,s])},a),r)})),Il=i.forwardRef((function(e,t){var n=e.children,r=e.range,s=e.limit,c=void 0===s?1e3:s,u=e.frames,d=void 0===u?1/0:u,I=Object(p.a)(e,rl),A=i.useState((function(){var e=i.createContext(null);return{context:e,instance:i.forwardRef((function(t,n){return i.createElement(dl,Object(m.a)({context:e},t,{ref:n}))}))}})),h=Object(l.a)(A,1)[0],C=h.context,f=h.instance,v=i.useRef(null),y=i.useState([]),B=Object(l.a)(y,2),G=B[0],w=B[1],_=i.useState((function(){var e=new Float32Array(16*c);for(el=0;el<c;el++)cl.identity().toArray(e,16*el);return[e,new Float32Array(Object(a.a)(new Array(3*c)).map((function(){return 1})))]})),Z=Object(l.a)(_,1),S=Object(l.a)(Z[0],2),x=S[0],R=S[1];i.useLayoutEffect((function(){v.current.count=v.current.instanceMatrix.updateRange.count=v.current.instanceColor.updateRange.count=Math.min(c,void 0!==r?r:c,G.length)}),[G,r]),i.useEffect((function(){v.current.instanceMatrix.needsUpdate=!0}));var M=0;Object(o.useFrame)((function(){if(d===1/0||M<d){for(v.current.updateMatrix(),v.current.updateMatrixWorld(),ol.copy(v.current.matrixWorld).invert(),el=0;el<G.length;el++)(tl=G[el].current).matrixWorld.decompose(ul,ll,gl),sl.compose(ul,ll,gl).premultiply(ol),sl.toArray(x,16*el),v.current.instanceMatrix.needsUpdate=!0,tl.color.toArray(R,3*el),v.current.instanceColor.needsUpdate=!0;M++}}));var k=i.useMemo((function(){return{getParent:function(){return v},subscribe:function(e){return w((function(t){return[].concat(Object(a.a)(t),[e])})),function(){return w((function(t){return t.filter((function(t){return t.current!==e.current}))}))}}}}),[]);return i.createElement("instancedMesh",Object(m.a)({userData:{instances:G},matrixAutoUpdate:!1,ref:Object(b.default)([t,v]),args:[null,null,0],raycast:function(){return null}},I),i.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:x.length/16,array:x,itemSize:16,usage:g.DynamicDrawUsage}),i.createElement("instancedBufferAttribute",{attach:"instanceColor",count:R.length/3,array:R,itemSize:3,usage:g.DynamicDrawUsage}),"function"===typeof n?i.createElement(C.Provider,{value:k},n(f)):i.createElement(il.Provider,{value:k},n))}));function Al(e){var t=e.meshes,n=e.children,r=Object(p.a)(e,al),o=Array.isArray(t);if(!o)for(var s=0,c=Object.keys(t);s<c.length;s++){var l=c[s];t[l].isMesh||delete t[l]}return i.createElement(qu,{components:(o?t:Object.values(t)).map((function(e){var t=e.geometry,n=e.material;return i.createElement(Il,Object(m.a)({key:t.uuid,geometry:t,material:n},r))}))},(function(e){return o?n.apply(void 0,Object(a.a)(e)):n(Object.keys(t).filter((function(e){return t[e].isMesh})).reduce((function(t,n,r){return Object(u.a)(Object(u.a)({},t),{},Object(D.a)({},n,e[r]))}),{}))}))}var hl=["limit","lineWidth","children"],Cl=i.createContext(null),fl=function(e){return e instanceof g.Vector3?e.toArray():e},pl=i.forwardRef((function(e,t){var n=e.limit,r=void 0===n?1e3:n,s=e.lineWidth,c=void 0===s?1:s,u=e.children,d=Object(p.a)(e,hl),I=i.useState([]),A=Object(l.a)(I,2),h=A[0],C=A[1],f=i.useState((function(){return new te})),v=Object(l.a)(f,1)[0],b=i.useState((function(){return new P})),y=Object(l.a)(b,1)[0],B=i.useState((function(){return new U})),G=Object(l.a)(B,1)[0],w=i.useState((function(){return new g.Vector2(512,512)})),_=Object(l.a)(w,1)[0],Z=i.useState((function(){return Array(6*r).fill(0)})),S=Object(l.a)(Z,1)[0],x=i.useState((function(){return Array(6*r).fill(0)})),R=Object(l.a)(x,1)[0],M=i.useMemo((function(){return{subscribe:function(e){return C((function(t){return[].concat(Object(a.a)(t),[e])})),function(){return C((function(t){return t.filter((function(t){return t.current!==e.current}))}))}}}}),[]);return Object(o.useFrame)((function(){for(var e=0;e<r;e++)for(var t,n=null==(t=h[e])?void 0:t.current,a=n?fl(n.start):[0,0,0],i=n?fl(n.end):[0,0,0],o=n?(c=n.color)instanceof g.Color?c.toArray():c:[1,1,1],s=0;s<3;s++)S[6*e+s]=a[s],S[6*e+s+3]=i[s],R[6*e+s]=o[s],R[6*e+s+3]=o[s];var c;G.setColors(R),G.setPositions(S),v.computeLineDistances()})),i.createElement("primitive",{object:v,ref:t},i.createElement("primitive",{object:G,attach:"geometry"}),i.createElement("primitive",Object(m.a)({object:y,attach:"material",vertexColors:!0,resolution:_,linewidth:c},d)),i.createElement(Cl.Provider,{value:M},u))})),ml=Object(W.a)((function e(){Object(E.a)(this,e),this.color=new g.Color("white"),this.start=new g.Vector3(0,0,0),this.end=new g.Vector3(0,0,0)})),vl=i.forwardRef((function(e,t){var n=i.useContext(Cl);if(!n)throw"Segment must used inside Segments component.";var r=i.useRef();return i.useMemo((function(){return Object(o.extend)({SegmentObject:ml})}),[]),i.useLayoutEffect((function(){return n.subscribe(r)}),[]),i.createElement("segmentObject",Object(m.a)({ref:Object(b.default)([r,t])},e))})),bl=["children","distances"],yl=i.forwardRef((function(e,t){var n=e.children,r=e.distances,a=Object(p.a)(e,bl),s=i.useRef(null);return i.useLayoutEffect((function(){var e=s.current;e.levels.length=0,e.children.forEach((function(t,n){return e.levels.push({object:t,distance:r[n]})}))})),Object(o.useFrame)((function(e){var t;return null==(t=s.current)?void 0:t.update(e.camera)})),i.createElement("lOD",Object(m.a)({ref:Object(b.default)([s,t])},a),n)}));function Bl(e){var t=e.all,n=e.scene,r=e.camera,a=Object(o.useThree)((function(e){return e.gl})),s=Object(o.useThree)((function(e){return e.camera})),c=Object(o.useThree)((function(e){return e.scene}));return i.useLayoutEffect((function(){var e=[];t&&(n||c).traverse((function(t){!1===t.visible&&(e.push(t),t.visible=!0)})),a.compile(n||c,r||s);var i=new g.WebGLCubeRenderTarget(128);new g.CubeCamera(.01,1e5,i).update(a,n||c),i.dispose(),e.forEach((function(e){return e.visible=!1}))}),[]),null}function Gl(){var e=Object(o.useThree)((function(e){return e.gl}));return Object(i.useEffect)((function(){return e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,function(){e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0}}),[e.shadowMap]),null}var wl=new g.Matrix4,_l=new g.Ray,Zl=new g.Sphere,Sl=new g.Vector3;function xl(e,t){var n=this.geometry,r=this.material,a=this.matrixWorld;void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),Zl.copy(n.boundingSphere),Zl.applyMatrix4(a),!1!==e.ray.intersectsSphere(Zl)&&(wl.copy(a).invert(),_l.copy(e.ray).applyMatrix4(wl),null!==n.boundingBox&&null===_l.intersectBox(n.boundingBox,Sl)||t.push({distance:Sl.distanceTo(e.ray.origin),point:Sl.clone(),object:this})))}function Rl(e){var t=e.pixelated,n=Object(o.useThree)((function(e){return e.gl})),r=Object(o.useThree)((function(e){return e.internal.active})),a=Object(o.useThree)((function(e){return e.performance.current})),s=Object(o.useThree)((function(e){return e.viewport.initialDpr})),c=Object(o.useThree)((function(e){return e.setDpr}));return i.useEffect((function(){var e=n.domElement;return function(){r&&c(s),t&&e&&(e.style.imageRendering="auto")}}),[]),i.useEffect((function(){c(a*s),t&&n.domElement&&(n.domElement.style.imageRendering=1===a?"auto":"pixelated")}),[a]),null}function Ml(){var e=Object(o.useThree)((function(e){return e.get})),t=Object(o.useThree)((function(e){return e.performance.current}));return i.useEffect((function(){var t=e().raycaster.enabled;return function(){e().raycaster.enabled=t}}),[]),i.useEffect((function(){e().raycaster.enabled=1===t}),[t]),null}},function(e,t,n){"use strict";e.exports=function(e,t,n,r){try{try{var a;try{a=new window.Blob([e])}catch(c){(a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),a=a.getBlob()}var i=window.URL||window.webkitURL,o=i.createObjectURL(a),s=new window[t](o,n);return i.revokeObjectURL(o),s}catch(c){return new window[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(c){if(!r)throw Error("Inline worker is not supported");return new window[t](r,n)}}},function(e,t,n){"use strict";e.exports=n(168)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function a(e){var t,n=new Set,r=function(e,r){var a="function"===typeof e?e(t):e;if(a!==t){var i=t;t=r?a:Object.assign({},t,a),n.forEach((function(e){return e(t,i)}))}},a=function(){return t},i={setState:r,getState:a,subscribe:function(e,r,i){return r||i?function(e,r,i){void 0===r&&(r=a),void 0===i&&(i=Object.is),console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=r(t);function s(){var n=r(t);if(!i(o,n)){var a=o;e(o=n,a)}}return n.add(s),function(){return n.delete(s)}}(e,r,i):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,a,i),i}var i="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?r.useEffect:r.useLayoutEffect;t.default=function(e){var t="function"===typeof e?a(e):e,n=function(e,n){void 0===e&&(e=t.getState),void 0===n&&(n=Object.is);var a,o=r.useReducer((function(e){return e+1}),0)[1],s=t.getState(),c=r.useRef(s),u=r.useRef(e),l=r.useRef(n),g=r.useRef(!1),d=r.useRef();void 0===d.current&&(d.current=e(s));var I=!1;(c.current!==s||u.current!==e||l.current!==n||g.current)&&(a=e(s),I=!n(d.current,a)),i((function(){I&&(d.current=a),c.current=s,u.current=e,l.current=n,g.current=!1}));var A=r.useRef(s);i((function(){var e=function(){try{var e=t.getState(),n=u.current(e);l.current(d.current,n)||(c.current=e,d.current=n,o())}catch(r){g.current=!0,o()}},n=t.subscribe(e);return t.getState()!==A.current&&e(),n}),[]);var h=I?a:d.current;return r.useDebugValue(h),h};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function a(e){var t,n=new Set,r=function(e,r){var a="function"===typeof e?e(t):e;if(a!==t){var i=t;t=r?a:Object.assign({},t,a),n.forEach((function(e){return e(t,i)}))}},a=function(){return t},i={setState:r,getState:a,subscribe:function(e,r,i){return r||i?function(e,r,i){void 0===r&&(r=a),void 0===i&&(i=Object.is),console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=r(t);function s(){var n=r(t);if(!i(o,n)){var a=o;e(o=n,a)}}return n.add(s),function(){return n.delete(s)}}(e,r,i):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,a,i),i}var i="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?r.useEffect:r.useLayoutEffect;t.default=function(e){var t="function"===typeof e?a(e):e,n=function(e,n){void 0===e&&(e=t.getState),void 0===n&&(n=Object.is);var a,o=r.useReducer((function(e){return e+1}),0)[1],s=t.getState(),c=r.useRef(s),u=r.useRef(e),l=r.useRef(n),g=r.useRef(!1),d=r.useRef();void 0===d.current&&(d.current=e(s));var I=!1;(c.current!==s||u.current!==e||l.current!==n||g.current)&&(a=e(s),I=!n(d.current,a)),i((function(){I&&(d.current=a),c.current=s,u.current=e,l.current=n,g.current=!1}));var A=r.useRef(s);i((function(){var e=function(){try{var e=t.getState(),n=u.current(e);l.current(d.current,n)||(c.current=e,d.current=n,o())}catch(r){g.current=!0,o()}},n=t.subscribe(e);return t.getState()!==A.current&&e(),n}),[]);var h=I?a:d.current;return r.useDebugValue(h),h};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}},function(e,t,n){"use strict";n.d(t,"useGesture",(function(){return u}));var r=n(27),a=n(1),i=n.n(a),o=n(77);n(94),n(95);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=i.a.useMemo((function(){return new o.a(e)}),[]);if(a.applyHandlers(e,r),a.applyConfig(t,n),i.a.useEffect(a.effect.bind(a)),i.a.useEffect((function(){return a.clean.bind(a)}),[]),void 0===t.target)return a.bind.bind(a)}function c(e){return e.forEach(r.e),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(o.b)(e,t),r=n.handlers,a=n.nativeHandlers,i=n.config;return s(r,i,void 0,a)}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=c([r.a,r.d,r.f,r.g,r.c,r.b]);return n(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(var r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!Object.is(e[n[r]],t[n[r]]))return!1;return!0}},function(e,t,n){(function(t){var n="__lodash_hash_undefined__",r=9007199254740991,a="[object Symbol]",i=/^\[object .+?Constructor\]$/,o=/^(?:0|[1-9]\d*)$/,s="object"==typeof t&&t&&t.Object===Object&&t,c="object"==typeof self&&self&&self.Object===Object&&self,u=s||c||Function("return this")();function l(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function g(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!==t)return function(e,t,n,r){var a=e.length,i=n+(r?1:-1);for(;r?i--:++i<a;)if(t(e[i],i,e))return i;return-1}(e,h,n);var r=n-1,a=e.length;for(;++r<a;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function d(e,t,n){for(var r=-1,a=e?e.length:0;++r<a;)if(n(t,e[r]))return!0;return!1}function I(e,t){for(var n=-1,r=e?e.length:0,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}function A(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e}function h(e){return e!==e}function C(e,t){return e.has(t)}function f(e,t){return function(n){return e(t(n))}}var p=Array.prototype,m=Function.prototype,v=Object.prototype,b=u["__core-js_shared__"],y=function(){var e=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),B=m.toString,G=v.hasOwnProperty,w=v.toString,_=RegExp("^"+B.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Z=u.Symbol,S=f(Object.getPrototypeOf,Object),x=v.propertyIsEnumerable,R=p.splice,M=Z?Z.isConcatSpreadable:void 0,k=Object.getOwnPropertySymbols,E=Math.max,W=D(u,"Map"),V=D(Object,"create");function F(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function X(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function H(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function O(e){var t=-1,n=e?e.length:0;for(this.__data__=new H;++t<n;)this.add(e[t])}function L(e,t){var n=ee(e)||$(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,a=!!r;for(var i in e)!t&&!G.call(e,i)||a&&("length"==i||J(i,r))||n.push(i);return n}function N(e,t){for(var n,r,a=e.length;a--;)if((n=e[a][0])===(r=t)||n!==n&&r!==r)return a;return-1}function Y(e,t,n,r,a){var i=-1,o=e.length;for(n||(n=P),a||(a=[]);++i<o;){var s=e[i];t>0&&n(s)?t>1?Y(s,t-1,n,r,a):A(a,s):r||(a[a.length]=s)}return a}function T(e){if(!re(e)||(t=e,y&&y in t))return!1;var t,n=ne(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?_:i;return n.test(function(e){if(null!=e){try{return B.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}function z(e){if(!re(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=function(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||v;return e===n}(e),n=[];for(var r in e)("constructor"!=r||!t&&G.call(e,r))&&n.push(r);return n}function K(e){return function(e,t,n){var r=t(e);return ee(e)?r:A(r,n(e))}(e,ie,Q)}function j(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function D(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return T(n)?n:void 0}F.prototype.clear=function(){this.__data__=V?V(null):{}},F.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},F.prototype.get=function(e){var t=this.__data__;if(V){var r=t[e];return r===n?void 0:r}return G.call(t,e)?t[e]:void 0},F.prototype.has=function(e){var t=this.__data__;return V?void 0!==t[e]:G.call(t,e)},F.prototype.set=function(e,t){return this.__data__[e]=V&&void 0===t?n:t,this},X.prototype.clear=function(){this.__data__=[]},X.prototype.delete=function(e){var t=this.__data__,n=N(t,e);return!(n<0)&&(n==t.length-1?t.pop():R.call(t,n,1),!0)},X.prototype.get=function(e){var t=this.__data__,n=N(t,e);return n<0?void 0:t[n][1]},X.prototype.has=function(e){return N(this.__data__,e)>-1},X.prototype.set=function(e,t){var n=this.__data__,r=N(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},H.prototype.clear=function(){this.__data__={hash:new F,map:new(W||X),string:new F}},H.prototype.delete=function(e){return j(this,e).delete(e)},H.prototype.get=function(e){return j(this,e).get(e)},H.prototype.has=function(e){return j(this,e).has(e)},H.prototype.set=function(e,t){return j(this,e).set(e,t),this},O.prototype.add=O.prototype.push=function(e){return this.__data__.set(e,n),this},O.prototype.has=function(e){return this.__data__.has(e)};var U=k?f(k,Object):ue,Q=k?function(e){for(var t=[];e;)A(t,U(e)),e=S(e);return t}:ue;function P(e){return ee(e)||$(e)||!!(M&&e&&e[M])}function J(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||o.test(e))&&e>-1&&e%1==0&&e<t}function q(e){if("string"==typeof e||function(e){return"symbol"==typeof e||ae(e)&&w.call(e)==a}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function $(e){return function(e){return ae(e)&&te(e)}(e)&&G.call(e,"callee")&&(!x.call(e,"callee")||"[object Arguments]"==w.call(e))}var ee=Array.isArray;function te(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!ne(e)}function ne(e){var t=re(e)?w.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function re(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ae(e){return!!e&&"object"==typeof e}function ie(e){return te(e)?L(e,!0):z(e)}var oe,se,ce=(oe=function(e,t){return null==e?{}:(t=I(Y(t,1),q),function(e,t){return function(e,t,n){for(var r=-1,a=t.length,i={};++r<a;){var o=t[r],s=e[o];n(s,o)&&(i[o]=s)}return i}(e=Object(e),t,(function(t,n){return n in e}))}(e,function(e,t,n,r){var a,i=-1,o=g,s=!0,c=e.length,u=[],l=t.length;if(!c)return u;n&&(t=I(t,(a=n,function(e){return a(e)}))),r?(o=d,s=!1):t.length>=200&&(o=C,s=!1,t=new O(t));e:for(;++i<c;){var A=e[i],h=n?n(A):A;if(A=r||0!==A?A:0,s&&h===h){for(var f=l;f--;)if(t[f]===h)continue e;u.push(A)}else o(t,h,r)||u.push(A)}return u}(K(e),t)))},se=E(void 0===se?oe.length-1:se,0),function(){for(var e=arguments,t=-1,n=E(e.length-se,0),r=Array(n);++t<n;)r[t]=e[se+t];t=-1;for(var a=Array(se+1);++t<se;)a[t]=e[t];return a[se]=r,l(oe,this,a)});function ue(){return[]}e.exports=ce}).call(this,n(74))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r,a,i,o=n(4),s=n(5),c={env:{emscripten_notify_memory_growth:function(e){i=new Uint8Array(a.exports.memory.buffer)}}},u=function(){function t(){Object(o.a)(this,t)}return Object(s.a)(t,[{key:"init",value:function(){return r||(r="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+l).then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,c)})).then(this._init):WebAssembly.instantiate(e.from(l,"base64"),c).then(this._init))}},{key:"_init",value:function(e){a=e.instance,c.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!a)throw new Error("ZSTDDecoder: Await .init() before decoding.");var n=e.byteLength,r=a.exports.malloc(n);i.set(e,r),t=t||Number(a.exports.ZSTD_findDecompressedSize(r,n));var o=a.exports.malloc(t),s=a.exports.ZSTD_decompress(o,t,r,n),c=i.slice(o,o+s);return a.exports.free(r),a.exports.free(o),c}}]),t}(),l="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ"}).call(this,n(96).Buffer)},function(e,t,n){e.exports=function(){var e=function e(){function t(e){return a.appendChild(e.dom),e}function n(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";r=e}var r=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",(function(e){e.preventDefault(),n(++r%a.children.length)}),!1);var i=(performance||Date).now(),o=i,s=0,c=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:a,addPanel:t,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-i,200),e>o+1e3&&(c.update(1e3*s/(e-o),100),o=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:a,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,a=0,i=Math.round,o=i(window.devicePixelRatio||1),s=80*o,c=48*o,u=3*o,l=2*o,g=3*o,d=15*o,I=74*o,A=30*o,h=document.createElement("canvas");h.width=s,h.height=c,h.style.cssText="width:80px;height:48px";var C=h.getContext("2d");return C.font="bold "+9*o+"px Helvetica,Arial,sans-serif",C.textBaseline="top",C.fillStyle=n,C.fillRect(0,0,s,c),C.fillStyle=t,C.fillText(e,u,l),C.fillRect(g,d,I,A),C.fillStyle=n,C.globalAlpha=.9,C.fillRect(g,d,I,A),{dom:h,update:function(c,f){r=Math.min(r,c),a=Math.max(a,c),C.fillStyle=n,C.globalAlpha=1,C.fillRect(0,0,s,d),C.fillStyle=t,C.fillText(i(c)+" "+e+" ("+i(r)+"-"+i(a)+")",u,l),C.drawImage(h,g+o,d,I-o,A,g,d,I-o,A),C.fillRect(g+I-o,d,o,A),C.fillStyle=n,C.globalAlpha=.9,C.fillRect(g+I-o,d,o,i((1-c/f)*A))}}},e}()},function(e,t,n){"use strict";var r=n(58),a=60103,i=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,c=60112;t.Suspense=60113;var u=60115,l=60116;if("function"===typeof Symbol&&Symbol.for){var g=Symbol.for;a=g("react.element"),i=g("react.portal"),t.Fragment=g("react.fragment"),t.StrictMode=g("react.strict_mode"),t.Profiler=g("react.profiler"),o=g("react.provider"),s=g("react.context"),c=g("react.forward_ref"),t.Suspense=g("react.suspense"),u=g("react.memo"),l=g("react.lazy")}var d="function"===typeof Symbol&&Symbol.iterator;function I(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h={};function C(e,t,n){this.props=e,this.context=t,this.refs=h,this.updater=n||A}function f(){}function p(e,t,n){this.props=e,this.context=t,this.refs=h,this.updater=n||A}C.prototype.isReactComponent={},C.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(I(85));this.updater.enqueueSetState(this,e,t,"setState")},C.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},f.prototype=C.prototype;var m=p.prototype=new f;m.constructor=p,r(m,C.prototype),m.isPureReactComponent=!0;var v={current:null},b=Object.prototype.hasOwnProperty,y={key:!0,ref:!0,__self:!0,__source:!0};function B(e,t,n){var r,i={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)b.call(t,r)&&!y.hasOwnProperty(r)&&(i[r]=t[r]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===i[r]&&(i[r]=c[r]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:v.current}}function G(e){return"object"===typeof e&&null!==e&&e.$$typeof===a}var w=/\/+/g;function _(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function Z(e,t,n,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case a:case i:c=!0}}if(c)return o=o(c=e),e=""===r?"."+_(c,0):r,Array.isArray(o)?(n="",null!=e&&(n=e.replace(w,"$&/")+"/"),Z(o,t,n,"",(function(e){return e}))):null!=o&&(G(o)&&(o=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(w,"$&/")+"/")+e)),t.push(o)),1;if(c=0,r=""===r?".":r+":",Array.isArray(e))for(var u=0;u<e.length;u++){var l=r+_(s=e[u],u);c+=Z(s,t,n,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),u=0;!(s=e.next()).done;)c+=Z(s=s.value,t,n,l=r+_(s,u++),o);else if("object"===s)throw t=""+e,Error(I(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return c}function S(e,t,n){if(null==e)return e;var r=[],a=0;return Z(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function x(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var R={current:null};function M(){var e=R.current;if(null===e)throw Error(I(321));return e}var k={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:v,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:S,forEach:function(e,t,n){S(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return S(e,(function(){t++})),t},toArray:function(e){return S(e,(function(e){return e}))||[]},only:function(e){if(!G(e))throw Error(I(143));return e}},t.Component=C,t.PureComponent=p,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(I(267,e));var i=r({},e.props),o=e.key,s=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,c=v.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)b.call(t,l)&&!y.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){u=Array(l);for(var g=0;g<l;g++)u[g]=arguments[g+2];i.children=u}return{$$typeof:a,type:e.type,key:o,ref:s,props:i,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=B,t.createFactory=function(e){var t=B.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=G,t.lazy=function(e){return{$$typeof:l,_payload:{_status:-1,_result:e},_init:x}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return M().useCallback(e,t)},t.useContext=function(e,t){return M().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return M().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return M().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return M().useLayoutEffect(e,t)},t.useMemo=function(e,t){return M().useMemo(e,t)},t.useReducer=function(e,t,n){return M().useReducer(e,t,n)},t.useRef=function(e){return M().useRef(e)},t.useState=function(e){return M().useState(e)},t.version="17.0.2"},function(e,t,n){"use strict";var r=n(1),a=n(58),i=n(47);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var s=new Set,c={};function u(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(c[e]=t,e=0;e<t.length;e++)s.add(t[e])}var g=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I=Object.prototype.hasOwnProperty,A={},h={};function C(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){f[e]=new C(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];f[t]=new C(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){f[e]=new C(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){f[e]=new C(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){f[e]=new C(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){f[e]=new C(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){f[e]=new C(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){f[e]=new C(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){f[e]=new C(e,5,!1,e.toLowerCase(),null,!1,!1)}));var p=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function v(e,t,n,r){var a=f.hasOwnProperty(t)?f[t]:null;(null!==a?0===a.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!I.call(h,e)||!I.call(A,e)&&(d.test(e)?h[e]=!0:(A[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(p,m);f[t]=new C(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(p,m);f[t]=new C(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(p,m);f[t]=new C(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){f[e]=new C(e,1,!1,e.toLowerCase(),null,!1,!1)})),f.xlinkHref=new C("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){f[e]=new C(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,y=60103,B=60106,G=60107,w=60108,_=60114,Z=60109,S=60110,x=60112,R=60113,M=60120,k=60115,E=60116,W=60121,V=60128,F=60129,X=60130,H=60131;if("function"===typeof Symbol&&Symbol.for){var O=Symbol.for;y=O("react.element"),B=O("react.portal"),G=O("react.fragment"),w=O("react.strict_mode"),_=O("react.profiler"),Z=O("react.provider"),S=O("react.context"),x=O("react.forward_ref"),R=O("react.suspense"),M=O("react.suspense_list"),k=O("react.memo"),E=O("react.lazy"),W=O("react.block"),O("react.scope"),V=O("react.opaque.id"),F=O("react.debug_trace_mode"),X=O("react.offscreen"),H=O("react.legacy_hidden")}var L,N="function"===typeof Symbol&&Symbol.iterator;function Y(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=N&&e[N]||e["@@iterator"])?e:null}function T(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var z=!1;function K(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s])return"\n"+a[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?T(e):""}function j(e){switch(e.tag){case 5:return T(e.type);case 16:return T("Lazy");case 13:return T("Suspense");case 19:return T("SuspenseList");case 0:case 2:case 15:return e=K(e.type,!1);case 11:return e=K(e.type.render,!1);case 22:return e=K(e.type._render,!1);case 1:return e=K(e.type,!0);default:return""}}function D(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case G:return"Fragment";case B:return"Portal";case _:return"Profiler";case w:return"StrictMode";case R:return"Suspense";case M:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case S:return(e.displayName||"Context")+".Consumer";case Z:return(e._context.displayName||"Context")+".Provider";case x:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case k:return D(e.type);case W:return D(e._render);case E:t=e._payload,e=e._init;try{return D(e(t))}catch(n){}}return null}function U(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function P(e){e._valueTracker||(e._valueTracker=function(e){var t=Q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=U(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=U(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ae(e,t.type,n):t.hasOwnProperty("defaultValue")&&ae(e,t.type,U(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ae(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ie(e,t){return e=a({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+U(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ce(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:U(n)}}function ue(e,t){var n=U(t.value),r=U(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var ge="http://www.w3.org/1999/xhtml",de="http://www.w3.org/2000/svg";function Ie(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ae(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Ie(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var he,Ce,fe=(Ce=function(e,t){if(e.namespaceURI!==de||"innerHTML"in e)e.innerHTML=t;else{for((he=he||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=he.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return Ce(e,t)}))}:Ce);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ve=["Webkit","ms","Moz","O"];function be(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function ye(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=be(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(me).forEach((function(e){ve.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]}))}));var Be=a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ge(e,t){if(t){if(Be[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function we(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ze=null,Se=null,xe=null;function Re(e){if(e=ra(e)){if("function"!==typeof Ze)throw Error(o(280));var t=e.stateNode;t&&(t=ia(t),Ze(e.stateNode,e.type,t))}}function Me(e){Se?xe?xe.push(e):xe=[e]:Se=e}function ke(){if(Se){var e=Se,t=xe;if(xe=Se=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Ee(e,t){return e(t)}function We(e,t,n,r,a){return e(t,n,r,a)}function Ve(){}var Fe=Ee,Xe=!1,He=!1;function Oe(){null===Se&&null===xe||(Ve(),ke())}function Le(e,t){var n=e.stateNode;if(null===n)return null;var r=ia(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ne=!1;if(g)try{var Ye={};Object.defineProperty(Ye,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Ye,Ye),window.removeEventListener("test",Ye,Ye)}catch(Ce){Ne=!1}function Te(e,t,n,r,a,i,o,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(l){this.onError(l)}}var ze=!1,Ke=null,je=!1,De=null,Ue={onError:function(e){ze=!0,Ke=e}};function Qe(e,t,n,r,a,i,o,s,c){ze=!1,Ke=null,Te.apply(Ue,arguments)}function Pe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Pe(e)!==e)throw Error(o(188))}function $e(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=Pe(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return qe(a),e;if(i===r)return qe(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,c=a.child;c;){if(c===n){s=!0,n=a,r=i;break}if(c===r){s=!0,r=a,n=i;break}c=c.sibling}if(!s){for(c=i.child;c;){if(c===n){s=!0,n=i,r=a;break}if(c===r){s=!0,r=i,n=a;break}c=c.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,at,it=!1,ot=[],st=null,ct=null,ut=null,lt=new Map,gt=new Map,dt=[],It="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function At(e,t,n,r,a){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:a,targetContainers:[r]}}function ht(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":ct=null;break;case"mouseover":case"mouseout":ut=null;break;case"pointerover":case"pointerout":lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gt.delete(t.pointerId)}}function Ct(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e=At(t,n,r,a,i),null!==t&&(null!==(t=ra(t))&&nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function ft(e){var t=na(e.target);if(null!==t){var n=Pe(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void at(e.lanePriority,(function(){i.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ra(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function mt(e,t,n){pt(e)&&n.delete(t)}function vt(){for(it=!1;0<ot.length;){var e=ot[0];if(null!==e.blockedOn){null!==(e=ra(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&ot.shift()}null!==st&&pt(st)&&(st=null),null!==ct&&pt(ct)&&(ct=null),null!==ut&&pt(ut)&&(ut=null),lt.forEach(mt),gt.forEach(mt)}function bt(e,t){e.blockedOn===t&&(e.blockedOn=null,it||(it=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,vt)))}function yt(e){function t(t){return bt(t,e)}if(0<ot.length){bt(ot[0],e);for(var n=1;n<ot.length;n++){var r=ot[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==st&&bt(st,e),null!==ct&&bt(ct,e),null!==ut&&bt(ut,e),lt.forEach(t),gt.forEach(t),n=0;n<dt.length;n++)(r=dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<dt.length&&null===(n=dt[0]).blockedOn;)ft(n),null===n.blockedOn&&dt.shift()}function Bt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Gt={animationend:Bt("Animation","AnimationEnd"),animationiteration:Bt("Animation","AnimationIteration"),animationstart:Bt("Animation","AnimationStart"),transitionend:Bt("Transition","TransitionEnd")},wt={},_t={};function Zt(e){if(wt[e])return wt[e];if(!Gt[e])return e;var t,n=Gt[e];for(t in n)if(n.hasOwnProperty(t)&&t in _t)return wt[e]=n[t];return e}g&&(_t=document.createElement("div").style,"AnimationEvent"in window||(delete Gt.animationend.animation,delete Gt.animationiteration.animation,delete Gt.animationstart.animation),"TransitionEvent"in window||delete Gt.transitionend.transition);var St=Zt("animationend"),xt=Zt("animationiteration"),Rt=Zt("animationstart"),Mt=Zt("transitionend"),kt=new Map,Et=new Map,Wt=["abort","abort",St,"animationEnd",xt,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Mt,"transitionEnd","waiting","waiting"];function Vt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],a=e[n+1];a="on"+(a[0].toUpperCase()+a.slice(1)),Et.set(r,t),kt.set(r,a),u(a,[r])}}(0,i.unstable_now)();var Ft=8;function Xt(e){if(0!==(1&e))return Ft=15,1;if(0!==(2&e))return Ft=14,2;if(0!==(4&e))return Ft=13,4;var t=24&e;return 0!==t?(Ft=12,t):0!==(32&e)?(Ft=11,32):0!==(t=192&e)?(Ft=10,t):0!==(256&e)?(Ft=9,256):0!==(t=3584&e)?(Ft=8,t):0!==(4096&e)?(Ft=7,4096):0!==(t=4186112&e)?(Ft=6,t):0!==(t=62914560&e)?(Ft=5,t):67108864&e?(Ft=4,67108864):0!==(134217728&e)?(Ft=3,134217728):0!==(t=805306368&e)?(Ft=2,t):0!==(1073741824&e)?(Ft=1,1073741824):(Ft=8,e)}function Ht(e,t){var n=e.pendingLanes;if(0===n)return Ft=0;var r=0,a=0,i=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==i)r=i,a=Ft=15;else if(0!==(i=134217727&n)){var c=i&~o;0!==c?(r=Xt(c),a=Ft):0!==(s&=i)&&(r=Xt(s),a=Ft)}else 0!==(i=n&~o)?(r=Xt(i),a=Ft):0!==s&&(r=Xt(s),a=Ft);if(0===r)return 0;if(r=n&((0>(r=31-zt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&o)){if(Xt(t),a<=Ft)return t;Ft=a}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-zt(t)),r|=e[n],t&=~a;return r}function Ot(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Lt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Nt(24&~t))?Lt(10,t):e;case 10:return 0===(e=Nt(192&~t))?Lt(8,t):e;case 8:return 0===(e=Nt(3584&~t))&&(0===(e=Nt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Nt(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Nt(e){return e&-e}function Yt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Tt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-zt(t)]=n}var zt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Kt(e)/jt|0)|0},Kt=Math.log,jt=Math.LN2;var Dt=i.unstable_UserBlockingPriority,Ut=i.unstable_runWithPriority,Qt=!0;function Pt(e,t,n,r){Xe||Ve();var a=qt,i=Xe;Xe=!0;try{We(a,e,t,n,r)}finally{(Xe=i)||Oe()}}function Jt(e,t,n,r){Ut(Dt,qt.bind(null,e,t,n,r))}function qt(e,t,n,r){var a;if(Qt)if((a=0===(4&t))&&0<ot.length&&-1<It.indexOf(e))e=At(null,e,t,n,r),ot.push(e);else{var i=$t(e,t,n,r);if(null===i)a&&ht(e,r);else{if(a){if(-1<It.indexOf(e))return e=At(i,e,t,n,r),void ot.push(e);if(function(e,t,n,r,a){switch(t){case"focusin":return st=Ct(st,e,t,n,r,a),!0;case"dragenter":return ct=Ct(ct,e,t,n,r,a),!0;case"mouseover":return ut=Ct(ut,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return lt.set(i,Ct(lt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,gt.set(i,Ct(gt.get(i)||null,e,t,n,r,a)),!0}return!1}(i,e,t,n,r))return;ht(e,r)}Vr(e,t,r,null,n)}}}function $t(e,t,n,r){var a=_e(r);if(null!==(a=na(a))){var i=Pe(a);if(null===i)a=null;else{var o=i.tag;if(13===o){if(null!==(a=Je(i)))return a;a=null}else if(3===o){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;a=null}else i!==a&&(a=null)}}return Vr(e,t,r,a,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,a="value"in en?en.value:en.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return nn=a.slice(e,1<t?1-t:void 0)}function an(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function on(){return!0}function sn(){return!1}function cn(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?on:sn,this.isPropagationStopped=sn,this}return a(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),t}var un,ln,gn,dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},In=cn(dn),An=a({},dn,{view:0,detail:0}),hn=cn(An),Cn=a({},An,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==gn&&(gn&&"mousemove"===e.type?(un=e.screenX-gn.screenX,ln=e.screenY-gn.screenY):ln=un=0,gn=e),un)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),fn=cn(Cn),pn=cn(a({},Cn,{dataTransfer:0})),mn=cn(a({},An,{relatedTarget:0})),vn=cn(a({},dn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=a({},dn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=cn(bn),Bn=cn(a({},dn,{data:0})),Gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function Sn(){return Zn}var xn=a({},An,{key:function(e){if(e.key){var t=Gn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=an(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?an(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?an(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=cn(xn),Mn=cn(a({},Cn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),kn=cn(a({},An,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),En=cn(a({},dn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Wn=a({},Cn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vn=cn(Wn),Fn=[9,13,27,32],Xn=g&&"CompositionEvent"in window,Hn=null;g&&"documentMode"in document&&(Hn=document.documentMode);var On=g&&"TextEvent"in window&&!Hn,Ln=g&&(!Xn||Hn&&8<Hn&&11>=Hn),Nn=String.fromCharCode(32),Yn=!1;function Tn(e,t){switch(e){case"keyup":return-1!==Fn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Kn=!1;var jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function Un(e,t,n,r){Me(r),0<(t=Xr(t,"onChange")).length&&(n=new In("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Qn=null,Pn=null;function Jn(e){xr(e,0)}function qn(e){if(J(aa(e)))return e}function $n(e,t){if("change"===e)return t}var er=!1;if(g){var tr;if(g){var nr="oninput"in document;if(!nr){var rr=document.createElement("div");rr.setAttribute("oninput","return;"),nr="function"===typeof rr.oninput}tr=nr}else tr=!1;er=tr&&(!document.documentMode||9<document.documentMode)}function ar(){Qn&&(Qn.detachEvent("onpropertychange",ir),Pn=Qn=null)}function ir(e){if("value"===e.propertyName&&qn(Pn)){var t=[];if(Un(t,Pn,e,_e(e)),e=Jn,Xe)e(t);else{Xe=!0;try{Ee(e,t)}finally{Xe=!1,Oe()}}}}function or(e,t,n){"focusin"===e?(ar(),Pn=n,(Qn=t).attachEvent("onpropertychange",ir)):"focusout"===e&&ar()}function sr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qn(Pn)}function cr(e,t){if("click"===e)return qn(t)}function ur(e,t){if("input"===e||"change"===e)return qn(t)}var lr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},gr=Object.prototype.hasOwnProperty;function dr(e,t){if(lr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!gr.call(t,n[r])||!lr(e[n[r]],t[n[r]]))return!1;return!0}function Ir(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ar(e,t){var n,r=Ir(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Ir(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Cr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var pr=g&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,br=null,yr=!1;function Br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yr||null==mr||mr!==q(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&dr(br,r)||(br=r,0<(r=Xr(vr,"onSelect")).length&&(t=new In("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}Vt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Vt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Vt(Wt,2);for(var Gr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),wr=0;wr<Gr.length;wr++)Et.set(Gr[wr],0);l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var _r="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zr=new Set("cancel close invalid load scroll toggle".split(" ").concat(_r));function Sr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,i,s,c,u){if(Qe.apply(this,arguments),ze){if(!ze)throw Error(o(198));var l=Ke;ze=!1,Ke=null,je||(je=!0,De=l)}}(r,t,void 0,e),e.currentTarget=null}function xr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==i&&a.isPropagationStopped())break e;Sr(a,s,u),i=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,u=s.currentTarget,s=s.listener,c!==i&&a.isPropagationStopped())break e;Sr(a,s,u),i=c}}}if(je)throw e=De,je=!1,De=null,e}function Rr(e,t){var n=oa(t),r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}var Mr="_reactListening"+Math.random().toString(36).slice(2);function kr(e){e[Mr]||(e[Mr]=!0,s.forEach((function(t){Zr.has(t)||Er(t,!1,e,null),Er(t,!0,e,null)})))}function Er(e,t,n,r){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,i=n;if("selectionchange"===e&&9!==n.nodeType&&(i=n.ownerDocument),null!==r&&!t&&Zr.has(e)){if("scroll"!==e)return;a|=2,i=r}var o=oa(i),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(a|=4),Wr(i,e,a,t),o.add(s))}function Wr(e,t,n,r){var a=Et.get(t);switch(void 0===a?2:a){case 0:a=Pt;break;case 1:a=Jt;break;default:a=qt}n=a.bind(null,t,n,e),a=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===a||8===c.nodeType&&c.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=na(s)))return;if(5===(c=o.tag)||6===c){r=i=o;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(He)return e(t,n);He=!0;try{Fe(e,t,n)}finally{He=!1,Oe()}}((function(){var r=i,a=_e(n),o=[];e:{var s=kt.get(e);if(void 0!==s){var c=In,u=e;switch(e){case"keypress":if(0===an(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":u="focus",c=mn;break;case"focusout":u="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=kn;break;case St:case xt:case Rt:c=vn;break;case Mt:c=En;break;case"scroll":c=hn;break;case"wheel":c=Vn;break;case"copy":case"cut":case"paste":c=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Mn}var l=0!==(4&t),g=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var I,A=r;null!==A;){var h=(I=A).stateNode;if(5===I.tag&&null!==h&&(I=h,null!==d&&(null!=(h=Le(A,d))&&l.push(Fr(A,h,I)))),g)break;A=A.return}0<l.length&&(s=new c(s,u,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(u=n.relatedTarget||n.fromElement)||!na(u)&&!u[ea])&&(c||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?na(u):null)&&(u!==(g=Pe(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=fn,h="onMouseLeave",d="onMouseEnter",A="mouse","pointerout"!==e&&"pointerover"!==e||(l=Mn,h="onPointerLeave",d="onPointerEnter",A="pointer"),g=null==c?s:aa(c),I=null==u?s:aa(u),(s=new l(h,A+"leave",c,n,a)).target=g,s.relatedTarget=I,h=null,na(a)===r&&((l=new l(d,A+"enter",u,n,a)).target=I,l.relatedTarget=g,h=l),g=h,c&&u)e:{for(d=u,A=0,I=l=c;I;I=Hr(I))A++;for(I=0,h=d;h;h=Hr(h))I++;for(;0<A-I;)l=Hr(l),A--;for(;0<I-A;)d=Hr(d),I--;for(;A--;){if(l===d||null!==d&&l===d.alternate)break e;l=Hr(l),d=Hr(d)}l=null}else l=null;null!==c&&Or(o,s,c,l,!1),null!==u&&null!==g&&Or(o,g,u,l,!0)}if("select"===(c=(s=r?aa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var C=$n;else if(Dn(s))if(er)C=ur;else{C=sr;var f=or}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(C=cr);switch(C&&(C=C(e,r))?Un(o,C,n,a):(f&&f(e,s,r),"focusout"===e&&(f=s._wrapperState)&&f.controlled&&"number"===s.type&&ae(s,"number",s.value)),f=r?aa(r):window,e){case"focusin":(Dn(f)||"true"===f.contentEditable)&&(mr=f,vr=r,br=null);break;case"focusout":br=vr=mr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,Br(o,n,a);break;case"selectionchange":if(pr)break;case"keydown":case"keyup":Br(o,n,a)}var p;if(Xn)e:{switch(e){case"compositionstart":var m="onCompositionStart";break e;case"compositionend":m="onCompositionEnd";break e;case"compositionupdate":m="onCompositionUpdate";break e}m=void 0}else Kn?Tn(e,n)&&(m="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(m="onCompositionStart");m&&(Ln&&"ko"!==n.locale&&(Kn||"onCompositionStart"!==m?"onCompositionEnd"===m&&Kn&&(p=rn()):(tn="value"in(en=a)?en.value:en.textContent,Kn=!0)),0<(f=Xr(r,m)).length&&(m=new Bn(m,e,null,n,a),o.push({event:m,listeners:f}),p?m.data=p:null!==(p=zn(n))&&(m.data=p))),(p=On?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Yn=!0,Nn);case"textInput":return(e=t.data)===Nn&&Yn?null:e;default:return null}}(e,n):function(e,t){if(Kn)return"compositionend"===e||!Xn&&Tn(e,t)?(e=rn(),nn=tn=en=null,Kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Xr(r,"onBeforeInput")).length&&(a=new Bn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=p))}xr(o,t)}))}function Fr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Xr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Le(e,n))&&r.unshift(Fr(e,i,a)),null!=(i=Le(e,t))&&r.push(Fr(e,i,a))),e=e.return}return r}function Hr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Or(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,u=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==u&&(s=u,a?null!=(c=Le(n,i))&&o.unshift(Fr(n,c,s)):a||null!=(c=Le(n,i))&&o.push(Fr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function Lr(){}var Nr=null,Yr=null;function Tr(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function zr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Kr="function"===typeof setTimeout?setTimeout:void 0,jr="function"===typeof clearTimeout?clearTimeout:void 0;function Dr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Ur(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Qr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Pr=0;var Jr=Math.random().toString(36).slice(2),qr="__reactFiber$"+Jr,$r="__reactProps$"+Jr,ea="__reactContainer$"+Jr,ta="__reactEvents$"+Jr;function na(e){var t=e[qr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ea]||n[qr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Qr(e);null!==e;){if(n=e[qr])return n;e=Qr(e)}return t}n=(e=n).parentNode}return null}function ra(e){return!(e=e[qr]||e[ea])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function aa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ia(e){return e[$r]||null}function oa(e){var t=e[ta];return void 0===t&&(t=e[ta]=new Set),t}var sa=[],ca=-1;function ua(e){return{current:e}}function la(e){0>ca||(e.current=sa[ca],sa[ca]=null,ca--)}function ga(e,t){ca++,sa[ca]=e.current,e.current=t}var da={},Ia=ua(da),Aa=ua(!1),ha=da;function Ca(e,t){var n=e.type.contextTypes;if(!n)return da;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function fa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function pa(){la(Aa),la(Ia)}function ma(e,t,n){if(Ia.current!==da)throw Error(o(168));ga(Ia,t),ga(Aa,n)}function va(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(o(108,D(t)||"Unknown",i));return a({},n,r)}function ba(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||da,ha=Ia.current,ga(Ia,e),ga(Aa,Aa.current),!0}function ya(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=va(e,t,ha),r.__reactInternalMemoizedMergedChildContext=e,la(Aa),la(Ia),ga(Ia,e)):la(Aa),ga(Aa,n)}var Ba=null,Ga=null,wa=i.unstable_runWithPriority,_a=i.unstable_scheduleCallback,Za=i.unstable_cancelCallback,Sa=i.unstable_shouldYield,xa=i.unstable_requestPaint,Ra=i.unstable_now,Ma=i.unstable_getCurrentPriorityLevel,ka=i.unstable_ImmediatePriority,Ea=i.unstable_UserBlockingPriority,Wa=i.unstable_NormalPriority,Va=i.unstable_LowPriority,Fa=i.unstable_IdlePriority,Xa={},Ha=void 0!==xa?xa:function(){},Oa=null,La=null,Na=!1,Ya=Ra(),Ta=1e4>Ya?Ra:function(){return Ra()-Ya};function za(){switch(Ma()){case ka:return 99;case Ea:return 98;case Wa:return 97;case Va:return 96;case Fa:return 95;default:throw Error(o(332))}}function Ka(e){switch(e){case 99:return ka;case 98:return Ea;case 97:return Wa;case 96:return Va;case 95:return Fa;default:throw Error(o(332))}}function ja(e,t){return e=Ka(e),wa(e,t)}function Da(e,t,n){return e=Ka(e),_a(e,t,n)}function Ua(){if(null!==La){var e=La;La=null,Za(e)}Qa()}function Qa(){if(!Na&&null!==Oa){Na=!0;var e=0;try{var t=Oa;ja(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Oa=null}catch(n){throw null!==Oa&&(Oa=Oa.slice(e+1)),_a(ka,Ua),n}finally{Na=!1}}}var Pa=b.ReactCurrentBatchConfig;function Ja(e,t){if(e&&e.defaultProps){for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var qa=ua(null),$a=null,ei=null,ti=null;function ni(){ti=ei=$a=null}function ri(e){var t=qa.current;la(qa),e.type._context._currentValue=t}function ai(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function ii(e,t){$a=e,ti=ei=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Xo=!0),e.firstContext=null)}function oi(e,t){if(ti!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(ti=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ei){if(null===$a)throw Error(o(308));ei=t,$a.dependencies={lanes:0,firstContext:t,responders:null}}else ei=ei.next=t;return e._currentValue}var si=!1;function ci(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ui(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function li(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gi(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function di(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ii(e,t,n,r){var i=e.updateQueue;si=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,c=i.shared.pending;if(null!==c){i.shared.pending=null;var u=c,l=u.next;u.next=null,null===s?o=l:s.next=l,s=u;var g=e.alternate;if(null!==g){var d=(g=g.updateQueue).lastBaseUpdate;d!==s&&(null===d?g.firstBaseUpdate=l:d.next=l,g.lastBaseUpdate=u)}}if(null!==o){for(d=i.baseState,s=0,g=l=u=null;;){c=o.lane;var I=o.eventTime;if((r&c)===c){null!==g&&(g=g.next={eventTime:I,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var A=e,h=o;switch(c=t,I=n,h.tag){case 1:if("function"===typeof(A=h.payload)){d=A.call(I,d,c);break e}d=A;break e;case 3:A.flags=-4097&A.flags|64;case 0:if(null===(c="function"===typeof(A=h.payload)?A.call(I,d,c):A)||void 0===c)break e;d=a({},d,c);break e;case 2:si=!0}}null!==o.callback&&(e.flags|=32,null===(c=i.effects)?i.effects=[o]:c.push(o))}else I={eventTime:I,lane:c,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===g?(l=g=I,u=d):g=g.next=I,s|=c;if(null===(o=o.next)){if(null===(c=i.shared.pending))break;o=c.next,c.next=null,i.lastBaseUpdate=c,i.shared.pending=null}}null===g&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=g,Ns|=s,e.lanes=s,e.memoizedState=d}}function Ai(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(o(191,a));a.call(r)}}}var hi=(new r.Component).refs;function Ci(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fi={isMounted:function(e){return!!(e=e._reactInternals)&&Pe(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=dc(),a=Ic(e),i=li(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gi(e,i),Ac(e,a,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=dc(),a=Ic(e),i=li(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gi(e,i),Ac(e,a,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=dc(),r=Ic(e),a=li(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),gi(e,a),Ac(e,r,n)}};function pi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!dr(n,r)||!dr(a,i))}function mi(e,t,n){var r=!1,a=da,i=t.contextType;return"object"===typeof i&&null!==i?i=oi(i):(a=fa(t)?ha:Ia.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ca(e,a):da),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=fi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function vi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&fi.enqueueReplaceState(t,t.state,null)}function bi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=hi,ci(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=oi(i):(i=fa(t)?ha:Ia.current,a.context=Ca(e,i)),Ii(e,n,a,r),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Ci(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&fi.enqueueReplaceState(a,a.state,null),Ii(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4)}var yi=Array.isArray;function Bi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===hi&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Gi(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function wi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=jc(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Pc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=a(t,n.props)).ref=Bi(e,t,n),r.return=e,r):((r=Dc(n.type,n.key,n.props,null,e.mode,r)).ref=Bi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Jc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function g(e,t,n,r,i){return null===t||7!==t.tag?((t=Uc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Pc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case y:return(n=Dc(t.type,t.key,t.props,null,e.mode,n)).ref=Bi(e,null,t),n.return=e,n;case B:return(t=Jc(t,e.mode,n)).return=e,t}if(yi(t)||Y(t))return(t=Uc(t,e.mode,n,null)).return=e,t;Gi(e,t)}return null}function I(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==a?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case y:return n.key===a?n.type===G?g(e,t,n.props.children,r,a):u(e,t,n,r):null;case B:return n.key===a?l(e,t,n,r):null}if(yi(n)||Y(n))return null!==a?null:g(e,t,n,r,null);Gi(e,n)}return null}function A(e,t,n,r,a){if("string"===typeof r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case y:return e=e.get(null===r.key?n:r.key)||null,r.type===G?g(t,e,r.props.children,a,r.key):u(t,e,r,a);case B:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(yi(r)||Y(r))return g(t,e=e.get(n)||null,r,a,null);Gi(t,r)}return null}function h(a,o,s,c){for(var u=null,l=null,g=o,h=o=0,C=null;null!==g&&h<s.length;h++){g.index>h?(C=g,g=null):C=g.sibling;var f=I(a,g,s[h],c);if(null===f){null===g&&(g=C);break}e&&g&&null===f.alternate&&t(a,g),o=i(f,o,h),null===l?u=f:l.sibling=f,l=f,g=C}if(h===s.length)return n(a,g),u;if(null===g){for(;h<s.length;h++)null!==(g=d(a,s[h],c))&&(o=i(g,o,h),null===l?u=g:l.sibling=g,l=g);return u}for(g=r(a,g);h<s.length;h++)null!==(C=A(g,a,h,s[h],c))&&(e&&null!==C.alternate&&g.delete(null===C.key?h:C.key),o=i(C,o,h),null===l?u=C:l.sibling=C,l=C);return e&&g.forEach((function(e){return t(a,e)})),u}function C(a,s,c,u){var l=Y(c);if("function"!==typeof l)throw Error(o(150));if(null==(c=l.call(c)))throw Error(o(151));for(var g=l=null,h=s,C=s=0,f=null,p=c.next();null!==h&&!p.done;C++,p=c.next()){h.index>C?(f=h,h=null):f=h.sibling;var m=I(a,h,p.value,u);if(null===m){null===h&&(h=f);break}e&&h&&null===m.alternate&&t(a,h),s=i(m,s,C),null===g?l=m:g.sibling=m,g=m,h=f}if(p.done)return n(a,h),l;if(null===h){for(;!p.done;C++,p=c.next())null!==(p=d(a,p.value,u))&&(s=i(p,s,C),null===g?l=p:g.sibling=p,g=p);return l}for(h=r(a,h);!p.done;C++,p=c.next())null!==(p=A(h,a,C,p.value,u))&&(e&&null!==p.alternate&&h.delete(null===p.key?C:p.key),s=i(p,s,C),null===g?l=p:g.sibling=p,g=p);return e&&h.forEach((function(e){return t(a,e)})),l}return function(e,r,i,c){var u="object"===typeof i&&null!==i&&i.type===G&&null===i.key;u&&(i=i.props.children);var l="object"===typeof i&&null!==i;if(l)switch(i.$$typeof){case y:e:{for(l=i.key,u=r;null!==u;){if(u.key===l){if(7===u.tag){if(i.type===G){n(e,u.sibling),(r=a(u,i.props.children)).return=e,e=r;break e}}else if(u.elementType===i.type){n(e,u.sibling),(r=a(u,i.props)).ref=Bi(e,u,i),r.return=e,e=r;break e}n(e,u);break}t(e,u),u=u.sibling}i.type===G?((r=Uc(i.props.children,e.mode,c,i.key)).return=e,e=r):((c=Dc(i.type,i.key,i.props,null,e.mode,c)).ref=Bi(e,r,i),c.return=e,e=c)}return s(e);case B:e:{for(u=i.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=a(r,i.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Jc(i,e.mode,c)).return=e,e=r}return s(e)}if("string"===typeof i||"number"===typeof i)return i=""+i,null!==r&&6===r.tag?(n(e,r.sibling),(r=a(r,i)).return=e,e=r):(n(e,r),(r=Pc(i,e.mode,c)).return=e,e=r),s(e);if(yi(i))return h(e,r,i,c);if(Y(i))return C(e,r,i,c);if(l&&Gi(e,i),"undefined"===typeof i&&!u)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,D(e.type)||"Component"))}return n(e,r)}}var _i=wi(!0),Zi=wi(!1),Si={},xi=ua(Si),Ri=ua(Si),Mi=ua(Si);function ki(e){if(e===Si)throw Error(o(174));return e}function Ei(e,t){switch(ga(Mi,t),ga(Ri,e),ga(xi,Si),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ae(null,"");break;default:t=Ae(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}la(xi),ga(xi,t)}function Wi(){la(xi),la(Ri),la(Mi)}function Vi(e){ki(Mi.current);var t=ki(xi.current),n=Ae(t,e.type);t!==n&&(ga(Ri,e),ga(xi,n))}function Fi(e){Ri.current===e&&(la(xi),la(Ri))}var Xi=ua(0);function Hi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Oi=null,Li=null,Ni=!1;function Yi(e,t){var n=zc(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ti(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function zi(e){if(Ni){var t=Li;if(t){var n=t;if(!Ti(e,t)){if(!(t=Ur(n.nextSibling))||!Ti(e,t))return e.flags=-1025&e.flags|2,Ni=!1,void(Oi=e);Yi(Oi,n)}Oi=e,Li=Ur(t.firstChild)}else e.flags=-1025&e.flags|2,Ni=!1,Oi=e}}function Ki(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Oi=e}function ji(e){if(e!==Oi)return!1;if(!Ni)return Ki(e),Ni=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!zr(t,e.memoizedProps))for(t=Li;t;)Yi(e,t),t=Ur(t.nextSibling);if(Ki(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Li=Ur(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Li=null}}else Li=Oi?Ur(e.stateNode.nextSibling):null;return!0}function Di(){Li=Oi=null,Ni=!1}var Ui=[];function Qi(){for(var e=0;e<Ui.length;e++)Ui[e]._workInProgressVersionPrimary=null;Ui.length=0}var Pi=b.ReactCurrentDispatcher,Ji=b.ReactCurrentBatchConfig,qi=0,$i=null,eo=null,to=null,no=!1,ro=!1;function ao(){throw Error(o(321))}function io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!lr(e[n],t[n]))return!1;return!0}function oo(e,t,n,r,a,i){if(qi=i,$i=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Pi.current=null===e||null===e.memoizedState?Eo:Wo,e=n(r,a),ro){i=0;do{if(ro=!1,!(25>i))throw Error(o(301));i+=1,to=eo=null,t.updateQueue=null,Pi.current=Vo,e=n(r,a)}while(ro)}if(Pi.current=ko,t=null!==eo&&null!==eo.next,qi=0,to=eo=$i=null,no=!1,t)throw Error(o(300));return e}function so(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===to?$i.memoizedState=to=e:to=to.next=e,to}function co(){if(null===eo){var e=$i.alternate;e=null!==e?e.memoizedState:null}else e=eo.next;var t=null===to?$i.memoizedState:to.next;if(null!==t)to=t,eo=e;else{if(null===e)throw Error(o(310));e={memoizedState:(eo=e).memoizedState,baseState:eo.baseState,baseQueue:eo.baseQueue,queue:eo.queue,next:null},null===to?$i.memoizedState=to=e:to=to.next=e}return to}function uo(e,t){return"function"===typeof t?t(e):t}function lo(e){var t=co(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=eo,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(null!==a){a=a.next,r=r.baseState;var c=s=i=null,u=a;do{var l=u.lane;if((qi&l)===l)null!==c&&(c=c.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),r=u.eagerReducer===e?u.eagerState:e(r,u.action);else{var g={lane:l,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===c?(s=c=g,i=r):c=c.next=g,$i.lanes|=l,Ns|=l}u=u.next}while(null!==u&&u!==a);null===c?i=r:c.next=s,lr(r,t.memoizedState)||(Xo=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=c,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function go(e){var t=co(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{i=e(i,s.action),s=s.next}while(s!==a);lr(i,t.memoizedState)||(Xo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Io(e,t,n){var r=t._getVersion;r=r(t._source);var a=t._workInProgressVersionPrimary;if(null!==a?e=a===r:(e=e.mutableReadLanes,(e=(qi&e)===e)&&(t._workInProgressVersionPrimary=r,Ui.push(t))),e)return n(t._source);throw Ui.push(t),Error(o(350))}function Ao(e,t,n,r){var a=Es;if(null===a)throw Error(o(349));var i=t._getVersion,s=i(t._source),c=Pi.current,u=c.useState((function(){return Io(a,t,n)})),l=u[1],g=u[0];u=to;var d=e.memoizedState,I=d.refs,A=I.getSnapshot,h=d.source;d=d.subscribe;var C=$i;return e.memoizedState={refs:I,source:t,subscribe:r},c.useEffect((function(){I.getSnapshot=n,I.setSnapshot=l;var e=i(t._source);if(!lr(s,e)){e=n(t._source),lr(g,e)||(l(e),e=Ic(C),a.mutableReadLanes|=e&a.pendingLanes),e=a.mutableReadLanes,a.entangledLanes|=e;for(var r=a.entanglements,o=e;0<o;){var c=31-zt(o),u=1<<c;r[c]|=e,o&=~u}}}),[n,t,r]),c.useEffect((function(){return r(t._source,(function(){var e=I.getSnapshot,n=I.setSnapshot;try{n(e(t._source));var r=Ic(C);a.mutableReadLanes|=r&a.pendingLanes}catch(i){n((function(){throw i}))}}))}),[t,r]),lr(A,n)&&lr(h,t)&&lr(d,r)||((e={pending:null,dispatch:null,lastRenderedReducer:uo,lastRenderedState:g}).dispatch=l=Mo.bind(null,$i,e),u.queue=e,u.baseQueue=null,g=Io(a,t,n),u.memoizedState=u.baseState=g),g}function ho(e,t,n){return Ao(co(),e,t,n)}function Co(e){var t=so();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:uo,lastRenderedState:e}).dispatch=Mo.bind(null,$i,e),[t.memoizedState,e]}function fo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=$i.updateQueue)?(t={lastEffect:null},$i.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function po(e){return e={current:e},so().memoizedState=e}function mo(){return co().memoizedState}function vo(e,t,n,r){var a=so();$i.flags|=e,a.memoizedState=fo(1|t,n,void 0,void 0===r?null:r)}function bo(e,t,n,r){var a=co();r=void 0===r?null:r;var i=void 0;if(null!==eo){var o=eo.memoizedState;if(i=o.destroy,null!==r&&io(r,o.deps))return void fo(t,n,i,r)}$i.flags|=e,a.memoizedState=fo(1|t,n,i,r)}function yo(e,t){return vo(516,4,e,t)}function Bo(e,t){return bo(516,4,e,t)}function Go(e,t){return bo(4,2,e,t)}function wo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function _o(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,bo(4,2,wo.bind(null,t,e),n)}function Zo(){}function So(e,t){var n=co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function xo(e,t){var n=co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&io(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ro(e,t){var n=za();ja(98>n?98:n,(function(){e(!0)})),ja(97<n?97:n,(function(){var n=Ji.transition;Ji.transition=1;try{e(!1),t()}finally{Ji.transition=n}}))}function Mo(e,t,n){var r=dc(),a=Ic(e),i={lane:a,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===$i||null!==o&&o===$i)ro=no=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,c=o(s,n);if(i.eagerReducer=o,i.eagerState=c,lr(c,s))return}catch(u){}Ac(e,a,r)}}var ko={readContext:oi,useCallback:ao,useContext:ao,useEffect:ao,useImperativeHandle:ao,useLayoutEffect:ao,useMemo:ao,useReducer:ao,useRef:ao,useState:ao,useDebugValue:ao,useDeferredValue:ao,useTransition:ao,useMutableSource:ao,useOpaqueIdentifier:ao,unstable_isNewReconciler:!1},Eo={readContext:oi,useCallback:function(e,t){return so().memoizedState=[e,void 0===t?null:t],e},useContext:oi,useEffect:yo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,vo(4,2,wo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return vo(4,2,e,t)},useMemo:function(e,t){var n=so();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=so();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Mo.bind(null,$i,e),[r.memoizedState,e]},useRef:po,useState:Co,useDebugValue:Zo,useDeferredValue:function(e){var t=Co(e),n=t[0],r=t[1];return yo((function(){var t=Ji.transition;Ji.transition=1;try{r(e)}finally{Ji.transition=t}}),[e]),n},useTransition:function(){var e=Co(!1),t=e[0];return po(e=Ro.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=so();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},Ao(r,e,t,n)},useOpaqueIdentifier:function(){if(Ni){var e=!1,t=function(e){return{$$typeof:V,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Pr++).toString(36))),Error(o(355))})),n=Co(t)[1];return 0===(2&$i.mode)&&($i.flags|=516,fo(5,(function(){n("r:"+(Pr++).toString(36))}),void 0,null)),t}return Co(t="r:"+(Pr++).toString(36)),t},unstable_isNewReconciler:!1},Wo={readContext:oi,useCallback:So,useContext:oi,useEffect:Bo,useImperativeHandle:_o,useLayoutEffect:Go,useMemo:xo,useReducer:lo,useRef:mo,useState:function(){return lo(uo)},useDebugValue:Zo,useDeferredValue:function(e){var t=lo(uo),n=t[0],r=t[1];return Bo((function(){var t=Ji.transition;Ji.transition=1;try{r(e)}finally{Ji.transition=t}}),[e]),n},useTransition:function(){var e=lo(uo)[0];return[mo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return lo(uo)[0]},unstable_isNewReconciler:!1},Vo={readContext:oi,useCallback:So,useContext:oi,useEffect:Bo,useImperativeHandle:_o,useLayoutEffect:Go,useMemo:xo,useReducer:go,useRef:mo,useState:function(){return go(uo)},useDebugValue:Zo,useDeferredValue:function(e){var t=go(uo),n=t[0],r=t[1];return Bo((function(){var t=Ji.transition;Ji.transition=1;try{r(e)}finally{Ji.transition=t}}),[e]),n},useTransition:function(){var e=go(uo)[0];return[mo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return go(uo)[0]},unstable_isNewReconciler:!1},Fo=b.ReactCurrentOwner,Xo=!1;function Ho(e,t,n,r){t.child=null===e?Zi(t,null,n,r):_i(t,e.child,n,r)}function Oo(e,t,n,r,a){n=n.render;var i=t.ref;return ii(t,a),r=oo(e,t,n,r,i,a),null===e||Xo?(t.flags|=1,Ho(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,is(e,t,a))}function Lo(e,t,n,r,a,i){if(null===e){var o=n.type;return"function"!==typeof o||Kc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Dc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,No(e,t,o,r,a,i))}return o=e.child,0===(a&i)&&(a=o.memoizedProps,(n=null!==(n=n.compare)?n:dr)(a,r)&&e.ref===t.ref)?is(e,t,i):(t.flags|=1,(e=jc(o,r)).ref=t.ref,e.return=t,t.child=e)}function No(e,t,n,r,a,i){if(null!==e&&dr(e.memoizedProps,r)&&e.ref===t.ref){if(Xo=!1,0===(i&a))return t.lanes=e.lanes,is(e,t,i);0!==(16384&e.flags)&&(Xo=!0)}return zo(e,t,n,r,i)}function Yo(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},yc(t,n);else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},yc(t,e),null;t.memoizedState={baseLanes:0},yc(t,null!==i?i.baseLanes:n)}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,yc(t,r);return Ho(e,t,a,n),t.child}function To(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function zo(e,t,n,r,a){var i=fa(n)?ha:Ia.current;return i=Ca(t,i),ii(t,a),n=oo(e,t,n,r,i,a),null===e||Xo?(t.flags|=1,Ho(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,is(e,t,a))}function Ko(e,t,n,r,a){if(fa(n)){var i=!0;ba(t)}else i=!1;if(ii(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),mi(t,n,r),bi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=oi(u):u=Ca(t,u=fa(n)?ha:Ia.current);var l=n.getDerivedStateFromProps,g="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;g||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==u)&&vi(t,o,r,u),si=!1;var d=t.memoizedState;o.state=d,Ii(t,r,o,a),c=t.memoizedState,s!==r||d!==c||Aa.current||si?("function"===typeof l&&(Ci(t,n,l,r),c=t.memoizedState),(s=si||pi(t,n,s,r,d,c,u))?(g||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,ui(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Ja(t.type,s),o.props=u,g=t.pendingProps,d=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=oi(c):c=Ca(t,c=fa(n)?ha:Ia.current);var I=n.getDerivedStateFromProps;(l="function"===typeof I||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==g||d!==c)&&vi(t,o,r,c),si=!1,d=t.memoizedState,o.state=d,Ii(t,r,o,a);var A=t.memoizedState;s!==g||d!==A||Aa.current||si?("function"===typeof I&&(Ci(t,n,I,r),A=t.memoizedState),(u=si||pi(t,n,u,r,d,A,c))?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,A,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,A,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=A),o.props=r,o.state=A,o.context=c,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),r=!1)}return jo(e,t,n,r,i,a)}function jo(e,t,n,r,a,i){To(e,t);var o=0!==(64&t.flags);if(!r&&!o)return a&&ya(t,n,!1),is(e,t,i);r=t.stateNode,Fo.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=_i(t,e.child,null,i),t.child=_i(t,null,s,i)):Ho(e,t,s,i),t.memoizedState=r.state,a&&ya(t,n,!0),t.child}function Do(e){var t=e.stateNode;t.pendingContext?ma(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ma(0,t.context,!1),Ei(e,t.containerInfo)}var Uo,Qo,Po,Jo={dehydrated:null,retryLane:0};function qo(e,t,n){var r,a=t.pendingProps,i=Xi.current,o=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===a.fallback||!0===a.unstable_avoidThisFallback||(i|=1),ga(Xi,1&i),null===e?(void 0!==a.fallback&&zi(t),e=a.children,i=a.fallback,o?(e=$o(t,e,i,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Jo,e):"number"===typeof a.unstable_expectedLoadTime?(e=$o(t,e,i,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Jo,t.lanes=33554432,e):((n=Qc({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(a=ts(e,t,a.children,a.fallback,n),o=t.child,i=e.child.memoizedState,o.memoizedState=null===i?{baseLanes:n}:{baseLanes:i.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=Jo,a):(n=es(e,t,a.children,n),t.memoizedState=null,n))}function $o(e,t,n,r){var a=e.mode,i=e.child;return t={mode:"hidden",children:t},0===(2&a)&&null!==i?(i.childLanes=0,i.pendingProps=t):i=Qc(t,a,0,null),n=Uc(n,a,r,null),i.return=e,n.return=e,i.sibling=n,e.child=i,n}function es(e,t,n,r){var a=e.child;return e=a.sibling,n=jc(a,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function ts(e,t,n,r,a){var i=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&i)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=jc(o,s),null!==e?r=jc(e,r):(r=Uc(r,i,a,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ns(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ai(e.return,t)}function rs(e,t,n,r,a,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=a,o.lastEffect=i)}function as(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Ho(e,t,r.children,n),0!==(2&(r=Xi.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ns(e,n);else if(19===e.tag)ns(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ga(Xi,r),0===(2&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===Hi(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),rs(t,!1,a,n,i,t.lastEffect);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===Hi(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}rs(t,!0,n,null,i,t.lastEffect);break;case"together":rs(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function is(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ns|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=jc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=jc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function os(e,t){if(!Ni)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ss(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return fa(t.type)&&pa(),null;case 3:return Wi(),la(Aa),la(Ia),Qi(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ji(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:Fi(t);var i=ki(Mi.current);if(n=t.type,null!==e&&null!=t.stateNode)Qo(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=ki(xi.current),ji(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[qr]=t,r[$r]=s,n){case"dialog":Rr("cancel",r),Rr("close",r);break;case"iframe":case"object":case"embed":Rr("load",r);break;case"video":case"audio":for(e=0;e<_r.length;e++)Rr(_r[e],r);break;case"source":Rr("error",r);break;case"img":case"image":case"link":Rr("error",r),Rr("load",r);break;case"details":Rr("toggle",r);break;case"input":ee(r,s),Rr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Rr("invalid",r);break;case"textarea":ce(r,s),Rr("invalid",r)}for(var u in Ge(n,s),e=null,s)s.hasOwnProperty(u)&&(i=s[u],"children"===u?"string"===typeof i?r.textContent!==i&&(e=["children",i]):"number"===typeof i&&r.textContent!==""+i&&(e=["children",""+i]):c.hasOwnProperty(u)&&null!=i&&"onScroll"===u&&Rr("scroll",r));switch(n){case"input":P(r),re(r,s,!0);break;case"textarea":P(r),le(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Lr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(u=9===i.nodeType?i:i.ownerDocument,e===ge&&(e=Ie(n)),e===ge?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[qr]=t,e[$r]=r,Uo(e,t),t.stateNode=e,u=we(n,r),n){case"dialog":Rr("cancel",e),Rr("close",e),i=r;break;case"iframe":case"object":case"embed":Rr("load",e),i=r;break;case"video":case"audio":for(i=0;i<_r.length;i++)Rr(_r[i],e);i=r;break;case"source":Rr("error",e),i=r;break;case"img":case"image":case"link":Rr("error",e),Rr("load",e),i=r;break;case"details":Rr("toggle",e),i=r;break;case"input":ee(e,r),i=$(e,r),Rr("invalid",e);break;case"option":i=ie(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=a({},r,{value:void 0}),Rr("invalid",e);break;case"textarea":ce(e,r),i=se(e,r),Rr("invalid",e);break;default:i=r}Ge(n,i);var l=i;for(s in l)if(l.hasOwnProperty(s)){var g=l[s];"style"===s?ye(e,g):"dangerouslySetInnerHTML"===s?null!=(g=g?g.__html:void 0)&&fe(e,g):"children"===s?"string"===typeof g?("textarea"!==n||""!==g)&&pe(e,g):"number"===typeof g&&pe(e,""+g):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(c.hasOwnProperty(s)?null!=g&&"onScroll"===s&&Rr("scroll",e):null!=g&&v(e,s,g,u))}switch(n){case"input":P(e),re(e,r,!1);break;case"textarea":P(e),le(e);break;case"option":null!=r.value&&e.setAttribute("value",""+U(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?oe(e,!!r.multiple,s,!1):null!=r.defaultValue&&oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Lr)}Tr(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Po(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=ki(Mi.current),ki(xi.current),ji(t)?(r=t.stateNode,n=t.memoizedProps,r[qr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[qr]=t,t.stateNode=r)}return null;case 13:return la(Xi),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&ji(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Xi.current)?0===Hs&&(Hs=3):(0!==Hs&&3!==Hs||(Hs=4),null===Es||0===(134217727&Ns)&&0===(134217727&Ys)||pc(Es,Vs))),(r||n)&&(t.flags|=4),null);case 4:return Wi(),null===e&&kr(t.stateNode.containerInfo),null;case 10:return ri(t),null;case 19:if(la(Xi),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(u=r.rendering))if(s)os(r,!1);else{if(0!==Hs||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(u=Hi(e))){for(t.flags|=64,os(r,!1),null!==(s=u.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(u=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ga(Xi,1&Xi.current|2),t.child}e=e.sibling}null!==r.tail&&Ta()>js&&(t.flags|=64,s=!0,os(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Hi(u))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),os(r,!0),null===r.tail&&"hidden"===r.tailMode&&!u.alternate&&!Ni)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Ta()-r.renderingStartTime>js&&1073741824!==n&&(t.flags|=64,s=!0,os(r,!1),t.lanes=33554432);r.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=r.last)?n.sibling=u:t.child=u,r.last=u)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Ta(),n.sibling=null,t=Xi.current,ga(Xi,s?1&t|2:1&t),n):null;case 23:case 24:return Bc(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function cs(e){switch(e.tag){case 1:fa(e.type)&&pa();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Wi(),la(Aa),la(Ia),Qi(),0!==(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Fi(e),null;case 13:return la(Xi),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return la(Xi),null;case 4:return Wi(),null;case 10:return ri(e),null;case 23:case 24:return Bc(),null;default:return null}}function us(e,t){try{var n="",r=t;do{n+=j(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a}}function ls(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Uo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Qo=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ki(xi.current);var o,s=null;switch(n){case"input":i=$(e,i),r=$(e,r),s=[];break;case"option":i=ie(e,i),r=ie(e,r),s=[];break;case"select":i=a({},i,{value:void 0}),r=a({},r,{value:void 0}),s=[];break;case"textarea":i=se(e,i),r=se(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Lr)}for(g in Ge(n,r),n=null,i)if(!r.hasOwnProperty(g)&&i.hasOwnProperty(g)&&null!=i[g])if("style"===g){var u=i[g];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==g&&"children"!==g&&"suppressContentEditableWarning"!==g&&"suppressHydrationWarning"!==g&&"autoFocus"!==g&&(c.hasOwnProperty(g)?s||(s=[]):(s=s||[]).push(g,null));for(g in r){var l=r[g];if(u=null!=i?i[g]:void 0,r.hasOwnProperty(g)&&l!==u&&(null!=l||null!=u))if("style"===g)if(u){for(o in u)!u.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&u[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(g,n)),n=l;else"dangerouslySetInnerHTML"===g?(l=l?l.__html:void 0,u=u?u.__html:void 0,null!=l&&u!==l&&(s=s||[]).push(g,l)):"children"===g?"string"!==typeof l&&"number"!==typeof l||(s=s||[]).push(g,""+l):"suppressContentEditableWarning"!==g&&"suppressHydrationWarning"!==g&&(c.hasOwnProperty(g)?(null!=l&&"onScroll"===g&&Rr("scroll",e),s||u===l||(s=[])):"object"===typeof l&&null!==l&&l.$$typeof===V?l.toString():(s=s||[]).push(g,l))}n&&(s=s||[]).push("style",n);var g=s;(t.updateQueue=g)&&(t.flags|=4)}},Po=function(e,t,n,r){n!==r&&(t.flags|=4)};var gs="function"===typeof WeakMap?WeakMap:Map;function ds(e,t,n){(n=li(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ps||(Ps=!0,Js=r),ls(0,t)},n}function Is(e,t,n){(n=li(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return ls(0,t),r(a)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===qs?qs=new Set([this]):qs.add(this),ls(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var As="function"===typeof WeakSet?WeakSet:Set;function hs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Lc(e,n)}else t.current=null}function Cs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Ja(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Dr(t.stateNode.containerInfo))}throw Error(o(163))}function fs(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var a=e;r=a.next,0!==(4&(a=a.tag))&&0!==(1&a)&&(Xc(n,e),Fc(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Ja(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&Ai(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}Ai(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Tr(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&yt(n)))))}throw Error(o(163))}function ps(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var a=n.memoizedProps.style;a=void 0!==a&&null!==a&&a.hasOwnProperty("display")?a.display:null,r.style.display=be("display",a)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function ms(e,t){if(Ga&&"function"===typeof Ga.onCommitFiberUnmount)try{Ga.onCommitFiberUnmount(Ba,t)}catch(i){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,a=r.destroy;if(r=r.tag,void 0!==a)if(0!==(4&r))Xc(t,n);else{r=t;try{a()}catch(i){Lc(r,i)}}n=n.next}while(n!==e)}break;case 1:if(hs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(i){Lc(t,i)}break;case 5:hs(t);break;case 4:ws(e,t)}}function vs(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function bs(e){return 5===e.tag||3===e.tag||4===e.tag}function ys(e){e:{for(var t=e.return;null!==t;){if(bs(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.flags&&(pe(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||bs(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?Bs(e,n,t):Gs(e,n,t)}function Bs(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Lr));else if(4!==r&&null!==(e=e.child))for(Bs(e,t,n),e=e.sibling;null!==e;)Bs(e,t,n),e=e.sibling}function Gs(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(Gs(e,t,n),e=e.sibling;null!==e;)Gs(e,t,n),e=e.sibling}function ws(e,t){for(var n,r,a=t,i=!1;;){if(!i){i=a.return;e:for(;;){if(null===i)throw Error(o(160));switch(n=i.stateNode,i.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}i=i.return}i=!0}if(5===a.tag||6===a.tag){e:for(var s=e,c=a,u=c;;)if(ms(s,u),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===c)break e;for(;null===u.sibling;){if(null===u.return||u.return===c)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}r?(s=n,c=a.stateNode,8===s.nodeType?s.parentNode.removeChild(c):s.removeChild(c)):n.removeChild(a.stateNode)}else if(4===a.tag){if(null!==a.child){n=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(ms(e,a),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(i=!1)}a.sibling.return=a.return,a=a.sibling}}function _s(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var a=null!==e?e.memoizedProps:r;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,null!==i){for(n[$r]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),we(e,a),t=we(e,r),a=0;a<i.length;a+=2){var s=i[a],c=i[a+1];"style"===s?ye(n,c):"dangerouslySetInnerHTML"===s?fe(n,c):"children"===s?pe(n,c):v(n,s,c,t)}switch(e){case"input":ne(n,r);break;case"textarea":ue(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(i=r.value)?oe(n,!!r.multiple,i,!1):e!==!!r.multiple&&(null!=r.defaultValue?oe(n,!!r.multiple,r.defaultValue,!0):oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,yt(n.containerInfo)));case 13:return null!==t.memoizedState&&(Ks=Ta(),ps(t.child,!0)),void Zs(t);case 19:return void Zs(t);case 23:case 24:return void ps(t,null!==t.memoizedState)}throw Error(o(163))}function Zs(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new As),t.forEach((function(t){var r=Yc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Ss(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var xs=Math.ceil,Rs=b.ReactCurrentDispatcher,Ms=b.ReactCurrentOwner,ks=0,Es=null,Ws=null,Vs=0,Fs=0,Xs=ua(0),Hs=0,Os=null,Ls=0,Ns=0,Ys=0,Ts=0,zs=null,Ks=0,js=1/0;function Ds(){js=Ta()+500}var Us,Qs=null,Ps=!1,Js=null,qs=null,$s=!1,ec=null,tc=90,nc=[],rc=[],ac=null,ic=0,oc=null,sc=-1,cc=0,uc=0,lc=null,gc=!1;function dc(){return 0!==(48&ks)?Ta():-1!==sc?sc:sc=Ta()}function Ic(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===za()?1:2;if(0===cc&&(cc=Ls),0!==Pa.transition){0!==uc&&(uc=null!==zs?zs.pendingLanes:0),e=cc;var t=4186112&~uc;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=za(),0!==(4&ks)&&98===e?e=Lt(12,cc):e=Lt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),cc),e}function Ac(e,t,n){if(50<ic)throw ic=0,oc=null,Error(o(185));if(null===(e=hc(e,t)))return null;Tt(e,t,n),e===Es&&(Ys|=t,4===Hs&&pc(e,Vs));var r=za();1===t?0!==(8&ks)&&0===(48&ks)?mc(e):(Cc(e,n),0===ks&&(Ds(),Ua())):(0===(4&ks)||98!==r&&99!==r||(null===ac?ac=new Set([e]):ac.add(e)),Cc(e,n)),zs=e}function hc(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Cc(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,a=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var c=31-zt(s),u=1<<c,l=i[c];if(-1===l){if(0===(u&r)||0!==(u&a)){l=t,Xt(u);var g=Ft;i[c]=10<=g?l+250:6<=g?l+5e3:-1}}else l<=t&&(e.expiredLanes|=u);s&=~u}if(r=Ht(e,e===Es?Vs:0),t=Ft,0===r)null!==n&&(n!==Xa&&Za(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Xa&&Za(n)}15===t?(n=mc.bind(null,e),null===Oa?(Oa=[n],La=_a(ka,Qa)):Oa.push(n),n=Xa):14===t?n=Da(99,mc.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),n=Da(n,fc.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function fc(e){if(sc=-1,uc=cc=0,0!==(48&ks))throw Error(o(327));var t=e.callbackNode;if(Vc()&&e.callbackNode!==t)return null;var n=Ht(e,e===Es?Vs:0);if(0===n)return null;var r=n,a=ks;ks|=16;var i=_c();for(Es===e&&Vs===r||(Ds(),Gc(e,r));;)try{xc();break}catch(c){wc(e,c)}if(ni(),Rs.current=i,ks=a,null!==Ws?r=0:(Es=null,Vs=0,r=Hs),0!==(Ls&Ys))Gc(e,0);else if(0!==r){if(2===r&&(ks|=64,e.hydrate&&(e.hydrate=!1,Dr(e.containerInfo)),0!==(n=Ot(e))&&(r=Zc(e,n))),1===r)throw t=Os,Gc(e,0),pc(e,n),Cc(e,Ta()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(o(345));case 2:case 5:kc(e);break;case 3:if(pc(e,n),(62914560&n)===n&&10<(r=Ks+500-Ta())){if(0!==Ht(e,0))break;if(((a=e.suspendedLanes)&n)!==n){dc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Kr(kc.bind(null,e),r);break}kc(e);break;case 4:if(pc(e,n),(4186112&n)===n)break;for(r=e.eventTimes,a=-1;0<n;){var s=31-zt(n);i=1<<s,(s=r[s])>a&&(a=s),n&=~i}if(n=a,10<(n=(120>(n=Ta()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*xs(n/1960))-n)){e.timeoutHandle=Kr(kc.bind(null,e),n);break}kc(e);break;default:throw Error(o(329))}}return Cc(e,Ta()),e.callbackNode===t?fc.bind(null,e):null}function pc(e,t){for(t&=~Ts,t&=~Ys,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-zt(t),r=1<<n;e[n]=-1,t&=~r}}function mc(e){if(0!==(48&ks))throw Error(o(327));if(Vc(),e===Es&&0!==(e.expiredLanes&Vs)){var t=Vs,n=Zc(e,t);0!==(Ls&Ys)&&(n=Zc(e,t=Ht(e,t)))}else n=Zc(e,t=Ht(e,0));if(0!==e.tag&&2===n&&(ks|=64,e.hydrate&&(e.hydrate=!1,Dr(e.containerInfo)),0!==(t=Ot(e))&&(n=Zc(e,t))),1===n)throw n=Os,Gc(e,0),pc(e,t),Cc(e,Ta()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e),Cc(e,Ta()),null}function vc(e,t){var n=ks;ks|=1;try{return e(t)}finally{0===(ks=n)&&(Ds(),Ua())}}function bc(e,t){var n=ks;ks&=-2,ks|=8;try{return e(t)}finally{0===(ks=n)&&(Ds(),Ua())}}function yc(e,t){ga(Xs,Fs),Fs|=t,Ls|=t}function Bc(){Fs=Xs.current,la(Xs)}function Gc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,jr(n)),null!==Ws)for(n=Ws.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&pa();break;case 3:Wi(),la(Aa),la(Ia),Qi();break;case 5:Fi(r);break;case 4:Wi();break;case 13:case 19:la(Xi);break;case 10:ri(r);break;case 23:case 24:Bc()}n=n.return}Es=e,Ws=jc(e.current,null),Vs=Fs=Ls=t,Hs=0,Os=null,Ts=Ys=Ns=0}function wc(e,t){for(;;){var n=Ws;try{if(ni(),Pi.current=ko,no){for(var r=$i.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}no=!1}if(qi=0,to=eo=$i=null,ro=!1,Ms.current=null,null===n||null===n.return){Hs=1,Os=t,Ws=null;break}e:{var i=e,o=n.return,s=n,c=t;if(t=Vs,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c;if(0===(2&s.mode)){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.lanes=l.lanes):(s.updateQueue=null,s.memoizedState=null)}var g=0!==(1&Xi.current),d=o;do{var I;if(I=13===d.tag){var A=d.memoizedState;if(null!==A)I=null!==A.dehydrated;else{var h=d.memoizedProps;I=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!g)}}if(I){var C=d.updateQueue;if(null===C){var f=new Set;f.add(u),d.updateQueue=f}else C.add(u);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var p=li(-1,1);p.tag=2,gi(s,p)}s.lanes|=1;break e}c=void 0,s=t;var m=i.pingCache;if(null===m?(m=i.pingCache=new gs,c=new Set,m.set(u,c)):void 0===(c=m.get(u))&&(c=new Set,m.set(u,c)),!c.has(s)){c.add(s);var v=Nc.bind(null,i,u,s);u.then(v,v)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);c=Error((D(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Hs&&(Hs=2),c=us(c,s),d=o;do{switch(d.tag){case 3:i=c,d.flags|=4096,t&=-t,d.lanes|=t,di(d,ds(0,i,t));break e;case 1:i=c;var b=d.type,y=d.stateNode;if(0===(64&d.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===qs||!qs.has(y)))){d.flags|=4096,t&=-t,d.lanes|=t,di(d,Is(d,i,t));break e}}d=d.return}while(null!==d)}Mc(n)}catch(B){t=B,Ws===n&&null!==n&&(Ws=n=n.return);continue}break}}function _c(){var e=Rs.current;return Rs.current=ko,null===e?ko:e}function Zc(e,t){var n=ks;ks|=16;var r=_c();for(Es===e&&Vs===t||Gc(e,t);;)try{Sc();break}catch(a){wc(e,a)}if(ni(),ks=n,Rs.current=r,null!==Ws)throw Error(o(261));return Es=null,Vs=0,Hs}function Sc(){for(;null!==Ws;)Rc(Ws)}function xc(){for(;null!==Ws&&!Sa();)Rc(Ws)}function Rc(e){var t=Us(e.alternate,e,Fs);e.memoizedProps=e.pendingProps,null===t?Mc(e):Ws=t,Ms.current=null}function Mc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ss(n,t,Fs)))return void(Ws=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Fs)||0===(4&n.mode)){for(var r=0,a=n.child;null!==a;)r|=a.lanes|a.childLanes,a=a.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=cs(t)))return n.flags&=2047,void(Ws=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ws=t);Ws=t=e}while(null!==t);0===Hs&&(Hs=5)}function kc(e){var t=za();return ja(99,Ec.bind(null,e,t)),null}function Ec(e,t){do{Vc()}while(null!==ec);if(0!==(48&ks))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var r=n.lanes|n.childLanes,a=r,i=e.pendingLanes&~a;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=a,e.mutableReadLanes&=a,e.entangledLanes&=a,a=e.entanglements;for(var s=e.eventTimes,c=e.expirationTimes;0<i;){var u=31-zt(i),l=1<<u;a[u]=0,s[u]=-1,c[u]=-1,i&=~l}if(null!==ac&&0===(24&r)&&ac.has(e)&&ac.delete(e),e===Es&&(Ws=Es=null,Vs=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(a=ks,ks|=32,Ms.current=null,Nr=Qt,fr(s=Cr())){if("selectionStart"in s)c={start:s.selectionStart,end:s.selectionEnd};else e:if(c=(c=s.ownerDocument)&&c.defaultView||window,(l=c.getSelection&&c.getSelection())&&0!==l.rangeCount){c=l.anchorNode,i=l.anchorOffset,u=l.focusNode,l=l.focusOffset;try{c.nodeType,u.nodeType}catch(_){c=null;break e}var g=0,d=-1,I=-1,A=0,h=0,C=s,f=null;t:for(;;){for(var p;C!==c||0!==i&&3!==C.nodeType||(d=g+i),C!==u||0!==l&&3!==C.nodeType||(I=g+l),3===C.nodeType&&(g+=C.nodeValue.length),null!==(p=C.firstChild);)f=C,C=p;for(;;){if(C===s)break t;if(f===c&&++A===i&&(d=g),f===u&&++h===l&&(I=g),null!==(p=C.nextSibling))break;f=(C=f).parentNode}C=p}c=-1===d||-1===I?null:{start:d,end:I}}else c=null;c=c||{start:0,end:0}}else c=null;Yr={focusedElem:s,selectionRange:c},Qt=!1,lc=null,gc=!1,Qs=r;do{try{Wc()}catch(_){if(null===Qs)throw Error(o(330));Lc(Qs,_),Qs=Qs.nextEffect}}while(null!==Qs);lc=null,Qs=r;do{try{for(s=e;null!==Qs;){var m=Qs.flags;if(16&m&&pe(Qs.stateNode,""),128&m){var v=Qs.alternate;if(null!==v){var b=v.ref;null!==b&&("function"===typeof b?b(null):b.current=null)}}switch(1038&m){case 2:ys(Qs),Qs.flags&=-3;break;case 6:ys(Qs),Qs.flags&=-3,_s(Qs.alternate,Qs);break;case 1024:Qs.flags&=-1025;break;case 1028:Qs.flags&=-1025,_s(Qs.alternate,Qs);break;case 4:_s(Qs.alternate,Qs);break;case 8:ws(s,c=Qs);var y=c.alternate;vs(c),null!==y&&vs(y)}Qs=Qs.nextEffect}}catch(_){if(null===Qs)throw Error(o(330));Lc(Qs,_),Qs=Qs.nextEffect}}while(null!==Qs);if(b=Yr,v=Cr(),m=b.focusedElem,s=b.selectionRange,v!==m&&m&&m.ownerDocument&&hr(m.ownerDocument.documentElement,m)){null!==s&&fr(m)&&(v=s.start,void 0===(b=s.end)&&(b=v),"selectionStart"in m?(m.selectionStart=v,m.selectionEnd=Math.min(b,m.value.length)):(b=(v=m.ownerDocument||document)&&v.defaultView||window).getSelection&&(b=b.getSelection(),c=m.textContent.length,y=Math.min(s.start,c),s=void 0===s.end?y:Math.min(s.end,c),!b.extend&&y>s&&(c=s,s=y,y=c),c=Ar(m,y),i=Ar(m,s),c&&i&&(1!==b.rangeCount||b.anchorNode!==c.node||b.anchorOffset!==c.offset||b.focusNode!==i.node||b.focusOffset!==i.offset)&&((v=v.createRange()).setStart(c.node,c.offset),b.removeAllRanges(),y>s?(b.addRange(v),b.extend(i.node,i.offset)):(v.setEnd(i.node,i.offset),b.addRange(v))))),v=[];for(b=m;b=b.parentNode;)1===b.nodeType&&v.push({element:b,left:b.scrollLeft,top:b.scrollTop});for("function"===typeof m.focus&&m.focus(),m=0;m<v.length;m++)(b=v[m]).element.scrollLeft=b.left,b.element.scrollTop=b.top}Qt=!!Nr,Yr=Nr=null,e.current=n,Qs=r;do{try{for(m=e;null!==Qs;){var B=Qs.flags;if(36&B&&fs(m,Qs.alternate,Qs),128&B){v=void 0;var G=Qs.ref;if(null!==G){var w=Qs.stateNode;Qs.tag,v=w,"function"===typeof G?G(v):G.current=v}}Qs=Qs.nextEffect}}catch(_){if(null===Qs)throw Error(o(330));Lc(Qs,_),Qs=Qs.nextEffect}}while(null!==Qs);Qs=null,Ha(),ks=a}else e.current=n;if($s)$s=!1,ec=e,tc=t;else for(Qs=r;null!==Qs;)t=Qs.nextEffect,Qs.nextEffect=null,8&Qs.flags&&((B=Qs).sibling=null,B.stateNode=null),Qs=t;if(0===(r=e.pendingLanes)&&(qs=null),1===r?e===oc?ic++:(ic=0,oc=e):ic=0,n=n.stateNode,Ga&&"function"===typeof Ga.onCommitFiberRoot)try{Ga.onCommitFiberRoot(Ba,n,void 0,64===(64&n.current.flags))}catch(_){}if(Cc(e,Ta()),Ps)throw Ps=!1,e=Js,Js=null,e;return 0!==(8&ks)||Ua(),null}function Wc(){for(;null!==Qs;){var e=Qs.alternate;gc||null===lc||(0!==(8&Qs.flags)?et(Qs,lc)&&(gc=!0):13===Qs.tag&&Ss(e,Qs)&&et(Qs,lc)&&(gc=!0));var t=Qs.flags;0!==(256&t)&&Cs(e,Qs),0===(512&t)||$s||($s=!0,Da(97,(function(){return Vc(),null}))),Qs=Qs.nextEffect}}function Vc(){if(90!==tc){var e=97<tc?97:tc;return tc=90,ja(e,Hc)}return!1}function Fc(e,t){nc.push(t,e),$s||($s=!0,Da(97,(function(){return Vc(),null})))}function Xc(e,t){rc.push(t,e),$s||($s=!0,Da(97,(function(){return Vc(),null})))}function Hc(){if(null===ec)return!1;var e=ec;if(ec=null,0!==(48&ks))throw Error(o(331));var t=ks;ks|=32;var n=rc;rc=[];for(var r=0;r<n.length;r+=2){var a=n[r],i=n[r+1],s=a.destroy;if(a.destroy=void 0,"function"===typeof s)try{s()}catch(u){if(null===i)throw Error(o(330));Lc(i,u)}}for(n=nc,nc=[],r=0;r<n.length;r+=2){a=n[r],i=n[r+1];try{var c=a.create;a.destroy=c()}catch(u){if(null===i)throw Error(o(330));Lc(i,u)}}for(c=e.current.firstEffect;null!==c;)e=c.nextEffect,c.nextEffect=null,8&c.flags&&(c.sibling=null,c.stateNode=null),c=e;return ks=t,Ua(),!0}function Oc(e,t,n){gi(e,t=ds(0,t=us(n,t),1)),t=dc(),null!==(e=hc(e,1))&&(Tt(e,1,t),Cc(e,t))}function Lc(e,t){if(3===e.tag)Oc(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Oc(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qs||!qs.has(r))){var a=Is(n,e=us(t,e),1);if(gi(n,a),a=dc(),null!==(n=hc(n,1)))Tt(n,1,a),Cc(n,a);else if("function"===typeof r.componentDidCatch&&(null===qs||!qs.has(r)))try{r.componentDidCatch(t,e)}catch(i){}break}}n=n.return}}function Nc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=dc(),e.pingedLanes|=e.suspendedLanes&n,Es===e&&(Vs&n)===n&&(4===Hs||3===Hs&&(62914560&Vs)===Vs&&500>Ta()-Ks?Gc(e,0):Ts|=n),Cc(e,t)}function Yc(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===za()?1:2:(0===cc&&(cc=Ls),0===(t=Nt(62914560&~cc))&&(t=4194304))),n=dc(),null!==(e=hc(e,t))&&(Tt(e,t,n),Cc(e,n))}function Tc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function zc(e,t,n,r){return new Tc(e,t,n,r)}function Kc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jc(e,t){var n=e.alternate;return null===n?((n=zc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Dc(e,t,n,r,a,i){var s=2;if(r=e,"function"===typeof e)Kc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case G:return Uc(n.children,a,i,t);case F:s=8,a|=16;break;case w:s=8,a|=1;break;case _:return(e=zc(12,n,t,8|a)).elementType=_,e.type=_,e.lanes=i,e;case R:return(e=zc(13,n,t,a)).type=R,e.elementType=R,e.lanes=i,e;case M:return(e=zc(19,n,t,a)).elementType=M,e.lanes=i,e;case X:return Qc(n,a,i,t);case H:return(e=zc(24,n,t,a)).elementType=H,e.lanes=i,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case Z:s=10;break e;case S:s=9;break e;case x:s=11;break e;case k:s=14;break e;case E:s=16,r=null;break e;case W:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=zc(s,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function Uc(e,t,n,r){return(e=zc(7,e,r,t)).lanes=n,e}function Qc(e,t,n,r){return(e=zc(23,e,r,t)).elementType=X,e.lanes=n,e}function Pc(e,t,n){return(e=zc(6,e,null,t)).lanes=n,e}function Jc(e,t,n){return(t=zc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qc(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Yt(0),this.expirationTimes=Yt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yt(0),this.mutableSourceEagerHydrationData=null}function $c(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:B,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function eu(e,t,n,r){var a=t.current,i=dc(),s=Ic(a);e:if(n){t:{if(Pe(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var c=n;do{switch(c.tag){case 3:c=c.stateNode.context;break t;case 1:if(fa(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break t}}c=c.return}while(null!==c);throw Error(o(171))}if(1===n.tag){var u=n.type;if(fa(u)){n=va(n,u,c);break e}}n=c}else n=da;return null===t.context?t.context=n:t.pendingContext=n,(t=li(i,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),gi(a,t),Ac(a,s,i),s}function tu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function nu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ru(e,t){nu(e,t),(e=e.alternate)&&nu(e,t)}function au(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new qc(e,t,null!=n&&!0===n.hydrate),t=zc(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,ci(t),e[ea]=n.current,kr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var a=(t=r[e])._getVersion;a=a(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,a]:n.mutableSourceEagerHydrationData.push(t,a)}this._internalRoot=n}function iu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ou(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i._internalRoot;if("function"===typeof a){var s=a;a=function(){var e=tu(o);s.call(e)}}eu(t,o,e,a)}else{if(i=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new au(e,0,t?{hydrate:!0}:void 0)}(n,r),o=i._internalRoot,"function"===typeof a){var c=a;a=function(){var e=tu(o);c.call(e)}}bc((function(){eu(t,o,e,a)}))}return tu(o)}function su(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!iu(t))throw Error(o(200));return $c(e,t,null,n)}Us=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||Aa.current)Xo=!0;else{if(0===(n&r)){switch(Xo=!1,t.tag){case 3:Do(t),Di();break;case 5:Vi(t);break;case 1:fa(t.type)&&ba(t);break;case 4:Ei(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var a=t.type._context;ga(qa,a._currentValue),a._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?qo(e,t,n):(ga(Xi,1&Xi.current),null!==(t=is(e,t,n))?t.sibling:null);ga(Xi,1&Xi.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return as(e,t,n);t.flags|=64}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),ga(Xi,Xi.current),r)break;return null;case 23:case 24:return t.lanes=0,Yo(e,t,n)}return is(e,t,n)}Xo=0!==(16384&e.flags)}else Xo=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=Ca(t,Ia.current),ii(t,n),a=oo(null,t,r,e,a,n),t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,fa(r)){var i=!0;ba(t)}else i=!1;t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,ci(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&Ci(t,r,s,e),a.updater=fi,t.stateNode=a,a._reactInternals=t,bi(t,r,e,n),t=jo(null,t,r,!0,i,n)}else t.tag=0,Ho(null,t,a,n),t=t.child;return t;case 16:a=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=(i=a._init)(a._payload),t.type=a,i=t.tag=function(e){if("function"===typeof e)return Kc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===x)return 11;if(e===k)return 14}return 2}(a),e=Ja(a,e),i){case 0:t=zo(null,t,a,e,n);break e;case 1:t=Ko(null,t,a,e,n);break e;case 11:t=Oo(null,t,a,e,n);break e;case 14:t=Lo(null,t,a,Ja(a.type,e),r,n);break e}throw Error(o(306,a,""))}return t;case 0:return r=t.type,a=t.pendingProps,zo(e,t,r,a=t.elementType===r?a:Ja(r,a),n);case 1:return r=t.type,a=t.pendingProps,Ko(e,t,r,a=t.elementType===r?a:Ja(r,a),n);case 3:if(Do(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,a=null!==(a=t.memoizedState)?a.element:null,ui(e,t),Ii(t,r,null,n),(r=t.memoizedState.element)===a)Di(),t=is(e,t,n);else{if((i=(a=t.stateNode).hydrate)&&(Li=Ur(t.stateNode.containerInfo.firstChild),Oi=t,i=Ni=!0),i){if(null!=(e=a.mutableSourceEagerHydrationData))for(a=0;a<e.length;a+=2)(i=e[a])._workInProgressVersionPrimary=e[a+1],Ui.push(i);for(n=Zi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ho(e,t,r,n),Di();t=t.child}return t;case 5:return Vi(t),null===e&&zi(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,s=a.children,zr(r,a)?s=null:null!==i&&zr(r,i)&&(t.flags|=16),To(e,t),Ho(e,t,s,n),t.child;case 6:return null===e&&zi(t),null;case 13:return qo(e,t,n);case 4:return Ei(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=_i(t,null,r,n):Ho(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,Oo(e,t,r,a=t.elementType===r?a:Ja(r,a),n);case 7:return Ho(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ho(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,a=t.pendingProps,s=t.memoizedProps,i=a.value;var c=t.type._context;if(ga(qa,c._currentValue),c._currentValue=i,null!==s)if(c=s.value,0===(i=lr(c,i)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(c,i):1073741823))){if(s.children===a.children&&!Aa.current){t=is(e,t,n);break e}}else for(null!==(c=t.child)&&(c.return=t);null!==c;){var u=c.dependencies;if(null!==u){s=c.child;for(var l=u.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&i)){1===c.tag&&((l=li(-1,n&-n)).tag=2,gi(c,l)),c.lanes|=n,null!==(l=c.alternate)&&(l.lanes|=n),ai(c.return,n),u.lanes|=n;break}l=l.next}}else s=10===c.tag&&c.type===t.type?null:c.child;if(null!==s)s.return=c;else for(s=c;null!==s;){if(s===t){s=null;break}if(null!==(c=s.sibling)){c.return=s.return,s=c;break}s=s.return}c=s}Ho(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=(i=t.pendingProps).children,ii(t,n),r=r(a=oi(a,i.unstable_observedBits)),t.flags|=1,Ho(e,t,r,n),t.child;case 14:return i=Ja(a=t.type,t.pendingProps),Lo(e,t,a,i=Ja(a.type,i),r,n);case 15:return No(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Ja(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,fa(r)?(e=!0,ba(t)):e=!1,ii(t,n),mi(t,r,a),bi(t,r,a,n),jo(null,t,r,!0,e,n);case 19:return as(e,t,n);case 23:case 24:return Yo(e,t,n)}throw Error(o(156,t.tag))},au.prototype.render=function(e){eu(e,this._internalRoot,null,null)},au.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;eu(null,e,null,(function(){t[ea]=null}))},tt=function(e){13===e.tag&&(Ac(e,4,dc()),ru(e,4))},nt=function(e){13===e.tag&&(Ac(e,67108864,dc()),ru(e,67108864))},rt=function(e){if(13===e.tag){var t=dc(),n=Ic(e);Ac(e,n,t),ru(e,n)}},at=function(e,t){return t()},Ze=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=ia(r);if(!a)throw Error(o(90));J(r),ne(r,a)}}}break;case"textarea":ue(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},Ee=vc,We=function(e,t,n,r,a){var i=ks;ks|=4;try{return ja(98,e.bind(null,t,n,r,a))}finally{0===(ks=i)&&(Ds(),Ua())}},Ve=function(){0===(49&ks)&&(function(){if(null!==ac){var e=ac;ac=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,Cc(e,Ta())}))}Ua()}(),Vc())},Fe=function(e,t){var n=ks;ks|=2;try{return e(t)}finally{0===(ks=n)&&(Ds(),Ua())}};var cu={Events:[ra,aa,ia,Me,ke,Vc,{current:!1}]},uu={findFiberByHostInstance:na,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},lu={bundleType:uu.bundleType,version:uu.version,rendererPackageName:uu.rendererPackageName,rendererConfig:uu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:uu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var gu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gu.isDisabled&&gu.supportsFiber)try{Ba=gu.inject(lu),Ga=gu}catch(Ce){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cu,t.createPortal=su,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=$e(t))?null:e.stateNode},t.flushSync=function(e,t){var n=ks;if(0!==(48&n))return e(t);ks|=1;try{if(e)return ja(99,e.bind(null,t))}finally{ks=n,Ua()}},t.hydrate=function(e,t,n){if(!iu(t))throw Error(o(200));return ou(null,e,t,!0,n)},t.render=function(e,t,n){if(!iu(t))throw Error(o(200));return ou(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!iu(e))throw Error(o(40));return!!e._reactRootContainer&&(bc((function(){ou(null,null,e,!1,(function(){e._reactRootContainer=null,e[ea]=null}))})),!0)},t.unstable_batchedUpdates=vc,t.unstable_createPortal=function(e,t){return su(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!iu(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ou(e,t,n,!1,r)},t.version="17.0.2"},function(e,t,n){"use strict";var r,a,i,o;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var c=Date,u=c.now();t.unstable_now=function(){return c.now()-u}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,g=null,d=function e(){if(null!==l)try{var n=t.unstable_now();l(!0,n),l=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==l?setTimeout(r,0,e):(l=e,setTimeout(d,0))},a=function(e,t){g=setTimeout(e,t)},i=function(){clearTimeout(g)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var I=window.setTimeout,A=window.clearTimeout;if("undefined"!==typeof console){var h=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof h&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var C=!1,f=null,p=-1,m=5,v=0;t.unstable_shouldYield=function(){return t.unstable_now()>=v},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m=0<e?Math.floor(1e3/e):5};var b=new MessageChannel,y=b.port2;b.port1.onmessage=function(){if(null!==f){var e=t.unstable_now();v=e+m;try{f(!0,e)?y.postMessage(null):(C=!1,f=null)}catch(n){throw y.postMessage(null),n}}else C=!1},r=function(e){f=e,C||(C=!0,y.postMessage(null))},a=function(e,n){p=I((function(){e(t.unstable_now())}),n)},i=function(){A(p),p=-1}}function B(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,a=e[r];if(!(void 0!==a&&0<_(a,t)))break e;e[r]=t,e[n]=a,n=r}}function G(e){return void 0===(e=e[0])?null:e}function w(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length;r<a;){var i=2*(r+1)-1,o=e[i],s=i+1,c=e[s];if(void 0!==o&&0>_(o,n))void 0!==c&&0>_(c,o)?(e[r]=c,e[s]=n,r=s):(e[r]=o,e[i]=n,r=i);else{if(!(void 0!==c&&0>_(c,n)))break e;e[r]=c,e[s]=n,r=s}}}return t}return null}function _(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var Z=[],S=[],x=1,R=null,M=3,k=!1,E=!1,W=!1;function V(e){for(var t=G(S);null!==t;){if(null===t.callback)w(S);else{if(!(t.startTime<=e))break;w(S),t.sortIndex=t.expirationTime,B(Z,t)}t=G(S)}}function F(e){if(W=!1,V(e),!E)if(null!==G(Z))E=!0,r(X);else{var t=G(S);null!==t&&a(F,t.startTime-e)}}function X(e,n){E=!1,W&&(W=!1,i()),k=!0;var r=M;try{for(V(n),R=G(Z);null!==R&&(!(R.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=R.callback;if("function"===typeof o){R.callback=null,M=R.priorityLevel;var s=o(R.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?R.callback=s:R===G(Z)&&w(Z),V(n)}else w(Z);R=G(Z)}if(null!==R)var c=!0;else{var u=G(S);null!==u&&a(F,u.startTime-n),c=!1}return c}finally{R=null,M=r,k=!1}}var H=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){E||k||(E=!0,r(X))},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_getFirstCallbackNode=function(){return G(Z)},t.unstable_next=function(e){switch(M){case 1:case 2:case 3:var t=3;break;default:t=M}var n=M;M=t;try{return e()}finally{M=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=H,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=M;M=e;try{return t()}finally{M=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var c=-1;break;case 2:c=250;break;case 5:c=1073741823;break;case 4:c=1e4;break;default:c=5e3}return e={id:x++,callback:n,priorityLevel:e,startTime:o,expirationTime:c=o+c,sortIndex:-1},o>s?(e.sortIndex=o,B(S,e),null===G(Z)&&e===G(S)&&(W?i():W=!0,a(F,o-s))):(e.sortIndex=c,B(Z,e),E||k||(E=!0,r(X))),e},t.unstable_wrapCallback=function(e){var t=M;return function(){var n=M;M=t;try{return e.apply(this,arguments)}finally{M=n}}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="1.2.5"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.3.40"},function(e,t,n){var r=n(38);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t,r)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(117).default,a=n(59);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return a(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(17),a=n(50).default,i=n(19).default,o=n(20).default,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTracker=void 0;var c=n(45),u=n(33),l=function(){function e(t,n){var r=this;i(this,e),this._pipeline=t,this.onVisible=new c.Event1,this.onNotVisible=new c.Event1,this.onNewAnchor=new c.Event1,this.visible=new Set,this.anchors=new Map,this._visibleLastFrame=new Set,this._frameUpdate=function(){var e=new Set,t=r.visible;r.visible=r._visibleLastFrame,r._visibleLastFrame=t,r.visible.clear();for(var n=r._z.image_tracker_anchor_count(r._impl),i=function(t){var n=r._z.image_tracker_anchor_id(r._impl,t),a=r.anchors.get(n);a||(a={onVisible:new c.Event,onNotVisible:new c.Event,id:n,poseCameraRelative:function(e){return r._z.image_tracker_anchor_pose_camera_relative(r._impl,t,!0===e)},pose:function(e,n){return r._z.image_tracker_anchor_pose(r._impl,t,e,!0===n)},visible:!0},!0,r.anchors.set(n,a),e.add(a)),a.visible=!0,r.visible.add(a)},o=0;o<n;o++)i(o);var s,u=a(e);try{for(u.s();!(s=u.n()).done;){var l=s.value;r.onNewAnchor.emit(l)}}catch(f){u.e(f)}finally{u.f()}var g,d=a(r.visible);try{for(d.s();!(g=d.n()).done;){var I=g.value;r._visibleLastFrame.has(I)?r._visibleLastFrame.delete(I):(r.onVisible.emit(I),I.onVisible.emit())}}catch(f){d.e(f)}finally{d.f()}var A,h=a(r._visibleLastFrame);try{for(h.s();!(A=h.n()).done;){var C=A.value;r.onNotVisible.emit(C),C.onNotVisible.emit()}}catch(f){h.e(f)}finally{h.f()}},this._pipeline._onFrameUpdateInternal.bind(this._frameUpdate),this._z=u.z(),this._impl=this._z.image_tracker_create(this._pipeline._getImpl()),n&&this.loadTarget(n)}return o(e,[{key:"destroy",value:function(){this._pipeline._onFrameUpdateInternal.unbind(this._frameUpdate),this.anchors.clear(),this.visible.clear(),this._z.image_tracker_destroy(this._impl)}},{key:"loadTarget",value:function(e){return s(this,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof e){t.next=6;break}return t.next=3,fetch(e);case 3:return t.next=5,t.sent.arrayBuffer();case 5:e=t.sent;case 6:this._z.image_tracker_target_load_from_memory(this._impl,e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"enabled",get:function(){return this._z.image_tracker_enabled(this._impl)},set:function(e){this._z.image_tracker_enabled_set(this._impl,e)}}]),e}();t.ImageTracker=l},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(M){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof C?t:C,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r=g;return function(a,i){if(r===I)throw new Error("Generator is already running");if(r===A){if("throw"===a)throw i;return R()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===g)throw r=A,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=I;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?A:d,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=A,n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}e.wrap=u;var g="suspendedStart",d="suspendedYield",I="executing",A="completed",h={};function C(){}function f(){}function p(){}var m={};c(m,i,(function(){return this}));var v=Object.getPrototypeOf,b=v&&v(v(x([])));b&&b!==n&&r.call(b,i)&&(m=b);var y=p.prototype=C.prototype=Object.create(m);function B(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function G(e,t){function n(a,i,o,s){var c=l(e[a],e,i);if("throw"!==c.type){var u=c.arg,g=u.value;return g&&"object"===typeof g&&r.call(g,"__await")?t.resolve(g.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(g).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(i,i):i()}}function w(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,w(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var a=l(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function x(e){if(e){var n=e[i];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return f.prototype=p,c(y,"constructor",p),c(p,"constructor",f),f.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},B(G.prototype),c(G.prototype,o,(function(){return this})),e.AsyncIterator=G,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new G(u(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},B(y),c(y,s,"Generator"),c(y,i,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(Z),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return s.type="throw",s.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Z(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;Z(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=r}catch(a){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";var r=n(17),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initialize=void 0;var i,o=n(121),s=n(79),c=n(71),u=n(36),l=n(124),g=n(129),d=n(131),I=n(72),A=n(135),h=n(83),C=n(138),f=n(140),p=n(46);function m(e){return a(this,void 0,void 0,r.mark((function t(){var a,o,s;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0!==(a=n(142)).default&&(a=a.default),t.next=4,fetch(a);case 4:return o=t.sent,t.next=7,o.arrayBuffer();case 7:s=t.sent,null===i||void 0===i||i.face_tracker_model_load_from_memory(e,s);case 9:case"end":return t.stop()}}),t)})))}t.initialize=function(){var e=this;if(i)return i;var t=!1;l.launchWorker().then((function(){p.zcout("Fully loaded"),t=!0}));var v=new o.zappar_client((function(e){l.messageManager.postOutgoingMessage({t:"zappar",d:e},[e])}));if(window.location.hostname.toLowerCase().indexOf(".zappar.io")>0){var b=window.location.pathname.split("/");b.length>1&&b[1].length>0&&v.impl.analytics_project_id_set(".wiz"+b[1])}return l.messageManager.onIncomingMessage.bind((function(e){var t,n;switch(e.t){case"zappar":null===(t=I.Pipeline.get(e.p))||void 0===t||t.pendingMessages.push(e.d);break;case"buf":v.serializer.bufferReturn(e.d);break;case"cameraFrameRecycleS2C":var r=e;null===(n=I.Pipeline.get(r.p))||void 0===n||n.cameraTokenReturn(r.token,r.d);break;case"licerr":var a=document.createElement("div");a.innerHTML="Visit <a href='https://docs.zap.works/universal-ar/licensing/' style='color: white;'>our licensing page</a> to find out about hosting on your own domain.",a.style.position="absolute",a.style.bottom="20px",a.style.width="80%",a.style.backgroundColor="black",a.style.color="white",a.style.borderRadius="10px",a.style.padding="10px",a.style.fontFamily="sans-serif",a.style.textAlign="center",a.style.left="10%",a.style.zIndex=Number.MAX_SAFE_INTEGER.toString();var i=document.createElement("span");i.innerText=" (30)",a.append(i);var o=30;setInterval((function(){--o>=0&&(i.innerText=" ("+o.toString()+")")}),1e3),document.body.append(a)}})),i=Object.assign(Object.assign({},v.impl),{loaded:function(){return t},camera_default_device_id:function(e){return e?A.CameraSource.USER_DEFAULT_DEVICE_ID:A.CameraSource.DEFAULT_DEVICE_ID},camera_source_create:function(e,t){return A.CameraSource.create(e,t)},camera_source_destroy:function(e){var t;return null===(t=A.CameraSource.get(e))||void 0===t?void 0:t.destroy()},camera_source_pause:function(e){var t;return null===(t=A.CameraSource.get(e))||void 0===t?void 0:t.pause()},camera_source_start:function(e){var t;return null===(t=A.CameraSource.get(e))||void 0===t?void 0:t.start()},pipeline_create:function(){return I.Pipeline.create(v.impl,l.messageManager)},pipeline_frame_update:function(e){var t;return null===(t=I.Pipeline.get(e))||void 0===t?void 0:t.frameUpdate(v)},pipeline_camera_frame_draw_gl:function(e,t,n,r){var a;null===(a=I.Pipeline.get(e))||void 0===a||a.cameraFrameDrawGL(t,n,r)},draw_plane:function(e,t,n,r,a){s.drawPlane(e,t,n,r,a)},pipeline_draw_face:function(e,t,n,r,a){var i,o=d.getFaceMesh(a);if(!o)return p.zcwarn("attempting to call draw_face on a destroyed zappar_face_mesh_t"),new Uint16Array;null===(i=I.Pipeline.get(e))||void 0===i||i.drawFace(t,n,r,o)},pipeline_draw_face_project:function(e,t,n,r,a,i,o){var s;null===(s=I.Pipeline.get(e))||void 0===s||s.drawFaceProject(t,n,r,a,i,o)},projection_matrix_from_camera_model:c.projectionMatrix,projection_matrix_from_camera_model_ext:c.projectionMatrix,pipeline_process_gl:function(e){var t;return null===(t=I.Pipeline.get(e))||void 0===t?void 0:t.processGL()},pipeline_gl_context_set:function(e,t,n){var r;return null===(r=I.Pipeline.get(e))||void 0===r?void 0:r.glContextSet(t,n)},pipeline_gl_context_lost:function(e){var t;return null===(t=I.Pipeline.get(e))||void 0===t?void 0:t.glContextLost()},pipeline_camera_frame_upload_gl:function(){},pipeline_camera_frame_texture_gl:function(e){var t;return null===(t=I.Pipeline.get(e))||void 0===t?void 0:t.cameraFrameTexture()},pipeline_camera_frame_texture_matrix:function(e,t,n,r){var a;return(null===(a=I.Pipeline.get(e))||void 0===a?void 0:a.cameraFrameTextureMatrix(t,n,r))||u.mat4.create()},pipeline_camera_frame_user_facing:function(e){var t;return(null===(t=I.Pipeline.get(e))||void 0===t?void 0:t.cameraFrameUserFacing())||!1},pipeline_camera_pose_default:function(){return u.mat4.create()},pipeline_camera_pose_with_attitude:function(e,t){var n;return(null===(n=I.Pipeline.get(e))||void 0===n?void 0:n.cameraPoseWithAttitude(t))||u.mat4.create()},pipeline_camera_pose_with_origin:function(e,t){var n=u.mat4.create();return u.mat4.invert(n,t),n},instant_world_tracker_anchor_pose_camera_relative:function(e,t){var n=I.applyScreenCounterRotation(void 0,v.impl.instant_world_tracker_anchor_pose_raw(e));if(t){var r=u.mat4.create();u.mat4.fromScaling(r,[-1,1,1]),u.mat4.multiply(n,r,n),u.mat4.multiply(n,n,r)}return n},instant_world_tracker_anchor_pose:function(e,t,n){var r=I.applyScreenCounterRotation(void 0,v.impl.instant_world_tracker_anchor_pose_raw(e));if(n){var a=u.mat4.create();u.mat4.fromScaling(a,[-1,1,1]),u.mat4.multiply(r,a,r),u.mat4.multiply(r,r,a)}return u.mat4.multiply(r,t,r),r},image_tracker_anchor_pose_camera_relative:function(e,t,n){var r=I.applyScreenCounterRotation(void 0,v.impl.image_tracker_anchor_pose_raw(e,t));if(n){var a=u.mat4.create();u.mat4.fromScaling(a,[-1,1,1]),u.mat4.multiply(r,a,r),u.mat4.multiply(r,r,a)}return r},image_tracker_anchor_pose:function(e,t,n,r){var a=I.applyScreenCounterRotation(void 0,v.impl.image_tracker_anchor_pose_raw(e,t));if(r){var i=u.mat4.create();u.mat4.fromScaling(i,[-1,1,1]),u.mat4.multiply(a,i,a),u.mat4.multiply(a,a,i)}return u.mat4.multiply(a,n,a),a},face_tracker_anchor_pose_camera_relative:function(e,t,n){var r=I.applyScreenCounterRotation(void 0,v.impl.face_tracker_anchor_pose_raw(e,t));if(n){var a=u.mat4.create();u.mat4.fromScaling(a,[-1,1,1]),u.mat4.multiply(r,a,r),u.mat4.multiply(r,r,a)}return r},face_tracker_anchor_pose:function(e,t,n,r){var a=I.applyScreenCounterRotation(void 0,v.impl.face_tracker_anchor_pose_raw(e,t));if(r){var i=u.mat4.create();u.mat4.fromScaling(i,[-1,1,1]),u.mat4.multiply(a,i,a),u.mat4.multiply(a,a,i)}return u.mat4.multiply(a,n,a),a},face_tracker_model_load_default:function(t){return a(e,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:case"end":return e.stop()}}),e)})))},face_mesh_create:function(){return d.createFaceMesh()},face_mesh_destroy:function(e){d.destroyFaceMesh(e)},face_mesh_indices:function(e){var t=d.getFaceMesh(e);return t?t.getIndices():(p.zcwarn("attempting to call face_mesh_indices on a destroyed zappar_face_mesh_t"),new Uint16Array)},face_mesh_indices_size:function(e){var t=d.getFaceMesh(e);return t?t.getIndices().length:(p.zcwarn("attempting to call face_mesh_indices_size on a destroyed zappar_face_mesh_t"),0)},face_mesh_uvs:function(e){var t=d.getFaceMesh(e);return t?t.getUVs():(p.zcwarn("attempting to call face_mesh_uvs on a destroyed zappar_face_mesh_t"),new Float32Array)},face_mesh_uvs_size:function(e){var t=d.getFaceMesh(e);return t?t.getUVs().length:(p.zcwarn("attempting to call face_mesh_uvs_size on a destroyed zappar_face_mesh_t"),0)},face_mesh_vertices:function(e){var t=d.getFaceMesh(e);return t?t.getVertices():(p.zcwarn("attempting to call face_mesh_vertices on a destroyed zappar_face_mesh_t"),new Float32Array)},face_mesh_vertices_size:function(e){var t=d.getFaceMesh(e);return t?t.getVertices().length:(p.zcwarn("attempting to call face_mesh_vertices_size on a destroyed zappar_face_mesh_t"),0)},face_mesh_normals:function(e){var t=d.getFaceMesh(e);return t?t.getNormals():(p.zcwarn("attempting to call face_mesh_normals on a destroyed zappar_face_mesh_t"),new Float32Array)},face_mesh_normals_size:function(e){var t=d.getFaceMesh(e);return t?t.getNormals().length:(p.zcwarn("attempting to call face_mesh_normals_size on a destroyed zappar_face_mesh_t"),0)},face_mesh_load_from_memory:function(e,t,n,r,a,i){var o=d.getFaceMesh(e);o?o.loadFromMemory(t,n,r,a,i):p.zcwarn("attempting to call face_mesh_load_from_memory on a destroyed zappar_face_mesh_t")},face_mesh_update:function(e,t,n,r){var a=d.getFaceMesh(e);a?a.update(t,n,r):p.zcwarn("attempting to call face_mesh_update on a destroyed zappar_face_mesh_t")},face_mesh_load_default:function(t){return a(e,void 0,void 0,r.mark((function e(){var a,i,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.getFaceMesh(t)){e.next=4;break}return p.zcwarn("attempting to call face_mesh_load_default on a destroyed zappar_face_mesh_t"),e.abrupt("return");case 4:return void 0!==(i=n(85)).default&&(i=i.default),e.next=8,fetch(i);case 8:return o=e.sent,e.t0=a,e.next=12,o.arrayBuffer();case 12:e.t1=e.sent,e.t0.loadFromMemory.call(e.t0,e.t1,!1,!1,!1,!1);case 14:case"end":return e.stop()}}),e)})))},face_mesh_load_default_face:function(t,i,o,s){return a(e,void 0,void 0,r.mark((function e(){var a,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.getFaceMesh(t)){e.next=4;break}return p.zcwarn("attempting to call face_mesh_load_default_face on a destroyed zappar_face_mesh_t"),e.abrupt("return");case 4:return void 0!==(c=n(85)).default&&(c=c.default),e.next=8,fetch(c);case 8:return u=e.sent,e.t0=a,e.next=12,u.arrayBuffer();case 12:e.t1=e.sent,e.t2=i,e.t3=o,e.t4=s,e.t0.loadFromMemory.call(e.t0,e.t1,e.t2,e.t3,e.t4,!1);case 17:case"end":return e.stop()}}),e)})))},face_mesh_load_default_full_head_simplified:function(t,i,o,s,c){return a(e,void 0,void 0,r.mark((function e(){var a,u,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.getFaceMesh(t)){e.next=4;break}return p.zcwarn("attempting to call face_mesh_load_default_full_head_simplified on a destroyed zappar_face_mesh_t"),e.abrupt("return");case 4:return void 0!==(u=n(141)).default&&(u=u.default),e.next=8,fetch(u);case 8:return l=e.sent,e.t0=a,e.next=12,l.arrayBuffer();case 12:e.t1=e.sent,e.t2=i,e.t3=o,e.t4=s,e.t5=c,e.t0.loadFromMemory.call(e.t0,e.t1,e.t2,e.t3,e.t4,e.t5);case 18:case"end":return e.stop()}}),e)})))},face_mesh_loaded_version:function(e){var t=d.getFaceMesh(e);return t?t.getModelVersion():(p.zcwarn("attempting to call face_mesh_load_default on a destroyed zappar_face_mesh_t"),-1)},face_landmark_create:function(e){return C.createFaceLandmark(e)},face_landmark_destroy:function(e){C.destroyFaceLandmark(e)},face_landmark_update:function(e,t,n,r){var a=C.getFaceLandmark(e);a?a.update(t,n,r):p.zcwarn("attempting to call face_landmark_update on a destroyed zappar_face_landmark_t")},face_landmark_anchor_pose:function(e){var t=C.getFaceLandmark(e);return t?t.anchor_pose:(p.zcwarn("attempting to call face_landmark_anchor_pose on a destroyed zappar_face_landmark_t"),u.mat4.create())},html_element_source_create:function(e,t){return h.HTMLElementSource.createVideoElementSource(e,t)},html_element_source_start:function(e){var t;return null===(t=h.HTMLElementSource.getVideoElementSource(e))||void 0===t?void 0:t.start()},html_element_source_pause:function(e){var t;return null===(t=h.HTMLElementSource.getVideoElementSource(e))||void 0===t?void 0:t.pause()},html_element_source_destroy:function(e){var t;return null===(t=h.HTMLElementSource.getVideoElementSource(e))||void 0===t?void 0:t.destroy()},permission_granted_all:g.permissionGrantedAll,permission_granted_camera:g.permissionGrantedCamera,permission_granted_motion:g.permissionGrantedMotion,permission_denied_any:g.permissionDeniedAny,permission_denied_camera:g.permissionDeniedCamera,permission_denied_motion:g.permissionDeniedMotion,permission_request_motion:g.permissionRequestMotion,permission_request_camera:g.permissionRequestCamera,permission_request_all:g.permissionRequestAll,permission_request_ui:g.permissionRequestUI,permission_request_ui_promise:g.permissionRequestUI,permission_denied_ui:g.permissionDeniedUI,browser_incompatible:f.default.incompatible,browser_incompatible_ui:f.default.incompatible_ui,log_level_set:function(e){p.setLogLevel(e),v.impl.log_level_set(e)}})}},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.zappar_client=void 0;var i=n(122),o=n(123),s=function(){function e(t){var n=this;r(this,e),this._messageSender=t,this._globalState={log_level:1},this.serializer=new i.MessageSerializer((function(e){n._messageSender(e)})),this.deserializer=new o.MessageDeserializer,this._latestId=1,this._pipeline_state_by_instance=new Map,this._camera_source_state_by_instance=new Map,this._image_tracker_state_by_instance=new Map,this._face_tracker_state_by_instance=new Map,this._face_mesh_state_by_instance=new Map,this._face_landmark_state_by_instance=new Map,this._barcode_finder_state_by_instance=new Map,this._instant_world_tracker_state_by_instance=new Map,this.impl={log_level:function(){return n._globalState.log_level},log_level_set:function(e){n.serializer.sendMessage(33,(function(t){t.logLevel(e)}))},analytics_project_id_set:function(e){n.serializer.sendMessage(30,(function(t){t.string(e)}))},pipeline_create:function(){var e=n._latestId++,t={current_frame_user_data:0,camera_model:new Float32Array([300,300,160,120,0,0]),camera_pose:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),camera_frame_camera_attitude:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),frame_number:0};return n._pipeline_state_by_instance.set(e,t),n.serializer.sendMessage(26,(function(t){t.type(e)})),e},pipeline_destroy:function(e){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n._pipeline_state_by_instance.delete(e),n.serializer.sendMessage(27,(function(t){t.type(e)}))},pipeline_frame_update:function(e){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(9,(function(t){t.type(e)}))},pipeline_frame_number:function(e){var t=n._pipeline_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.frame_number},pipeline_camera_model:function(e){var t=n._pipeline_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.camera_model},pipeline_camera_frame_user_data:function(e){var t=n._pipeline_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.current_frame_user_data},pipeline_camera_frame_submit:function(e,t,r,a,i,o){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(8,(function(n){n.type(e),n.dataWithLength(t),n.int(r),n.int(a),n.int(i),n.matrix4x4(o)}))},pipeline_camera_frame_camera_attitude:function(e){var t=n._pipeline_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.camera_frame_camera_attitude},pipeline_motion_accelerometer_submit:function(e,t,r,a,i){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(10,(function(n){n.type(e),n.timestamp(t),n.float(r),n.float(a),n.float(i)}))},pipeline_motion_rotation_rate_submit:function(e,t,r,a,i){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(11,(function(n){n.type(e),n.timestamp(t),n.float(r),n.float(a),n.float(i)}))},pipeline_motion_attitude_submit:function(e,t,r,a,i){if(!n._pipeline_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(12,(function(n){n.type(e),n.timestamp(t),n.float(r),n.float(a),n.float(i)}))},camera_source_create:function(e,t){var r=n._latestId++;return n._camera_source_state_by_instance.set(r,{}),n.serializer.sendMessage(28,(function(n){n.type(r),n.type(e),n.string(t)})),r},camera_source_destroy:function(e){if(!n._camera_source_state_by_instance.get(e))throw new Error("This object has been destroyed");n._camera_source_state_by_instance.delete(e),n.serializer.sendMessage(29,(function(t){t.type(e)}))},image_tracker_create:function(e){var t=n._latestId++;return n._image_tracker_state_by_instance.set(t,{enabled:!0,target_loaded_version:-1,target_count:0,anchor_count:0,anchor_id:[],anchor_pose:[]}),n.serializer.sendMessage(2,(function(n){n.type(t),n.type(e)})),t},image_tracker_destroy:function(e){if(!n._image_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n._image_tracker_state_by_instance.delete(e),n.serializer.sendMessage(13,(function(t){t.type(e)}))},image_tracker_target_load_from_memory:function(e,t){if(!n._image_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(4,(function(n){n.type(e),n.dataWithLength(t)}))},image_tracker_target_loaded_version:function(e){var t=n._image_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.target_loaded_version},image_tracker_target_count:function(e){var t=n._image_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.target_count},image_tracker_enabled:function(e){var t=n._image_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.enabled},image_tracker_enabled_set:function(e,t){if(!n._image_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(3,(function(n){n.type(e),n.bool(t)}))},image_tracker_anchor_count:function(e){var t=n._image_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.anchor_count},image_tracker_anchor_id:function(e,t){var r=n._image_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_id[t]},image_tracker_anchor_pose_raw:function(e,t){var r=n._image_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_pose[t]},face_tracker_create:function(e){var t=n._latestId++;return n._face_tracker_state_by_instance.set(t,{enabled:!0,model_loaded:-1,max_faces:1,anchor_count:0,anchor_id:[],anchor_pose:[],anchor_identity_coefficients:[],anchor_expression_coefficients:[]}),n.serializer.sendMessage(19,(function(n){n.type(t),n.type(e)})),t},face_tracker_destroy:function(e){if(!n._face_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n._face_tracker_state_by_instance.delete(e),n.serializer.sendMessage(20,(function(t){t.type(e)}))},face_tracker_model_load_from_memory:function(e,t){if(!n._face_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(21,(function(n){n.type(e),n.dataWithLength(t)}))},face_tracker_model_loaded_version:function(e){var t=n._face_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.model_loaded},face_tracker_enabled_set:function(e,t){if(!n._face_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(22,(function(n){n.type(e),n.bool(t)}))},face_tracker_enabled:function(e){var t=n._face_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.enabled},face_tracker_max_faces_set:function(e,t){if(!n._face_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(23,(function(n){n.type(e),n.int(t)}))},face_tracker_max_faces:function(e){var t=n._face_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.max_faces},face_tracker_anchor_count:function(e){var t=n._face_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.anchor_count},face_tracker_anchor_id:function(e,t){var r=n._face_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_id[t]},face_tracker_anchor_pose_raw:function(e,t){var r=n._face_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_pose[t]},face_tracker_anchor_identity_coefficients:function(e,t){var r=n._face_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_identity_coefficients[t]},face_tracker_anchor_expression_coefficients:function(e,t){var r=n._face_tracker_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.anchor_expression_coefficients[t]},face_mesh_create:function(){var e=n._latestId++;return n._face_mesh_state_by_instance.set(e,{}),n.serializer.sendMessage(24,(function(t){t.type(e)})),e},face_mesh_destroy:function(e){if(!n._face_mesh_state_by_instance.get(e))throw new Error("This object has been destroyed");n._face_mesh_state_by_instance.delete(e),n.serializer.sendMessage(25,(function(t){t.type(e)}))},face_landmark_create:function(e){var t=n._latestId++;return n._face_landmark_state_by_instance.set(t,{}),n.serializer.sendMessage(31,(function(n){n.type(t),n.faceLandmarkName(e)})),t},face_landmark_destroy:function(e){if(!n._face_landmark_state_by_instance.get(e))throw new Error("This object has been destroyed");n._face_landmark_state_by_instance.delete(e),n.serializer.sendMessage(32,(function(t){t.type(e)}))},barcode_finder_create:function(e){var t=n._latestId++;return n._barcode_finder_state_by_instance.set(t,{enabled:!0,number_found:0,found_text:[],found_format:[],formats:131071}),n.serializer.sendMessage(15,(function(n){n.type(t),n.type(e)})),t},barcode_finder_destroy:function(e){if(!n._barcode_finder_state_by_instance.get(e))throw new Error("This object has been destroyed");n._barcode_finder_state_by_instance.delete(e),n.serializer.sendMessage(16,(function(t){t.type(e)}))},barcode_finder_enabled_set:function(e,t){if(!n._barcode_finder_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(17,(function(n){n.type(e),n.bool(t)}))},barcode_finder_enabled:function(e){var t=n._barcode_finder_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.enabled},barcode_finder_found_number:function(e){var t=n._barcode_finder_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.number_found},barcode_finder_found_text:function(e,t){var r=n._barcode_finder_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.found_text[t]},barcode_finder_found_format:function(e,t){var r=n._barcode_finder_state_by_instance.get(e);if(!r)throw new Error("This object has been destroyed");return r.found_format[t]},barcode_finder_formats:function(e){var t=n._barcode_finder_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.formats},barcode_finder_formats_set:function(e,t){if(!n._barcode_finder_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(18,(function(n){n.type(e),n.barcodeFormat(t)}))},instant_world_tracker_create:function(e){var t=n._latestId++,r={enabled:!0,pose:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};return n._instant_world_tracker_state_by_instance.set(t,r),n.serializer.sendMessage(5,(function(n){n.type(t),n.type(e)})),t},instant_world_tracker_destroy:function(e){if(!n._instant_world_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n._instant_world_tracker_state_by_instance.delete(e),n.serializer.sendMessage(14,(function(t){t.type(e)}))},instant_world_tracker_enabled_set:function(e,t){if(!n._instant_world_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(6,(function(n){n.type(e),n.bool(t)}))},instant_world_tracker_enabled:function(e){var t=n._instant_world_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.enabled},instant_world_tracker_anchor_pose_raw:function(e){var t=n._instant_world_tracker_state_by_instance.get(e);if(!t)throw new Error("This object has been destroyed");return t.pose},instant_world_tracker_anchor_pose_set_from_camera_offset:function(e,t,r,a,i){if(!n._instant_world_tracker_state_by_instance.get(e))throw new Error("This object has been destroyed");n.serializer.sendMessage(7,(function(n){n.type(e),n.float(t),n.float(r),n.float(a),n.instantTrackerTransformOrientation(i)}))}}}return a(e,[{key:"processMessages",value:function(e){var t=this;this.deserializer.setData(e),this.deserializer.forMessages((function(e,n){switch(e){case 7:var r=n.type(),a=t._pipeline_state_by_instance.get(r);if(!a)return;a.frame_number=n.int();break;case 6:var i=n.type(),o=t._pipeline_state_by_instance.get(i);if(!o)return;o.camera_model=n.cameraModel();break;case 5:var s=n.type(),c=t._pipeline_state_by_instance.get(s);if(!c)return;c.current_frame_user_data=n.int();break;case 11:var u=n.type(),l=t._pipeline_state_by_instance.get(u);if(!l)return;l.camera_frame_camera_attitude=n.matrix4x4();break;case 18:var g=n.type(),d=t._image_tracker_state_by_instance.get(g);if(!d)return;d.target_loaded_version=n.int();break;case 20:var I=n.type(),A=t._image_tracker_state_by_instance.get(I);if(!A)return;A.target_count=n.int();break;case 1:var h=n.type(),C=t._image_tracker_state_by_instance.get(h);if(!C)return;C.anchor_count=n.int();break;case 2:var f=n.type(),p=t._image_tracker_state_by_instance.get(f);if(!p)return;var m=n.int();p.anchor_id[m]=n.string();break;case 3:var v=n.type(),b=t._image_tracker_state_by_instance.get(v);if(!b)return;var y=n.int();b.anchor_pose[y]=n.matrix4x4();break;case 17:var B=n.type(),G=t._face_tracker_state_by_instance.get(B);if(!G)return;G.model_loaded=n.int();break;case 12:var w=n.type(),_=t._face_tracker_state_by_instance.get(w);if(!_)return;_.anchor_count=n.int();break;case 13:var Z=n.type(),S=t._face_tracker_state_by_instance.get(Z);if(!S)return;var x=n.int();S.anchor_id[x]=n.string();break;case 14:var R=n.type(),M=t._face_tracker_state_by_instance.get(R);if(!M)return;var k=n.int();M.anchor_pose[k]=n.matrix4x4();break;case 15:var E=n.type(),W=t._face_tracker_state_by_instance.get(E);if(!W)return;var V=n.int();W.anchor_identity_coefficients[V]=n.identityCoefficients();break;case 16:var F=n.type(),X=t._face_tracker_state_by_instance.get(F);if(!X)return;var H=n.int();X.anchor_expression_coefficients[H]=n.expressionCoefficients();break;case 8:var O=n.type(),L=t._barcode_finder_state_by_instance.get(O);if(!L)return;L.number_found=n.int();break;case 9:var N=n.type(),Y=t._barcode_finder_state_by_instance.get(N);if(!Y)return;var T=n.int();Y.found_text[T]=n.string();break;case 10:var z=n.type(),K=t._barcode_finder_state_by_instance.get(z);if(!K)return;var j=n.int();K.found_format[j]=n.barcodeFormat();break;case 4:var D=n.type(),U=t._instant_world_tracker_state_by_instance.get(D);if(!U)return;U.pose=n.matrix4x4()}}))}}]),e}();t.zappar_client=s},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSerializer=void 0;var i=function(){function e(t){var n=this;r(this,e),this._messageSender=t,this._freeBufferPool=[],this._buffer=new ArrayBuffer(16),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=1,this._startOffset=-1,this._timeoutSet=!1,this._appender={int:function(e){return n.int(e)},bool:function(e){return n.int(e?1:0)},float:function(e){return n.float(e)},string:function(e){return n.string(e)},dataWithLength:function(e){return n.arrayBuffer(e)},type:function(e){return n.int(e)},matrix4x4:function(e){return n.float32ArrayBuffer(e)},identityCoefficients:function(e){return n.float32ArrayBuffer(e)},expressionCoefficients:function(e){return n.float32ArrayBuffer(e)},cameraModel:function(e){return n.float32ArrayBuffer(e)},timestamp:function(e){return n.double(e)},barcodeFormat:function(e){return n.int(e)},faceLandmarkName:function(e){return n.int(e)},instantTrackerTransformOrientation:function(e){return n.int(e)},logLevel:function(e){return n.int(e)}},this._freeBufferPool.push(new ArrayBuffer(16)),this._freeBufferPool.push(new ArrayBuffer(16))}return a(e,[{key:"bufferReturn",value:function(e){this._freeBufferPool.push(e)}},{key:"_ensureArrayBuffer",value:function(e){var t=4*(this._offset+e+8);if(!(this._buffer&&this._buffer.byteLength>=t)){var n=void 0;if(!n){var r=t;r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,n=new ArrayBuffer(r)}var a=this._buffer?this._i32View:void 0;this._buffer=n,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),a&&this._i32View.set(a.subarray(0,this._offset))}}},{key:"sendMessage",value:function(e,t){this._ensureArrayBuffer(4),this._startOffset=this._offset,this._i32View[this._offset+1]=e,this._offset+=2,t(this._appender),this._i32View[this._startOffset]=this._offset-this._startOffset,this._startOffset=-1,this._sendOneTime()}},{key:"_sendOneTime",value:function(){var e=this;!1===this._timeoutSet&&(this._timeoutSet=!0,setTimeout((function(){e._timeoutSet=!1,e._send()}),0))}},{key:"_send",value:function(){0!==this._freeBufferPool.length?(this._i32View[0]=this._offset,this._messageSender(this._buffer),this._buffer=void 0,this._buffer=this._freeBufferPool.pop(),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=1,this._startOffset=-1):this._sendOneTime()}},{key:"int",value:function(e){this._ensureArrayBuffer(1),this._i32View[this._offset]=e,this._offset++}},{key:"double",value:function(e){this._ensureArrayBuffer(2),this._offset%2===1&&this._offset++,this._f64View[this._offset/2]=e,this._offset+=2}},{key:"float",value:function(e){this._ensureArrayBuffer(1),this._f32View[this._offset]=e,this._offset++}},{key:"int32Array",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._i32View[this._offset+t]=e[t];this._offset+=e.length}},{key:"float32Array",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._f32View[this._offset+t]=e[t];this._offset+=e.length}},{key:"booleanArray",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._i32View[this._offset+t]=e[t]?1:0;this._offset+=e.length}},{key:"uint8ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.byteLength,this._offset++,this._u8View.set(e,4*this._offset),this._offset+=e.byteLength>>2,0!==(3&e.byteLength)&&this._offset++}},{key:"arrayBuffer",value:function(e){var t=new Uint8Array(e);this.uint8ArrayBuffer(t)}},{key:"uint8ClampedArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.byteLength,this._offset++,this._u8cView.set(e,4*this._offset),this._offset+=e.byteLength>>2,0!==(3&e.byteLength)&&this._offset++}},{key:"float32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._f32View.set(e,this._offset),this._offset+=e.length}},{key:"uint16ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++;var t=2*this._offset;this._u16View.set(e,t),this._offset+=e.length>>1,0!==(1&e.length)&&this._offset++}},{key:"int32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._i32View.set(e,this._offset),this._offset+=e.length}},{key:"uint32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._u32View.set(e,this._offset),this._offset+=e.length}},{key:"string",value:function(e){var t=(new TextEncoder).encode(e);this._ensureArrayBuffer(t.byteLength/4),this._i32View[this._offset]=t.byteLength,this._offset++,this._u8View.set(t,4*this._offset),this._offset+=t.byteLength>>2,0!==(3&t.byteLength)&&this._offset++}}]),e}();t.MessageSerializer=i},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDeserializer=void 0;var i=function(){function e(){var t=this;r(this,e),this._buffer=new ArrayBuffer(0),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=0,this._length=0,this._startOffset=-1,this._processor={int:function(){return t._i32View[t._startOffset++]},bool:function(){return 1===t._i32View[t._startOffset++]},type:function(){return t._i32View[t._startOffset++]},float:function(){return t._f32View[t._startOffset++]},timestamp:function(){t._startOffset%2===1&&t._startOffset++;var e=t._f64View[t._startOffset/2];return t._startOffset+=2,e},string:function(){var e=t._i32View[t._startOffset++],n=(new TextDecoder).decode(new Uint8Array(t._buffer,4*t._startOffset,e));return t._startOffset+=e>>2,0!==(3&e)&&t._startOffset++,n},dataWithLength:function(){var e=t._i32View[t._startOffset++],n=new Uint8Array(e);return n.set(t._u8View.subarray(4*t._startOffset,4*t._startOffset+e)),t._startOffset+=n.byteLength>>2,0!==(3&n.byteLength)&&t._startOffset++,n.buffer},matrix4x4:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+16)),t._startOffset+=e,n},identityCoefficients:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+50)),t._startOffset+=e,n},expressionCoefficients:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+29)),t._startOffset+=e,n},cameraModel:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+6)),t._startOffset+=e,n},barcodeFormat:function(){return t._i32View[t._startOffset++]},faceLandmarkName:function(){return t._i32View[t._startOffset++]},instantTrackerTransformOrientation:function(){return t._i32View[t._startOffset++]},logLevel:function(){return t._i32View[t._startOffset++]}}}return a(e,[{key:"setData",value:function(e){this._buffer=e,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=0,this._length=0,e.byteLength>=4&&(this._offset=1,this._length=this._i32View[0]),this._startOffset=-1}},{key:"hasMessage",value:function(){return this._offset+1<this._length}},{key:"forMessages",value:function(e){for(;this.hasMessage();){var t=this._i32View[this._offset],n=this._i32View[this._offset+1];this._startOffset=this._offset+2,this._offset+=t,e(n,this._processor)}}}]),e}();t.MessageDeserializer=i},function(e,t,n){"use strict";var r=n(17),a=n(50).default,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.launchWorker=t.messageManager=void 0;var o,s=n(125);function c(e){return new Promise((function(t){e.addEventListener("message",(function n(r){"loaded"===r.data&&(e.removeEventListener("message",n),t())}))}))}t.messageManager=new s.MsgManager,(o="undefined"!==typeof Z_STANDALONE&&Z_STANDALONE?n(126):n(127)).default&&(o=o.default),t.launchWorker=function(){return i(this,void 0,void 0,r.mark((function e(){var i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){var e,n=t.messageManager.getOutgoingMessages(),r=a(n);try{for(r.s();!(e=r.n()).done;){var o=e.value;i.postMessage(o.msg,o.transferables)}}catch(s){r.e(s)}finally{r.f()}},(i=new o).postMessage({t:"wasm",url:n(128).default}),e.next=5,c(i);case 5:t.messageManager.onOutgoingMessage.bind(s),s(),i.addEventListener("message",(function(e){t.messageManager.postIncomingMessage(e.data)}));case 8:case"end":return e.stop()}}),e)})))}},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MsgManager=void 0;var i=n(80),o=function(){function e(){r(this,e),this.onOutgoingMessage=new i.Event,this.onIncomingMessage=new i.Event1,this._outgoingMessages=[]}return a(e,[{key:"postIncomingMessage",value:function(e){this.onIncomingMessage.emit(e)}},{key:"postOutgoingMessage",value:function(e,t){this._outgoingMessages.push({msg:e,transferables:t}),this.onOutgoingMessage.emit()}},{key:"getOutgoingMessages",value:function(){var e=this._outgoingMessages;return this._outgoingMessages=[],e}}]),e}();t.MsgManager=o},function(e,t,n){"use strict";n.r(t);var r=n(98),a=n.n(r);t.default=function(){return a()('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=5)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(3);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){c=!0,o=e},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(6);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(2).default;Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),i=self;a.messageManager.onOutgoingMessage.bind((function(){var e,t=a.messageManager.getOutgoingMessages(),n=r(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;i.postMessage(o.msg,o.transferables)}}catch(u){n.e(u)}finally{n.f()}}));i.addEventListener("message",(function e(t){if(t&&t.data&&"wasm"===t.data.t){var r=location.href.startsWith("blob")?t.data.url:n(24);r.default&&(r=r.default),a.launchWorkerServer(r),i.removeEventListener("message",e)}})),i.addEventListener("message",(function(e){a.messageManager.postIncomingMessage(e.data)}))},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(8),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function u(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,u)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.launchWorkerServer=t.messageManager=void 0;var i=n(10),o=n(14),u=n(15),c=n(22),f=n(25);t.messageManager=new c.MsgManager,t.launchWorkerServer=function(e){return a(this,void 0,void 0,r.mark((function n(){var a;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=i.default({locateFile:function(t,n){return t.endsWith("zcv.wasm")?e:n+t},onRuntimeInitialized:function(){var e=o.getRuntimeObject(a),n=new u.zappar_server(e,(function(e,n){t.messageManager.postOutgoingMessage({p:e,t:"zappar",d:n},[n])}));t.messageManager.postOutgoingMessage("loaded",[]),t.messageManager.onIncomingMessage.bind((function(r){var a;switch(r.t){case"zappar":n.processBuffer(r.d),t.messageManager.postOutgoingMessage({t:"buf",d:r.d},[r.d]);break;case"buf":null===(a=n.serializersByPipelineId.get(r.p))||void 0===a||a.bufferReturn(r.d);break;case"cameraFrameC2S":var i=r,o=f.mat4.create();i.userFacing&&f.mat4.fromScaling(o,[-1,1,-1]);var u=n._pipeline_by_instance.get(i.p);u&&(e.pipeline_camera_frame_submit(u,i.d,i.width,i.height,i.token,o),e.pipeline_frame_update(u),n.exploreState());var c={token:i.token,d:i.d,p:i.p,t:"cameraFrameRecycleS2C"};t.messageManager.postOutgoingMessage(c,[i.d])}}))}});case 1:case"end":return n.stop()}}),n)})))}},function(e,t,n){e.exports=n(9)},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(S){c=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),o=new E(r||[]);return i._invoke=function(e,t,n){var r=_;return function(a,i){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===a)throw i;return O()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var u=z(o,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===_)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var c=s(e,t,n);if("normal"===c.type){if(r=n.done?d:l,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=d,n.method="throw",n.arg=c.arg)}}}(e,n,o),i}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(S){return{type:"throw",arg:S}}}e.wrap=f;var _="suspendedStart",l="suspendedYield",p="executing",d="completed",m={};function h(){}function y(){}function b(){}var v={};c(v,i,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(T([])));w&&w!==n&&r.call(w,i)&&(v=w);var M=b.prototype=h.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(a,i,o,u){var c=s(e[a],e,i);if("throw"!==c.type){var f=c.arg,_=f.value;return _&&"object"===typeof _&&r.call(_,"__await")?t.resolve(_.__await).then((function(e){n("next",e,o,u)}),(function(e){n("throw",e,o,u)})):t.resolve(_).then((function(e){f.value=e,o(f)}),(function(e){return n("throw",e,o,u)}))}u(c.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(i,i):i()}}function z(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,z(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a \'throw\' method")}return m}var a=s(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function T(e){if(e){var n=e[i];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function n(){for(;++a<e.length;)if(r.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=b,c(M,"constructor",b),c(b,"constructor",y),y.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,u,"GeneratorFunction")),e.prototype=Object.create(M),e},e.awrap=function(e){return{__await:e}},k(x.prototype),c(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new x(f(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(M),c(M,u,"Generator"),c(M,i,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(r,a){return u.type="throw",u.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],u=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),f=r.call(o,"finallyLoc");if(c&&f){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=r}catch(a){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";n.r(t),function(e){var n=function(){var t="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(n){var r;n=n||{},r||(r="undefined"!==typeof n?n:{});var a,i={};for(a in r)r.hasOwnProperty(a)&&(i[a]=r[a]);r.arguments=[],r.thisProgram="./this.program",r.quit=function(e,t){throw t},r.preRun=[],r.postRun=[];var o="";function u(e){return r.locateFile?r.locateFile(e,o):o+e}o=self.location.href,t&&(o=t),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"",r.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},r.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)},r.readAsync=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},r.setWindowTitle=function(e){document.title=e};var c=r.print||("undefined"!==typeof console?console.log.bind(console):"undefined"!==typeof print?print:null),f=r.printErr||("undefined"!==typeof printErr?printErr:"undefined"!==typeof console&&console.warn.bind(console)||c);for(a in i)i.hasOwnProperty(a)&&(r[a]=i[a]);function s(e){var t=j;return j=j+e+15&-16,t}function _(e){var t=I[N>>2];return e=t+e+15&-16,I[N>>2]=e,e>=K&&!Y()?(I[N>>2]=t,0):t}function l(e){var t;return t||(t=16),Math.ceil(e/t)*t}i=void 0;var p,d={"f64-rem":function(e,t){return e%t},debugger:function(){}},m={};function h(e,t,n){return n&&n.length?r["dynCall_"+e].apply(null,[t].concat(n)):r["dynCall_"+e].call(null,t)}var y=!1;function b(e,t){e||Mr("Assertion failed: "+t)}function v(e){var t=r["_"+e];return b(t,"Cannot call unknown function "+e+", make sure it is exported"),t}var g={stackSave:function(){gr()},stackRestore:function(){vr()},arrayToC:function(e){var t=br(e.length);return T.set(e,t),t},stringToC:function(e){var t=0;if(null!==e&&void 0!==e&&0!==e){var n=1+(e.length<<2);t=br(n),A(e,O,t,n)}return t}},w={string:g.stringToC,array:g.arrayToC};function M(e){var t;if(0===t||!e)return"";for(var n,r=0,a=0;(r|=n=O[e+a>>0],0!=n||t)&&(a++,!t||a!=t););if(t||(t=a),n="",128>r){for(;0<t;)r=String.fromCharCode.apply(String,O.subarray(e,e+Math.min(t,1024))),n=n?n+r:r,e+=1024,t-=1024;return n}return z(e)}var k="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(e,t){for(var n=t;e[n];)++n;if(16<n-t&&e.subarray&&k)return k.decode(e.subarray(t,n));for(n="";;){var r=e[t++];if(!r)return n;if(128&r){var a=63&e[t++];if(192==(224&r))n+=String.fromCharCode((31&r)<<6|a);else{var i=63&e[t++];if(224==(240&r))r=(15&r)<<12|a<<6|i;else{var o=63&e[t++];if(240==(248&r))r=(7&r)<<18|a<<12|i<<6|o;else{var u=63&e[t++];if(248==(252&r))r=(3&r)<<24|a<<18|i<<12|o<<6|u;else r=(1&r)<<30|a<<24|i<<18|o<<12|u<<6|63&e[t++]}}65536>r?n+=String.fromCharCode(r):(r-=65536,n+=String.fromCharCode(55296|r>>10,56320|1023&r))}}else n+=String.fromCharCode(r)}}function z(e){return x(O,e)}function A(e,t,n,r){if(!(0<r))return 0;var a=n;r=n+r-1;for(var i=0;i<e.length;++i){var o=e.charCodeAt(i);if(55296<=o&&57343>=o)o=65536+((1023&o)<<10)|1023&e.charCodeAt(++i);if(127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(2097151>=o){if(n+3>=r)break;t[n++]=240|o>>18}else{if(67108863>=o){if(n+4>=r)break;t[n++]=248|o>>24}else{if(n+5>=r)break;t[n++]=252|o>>30,t[n++]=128|o>>24&63}t[n++]=128|o>>18&63}t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-a}function L(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:2097151>=r?t+4:67108863>=r?t+5:t+6}return t}"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var E,T,O,S,C,I,P,B,F,j,D,R,V,q,G,N,U=65536,W=16777216;function H(e,t){return 0<e%t&&(e+=t-e%t),e}function Z(){r.HEAP8=T=new Int8Array(E),r.HEAP16=S=new Int16Array(E),r.HEAP32=I=new Int32Array(E),r.HEAPU8=O=new Uint8Array(E),r.HEAPU16=C=new Uint16Array(E),r.HEAPU32=P=new Uint32Array(E),r.HEAPF32=B=new Float32Array(E),r.HEAPF64=F=new Float64Array(E)}function Y(){var e=r.usingWasm?U:W,t=2147483648-e;if(I[N>>2]>t)return!1;var n=K;for(K=Math.max(K,16777216);K<I[N>>2];)K=536870912>=K?H(2*K,e):Math.min(H((3*K+2147483648)/4,e),t);return(e=r.reallocBuffer(K))&&e.byteLength==K?(r.buffer=E=e,Z(),!0):(K=n,!1)}j=N=0,D=!1,r.reallocBuffer||(r.reallocBuffer=function(e){try{var t=T,n=new ArrayBuffer(e);new Int8Array(n).set(t)}catch(r){return!1}return!!dr(n)&&n});try{Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get)(new ArrayBuffer(4))}catch(kr){(function(e){return e.byteLength})}var X=r.TOTAL_STACK||5242880,K=r.TOTAL_MEMORY||16777216;function J(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var n=t.g;"number"===typeof n?void 0===t.P?r.dynCall_v(n):r.dynCall_vi(n,t.P):n(void 0===t.P?null:t.P)}}}K<X&&f("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+K+"! (TOTAL_STACK="+X+")"),r.buffer?E=r.buffer:("object"===typeof WebAssembly&&"function"===typeof WebAssembly.Memory?(r.wasmMemory=new WebAssembly.Memory({initial:K/U}),E=r.wasmMemory.buffer):E=new ArrayBuffer(K),r.buffer=E),Z();var Q=[],$=[],ee=[],te=[],ne=[],re=!1;function ae(){var e=r.preRun.shift();Q.unshift(e)}var ie=Math.abs,oe=Math.ceil,ue=Math.floor,ce=Math.min,fe=0,se=null,_e=null;function le(){fe++,r.monitorRunDependencies&&r.monitorRunDependencies(fe)}function pe(){if(fe--,r.monitorRunDependencies&&r.monitorRunDependencies(fe),0==fe&&(null!==se&&(clearInterval(se),se=null),_e)){var e=_e;_e=null,e()}}function de(e){return String.prototype.startsWith?e.startsWith("data:application/octet-stream;base64,"):0===e.indexOf("data:application/octet-stream;base64,")}r.preloadedImages={},r.preloadedAudios={},function(){function e(){try{if(r.wasmBinary)return new Uint8Array(r.wasmBinary);if(r.readBinary)return r.readBinary(i);throw"both async and sync fetching of the wasm failed"}catch(e){Mr(e)}}function t(){return r.wasmBinary||"function"!==typeof fetch?new Promise((function(t){t(e())})):fetch(i,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+i+"\'";return e.arrayBuffer()})).catch((function(){return e()}))}function n(e){function n(e){if((s=e.exports).memory){e=s.memory;var t=r.buffer;e.byteLength<t.byteLength&&f("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here"),t=new Int8Array(t),new Int8Array(e).set(t),r.buffer=E=e,Z()}r.asm=s,r.usingWasm=!0,pe()}function a(e){n(e.instance)}function o(e){t().then((function(e){return WebAssembly.instantiate(e,c)})).then(e,(function(e){f("failed to asynchronously prepare wasm: "+e),Mr(e)}))}if("object"!==typeof WebAssembly)return f("no native wasm support detected"),!1;if(!(r.wasmMemory instanceof WebAssembly.Memory))return f("no native wasm Memory in use"),!1;if(e.memory=r.wasmMemory,c.global={NaN:NaN,Infinity:1/0},c["global.Math"]=Math,c.env=e,le(),r.instantiateWasm)try{return r.instantiateWasm(c,n)}catch(u){return f("Module.instantiateWasm callback failed with error: "+u),!1}return r.wasmBinary||"function"!==typeof WebAssembly.instantiateStreaming||de(i)||"function"!==typeof fetch?o(a):WebAssembly.instantiateStreaming(fetch(i,{credentials:"same-origin"}),c).then(a,(function(e){f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),o(a)})),{}}var a="zcv.wast",i="zcv.wasm",o="zcv.temp.asm.js";de(a)||(a=u(a)),de(i)||(i=u(i)),de(o)||(o=u(o));var c={global:null,env:null,asm2wasm:d,parent:r},s=null;r.asmPreload=r.asm;var _=r.reallocBuffer;r.reallocBuffer=function(e){if("asmjs"===l)var t=_(e);else e:{e=H(e,r.usingWasm?U:W);var n=r.buffer.byteLength;if(r.usingWasm)try{t=-1!==r.wasmMemory.grow((e-n)/65536)?r.buffer=r.wasmMemory.buffer:null;break e}catch(a){t=null;break e}t=void 0}return t};var l="";r.asm=function(e,t){if(!t.table){void 0===(e=r.wasmTableSize)&&(e=1024);var a=r.wasmMaxTableSize;t.table="object"===typeof WebAssembly&&"function"===typeof WebAssembly.Table?void 0!==a?new WebAssembly.Table({initial:e,maximum:a,element:"anyfunc"}):new WebAssembly.Table({initial:e,element:"anyfunc"}):Array(e),r.wasmTable=t.table}return t.__memory_base||(t.__memory_base=r.STATIC_BASE),t.__table_base||(t.__table_base=0),b(t=n(t),"no binaryen method succeeded."),t}}();var me=[function(){if(self.crypto&&self.crypto.getRandomValues){var e=new Uint32Array(1);return self.crypto.getRandomValues(e),e[0]}return 9007199254740991*Math.random()}];j=433680,$.push({g:function(){Hn()}},{g:function(){tr()}},{g:function(){fr()}},{g:function(){pr()}},{g:function(){_r()}},{g:function(){Qn()}},{g:function(){er()}},{g:function(){$n()}},{g:function(){Xn()}},{g:function(){Jn()}},{g:function(){Kn()}},{g:function(){sr()}},{g:function(){Zn()}},{g:function(){nr()}},{g:function(){Yn()}},{g:function(){ir()}},{g:function(){rr()}},{g:function(){ar()}},{g:function(){or()}},{g:function(){ur()}},{g:function(){cr()}}),r.STATIC_BASE=1024,r.STATIC_BUMP=432656;var he=j;j+=16;var ye={};function be(){Mr()}function ve(){return"undefined"!==typeof dateNow||self.performance&&self.performance.now}var ge={I:1,u:2,Fc:3,Bb:4,M:5,ja:6,Ua:7,Zb:8,B:9,ib:10,fa:11,Pc:11,ya:12,W:13,ub:14,lc:15,ga:16,ha:17,Qc:18,Y:19,Z:20,N:21,i:22,Ub:23,wa:24,D:25,Mc:26,vb:27,hc:28,O:29,Cc:30,Nb:31,vc:32,rb:33,zc:34,cc:42,yb:43,jb:44,Eb:45,Fb:46,Gb:47,Mb:48,Nc:49,Xb:50,Db:51,ob:35,$b:37,$a:52,cb:53,Rc:54,Vb:55,eb:56,fb:57,pb:35,gb:59,jc:60,Yb:61,Jc:62,ic:63,dc:64,ec:65,Bc:66,ac:67,Xa:68,Gc:69,kb:70,wc:71,Pb:72,sb:73,bb:74,qc:76,ab:77,Ac:78,Hb:79,Ib:80,Lb:81,Kb:82,Jb:83,kc:38,ia:39,Qb:36,X:40,rc:95,uc:96,nb:104,Wb:105,Ya:97,yc:91,oc:88,fc:92,Dc:108,mb:111,Va:98,lb:103,Tb:101,Rb:100,Kc:110,wb:112,xb:113,Ab:115,Za:114,qb:89,Ob:90,xc:93,Ec:94,Wa:99,Sb:102,Cb:106,mc:107,Lc:109,Oc:87,tb:122,Hc:116,pc:95,bc:123,zb:84,sc:75,hb:125,nc:131,tc:130,Ic:86};function we(e){return r.___errno_location&&(I[r.___errno_location()>>2]=e),e}function Me(e,t){if(0===e)e=Date.now();else{if(1!==e||!ve())return we(ge.i),-1;e=be()}return I[t>>2]=e/1e3|0,I[t+4>>2]=e%1e3*1e6|0,0}var ke=0,xe=[],ze={};function Ae(e){if(!e||ze[e])return e;for(var t in ze){var n=+t;if(ze[n].ka===e)return n}return e}function Le(e){if(e){var t=ze[e];b(0<t.J),t.J--,0!==t.J||t.L||(t.oa&&r.dynCall_vi(t.oa,e),delete ze[e],Ee(e))}}function Ee(e){try{return mr(e)}catch(t){}}function Te(){var e=xe.pop();throw e=Ae(e),ze[e].L||(xe.push(e),ze[e].L=!0),ke=e,e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}var Oe={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can\'t send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function Se(e,t){for(var n=0,r=e.length-1;0<=r;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e}function Ce(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=Se(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function Ie(e){var t=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function Pe(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function Be(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!==typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=Se(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var Fe=[];function je(e,t){Fe[e]={input:[],output:[],G:t},ft(e,De)}var De={open:function(e){var t=Fe[e.node.rdev];if(!t)throw new Xe(ge.Y);e.tty=t,e.seekable=!1},close:function(e){e.tty.G.flush(e.tty)},flush:function(e){e.tty.G.flush(e.tty)},read:function(e,t,n,r){if(!e.tty||!e.tty.G.ra)throw new Xe(ge.ja);for(var a=0,i=0;i<r;i++){try{var o=e.tty.G.ra(e.tty)}catch(u){throw new Xe(ge.M)}if(void 0===o&&0===a)throw new Xe(ge.fa);if(null===o||void 0===o)break;a++,t[n+i]=o}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,n,r){if(!e.tty||!e.tty.G.da)throw new Xe(ge.ja);var a=0;try{if(0===n&&0===r)e.tty.G.flush(e.tty);else for(;a<r;)e.tty.G.da(e.tty,t[n+a]),a++}catch(i){throw new Xe(ge.M)}return r&&(e.node.timestamp=Date.now()),a}},Re={ra:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\\n")),!t)return null;e.input=Un(t,!0)}return e.input.shift()},da:function(e,t){null===t||10===t?(c(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(c(x(e.output,0)),e.output=[])}},Ve={da:function(e,t){null===t||10===t?(f(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(f(x(e.output,0)),e.output=[])}},qe={o:null,A:function(){return qe.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576===(61440&n)||4096===(61440&n))throw new Xe(ge.I);return qe.o||(qe.o={dir:{node:{m:qe.c.m,s:qe.c.s,lookup:qe.c.lookup,R:qe.c.R,rename:qe.c.rename,unlink:qe.c.unlink,rmdir:qe.c.rmdir,readdir:qe.c.readdir,symlink:qe.c.symlink},stream:{F:qe.f.F}},file:{node:{m:qe.c.m,s:qe.c.s},stream:{F:qe.f.F,read:qe.f.read,write:qe.f.write,la:qe.f.la,sa:qe.f.sa,T:qe.f.T}},link:{node:{m:qe.c.m,s:qe.c.s,readlink:qe.c.readlink},stream:{}},na:{node:{m:qe.c.m,s:qe.c.s},stream:ct}}),16384===(61440&(n=tt(e,t,n,r)).mode)?(n.c=qe.o.dir.node,n.f=qe.o.dir.stream,n.b={}):32768===(61440&n.mode)?(n.c=qe.o.file.node,n.f=qe.o.file.stream,n.h=0,n.b=null):40960===(61440&n.mode)?(n.c=qe.o.link.node,n.f=qe.o.link.stream):8192===(61440&n.mode)&&(n.c=qe.o.na.node,n.f=qe.o.na.stream),n.timestamp=Date.now(),e&&(e.b[t]=n),n},Ea:function(e){if(e.b&&e.b.subarray){for(var t=[],n=0;n<e.h;++n)t.push(e.b[n]);return t}return e.b},Wc:function(e){return e.b?e.b.subarray?e.b.subarray(0,e.h):new Uint8Array(e.b):new Uint8Array},pa:function(e,t){if(e.b&&e.b.subarray&&t>e.b.length&&(e.b=qe.Ea(e),e.h=e.b.length),!e.b||e.b.subarray){var n=e.b?e.b.length:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)|0),0!=n&&(t=Math.max(t,256)),n=e.b,e.b=new Uint8Array(t),0<e.h&&e.b.set(n.subarray(0,e.h),0))}else for(!e.b&&0<t&&(e.b=[]);e.b.length<t;)e.b.push(0)},Ma:function(e,t){if(e.h!=t)if(0==t)e.b=null,e.h=0;else{if(!e.b||e.b.subarray){var n=e.b;e.b=new Uint8Array(new ArrayBuffer(t)),n&&e.b.set(n.subarray(0,Math.min(t,e.h)))}else if(e.b||(e.b=[]),e.b.length>t)e.b.length=t;else for(;e.b.length<t;)e.b.push(0);e.h=t}},c:{m:function(e){var t={};return t.dev=8192===(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384===(61440&e.mode)?t.size=4096:32768===(61440&e.mode)?t.size=e.h:40960===(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Ca=4096,t.blocks=Math.ceil(t.size/t.Ca),t},s:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&qe.Ma(e,t.size)},lookup:function(){throw Ke[ge.u]},R:function(e,t,n,r){return qe.createNode(e,t,n,r)},rename:function(e,t,n){if(16384===(61440&e.mode)){try{var r=et(t,n)}catch(i){}if(r)for(var a in r.b)throw new Xe(ge.ia)}delete e.parent.b[e.name],e.name=n,t.b[n]=e,e.parent=t},unlink:function(e,t){delete e.b[t]},rmdir:function(e,t){var n,r=et(e,t);for(n in r.b)throw new Xe(ge.ia);delete e.b[t]},readdir:function(e){var t,n=[".",".."];for(t in e.b)e.b.hasOwnProperty(t)&&n.push(t);return n},symlink:function(e,t,n){return(e=qe.createNode(e,t,41471,0)).link=n,e},readlink:function(e){if(40960!==(61440&e.mode))throw new Xe(ge.i);return e.link}},f:{read:function(e,t,n,r,a){var i=e.node.b;if(a>=e.node.h)return 0;if(b(0<=(e=Math.min(e.node.h-a,r))),8<e&&i.subarray)t.set(i.subarray(a,a+e),n);else for(r=0;r<e;r++)t[n+r]=i[a+r];return e},write:function(e,t,n,r,a,i){if(i=!1,!r)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.b||e.b.subarray)){if(i)return e.b=t.subarray(n,n+r),e.h=r;if(0===e.h&&0===a)return e.b=new Uint8Array(t.subarray(n,n+r)),e.h=r;if(a+r<=e.h)return e.b.set(t.subarray(n,n+r),a),r}if(qe.pa(e,a+r),e.b.subarray&&t.subarray)e.b.set(t.subarray(n,n+r),a);else for(i=0;i<r;i++)e.b[a+i]=t[n+i];return e.h=Math.max(e.h,a+r),r},F:function(e,t,n){if(1===n?t+=e.position:2===n&&32768===(61440&e.node.mode)&&(t+=e.node.h),0>t)throw new Xe(ge.i);return t},la:function(e,t,n){qe.pa(e.node,t+n),e.node.h=Math.max(e.node.h,t+n)},sa:function(e,t,n,r,a,i,o){if(32768!==(61440&e.node.mode))throw new Xe(ge.Y);if(n=e.node.b,2&o||n.buffer!==t&&n.buffer!==t.buffer){if((0<a||a+r<e.node.h)&&(n=n.subarray?n.subarray(a,a+r):Array.prototype.slice.call(n,a,a+r)),e=!0,!(r=hr(r)))throw new Xe(ge.ya);t.set(n,r)}else e=!1,r=n.byteOffset;return{Ka:r,za:e}},T:function(e,t,n,r,a){if(32768!==(61440&e.node.mode))throw new Xe(ge.Y);return 2&a||qe.f.write(e,t,0,r,n,!1),0}}};j+=16,j+=16,j+=16;var Ge=null,Ne={},Ue=[],We=1,He=null,Ze=!0,Ye={},Xe=null,Ke={};function Je(e,t){if(t=t||{},!(e=Be("/",e)))return{path:"",node:null};var n,r={qa:!0,ea:0};for(n in r)void 0===t[n]&&(t[n]=r[n]);if(8<t.ea)throw new Xe(ge.X);e=Se(e.split("/").filter((function(e){return!!e})),!1);var a=Ge;for(r="/",n=0;n<e.length;n++){var i=n===e.length-1;if(i&&t.parent)break;if(a=et(a,e[n]),r=Ce(r+"/"+e[n]),a.S&&(!i||i&&t.qa)&&(a=a.S.root),!i||t.aa)for(i=0;40960===(61440&a.mode);)if(a=mt(r),a=Je(r=Be(Ie(r),a),{ea:t.ea}).node,40<i++)throw new Xe(ge.X)}return{path:r,node:a}}function Qe(e){for(var t;;){if(e===e.parent)return e=e.A.ta,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function $e(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%He.length}function et(e,t){var n;if(n=(n=at(e,"x"))?n:e.c.lookup?0:ge.W)throw new Xe(n,e);for(n=He[$e(e.id,t)];n;n=n.Ja){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.c.lookup(e,t)}function tt(e,t,n,r){return Mt||(Mt=function(e,t,n,r){e||(e=this),this.parent=e,this.A=e.A,this.S=null,this.id=We++,this.name=t,this.mode=n,this.c={},this.f={},this.rdev=r},Mt.prototype={},Object.defineProperties(Mt.prototype,{read:{get:function(){return 365===(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146===(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}})),function(e){var t=$e(e.parent.id,e.name);e.Ja=He[t],He[t]=e}(e=new Mt(e,t,n,r)),e}var nt={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function rt(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function at(e,t){return Ze||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:ge.W}function it(e,t){try{return et(e,t),ge.ha}catch(n){}return at(e,"wx")}function ot(e,t){kt||((kt=function(){}).prototype={},Object.defineProperties(kt.prototype,{object:{get:function(){return this.node},set:function(e){this.node=e}}}));var n,r=new kt;for(n in e)r[n]=e[n];return e=r,t=function(e){for(e=e||0;e<=4096;e++)if(!Ue[e])return e;throw new Xe(ge.wa)}(t),e.fd=t,Ue[t]=e}var ut,ct={open:function(e){e.f=Ne[e.node.rdev].f,e.f.open&&e.f.open(e)},F:function(){throw new Xe(ge.O)}};function ft(e,t){Ne[e]={f:t}}function st(e,t){var n="/"===t,r=!t;if(n&&Ge)throw new Xe(ge.ga);if(!n&&!r){var a=Je(t,{qa:!1});if(t=a.path,(a=a.node).S)throw new Xe(ge.ga);if(16384!==(61440&a.mode))throw new Xe(ge.Z)}t={type:e,$c:{},ta:t,Ia:[]},(e=e.A(t)).A=t,t.root=e,n?Ge=e:a&&(a.S=t,a.A&&a.A.Ia.push(t))}function _t(e,t,n){var r=Je(e,{parent:!0}).node;if(!(e=Pe(e))||"."===e||".."===e)throw new Xe(ge.i);var a=it(r,e);if(a)throw new Xe(a);if(!r.c.R)throw new Xe(ge.I);return r.c.R(r,e,t,n)}function lt(e){_t(e,16895,0)}function pt(e,t,n){"undefined"===typeof n&&(n=t,t=438),_t(e,8192|t,n)}function dt(e,t){if(!Be(e))throw new Xe(ge.u);var n=Je(t,{parent:!0}).node;if(!n)throw new Xe(ge.u);var r=it(n,t=Pe(t));if(r)throw new Xe(r);if(!n.c.symlink)throw new Xe(ge.I);n.c.symlink(n,t,e)}function mt(e){if(!(e=Je(e).node))throw new Xe(ge.u);if(!e.c.readlink)throw new Xe(ge.i);return Be(Qe(e.parent),e.c.readlink(e))}function ht(e,t,n,a){if(""===e)throw new Xe(ge.u);if("string"===typeof t){var i=nt[t];if("undefined"===typeof i)throw Error("Unknown file open mode: "+t);t=i}if(n=64&t?4095&("undefined"===typeof n?438:n)|32768:0,"object"===typeof e)var o=e;else{e=Ce(e);try{o=Je(e,{aa:!(131072&t)}).node}catch(c){}}if(i=!1,64&t)if(o){if(128&t)throw new Xe(ge.ha)}else o=_t(e,n,0),i=!0;if(!o)throw new Xe(ge.u);if(8192===(61440&o.mode)&&(t&=-513),65536&t&&16384!==(61440&o.mode))throw new Xe(ge.Z);if(!i&&(n=o?40960===(61440&o.mode)?ge.X:16384===(61440&o.mode)&&("r"!==rt(t)||512&t)?ge.N:at(o,rt(t)):ge.u))throw new Xe(n);if(512&t){var u;if(!(u="string"===typeof(n=o)?Je(n,{aa:!0}).node:n).c.s)throw new Xe(ge.I);if(16384===(61440&u.mode))throw new Xe(ge.N);if(32768!==(61440&u.mode))throw new Xe(ge.i);if(n=at(u,"w"))throw new Xe(n);u.c.s(u,{size:0,timestamp:Date.now()})}t&=-641,(a=ot({node:o,path:Qe(o),flags:t,seekable:!0,position:0,f:o.f,Sa:[],error:!1},a)).f.open&&a.f.open(a),!r.logReadFiles||1&t||(xt||(xt={}),e in xt||(xt[e]=1,console.log("FS.trackingDelegate error on read file: "+e)));try{Ye.onOpenFile&&(o=0,1!==(2097155&t)&&(o|=1),0!==(2097155&t)&&(o|=2),Ye.onOpenFile(e,o))}catch(c){console.log("FS.trackingDelegate[\'onOpenFile\'](\'"+e+"\', flags) threw an exception: "+c.message)}return a}function yt(e){if(null===e.fd)throw new Xe(ge.B);e.ba&&(e.ba=null);try{e.f.close&&e.f.close(e)}catch(t){throw t}finally{Ue[e.fd]=null}e.fd=null}function bt(e,t,n){if(null===e.fd)throw new Xe(ge.B);if(!e.seekable||!e.f.F)throw new Xe(ge.O);e.position=e.f.F(e,t,n),e.Sa=[]}function vt(){Xe||((Xe=function(e,t){this.node=t,this.Na=function(e){for(var t in this.v=e,ge)if(ge[t]===e){this.code=t;break}},this.Na(e),this.message=Oe[e],this.stack&&Object.defineProperty(this,"stack",{value:Error().stack,writable:!0})}).prototype=Error(),Xe.prototype.constructor=Xe,[ge.u].forEach((function(e){Ke[e]=new Xe(e),Ke[e].stack="<generic error, no stack>"})))}function gt(e,t,n){e=Ce("/dev/"+e);var r=function(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n}(!!t,!!n);wt||(wt=64);var a=wt++<<8|0;ft(a,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,n,r,a){for(var i=0,o=0;o<a;o++){try{var u=t()}catch(c){throw new Xe(ge.M)}if(void 0===u&&0===i)throw new Xe(ge.fa);if(null===u||void 0===u)break;i++,n[r+o]=u}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,r,a){for(var i=0;i<a;i++)try{n(t[r+i])}catch(o){throw new Xe(ge.M)}return a&&(e.node.timestamp=Date.now()),i}}),pt(e,r,a)}var wt,Mt,kt,xt,zt={},At={},Lt=0;function Et(){return I[(Lt+=4)-4>>2]}function Tt(){var e=Ue[Et()];if(!e)throw new Xe(ge.B);return e}function Ot(t,n){if(Vt=t,qt=n,!Dt)return 1;if(0==t)Bt=function(){var e=0|Math.max(0,Ct+n-be());setTimeout(It,e)},Ft="timeout";else if(1==t)Bt=function(){rn(It)},Ft="rAF";else if(2==t){if("undefined"===typeof e){var a=[];addEventListener("message",(function(e){"setimmediate"!==e.data&&"setimmediate"!==e.data.target||(e.stopPropagation(),a.shift()())}),!0),e=function(e){a.push(e),void 0===r.setImmediates&&(r.setImmediates=[]),r.setImmediates.push(e),postMessage({target:"setimmediate"})}}Bt=function(){e(It)},Ft="immediate"}return 0}function St(e,t,n,a,i){r.noExitRuntime=!0,b(!Dt,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Dt=e,Rt=a;var o="undefined"!==typeof a?function(){r.dynCall_vi(e,a)}:function(){r.dynCall_v(e)},u=jt;if(It=function(){if(!y)if(0<Nt.length){var e=Date.now(),t=Nt.shift();if(t.g(t.P),Pt){var n=Pt,a=0==n%1?n-1:Math.floor(n);Pt=t.Tc?a:(8*n+(a+.5))/9}console.log(\'main loop blocker "\'+t.name+\'" took \'+(Date.now()-e)+" ms"),r.setStatus&&(e=r.statusMessage||"Please wait...",t=Pt,n=Ut.Vc,t?t<n?r.setStatus(e+" ("+(n-t)+"/"+n+")"):r.setStatus(e):r.setStatus("")),u<jt||setTimeout(It,0)}else if(!(u<jt))if(Gt=Gt+1|0,1==Vt&&1<qt&&0!=Gt%qt)Bt();else{if(0==Vt&&(Ct=be()),"timeout"===Ft&&r.K&&(f("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),Ft=""),!(y||r.preMainLoop&&!1===r.preMainLoop())){try{o()}catch(i){throw i&&"object"===typeof i&&i.stack&&f("exception thrown: "+[i,i.stack]),i}r.postMainLoop&&r.postMainLoop()}u<jt||("object"===typeof SDL&&SDL.audio&&SDL.audio.La&&SDL.audio.La(),Bt())}},i||(t&&0<t?Ot(0,1e3/t):Ot(1,1),Bt()),n)throw"SimulateInfiniteLoop"}var Ct,It,Pt,Bt=null,Ft="",jt=0,Dt=null,Rt=0,Vt=0,qt=0,Gt=0,Nt=[],Ut={},Wt=!1,Ht=!1,Zt=[];function Yt(){function e(){Ht=document.pointerLockElement===r.canvas||document.mozPointerLockElement===r.canvas||document.webkitPointerLockElement===r.canvas||document.msPointerLockElement===r.canvas}if(r.preloadPlugins||(r.preloadPlugins=[]),!sn){sn=!0;try{_n=!0}catch(n){_n=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}ln="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:_n?null:console.log("warning: no BlobBuilder"),pn="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,r.ua||"undefined"!==typeof pn||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),r.ua=!0),r.preloadPlugins.push({canHandle:function(e){return!r.ua&&/\\.(jpg|jpeg|png|bmp)$/i.test(e)},handle:function(e,t,n,a){var i=null;if(_n)try{(i=new Blob([e],{type:on(t)})).size!==e.length&&(i=new Blob([new Uint8Array(e).buffer],{type:on(t)}))}catch(c){!function(e){p||(p={}),p[e]||(p[e]=1,f(e))}("Blob constructor present but fails: "+c+"; falling back to blob builder")}i||((i=new ln).append(new Uint8Array(e).buffer),i=i.getBlob());var o=pn.createObjectURL(i),u=new Image;u.onload=function(){b(u.complete,"Image "+t+" could not be decoded");var a=document.createElement("canvas");a.width=u.width,a.height=u.height,a.getContext("2d").drawImage(u,0,0),r.preloadedImages[t]=a,pn.revokeObjectURL(o),n&&n(e)},u.onerror=function(){console.log("Image "+o+" could not be decoded"),a&&a()},u.src=o}}),r.preloadPlugins.push({canHandle:function(e){return!r.Zc&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(e,t,n,a){function i(a){u||(u=!0,r.preloadedAudios[t]=a,n&&n(e))}function o(){u||(u=!0,r.preloadedAudios[t]=new Audio,a&&a())}var u=!1;if(!_n)return o();try{var c=new Blob([e],{type:on(t)})}catch(s){return o()}c=pn.createObjectURL(c);var f=new Audio;f.addEventListener("canplaythrough",(function(){i(f)}),!1),f.onerror=function(){if(!u){console.log("warning: browser could not fully decode audio "+t+", trying slower base64 approach");for(var n="",r=0,a=0,o=0;o<e.length;o++)for(r=r<<8|e[o],a+=8;6<=a;){var c=r>>a-6&63;a-=6,n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c]}2==a?(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],n+="=="):4==a&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],n+="="),f.src="data:audio/x-"+t.substr(-3)+";base64,"+n,i(f)}},f.src=c,an((function(){i(f)}),1e4)}});var t=r.canvas;t&&(t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock||t.msRequestPointerLock||function(){},t.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},t.exitPointerLock=t.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("mspointerlockchange",e,!1),r.elementPointerLock&&t.addEventListener("click",(function(e){!Ht&&r.canvas.requestPointerLock&&(r.canvas.requestPointerLock(),e.preventDefault())}),!1))}}function Xt(e,t,n,a){if(t&&r.K&&e==r.canvas)return r.K;if(t){var i={antialias:!1,alpha:!1};if(a)for(var o in a)i[o]=a[o];if(i=function(e,t){function n(){}"undefined"===typeof t.majorVersion&&"undefined"===typeof t.minorVersion&&(t.majorVersion=1,t.minorVersion=0);try{e.addEventListener("webglcontextcreationerror",n,!1);try{if(1==t.majorVersion&&0==t.minorVersion)var r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);else{if(2!=t.majorVersion||0!=t.minorVersion)throw"Unsupported WebGL context version "+majorVersion+"."+minorVersion+"!";r=e.getContext("webgl2",t)}}finally{e.removeEventListener("webglcontextcreationerror",n,!1)}if(!r)throw":("}catch(i){return 0}return r?function(e,t){var n=On(Ln),r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.Sc=r),Ln[n]=r,("undefined"===typeof t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&function(e){if(e||(e=En),!e.Ga){e.Ga=!0;var t=e.GLctx;if(2>e.version){var n=t.getExtension("ANGLE_instanced_arrays");n&&(t.vertexAttribDivisor=function(e,t){n.vertexAttribDivisorANGLE(e,t)},t.drawArraysInstanced=function(e,t,r,a){n.drawArraysInstancedANGLE(e,t,r,a)},t.drawElementsInstanced=function(e,t,r,a,i){n.drawElementsInstancedANGLE(e,t,r,a,i)});var r=t.getExtension("OES_vertex_array_object");r&&(t.createVertexArray=function(){return r.createVertexArrayOES()},t.deleteVertexArray=function(e){r.deleteVertexArrayOES(e)},t.bindVertexArray=function(e){r.bindVertexArrayOES(e)},t.isVertexArray=function(e){return r.isVertexArrayOES(e)});var a=t.getExtension("WEBGL_draw_buffers");a&&(t.drawBuffers=function(e,t){a.drawBuffersWEBGL(e,t)})}t.Uc=t.getExtension("EXT_disjoint_timer_query");var i="OES_texture_float OES_texture_half_float OES_standard_derivatives OES_vertex_array_object WEBGL_compressed_texture_s3tc WEBGL_depth_texture OES_element_index_uint EXT_texture_filter_anisotropic EXT_frag_depth WEBGL_draw_buffers ANGLE_instanced_arrays OES_texture_float_linear OES_texture_half_float_linear EXT_blend_minmax EXT_shader_texture_lod WEBGL_compressed_texture_pvrtc EXT_color_buffer_half_float WEBGL_color_buffer_float EXT_sRGB WEBGL_compressed_texture_etc1 EXT_disjoint_timer_query WEBGL_compressed_texture_etc WEBGL_compressed_texture_astc EXT_color_buffer_float WEBGL_compressed_texture_s3tc_srgb EXT_disjoint_timer_query_webgl2".split(" ");(e=t.getSupportedExtensions())&&0<e.length&&t.getSupportedExtensions().forEach((function(e){-1!=i.indexOf(e)&&t.getExtension(e)}))}}(r),n}(r,t):0}(e,i))var u=Ln[i].GLctx}else u=e.getContext("2d");return u?(n&&(t||b("undefined"===typeof Gn,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),r.K=u,t&&function(e){e?(e=Ln[e])&&(Gn=r.K=e.GLctx,En=e):Gn=r.K=En=null}(i),r.bd=t,Zt.forEach((function(e){e()})),Yt()),u):null}var Kt=!1,Jt=void 0,Qt=void 0;function $t(e,t,n){function a(){Wt=!1;var e=i.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(i.exitFullscreen=document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){},i.exitFullscreen=i.exitFullscreen.bind(document),Jt&&i.requestPointerLock(),Wt=!0,Qt?("undefined"!=typeof SDL&&(I[SDL.screen>>2]=8388608|P[SDL.screen>>2]),fn(r.canvas),cn()):fn(i)):(e.parentNode.insertBefore(i,e),e.parentNode.removeChild(e),Qt?("undefined"!=typeof SDL&&(I[SDL.screen>>2]=-8388609&P[SDL.screen>>2]),fn(r.canvas),cn()):fn(i)),r.onFullScreen&&r.onFullScreen(Wt),r.onFullscreen&&r.onFullscreen(Wt)}"undefined"===typeof(Jt=e)&&(Jt=!0),"undefined"===typeof(Qt=t)&&(Qt=!1),"undefined"===typeof n&&null;var i=r.canvas;Kt||(Kt=!0,document.addEventListener("fullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("MSFullscreenChange",a,!1));var o=document.createElement("div");i.parentNode.insertBefore(o,i),o.appendChild(i),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?function(){o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n?o.requestFullscreen({cd:n}):o.requestFullscreen()}function en(e,t,n){return f("Browser.requestFullScreen() is deprecated. Please call Browser.requestFullscreen instead."),en=function(e,t,n){return $t(e,t,n)},$t(e,t,n)}var tn=0;function nn(e){var t=Date.now();if(0===tn)tn=t+1e3/60;else for(;t+2>=tn;)tn+=1e3/60;setTimeout(e,Math.max(tn-t,0))}function rn(e){"undefined"===typeof window?nn(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||nn),window.requestAnimationFrame(e))}function an(e,t){r.noExitRuntime=!0,setTimeout((function(){y||e()}),t)}function on(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}var un=[];function cn(){var e=r.canvas;un.forEach((function(t){t(e.width,e.height)}))}function fn(e,t,n){t&&n?(e.Ta=t,e.Fa=n):(t=e.Ta,n=e.Fa);var a=t,i=n;if(r.forcedAspectRatio&&0<r.forcedAspectRatio&&(a/i<r.forcedAspectRatio?a=Math.round(i*r.forcedAspectRatio):i=Math.round(a/r.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/a,screen.height/i);a=Math.round(a*o),i=Math.round(i*o)}Qt?(e.width!=a&&(e.width=a),e.height!=i&&(e.height=i),"undefined"!=typeof e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=n&&(e.height=n),"undefined"!=typeof e.style&&(a!=t||i!=n?(e.style.setProperty("width",a+"px","important"),e.style.setProperty("height",i+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}var sn,_n,ln,pn,dn=[],mn=void 0;function hn(e,t){P[e>>2]=t,P[e+4>>2]=t/4294967296|0}function yn(e,t,n,r){var a=P[e+8>>2];if(a){var i=M(a),o=e+112,u=M(o);u||(u="GET");var c=P[o+48>>2],f=P[o+52>>2],s=!!P[o+56>>2],_=P[o+64>>2],l=P[o+68>>2];a=P[o+72>>2];var p=P[o+76>>2],d=P[o+80>>2];o=P[o+84>>2];var m=!!(1&c),h=!!(2&c);c=!!(64&c),_=_?M(_):void 0,l=l?M(l):void 0;var y=p?M(p):void 0,b=new XMLHttpRequest;if(b.withCredentials=s,b.open(u,i,!c,_,l),c||(b.timeout=f),b.l=i,b.responseType=h?"moz-chunked-arraybuffer":"arraybuffer",p&&b.overrideMimeType(y),a)for(;(u=P[a>>2])&&(i=P[a+4>>2]);)a+=8,u=M(u),i=M(i),b.setRequestHeader(u,i);dn.push(b),P[e+0>>2]=dn.length,a=d&&o?O.slice(d,d+o):null,b.onload=function(r){var a=b.response?b.response.byteLength:0,i=0,o=0;m&&!h&&(i=hr(o=a),O.set(new Uint8Array(b.response),i)),P[e+12>>2]=i,hn(e+16,o),hn(e+24,0),a&&hn(e+32,a),C[e+40>>1]=b.readyState,4===b.readyState&&0===b.status&&(b.status=0<a?200:404),C[e+42>>1]=b.status,b.statusText&&A(b.statusText,O,e+44,64),200==b.status?t&&t(e,b,r):n&&n(e,b,r)},b.onerror=function(t){var r=b.status;4==b.readyState&&0==r&&(r=404),P[e+12>>2]=0,hn(e+16,0),hn(e+24,0),hn(e+32,0),C[e+40>>1]=b.readyState,C[e+42>>1]=r,n&&n(e,b,t)},b.ontimeout=function(t){n&&n(e,b,t)},b.onprogress=function(t){var n=m&&h&&b.response?b.response.byteLength:0,a=0;m&&h&&(a=hr(n),O.set(new Uint8Array(b.response),a)),P[e+12>>2]=a,hn(e+16,n),hn(e+24,t.loaded-n),hn(e+32,t.total),C[e+40>>1]=b.readyState,3<=b.readyState&&0===b.status&&0<t.loaded&&(b.status=200),C[e+42>>1]=b.status,b.statusText&&A(b.statusText,O,e+44,64),r&&r(e,b,t)};try{b.send(a)}catch(v){n&&n(e,b,v)}}else n(e,0,"no url specified!")}function bn(e,t,n,r,a){if(e){var i=P[t+112+60>>2];i||(i=P[t+8>>2]);var o=M(i);try{var u=e.transaction(["FILES"],"readwrite").objectStore("FILES").put(n,o);u.onsuccess=function(){C[t+40>>1]=4,C[t+42>>1]=200,A("OK",O,t+44,64),r(t,0,o)},u.onerror=function(e){C[t+40>>1]=4,C[t+42>>1]=413,A("Payload Too Large",O,t+44,64),a(t,0,e)}}catch(c){a(t,0,c)}}else a(t,0,"IndexedDB not available!")}function vn(e,t,n,r){if(e){var a=P[t+112+60>>2];a||(a=P[t+8>>2]),a=M(a);try{var i=e.transaction(["FILES"],"readonly").objectStore("FILES").get(a);i.onsuccess=function(e){if(e.target.result){var a=(e=e.target.result).byteLength||e.length,i=hr(a);O.set(new Uint8Array(e),i),P[t+12>>2]=i,hn(t+16,a),hn(t+24,0),hn(t+32,a),C[t+40>>1]=4,C[t+42>>1]=200,A("OK",O,t+44,64),n(t,0,e)}else C[t+40>>1]=4,C[t+42>>1]=404,A("Not Found",O,t+44,64),r(t,0,"no data")},i.onerror=function(e){C[t+40>>1]=4,C[t+42>>1]=404,A("Not Found",O,t+44,64),r(t,0,e)}}catch(o){r(t,0,o)}}else r(t,0,"IndexedDB not available!")}function gn(e,t,n,r){if(e){var a=P[t+112+60>>2];a||(a=P[t+8>>2]),a=M(a);try{var i=e.transaction(["FILES"],"readwrite").objectStore("FILES").delete(a);i.onsuccess=function(e){e=e.target.result,P[t+12>>2]=0,hn(t+16,0),hn(t+24,0),hn(t+24,0),C[t+40>>1]=4,C[t+42>>1]=200,A("OK",O,t+44,64),n(t,0,e)},i.onerror=function(e){C[t+40>>1]=4,C[t+42>>1]=404,A("Not Found",O,t+44,64),r(t,0,e)}}catch(o){r(t,0,o)}}else r(t,0,"IndexedDB not available!")}var wn,Mn,kn=void 0;for(kn=wn=s(Math.max(12,1)),b(0==(3&wn)),Mn=wn+12;kn<Mn;kn+=4)I[kn>>2]=0;for(Mn=wn+12;kn<Mn;)T[kn++>>0]=0;var xn=1,zn=0,An=[],Ln=[],En=null,Tn=[];function On(e){for(var t=xn++,n=e.length;n<t;n++)e[n]=null;return t}function Sn(e,t,n,r){return e*=n,r*=Math.floor((e+r-1)/r),0>=t?0:(t-1)*r+e}function Cn(e,t,n,r,a){switch(t){case 6406:case 6409:case 6402:t=1;break;case 6410:t=2;break;case 6407:case 35904:t=3;break;case 6408:case 35906:t=4;break;default:return zn||(zn=1280),null}switch(e){case 5121:t*=1;break;case 5123:case 36193:t*=2;break;case 5125:case 5126:t*=4;break;case 34042:t=4;break;case 33635:case 32819:case 32820:t=2;break;default:return zn||(zn=1280),null}switch(n=Sn(n,r,t,4),e){case 5121:return O.subarray(a,a+n);case 5126:return B.subarray(a>>2,a+n>>2);case 5125:case 34042:return P.subarray(a>>2,a+n>>2);case 5123:case 33635:case 32819:case 32820:case 36193:return C.subarray(a>>1,a+n>>1);default:return zn||(zn=1280),null}}function In(){return In.l||(In.l=[]),In.l.push(gr()),In.l.length-1}var Pn={},Bn=1;function Fn(e){return 0===e%4&&(0!==e%100||0===e%400)}function jn(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var Dn=[31,29,31,30,31,30,31,31,30,31,30,31],Rn=[31,28,31,30,31,30,31,31,30,31,30,31];function Vn(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(Fn(e.getFullYear())?Dn:Rn)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function qn(e,t,n,r){function a(e,t,n){for(e="number"===typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function i(e,t){return a(e,t,"0")}function o(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function u(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function c(e){e=Vn(new Date(e.j+1900,0,1),e.V);var t=u(new Date(e.getFullYear()+1,0,4));return 0>=o(u(new Date(e.getFullYear(),0,4)),e)?0>=o(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var f=I[r+40>>2];for(var s in r={Qa:I[r>>2],Pa:I[r+4>>2],U:I[r+8>>2],H:I[r+12>>2],C:I[r+16>>2],j:I[r+20>>2],va:I[r+24>>2],V:I[r+28>>2],ad:I[r+32>>2],Oa:I[r+36>>2],Ra:f?M(f):""},n=M(n),f={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S"})n=n.replace(new RegExp(s,"g"),f[s]);var _="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),l="January February March April May June July August September October November December".split(" ");for(s in f={"%a":function(e){return _[e.va].substring(0,3)},"%A":function(e){return _[e.va]},"%b":function(e){return l[e.C].substring(0,3)},"%B":function(e){return l[e.C]},"%C":function(e){return i((e.j+1900)/100|0,2)},"%d":function(e){return i(e.H,2)},"%e":function(e){return a(e.H,2," ")},"%g":function(e){return c(e).toString().substring(2)},"%G":function(e){return c(e)},"%H":function(e){return i(e.U,2)},"%I":function(e){return 0==(e=e.U)?e=12:12<e&&(e-=12),i(e,2)},"%j":function(e){return i(e.H+jn(Fn(e.j+1900)?Dn:Rn,e.C-1),3)},"%m":function(e){return i(e.C+1,2)},"%M":function(e){return i(e.Pa,2)},"%n":function(){return"\\n"},"%p":function(e){return 0<=e.U&&12>e.U?"AM":"PM"},"%S":function(e){return i(e.Qa,2)},"%t":function(){return"\\t"},"%u":function(e){return new Date(e.j+1900,e.C+1,e.H,0,0,0,0).getDay()||7},"%U":function(e){var t=new Date(e.j+1900,0,1),n=0===t.getDay()?t:Vn(t,7-t.getDay());return 0>o(n,e=new Date(e.j+1900,e.C,e.H))?i(Math.ceil((31-n.getDate()+(jn(Fn(e.getFullYear())?Dn:Rn,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%V":function(e){var t=u(new Date(e.j+1900,0,4)),n=u(new Date(e.j+1901,0,4)),r=Vn(new Date(e.j+1900,0,1),e.V);return 0>o(r,t)?"53":0>=o(n,r)?"01":i(Math.ceil((t.getFullYear()<e.j+1900?e.V+32-t.getDate():e.V+1-t.getDate())/7),2)},"%w":function(e){return new Date(e.j+1900,e.C+1,e.H,0,0,0,0).getDay()},"%W":function(e){var t=new Date(e.j,0,1),n=1===t.getDay()?t:Vn(t,0===t.getDay()?1:7-t.getDay()+1);return 0>o(n,e=new Date(e.j+1900,e.C,e.H))?i(Math.ceil((31-n.getDate()+(jn(Fn(e.getFullYear())?Dn:Rn,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%y":function(e){return(e.j+1900).toString().substring(2)},"%Y":function(e){return e.j+1900},"%z":function(e){var t=0<=(e=e.Oa);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.Ra},"%%":function(){return"%"}},f)0<=n.indexOf(s)&&(n=n.replace(new RegExp(s,"g"),f[s](r)));return(s=Un(n,!1)).length>t?0:(T.set(s,e),s.length-1)}be="undefined"!==typeof dateNow?dateNow:"object"===typeof self&&self.performance&&"function"===typeof self.performance.now?function(){return self.performance.now()}:"object"===typeof performance&&"function"===typeof performance.now?function(){return performance.now()}:Date.now,vt(),He=Array(4096),st(qe,"/"),lt("/tmp"),lt("/home"),lt("/home/web_user"),function(){if(lt("/dev"),ft(259,{read:function(){return 0},write:function(e,t,n,r){return r}}),pt("/dev/null",259),je(1280,Re),je(1536,Ve),pt("/dev/tty",1280),pt("/dev/tty1",1536),"undefined"!==typeof crypto)var e=new Uint8Array(1),t=function(){return crypto.getRandomValues(e),e[0]};else t=function(){Mr("random_device")};gt("random",t),gt("urandom",t),lt("/dev/shm"),lt("/dev/shm/tmp")}(),lt("/proc"),lt("/proc/self"),lt("/proc/self/fd"),st({A:function(){var e=tt("/proc/self","fd",16895,73);return e.c={lookup:function(e,t){var n=Ue[+t];if(!n)throw new Xe(ge.B);return(e={parent:null,A:{ta:"fake"},c:{readlink:function(){return n.path}}}).parent=e}},e}},"/proc/self/fd"),$.unshift((function(){if(!r.noFSInit&&!ut){b(!ut,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),ut=!0,vt(),r.stdin=r.stdin,r.stdout=r.stdout,r.stderr=r.stderr,r.stdin?gt("stdin",r.stdin):dt("/dev/tty","/dev/stdin"),r.stdout?gt("stdout",null,r.stdout):dt("/dev/tty","/dev/stdout"),r.stderr?gt("stderr",null,r.stderr):dt("/dev/tty1","/dev/stderr");var e=ht("/dev/stdin","r");b(0===e.fd,"invalid handle for stdin ("+e.fd+")"),b(1===(e=ht("/dev/stdout","w")).fd,"invalid handle for stdout ("+e.fd+")"),b(2===(e=ht("/dev/stderr","w")).fd,"invalid handle for stderr ("+e.fd+")")}})),ee.push((function(){Ze=!1})),te.push((function(){ut=!1;var e=r._fflush;for(e&&e(0),e=0;e<Ue.length;e++){var t=Ue[e];t&&yt(t)}})),$.unshift((function(){})),te.push((function(){})),r.requestFullScreen=function(e,t,n){f("Module.requestFullScreen is deprecated. Please call Module.requestFullscreen instead."),r.requestFullScreen=r.requestFullscreen,en(e,t,n)},r.requestFullscreen=function(e,t,n){$t(e,t,n)},r.requestAnimationFrame=function(e){rn(e)},r.setCanvasSize=function(e,t,n){fn(r.canvas,e,t),n||cn()},r.pauseMainLoop=function(){Bt=null,jt++},r.resumeMainLoop=function(){jt++;var e=Vt,t=qt,n=Dt;Dt=null,St(n,0,!1,Rt,!0),Ot(e,t),Bt()},r.getUserMedia=function(){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(void 0)},r.createContext=function(e,t,n,r){return Xt(e,t,n,r)},function(){var e="undefined"===typeof ENVIRONMENT_IS_FETCH_WORKER;!function(e,t){try{var n=indexedDB.open("emscripten_filesystem",1)}catch(r){return void t(r)}n.onupgradeneeded=function(e){(e=e.target.result).objectStoreNames.contains("FILES")&&e.deleteObjectStore("FILES"),e.createObjectStore("FILES")},n.onsuccess=function(t){e(t.target.result)},n.onerror=function(e){t(e)}}((function(t){mn=t,e&&pe()}),(function(){mn=!1,e&&pe()})),"undefined"!==typeof ENVIRONMENT_IS_FETCH_WORKER&&ENVIRONMENT_IS_FETCH_WORKER||le()}();for(var Gn,Nn=0;256>Nn;Nn++);for(Nn=0;32>Nn;Nn++)Tn.push(Array(Nn));function Un(e,t){var n=Array(L(e)+1);return e=A(e,n,0,n.length),t&&(n.length=e),n}N=s(4),R=V=l(j),G=l(q=R+X),I[N>>2]=G,D=!0,r.wasmTableSize=2468,r.wasmMaxTableSize=2468,r.Aa={},r.Ba={abort:Mr,assert:b,enlargeMemory:Y,getTotalMemory:function(){return K},abortOnCannotGrowMemory:function(){Mr("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+K+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")},invoke_i:function(e){var t=gr();try{return r.dynCall_i(e)}catch(n){if(vr(t),"number"!==typeof n&&"longjmp"!==n)throw n;r.setThrew(1,0)}},invoke_ii:function(e,t){var n=gr();try{return r.dynCall_ii(e,t)}catch(a){if(vr(n),"number"!==typeof a&&"longjmp"!==a)throw a;r.setThrew(1,0)}},invoke_iii:function(e,t,n){var a=gr();try{return r.dynCall_iii(e,t,n)}catch(i){if(vr(a),"number"!==typeof i&&"longjmp"!==i)throw i;r.setThrew(1,0)}},invoke_iiii:function(e,t,n,a){var i=gr();try{return r.dynCall_iiii(e,t,n,a)}catch(o){if(vr(i),"number"!==typeof o&&"longjmp"!==o)throw o;r.setThrew(1,0)}},invoke_iiiii:function(e,t,n,a,i){var o=gr();try{return r.dynCall_iiiii(e,t,n,a,i)}catch(u){if(vr(o),"number"!==typeof u&&"longjmp"!==u)throw u;r.setThrew(1,0)}},invoke_iiiiid:function(e,t,n,a,i,o){var u=gr();try{return r.dynCall_iiiiid(e,t,n,a,i,o)}catch(c){if(vr(u),"number"!==typeof c&&"longjmp"!==c)throw c;r.setThrew(1,0)}},invoke_iiiiii:function(e,t,n,a,i,o){var u=gr();try{return r.dynCall_iiiiii(e,t,n,a,i,o)}catch(c){if(vr(u),"number"!==typeof c&&"longjmp"!==c)throw c;r.setThrew(1,0)}},invoke_iiiiiid:function(e,t,n,a,i,o,u){var c=gr();try{return r.dynCall_iiiiiid(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_iiiiiii:function(e,t,n,a,i,o,u){var c=gr();try{return r.dynCall_iiiiiii(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_iiiiiiii:function(e,t,n,a,i,o,u,c){var f=gr();try{return r.dynCall_iiiiiiii(e,t,n,a,i,o,u,c)}catch(s){if(vr(f),"number"!==typeof s&&"longjmp"!==s)throw s;r.setThrew(1,0)}},invoke_iiiiiiiii:function(e,t,n,a,i,o,u,c,f){var s=gr();try{return r.dynCall_iiiiiiiii(e,t,n,a,i,o,u,c,f)}catch(_){if(vr(s),"number"!==typeof _&&"longjmp"!==_)throw _;r.setThrew(1,0)}},invoke_iiiiij:function(e,t,n,a,i,o,u){var c=gr();try{return r.dynCall_iiiiij(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_iiji:function(e,t,n,a,i){var o=gr();try{return r.dynCall_iiji(e,t,n,a,i)}catch(u){if(vr(o),"number"!==typeof u&&"longjmp"!==u)throw u;r.setThrew(1,0)}},invoke_v:function(e){var t=gr();try{r.dynCall_v(e)}catch(n){if(vr(t),"number"!==typeof n&&"longjmp"!==n)throw n;r.setThrew(1,0)}},invoke_vi:function(e,t){var n=gr();try{r.dynCall_vi(e,t)}catch(a){if(vr(n),"number"!==typeof a&&"longjmp"!==a)throw a;r.setThrew(1,0)}},invoke_vii:function(e,t,n){var a=gr();try{r.dynCall_vii(e,t,n)}catch(i){if(vr(a),"number"!==typeof i&&"longjmp"!==i)throw i;r.setThrew(1,0)}},invoke_viiffii:function(e,t,n,a,i,o,u){var c=gr();try{r.dynCall_viiffii(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_viii:function(e,t,n,a){var i=gr();try{r.dynCall_viii(e,t,n,a)}catch(o){if(vr(i),"number"!==typeof o&&"longjmp"!==o)throw o;r.setThrew(1,0)}},invoke_viiifffii:function(e,t,n,a,i,o,u,c,f){var s=gr();try{r.dynCall_viiifffii(e,t,n,a,i,o,u,c,f)}catch(_){if(vr(s),"number"!==typeof _&&"longjmp"!==_)throw _;r.setThrew(1,0)}},invoke_viiiffii:function(e,t,n,a,i,o,u,c){var f=gr();try{r.dynCall_viiiffii(e,t,n,a,i,o,u,c)}catch(s){if(vr(f),"number"!==typeof s&&"longjmp"!==s)throw s;r.setThrew(1,0)}},invoke_viiii:function(e,t,n,a,i){var o=gr();try{r.dynCall_viiii(e,t,n,a,i)}catch(u){if(vr(o),"number"!==typeof u&&"longjmp"!==u)throw u;r.setThrew(1,0)}},invoke_viiiii:function(e,t,n,a,i,o){var u=gr();try{r.dynCall_viiiii(e,t,n,a,i,o)}catch(c){if(vr(u),"number"!==typeof c&&"longjmp"!==c)throw c;r.setThrew(1,0)}},invoke_viiiiiffffffffffffffff:function(e,t,n,a,i,o,u,c,f,s,_,l,p,d,m,h,y,b,v,g,w,M){var k=gr();try{r.dynCall_viiiiiffffffffffffffff(e,t,n,a,i,o,u,c,f,s,_,l,p,d,m,h,y,b,v,g,w,M)}catch(x){if(vr(k),"number"!==typeof x&&"longjmp"!==x)throw x;r.setThrew(1,0)}},invoke_viiiiii:function(e,t,n,a,i,o,u){var c=gr();try{r.dynCall_viiiiii(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_viijii:function(e,t,n,a,i,o,u){var c=gr();try{r.dynCall_viijii(e,t,n,a,i,o,u)}catch(f){if(vr(c),"number"!==typeof f&&"longjmp"!==f)throw f;r.setThrew(1,0)}},invoke_vij:function(e,t,n,a){var i=gr();try{r.dynCall_vij(e,t,n,a)}catch(o){if(vr(i),"number"!==typeof o&&"longjmp"!==o)throw o;r.setThrew(1,0)}},invoke_viji:function(e,t,n,a,i){var o=gr();try{r.dynCall_viji(e,t,n,a,i)}catch(u){if(vr(o),"number"!==typeof u&&"longjmp"!==u)throw u;r.setThrew(1,0)}},invoke_vijii:function(e,t,n,a,i,o){var u=gr();try{r.dynCall_vijii(e,t,n,a,i,o)}catch(c){if(vr(u),"number"!==typeof c&&"longjmp"!==c)throw c;r.setThrew(1,0)}},___buildEnvironment:function e(t){if(e.Da)var n=I[t>>2],a=I[n>>2];else e.Da=!0,ye.USER=ye.LOGNAME="web_user",ye.PATH="/",ye.PWD="/",ye.HOME="/home/web_user",ye.LANG="C.UTF-8",ye._=r.thisProgram,a=D?re?hr(1024):_(1024):s(1024),n=D?re?hr(256):_(256):s(256),I[n>>2]=a,I[t>>2]=n;t=[];var i,o=0;for(i in ye)if("string"===typeof ye[i]){var u=i+"="+ye[i];t.push(u),o+=u.length}if(1024<o)throw Error("Environment size exceeded TOTAL_ENV_SIZE!");for(i=0;i<t.length;i++){o=u=t[i];for(var c=a,f=0;f<o.length;++f)T[c++>>0]=o.charCodeAt(f);T[c>>0]=0,I[n+4*i>>2]=a,a+=u.length+1}I[n+4*t.length>>2]=0},___clock_gettime:function(){return Me.apply(null,arguments)},___cxa_allocate_exception:function(e){return hr(e)},___cxa_begin_catch:function(e){var t=ze[e];return t&&!t.ma&&(t.ma=!0,lr.$--),t&&(t.L=!1),xe.push(e),(t=Ae(e))&&ze[t].J++,e},___cxa_current_primary_exception:function(){var e=xe[xe.length-1]||0;if(e){var t=Ae(e);t&&ze[t].J++}return e},___cxa_decrement_exception_refcount:function(e){Le(Ae(e))},___cxa_end_catch:function(){r.setThrew(0);var e=xe.pop();e&&(Le(Ae(e)),ke=0)},___cxa_find_matching_catch:function e(){var t=ke;if(!t)return 0|(yr(0),0);var n=ze[t],a=n.type;if(!a)return 0|(yr(0),t);var i=Array.prototype.slice.call(arguments);r.___cxa_is_pointer_type(a),e.buffer||(e.buffer=hr(4)),I[e.buffer>>2]=t,t=e.buffer;for(var o=0;o<i.length;o++)if(i[o]&&r.___cxa_can_catch(i[o],a,t))return t=I[t>>2],n.ka=t,0|(yr(i[o]),t);return t=I[t>>2],0|(yr(a),t)},___cxa_free_exception:Ee,___cxa_increment_exception_refcount:function(e){(e=Ae(e))&&ze[e].J++},___cxa_pure_virtual:function(){throw y=!0,"Pure virtual function called!"},___cxa_rethrow:Te,___cxa_rethrow_primary_exception:function(e){e&&(xe.push(e),ze[e].L=!0,Te())},___cxa_throw:function(e,t,n){throw ze[e]={Ka:e,ka:e,type:t,oa:n,J:0,ma:!1,L:!1},ke=e,"uncaught_exception"in lr?lr.$++:lr.$=1,e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."},___cxa_uncaught_exception:function(){return!!lr.$},___gxx_personality_v0:function(){},___lock:function(){},___map_file:function(){return we(ge.I),-1},___resumeException:function(e){throw ke||(ke=e),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."},___setErrNo:we,___syscall140:function(e,t){Lt=t;try{var n=Tt();Et();var r=Et(),a=Et(),i=Et();return bt(n,r,i),I[a>>2]=n.position,n.ba&&0===r&&0===i&&(n.ba=null),0}catch(o){return"undefined"!==typeof zt&&o instanceof Xe||Mr(o),-o.v}},___syscall145:function(e,t){Lt=t;try{var n=Tt(),r=Et();e:{var a=Et();for(t=e=0;t<a;t++){var i=I[r+(8*t+4)>>2],o=n,u=I[r+8*t>>2],c=i,f=void 0,s=T;if(0>c||0>f)throw new Xe(ge.i);if(null===o.fd)throw new Xe(ge.B);if(1===(2097155&o.flags))throw new Xe(ge.B);if(16384===(61440&o.node.mode))throw new Xe(ge.N);if(!o.f.read)throw new Xe(ge.i);var _="undefined"!==typeof f;if(_){if(!o.seekable)throw new Xe(ge.O)}else f=o.position;var l=o.f.read(o,s,u,c,f);_||(o.position+=l);var p=l;if(0>p){var d=-1;break e}if(e+=p,p<i)break}d=e}return d}catch(m){return"undefined"!==typeof zt&&m instanceof Xe||Mr(m),-m.v}},___syscall146:function(e,t){Lt=t;try{var n=Tt(),r=Et();e:{var a=Et();for(t=e=0;t<a;t++){var i=n,o=I[r+8*t>>2],u=I[r+(8*t+4)>>2],c=T,f=void 0;if(0>u||0>f)throw new Xe(ge.i);if(null===i.fd)throw new Xe(ge.B);if(0===(2097155&i.flags))throw new Xe(ge.B);if(16384===(61440&i.node.mode))throw new Xe(ge.N);if(!i.f.write)throw new Xe(ge.i);1024&i.flags&&bt(i,0,2);var s="undefined"!==typeof f;if(s){if(!i.seekable)throw new Xe(ge.O)}else f=i.position;var _=i.f.write(i,c,o,u,f,void 0);s||(i.position+=_);try{i.path&&Ye.onWriteToFile&&Ye.onWriteToFile(i.path)}catch(d){console.log("FS.trackingDelegate[\'onWriteToFile\'](\'"+path+"\') threw an exception: "+d.message)}var l=_;if(0>l){var p=-1;break e}e+=l}p=e}return p}catch(d){return"undefined"!==typeof zt&&d instanceof Xe||Mr(d),-d.v}},___syscall196:function(e,t){Lt=t;try{var n=M(Et());e:{var r=Et();try{var a=Je(n,{aa:!1}).node;if(!a)throw new Xe(ge.u);if(!a.c.m)throw new Xe(ge.I);var i=a.c.m(a)}catch(u){if(u&&u.node&&Ce(n)!==Ce(Qe(u.node))){var o=-ge.Z;break e}throw u}I[r>>2]=i.dev,I[r+4>>2]=0,I[r+8>>2]=i.ino,I[r+12>>2]=i.mode,I[r+16>>2]=i.nlink,I[r+20>>2]=i.uid,I[r+24>>2]=i.gid,I[r+28>>2]=i.rdev,I[r+32>>2]=0,I[r+36>>2]=i.size,I[r+40>>2]=4096,I[r+44>>2]=i.blocks,I[r+48>>2]=i.atime.getTime()/1e3|0,I[r+52>>2]=0,I[r+56>>2]=i.mtime.getTime()/1e3|0,I[r+60>>2]=0,I[r+64>>2]=i.ctime.getTime()/1e3|0,I[r+68>>2]=0,I[r+72>>2]=i.ino,o=0}return o}catch(u){return"undefined"!==typeof zt&&u instanceof Xe||Mr(u),-u.v}},___syscall221:function(e,t){Lt=t;try{var n=Tt();switch(Et()){case 0:var r=Et();return 0>r?-ge.i:ht(n.path,n.flags,0,r).fd;case 1:case 2:case 13:case 14:case 13:case 14:return 0;case 3:return n.flags;case 4:return r=Et(),n.flags|=r,0;case 12:case 12:return r=Et(),S[r+0>>1]=2,0;case 16:case 8:default:return-ge.i;case 9:return we(ge.i),-1}}catch(a){return"undefined"!==typeof zt&&a instanceof Xe||Mr(a),-a.v}},___syscall5:function(e,t){Lt=t;try{return ht(M(Et()),Et(),Et()).fd}catch(n){return"undefined"!==typeof zt&&n instanceof Xe||Mr(n),-n.v}},___syscall54:function(e,t){Lt=t;try{var n=Tt(),r=Et();switch(r){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return n.tty?0:-ge.D;case 21519:if(!n.tty)return-ge.D;var a=Et();return I[a>>2]=0;case 21520:return n.tty?-ge.i:-ge.D;case 21531:if(e=a=Et(),!n.f.Ha)throw new Xe(ge.D);return n.f.Ha(n,r,e);default:Mr("bad ioctl syscall "+r)}}catch(i){return"undefined"!==typeof zt&&i instanceof Xe||Mr(i),-i.v}},___syscall6:function(e,t){Lt=t;try{return yt(Tt()),0}catch(n){return"undefined"!==typeof zt&&n instanceof Xe||Mr(n),-n.v}},___syscall91:function(e,t){Lt=t;try{var n=Et(),r=Et(),a=At[n];if(!a)return 0;if(r===a.Xc){var i=Ue[a.fd],o=a.flags,u=new Uint8Array(O.subarray(n,n+r));i&&i.f.T&&i.f.T(i,u,0,r,o),At[n]=null,a.za&&mr(a.Yc)}return 0}catch(c){return"undefined"!==typeof zt&&c instanceof Xe||Mr(c),-c.v}},___unlock:function(){},__addDays:Vn,__arraySum:jn,__emscripten_fetch_cache_data:bn,__emscripten_fetch_delete_cached_data:gn,__emscripten_fetch_load_cached_data:vn,__emscripten_fetch_xhr:yn,__emscripten_get_fetch_work_queue:function(){return wn},__isLeapYear:Fn,_abort:function(){r.abort()},_clock_gettime:Me,_emidentity:function(){var e=new URL(location.origin).hostname;if(0===e.length&&(e=new URL(location.href.replace("blob:","")).hostname),/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e))0===e.indexOf("10.")&&(e="10.*"),0===e.indexOf("192.168.")&&(e="192.168.*"),0===e.indexOf("172.")&&(e="172.*"),0===e.indexOf("127.")&&(e="127.*");else{var t=new RegExp("("+String.fromCharCode(92)+".ngrok"+String.fromCharCode(92)+".io)$","i");t.test(e)&&(e="*.ngrok.io"),(t=new RegExp("("+String.fromCharCode(92)+".arweb"+String.fromCharCode(92)+".app)$","i")).test(e)&&(e="*.arweb.app")}t=L(e)+1;var n=hr(t);return A(e,O,n,t+1),n},_emlicerr:function(){self.postMessage({t:"licerr"})},_emscripten_asm_const_i:function(e){return me[e]()},_emscripten_async_call:function(e,t,n){function a(){!function(e){if(e){b("vi"),m.vi||(m.vi={});var t=m.vi;return t[e]||(t[e]=function(t){return h("vi",e,[t])}),t[e]}}(e)(t)}r.noExitRuntime=!0,0<=n?an(a,n):function(e){rn((function(){y||e()}))}(a)},_emscripten_get_now:be,_emscripten_get_now_is_monotonic:ve,_emscripten_is_main_browser_thread:function(){return!1},_emscripten_is_main_runtime_thread:function(){return 1},_emscripten_memcpy_big:function(e,t,n){return O.set(O.subarray(t,t+n),e),e},_emscripten_set_main_loop:St,_emscripten_set_main_loop_timing:Ot,_emscripten_start_fetch:function(e,t,n,a){function i(e){l?r.dynCall_vi(l,e):n&&n(e)}function o(e){p?r.dynCall_vi(p,e):a&&a(e)}function u(e,n){bn(mn,e,n.response,(function(e){_?r.dynCall_vi(_,e):t&&t(e)}),(function(e){_?r.dynCall_vi(_,e):t&&t(e)}))}function c(e){_?r.dynCall_vi(_,e):t&&t(e)}"undefined"!==typeof r&&(r.noExitRuntime=!0);var f=e+112,s=M(f),_=P[f+36>>2],l=P[f+40>>2],p=P[f+44>>2],d=P[f+48>>2],m=!!(4&d),h=!!(32&d);if(16&d&&"EM_IDB_STORE"!==s&&"EM_IDB_DELETE"!==s){if(h)return 0;yn(e,m?u:c,i,o)}else{if(!mn)return i(e),0;"EM_IDB_STORE"===s?(s=P[f+80>>2],f=O.slice(s,s+P[f+84>>2]),bn(mn,e,f,c,i)):"EM_IDB_DELETE"===s?gn(mn,e,c,i):vn(mn,e,c,h?i:m?function(e){yn(e,u,i,o)}:function(e){yn(e,c,i,o)})}return e},_getenv:function e(t){if(0===t)return 0;if(t=M(t),!ye.hasOwnProperty(t))return 0;e.l&&mr(e.l);var n=L(t=ye[t])+1,r=hr(n);return r&&A(t,T,r,n),e.l=r},_gettimeofday:function(e){var t=Date.now();return I[e>>2]=t/1e3|0,I[e+4>>2]=t%1e3*1e3|0,0},_glBindTexture:function(e,t){Gn.bindTexture(e,t?An[t]:null)},_glGenTextures:function(e,t){for(var n=0;n<e;n++){var r=Gn.createTexture();if(!r){for(zn||(zn=1282);n<e;)I[t+4*n++>>2]=0;break}var a=On(An);r.name=a,An[a]=r,I[t+4*n>>2]=a}},_glTexImage2D:function(e,t,n,r,a,i,o,u,c){var f=null;c&&(f=Cn(u,o,r,a,c)),Gn.texImage2D(e,t,n,r,a,i,o,u,f)},_glTexParameteri:function(e,t,n){Gn.texParameteri(e,t,n)},_llvm_exp2_f32:function(e){return Math.pow(2,e)},_llvm_stackrestore:function(e){var t=In.l[e];In.l.splice(e,1),vr(t)},_llvm_stacksave:In,_llvm_trap:function(){Mr("trap!")},_pthread_cond_destroy:function(){return 0},_pthread_cond_init:function(){return 0},_pthread_cond_signal:function(){return 0},_pthread_cond_wait:function(){return 0},_pthread_create:function(){return 11},_pthread_getspecific:function(e){return Pn[e]||0},_pthread_join:function(){},_pthread_key_create:function(e){return 0==e?ge.i:(I[e>>2]=Bn,Pn[Bn]=0,Bn++,0)},_pthread_mutex_destroy:function(){},_pthread_mutex_init:function(){},_pthread_once:function e(t,n){e.l||(e.l={}),t in e.l||(r.dynCall_v(n),e.l[t]=1)},_pthread_setspecific:function(e,t){return e in Pn?(Pn[e]=t,0):ge.i},_strftime:qn,_strftime_l:function(e,t,n,r){return qn(e,t,n,r)},_sysconf:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131068;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===typeof navigator&&navigator.hardwareConcurrency||1}return we(ge.i),-1},emscriptenWebGLComputeImageSize:Sn,emscriptenWebGLGetTexPixelData:Cn,DYNAMICTOP_PTR:N,tempDoublePtr:he,STACKTOP:V,STACK_MAX:q};var Wn=r.asm(r.Aa,r.Ba,E);r.asm=Wn;var Hn=r.__GLOBAL__I_000101=function(){return r.asm.__GLOBAL__I_000101.apply(null,arguments)},Zn=r.__GLOBAL__sub_I_AZHighLevelEncoder_cpp=function(){return r.asm.__GLOBAL__sub_I_AZHighLevelEncoder_cpp.apply(null,arguments)},Yn=r.__GLOBAL__sub_I_CameraSource_cpp=function(){return r.asm.__GLOBAL__sub_I_CameraSource_cpp.apply(null,arguments)},Xn=r.__GLOBAL__sub_I_CharacterSetECI_cpp=function(){return r.asm.__GLOBAL__sub_I_CharacterSetECI_cpp.apply(null,arguments)},Kn=r.__GLOBAL__sub_I_DMECEncoder_cpp=function(){return r.asm.__GLOBAL__sub_I_DMECEncoder_cpp.apply(null,arguments)},Jn=r.__GLOBAL__sub_I_DMHighLevelEncoder_cpp=function(){return r.asm.__GLOBAL__sub_I_DMHighLevelEncoder_cpp.apply(null,arguments)},Qn=r.__GLOBAL__sub_I_GridSampler_cpp=function(){return r.asm.__GLOBAL__sub_I_GridSampler_cpp.apply(null,arguments)},$n=r.__GLOBAL__sub_I_ODCode128Patterns_cpp=function(){return r.asm.__GLOBAL__sub_I_ODCode128Patterns_cpp.apply(null,arguments)},er=r.__GLOBAL__sub_I_ODRSSExpandedReader_cpp=function(){return r.asm.__GLOBAL__sub_I_ODRSSExpandedReader_cpp.apply(null,arguments)},tr=r.__GLOBAL__sub_I_PDFDetector_cpp=function(){return r.asm.__GLOBAL__sub_I_PDFDetector_cpp.apply(null,arguments)},nr=r.__GLOBAL__sub_I_StandardStatsManager_cpp=function(){return r.asm.__GLOBAL__sub_I_StandardStatsManager_cpp.apply(null,arguments)},rr=r.__GLOBAL__sub_I_barcode_finder_cpp=function(){return r.asm.__GLOBAL__sub_I_barcode_finder_cpp.apply(null,arguments)},ar=r.__GLOBAL__sub_I_face_landmark_cpp=function(){return r.asm.__GLOBAL__sub_I_face_landmark_cpp.apply(null,arguments)},ir=r.__GLOBAL__sub_I_face_mesh_cpp=function(){return r.asm.__GLOBAL__sub_I_face_mesh_cpp.apply(null,arguments)},or=r.__GLOBAL__sub_I_face_tracker_cpp=function(){return r.asm.__GLOBAL__sub_I_face_tracker_cpp.apply(null,arguments)},ur=r.__GLOBAL__sub_I_image_tracker_cpp=function(){return r.asm.__GLOBAL__sub_I_image_tracker_cpp.apply(null,arguments)},cr=r.__GLOBAL__sub_I_instant_tracker_cpp=function(){return r.asm.__GLOBAL__sub_I_instant_tracker_cpp.apply(null,arguments)},fr=r.__GLOBAL__sub_I_iostream_cpp=function(){return r.asm.__GLOBAL__sub_I_iostream_cpp.apply(null,arguments)},sr=r.__GLOBAL__sub_I_pipeline_cpp=function(){return r.asm.__GLOBAL__sub_I_pipeline_cpp.apply(null,arguments)},_r=r.__GLOBAL__sub_I_zappar_face_tracker_cpp=function(){return r.asm.__GLOBAL__sub_I_zappar_face_tracker_cpp.apply(null,arguments)};r.__Z20zappar_face_mesh_uvsP19zappar_face_mesh_ti=function(){return r.asm.__Z20zappar_face_mesh_uvsP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z23zappar_face_mesh_updateP19zappar_face_mesh_tiPKfS2_i=function(){return r.asm.__Z23zappar_face_mesh_updateP19zappar_face_mesh_tiPKfS2_i.apply(null,arguments)},r.__Z24zappar_face_mesh_indicesP19zappar_face_mesh_ti=function(){return r.asm.__Z24zappar_face_mesh_indicesP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z24zappar_face_mesh_normalsP19zappar_face_mesh_ti=function(){return r.asm.__Z24zappar_face_mesh_normalsP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z25zappar_face_mesh_uvs_sizeP19zappar_face_mesh_ti=function(){return r.asm.__Z25zappar_face_mesh_uvs_sizeP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z25zappar_face_mesh_verticesP19zappar_face_mesh_ti=function(){return r.asm.__Z25zappar_face_mesh_verticesP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z27zappar_face_landmark_updateP23zappar_face_landmark_tiPKfS2_i=function(){return r.asm.__Z27zappar_face_landmark_updateP23zappar_face_landmark_tiPKfS2_i.apply(null,arguments)},r.__Z29zappar_face_mesh_indices_sizeP19zappar_face_mesh_ti=function(){return r.asm.__Z29zappar_face_mesh_indices_sizeP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z29zappar_face_mesh_normals_sizeP19zappar_face_mesh_ti=function(){return r.asm.__Z29zappar_face_mesh_normals_sizeP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z30zappar_face_mesh_vertices_sizeP19zappar_face_mesh_ti=function(){return r.asm.__Z30zappar_face_mesh_vertices_sizeP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z31zappar_face_mesh_loaded_versionP19zappar_face_mesh_ti=function(){return r.asm.__Z31zappar_face_mesh_loaded_versionP19zappar_face_mesh_ti.apply(null,arguments)},r.__Z33zappar_face_mesh_load_from_memoryP19zappar_face_mesh_tiPKciiiii=function(){return r.asm.__Z33zappar_face_mesh_load_from_memoryP19zappar_face_mesh_tiPKciiiii.apply(null,arguments)},r.__Z40zappar_image_tracker_target_preview_rgbaP23zappar_image_tracker_tii=function(){return r.asm.__Z40zappar_image_tracker_target_preview_rgbaP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z42zappar_image_tracker_target_load_from_fileP23zappar_image_tracker_tiPKc=function(){return r.asm.__Z42zappar_image_tracker_target_load_from_fileP23zappar_image_tracker_tiPKc.apply(null,arguments)},r.__Z45zappar_image_tracker_target_preview_rgba_sizeP23zappar_image_tracker_tii=function(){return r.asm.__Z45zappar_image_tracker_target_preview_rgba_sizeP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z46zappar_image_tracker_target_preview_compressedP23zappar_image_tracker_tii=function(){return r.asm.__Z46zappar_image_tracker_target_preview_compressedP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z46zappar_image_tracker_target_preview_rgba_widthP23zappar_image_tracker_tii=function(){return r.asm.__Z46zappar_image_tracker_target_preview_rgba_widthP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z47zappar_image_tracker_target_preview_rgba_heightP23zappar_image_tracker_tii=function(){return r.asm.__Z47zappar_image_tracker_target_preview_rgba_heightP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z51zappar_image_tracker_target_preview_compressed_sizeP23zappar_image_tracker_tii=function(){return r.asm.__Z51zappar_image_tracker_target_preview_compressed_sizeP23zappar_image_tracker_tii.apply(null,arguments)},r.__Z55zappar_image_tracker_target_preview_compressed_mimetypeP23zappar_image_tracker_tii=function(){return r.asm.__Z55zappar_image_tracker_target_preview_compressed_mimetypeP23zappar_image_tracker_tii.apply(null,arguments)};var lr=r.__ZSt18uncaught_exceptionv=function(){return r.asm.__ZSt18uncaught_exceptionv.apply(null,arguments)};r.___cxa_can_catch=function(){return r.asm.___cxa_can_catch.apply(null,arguments)},r.___cxa_is_pointer_type=function(){return r.asm.___cxa_is_pointer_type.apply(null,arguments)},r.___em_js__emidentity=function(){return r.asm.___em_js__emidentity.apply(null,arguments)},r.___em_js__emlicerr=function(){return r.asm.___em_js__emlicerr.apply(null,arguments)};var pr=r.___emscripten_environ_constructor=function(){return r.asm.___emscripten_environ_constructor.apply(null,arguments)};r.___errno_location=function(){return r.asm.___errno_location.apply(null,arguments)},r.__get_environ=function(){return r.asm.__get_environ.apply(null,arguments)};var dr=r._emscripten_replace_memory=function(){return r.asm._emscripten_replace_memory.apply(null,arguments)},mr=r._free=function(){return r.asm._free.apply(null,arguments)};r._llvm_bswap_i32=function(){return r.asm._llvm_bswap_i32.apply(null,arguments)},r._llvm_round_f32=function(){return r.asm._llvm_round_f32.apply(null,arguments)},r._llvm_round_f64=function(){return r.asm._llvm_round_f64.apply(null,arguments)};var hr=r._malloc=function(){return r.asm._malloc.apply(null,arguments)};r._memcpy=function(){return r.asm._memcpy.apply(null,arguments)},r._memmove=function(){return r.asm._memmove.apply(null,arguments)},r._memset=function(){return r.asm._memset.apply(null,arguments)},r._pthread_cond_broadcast=function(){return r.asm._pthread_cond_broadcast.apply(null,arguments)},r._pthread_mutex_lock=function(){return r.asm._pthread_mutex_lock.apply(null,arguments)},r._pthread_mutex_unlock=function(){return r.asm._pthread_mutex_unlock.apply(null,arguments)},r._round=function(){return r.asm._round.apply(null,arguments)},r._sbrk=function(){return r.asm._sbrk.apply(null,arguments)},r._zappar_analytics_project_id_set=function(){return r.asm._zappar_analytics_project_id_set.apply(null,arguments)},r._zappar_barcode_finder_create=function(){return r.asm._zappar_barcode_finder_create.apply(null,arguments)},r._zappar_barcode_finder_destroy=function(){return r.asm._zappar_barcode_finder_destroy.apply(null,arguments)},r._zappar_barcode_finder_enabled=function(){return r.asm._zappar_barcode_finder_enabled.apply(null,arguments)},r._zappar_barcode_finder_enabled_set=function(){return r.asm._zappar_barcode_finder_enabled_set.apply(null,arguments)},r._zappar_barcode_finder_formats=function(){return r.asm._zappar_barcode_finder_formats.apply(null,arguments)},r._zappar_barcode_finder_formats_set=function(){return r.asm._zappar_barcode_finder_formats_set.apply(null,arguments)},r._zappar_barcode_finder_found_format=function(){return r.asm._zappar_barcode_finder_found_format.apply(null,arguments)},r._zappar_barcode_finder_found_number=function(){return r.asm._zappar_barcode_finder_found_number.apply(null,arguments)},r._zappar_barcode_finder_found_text=function(){return r.asm._zappar_barcode_finder_found_text.apply(null,arguments)},r._zappar_camera_default_device_id=function(){return r.asm._zappar_camera_default_device_id.apply(null,arguments)},r._zappar_camera_source_create=function(){return r.asm._zappar_camera_source_create.apply(null,arguments)},r._zappar_camera_source_destroy=function(){return r.asm._zappar_camera_source_destroy.apply(null,arguments)},r._zappar_camera_source_pause=function(){return r.asm._zappar_camera_source_pause.apply(null,arguments)},r._zappar_camera_source_start=function(){return r.asm._zappar_camera_source_start.apply(null,arguments)},r._zappar_face_landmark_anchor_pose=function(){return r.asm._zappar_face_landmark_anchor_pose.apply(null,arguments)},r._zappar_face_landmark_create=function(){return r.asm._zappar_face_landmark_create.apply(null,arguments)},r._zappar_face_landmark_destroy=function(){return r.asm._zappar_face_landmark_destroy.apply(null,arguments)},r._zappar_face_mesh_create=function(){return r.asm._zappar_face_mesh_create.apply(null,arguments)},r._zappar_face_mesh_destroy=function(){return r.asm._zappar_face_mesh_destroy.apply(null,arguments)},r._zappar_face_tracker_anchor_count=function(){return r.asm._zappar_face_tracker_anchor_count.apply(null,arguments)},r._zappar_face_tracker_anchor_expression_coefficients=function(){return r.asm._zappar_face_tracker_anchor_expression_coefficients.apply(null,arguments)},r._zappar_face_tracker_anchor_id=function(){return r.asm._zappar_face_tracker_anchor_id.apply(null,arguments)},r._zappar_face_tracker_anchor_identity_coefficients=function(){return r.asm._zappar_face_tracker_anchor_identity_coefficients.apply(null,arguments)},r._zappar_face_tracker_anchor_pose_raw=function(){return r.asm._zappar_face_tracker_anchor_pose_raw.apply(null,arguments)},r._zappar_face_tracker_create=function(){return r.asm._zappar_face_tracker_create.apply(null,arguments)},r._zappar_face_tracker_destroy=function(){return r.asm._zappar_face_tracker_destroy.apply(null,arguments)},r._zappar_face_tracker_enabled=function(){return r.asm._zappar_face_tracker_enabled.apply(null,arguments)},r._zappar_face_tracker_enabled_set=function(){return r.asm._zappar_face_tracker_enabled_set.apply(null,arguments)},r._zappar_face_tracker_max_faces=function(){return r.asm._zappar_face_tracker_max_faces.apply(null,arguments)},r._zappar_face_tracker_max_faces_set=function(){return r.asm._zappar_face_tracker_max_faces_set.apply(null,arguments)},r._zappar_face_tracker_model_load_from_memory=function(){return r.asm._zappar_face_tracker_model_load_from_memory.apply(null,arguments)},r._zappar_face_tracker_model_loaded_version=function(){return r.asm._zappar_face_tracker_model_loaded_version.apply(null,arguments)},r._zappar_has_initialized=function(){return r.asm._zappar_has_initialized.apply(null,arguments)},r._zappar_image_tracker_anchor_count=function(){return r.asm._zappar_image_tracker_anchor_count.apply(null,arguments)},r._zappar_image_tracker_anchor_id=function(){return r.asm._zappar_image_tracker_anchor_id.apply(null,arguments)},r._zappar_image_tracker_anchor_pose_raw=function(){return r.asm._zappar_image_tracker_anchor_pose_raw.apply(null,arguments)},r._zappar_image_tracker_create=function(){return r.asm._zappar_image_tracker_create.apply(null,arguments)},r._zappar_image_tracker_destroy=function(){return r.asm._zappar_image_tracker_destroy.apply(null,arguments)},r._zappar_image_tracker_enabled=function(){return r.asm._zappar_image_tracker_enabled.apply(null,arguments)},r._zappar_image_tracker_enabled_set=function(){return r.asm._zappar_image_tracker_enabled_set.apply(null,arguments)},r._zappar_image_tracker_target_count=function(){return r.asm._zappar_image_tracker_target_count.apply(null,arguments)},r._zappar_image_tracker_target_load_from_memory=function(){return r.asm._zappar_image_tracker_target_load_from_memory.apply(null,arguments)},r._zappar_image_tracker_target_loaded_version=function(){return r.asm._zappar_image_tracker_target_loaded_version.apply(null,arguments)},r._zappar_instant_world_tracker_anchor_pose_raw=function(){return r.asm._zappar_instant_world_tracker_anchor_pose_raw.apply(null,arguments)},r._zappar_instant_world_tracker_anchor_pose_set_from_camera_offset=function(){return r.asm._zappar_instant_world_tracker_anchor_pose_set_from_camera_offset.apply(null,arguments)},r._zappar_instant_world_tracker_create=function(){return r.asm._zappar_instant_world_tracker_create.apply(null,arguments)},r._zappar_instant_world_tracker_destroy=function(){return r.asm._zappar_instant_world_tracker_destroy.apply(null,arguments)},r._zappar_instant_world_tracker_enabled=function(){return r.asm._zappar_instant_world_tracker_enabled.apply(null,arguments)},r._zappar_instant_world_tracker_enabled_set=function(){return r.asm._zappar_instant_world_tracker_enabled_set.apply(null,arguments)},r._zappar_invert=function(){return r.asm._zappar_invert.apply(null,arguments)},r._zappar_loaded=function(){return r.asm._zappar_loaded.apply(null,arguments)},r._zappar_log_level=function(){return r.asm._zappar_log_level.apply(null,arguments)},r._zappar_log_level_set=function(){return r.asm._zappar_log_level_set.apply(null,arguments)},r._zappar_pipeline_camera_frame_camera_attitude=function(){return r.asm._zappar_pipeline_camera_frame_camera_attitude.apply(null,arguments)},r._zappar_pipeline_camera_frame_submit=function(){return r.asm._zappar_pipeline_camera_frame_submit.apply(null,arguments)},r._zappar_pipeline_camera_frame_texture_gl=function(){return r.asm._zappar_pipeline_camera_frame_texture_gl.apply(null,arguments)},r._zappar_pipeline_camera_frame_texture_matrix=function(){return r.asm._zappar_pipeline_camera_frame_texture_matrix.apply(null,arguments)},r._zappar_pipeline_camera_frame_upload_gl=function(){return r.asm._zappar_pipeline_camera_frame_upload_gl.apply(null,arguments)},r._zappar_pipeline_camera_frame_user_data=function(){return r.asm._zappar_pipeline_camera_frame_user_data.apply(null,arguments)},r._zappar_pipeline_camera_frame_user_facing=function(){return r.asm._zappar_pipeline_camera_frame_user_facing.apply(null,arguments)},r._zappar_pipeline_camera_model=function(){return r.asm._zappar_pipeline_camera_model.apply(null,arguments)},r._zappar_pipeline_camera_pose_default=function(){return r.asm._zappar_pipeline_camera_pose_default.apply(null,arguments)},r._zappar_pipeline_camera_pose_with_attitude=function(){return r.asm._zappar_pipeline_camera_pose_with_attitude.apply(null,arguments)},r._zappar_pipeline_camera_pose_with_origin=function(){return r.asm._zappar_pipeline_camera_pose_with_origin.apply(null,arguments)},r._zappar_pipeline_create=function(){return r.asm._zappar_pipeline_create.apply(null,arguments)},r._zappar_pipeline_destroy=function(){return r.asm._zappar_pipeline_destroy.apply(null,arguments)},r._zappar_pipeline_frame_number=function(){return r.asm._zappar_pipeline_frame_number.apply(null,arguments)},r._zappar_pipeline_frame_update=function(){return r.asm._zappar_pipeline_frame_update.apply(null,arguments)},r._zappar_pipeline_motion_accelerometer_submit=function(){return r.asm._zappar_pipeline_motion_accelerometer_submit.apply(null,arguments)},r._zappar_pipeline_motion_attitude_submit=function(){return r.asm._zappar_pipeline_motion_attitude_submit.apply(null,arguments)},r._zappar_pipeline_motion_rotation_rate_submit=function(){return r.asm._zappar_pipeline_motion_rotation_rate_submit.apply(null,arguments)},r._zappar_pipeline_process_gl=function(){return r.asm._zappar_pipeline_process_gl.apply(null,arguments)},r.establishStackSpace=function(){return r.asm.establishStackSpace.apply(null,arguments)},r.getTempRet0=function(){return r.asm.getTempRet0.apply(null,arguments)},r.runPostSets=function(){return r.asm.runPostSets.apply(null,arguments)};var yr=r.setTempRet0=function(){return r.asm.setTempRet0.apply(null,arguments)};r.setThrew=function(){return r.asm.setThrew.apply(null,arguments)};var br=r.stackAlloc=function(){return r.asm.stackAlloc.apply(null,arguments)},vr=r.stackRestore=function(){return r.asm.stackRestore.apply(null,arguments)},gr=r.stackSave=function(){return r.asm.stackSave.apply(null,arguments)};function wr(){function e(){if(!r.calledRun&&(r.calledRun=!0,!y)){if(re||(re=!0,J($)),J(ee),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;){var e=r.postRun.shift();ne.unshift(e)}J(ne)}}if(!(0<fe)){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)ae();J(Q),0<fe||r.calledRun||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),e()}),1)):e())}}function Mr(e){throw r.onAbort&&r.onAbort(e),void 0!==e?(c(e),f(e),e=JSON.stringify(e)):e="",y=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(r.dynCall_i=function(){return r.asm.dynCall_i.apply(null,arguments)},r.dynCall_ii=function(){return r.asm.dynCall_ii.apply(null,arguments)},r.dynCall_iii=function(){return r.asm.dynCall_iii.apply(null,arguments)},r.dynCall_iiii=function(){return r.asm.dynCall_iiii.apply(null,arguments)},r.dynCall_iiiii=function(){return r.asm.dynCall_iiiii.apply(null,arguments)},r.dynCall_iiiiid=function(){return r.asm.dynCall_iiiiid.apply(null,arguments)},r.dynCall_iiiiii=function(){return r.asm.dynCall_iiiiii.apply(null,arguments)},r.dynCall_iiiiiid=function(){return r.asm.dynCall_iiiiiid.apply(null,arguments)},r.dynCall_iiiiiii=function(){return r.asm.dynCall_iiiiiii.apply(null,arguments)},r.dynCall_iiiiiiii=function(){return r.asm.dynCall_iiiiiiii.apply(null,arguments)},r.dynCall_iiiiiiiii=function(){return r.asm.dynCall_iiiiiiiii.apply(null,arguments)},r.dynCall_iiiiij=function(){return r.asm.dynCall_iiiiij.apply(null,arguments)},r.dynCall_iiji=function(){return r.asm.dynCall_iiji.apply(null,arguments)},r.dynCall_v=function(){return r.asm.dynCall_v.apply(null,arguments)},r.dynCall_vi=function(){return r.asm.dynCall_vi.apply(null,arguments)},r.dynCall_vii=function(){return r.asm.dynCall_vii.apply(null,arguments)},r.dynCall_viiffii=function(){return r.asm.dynCall_viiffii.apply(null,arguments)},r.dynCall_viii=function(){return r.asm.dynCall_viii.apply(null,arguments)},r.dynCall_viiifffii=function(){return r.asm.dynCall_viiifffii.apply(null,arguments)},r.dynCall_viiiffii=function(){return r.asm.dynCall_viiiffii.apply(null,arguments)},r.dynCall_viiii=function(){return r.asm.dynCall_viiii.apply(null,arguments)},r.dynCall_viiiii=function(){return r.asm.dynCall_viiiii.apply(null,arguments)},r.dynCall_viiiiiffffffffffffffff=function(){return r.asm.dynCall_viiiiiffffffffffffffff.apply(null,arguments)},r.dynCall_viiiiii=function(){return r.asm.dynCall_viiiiii.apply(null,arguments)},r.dynCall_viijii=function(){return r.asm.dynCall_viijii.apply(null,arguments)},r.dynCall_vij=function(){return r.asm.dynCall_vij.apply(null,arguments)},r.dynCall_viji=function(){return r.asm.dynCall_viji.apply(null,arguments)},r.dynCall_vijii=function(){return r.asm.dynCall_vijii.apply(null,arguments)},r.asm=Wn,r.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?v(e):function(){var r=n,a=arguments,i=v(e),o=[],u=0;if(a)for(var c=0;c<a.length;c++){var f=w[r[c]];f?(0===u&&(u=gr()),o[c]=f(a[c])):o[c]=a[c]}return r=i.apply(null,o),r="string"===t?M(r):"boolean"===t?!!r:r,0!==u&&vr(u),r}},r.setValue=function(e,t,n){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":T[e>>0]=t;break;case"i16":S[e>>1]=t;break;case"i32":I[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,1<=+ie(tempDouble)?0<tempDouble?(0|ce(+ue(tempDouble/4294967296),4294967295))>>>0:~~+oe((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],I[e>>2]=tempI64[0],I[e+4>>2]=tempI64[1];break;case"float":B[e>>2]=t;break;case"double":F[e>>3]=t;break;default:Mr("invalid type for setValue: "+n)}},r.getValue=function(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return T[e>>0];case"i16":return S[e>>1];case"i32":case"i64":return I[e>>2];case"float":return B[e>>2];case"double":return F[e>>3];default:Mr("invalid type for getValue: "+t)}return null},r.UTF8ToString=z,r.then=function(e){if(r.calledRun)e(r);else{var t=r.onRuntimeInitialized;r.onRuntimeInitialized=function(){t&&t(),e(r)}}return r},_e=function e(){r.calledRun||wr(),r.calledRun||(_e=e)},r.run=wr,r.abort=Mr,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return r.noExitRuntime=!0,wr(),n}}();t.default=n}.call(this,n(11).setImmediate)},function(e,t,n){(function(e){var r="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(12),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(4))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,a=1,i={},o=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){s(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&s(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){s(e.data)},r=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;r=function(t){var n=u.createElement("script");n.onreadystatechange=function(){s(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():r=function(e){setTimeout(s,0,e)},c.setImmediate=function(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return i[a]=o,r(a),a++},c.clearImmediate=f}function f(e){delete i[e]}function s(e){if(o)setTimeout(s,0,e);else{var t=i[e];if(t){o=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{f(e),o=!1}}}}}("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,n(4),n(13))},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c,f=[],s=!1,_=-1;function l(){s&&c&&(s=!1,c.length?f=c.concat(f):_=-1,f.length&&p())}function p(){if(!s){var e=u(l);s=!0;for(var t=f.length;t;){for(c=f,f=[];++_<t;)c&&c[_].run();_=-1,t=f.length}c=null,s=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new d(e,t)),1!==f.length||s||u(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRuntimeObject=void 0,t.getRuntimeObject=function(e){var t=e.cwrap("zappar_log_level","number",[]),n=e.cwrap("zappar_log_level_set",null,["number"]),r=e.cwrap("zappar_analytics_project_id_set",null,["string"]),a=e.cwrap("zappar_pipeline_create","number",[]),i=e.cwrap("zappar_pipeline_destroy",null,["number"]),o=e.cwrap("zappar_pipeline_frame_update",null,["number"]),u=e.cwrap("zappar_pipeline_frame_number","number",["number"]),c=e.cwrap("zappar_pipeline_camera_model","number",["number"]),f=e.cwrap("zappar_pipeline_camera_frame_user_data","number",["number"]),s=e.cwrap("zappar_pipeline_camera_frame_submit",null,["number","number","number","number","number","number","number"]),_=e.cwrap("zappar_pipeline_camera_frame_camera_attitude","number",["number"]),l=e.cwrap("zappar_pipeline_motion_accelerometer_submit",null,["number","number","number","number","number"]),p=e.cwrap("zappar_pipeline_motion_rotation_rate_submit",null,["number","number","number","number","number"]),d=e.cwrap("zappar_pipeline_motion_attitude_submit",null,["number","number","number","number","number"]),m=e.cwrap("zappar_camera_source_create","number",["number","string"]),h=e.cwrap("zappar_camera_source_destroy",null,["number"]),y=e.cwrap("zappar_image_tracker_create","number",["number"]),b=e.cwrap("zappar_image_tracker_destroy",null,["number"]),v=e.cwrap("zappar_image_tracker_target_load_from_memory",null,["number","number","number"]),g=e.cwrap("zappar_image_tracker_target_loaded_version","number",["number"]),w=e.cwrap("zappar_image_tracker_target_count","number",["number"]),M=e.cwrap("zappar_image_tracker_enabled","number",["number"]),k=e.cwrap("zappar_image_tracker_enabled_set",null,["number","number"]),x=e.cwrap("zappar_image_tracker_anchor_count","number",["number"]),z=e.cwrap("zappar_image_tracker_anchor_id","string",["number","number"]),A=e.cwrap("zappar_image_tracker_anchor_pose_raw","number",["number","number"]),L=e.cwrap("zappar_face_tracker_create","number",["number"]),E=e.cwrap("zappar_face_tracker_destroy",null,["number"]),T=e.cwrap("zappar_face_tracker_model_load_from_memory",null,["number","number","number"]),O=e.cwrap("zappar_face_tracker_model_loaded_version","number",["number"]),S=e.cwrap("zappar_face_tracker_enabled_set",null,["number","number"]),C=e.cwrap("zappar_face_tracker_enabled","number",["number"]),I=e.cwrap("zappar_face_tracker_max_faces_set",null,["number","number"]),P=e.cwrap("zappar_face_tracker_max_faces","number",["number"]),B=e.cwrap("zappar_face_tracker_anchor_count","number",["number"]),F=e.cwrap("zappar_face_tracker_anchor_id","string",["number","number"]),j=e.cwrap("zappar_face_tracker_anchor_pose_raw","number",["number","number"]),D=e.cwrap("zappar_face_tracker_anchor_identity_coefficients","number",["number","number"]),R=e.cwrap("zappar_face_tracker_anchor_expression_coefficients","number",["number","number"]),V=e.cwrap("zappar_face_mesh_create","number",[]),q=e.cwrap("zappar_face_mesh_destroy",null,["number"]),G=e.cwrap("zappar_face_landmark_create","number",["number"]),N=e.cwrap("zappar_face_landmark_destroy",null,["number"]),U=e.cwrap("zappar_barcode_finder_create","number",["number"]),W=e.cwrap("zappar_barcode_finder_destroy",null,["number"]),H=e.cwrap("zappar_barcode_finder_enabled_set",null,["number","number"]),Z=e.cwrap("zappar_barcode_finder_enabled","number",["number"]),Y=e.cwrap("zappar_barcode_finder_found_number","number",["number"]),X=e.cwrap("zappar_barcode_finder_found_text","string",["number","number"]),K=e.cwrap("zappar_barcode_finder_found_format","number",["number","number"]),J=e.cwrap("zappar_barcode_finder_formats","number",["number"]),Q=e.cwrap("zappar_barcode_finder_formats_set",null,["number","number"]),$=e.cwrap("zappar_instant_world_tracker_create","number",["number"]),ee=e.cwrap("zappar_instant_world_tracker_destroy",null,["number"]),te=e.cwrap("zappar_instant_world_tracker_enabled_set",null,["number","number"]),ne=e.cwrap("zappar_instant_world_tracker_enabled","number",["number"]),re=e.cwrap("zappar_instant_world_tracker_anchor_pose_raw","number",["number"]),ae=e.cwrap("zappar_instant_world_tracker_anchor_pose_set_from_camera_offset",null,["number","number","number","number","number"]),ie=32,oe=e._malloc(ie),ue=64,ce=e._malloc(ue);return{log_level:function(){return t()},log_level_set:function(e){return n(e)},analytics_project_id_set:function(e){return r(e)},pipeline_create:function(){return a()},pipeline_destroy:function(){i()},pipeline_frame_update:function(e){return o(e)},pipeline_frame_number:function(e){return u(e)},pipeline_camera_model:function(t){var n=c(t),r=new Float32Array(6);return r.set(e.HEAPF32.subarray(n/4,6+n/4)),n=r},pipeline_camera_frame_user_data:function(e){return f(e)},pipeline_camera_frame_submit:function(t,n,r,a,i,o){ie<n.byteLength&&(e._free(oe),ie=n.byteLength,oe=e._malloc(ie));var u=oe,c=n.byteLength;e.HEAPU8.set(new Uint8Array(n),oe);var f=r,_=a,l=i;ue<o.byteLength&&(e._free(ue),ue=o.byteLength,ce=e._malloc(ue));var p=ce;return e.HEAPF32.set(o,ce/4),s(t,u,c,f,_,l,p)},pipeline_camera_frame_camera_attitude:function(t){var n=_(t),r=new Float32Array(16);return r.set(e.HEAPF32.subarray(n/4,16+n/4)),n=r},pipeline_motion_accelerometer_submit:function(e,t,n,r,a){return l(e,t,n,r,a)},pipeline_motion_rotation_rate_submit:function(e,t,n,r,a){return p(e,t,n,r,a)},pipeline_motion_attitude_submit:function(e,t,n,r,a){return d(e,t,n,r,a)},camera_source_create:function(e,t){return m(e,t)},camera_source_destroy:function(){h()},image_tracker_create:function(e){return y(e)},image_tracker_destroy:function(){b()},image_tracker_target_load_from_memory:function(t,n){ie<n.byteLength&&(e._free(oe),ie=n.byteLength,oe=e._malloc(ie));var r=oe,a=n.byteLength;return e.HEAPU8.set(new Uint8Array(n),oe),v(t,r,a)},image_tracker_target_loaded_version:function(e){return g(e)},image_tracker_target_count:function(e){return w(e)},image_tracker_enabled:function(e){var t=M(e);return t=1===t},image_tracker_enabled_set:function(e,t){return k(e,t?1:0)},image_tracker_anchor_count:function(e){return x(e)},image_tracker_anchor_id:function(e,t){return z(e,t)},image_tracker_anchor_pose_raw:function(t,n){var r=A(t,n),a=new Float32Array(16);return a.set(e.HEAPF32.subarray(r/4,16+r/4)),r=a},face_tracker_create:function(e){return L(e)},face_tracker_destroy:function(){E()},face_tracker_model_load_from_memory:function(t,n){ie<n.byteLength&&(e._free(oe),ie=n.byteLength,oe=e._malloc(ie));var r=oe,a=n.byteLength;return e.HEAPU8.set(new Uint8Array(n),oe),T(t,r,a)},face_tracker_model_loaded_version:function(e){return O(e)},face_tracker_enabled_set:function(e,t){return S(e,t?1:0)},face_tracker_enabled:function(e){var t=C(e);return t=1===t},face_tracker_max_faces_set:function(e,t){return I(e,t)},face_tracker_max_faces:function(e){return P(e)},face_tracker_anchor_count:function(e){return B(e)},face_tracker_anchor_id:function(e,t){return F(e,t)},face_tracker_anchor_pose_raw:function(t,n){var r=j(t,n),a=new Float32Array(16);return a.set(e.HEAPF32.subarray(r/4,16+r/4)),r=a},face_tracker_anchor_identity_coefficients:function(t,n){var r=D(t,n),a=new Float32Array(50);return a.set(e.HEAPF32.subarray(r/4,50+r/4)),r=a},face_tracker_anchor_expression_coefficients:function(t,n){var r=R(t,n),a=new Float32Array(29);return a.set(e.HEAPF32.subarray(r/4,29+r/4)),r=a},face_mesh_create:function(){return V()},face_mesh_destroy:function(){q()},face_landmark_create:function(e){return G(e)},face_landmark_destroy:function(){N()},barcode_finder_create:function(e){return U(e)},barcode_finder_destroy:function(){W()},barcode_finder_enabled_set:function(e,t){return H(e,t?1:0)},barcode_finder_enabled:function(e){var t=Z(e);return t=1===t},barcode_finder_found_number:function(e){return Y(e)},barcode_finder_found_text:function(e,t){return X(e,t)},barcode_finder_found_format:function(e,t){return K(e,t)},barcode_finder_formats:function(e){return J(e)},barcode_finder_formats_set:function(e,t){return Q(e,t)},instant_world_tracker_create:function(e){return $(e)},instant_world_tracker_destroy:function(){ee()},instant_world_tracker_enabled_set:function(e,t){return te(e,t?1:0)},instant_world_tracker_enabled:function(e){var t=ne(e);return t=1===t},instant_world_tracker_anchor_pose_raw:function(t){var n=re(t),r=new Float32Array(16);return r.set(e.HEAPF32.subarray(n/4,16+n/4)),n=r},instant_world_tracker_anchor_pose_set_from_camera_offset:function(e,t,n,r,a){return ae(e,t,n,r,a)}}}},function(e,t,n){"use strict";var r=n(16).default,a=n(2).default,i=n(0).default,o=n(1).default;Object.defineProperty(t,"__esModule",{value:!0}),t.zappar_server=void 0;var u=n(20),c=n(21),f=function(){function e(t,n){i(this,e),this._impl=t,this._sender=n,this._deserializer=new c.MessageDeserializer,this.serializersByPipelineId=new Map,this._pipeline_id_by_pipeline_id=new Map,this._pipeline_by_instance=new Map,this._pipeline_id_by_camera_source_id=new Map,this._camera_source_by_instance=new Map,this._pipeline_id_by_image_tracker_id=new Map,this._image_tracker_by_instance=new Map,this._pipeline_id_by_face_tracker_id=new Map,this._face_tracker_by_instance=new Map,this._pipeline_id_by_face_mesh_id=new Map,this._face_mesh_by_instance=new Map,this._pipeline_id_by_face_landmark_id=new Map,this._face_landmark_by_instance=new Map,this._pipeline_id_by_barcode_finder_id=new Map,this._barcode_finder_by_instance=new Map,this._pipeline_id_by_instant_world_tracker_id=new Map,this._instant_world_tracker_by_instance=new Map}return o(e,[{key:"processBuffer",value:function(e){var t=this;this._deserializer.setData(e),this._deserializer.forMessages((function(e,n){switch(e){case 33:t._impl.log_level_set(n.logLevel());break;case 30:t._impl.analytics_project_id_set(n.string());break;case 26:var r=n.type(),a=t._impl.pipeline_create();t._pipeline_by_instance.set(r,a),t._pipeline_id_by_pipeline_id.set(r,r),t.serializersByPipelineId.set(r,new u.MessageSerializer((function(e){t._sender(r,e)})));break;case 27:var i=n.type(),o=t._pipeline_by_instance.get(i);if(void 0===o)return;t._impl.pipeline_destroy(o),t._pipeline_by_instance.delete(i);break;case 9:var c=n.type(),f=t._pipeline_by_instance.get(c);if(void 0===f)return;t._impl.pipeline_frame_update(f);break;case 8:var s=n.type(),_=t._pipeline_by_instance.get(s);if(void 0===_)return;t._impl.pipeline_camera_frame_submit(_,n.dataWithLength(),n.int(),n.int(),n.int(),n.matrix4x4());break;case 10:var l=n.type(),p=t._pipeline_by_instance.get(l);if(void 0===p)return;t._impl.pipeline_motion_accelerometer_submit(p,n.timestamp(),n.float(),n.float(),n.float());break;case 11:var d=n.type(),m=t._pipeline_by_instance.get(d);if(void 0===m)return;t._impl.pipeline_motion_rotation_rate_submit(m,n.timestamp(),n.float(),n.float(),n.float());break;case 12:var h=n.type(),y=t._pipeline_by_instance.get(h);if(void 0===y)return;t._impl.pipeline_motion_attitude_submit(y,n.timestamp(),n.float(),n.float(),n.float());break;case 28:var b=n.type(),v=n.type(),g=t._pipeline_by_instance.get(v),w=n.string(),M=t._impl.camera_source_create(g,w);t._camera_source_by_instance.set(b,M),t._pipeline_id_by_camera_source_id.set(b,v);break;case 29:var k=n.type(),x=t._camera_source_by_instance.get(k);if(void 0===x)return;t._impl.camera_source_destroy(x),t._camera_source_by_instance.delete(k);break;case 2:var z=n.type(),A=n.type(),L=t._pipeline_by_instance.get(A),E=t._impl.image_tracker_create(L);t._image_tracker_by_instance.set(z,E),t._pipeline_id_by_image_tracker_id.set(z,A);break;case 13:var T=n.type(),O=t._image_tracker_by_instance.get(T);if(void 0===O)return;t._impl.image_tracker_destroy(O),t._image_tracker_by_instance.delete(T);break;case 4:var S=n.type(),C=t._image_tracker_by_instance.get(S);if(void 0===C)return;t._impl.image_tracker_target_load_from_memory(C,n.dataWithLength());break;case 3:var I=n.type(),P=t._image_tracker_by_instance.get(I);if(void 0===P)return;t._impl.image_tracker_enabled_set(P,n.bool());break;case 19:var B=n.type(),F=n.type(),j=t._pipeline_by_instance.get(F),D=t._impl.face_tracker_create(j);t._face_tracker_by_instance.set(B,D),t._pipeline_id_by_face_tracker_id.set(B,F);break;case 20:var R=n.type(),V=t._face_tracker_by_instance.get(R);if(void 0===V)return;t._impl.face_tracker_destroy(V),t._face_tracker_by_instance.delete(R);break;case 21:var q=n.type(),G=t._face_tracker_by_instance.get(q);if(void 0===G)return;t._impl.face_tracker_model_load_from_memory(G,n.dataWithLength());break;case 22:var N=n.type(),U=t._face_tracker_by_instance.get(N);if(void 0===U)return;t._impl.face_tracker_enabled_set(U,n.bool());break;case 23:var W=n.type(),H=t._face_tracker_by_instance.get(W);if(void 0===H)return;t._impl.face_tracker_max_faces_set(H,n.int());break;case 24:var Z=n.type(),Y=t._impl.face_mesh_create();t._face_mesh_by_instance.set(Z,Y);break;case 25:var X=n.type(),K=t._face_mesh_by_instance.get(X);if(void 0===K)return;t._impl.face_mesh_destroy(K),t._face_mesh_by_instance.delete(X);break;case 31:var J=n.type(),Q=n.faceLandmarkName(),$=t._impl.face_landmark_create(Q);t._face_landmark_by_instance.set(J,$);break;case 32:var ee=n.type(),te=t._face_landmark_by_instance.get(ee);if(void 0===te)return;t._impl.face_landmark_destroy(te),t._face_landmark_by_instance.delete(ee);break;case 15:var ne=n.type(),re=n.type(),ae=t._pipeline_by_instance.get(re),ie=t._impl.barcode_finder_create(ae);t._barcode_finder_by_instance.set(ne,ie),t._pipeline_id_by_barcode_finder_id.set(ne,re);break;case 16:var oe=n.type(),ue=t._barcode_finder_by_instance.get(oe);if(void 0===ue)return;t._impl.barcode_finder_destroy(ue),t._barcode_finder_by_instance.delete(oe);break;case 17:var ce=n.type(),fe=t._barcode_finder_by_instance.get(ce);if(void 0===fe)return;t._impl.barcode_finder_enabled_set(fe,n.bool());break;case 18:var se=n.type(),_e=t._barcode_finder_by_instance.get(se);if(void 0===_e)return;t._impl.barcode_finder_formats_set(_e,n.barcodeFormat());break;case 5:var le=n.type(),pe=n.type(),de=t._pipeline_by_instance.get(pe),me=t._impl.instant_world_tracker_create(de);t._instant_world_tracker_by_instance.set(le,me),t._pipeline_id_by_instant_world_tracker_id.set(le,pe);break;case 14:var he=n.type(),ye=t._instant_world_tracker_by_instance.get(he);if(void 0===ye)return;t._impl.instant_world_tracker_destroy(ye),t._instant_world_tracker_by_instance.delete(he);break;case 6:var be=n.type(),ve=t._instant_world_tracker_by_instance.get(be);if(void 0===ve)return;t._impl.instant_world_tracker_enabled_set(ve,n.bool());break;case 7:var ge=n.type(),we=t._instant_world_tracker_by_instance.get(ge);if(void 0===we)return;t._impl.instant_world_tracker_anchor_pose_set_from_camera_offset(we,n.float(),n.float(),n.float(),n.instantTrackerTransformOrientation())}}))}},{key:"exploreState",value:function(){var e,t=this,n=a(this._pipeline_by_instance);try{var i=function(){var n=r(e.value,2),a=n[0],i=n[1],o=t._pipeline_id_by_pipeline_id.get(a);if(!o)return"continue";var u=t.serializersByPipelineId.get(o);if(!u)return"continue";u.sendMessage(7,(function(e){e.type(a),e.int(t._impl.pipeline_frame_number(i))})),u.sendMessage(6,(function(e){e.type(a),e.cameraModel(t._impl.pipeline_camera_model(i))})),u.sendMessage(5,(function(e){e.type(a),e.int(t._impl.pipeline_camera_frame_user_data(i))})),u.sendMessage(11,(function(e){e.type(a),e.matrix4x4(t._impl.pipeline_camera_frame_camera_attitude(i))}))};for(n.s();!(e=n.n()).done;)i()}catch(I){n.e(I)}finally{n.f()}var o,u=a(this._camera_source_by_instance);try{for(u.s();!(o=u.n()).done;){var c=r(o.value,2),f=c[0],s=(c[1],this._pipeline_id_by_camera_source_id.get(f));if(s)this.serializersByPipelineId.get(s)}}catch(I){u.e(I)}finally{u.f()}var _,l=a(this._image_tracker_by_instance);try{var p=function(){var e=r(_.value,2),n=e[0],a=e[1],i=t._pipeline_id_by_image_tracker_id.get(n);if(!i)return"continue";var o=t.serializersByPipelineId.get(i);if(!o)return"continue";o.sendMessage(18,(function(e){e.type(n),e.int(t._impl.image_tracker_target_loaded_version(a))})),o.sendMessage(20,(function(e){e.type(n),e.int(t._impl.image_tracker_target_count(a))})),o.sendMessage(1,(function(e){e.type(n),e.int(t._impl.image_tracker_anchor_count(a))}));for(var u=function(e){o.sendMessage(2,(function(r){r.type(n),r.int(e),r.string(t._impl.image_tracker_anchor_id(a,e))}))},c=0;c<t._impl.image_tracker_anchor_count(a);c++)u(c);for(var f=function(e){o.sendMessage(3,(function(r){r.type(n),r.int(e),r.matrix4x4(t._impl.image_tracker_anchor_pose_raw(a,e))}))},s=0;s<t._impl.image_tracker_anchor_count(a);s++)f(s)};for(l.s();!(_=l.n()).done;)p()}catch(I){l.e(I)}finally{l.f()}var d,m=a(this._face_tracker_by_instance);try{var h=function(){var e=r(d.value,2),n=e[0],a=e[1],i=t._pipeline_id_by_face_tracker_id.get(n);if(!i)return"continue";var o=t.serializersByPipelineId.get(i);if(!o)return"continue";o.sendMessage(17,(function(e){e.type(n),e.int(t._impl.face_tracker_model_loaded_version(a))})),o.sendMessage(12,(function(e){e.type(n),e.int(t._impl.face_tracker_anchor_count(a))}));for(var u=function(e){o.sendMessage(13,(function(r){r.type(n),r.int(e),r.string(t._impl.face_tracker_anchor_id(a,e))}))},c=0;c<t._impl.face_tracker_anchor_count(a);c++)u(c);for(var f=function(e){o.sendMessage(14,(function(r){r.type(n),r.int(e),r.matrix4x4(t._impl.face_tracker_anchor_pose_raw(a,e))}))},s=0;s<t._impl.face_tracker_anchor_count(a);s++)f(s);for(var _=function(e){o.sendMessage(15,(function(r){r.type(n),r.int(e),r.identityCoefficients(t._impl.face_tracker_anchor_identity_coefficients(a,e))}))},l=0;l<t._impl.face_tracker_anchor_count(a);l++)_(l);for(var p=function(e){o.sendMessage(16,(function(r){r.type(n),r.int(e),r.expressionCoefficients(t._impl.face_tracker_anchor_expression_coefficients(a,e))}))},m=0;m<t._impl.face_tracker_anchor_count(a);m++)p(m)};for(m.s();!(d=m.n()).done;)h()}catch(I){m.e(I)}finally{m.f()}var y,b=a(this._face_mesh_by_instance);try{for(b.s();!(y=b.n()).done;){var v=r(y.value,2),g=v[0],w=(v[1],this._pipeline_id_by_face_mesh_id.get(g));if(w)this.serializersByPipelineId.get(w)}}catch(I){b.e(I)}finally{b.f()}var M,k=a(this._face_landmark_by_instance);try{for(k.s();!(M=k.n()).done;){var x=r(M.value,2),z=x[0],A=(x[1],this._pipeline_id_by_face_landmark_id.get(z));if(A)this.serializersByPipelineId.get(A)}}catch(I){k.e(I)}finally{k.f()}var L,E=a(this._barcode_finder_by_instance);try{var T=function(){var e=r(L.value,2),n=e[0],a=e[1],i=t._pipeline_id_by_barcode_finder_id.get(n);if(!i)return"continue";var o=t.serializersByPipelineId.get(i);if(!o)return"continue";o.sendMessage(8,(function(e){e.type(n),e.int(t._impl.barcode_finder_found_number(a))}));for(var u=function(e){o.sendMessage(9,(function(r){r.type(n),r.int(e),r.string(t._impl.barcode_finder_found_text(a,e))}))},c=0;c<t._impl.barcode_finder_found_number(a);c++)u(c);for(var f=function(e){o.sendMessage(10,(function(r){r.type(n),r.int(e),r.barcodeFormat(t._impl.barcode_finder_found_format(a,e))}))},s=0;s<t._impl.barcode_finder_found_number(a);s++)f(s)};for(E.s();!(L=E.n()).done;)T()}catch(I){E.e(I)}finally{E.f()}var O,S=a(this._instant_world_tracker_by_instance);try{var C=function(){var e=r(O.value,2),n=e[0],a=e[1],i=t._pipeline_id_by_instant_world_tracker_id.get(n);if(!i)return"continue";var o=t.serializersByPipelineId.get(i);if(!o)return"continue";o.sendMessage(4,(function(e){e.type(n),e.matrix4x4(t._impl.instant_world_tracker_anchor_pose_raw(a))}))};for(S.s();!(O=S.n()).done;)C()}catch(I){S.e(I)}finally{S.f()}}}]),e}();t.zappar_server=f},function(e,t,n){var r=n(17),a=n(18),i=n(3),o=n(19);e.exports=function(e,t){return r(e)||a(e,t)||i(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(c){u=!0,a=c}finally{try{o||null==n.return||n.return()}finally{if(u)throw a}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(0).default,a=n(1).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSerializer=void 0;var i=function(){function e(t){var n=this;r(this,e),this._messageSender=t,this._freeBufferPool=[],this._buffer=new ArrayBuffer(16),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=1,this._startOffset=-1,this._timeoutSet=!1,this._appender={int:function(e){return n.int(e)},bool:function(e){return n.int(e?1:0)},float:function(e){return n.float(e)},string:function(e){return n.string(e)},dataWithLength:function(e){return n.arrayBuffer(e)},type:function(e){return n.int(e)},matrix4x4:function(e){return n.float32ArrayBuffer(e)},identityCoefficients:function(e){return n.float32ArrayBuffer(e)},expressionCoefficients:function(e){return n.float32ArrayBuffer(e)},cameraModel:function(e){return n.float32ArrayBuffer(e)},timestamp:function(e){return n.double(e)},barcodeFormat:function(e){return n.int(e)},faceLandmarkName:function(e){return n.int(e)},instantTrackerTransformOrientation:function(e){return n.int(e)},logLevel:function(e){return n.int(e)}},this._freeBufferPool.push(new ArrayBuffer(16)),this._freeBufferPool.push(new ArrayBuffer(16))}return a(e,[{key:"bufferReturn",value:function(e){this._freeBufferPool.push(e)}},{key:"_ensureArrayBuffer",value:function(e){var t=4*(this._offset+e+8);if(!(this._buffer&&this._buffer.byteLength>=t)){var n=void 0;if(!n){var r=t;r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,n=new ArrayBuffer(r)}var a=this._buffer?this._i32View:void 0;this._buffer=n,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),a&&this._i32View.set(a.subarray(0,this._offset))}}},{key:"sendMessage",value:function(e,t){this._ensureArrayBuffer(4),this._startOffset=this._offset,this._i32View[this._offset+1]=e,this._offset+=2,t(this._appender),this._i32View[this._startOffset]=this._offset-this._startOffset,this._startOffset=-1,this._sendOneTime()}},{key:"_sendOneTime",value:function(){var e=this;!1===this._timeoutSet&&(this._timeoutSet=!0,setTimeout((function(){e._timeoutSet=!1,e._send()}),0))}},{key:"_send",value:function(){0!==this._freeBufferPool.length?(this._i32View[0]=this._offset,this._messageSender(this._buffer),this._buffer=void 0,this._buffer=this._freeBufferPool.pop(),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u8cView=new Uint8ClampedArray(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=1,this._startOffset=-1):this._sendOneTime()}},{key:"int",value:function(e){this._ensureArrayBuffer(1),this._i32View[this._offset]=e,this._offset++}},{key:"double",value:function(e){this._ensureArrayBuffer(2),this._offset%2===1&&this._offset++,this._f64View[this._offset/2]=e,this._offset+=2}},{key:"float",value:function(e){this._ensureArrayBuffer(1),this._f32View[this._offset]=e,this._offset++}},{key:"int32Array",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._i32View[this._offset+t]=e[t];this._offset+=e.length}},{key:"float32Array",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._f32View[this._offset+t]=e[t];this._offset+=e.length}},{key:"booleanArray",value:function(e){this._ensureArrayBuffer(e.length);for(var t=0;t<e.length;++t)this._i32View[this._offset+t]=e[t]?1:0;this._offset+=e.length}},{key:"uint8ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.byteLength,this._offset++,this._u8View.set(e,4*this._offset),this._offset+=e.byteLength>>2,0!==(3&e.byteLength)&&this._offset++}},{key:"arrayBuffer",value:function(e){var t=new Uint8Array(e);this.uint8ArrayBuffer(t)}},{key:"uint8ClampedArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.byteLength,this._offset++,this._u8cView.set(e,4*this._offset),this._offset+=e.byteLength>>2,0!==(3&e.byteLength)&&this._offset++}},{key:"float32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._f32View.set(e,this._offset),this._offset+=e.length}},{key:"uint16ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++;var t=2*this._offset;this._u16View.set(e,t),this._offset+=e.length>>1,0!==(1&e.length)&&this._offset++}},{key:"int32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._i32View.set(e,this._offset),this._offset+=e.length}},{key:"uint32ArrayBuffer",value:function(e){this._ensureArrayBuffer(e.byteLength/4),this._i32View[this._offset]=e.length,this._offset++,this._u32View.set(e,this._offset),this._offset+=e.length}},{key:"string",value:function(e){var t=(new TextEncoder).encode(e);this._ensureArrayBuffer(t.byteLength/4),this._i32View[this._offset]=t.byteLength,this._offset++,this._u8View.set(t,4*this._offset),this._offset+=t.byteLength>>2,0!==(3&t.byteLength)&&this._offset++}}]),e}();t.MessageSerializer=i},function(e,t,n){"use strict";var r=n(0).default,a=n(1).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDeserializer=void 0;var i=function(){function e(){var t=this;r(this,e),this._buffer=new ArrayBuffer(0),this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=0,this._length=0,this._startOffset=-1,this._processor={int:function(){return t._i32View[t._startOffset++]},bool:function(){return 1===t._i32View[t._startOffset++]},type:function(){return t._i32View[t._startOffset++]},float:function(){return t._f32View[t._startOffset++]},timestamp:function(){t._startOffset%2===1&&t._startOffset++;var e=t._f64View[t._startOffset/2];return t._startOffset+=2,e},string:function(){var e=t._i32View[t._startOffset++],n=(new TextDecoder).decode(new Uint8Array(t._buffer,4*t._startOffset,e));return t._startOffset+=e>>2,0!==(3&e)&&t._startOffset++,n},dataWithLength:function(){var e=t._i32View[t._startOffset++],n=new Uint8Array(e);return n.set(t._u8View.subarray(4*t._startOffset,4*t._startOffset+e)),t._startOffset+=n.byteLength>>2,0!==(3&n.byteLength)&&t._startOffset++,n.buffer},matrix4x4:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+16)),t._startOffset+=e,n},identityCoefficients:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+50)),t._startOffset+=e,n},expressionCoefficients:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+29)),t._startOffset+=e,n},cameraModel:function(){var e=t._i32View[t._startOffset++],n=new Float32Array(e);return n.set(t._f32View.subarray(t._startOffset,t._startOffset+6)),t._startOffset+=e,n},barcodeFormat:function(){return t._i32View[t._startOffset++]},faceLandmarkName:function(){return t._i32View[t._startOffset++]},instantTrackerTransformOrientation:function(){return t._i32View[t._startOffset++]},logLevel:function(){return t._i32View[t._startOffset++]}}}return a(e,[{key:"setData",value:function(e){this._buffer=e,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer),this._f64View=new Float64Array(this._buffer),this._u8View=new Uint8Array(this._buffer),this._u16View=new Uint16Array(this._buffer),this._u32View=new Uint32Array(this._buffer),this._offset=0,this._length=0,e.byteLength>=4&&(this._offset=1,this._length=this._i32View[0]),this._startOffset=-1}},{key:"hasMessage",value:function(){return this._offset+1<this._length}},{key:"forMessages",value:function(e){for(;this.hasMessage();){var t=this._i32View[this._offset],n=this._i32View[this._offset+1];this._startOffset=this._offset+2,this._offset+=t,e(n,this._processor)}}}]),e}();t.MessageDeserializer=i},function(e,t,n){"use strict";var r=n(0).default,a=n(1).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MsgManager=void 0;var i=n(23),o=function(){function e(){r(this,e),this.onOutgoingMessage=new i.Event,this.onIncomingMessage=new i.Event1,this._outgoingMessages=[]}return a(e,[{key:"postIncomingMessage",value:function(e){this.onIncomingMessage.emit(e)}},{key:"postOutgoingMessage",value:function(e,t){this._outgoingMessages.push({msg:e,transferables:t}),this.onOutgoingMessage.emit()}},{key:"getOutgoingMessages",value:function(){var e=this._outgoingMessages;return this._outgoingMessages=[],e}}]),e}();t.MsgManager=o},function(e,t,n){"use strict";var r=n(0).default,a=n(1).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Event5=t.Event3=t.Event2=t.Event1=t.Event=void 0;var i=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(){for(var e=0,t=this._funcs.length;e<t;e++)this._funcs[e]()}}]),e}();t.Event=i;var o=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e){for(var t=0,n=this._funcs.length;t<n;t++)this._funcs[t](e)}}]),e}();t.Event1=o;var u=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t){for(var n=0,r=this._funcs.length;n<r;n++)this._funcs[n](e,t)}}]),e}();t.Event2=u;var c=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t,n){for(var r=0,a=this._funcs.length;r<a;r++)this._funcs[r](e,t,n)}}]),e}();t.Event3=c;var f=function(){function e(){r(this,e),this._funcs=[]}return a(e,[{key:"bind",value:function(e){this._funcs.push(e)}},{key:"unbind",value:function(e){var t=this._funcs.indexOf(e);t>-1&&this._funcs.splice(t,1)}},{key:"emit",value:function(e,t,n,r,a){for(var i=0,o=this._funcs.length;i<o;i++)this._funcs[i](e,t,n,r,a)}}]),e}();t.Event5=f},function(e,t,n){"use strict";n.r(t),t.default="./zcv.wasm"},function(e,t,n){"use strict";n.r(t),n.d(t,"glMatrix",(function(){return r})),n.d(t,"mat2",(function(){return a})),n.d(t,"mat2d",(function(){return i})),n.d(t,"mat3",(function(){return o})),n.d(t,"mat4",(function(){return u})),n.d(t,"quat",(function(){return s})),n.d(t,"quat2",(function(){return _})),n.d(t,"vec2",(function(){return l})),n.d(t,"vec3",(function(){return c})),n.d(t,"vec4",(function(){return f}));var r={};n.r(r),n.d(r,"EPSILON",(function(){return p})),n.d(r,"ARRAY_TYPE",(function(){return d})),n.d(r,"RANDOM",(function(){return m})),n.d(r,"setMatrixArrayType",(function(){return h})),n.d(r,"toRadian",(function(){return b})),n.d(r,"equals",(function(){return v}));var a={};n.r(a),n.d(a,"create",(function(){return g})),n.d(a,"clone",(function(){return w})),n.d(a,"copy",(function(){return M})),n.d(a,"identity",(function(){return k})),n.d(a,"fromValues",(function(){return x})),n.d(a,"set",(function(){return z})),n.d(a,"transpose",(function(){return A})),n.d(a,"invert",(function(){return L})),n.d(a,"adjoint",(function(){return E})),n.d(a,"determinant",(function(){return T})),n.d(a,"multiply",(function(){return O})),n.d(a,"rotate",(function(){return S})),n.d(a,"scale",(function(){return C})),n.d(a,"fromRotation",(function(){return I})),n.d(a,"fromScaling",(function(){return P})),n.d(a,"str",(function(){return B})),n.d(a,"frob",(function(){return F})),n.d(a,"LDU",(function(){return j})),n.d(a,"add",(function(){return D})),n.d(a,"subtract",(function(){return R})),n.d(a,"exactEquals",(function(){return V})),n.d(a,"equals",(function(){return q})),n.d(a,"multiplyScalar",(function(){return G})),n.d(a,"multiplyScalarAndAdd",(function(){return N})),n.d(a,"mul",(function(){return U})),n.d(a,"sub",(function(){return W}));var i={};n.r(i),n.d(i,"create",(function(){return H})),n.d(i,"clone",(function(){return Z})),n.d(i,"copy",(function(){return Y})),n.d(i,"identity",(function(){return X})),n.d(i,"fromValues",(function(){return K})),n.d(i,"set",(function(){return J})),n.d(i,"invert",(function(){return Q})),n.d(i,"determinant",(function(){return $})),n.d(i,"multiply",(function(){return ee})),n.d(i,"rotate",(function(){return te})),n.d(i,"scale",(function(){return ne})),n.d(i,"translate",(function(){return re})),n.d(i,"fromRotation",(function(){return ae})),n.d(i,"fromScaling",(function(){return ie})),n.d(i,"fromTranslation",(function(){return oe})),n.d(i,"str",(function(){return ue})),n.d(i,"frob",(function(){return ce})),n.d(i,"add",(function(){return fe})),n.d(i,"subtract",(function(){return se})),n.d(i,"multiplyScalar",(function(){return _e})),n.d(i,"multiplyScalarAndAdd",(function(){return le})),n.d(i,"exactEquals",(function(){return pe})),n.d(i,"equals",(function(){return de})),n.d(i,"mul",(function(){return me})),n.d(i,"sub",(function(){return he}));var o={};n.r(o),n.d(o,"create",(function(){return ye})),n.d(o,"fromMat4",(function(){return be})),n.d(o,"clone",(function(){return ve})),n.d(o,"copy",(function(){return ge})),n.d(o,"fromValues",(function(){return we})),n.d(o,"set",(function(){return Me})),n.d(o,"identity",(function(){return ke})),n.d(o,"transpose",(function(){return xe})),n.d(o,"invert",(function(){return ze})),n.d(o,"adjoint",(function(){return Ae})),n.d(o,"determinant",(function(){return Le})),n.d(o,"multiply",(function(){return Ee})),n.d(o,"translate",(function(){return Te})),n.d(o,"rotate",(function(){return Oe})),n.d(o,"scale",(function(){return Se})),n.d(o,"fromTranslation",(function(){return Ce})),n.d(o,"fromRotation",(function(){return Ie})),n.d(o,"fromScaling",(function(){return Pe})),n.d(o,"fromMat2d",(function(){return Be})),n.d(o,"fromQuat",(function(){return Fe})),n.d(o,"normalFromMat4",(function(){return je})),n.d(o,"projection",(function(){return De})),n.d(o,"str",(function(){return Re})),n.d(o,"frob",(function(){return Ve})),n.d(o,"add",(function(){return qe})),n.d(o,"subtract",(function(){return Ge})),n.d(o,"multiplyScalar",(function(){return Ne})),n.d(o,"multiplyScalarAndAdd",(function(){return Ue})),n.d(o,"exactEquals",(function(){return We})),n.d(o,"equals",(function(){return He})),n.d(o,"mul",(function(){return Ze})),n.d(o,"sub",(function(){return Ye}));var u={};n.r(u),n.d(u,"create",(function(){return Xe})),n.d(u,"clone",(function(){return Ke})),n.d(u,"copy",(function(){return Je})),n.d(u,"fromValues",(function(){return Qe})),n.d(u,"set",(function(){return $e})),n.d(u,"identity",(function(){return et})),n.d(u,"transpose",(function(){return tt})),n.d(u,"invert",(function(){return nt})),n.d(u,"adjoint",(function(){return rt})),n.d(u,"determinant",(function(){return at})),n.d(u,"multiply",(function(){return it})),n.d(u,"translate",(function(){return ot})),n.d(u,"scale",(function(){return ut})),n.d(u,"rotate",(function(){return ct})),n.d(u,"rotateX",(function(){return ft})),n.d(u,"rotateY",(function(){return st})),n.d(u,"rotateZ",(function(){return _t})),n.d(u,"fromTranslation",(function(){return lt})),n.d(u,"fromScaling",(function(){return pt})),n.d(u,"fromRotation",(function(){return dt})),n.d(u,"fromXRotation",(function(){return mt})),n.d(u,"fromYRotation",(function(){return ht})),n.d(u,"fromZRotation",(function(){return yt})),n.d(u,"fromRotationTranslation",(function(){return bt})),n.d(u,"fromQuat2",(function(){return vt})),n.d(u,"getTranslation",(function(){return gt})),n.d(u,"getScaling",(function(){return wt})),n.d(u,"getRotation",(function(){return Mt})),n.d(u,"fromRotationTranslationScale",(function(){return kt})),n.d(u,"fromRotationTranslationScaleOrigin",(function(){return xt})),n.d(u,"fromQuat",(function(){return zt})),n.d(u,"frustum",(function(){return At})),n.d(u,"perspective",(function(){return Lt})),n.d(u,"perspectiveFromFieldOfView",(function(){return Et})),n.d(u,"ortho",(function(){return Tt})),n.d(u,"lookAt",(function(){return Ot})),n.d(u,"targetTo",(function(){return St})),n.d(u,"str",(function(){return Ct})),n.d(u,"frob",(function(){return It})),n.d(u,"add",(function(){return Pt})),n.d(u,"subtract",(function(){return Bt})),n.d(u,"multiplyScalar",(function(){return Ft})),n.d(u,"multiplyScalarAndAdd",(function(){return jt})),n.d(u,"exactEquals",(function(){return Dt})),n.d(u,"equals",(function(){return Rt})),n.d(u,"mul",(function(){return Vt})),n.d(u,"sub",(function(){return qt}));var c={};n.r(c),n.d(c,"create",(function(){return Gt})),n.d(c,"clone",(function(){return Nt})),n.d(c,"length",(function(){return Ut})),n.d(c,"fromValues",(function(){return Wt})),n.d(c,"copy",(function(){return Ht})),n.d(c,"set",(function(){return Zt})),n.d(c,"add",(function(){return Yt})),n.d(c,"subtract",(function(){return Xt})),n.d(c,"multiply",(function(){return Kt})),n.d(c,"divide",(function(){return Jt})),n.d(c,"ceil",(function(){return Qt})),n.d(c,"floor",(function(){return $t})),n.d(c,"min",(function(){return en})),n.d(c,"max",(function(){return tn})),n.d(c,"round",(function(){return nn})),n.d(c,"scale",(function(){return rn})),n.d(c,"scaleAndAdd",(function(){return an})),n.d(c,"distance",(function(){return on})),n.d(c,"squaredDistance",(function(){return un})),n.d(c,"squaredLength",(function(){return cn})),n.d(c,"negate",(function(){return fn})),n.d(c,"inverse",(function(){return sn})),n.d(c,"normalize",(function(){return _n})),n.d(c,"dot",(function(){return ln})),n.d(c,"cross",(function(){return pn})),n.d(c,"lerp",(function(){return dn})),n.d(c,"hermite",(function(){return mn})),n.d(c,"bezier",(function(){return hn})),n.d(c,"random",(function(){return yn})),n.d(c,"transformMat4",(function(){return bn})),n.d(c,"transformMat3",(function(){return vn})),n.d(c,"transformQuat",(function(){return gn})),n.d(c,"rotateX",(function(){return wn})),n.d(c,"rotateY",(function(){return Mn})),n.d(c,"rotateZ",(function(){return kn})),n.d(c,"angle",(function(){return xn})),n.d(c,"zero",(function(){return zn})),n.d(c,"str",(function(){return An})),n.d(c,"exactEquals",(function(){return Ln})),n.d(c,"equals",(function(){return En})),n.d(c,"sub",(function(){return Tn})),n.d(c,"mul",(function(){return On})),n.d(c,"div",(function(){return Sn})),n.d(c,"dist",(function(){return Cn})),n.d(c,"sqrDist",(function(){return In})),n.d(c,"len",(function(){return Pn})),n.d(c,"sqrLen",(function(){return Bn})),n.d(c,"forEach",(function(){return Fn}));var f={};n.r(f),n.d(f,"create",(function(){return jn})),n.d(f,"clone",(function(){return Dn})),n.d(f,"fromValues",(function(){return Rn})),n.d(f,"copy",(function(){return Vn})),n.d(f,"set",(function(){return qn})),n.d(f,"add",(function(){return Gn})),n.d(f,"subtract",(function(){return Nn})),n.d(f,"multiply",(function(){return Un})),n.d(f,"divide",(function(){return Wn})),n.d(f,"ceil",(function(){return Hn})),n.d(f,"floor",(function(){return Zn})),n.d(f,"min",(function(){return Yn})),n.d(f,"max",(function(){return Xn})),n.d(f,"round",(function(){return Kn})),n.d(f,"scale",(function(){return Jn})),n.d(f,"scaleAndAdd",(function(){return Qn})),n.d(f,"distance",(function(){return $n})),n.d(f,"squaredDistance",(function(){return er})),n.d(f,"length",(function(){return tr})),n.d(f,"squaredLength",(function(){return nr})),n.d(f,"negate",(function(){return rr})),n.d(f,"inverse",(function(){return ar})),n.d(f,"normalize",(function(){return ir})),n.d(f,"dot",(function(){return or})),n.d(f,"cross",(function(){return ur})),n.d(f,"lerp",(function(){return cr})),n.d(f,"random",(function(){return fr})),n.d(f,"transformMat4",(function(){return sr})),n.d(f,"transformQuat",(function(){return _r})),n.d(f,"zero",(function(){return lr})),n.d(f,"str",(function(){return pr})),n.d(f,"exactEquals",(function(){return dr})),n.d(f,"equals",(function(){return mr})),n.d(f,"sub",(function(){return hr})),n.d(f,"mul",(function(){return yr})),n.d(f,"div",(function(){return br})),n.d(f,"dist",(function(){return vr})),n.d(f,"sqrDist",(function(){return gr})),n.d(f,"len",(function(){return wr})),n.d(f,"sqrLen",(function(){return Mr})),n.d(f,"forEach",(function(){return kr}));var s={};n.r(s),n.d(s,"create",(function(){return xr})),n.d(s,"identity",(function(){return zr})),n.d(s,"setAxisAngle",(function(){return Ar})),n.d(s,"getAxisAngle",(function(){return Lr})),n.d(s,"getAngle",(function(){return Er})),n.d(s,"multiply",(function(){return Tr})),n.d(s,"rotateX",(function(){return Or})),n.d(s,"rotateY",(function(){return Sr})),n.d(s,"rotateZ",(function(){return Cr})),n.d(s,"calculateW",(function(){return Ir})),n.d(s,"exp",(function(){return Pr})),n.d(s,"ln",(function(){return Br})),n.d(s,"pow",(function(){return Fr})),n.d(s,"slerp",(function(){return jr})),n.d(s,"random",(function(){return Dr})),n.d(s,"invert",(function(){return Rr})),n.d(s,"conjugate",(function(){return Vr})),n.d(s,"fromMat3",(function(){return qr})),n.d(s,"fromEuler",(function(){return Gr})),n.d(s,"str",(function(){return Nr})),n.d(s,"clone",(function(){return Ur})),n.d(s,"fromValues",(function(){return Wr})),n.d(s,"copy",(function(){return Hr})),n.d(s,"set",(function(){return Zr})),n.d(s,"add",(function(){return Yr})),n.d(s,"mul",(function(){return Xr})),n.d(s,"scale",(function(){return Kr})),n.d(s,"dot",(function(){return Jr})),n.d(s,"lerp",(function(){return Qr})),n.d(s,"length",(function(){return $r})),n.d(s,"len",(function(){return ea})),n.d(s,"squaredLength",(function(){return ta})),n.d(s,"sqrLen",(function(){return na})),n.d(s,"normalize",(function(){return ra})),n.d(s,"exactEquals",(function(){return aa})),n.d(s,"equals",(function(){return ia})),n.d(s,"rotationTo",(function(){return oa})),n.d(s,"sqlerp",(function(){return ua})),n.d(s,"setAxes",(function(){return ca}));var _={};n.r(_),n.d(_,"create",(function(){return fa})),n.d(_,"clone",(function(){return sa})),n.d(_,"fromValues",(function(){return _a})),n.d(_,"fromRotationTranslationValues",(function(){return la})),n.d(_,"fromRotationTranslation",(function(){return pa})),n.d(_,"fromTranslation",(function(){return da})),n.d(_,"fromRotation",(function(){return ma})),n.d(_,"fromMat4",(function(){return ha})),n.d(_,"copy",(function(){return ya})),n.d(_,"identity",(function(){return ba})),n.d(_,"set",(function(){return va})),n.d(_,"getReal",(function(){return ga})),n.d(_,"getDual",(function(){return wa})),n.d(_,"setReal",(function(){return Ma})),n.d(_,"setDual",(function(){return ka})),n.d(_,"getTranslation",(function(){return xa})),n.d(_,"translate",(function(){return za})),n.d(_,"rotateX",(function(){return Aa})),n.d(_,"rotateY",(function(){return La})),n.d(_,"rotateZ",(function(){return Ea})),n.d(_,"rotateByQuatAppend",(function(){return Ta})),n.d(_,"rotateByQuatPrepend",(function(){return Oa})),n.d(_,"rotateAroundAxis",(function(){return Sa})),n.d(_,"add",(function(){return Ca})),n.d(_,"multiply",(function(){return Ia})),n.d(_,"mul",(function(){return Pa})),n.d(_,"scale",(function(){return Ba})),n.d(_,"dot",(function(){return Fa})),n.d(_,"lerp",(function(){return ja})),n.d(_,"invert",(function(){return Da})),n.d(_,"conjugate",(function(){return Ra})),n.d(_,"length",(function(){return Va})),n.d(_,"len",(function(){return qa})),n.d(_,"squaredLength",(function(){return Ga})),n.d(_,"sqrLen",(function(){return Na})),n.d(_,"normalize",(function(){return Ua})),n.d(_,"str",(function(){return Wa})),n.d(_,"exactEquals",(function(){return Ha})),n.d(_,"equals",(function(){return Za}));var l={};n.r(l),n.d(l,"create",(function(){return Ya})),n.d(l,"clone",(function(){return Xa})),n.d(l,"fromValues",(function(){return Ka})),n.d(l,"copy",(function(){return Ja})),n.d(l,"set",(function(){return Qa})),n.d(l,"add",(function(){return $a})),n.d(l,"subtract",(function(){return ei})),n.d(l,"multiply",(function(){return ti})),n.d(l,"divide",(function(){return ni})),n.d(l,"ceil",(function(){return ri})),n.d(l,"floor",(function(){return ai})),n.d(l,"min",(function(){return ii})),n.d(l,"max",(function(){return oi})),n.d(l,"round",(function(){return ui})),n.d(l,"scale",(function(){return ci})),n.d(l,"scaleAndAdd",(function(){return fi})),n.d(l,"distance",(function(){return si})),n.d(l,"squaredDistance",(function(){return _i})),n.d(l,"length",(function(){return li})),n.d(l,"squaredLength",(function(){return pi})),n.d(l,"negate",(function(){return di})),n.d(l,"inverse",(function(){return mi})),n.d(l,"normalize",(function(){return hi})),n.d(l,"dot",(function(){return yi})),n.d(l,"cross",(function(){return bi})),n.d(l,"lerp",(function(){return vi})),n.d(l,"random",(function(){return gi})),n.d(l,"transformMat2",(function(){return wi})),n.d(l,"transformMat2d",(function(){return Mi})),n.d(l,"transformMat3",(function(){return ki})),n.d(l,"transformMat4",(function(){return xi})),n.d(l,"rotate",(function(){return zi})),n.d(l,"angle",(function(){return Ai})),n.d(l,"zero",(function(){return Li})),n.d(l,"str",(function(){return Ei})),n.d(l,"exactEquals",(function(){return Ti})),n.d(l,"equals",(function(){return Oi})),n.d(l,"len",(function(){return Si})),n.d(l,"sub",(function(){return Ci})),n.d(l,"mul",(function(){return Ii})),n.d(l,"div",(function(){return Pi})),n.d(l,"dist",(function(){return Bi})),n.d(l,"sqrDist",(function(){return Fi})),n.d(l,"sqrLen",(function(){return ji})),n.d(l,"forEach",(function(){return Di}));var p=1e-6,d="undefined"!==typeof Float32Array?Float32Array:Array,m=Math.random;function h(e){d=e}var y=Math.PI/180;function b(e){return e*y}function v(e,t){return Math.abs(e-t)<=p*Math.max(1,Math.abs(e),Math.abs(t))}function g(){var e=new d(4);return d!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function w(e){var t=new d(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function k(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function x(e,t,n,r){var a=new d(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function z(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function A(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function L(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*i-a*r;return o?(o=1/o,e[0]=i*o,e[1]=-r*o,e[2]=-a*o,e[3]=n*o,e):null}function E(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function T(e){return e[0]*e[3]-e[2]*e[1]}function O(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],c=n[1],f=n[2],s=n[3];return e[0]=r*u+i*c,e[1]=a*u+o*c,e[2]=r*f+i*s,e[3]=a*f+o*s,e}function S(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*u,e[1]=a*c+o*u,e[2]=r*-u+i*c,e[3]=a*-u+o*c,e}function C(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],c=n[1];return e[0]=r*u,e[1]=a*u,e[2]=i*c,e[3]=o*c,e}function I(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function P(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function B(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function F(e){return Math.hypot(e[0],e[1],e[2],e[3])}function j(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function D(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function R(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function V(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function q(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],u=t[1],c=t[2],f=t[3];return Math.abs(n-o)<=p*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=p*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=p*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-f)<=p*Math.max(1,Math.abs(i),Math.abs(f))}function G(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function N(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var U=O,W=R;function H(){var e=new d(6);return d!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Z(e){var t=new d(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function X(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function K(e,t,n,r,a,i){var o=new d(6);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=a,o[5]=i,o}function J(e,t,n,r,a,i,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e}function Q(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=n*i-r*a;return c?(c=1/c,e[0]=i*c,e[1]=-r*c,e[2]=-a*c,e[3]=n*c,e[4]=(a*u-i*o)*c,e[5]=(r*o-n*u)*c,e):null}function $(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=n[0],s=n[1],_=n[2],l=n[3],p=n[4],d=n[5];return e[0]=r*f+i*s,e[1]=a*f+o*s,e[2]=r*_+i*l,e[3]=a*_+o*l,e[4]=r*p+i*d+u,e[5]=a*p+o*d+c,e}function te(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*f,e[1]=a*s+o*f,e[2]=r*-f+i*s,e[3]=a*-f+o*s,e[4]=u,e[5]=c,e}function ne(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=n[0],s=n[1];return e[0]=r*f,e[1]=a*f,e[2]=i*s,e[3]=o*s,e[4]=u,e[5]=c,e}function re(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=n[0],s=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=r*f+i*s+u,e[5]=a*f+o*s+c,e}function ae(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function oe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function ue(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ce(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function fe(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function se(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function _e(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function le(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function pe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function de(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],c=t[0],f=t[1],s=t[2],_=t[3],l=t[4],d=t[5];return Math.abs(n-c)<=p*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=p*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-s)<=p*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(i-_)<=p*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-l)<=p*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(u-d)<=p*Math.max(1,Math.abs(u),Math.abs(d))}var me=ee,he=se;function ye(){var e=new d(9);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function ve(e){var t=new d(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ge(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function we(e,t,n,r,a,i,o,u,c){var f=new d(9);return f[0]=e,f[1]=t,f[2]=n,f[3]=r,f[4]=a,f[5]=i,f[6]=o,f[7]=u,f[8]=c,f}function Me(e,t,n,r,a,i,o,u,c,f){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=c,e[8]=f,e}function ke(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function xe(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function ze(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=t[6],f=t[7],s=t[8],_=s*o-u*f,l=-s*i+u*c,p=f*i-o*c,d=n*_+r*l+a*p;return d?(d=1/d,e[0]=_*d,e[1]=(-s*r+a*f)*d,e[2]=(u*r-a*o)*d,e[3]=l*d,e[4]=(s*n-a*c)*d,e[5]=(-u*n+a*i)*d,e[6]=p*d,e[7]=(-f*n+r*c)*d,e[8]=(o*n-r*i)*d,e):null}function Ae(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=t[6],f=t[7],s=t[8];return e[0]=o*s-u*f,e[1]=a*f-r*s,e[2]=r*u-a*o,e[3]=u*c-i*s,e[4]=n*s-a*c,e[5]=a*i-n*u,e[6]=i*f-o*c,e[7]=r*c-n*f,e[8]=n*o-r*i,e}function Le(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],c=e[7],f=e[8];return t*(f*i-o*c)+n*(-f*a+o*u)+r*(c*a-i*u)}function Ee(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=t[8],l=n[0],p=n[1],d=n[2],m=n[3],h=n[4],y=n[5],b=n[6],v=n[7],g=n[8];return e[0]=l*r+p*o+d*f,e[1]=l*a+p*u+d*s,e[2]=l*i+p*c+d*_,e[3]=m*r+h*o+y*f,e[4]=m*a+h*u+y*s,e[5]=m*i+h*c+y*_,e[6]=b*r+v*o+g*f,e[7]=b*a+v*u+g*s,e[8]=b*i+v*c+g*_,e}function Te(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=t[8],l=n[0],p=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=u,e[5]=c,e[6]=l*r+p*o+f,e[7]=l*a+p*u+s,e[8]=l*i+p*c+_,e}function Oe(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=t[8],l=Math.sin(n),p=Math.cos(n);return e[0]=p*r+l*o,e[1]=p*a+l*u,e[2]=p*i+l*c,e[3]=p*o-l*r,e[4]=p*u-l*a,e[5]=p*c-l*i,e[6]=f,e[7]=s,e[8]=_,e}function Se(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ce(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ie(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Pe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Fe(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,c=a+a,f=n*o,s=r*o,_=r*u,l=a*o,p=a*u,d=a*c,m=i*o,h=i*u,y=i*c;return e[0]=1-_-d,e[3]=s-y,e[6]=l+h,e[1]=s+y,e[4]=1-f-d,e[7]=p-m,e[2]=l-h,e[5]=p+m,e[8]=1-f-_,e}function je(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=t[6],f=t[7],s=t[8],_=t[9],l=t[10],p=t[11],d=t[12],m=t[13],h=t[14],y=t[15],b=n*u-r*o,v=n*c-a*o,g=n*f-i*o,w=r*c-a*u,M=r*f-i*u,k=a*f-i*c,x=s*m-_*d,z=s*h-l*d,A=s*y-p*d,L=_*h-l*m,E=_*y-p*m,T=l*y-p*h,O=b*T-v*E+g*L+w*A-M*z+k*x;return O?(O=1/O,e[0]=(u*T-c*E+f*L)*O,e[1]=(c*A-o*T-f*z)*O,e[2]=(o*E-u*A+f*x)*O,e[3]=(a*E-r*T-i*L)*O,e[4]=(n*T-a*A+i*z)*O,e[5]=(r*A-n*E-i*x)*O,e[6]=(m*k-h*M+y*w)*O,e[7]=(h*g-d*k-y*v)*O,e[8]=(d*M-m*g+y*b)*O,e):null}function De(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Re(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ve(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function qe(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function Ge(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Ne(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function Ue(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function We(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function He(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],c=e[6],f=e[7],s=e[8],_=t[0],l=t[1],d=t[2],m=t[3],h=t[4],y=t[5],b=t[6],v=t[7],g=t[8];return Math.abs(n-_)<=p*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(r-l)<=p*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-d)<=p*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(i-m)<=p*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-h)<=p*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-y)<=p*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-b)<=p*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(f-v)<=p*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(s-g)<=p*Math.max(1,Math.abs(s),Math.abs(g))}var Ze=Ee,Ye=Ge;function Xe(){var e=new d(16);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new d(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Je(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,n,r,a,i,o,u,c,f,s,_,l,p,m,h){var y=new d(16);return y[0]=e,y[1]=t,y[2]=n,y[3]=r,y[4]=a,y[5]=i,y[6]=o,y[7]=u,y[8]=c,y[9]=f,y[10]=s,y[11]=_,y[12]=l,y[13]=p,y[14]=m,y[15]=h,y}function $e(e,t,n,r,a,i,o,u,c,f,s,_,l,p,d,m,h){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=c,e[8]=f,e[9]=s,e[10]=_,e[11]=l,e[12]=p,e[13]=d,e[14]=m,e[15]=h,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function nt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=t[6],f=t[7],s=t[8],_=t[9],l=t[10],p=t[11],d=t[12],m=t[13],h=t[14],y=t[15],b=n*u-r*o,v=n*c-a*o,g=n*f-i*o,w=r*c-a*u,M=r*f-i*u,k=a*f-i*c,x=s*m-_*d,z=s*h-l*d,A=s*y-p*d,L=_*h-l*m,E=_*y-p*m,T=l*y-p*h,O=b*T-v*E+g*L+w*A-M*z+k*x;return O?(O=1/O,e[0]=(u*T-c*E+f*L)*O,e[1]=(a*E-r*T-i*L)*O,e[2]=(m*k-h*M+y*w)*O,e[3]=(l*M-_*k-p*w)*O,e[4]=(c*A-o*T-f*z)*O,e[5]=(n*T-a*A+i*z)*O,e[6]=(h*g-d*k-y*v)*O,e[7]=(s*k-l*g+p*v)*O,e[8]=(o*E-u*A+f*x)*O,e[9]=(r*A-n*E-i*x)*O,e[10]=(d*M-m*g+y*b)*O,e[11]=(_*g-s*M-p*b)*O,e[12]=(u*z-o*L-c*x)*O,e[13]=(n*L-r*z+a*x)*O,e[14]=(m*v-d*w-h*b)*O,e[15]=(s*w-_*v+l*b)*O,e):null}function rt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],c=t[6],f=t[7],s=t[8],_=t[9],l=t[10],p=t[11],d=t[12],m=t[13],h=t[14],y=t[15];return e[0]=u*(l*y-p*h)-_*(c*y-f*h)+m*(c*p-f*l),e[1]=-(r*(l*y-p*h)-_*(a*y-i*h)+m*(a*p-i*l)),e[2]=r*(c*y-f*h)-u*(a*y-i*h)+m*(a*f-i*c),e[3]=-(r*(c*p-f*l)-u*(a*p-i*l)+_*(a*f-i*c)),e[4]=-(o*(l*y-p*h)-s*(c*y-f*h)+d*(c*p-f*l)),e[5]=n*(l*y-p*h)-s*(a*y-i*h)+d*(a*p-i*l),e[6]=-(n*(c*y-f*h)-o*(a*y-i*h)+d*(a*f-i*c)),e[7]=n*(c*p-f*l)-o*(a*p-i*l)+s*(a*f-i*c),e[8]=o*(_*y-p*m)-s*(u*y-f*m)+d*(u*p-f*_),e[9]=-(n*(_*y-p*m)-s*(r*y-i*m)+d*(r*p-i*_)),e[10]=n*(u*y-f*m)-o*(r*y-i*m)+d*(r*f-i*u),e[11]=-(n*(u*p-f*_)-o*(r*p-i*_)+s*(r*f-i*u)),e[12]=-(o*(_*h-l*m)-s*(u*h-c*m)+d*(u*l-c*_)),e[13]=n*(_*h-l*m)-s*(r*h-a*m)+d*(r*l-a*_),e[14]=-(n*(u*h-c*m)-o*(r*h-a*m)+d*(r*c-a*u)),e[15]=n*(u*l-c*_)-o*(r*l-a*_)+s*(r*c-a*u),e}function at(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],c=e[7],f=e[8],s=e[9],_=e[10],l=e[11],p=e[12],d=e[13],m=e[14],h=e[15];return(t*o-n*i)*(_*h-l*m)-(t*u-r*i)*(s*h-l*d)+(t*c-a*i)*(s*m-_*d)+(n*u-r*o)*(f*h-l*p)-(n*c-a*o)*(f*m-_*p)+(r*c-a*u)*(f*d-s*p)}function it(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=t[8],l=t[9],p=t[10],d=t[11],m=t[12],h=t[13],y=t[14],b=t[15],v=n[0],g=n[1],w=n[2],M=n[3];return e[0]=v*r+g*u+w*_+M*m,e[1]=v*a+g*c+w*l+M*h,e[2]=v*i+g*f+w*p+M*y,e[3]=v*o+g*s+w*d+M*b,v=n[4],g=n[5],w=n[6],M=n[7],e[4]=v*r+g*u+w*_+M*m,e[5]=v*a+g*c+w*l+M*h,e[6]=v*i+g*f+w*p+M*y,e[7]=v*o+g*s+w*d+M*b,v=n[8],g=n[9],w=n[10],M=n[11],e[8]=v*r+g*u+w*_+M*m,e[9]=v*a+g*c+w*l+M*h,e[10]=v*i+g*f+w*p+M*y,e[11]=v*o+g*s+w*d+M*b,v=n[12],g=n[13],w=n[14],M=n[15],e[12]=v*r+g*u+w*_+M*m,e[13]=v*a+g*c+w*l+M*h,e[14]=v*i+g*f+w*p+M*y,e[15]=v*o+g*s+w*d+M*b,e}function ot(e,t,n){var r,a,i,o,u,c,f,s,_,l,p,d,m=n[0],h=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*h+t[8]*y+t[12],e[13]=t[1]*m+t[5]*h+t[9]*y+t[13],e[14]=t[2]*m+t[6]*h+t[10]*y+t[14],e[15]=t[3]*m+t[7]*h+t[11]*y+t[15]):(r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=t[8],l=t[9],p=t[10],d=t[11],e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=u,e[5]=c,e[6]=f,e[7]=s,e[8]=_,e[9]=l,e[10]=p,e[11]=d,e[12]=r*m+u*h+_*y+t[12],e[13]=a*m+c*h+l*y+t[13],e[14]=i*m+f*h+p*y+t[14],e[15]=o*m+s*h+d*y+t[15]),e}function ut(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ct(e,t,n,r){var a,i,o,u,c,f,s,_,l,d,m,h,y,b,v,g,w,M,k,x,z,A,L,E,T=r[0],O=r[1],S=r[2],C=Math.hypot(T,O,S);return C<p?null:(T*=C=1/C,O*=C,S*=C,a=Math.sin(n),o=1-(i=Math.cos(n)),u=t[0],c=t[1],f=t[2],s=t[3],_=t[4],l=t[5],d=t[6],m=t[7],h=t[8],y=t[9],b=t[10],v=t[11],g=T*T*o+i,w=O*T*o+S*a,M=S*T*o-O*a,k=T*O*o-S*a,x=O*O*o+i,z=S*O*o+T*a,A=T*S*o+O*a,L=O*S*o-T*a,E=S*S*o+i,e[0]=u*g+_*w+h*M,e[1]=c*g+l*w+y*M,e[2]=f*g+d*w+b*M,e[3]=s*g+m*w+v*M,e[4]=u*k+_*x+h*z,e[5]=c*k+l*x+y*z,e[6]=f*k+d*x+b*z,e[7]=s*k+m*x+v*z,e[8]=u*A+_*L+h*E,e[9]=c*A+l*L+y*E,e[10]=f*A+d*L+b*E,e[11]=s*A+m*L+v*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ft(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],o=t[5],u=t[6],c=t[7],f=t[8],s=t[9],_=t[10],l=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+f*r,e[5]=o*a+s*r,e[6]=u*a+_*r,e[7]=c*a+l*r,e[8]=f*a-i*r,e[9]=s*a-o*r,e[10]=_*a-u*r,e[11]=l*a-c*r,e}function st(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],c=t[3],f=t[8],s=t[9],_=t[10],l=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-f*r,e[1]=o*a-s*r,e[2]=u*a-_*r,e[3]=c*a-l*r,e[8]=i*r+f*a,e[9]=o*r+s*a,e[10]=u*r+_*a,e[11]=c*r+l*a,e}function _t(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],c=t[3],f=t[4],s=t[5],_=t[6],l=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+f*r,e[1]=o*a+s*r,e[2]=u*a+_*r,e[3]=c*a+l*r,e[4]=f*a-i*r,e[5]=s*a-o*r,e[6]=_*a-u*r,e[7]=l*a-c*r,e}function lt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function pt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dt(e,t,n){var r,a,i,o=n[0],u=n[1],c=n[2],f=Math.hypot(o,u,c);return f<p?null:(o*=f=1/f,u*=f,c*=f,r=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=u*o*i+c*r,e[2]=c*o*i-u*r,e[3]=0,e[4]=o*u*i-c*r,e[5]=u*u*i+a,e[6]=c*u*i+o*r,e[7]=0,e[8]=o*c*i+u*r,e[9]=u*c*i-o*r,e[10]=c*c*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ht(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bt(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=r+r,c=a+a,f=i+i,s=r*u,_=r*c,l=r*f,p=a*c,d=a*f,m=i*f,h=o*u,y=o*c,b=o*f;return e[0]=1-(p+m),e[1]=_+b,e[2]=l-y,e[3]=0,e[4]=_-b,e[5]=1-(s+m),e[6]=d+h,e[7]=0,e[8]=l+y,e[9]=d-h,e[10]=1-(s+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function vt(e,t){var n=new d(3),r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=r*r+a*a+i*i+o*o;return _>0?(n[0]=2*(u*o+s*r+c*i-f*a)/_,n[1]=2*(c*o+s*a+f*r-u*i)/_,n[2]=2*(f*o+s*i+u*a-c*r)/_):(n[0]=2*(u*o+s*r+c*i-f*a),n[1]=2*(c*o+s*a+f*r-u*i),n[2]=2*(f*o+s*i+u*a-c*r)),bt(e,t,n),e}function gt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function wt(e,t){var n=t[0],r=t[1],a=t[2],i=t[4],o=t[5],u=t[6],c=t[8],f=t[9],s=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(i,o,u),e[2]=Math.hypot(c,f,s),e}function Mt(e,t){var n=new d(3);wt(n,t);var r=1/n[0],a=1/n[1],i=1/n[2],o=t[0]*r,u=t[1]*a,c=t[2]*i,f=t[4]*r,s=t[5]*a,_=t[6]*i,l=t[8]*r,p=t[9]*a,m=t[10]*i,h=o+s+m,y=0;return h>0?(y=2*Math.sqrt(h+1),e[3]=.25*y,e[0]=(_-p)/y,e[1]=(l-c)/y,e[2]=(u-f)/y):o>s&&o>m?(y=2*Math.sqrt(1+o-s-m),e[3]=(_-p)/y,e[0]=.25*y,e[1]=(u+f)/y,e[2]=(l+c)/y):s>m?(y=2*Math.sqrt(1+s-o-m),e[3]=(l-c)/y,e[0]=(u+f)/y,e[1]=.25*y,e[2]=(_+p)/y):(y=2*Math.sqrt(1+m-o-s),e[3]=(u-f)/y,e[0]=(l+c)/y,e[1]=(_+p)/y,e[2]=.25*y),e}function kt(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3],c=a+a,f=i+i,s=o+o,_=a*c,l=a*f,p=a*s,d=i*f,m=i*s,h=o*s,y=u*c,b=u*f,v=u*s,g=r[0],w=r[1],M=r[2];return e[0]=(1-(d+h))*g,e[1]=(l+v)*g,e[2]=(p-b)*g,e[3]=0,e[4]=(l-v)*w,e[5]=(1-(_+h))*w,e[6]=(m+y)*w,e[7]=0,e[8]=(p+b)*M,e[9]=(m-y)*M,e[10]=(1-(_+d))*M,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function xt(e,t,n,r,a){var i=t[0],o=t[1],u=t[2],c=t[3],f=i+i,s=o+o,_=u+u,l=i*f,p=i*s,d=i*_,m=o*s,h=o*_,y=u*_,b=c*f,v=c*s,g=c*_,w=r[0],M=r[1],k=r[2],x=a[0],z=a[1],A=a[2],L=(1-(m+y))*w,E=(p+g)*w,T=(d-v)*w,O=(p-g)*M,S=(1-(l+y))*M,C=(h+b)*M,I=(d+v)*k,P=(h-b)*k,B=(1-(l+m))*k;return e[0]=L,e[1]=E,e[2]=T,e[3]=0,e[4]=O,e[5]=S,e[6]=C,e[7]=0,e[8]=I,e[9]=P,e[10]=B,e[11]=0,e[12]=n[0]+x-(L*x+O*z+I*A),e[13]=n[1]+z-(E*x+S*z+P*A),e[14]=n[2]+A-(T*x+C*z+B*A),e[15]=1,e}function zt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,c=a+a,f=n*o,s=r*o,_=r*u,l=a*o,p=a*u,d=a*c,m=i*o,h=i*u,y=i*c;return e[0]=1-_-d,e[1]=s+y,e[2]=l-h,e[3]=0,e[4]=s-y,e[5]=1-f-d,e[6]=p+m,e[7]=0,e[8]=l+h,e[9]=p-m,e[10]=1-f-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function At(e,t,n,r,a,i,o){var u=1/(n-t),c=1/(a-r),f=1/(i-o);return e[0]=2*i*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*c,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*c,e[10]=(o+i)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*f,e[15]=0,e}function Lt(e,t,n,r,a){var i,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=(a+r)*i,e[14]=2*a*r*i):(e[10]=-1,e[14]=-2*r),e}function Et(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+u),f=2/(a+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(o-u)*c*.5,e[9]=(a-i)*f*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Tt(e,t,n,r,a,i,o){var u=1/(t-n),c=1/(r-a),f=1/(i-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*c,e[14]=(o+i)*f,e[15]=1,e}function Ot(e,t,n,r){var a,i,o,u,c,f,s,_,l,d,m=t[0],h=t[1],y=t[2],b=r[0],v=r[1],g=r[2],w=n[0],M=n[1],k=n[2];return Math.abs(m-w)<p&&Math.abs(h-M)<p&&Math.abs(y-k)<p?et(e):(s=m-w,_=h-M,l=y-k,a=v*(l*=d=1/Math.hypot(s,_,l))-g*(_*=d),i=g*(s*=d)-b*l,o=b*_-v*s,(d=Math.hypot(a,i,o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),u=_*o-l*i,c=l*a-s*o,f=s*i-_*a,(d=Math.hypot(u,c,f))?(u*=d=1/d,c*=d,f*=d):(u=0,c=0,f=0),e[0]=a,e[1]=u,e[2]=s,e[3]=0,e[4]=i,e[5]=c,e[6]=_,e[7]=0,e[8]=o,e[9]=f,e[10]=l,e[11]=0,e[12]=-(a*m+i*h+o*y),e[13]=-(u*m+c*h+f*y),e[14]=-(s*m+_*h+l*y),e[15]=1,e)}function St(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=r[0],c=r[1],f=r[2],s=a-n[0],_=i-n[1],l=o-n[2],p=s*s+_*_+l*l;p>0&&(s*=p=1/Math.sqrt(p),_*=p,l*=p);var d=c*l-f*_,m=f*s-u*l,h=u*_-c*s;return(p=d*d+m*m+h*h)>0&&(d*=p=1/Math.sqrt(p),m*=p,h*=p),e[0]=d,e[1]=m,e[2]=h,e[3]=0,e[4]=_*h-l*m,e[5]=l*d-s*h,e[6]=s*m-_*d,e[7]=0,e[8]=s,e[9]=_,e[10]=l,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e}function Ct(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function It(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Pt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Bt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Ft(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function jt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Dt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Rt(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],c=e[6],f=e[7],s=e[8],_=e[9],l=e[10],d=e[11],m=e[12],h=e[13],y=e[14],b=e[15],v=t[0],g=t[1],w=t[2],M=t[3],k=t[4],x=t[5],z=t[6],A=t[7],L=t[8],E=t[9],T=t[10],O=t[11],S=t[12],C=t[13],I=t[14],P=t[15];return Math.abs(n-v)<=p*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-g)<=p*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-w)<=p*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(i-M)<=p*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-k)<=p*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(u-x)<=p*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(c-z)<=p*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(f-A)<=p*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(s-L)<=p*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(_-E)<=p*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(l-T)<=p*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(d-O)<=p*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(m-S)<=p*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(h-C)<=p*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(y-I)<=p*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(b-P)<=p*Math.max(1,Math.abs(b),Math.abs(P))}var Vt=it,qt=Bt;function Gt(){var e=new d(3);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Nt(e){var t=new d(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ut(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Wt(e,t,n){var r=new d(3);return r[0]=e,r[1]=t,r[2]=n,r}function Ht(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zt(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Yt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Xt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Kt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Jt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Qt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function $t(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function en(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function tn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function nn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function rn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function an(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function on(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function un(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function cn(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function fn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function sn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function _n(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function ln(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pn(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],c=n[2];return e[0]=a*c-i*u,e[1]=i*o-r*c,e[2]=r*u-a*o,e}function dn(e,t,n,r){var a=t[0],i=t[1],o=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e}function mn(e,t,n,r,a,i){var o=i*i,u=o*(2*i-3)+1,c=o*(i-2)+i,f=o*(i-1),s=o*(3-2*i);return e[0]=t[0]*u+n[0]*c+r[0]*f+a[0]*s,e[1]=t[1]*u+n[1]*c+r[1]*f+a[1]*s,e[2]=t[2]*u+n[2]*c+r[2]*f+a[2]*s,e}function hn(e,t,n,r,a,i){var o=1-i,u=o*o,c=i*i,f=u*o,s=3*i*u,_=3*c*o,l=c*i;return e[0]=t[0]*f+n[0]*s+r[0]*_+a[0]*l,e[1]=t[1]*f+n[1]*s+r[1]*_+a[1]*l,e[2]=t[2]*f+n[2]*s+r[2]*_+a[2]*l,e}function yn(e,t){t=t||1;var n=2*m()*Math.PI,r=2*m()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function bn(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,e}function vn(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e}function gn(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],u=t[0],c=t[1],f=t[2],s=a*f-i*c,_=i*u-r*f,l=r*c-a*u,p=a*l-i*_,d=i*s-r*l,m=r*_-a*s,h=2*o;return s*=h,_*=h,l*=h,p*=2,d*=2,m*=2,e[0]=u+s+p,e[1]=c+_+d,e[2]=f+l+m,e}function wn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Mn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function kn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function xn(e,t){var n=Wt(e[0],e[1],e[2]),r=Wt(t[0],t[1],t[2]);_n(n,n),_n(r,r);var a=ln(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function zn(e){return e[0]=0,e[1]=0,e[2]=0,e}function An(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ln(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function En(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],o=t[1],u=t[2];return Math.abs(n-i)<=p*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=p*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-u)<=p*Math.max(1,Math.abs(a),Math.abs(u))}var Tn=Xt,On=Kt,Sn=Jt,Cn=on,In=un,Pn=Ut,Bn=cn,Fn=function(){var e=Gt();return function(t,n,r,a,i,o){var u,c;for(n||(n=3),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,u=r;u<c;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}();function jn(){var e=new d(4);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Dn(e){var t=new d(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rn(e,t,n,r){var a=new d(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function Vn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function qn(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function Gn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Nn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Un(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Wn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Hn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Zn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Yn(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function Xn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function Kn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Jn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Qn(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function $n(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.hypot(n,r,a,i)}function er(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+a*a+i*i}function tr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function nr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}function rr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ar(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ir(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=i*o,e}function or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ur(e,t,n,r){var a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],u=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],f=n[2]*r[3]-n[3]*r[2],s=t[0],_=t[1],l=t[2],p=t[3];return e[0]=_*f-l*c+p*u,e[1]=-s*f+l*o-p*i,e[2]=s*c-_*o+p*a,e[3]=-s*u+_*i-l*a,e}function cr(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e}function fr(e,t){var n,r,a,i,o,u;t=t||1;do{o=(n=2*m()-1)*n+(r=2*m()-1)*r}while(o>=1);do{u=(a=2*m()-1)*a+(i=2*m()-1)*i}while(u>=1);var c=Math.sqrt((1-o)/u);return e[0]=t*n,e[1]=t*r,e[2]=t*a*c,e[3]=t*i*c,e}function sr(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,e}function _r(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],c=n[2],f=n[3],s=f*r+u*i-c*a,_=f*a+c*r-o*i,l=f*i+o*a-u*r,p=-o*r-u*a-c*i;return e[0]=s*f+p*-o+_*-c-l*-u,e[1]=_*f+p*-u+l*-o-s*-c,e[2]=l*f+p*-c+s*-u-_*-o,e[3]=t[3],e}function lr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function pr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function dr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function mr(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],u=t[1],c=t[2],f=t[3];return Math.abs(n-o)<=p*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=p*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=p*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-f)<=p*Math.max(1,Math.abs(i),Math.abs(f))}var hr=Nn,yr=Un,br=Wn,vr=$n,gr=er,wr=tr,Mr=nr,kr=function(){var e=jn();return function(t,n,r,a,i,o){var u,c;for(n||(n=4),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,u=r;u<c;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}();function xr(){var e=new d(4);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function zr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ar(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Lr(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>p?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Er(e,t){var n=Jr(e,t);return Math.acos(2*n*n-1)}function Tr(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],c=n[1],f=n[2],s=n[3];return e[0]=r*s+o*u+a*f-i*c,e[1]=a*s+o*c+i*u-r*f,e[2]=i*s+o*f+r*c-a*u,e[3]=o*s-r*u-a*c-i*f,e}function Or(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*u,e[1]=a*c+i*u,e[2]=i*c-a*u,e[3]=o*c-r*u,e}function Sr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),c=Math.cos(n);return e[0]=r*c-i*u,e[1]=a*c+o*u,e[2]=i*c+r*u,e[3]=o*c-a*u,e}function Cr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*u,e[1]=a*c-r*u,e[2]=i*c+o*u,e[3]=o*c-i*u,e}function Ir(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function Pr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),u=Math.exp(i),c=o>0?u*Math.sin(o)/o:0;return e[0]=n*c,e[1]=r*c,e[2]=a*c,e[3]=u*Math.cos(o),e}function Br(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),u=o>0?Math.atan2(o,i)/o:0;return e[0]=n*u,e[1]=r*u,e[2]=a*u,e[3]=.5*Math.log(n*n+r*r+a*a+i*i),e}function Fr(e,t,n){return Br(e,t),Kr(e,e,n),Pr(e,e),e}function jr(e,t,n,r){var a,i,o,u,c,f=t[0],s=t[1],_=t[2],l=t[3],d=n[0],m=n[1],h=n[2],y=n[3];return(i=f*d+s*m+_*h+l*y)<0&&(i=-i,d=-d,m=-m,h=-h,y=-y),1-i>p?(a=Math.acos(i),o=Math.sin(a),u=Math.sin((1-r)*a)/o,c=Math.sin(r*a)/o):(u=1-r,c=r),e[0]=u*f+c*d,e[1]=u*s+c*m,e[2]=u*_+c*h,e[3]=u*l+c*y,e}function Dr(e){var t=m(),n=m(),r=m(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e}function Rr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-a*u,e[3]=i*u,e}function Vr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function qr(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+o]-t[3*o+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e}function Gr(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),o=Math.cos(t),u=Math.sin(n),c=Math.cos(n),f=Math.sin(r),s=Math.cos(r);return e[0]=i*c*s-o*u*f,e[1]=o*u*s+i*c*f,e[2]=o*c*f-i*u*s,e[3]=o*c*s+i*u*f,e}function Nr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Ur=Dn,Wr=Rn,Hr=Vn,Zr=qn,Yr=Gn,Xr=Tr,Kr=Jn,Jr=or,Qr=cr,$r=tr,ea=$r,ta=nr,na=ta,ra=ir,aa=dr,ia=mr,oa=function(){var e=Gt(),t=Wt(1,0,0),n=Wt(0,1,0);return function(r,a,i){var o=ln(a,i);return o<-.999999?(pn(e,t,a),Pn(e)<1e-6&&pn(e,n,a),_n(e,e),Ar(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(pn(e,a,i),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,ra(r,r))}}(),ua=function(){var e=xr(),t=xr();return function(n,r,a,i,o,u){return jr(e,r,o,u),jr(t,a,i,u),jr(n,e,t,2*u*(1-u)),n}}(),ca=function(){var e=ye();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],ra(t,qr(t,e))}}();function fa(){var e=new d(8);return d!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function sa(e){var t=new d(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function _a(e,t,n,r,a,i,o,u){var c=new d(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=a,c[5]=i,c[6]=o,c[7]=u,c}function la(e,t,n,r,a,i,o){var u=new d(8);u[0]=e,u[1]=t,u[2]=n,u[3]=r;var c=.5*a,f=.5*i,s=.5*o;return u[4]=c*r+f*n-s*t,u[5]=f*r+s*e-c*n,u[6]=s*r+c*t-f*e,u[7]=-c*e-f*t-s*n,u}function pa(e,t,n){var r=.5*n[0],a=.5*n[1],i=.5*n[2],o=t[0],u=t[1],c=t[2],f=t[3];return e[0]=o,e[1]=u,e[2]=c,e[3]=f,e[4]=r*f+a*c-i*u,e[5]=a*f+i*o-r*c,e[6]=i*f+r*u-a*o,e[7]=-r*o-a*u-i*c,e}function da(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function ma(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function ha(e,t){var n=xr();Mt(n,t);var r=new d(3);return gt(r,t),pa(e,n,r),e}function ya(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ba(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function va(e,t,n,r,a,i,o,u,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=c,e}var ga=Hr;function wa(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Ma=Hr;function ka(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function xa(e,t){var n=t[4],r=t[5],a=t[6],i=t[7],o=-t[0],u=-t[1],c=-t[2],f=t[3];return e[0]=2*(n*f+i*o+r*c-a*u),e[1]=2*(r*f+i*u+a*o-n*c),e[2]=2*(a*f+i*c+n*u-r*o),e}function za(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=.5*n[0],c=.5*n[1],f=.5*n[2],s=t[4],_=t[5],l=t[6],p=t[7];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=o*u+a*f-i*c+s,e[5]=o*c+i*u-r*f+_,e[6]=o*f+r*c-a*u+l,e[7]=-r*u-a*c-i*f+p,e}function Aa(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=u*o+s*r+c*i-f*a,l=c*o+s*a+f*r-u*i,p=f*o+s*i+u*a-c*r,d=s*o-u*r-c*a-f*i;return Or(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=_*o+d*r+l*i-p*a,e[5]=l*o+d*a+p*r-_*i,e[6]=p*o+d*i+_*a-l*r,e[7]=d*o-_*r-l*a-p*i,e}function La(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=u*o+s*r+c*i-f*a,l=c*o+s*a+f*r-u*i,p=f*o+s*i+u*a-c*r,d=s*o-u*r-c*a-f*i;return Sr(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=_*o+d*r+l*i-p*a,e[5]=l*o+d*a+p*r-_*i,e[6]=p*o+d*i+_*a-l*r,e[7]=d*o-_*r-l*a-p*i,e}function Ea(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],c=t[5],f=t[6],s=t[7],_=u*o+s*r+c*i-f*a,l=c*o+s*a+f*r-u*i,p=f*o+s*i+u*a-c*r,d=s*o-u*r-c*a-f*i;return Cr(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=_*o+d*r+l*i-p*a,e[5]=l*o+d*a+p*r-_*i,e[6]=p*o+d*i+_*a-l*r,e[7]=d*o-_*r-l*a-p*i,e}function Ta(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],u=t[0],c=t[1],f=t[2],s=t[3];return e[0]=u*o+s*r+c*i-f*a,e[1]=c*o+s*a+f*r-u*i,e[2]=f*o+s*i+u*a-c*r,e[3]=s*o-u*r-c*a-f*i,u=t[4],c=t[5],f=t[6],s=t[7],e[4]=u*o+s*r+c*i-f*a,e[5]=c*o+s*a+f*r-u*i,e[6]=f*o+s*i+u*a-c*r,e[7]=s*o-u*r-c*a-f*i,e}function Oa(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],c=n[1],f=n[2],s=n[3];return e[0]=r*s+o*u+a*f-i*c,e[1]=a*s+o*c+i*u-r*f,e[2]=i*s+o*f+r*c-a*u,e[3]=o*s-r*u-a*c-i*f,u=n[4],c=n[5],f=n[6],s=n[7],e[4]=r*s+o*u+a*f-i*c,e[5]=a*s+o*c+i*u-r*f,e[6]=i*s+o*f+r*c-a*u,e[7]=o*s-r*u-a*c-i*f,e}function Sa(e,t,n,r){if(Math.abs(r)<p)return ya(e,t);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var i=Math.sin(r),o=i*n[0]/a,u=i*n[1]/a,c=i*n[2]/a,f=Math.cos(r),s=t[0],_=t[1],l=t[2],d=t[3];e[0]=s*f+d*o+_*c-l*u,e[1]=_*f+d*u+l*o-s*c,e[2]=l*f+d*c+s*u-_*o,e[3]=d*f-s*o-_*u-l*c;var m=t[4],h=t[5],y=t[6],b=t[7];return e[4]=m*f+b*o+h*c-y*u,e[5]=h*f+b*u+y*o-m*c,e[6]=y*f+b*c+m*u-h*o,e[7]=b*f-m*o-h*u-y*c,e}function Ca(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Ia(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[4],c=n[5],f=n[6],s=n[7],_=t[4],l=t[5],p=t[6],d=t[7],m=n[0],h=n[1],y=n[2],b=n[3];return e[0]=r*b+o*m+a*y-i*h,e[1]=a*b+o*h+i*m-r*y,e[2]=i*b+o*y+r*h-a*m,e[3]=o*b-r*m-a*h-i*y,e[4]=r*s+o*u+a*f-i*c+_*b+d*m+l*y-p*h,e[5]=a*s+o*c+i*u-r*f+l*b+d*h+p*m-_*y,e[6]=i*s+o*f+r*c-a*u+p*b+d*y+_*h-l*m,e[7]=o*s-r*u-a*c-i*f+d*b-_*m-l*h-p*y,e}var Pa=Ia;function Ba(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var Fa=Jr;function ja(e,t,n,r){var a=1-r;return Fa(t,n)<0&&(r=-r),e[0]=t[0]*a+n[0]*r,e[1]=t[1]*a+n[1]*r,e[2]=t[2]*a+n[2]*r,e[3]=t[3]*a+n[3]*r,e[4]=t[4]*a+n[4]*r,e[5]=t[5]*a+n[5]*r,e[6]=t[6]*a+n[6]*r,e[7]=t[7]*a+n[7]*r,e}function Da(e,t){var n=Ga(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function Ra(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Va=$r,qa=Va,Ga=ta,Na=Ga;function Ua(e,t){var n=Ga(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,a=t[1]/n,i=t[2]/n,o=t[3]/n,u=t[4],c=t[5],f=t[6],s=t[7],_=r*u+a*c+i*f+o*s;e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=(u-r*_)/n,e[5]=(c-a*_)/n,e[6]=(f-i*_)/n,e[7]=(s-o*_)/n}return e}function Wa(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Ha(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function Za(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],c=e[6],f=e[7],s=t[0],_=t[1],l=t[2],d=t[3],m=t[4],h=t[5],y=t[6],b=t[7];return Math.abs(n-s)<=p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-_)<=p*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-l)<=p*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-d)<=p*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-m)<=p*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-h)<=p*Math.max(1,Math.abs(u),Math.abs(h))&&Math.abs(c-y)<=p*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-b)<=p*Math.max(1,Math.abs(f),Math.abs(b))}function Ya(){var e=new d(2);return d!=Float32Array&&(e[0]=0,e[1]=0),e}function Xa(e){var t=new d(2);return t[0]=e[0],t[1]=e[1],t}function Ka(e,t){var n=new d(2);return n[0]=e,n[1]=t,n}function Ja(e,t){return e[0]=t[0],e[1]=t[1],e}function Qa(e,t,n){return e[0]=t,e[1]=n,e}function $a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ei(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ti(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function ni(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function ri(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ai(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ii(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function oi(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function ui(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ci(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function fi(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function si(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function _i(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function li(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function pi(e){var t=e[0],n=e[1];return t*t+n*n}function di(e,t){return e[0]=-t[0],e[1]=-t[1],e}function mi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function hi(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function yi(e,t){return e[0]*t[0]+e[1]*t[1]}function bi(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function vi(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e}function gi(e,t){t=t||1;var n=2*m()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function wi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e}function Mi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e}function ki(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e}function xi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e}function zi(e,t,n,r){var a=t[0]-n[0],i=t[1]-n[1],o=Math.sin(r),u=Math.cos(r);return e[0]=a*u-i*o+n[0],e[1]=a*o+i*u+n[1],e}function Ai(e,t){var n=e[0],r=e[1],a=t[0],i=t[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var u=a*a+i*i;u>0&&(u=1/Math.sqrt(u));var c=(n*a+r*i)*o*u;return c>1?0:c<-1?Math.PI:Math.acos(c)}function Li(e){return e[0]=0,e[1]=0,e}function Ei(e){return"vec2("+e[0]+", "+e[1]+")"}function Ti(e,t){return e[0]===t[0]&&e[1]===t[1]}function Oi(e,t){var n=e[0],r=e[1],a=t[0],i=t[1];return Math.abs(n-a)<=p*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=p*Math.max(1,Math.abs(r),Math.abs(i))}var Si=li,Ci=ei,Ii=ti,Pi=ni,Bi=si,Fi=_i,ji=pi,Di=function(){var e=Ya();return function(t,n,r,a,i,o){var u,c;for(n||(n=2),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,u=r;u<c;u+=n)e[0]=t[u],e[1]=t[u+1],i(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}()}]);\n//# sourceMappingURL=worker.0b4c7b2a.worker.js.map',"Worker",void 0,n.p+"static/js/worker.0b4c7b2a.worker.js")}},function(e,t,n){"use strict";n.r(t),t.default=function(){return new Worker(n.p+"static/js/worker.0b4c7b2a.worker.js")}},function(e,t,n){"use strict";n.r(t),t.default="./zcv.wasm"},function(e,t,n){"use strict";var r=n(17),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.permissionDeniedUI=t.permissionRequestUI=t.permissionRequestMotion=t.permissionRequestCamera=t.permissionRequestAll=t.permissionGrantedAll=t.permissionDeniedAny=t.permissionDeniedMotion=t.permissionDeniedCamera=t.permissionGrantedMotion=t.permissionGrantedCamera=void 0;var i=new(n(81).UAParser),o=!1,s=!1,c=!1,u=!1;function l(){return a(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.permissions||!navigator.permissions.query){e.next=11;break}return e.prev=1,e.next=4,navigator.permissions.query({name:"camera"});case 4:t=e.sent,c="denied"===t.state,o="granted"===t.state,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(1);case 11:case"end":return e.stop()}}),e,null,[[1,9]])})))}function g(){return c||u}function d(){return o&&s}function I(){return a(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:return e.next=4,A();case 4:case"end":return e.stop()}}),e)})))}function A(){return a(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:t=e.sent,t.getTracks().forEach((function(e){return e.stop()})),o=!0,c=!1,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),o=!1,c=!0;case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))}function h(){return a(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.DeviceOrientationEvent||!window.DeviceOrientationEvent.requestPermission){e.next=8;break}return e.next=3,window.DeviceOrientationEvent.requestPermission();case 3:if("granted"===e.sent){e.next=8;break}return s=!1,u=!0,e.abrupt("return",!1);case 8:s=!0,u=!1;case 10:case"end":return e.stop()}}),e)})))}window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission||(s=!0),l(),t.permissionGrantedCamera=function(){return o},t.permissionGrantedMotion=function(){return s},t.permissionDeniedCamera=function(){return c},t.permissionDeniedMotion=function(){return u},t.permissionDeniedAny=g,t.permissionGrantedAll=d,t.permissionRequestAll=I,t.permissionRequestCamera=A,t.permissionRequestMotion=h,t.permissionRequestUI=function(){return a(this,void 0,void 0,r.mark((function e(){var t,n,i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l();case 2:if(!d()){e.next=4;break}return e.abrupt("return",!0);case 4:return(t=document.createElement("div")).classList.add("zappar-permission-request"),t.innerHTML='\n    <style>\n        .zappar-permission-request {\n            position: fixed;\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            z-index: 1000;\n            background-color: rgba(0, 0, 0, 0.9);\n            font-family: sans-serif;\n            color: white;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n        .zappar-inner {\n            max-width: 400px;\n            text-align: center;\n        }\n        .zappar-title {\n            font-size: 20px;\n        }\n        .zappar-text {\n            font-size: 14px;\n            padding: 15px;\n        }\n        .zappar-inner > button {\n            background: none;\n            outline: none;\n            border: 2px solid white;\n            border-radius: 10px;\n            color: white;\n            padding: 10px 40px;\n            text-transform: uppercase;\n        }\n    </style>\n    <div class="zappar-inner">\n        <div class="zappar-title">Almost there...</div>\n        <div class="zappar-text">In order to provide this augmented reality experience, we need access to your device\'s camera and motion sensors.</div>\n        <button id="zappar-permission-request-button">Grant Access</button>\n    </div>\n',document.body.append(t),n=t.querySelector("#zappar-permission-request-button"),e.next=11,new Promise((function(e){null===n||void 0===n||n.addEventListener("click",(function(){return a(i,void 0,void 0,r.mark((function n(){return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,I();case 2:t.remove();case 3:return n.next=6,new Promise((function(e){return requestAnimationFrame((function(){return e()}))}));case 6:if(!g()){n.next=9;break}return e(!1),n.abrupt("return");case 9:if(!d()){n.next=12;break}return e(!0),n.abrupt("return");case 12:n.next=3;break;case 14:case"end":return n.stop()}}),n)})))}))}));case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))},t.permissionDeniedUI=function(){if("Chrome"===i.getBrowser().name)!function(){var e=document.createElement("div");e.classList.add("zappar-permission-request"),e.innerHTML='\n    <style>\n        .zappar-permission-request {\n            position: fixed;\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            z-index: 1000;\n            background-color: rgba(0, 0, 0, 0.9);\n            font-family: sans-serif;\n            color: white;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n        .zappar-inner {\n            width: 400px;\n            text-align: center;\n        }\n        .zappar-title {\n            font-size: 20px;\n        }\n        .zappar-text {\n            font-size: 14px;\n            padding: 15px;\n        }\n        .zappar-inner > button {\n            background: none;\n            outline: none;\n            border: 2px solid white;\n            border-radius: 10px;\n            color: white;\n            padding: 10px 40px;\n            text-transform: uppercase;\n        }\n    </style>\n    <div class="zappar-inner">\n        <div class="zappar-title">Permission is Needed</div>\n        <div class="zappar-text">Permission to access your device\'s camera and motion sensors is necessary for this experience.<br/><br/>To grant access, please tap the ! button in the address bar of your browser, then "Site settings", and finally "Clear and reset". You can then reload the page to try again.</div>\n        <button id="zappar-permission-reload-button">Reload</button>\n    </div>\n',document.body.append(e);var t=e.querySelector("#zappar-permission-reload-button");null===t||void 0===t||t.addEventListener("click",(function(){return window.location.reload()}))}();else!function(){var e=document.createElement("div");e.classList.add("zappar-permission-request"),e.innerHTML='\n    <style>\n        .zappar-permission-request {\n            position: fixed;\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            z-index: 1000;\n            background-color: rgba(0, 0, 0, 0.9);\n            font-family: sans-serif;\n            color: white;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n        }\n        .zappar-inner {\n            max-width: 400px;\n            text-align: center;\n        }\n        .zappar-title {\n            font-size: 20px;\n        }\n        .zappar-text {\n            font-size: 14px;\n            padding: 15px;\n        }\n        .zappar-inner > button {\n            background: none;\n            outline: none;\n            border: 2px solid white;\n            border-radius: 10px;\n            color: white;\n            padding: 10px 40px;\n            text-transform: uppercase;\n        }\n    </style>\n    <div class="zappar-inner">\n        <div class="zappar-title">Permission is Needed</div>\n        <div class="zappar-text">Permission to access your device\'s camera and motion sensors is necessary for this experience. Please reload the page to try again.</div>\n        <button id="zappar-permission-reload-button">Reload</button>\n    </div>\n',document.body.append(e);var t=e.querySelector("#zappar-permission-reload-button");null===t||void 0===t||t.addEventListener("click",(function(){return window.location.reload()}))}()}},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceMesh=t.getFaceMesh=t.destroyFaceMesh=t.createFaceMesh=void 0;var i=n(36),o=n(46),s=1,c=new Map;t.createFaceMesh=function(){var e=s++;return c.set(e,new u),o.zcout("face_mesh_t initialized"),e},t.destroyFaceMesh=function(e){c.delete(e)},t.getFaceMesh=function(e){return c.get(e)};var u=function(){function e(){r(this,e),this.render_mean_=new Float32Array,this.render_identity_=new Float32Array(50),this.render_expression_=new Float32Array(29),this.render_uvs_=new Float32Array,this.render_indices_=new Uint16Array,this.vertices_=new Float32Array,this.normals_=new Float32Array,this.normalsCalculated_=!1,this.modelVersion_=-1,this.mirrored_=!1}return a(e,[{key:"loadFromMemory",value:function(e,t,n,r,a){var i=0,o=new Uint16Array(e),s=new Int32Array(e),c=new Float32Array(e),u=function(){var e=s[i++]*s[i++],t=c.subarray(i,i+e);return i+=e,t},l=function(){var e=s[i++],t=o.subarray(2*i,2*i+e);return i+=e/2,t};this.render_mean_=u(),this.render_identity_=u(),this.render_expression_=u(),this.render_uvs_=u();var g=l(),d=i<s.length?l():new Uint16Array,I=i<s.length?l():new Uint16Array,A=i<s.length?l():new Uint16Array,h=i<s.length?l():new Uint16Array;if(t||n||r||a){var C=g.length;t&&(C+=d.length),n&&(C+=I.length),r&&(C+=A.length),a&&(C+=h.length),this.render_indices_=new Uint16Array(C),this.render_indices_.set(g,0);var f=g.length;t&&(this.render_indices_.set(d,f),f+=d.length),n&&(this.render_indices_.set(I,f),f+=I.length),r&&(this.render_indices_.set(A,f),f+=A.length),a&&(this.render_indices_.set(h,f),f+=h.length)}else this.render_indices_=g;this.vertices_=new Float32Array(this.render_mean_),this.normals_=new Float32Array(this.vertices_.length),this.modelVersion_++}},{key:"getVertices",value:function(){return this.vertices_}},{key:"getUVs",value:function(){return this.render_uvs_}},{key:"getIndices",value:function(){if(this.mirrored_){if(!this.render_indices_reversed){this.render_indices_reversed=new Uint16Array(this.render_indices_.length);for(var e=0;e<this.render_indices_.length;e+=3)this.render_indices_reversed[e]=this.render_indices_[e+2],this.render_indices_reversed[e+1]=this.render_indices_[e+1],this.render_indices_reversed[e+2]=this.render_indices_[e]}return this.render_indices_reversed}return this.render_indices_}},{key:"getNormals",value:function(){return this.normalsCalculated_||this.calculateNormals(),this.normals_}},{key:"getModelVersion",value:function(){return this.modelVersion_}},{key:"getLandmarkDataForVertex",value:function(e){for(var t=[this.render_mean_[3*e],this.render_mean_[3*e+1],this.render_mean_[3*e+2]],n=[],r=0;r<50;r++)n.push(this.render_identity_[3*e*50+r]),n.push(this.render_identity_[50*(3*e+1)+r]),n.push(this.render_identity_[50*(3*e+2)+r]);for(var a=[],i=0;i<29;i++)a.push(this.render_expression_[3*e*29+i]),a.push(this.render_expression_[29*(3*e+1)+i]),a.push(this.render_expression_[29*(3*e+2)+i]);return{mean:t,identity:n,expression:a}}},{key:"update",value:function(e,t,n){if(0!==this.render_mean_.length&&0!==this.render_identity_.length&&0!==this.render_expression_.length){this.mirrored_=n,this.vertices_.set(this.render_mean_);for(var r=0;r<e.length;r++)for(var a=0;a<this.vertices_.length;a++)this.vertices_[a]+=e[r]*this.render_identity_[a*e.length+r];for(var i=0;i<t.length;i++)for(var o=0;o<this.vertices_.length;o++)this.vertices_[o]+=t[i]*this.render_expression_[o*t.length+i];if(n)for(var s=0;s<this.vertices_.length;s+=3)this.vertices_[s]*=-1;this.normalsCalculated_=!1}}},{key:"calculateNormals",value:function(){var e=this.getIndices(),t=this.vertices_,n=new Float32Array(e.length);if(t){for(var r=e.length,a=this.normals_,o=new Float32Array([0,0,0]),s=new Float32Array([0,0,0]),c=new Float32Array([0,0,0]),u=0;u<r;u+=3){var l=3*e[u],g=3*e[u+1],d=3*e[u+2];o[0]=t[g]-t[l],o[1]=t[g+1]-t[l+1],o[2]=t[g+2]-t[l+2],s[0]=t[d]-t[l],s[1]=t[d+1]-t[l+1],s[2]=t[d+2]-t[l+2],i.vec3.cross(c,o,s);var I=i.vec3.length(c);n[u]=c[0]/I,n[u+1]=c[1]/I,n[u+2]=c[2]/I}a.fill(0);for(var A=0;A<r;A+=3){var h=3*e[A],C=3*e[A+1],f=3*e[A+2];a[h]+=n[A],a[h+1]+=n[A+1],a[h+2]+=n[A+2],a[C]+=n[A],a[C+1]+=n[A+1],a[C+2]+=n[A+2],a[f]+=n[A],a[f+1]+=n[A+1],a[f+2]+=n[A+2]}for(var p=a.length/3,m=0;m<p;m++){var v=3*m;o[0]=a[v],o[1]=a[v+1],o[2]=a[v+2],i.vec3.normalize(s,o),a[v]=s[0],a[v+1]=s[1],a[v+2]=s[2]}this.normalsCalculated_=!0}}}]),e}();t.FaceMesh=u},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.cameraFrameTextureMatrix=t.CameraDraw=void 0;var i=n(52),o=n(36),s=function(){function e(t){r(this,e),this._gl=t}return a(e,[{key:"dispose",value:function(){this._vbo&&this._gl.deleteBuffer(this._vbo),this._vbo=void 0,this._shader&&this._gl.deleteProgram(this._shader.prog),this._shader=void 0}},{key:"_generate",value:function(e,t){if(this._vbo)return this._vbo;if(this._vbo||(this._vbo=e.createBuffer()),!this._vbo)throw new Error("Unable to create buffer object");var n=new Float32Array([-1,-1,0,0,0,-1,1,0,0,1,1,-1,0,1,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);return e.bindBuffer(e.ARRAY_BUFFER,this._vbo),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this._vbo}},{key:"drawCameraFrame",value:function(e,t,n,r){if(n.texture){var a=this._gl;a.disable(a.DEPTH_TEST),a.disable(a.SCISSOR_TEST),a.disable(a.CULL_FACE),a.disable(a.BLEND);var i=this._getCameraShader(a),o=this._generate(a,n);a.activeTexture(a.TEXTURE0),a.useProgram(i.prog),a.uniformMatrix4fv(i.unif_skinTexTransform,!1,l(n.dataWidth,n.dataHeight,e,t,n.uvTransform,r)),a.uniform1i(i.unif_skinSampler,0),a.bindTexture(a.TEXTURE_2D,n.texture),a.bindBuffer(a.ARRAY_BUFFER,o),a.vertexAttribPointer(i.attr_position,3,a.FLOAT,!1,20,0),a.enableVertexAttribArray(i.attr_position),a.vertexAttribPointer(i.attr_texCoord,2,a.FLOAT,!1,20,12),a.enableVertexAttribArray(i.attr_texCoord),a.drawArrays(a.TRIANGLES,0,6),a.disableVertexAttribArray(i.attr_position),a.disableVertexAttribArray(i.attr_texCoord),a.bindTexture(a.TEXTURE_2D,null),a.bindBuffer(a.ARRAY_BUFFER,null),a.useProgram(null)}}},{key:"_getCameraShader",value:function(e){if(this._shader)return this._shader;var t=e.createProgram();if(!t)throw new Error("Unable to create program");var n=i.compileShader(e,e.VERTEX_SHADER,c),r=i.compileShader(e,e.FRAGMENT_SHADER,u);e.attachShader(t,n),e.attachShader(t,r),i.linkProgram(e,t);var a=e.getUniformLocation(t,"skinTexTransform");if(!a)throw new Error("Unable to get uniform location skinTexTransform");var o=e.getUniformLocation(t,"skinSampler");if(!o)throw new Error("Unable to get uniform location skinSampler");return this._shader={prog:t,unif_skinTexTransform:a,unif_skinSampler:o,attr_position:e.getAttribLocation(t,"position"),attr_texCoord:e.getAttribLocation(t,"texCoord")},this._shader}}]),e}();t.CameraDraw=s;var c="\n#ifndef GL_ES\n#define highp\n#define mediump\n#define lowp\n#endif\n\nattribute vec4 position;\nattribute vec4 texCoord;\nvarying vec4 skinTexVarying;\nuniform mat4 skinTexTransform;\n\nvoid main()\n{\n    gl_Position = position;\n    skinTexVarying = skinTexTransform * texCoord;\n}",u="\n#define highp mediump\n#ifdef GL_ES\n    // define default precision for float, vec, mat.\n    precision highp float;\n#else\n#define highp\n#define mediump\n#define lowp\n#endif\n\nvarying vec4 skinTexVarying;\nuniform lowp sampler2D skinSampler;\n\nvoid main()\n{\n    gl_FragColor = texture2DProj(skinSampler, skinTexVarying);\n}";function l(e,t,n,r,a,i){var s=o.mat4.create(),c=o.mat4.create();o.mat4.fromTranslation(c,[-.5,-.5,0]),o.mat4.multiply(s,c,s),i&&(o.mat4.fromScaling(c,[-1,1,1]),o.mat4.multiply(s,c,s)),o.mat4.fromRotation(c,-1*function(){if(window.screen.orientation)switch(window.screen.orientation.type){case"portrait-primary":return 270;case"landscape-secondary":return 180;case"portrait-secondary":return 90;default:return 0}else if(void 0!==window.orientation)switch(window.orientation){case 0:return 270;case 90:return 0;case 180:return 90;case-90:return 180}return 0}()*Math.PI/180,[0,0,1]),o.mat4.multiply(s,c,s);var u=o.vec3.create();u[0]=n,u[1]=r,u[2]=0,o.vec3.transformMat4(u,u,c);var l=Math.abs(u[0]),g=Math.abs(u[1]);o.mat4.fromScaling(c,[1,-1,1]),o.mat4.multiply(s,c,s);var d=l/g,I=e/t;return d>I?o.mat4.fromScaling(c,[1,I/d,1]):o.mat4.fromScaling(c,[d/I,1,1]),o.mat4.multiply(s,c,s),o.mat4.fromTranslation(c,[.5,.5,0]),o.mat4.multiply(s,c,s),o.mat4.multiply(s,a,s),s}t.cameraFrameTextureMatrix=l},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceDraw=void 0;var i=n(52),o=function(){function e(t){r(this,e),this._gl=t}return a(e,[{key:"dispose",value:function(){this._vbo&&this._gl.deleteBuffer(this._vbo),this._normalbo&&this._gl.deleteBuffer(this._normalbo),this._ibo&&this._gl.deleteBuffer(this._ibo),this._shader&&this._gl.deleteProgram(this._shader.prog),this._vbo=void 0,this._normalbo=void 0,this._ibo=void 0,this._shader=void 0}},{key:"_generateIBO",value:function(e,t){if(this._ibo&&this._lastIndices===e)return this._ibo;if(this._lastIndices=e,this._ibo||(this._ibo=t.createBuffer()),!this._ibo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._ibo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this._ibo}},{key:"_generateVBO",value:function(e,t){if(this._vbo||(this._vbo=t.createBuffer()),!this._vbo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this._vbo}},{key:"_generateNormalBO",value:function(e,t){if(this._normalbo||(this._normalbo=t.createBuffer()),!this._normalbo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ARRAY_BUFFER,this._normalbo),t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this._normalbo}},{key:"drawFace",value:function(e,t){var n=this._gl,r=this._getShader(n),a=this._generateVBO(t.getVertices(),n),i=this._generateNormalBO(t.getNormals(),n),o=this._generateIBO(t.getIndices(),n);n.enable(n.DEPTH_TEST),n.enable(n.CULL_FACE),n.useProgram(r.prog),n.uniformMatrix4fv(r.unif_matrix,!1,e),n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(r.attr_position,3,n.FLOAT,!1,12,0),n.enableVertexAttribArray(r.attr_position),n.bindBuffer(n.ARRAY_BUFFER,i),n.vertexAttribPointer(r.attr_normal,3,n.FLOAT,!1,12,0),n.enableVertexAttribArray(r.attr_normal),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.drawElements(n.TRIANGLES,t.getIndices().length,n.UNSIGNED_SHORT,0),n.disableVertexAttribArray(r.attr_position),n.disableVertexAttribArray(r.attr_normal),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}},{key:"_getShader",value:function(e){if(this._shader)return this._shader;var t=e.createProgram();if(!t)throw new Error("Unable to create program");var n=i.compileShader(e,e.VERTEX_SHADER,s),r=i.compileShader(e,e.FRAGMENT_SHADER,c);e.attachShader(t,n),e.attachShader(t,r),i.linkProgram(e,t);var a=e.getUniformLocation(t,"matrix");if(!a)throw new Error("Unable to get uniform location mattrix");return this._shader={prog:t,unif_matrix:a,attr_position:e.getAttribLocation(t,"position"),attr_normal:e.getAttribLocation(t,"normal")},this._shader}}]),e}();t.FaceDraw=o;var s="\n#ifndef GL_ES\n#define highp\n#define mediump\n#define lowp\n#endif\n\nuniform mat4 matrix;\nattribute vec4 position;\nattribute vec3 normal;\nvarying highp vec3 vnormal;\n\nvoid main()\n{\n    gl_Position = matrix * position;\n    vnormal = normal;\n}",c="\n#define highp mediump\n#ifdef GL_ES\n    // define default precision for float, vec, mat.\n    precision highp float;\n#else\n#define highp\n#define mediump\n#define lowp\n#endif\n\nvarying vec4 skinTexVarying;\nvarying highp vec3 vnormal;\nuniform lowp sampler2D skinSampler;\n\nvoid main()\n{\n    vec3 normal2 = 0.5 * vnormal + 0.5;\n    gl_FragColor = vec4(normal2.x , normal2.y, normal2.z, 1.0);\n}"},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceDrawProject=void 0;var i=n(52),o=function(){function e(t){r(this,e),this._gl=t}return a(e,[{key:"dispose",value:function(){this._vbo&&this._gl.deleteBuffer(this._vbo),this._uvbo&&this._gl.deleteBuffer(this._uvbo),this._ibo&&this._gl.deleteBuffer(this._ibo),this._shader&&this._gl.deleteProgram(this._shader.prog),this._vbo=void 0,this._uvbo=void 0,this._ibo=void 0,this._shader=void 0}},{key:"_generateIBO",value:function(e,t){if(this._ibo&&this._lastIndices===e)return this._ibo;if(this._lastIndices=e,this._ibo||(this._ibo=t.createBuffer()),!this._ibo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._ibo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this._ibo}},{key:"_generateVBO",value:function(e,t){if(this._vbo||(this._vbo=t.createBuffer()),!this._vbo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this._vbo}},{key:"_generateUVBO",value:function(e,t){if(this._uvbo||(this._uvbo=t.createBuffer()),!this._uvbo)throw new Error("Unable to create buffer object");return t.bindBuffer(t.ARRAY_BUFFER,this._uvbo),t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this._uvbo}},{key:"drawFace",value:function(e,t,n,r,a,i){var o=this._gl,s=this._getShader(o),c=this._generateVBO(t,o),u=this._generateUVBO(r,o),l=this._generateIBO(a,o);o.enable(o.DEPTH_TEST),o.enable(o.CULL_FACE),o.useProgram(s.prog),o.uniformMatrix4fv(s.unif_matrix,!1,e),o.uniformMatrix4fv(s.unif_uvmatrix,!1,n),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,i),o.uniform1i(s.unif_sampler,0),o.bindBuffer(o.ARRAY_BUFFER,c),o.vertexAttribPointer(s.attr_position,3,o.FLOAT,!1,12,0),o.enableVertexAttribArray(s.attr_position),o.bindBuffer(o.ARRAY_BUFFER,u),o.vertexAttribPointer(s.attr_uv,3,o.FLOAT,!1,12,0),o.enableVertexAttribArray(s.attr_uv),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l),o.drawElements(o.TRIANGLES,6912,o.UNSIGNED_SHORT,0),o.disableVertexAttribArray(s.attr_position),o.disableVertexAttribArray(s.attr_uv),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null)}},{key:"_getShader",value:function(e){if(this._shader)return this._shader;var t=e.createProgram();if(!t)throw new Error("Unable to create program");var n=i.compileShader(e,e.VERTEX_SHADER,s),r=i.compileShader(e,e.FRAGMENT_SHADER,c);e.attachShader(t,n),e.attachShader(t,r),i.linkProgram(e,t);var a=e.getUniformLocation(t,"matrix");if(!a)throw new Error("Unable to get uniform location matrix");var o=e.getUniformLocation(t,"uvmatrix");if(!o)throw new Error("Unable to get uniform location matrix");var u=e.getUniformLocation(t,"uSampler");if(!u)throw new Error("Unable to get uniform location sampler");return this._shader={prog:t,unif_matrix:a,unif_sampler:u,unif_uvmatrix:o,attr_position:e.getAttribLocation(t,"position"),attr_uv:e.getAttribLocation(t,"uv"),attr_texturecoord:e.getAttribLocation(t,"aTextureCoord")},this._shader}}]),e}();t.FaceDrawProject=o;var s="\n#ifndef GL_ES\n#define highp\n#define mediump\n#define lowp\n#endif\n\nuniform mat4 matrix;\nuniform mat4 uvmatrix;\nattribute vec4 position;\nattribute vec3 normal;\nattribute vec3 uv;\n\n// varying highp vec3 vnormal;\n\nvarying highp vec2 vTextureCoord;\nvarying highp float vAlpha;\n\nvoid main()\n{\n    gl_Position = matrix * position;\n    vec4 ret = uvmatrix * vec4(uv.x, uv.y, uv.z, 1.0);\n    ret.x /= ret.w * 2.0;\n    ret.y /= ret.w * 2.0;\n    ret.x += 0.5;\n    ret.y += 0.0;\n    vAlpha = 1.0;\n    vTextureCoord = ret.xy;\n}",c="\n#define highp mediump\n#ifdef GL_ES\n    // define default precision for float, vec, mat.\n    precision highp float;\n#else\n#define highp\n#define mediump\n#define lowp\n#endif\n\nvarying highp vec2 vTextureCoord;\nvarying highp vec3 vnormal;\nvarying highp float vAlpha;\nuniform lowp sampler2D uSampler;\n\nvoid main()\n{\n    // vec3 normal2 = 0.5 * vnormal + 0.5;\n    vec4 p = texture2D(uSampler, vTextureCoord);\n    p.a = vAlpha;\n    gl_FragColor = p; // vec4(normal2.x , normal2.y, normal2.z, 1.0);\n}"},function(e,t,n){"use strict";var r=n(17),a=n(19).default,i=n(20).default,o=n(43).default,s=n(38).default,c=n(29).default,u=n(30).default,l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSource=void 0;var g=n(83),d=n(84),I=n(72),A=n(71),h=n(46),C=1,f=new Map,p=document.createElement("video");p.setAttribute("playsinline",""),p.setAttribute("webkit-playsinline",""),d.profile.videoElementInDOM&&(p.style.width="0px",p.style.height="0px",document.body.appendChild(p));var m=function(e){c(n,e);var t=u(n);function n(e,r,i){var o;return a(this,n),(o=t.call(this,p,r))._impl=e,o._deviceId=i,o._currentStream=null,o._activeDeviceId=null,o._hasStartedOrientation=!1,o._deviceMotionListener=function(e){var t=I.Pipeline.get(o._pipeline);if(t){var n=void 0!==e.timeStamp&&null!==e.timeStamp?e.timeStamp:performance.now();null!==e.accelerationIncludingGravity&&null!==e.accelerationIncludingGravity.x&&null!==e.accelerationIncludingGravity.y&&null!==e.accelerationIncludingGravity.z&&t.motionAccelerometerSubmit(n,e.accelerationIncludingGravity.x*d.profile.deviceMotionMutliplier,e.accelerationIncludingGravity.y*d.profile.deviceMotionMutliplier,e.accelerationIncludingGravity.z*d.profile.deviceMotionMutliplier),null===e.rotationRate||null===e.rotationRate.alpha||null===e.rotationRate.beta||null===e.rotationRate.gamma||o._hasStartedOrientation?o._hasStartedOrientation||o._startDeviceOrientation():(e.timeStamp,t.motionRotationRateSubmit(n,e.rotationRate.alpha*Math.PI/-180,e.rotationRate.beta*Math.PI/-180,e.rotationRate.gamma*Math.PI/-180))}},o}return i(n,[{key:"destroy",value:function(){f.delete(this._impl),o(s(n.prototype),"destroy",this).call(this)}},{key:"_stop",value:function(){this._currentStream&&(this._currentStream.getTracks().forEach((function(e){return e.stop()})),this._currentStream=null)}},{key:"pause",value:function(){o(s(n.prototype),"pause",this).call(this),this._stopDeviceMotion(),this._syncCamera()}},{key:"start",value:function(){o(s(n.prototype),"start",this).call(this),this._startDeviceMotion(),this._syncCamera()}},{key:"_getConstraints",value:function(){return l(this,void 0,void 0,r.mark((function e(){var t,a,i,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._deviceId!==n.DEFAULT_DEVICE_ID&&this._deviceId!==n.USER_DEFAULT_DEVICE_ID?t=this._deviceId:a=this._deviceId===n.DEFAULT_DEVICE_ID?"environment":"user",i={audio:!1,video:{facingMode:a,width:d.profile.videoWidth,height:d.profile.videoHeight,frameRate:d.profile.requestHighFrameRate?60:void 0,deviceId:t}},!t){e.next=4;break}return e.abrupt("return",i);case 4:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=6;break}return e.abrupt("return",i);case 6:return e.next=8,navigator.mediaDevices.enumerateDevices();case 8:if(o=e.sent,s=!1,o=o.filter((function(e){if("videoinput"!==e.kind)return!1;if(e.getCapabilities){s=!0;var t=e.getCapabilities();if(t&&t.facingMode&&t.facingMode.indexOf("user"===a?"user":"environment")<0)return!1}return!0})),s&&0!==o.length){e.next=13;break}return e.abrupt("return",i);case 13:return"object"===typeof i.video&&(h.zcout("choosing device ID",o[o.length-1].deviceId),i.video.deviceId=o[o.length-1].deviceId),e.abrupt("return",i);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"getFrame",value:function(e){return this._cameraToScreenRotation=A.cameraRotationForScreenOrientation(!1),o(s(n.prototype),"getFrame",this).call(this,e)}},{key:"_getUserMedia",value:function(){return l(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getConstraints();case 2:if(t=e.sent,!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){e.next=7;break}return e.next=6,navigator.mediaDevices.getUserMedia(t);case 6:case 9:return e.abrupt("return",e.sent);case 7:return e.next=9,new Promise((function(e,n){navigator.getUserMedia(t,e,n)}));case 10:case"end":return e.stop()}}),e,this)})))}},{key:"_syncCamera",value:function(){return l(this,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._currentStream||!this._isPaused){e.next=3;break}return this._stop(),e.abrupt("return");case 3:if(this._currentStream&&this._activeDeviceId!==this._deviceId&&this._stop(),this._isPaused){e.next=22;break}return this._activeDeviceId=this._deviceId,e.next=8,this._getUserMedia();case 8:if(this._currentStream=e.sent,!this._isPaused){e.next=13;break}return e.next=12,this._syncCamera();case 12:return e.abrupt("return");case 13:if(this._isUserFacing=!1,this._currentStream&&(t=this._currentStream.getVideoTracks()).length>0&&(this._isUserFacing="user"===t[0].getSettings().facingMode),this._video instanceof HTMLVideoElement){e.next=17;break}return e.abrupt("return");case 17:this._video.src="",this._video.loop=!1,this._video.muted=!0,this._video.srcObject=this._currentStream,this._video.play();case 22:case"end":return e.stop()}}),e,this)})))}},{key:"_startDeviceOrientation",value:function(){var e=this;this._hasStartedOrientation||(this._hasStartedOrientation=!0,window.addEventListener("deviceorientation",(function(t){var n=I.Pipeline.get(e._pipeline);if(n){var r=void 0!==t.timeStamp&&null!==t.timeStamp?t.timeStamp:performance.now();null!==t.alpha&&null!==t.beta&&null!==t.gamma&&n.motionAttitudeSubmit(r,t.alpha,t.beta,t.gamma)}})))}},{key:"_startDeviceMotion",value:function(){window.addEventListener("devicemotion",this._deviceMotionListener,!1)}},{key:"_stopDeviceMotion",value:function(){window.removeEventListener("devicemotion",this._deviceMotionListener)}}],[{key:"create",value:function(e,t){var r=C++;return f.set(r,new n(r,e,t)),h.zcout("camera_source_t initialized"),r}},{key:"get",value:function(e){return f.get(e)}}]),n}(g.HTMLElementSource);t.CameraSource=m,m.USER_DEFAULT_DEVICE_ID="Simulated User Default Device ID: a908df7f-5661-4d20-b227-a1c15d2fdb4b",m.DEFAULT_DEVICE_ID="Simulated Default Device ID: a908df7f-5661-4d20-b227-a1c15d2fdb4b"},function(e,t,n){"use strict";var r=n(20).default,a=n(19).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Source=void 0;var i=r((function e(){a(this,e)}));t.Source=i},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.GLStateManager=void 0;var i=new Map,o=function(){function e(t){var n=this;r(this,e),this._gl=t,this._viewports=[],this._underlyingViewport=this._gl.viewport,this._viewports.push(this._gl.getParameter(this._gl.VIEWPORT)),this._gl.viewport=function(e,t,r,a){n._viewports[n._viewports.length-1]=[e,t,r,a],n._underlyingViewport.call(n._gl,e,t,r,a)}}return a(e,[{key:"push",value:function(){this._viewports.push(this._viewports[this._viewports.length-1])}},{key:"pop",value:function(){var e=this._viewports.pop(),t=this._viewports[this._viewports.length-1];e&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]||this._underlyingViewport.call(this._gl,t[0],t[1],t[2],t[3])}}],[{key:"get",value:function(t){var n=i.get(t);return n||(n=new e(t),i.set(t,n)),n}}]),e}();t.GLStateManager=o},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceLandmark=t.getFaceLandmark=t.destroyFaceLandmark=t.createFaceLandmark=void 0;var i=n(36),o=n(139),s=n(46),c=1,u=new Map;t.createFaceLandmark=function(e){var t=c++;return u.set(t,new l(e)),s.zcout("face_landmark_t initialized"),t},t.destroyFaceLandmark=function(e){u.delete(e)},t.getFaceLandmark=function(e){return u.get(e)};var l=function(){function e(t){r(this,e),this._name=t,this.anchor_pose=i.mat4.create()}return a(e,[{key:"_getVertex",value:function(e,t,n){for(var r=n.mean.slice(),a=0;a<50;a++)r[0]+=e[a]*n.identity[3*a+0],r[1]+=e[a]*n.identity[3*a+1],r[2]+=e[a]*n.identity[3*a+2];for(var i=0;i<29;i++)r[0]+=t[i]*n.expression[3*i+0],r[1]+=t[i]*n.expression[3*i+1],r[2]+=t[i]*n.expression[3*i+2];return r}},{key:"update",value:function(e,t,n){var r,a=o.landmarkData[this._name.toString()];if(a){if(Array.isArray(a)){r=this._getVertex(e,t,a[0]);var s=this._getVertex(e,t,a[1]);r[0]=.5*(r[0]+s[0]),r[1]=.5*(r[1]+s[1]),r[2]=.5*(r[2]+s[2])}else r=this._getVertex(e,t,a);n&&(r[0]*=-1),i.mat4.fromTranslation(this.anchor_pose,r)}}}]),e}();t.FaceLandmark=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.landmarkData=void 0,t.landmarkData={0:[{mean:[.235,.2344,.7305],identity:[.008,.0087,.0024,-.0026,6e-4,-.0022,5e-4,.0033,.0026,.0017,-.0055,-8e-4,.0011,.0059,0,2e-4,.001,-.001,-.0044,-.0011,-1e-4,.0024,.0019,-9e-4,4e-4,-.0015,0,.0038,.0013,3e-4,.002,-.0021,.0018,.0023,.0011,.0012,-.0011,-.0017,9e-4,-.0012,-8e-4,7e-4,-.0017,.0029,-.0029,8e-4,-.0027,8e-4,-.0017,4e-4,9e-4,-.001,-3e-4,8e-4,-.0016,-3e-4,-7e-4,.0016,-9e-4,.0021,-5e-4,.0011,-.0024,-1e-4,6e-4,1e-4,-.0026,-4e-4,-3e-4,-9e-4,5e-4,3e-4,-8e-4,-.001,-4e-4,-8e-4,.0022,-.0014,-1e-4,-.0023,0,-.0018,7e-4,-.0036,.0017,.0017,-.0018,-2e-4,-4e-4,-9e-4,-8e-4,3e-4,.0012,9e-4,-4e-4,-.0016,5e-4,-.0013,.0011,.0023,.0029,.0024,.0017,-.0027,-4e-4,-.001,-.0018,-.0015,-.001,.001,-.0013,-1e-4,-2e-4,7e-4,3e-4,3e-4,-.0016,9e-4,-.0021,4e-4,.0014,.002,-7e-4,-4e-4,2e-4,-4e-4,-6e-4,-9e-4,.0015,4e-4,-4e-4,5e-4,-.0015,9e-4,3e-4,3e-4,-2e-4,-8e-4,-9e-4,.0023,4e-4,1e-4,-4e-4,-1e-4,7e-4,2e-4,.001,1e-4,-.0029,-5e-4],expression:[0,3e-4,.0052,-7e-4,-.0051,-.0103,0,.0019,.0027,-.0054,.0135,.035,-5e-4,-6e-4,.0025,-.0045,-.0557,-.003,-.0191,-.1199,.0548,-.0036,-.0682,-.0167,2e-4,-.0085,-.0085,.0044,.0041,-.0568,.0044,.179,.0065,-.0017,-.1006,.0036,-.0267,-.3279,.0301,-.0011,-.0173,-.001,.0046,.2808,.0207,.0162,.238,-.0225,.0017,.1041,.0203,5e-4,.0161,.0031,-.0436,.6504,.0873,-.0099,.1039,.0048,-.0254,.2534,-.0042,.003,-.0106,-.0153,-.0118,.0252,9e-4,-.0071,.0099,.007,-.0724,.0461,-.0235,.0833,.004,.0141,-.0219,.0132,-.0042,-.0179,.0045,-.0215,.3638,.0054,-.0445]},{mean:[.2358,.1466,.7183],identity:[.0077,.0093,1e-4,-.0022,0,-.0041,5e-4,.0022,.0028,.0018,-.0038,-.0013,.001,.0044,-2e-4,0,.0017,-.0016,-.0043,-2e-4,-1e-4,.0023,9e-4,5e-4,-7e-4,-4e-4,-.0017,.003,7e-4,6e-4,.0011,-.0018,5e-4,.0018,-8e-4,4e-4,-.0023,-6e-4,-3e-4,-.0015,-.0014,-1e-4,-.0018,.0027,-.0026,3e-4,-.0031,.0011,-.0026,-.0011,.0012,-.0013,-2e-4,7e-4,-.0021,.0021,4e-4,.0012,-.001,.002,-3e-4,2e-4,-.0026,-3e-4,.001,1e-4,-.0018,-.001,9e-4,-.0011,.001,4e-4,-8e-4,-7e-4,-.001,-3e-4,7e-4,-5e-4,-6e-4,-.0019,-5e-4,-.002,7e-4,-.0027,.0014,.0013,6e-4,-5e-4,-3e-4,-3e-4,-.001,0,.0019,1e-4,6e-4,-.0012,4e-4,-9e-4,4e-4,.0025,3e-4,.0024,.0017,-9e-4,-.0015,-.0015,-.001,-.0023,-.001,-5e-4,-4e-4,8e-4,9e-4,7e-4,2e-4,7e-4,-9e-4,9e-4,-.0013,1e-4,9e-4,2e-4,6e-4,-6e-4,-8e-4,-4e-4,-7e-4,8e-4,.0019,3e-4,.0015,2e-4,-.0015,-3e-4,0,6e-4,3e-4,6e-4,-6e-4,2e-4,5e-4,-4e-4,.0012,-4e-4,2e-4,-8e-4,6e-4,-4e-4,2e-4,-.0021],expression:[-.0034,.0054,.0069,.004,6e-4,-.0104,-3e-4,.0036,.0025,.0065,.0296,.0208,-9e-4,.0154,.0029,-.0167,.0124,.004,-.0102,.0351,.028,-.019,.0146,-.0035,-.0023,-.0069,-.0051,-.01,.0262,-.028,.0112,.082,.023,-.0019,-.066,-.0104,-.0408,.0164,.0075,-.0074,.0367,.0041,.0517,-.0207,.0045,.0291,-.0672,-.0129,.0345,-.1558,-.0106,.0037,-.0437,-.0021,.0854,-.1121,.0187,.0041,.0072,.0011,.0193,-.0143,-.0119,.005,-.02,-.0122,-.008,.0527,.0036,-.006,.0222,.007,-.0429,.046,-.0046,.0226,-.0059,.0202,-.0173,.0087,0,-.0067,-.0095,-.0153,.1506,-.0017,.0021]}],1:[{mean:[-.2271,.2323,.7319],identity:[-.0084,.0097,.0018,.0041,2e-4,-.002,-.0012,.0036,.0019,-9e-4,-.0063,-.001,-3e-4,.0053,6e-4,1e-4,5e-4,-.0015,.0044,-.0025,-.0015,-.002,.0016,-6e-4,2e-4,-.0013,0,-.0022,2e-4,2e-4,-.0025,-.0014,.0015,8e-4,2e-4,.0012,6e-4,-6e-4,.0017,0,3e-4,-1e-4,.0024,.0025,-.0029,-.0015,-.0015,1e-4,.0031,-.0016,7e-4,.0019,6e-4,.002,9e-4,.001,-.0014,-.002,-.0015,.0029,1e-4,5e-4,-.0023,8e-4,-.0011,.0019,.0017,-3e-4,-.0011,-3e-4,.0011,-8e-4,.0019,-.0022,1e-4,.0015,.0017,-8e-4,-.0011,-.0022,3e-4,.0022,6e-4,-.003,-2e-4,0,-.0017,-2e-4,0,1e-4,4e-4,.0012,.0019,-.0014,4e-4,-.0017,-.0012,-.0011,.0021,-.0029,.0026,.0018,-.0023,-.0029,1e-4,.0014,-.0019,-4e-4,-4e-4,.0023,-.0016,0,-9e-4,.0014,-.0015,.0015,-.0016,-.0011,-.0022,1e-4,-.0018,.0027,-.0013,4e-4,-1e-4,-5e-4,.0011,-2e-4,.0015,5e-4,-9e-4,-1e-4,.0029,6e-4,0,-3e-4,7e-4,-8e-4,-5e-4,.0025,3e-4,2e-4,-8e-4,-1e-4,3e-4,0,.0014,2e-4,-.0024,1e-4],expression:[-.0025,-9e-4,.006,.004,-.0027,-.0113,-8e-4,.001,.0031,-.0016,.0144,.0382,-3e-4,-5e-4,.0035,-.0044,-.0511,-.0014,-7e-4,-.1007,.0582,-6e-4,-.0606,-.0165,5e-4,-.0087,-.0093,.0036,.0057,-.0576,-.0039,.1488,.0127,.0016,-.0666,-9e-4,-.0153,.3162,-.0445,-.0021,.0023,.0043,-.0033,.2382,.0063,-.0217,.167,-.039,.0097,-.1144,-.0189,-.0145,.6831,.0632,-.0012,-.1959,-.0133,4e-4,.1108,-3e-4,.0062,.2593,-.0161,-.0018,-.0051,-.012,.0162,.016,-.0022,-.0052,-.0201,.0101,.0115,.0365,-.024,-.0059,.0188,-.0336,.0352,.0224,-.0229,.0146,.0086,-.0273,-.0032,.0103,-.0112]},{mean:[-.2288,.1541,.7202],identity:[-.0082,.0101,2e-4,.0036,-7e-4,-.0037,-8e-4,.0024,.0022,-.0013,-.0045,-.0013,-6e-4,.0045,-4e-4,4e-4,.0012,-.0014,.0042,-.001,-7e-4,-.0019,3e-4,-2e-4,.0012,-4e-4,-.0012,-.0018,-4e-4,-1e-4,-.0014,-.0012,1e-4,1e-4,-.0017,.001,.0015,-1e-4,6e-4,1e-4,0,-6e-4,.0028,.0021,-.0025,-.002,-.0015,7e-4,.0028,-.0023,9e-4,.0013,1e-4,.0016,.0012,.0032,-6e-4,-.0013,-.0011,.0021,3e-4,-5e-4,-.0024,4e-4,-4e-4,.0014,.0015,-8e-4,-3e-4,3e-4,.0017,-6e-4,.002,-.0018,-3e-4,9e-4,1e-4,2e-4,-6e-4,-.0015,-4e-4,.0022,7e-4,-.0023,0,-2e-4,-2e-4,-3e-4,-1e-4,6e-4,-2e-4,6e-4,.0022,-3e-4,.0013,-.0014,-5e-4,-3e-4,.0013,-.0027,6e-4,.0025,-.0023,-8e-4,-.0013,.0017,-9e-4,-.0019,1e-4,8e-4,-7e-4,-4e-4,0,.001,-.001,.0019,-8e-4,-.0015,-6e-4,-2e-4,-.0011,8e-4,1e-4,9e-4,-8e-4,-4e-4,6e-4,7e-4,.0021,-4e-4,7e-4,-5e-4,.0021,-7e-4,-4e-4,-9e-4,8e-4,3e-4,1e-4,3e-4,1e-4,9e-4,.001,-5e-4,5e-4,-.001,.001,4e-4,-5e-4,-.0012],expression:[8e-4,.0037,.0078,-4e-4,5e-4,-.012,-2e-4,-.0046,.0033,-.0089,.0295,.0221,-.0024,-.0084,.0013,.0057,.0125,.0049,-.0036,.0373,.0285,.0115,.0135,-.0035,.0048,.0108,-.0033,.0106,.0281,-.0301,-.0082,.0803,.0244,-7e-4,-.0725,-.0105,-.0247,-.0036,-.0143,-.0045,-.029,2e-4,-.0303,.0093,-.0021,-.0196,-.0754,-.0211,.0326,.1246,.006,-.0804,-.1499,.0109,.0182,-.0029,-.0014,-.0035,.0072,-8e-4,-.0152,-.0108,-.0166,-.0073,-.0144,-.0095,.0101,.047,-.0018,-.004,-.0189,.0027,.0104,.0298,-.0042,-.0096,.0191,-.0217,.0228,.0226,-.0105,.0047,-.0048,-.0172,.0061,-.0043,-.0016]}],2:{mean:[.5396,.2028,.2496],identity:[.0204,.0146,-.0182,-.0052,.0158,-.0038,-.0025,-.0108,-.006,.0085,-.0044,.0029,.0042,.001,.0095,.0015,-.0034,-.0064,-.0057,7e-4,.0026,7e-4,.0037,-6e-4,.0037,.0026,.0024,5e-4,-.0019,-.0013,.003,-.0028,.0018,-9e-4,.002,-.0047,.004,-.003,.0031,-.0027,-.0026,-.0017,.0016,.0014,-4e-4,.0021,-.002,0,.0017,7e-4,-4e-4,-7e-4,-.0018,-9e-4,2e-4,-.0012,1e-4,-5e-4,-.0011,4e-4,2e-4,.0011,1e-4,8e-4,.0017,-.0013,.0025,.0017,.001,2e-4,3e-4,5e-4,-4e-4,-1e-4,-5e-4,7e-4,-.0022,-.0029,6e-4,-8e-4,-6e-4,6e-4,-5e-4,5e-4,.0013,3e-4,-5e-4,-.003,7e-4,2e-4,.0016,-4e-4,0,0,4e-4,1e-4,.0014,.0012,1e-4,4e-4,-1e-4,8e-4,9e-4,4e-4,-4e-4,9e-4,-2e-4,.001,9e-4,4e-4,1e-4,7e-4,7e-4,.001,-.0017,-8e-4,2e-4,.0017,-3e-4,-1e-4,4e-4,5e-4,7e-4,5e-4,-1e-4,-6e-4,-1e-4,1e-4,-3e-4,-7e-4,-2e-4,-5e-4,0,-3e-4,3e-4,8e-4,-2e-4,-3e-4,5e-4,1e-4,-7e-4,-.001,-2e-4,3e-4,4e-4,-1e-4,7e-4,0,4e-4,4e-4],expression:[1e-4,-4e-4,1e-4,0,5e-4,2e-4,0,0,3e-4,-2e-4,3e-4,5e-4,-1e-4,2e-4,8e-4,1e-4,-2e-4,-5e-4,-3e-4,6e-4,5e-4,0,1e-4,2e-4,1e-4,-1e-4,-6e-4,-2e-4,5e-4,0,-4e-4,4e-4,.0016,4e-4,-4e-4,-.0015,0,1e-4,1e-4,-3e-4,3e-4,.0019,-2e-4,7e-4,4e-4,4e-4,-8e-4,-.0015,.0013,-.0016,-.0069,4e-4,-6e-4,-.0019,0,-1e-4,5e-4,-3e-4,2e-4,.0014,-3e-4,6e-4,.0011,4e-4,-3e-4,-.0032,-6e-4,8e-4,.0025,-3e-4,3e-4,.0015,-1e-4,1e-4,3e-4,-1e-4,0,0,-3e-4,4e-4,.0019,1e-4,0,-8e-4,-1e-4,1e-4,5e-4]},3:{mean:[-.5464,.2141,.26],identity:[-.0207,.0172,-.0176,.0068,.0148,-.0051,.0042,-.0101,-.0058,-.0087,-.0059,.0045,-.0056,.0017,.0097,-.0048,-.004,-.0044,.0019,2e-4,.0041,-.0052,.0041,2e-4,-.0027,6e-4,.002,-.0027,-.0033,-6e-4,-.004,9e-4,-.0012,-1e-4,-.0026,.0021,-.003,-.0025,.0052,.0025,.0022,-1e-4,-8e-4,.0013,.001,4e-4,.0018,.0014,6e-4,-5e-4,-.0015,-.0039,.0014,-1e-4,8e-4,-2e-4,6e-4,-5e-4,-.0038,-.0012,-.0018,-3e-4,.001,9e-4,.0012,.0024,-.0024,-7e-4,-.0016,-.0016,3e-4,-.001,-.0014,-.0014,.001,-3e-4,-7e-4,-.0012,3e-4,6e-4,3e-4,-5e-4,3e-4,.0012,6e-4,-8e-4,4e-4,4e-4,8e-4,-2e-4,-.0014,3e-4,0,.0023,-3e-4,-.0012,-.0013,.0011,-2e-4,-.0014,-1e-4,.0014,0,3e-4,3e-4,-8e-4,-5e-4,-7e-4,-7e-4,-2e-4,3e-4,5e-4,2e-4,-1e-4,.0011,-.0014,1e-4,-.0015,-1e-4,-3e-4,0,-.001,-1e-4,-8e-4,8e-4,-8e-4,-2e-4,-.0011,-3e-4,-4e-4,1e-4,-2e-4,3e-4,-7e-4,0,3e-4,1e-4,-8e-4,5e-4,1e-4,4e-4,.0014,-6e-4,-.001,-3e-4,-2e-4,1e-4,-1e-4,-1e-4,7e-4],expression:[-3e-4,-1e-4,6e-4,4e-4,0,-7e-4,0,-3e-4,-2e-4,-4e-4,.0012,8e-4,1e-4,-5e-4,-7e-4,-4e-4,0,1e-4,-4e-4,.0017,7e-4,0,1e-4,3e-4,0,4e-4,4e-4,5e-4,1e-4,-.001,-7e-4,.0022,.0026,5e-4,-.0024,-.0023,0,1e-4,3e-4,0,-.0013,-.0015,6e-4,.0014,8e-4,-2e-4,-.0025,-.0023,-3e-4,.0049,.006,-2e-4,-7e-4,-2e-4,0,-.0019,-.0018,-2e-4,.0017,.0017,3e-4,.0015,7e-4,1e-4,-.0023,-.0036,2e-4,.0023,.0017,0,-5e-4,-3e-4,-3e-4,4e-4,2e-4,-1e-4,-3e-4,-5e-4,1e-4,.0018,.0025,1e-4,-6e-4,-.0011,0,1e-4,1e-4]},4:{mean:[.0018,.1864,.853],identity:[-.0011,.0134,.0085,9e-4,-.0025,-7e-4,-3e-4,.0033,4e-4,-5e-4,-.0047,-.002,7e-4,.0026,-.0069,-1e-4,.0036,.0072,5e-4,-8e-4,-.0047,4e-4,-8e-4,-.001,0,2e-4,-.0036,-2e-4,-.001,-.0048,-1e-4,.0018,.0044,-7e-4,-2e-4,.0043,3e-4,.002,-.0031,0,-7e-4,.0013,0,.0037,.0033,-.0016,-.0012,.002,-1e-4,-.0027,.0051,5e-4,8e-4,7e-4,-.0017,.0054,.0023,-3e-4,.0032,1e-4,0,7e-4,-5e-4,-.0011,2e-4,8e-4,0,-.0033,-8e-4,-7e-4,7e-4,.0033,5e-4,-3e-4,.0029,-1e-4,-.0024,-.0011,-.002,-.0015,-.0019,2e-4,7e-4,.0031,6e-4,.0012,0,0,-.0021,0,-9e-4,-.0011,-.0011,-2e-4,.0015,.001,.0013,8e-4,.001,-3e-4,9e-4,.0027,-2e-4,-.0011,-.0011,6e-4,7e-4,2e-4,1e-4,-5e-4,-.0022,.0011,-.0014,9e-4,3e-4,2e-4,0,-6e-4,-4e-4,-.0011,-7e-4,.001,-.0012,6e-4,-.0012,-.0015,3e-4,-9e-4,-.0013,-.0013,7e-4,.001,-.0011,-.0013,.0015,4e-4,1e-4,4e-4,-1e-4,-.0016,-.0016,9e-4,-7e-4,-.0024,5e-4,-1e-4,-.0017,-2e-4,3e-4,-9e-4],expression:[-.0017,.0019,.0097,.003,-.0103,-.0093,9e-4,6e-4,.0023,-.0017,-.0204,.0376,.0033,-.0034,.0033,-.0026,-.0322,.0396,-.0032,-.0947,.0942,-7e-4,-.0175,.0266,-.001,-6e-4,.0016,.0025,.0157,-.0142,-.0022,.037,.015,.0021,-.0102,-.0107,.0036,.0055,-.0051,.0021,3e-4,-3e-4,4e-4,-.0177,.0074,-6e-4,-.0357,.0149,-.0066,9e-4,.0013,-.0031,.0016,.0095,.002,.0052,.0035,-3e-4,.0053,-.0082,.002,.0022,-.0071,-.0011,5e-4,.0055,.0011,3e-4,-.0126,-4e-4,3e-4,-.0023,-.0015,.0059,.0063,-.0042,-.0023,.0055,.0019,.0017,-.0075,6e-4,-8e-4,.0018,.0012,.0012,-5e-4]},5:{mean:[-.002,-.0469,1.0039],identity:[-.0017,.0018,.0156,6e-4,-.0038,5e-4,4e-4,.0013,.002,-4e-4,-.0015,-.0051,5e-4,-7e-4,-.0055,-1e-4,-9e-4,.008,-2e-4,.0036,-.0053,4e-4,-.0026,-.0016,7e-4,9e-4,-.009,-3e-4,7e-4,-.0084,.0015,.0021,.0032,-.0015,.0018,.0046,-3e-4,-4e-4,-1e-4,8e-4,-.0044,-7e-4,-8e-4,7e-4,.0048,-.0024,-3e-4,.0024,2e-4,-.0051,.0058,-6e-4,.0028,.0018,-.0021,.0035,.0057,.0011,.0065,0,-2e-4,.0011,.003,-.0027,8e-4,7e-4,3e-4,-.0039,-.002,-2e-4,-.0015,.0034,.0012,-.0025,.0024,-2e-4,4e-4,-.0042,-.0024,-.001,-.0023,.0016,-7e-4,.0039,1e-4,-5e-4,.0018,3e-4,-2e-4,-9e-4,-.0015,3e-4,-7e-4,-1e-4,-2e-4,.0023,.0032,.002,-.0013,.0013,-.0038,.0045,1e-4,-.0031,1e-4,.0019,-1e-4,.0016,.0013,0,-.002,.0023,2e-4,.0011,.0018,-.0024,6e-4,-.0017,.002,-8e-4,-.0021,7e-4,.0011,8e-4,4e-4,-.001,.0012,2e-4,-6e-4,-.0027,-5e-4,.001,-9e-4,1e-4,-1e-4,8e-4,-.0011,.0022,-.001,-5e-4,-.0011,.0016,-.0015,8e-4,-3e-4,9e-4,.0013,-7e-4,-7e-4,-2e-4],expression:[-.0018,-.0168,.0088,.0389,.1026,.0414,.2201,-.0262,-.0016,-.0017,.0612,-.0298,-.0323,.0093,.0013,-.005,.2207,.1315,-4e-4,.0858,-.0303,-.0133,.015,-.008,.1454,.0114,.0177,-.0077,.1022,.0356,-.0023,.1088,.0232,.003,-.0706,.0347,-1e-4,.004,-.0011,.0397,-.0096,-.0033,.0029,-.01,-.0083,-6e-4,-.0135,.0016,-.0087,-.0019,.0022,-.004,-.0087,.0105,8e-4,-.005,.0069,.0028,.0409,-.0391,.003,.0103,.0051,.0026,.0776,-.0083,-.0062,-.0567,.0268,.0175,.0017,.0156,-.0043,.0299,-.0395,-.0015,.0051,-.0148,.0125,.0035,.0603,.0109,-.0645,-.0257,.002,6e-4,-8e-4]},6:{mean:[-6e-4,-.1542,.8789],identity:[-7e-4,-.0032,.01,0,-.0027,.0031,6e-4,5e-4,-6e-4,-3e-4,.0013,-.0049,-2e-4,-.002,-.0046,8e-4,-.0011,.0054,2e-4,.0043,-.0027,3e-4,-.0022,-.0019,8e-4,.0032,-.0069,0,4e-4,-.0071,.0016,.0027,.0039,-.0017,9e-4,.0031,-1e-4,-5e-4,-4e-4,7e-4,-.0026,-.0012,-5e-4,6e-4,2e-4,-.0014,-.0013,.0019,-2e-4,-.0053,.0031,-6e-4,.0016,.0023,-.0013,.0021,.0029,8e-4,.0052,0,4e-4,0,.0037,-.0026,3e-4,.002,-2e-4,-.0024,4e-4,-4e-4,-.0012,8e-4,7e-4,-.0023,5e-4,0,.0014,-.0022,-.0016,0,-.0012,8e-4,-7e-4,.0014,-6e-4,-.0012,-3e-4,2e-4,.0012,-3e-4,-.002,-1e-4,1e-4,-2e-4,-.0016,9e-4,.002,.0019,0,6e-4,-.0022,.0016,1e-4,-.0017,-.0013,.001,9e-4,-1e-4,.0011,3e-4,-7e-4,.0014,8e-4,.0013,.0011,-.002,0,-.0015,.0014,.001,-.0015,7e-4,3e-4,.001,-1e-4,.0012,7e-4,6e-4,-4e-4,-.0013,-.0012,-9e-4,-.0011,2e-4,-5e-4,5e-4,4e-4,2e-4,1e-4,0,5e-4,5e-4,-.0014,.0015,-9e-4,5e-4,.0014,-8e-4,-8e-4,.0012],expression:[8e-4,.0481,.1653,.0784,.1008,-.3992,.5088,-.02,.0542,.001,.3723,-.0151,-.0986,.0283,-.0033,-.0121,.2634,.1202,.0036,-.0529,-.0245,-.0297,-.1085,.0495,.3264,.0083,4e-4,-.0314,.1459,-.1142,-.003,1e-4,.1154,-.0035,-.0285,-.0184,-1e-4,.0012,.0035,.079,-.0103,.0043,.011,-.004,-.0774,-.0047,-.023,.0284,-.0048,-.001,.0149,-.0039,.0046,.0528,-6e-4,.0063,.0376,.0096,.0558,-.0295,0,-.0311,-.0634,.0062,.0176,-.0154,-.0109,-.1149,.0192,.0326,.0121,.0237,.0034,.0262,-.0778,.0014,-.0045,-.0203,.0077,.0588,.0575,.008,-.0557,-.0095,.0032,.0054,-.0042]},7:{mean:[.0038,-.2927,.833],identity:[6e-4,-.0109,.0073,-6e-4,-.0044,.0017,-1e-4,-.0022,-6e-4,-3e-4,.0065,-.0014,-6e-4,-.0051,-.0046,3e-4,-.0029,.003,2e-4,.0038,-6e-4,0,-.0012,6e-4,-4e-4,.0053,-.0075,-2e-4,-7e-4,-.0063,.0014,.0026,.0019,-.0022,.0018,.0028,-1e-4,-.0012,.0011,9e-4,.0019,-.0019,-1e-4,.0012,-.0022,-3e-4,-.0012,4e-4,-8e-4,3e-4,-3e-4,0,.0017,.0021,-4e-4,.0012,.0022,-3e-4,.0026,-3e-4,4e-4,-.0026,.0032,-.0019,3e-4,.0015,1e-4,-.0015,.0013,-1e-4,1e-4,-.0029,0,-2e-4,-.0028,-7e-4,.0019,-3e-4,-2e-4,.0012,9e-4,4e-4,-.001,-.002,-.0016,.0011,-1e-4,3e-4,.0021,2e-4,-.0014,-9e-4,-1e-4,0,-2e-4,-.001,.0015,.0018,1e-4,7e-4,8e-4,.0017,.001,-9e-4,1e-4,4e-4,.0023,-1e-4,.0012,1e-4,-8e-4,2e-4,.0018,6e-4,3e-4,1e-4,.0012,-3e-4,.002,-6e-4,0,-1e-4,-.0022,4e-4,5e-4,.0011,2e-4,-.0013,-.0023,6e-4,6e-4,-5e-4,-5e-4,9e-4,2e-4,2e-4,.0011,-3e-4,.0011,.0015,.0011,3e-4,2e-4,8e-4,-4e-4,-8e-4,3e-4,0,.0012,-1e-4],expression:[.026,.1107,.3257,.1917,.3206,-1.1348,1.0791,-.035,.1549,-.0103,.6953,1e-4,-.3262,.068,.0219,-.0044,.3643,.2178,.0168,-.2478,-.1321,-.0414,-.3782,-.0617,.5088,-.0031,-.0311,-.0497,.0948,-.385,.0148,-.2224,-.1415,-.0074,.0863,-.203,3e-4,-.0081,.0057,.1164,-.0039,.0015,-.0024,.0505,.1532,.0039,-.0148,-.0753,.0163,.0058,-.0339,.0036,.0252,-.0569,-.0041,.0163,-.0361,.0035,-.018,.1266,0,-.0163,-.0046,.0133,-.1656,.2134,.0191,.0057,.0734,.0681,.0039,-.0144,.029,-.074,-.046,.0122,.0072,-.0162,-.0349,-.1234,.0212,-.0355,.0535,.1218,.0043,-.024,.0016]},8:{mean:[-.0018,-.3037,.8491],identity:[2e-4,-.0112,.0077,-4e-4,-.0044,.0024,1e-4,-.0021,-4e-4,-4e-4,.0066,-.002,-4e-4,-.0052,-.0044,3e-4,-.0032,.0039,4e-4,.0042,-3e-4,2e-4,-.0012,-2e-4,-2e-4,.0052,-.0083,-1e-4,-8e-4,-.0056,.0017,.0024,.0019,-.0023,.002,.0027,-2e-4,-.0013,.002,9e-4,.0017,-.0028,-2e-4,.0012,-.0026,0,-.0016,2e-4,-5e-4,3e-4,-.001,-1e-4,.0016,.0016,-3e-4,.0012,.0012,-3e-4,.0027,-3e-4,3e-4,-.0026,.0037,-.0017,1e-4,.0016,1e-4,-.0015,.0024,1e-4,2e-4,-.0039,0,-3e-4,-.0033,-6e-4,.0017,-4e-4,-4e-4,.0012,.0018,2e-4,-.0012,-.002,-.0017,.0013,-.001,3e-4,.0021,4e-4,-.0012,-6e-4,-2e-4,0,-4e-4,-9e-4,.0016,.0017,4e-4,7e-4,7e-4,.001,9e-4,-8e-4,5e-4,5e-4,.0023,.001,.0013,2e-4,-4e-4,2e-4,.0017,8e-4,3e-4,-1e-4,9e-4,-4e-4,.0019,-5e-4,3e-4,0,-.0025,3e-4,3e-4,.0011,1e-4,-.0015,-.001,7e-4,7e-4,-7e-4,-7e-4,8e-4,0,1e-4,.0013,-4e-4,.0012,.0014,.0017,4e-4,2e-4,3e-4,-3e-4,-9e-4,1e-4,0,.001,-4e-4],expression:[-.0092,2.8809,1.416,.2018,1.1982,-.9351,1.4492,-.1902,.1749,.0305,-.167,-.1572,-.7354,-.0492,.0115,.0608,.2971,.1179,.0046,-.0997,-.0041,-.0104,.3379,-.1854,.009,.0366,-.0583,.0269,-.0029,-.4175,-8e-4,.1794,.0752,-.0135,.1158,.1234,5e-4,.003,-.0032,.1034,-.0504,-.0055,-.0076,-.0772,.224,.0047,.0229,-.1044,.0162,-.0161,-.0241,-.0083,-.1388,-.0434,-.0125,-.0997,-.0327,-.0111,.1576,-.3911,.0199,.2522,.142,.0059,-.0721,-.0045,.031,-.1136,-.1685,.0641,.0142,.0312,.0426,-.1366,.1011,.0101,-.0157,.0018,-.0103,-.0344,.0907,.0016,.1168,-.0806,.0104,-.0057,.0111]},9:[{mean:[.0038,-.2927,.833],identity:[6e-4,-.0109,.0073,-6e-4,-.0044,.0017,-1e-4,-.0022,-6e-4,-3e-4,.0065,-.0014,-6e-4,-.0051,-.0046,3e-4,-.0029,.003,2e-4,.0038,-6e-4,0,-.0012,6e-4,-4e-4,.0053,-.0075,-2e-4,-7e-4,-.0063,.0014,.0026,.0019,-.0022,.0018,.0028,-1e-4,-.0012,.0011,9e-4,.0019,-.0019,-1e-4,.0012,-.0022,-3e-4,-.0012,4e-4,-8e-4,3e-4,-3e-4,0,.0017,.0021,-4e-4,.0012,.0022,-3e-4,.0026,-3e-4,4e-4,-.0026,.0032,-.0019,3e-4,.0015,1e-4,-.0015,.0013,-1e-4,1e-4,-.0029,0,-2e-4,-.0028,-7e-4,.0019,-3e-4,-2e-4,.0012,9e-4,4e-4,-.001,-.002,-.0016,.0011,-1e-4,3e-4,.0021,2e-4,-.0014,-9e-4,-1e-4,0,-2e-4,-.001,.0015,.0018,1e-4,7e-4,8e-4,.0017,.001,-9e-4,1e-4,4e-4,.0023,-1e-4,.0012,1e-4,-8e-4,2e-4,.0018,6e-4,3e-4,1e-4,.0012,-3e-4,.002,-6e-4,0,-1e-4,-.0022,4e-4,5e-4,.0011,2e-4,-.0013,-.0023,6e-4,6e-4,-5e-4,-5e-4,9e-4,2e-4,2e-4,.0011,-3e-4,.0011,.0015,.0011,3e-4,2e-4,8e-4,-4e-4,-8e-4,3e-4,0,.0012,-1e-4],expression:[.026,.1107,.3257,.1917,.3206,-1.1348,1.0791,-.035,.1549,-.0103,.6953,1e-4,-.3262,.068,.0219,-.0044,.3643,.2178,.0168,-.2478,-.1321,-.0414,-.3782,-.0617,.5088,-.0031,-.0311,-.0497,.0948,-.385,.0148,-.2224,-.1415,-.0074,.0863,-.203,3e-4,-.0081,.0057,.1164,-.0039,.0015,-.0024,.0505,.1532,.0039,-.0148,-.0753,.0163,.0058,-.0339,.0036,.0252,-.0569,-.0041,.0163,-.0361,.0035,-.018,.1266,0,-.0163,-.0046,.0133,-.1656,.2134,.0191,.0057,.0734,.0681,.0039,-.0144,.029,-.074,-.046,.0122,.0072,-.0162,-.0349,-.1234,.0212,-.0355,.0535,.1218,.0043,-.024,.0016]},{mean:[-.0018,-.3037,.8491],identity:[2e-4,-.0112,.0077,-4e-4,-.0044,.0024,1e-4,-.0021,-4e-4,-4e-4,.0066,-.002,-4e-4,-.0052,-.0044,3e-4,-.0032,.0039,4e-4,.0042,-3e-4,2e-4,-.0012,-2e-4,-2e-4,.0052,-.0083,-1e-4,-8e-4,-.0056,.0017,.0024,.0019,-.0023,.002,.0027,-2e-4,-.0013,.002,9e-4,.0017,-.0028,-2e-4,.0012,-.0026,0,-.0016,2e-4,-5e-4,3e-4,-.001,-1e-4,.0016,.0016,-3e-4,.0012,.0012,-3e-4,.0027,-3e-4,3e-4,-.0026,.0037,-.0017,1e-4,.0016,1e-4,-.0015,.0024,1e-4,2e-4,-.0039,0,-3e-4,-.0033,-6e-4,.0017,-4e-4,-4e-4,.0012,.0018,2e-4,-.0012,-.002,-.0017,.0013,-.001,3e-4,.0021,4e-4,-.0012,-6e-4,-2e-4,0,-4e-4,-9e-4,.0016,.0017,4e-4,7e-4,7e-4,.001,9e-4,-8e-4,5e-4,5e-4,.0023,.001,.0013,2e-4,-4e-4,2e-4,.0017,8e-4,3e-4,-1e-4,9e-4,-4e-4,.0019,-5e-4,3e-4,0,-.0025,3e-4,3e-4,.0011,1e-4,-.0015,-.001,7e-4,7e-4,-7e-4,-7e-4,8e-4,0,1e-4,.0013,-4e-4,.0012,.0014,.0017,4e-4,2e-4,3e-4,-3e-4,-9e-4,1e-4,0,.001,-4e-4],expression:[-.0092,2.8809,1.416,.2018,1.1982,-.9351,1.4492,-.1902,.1749,.0305,-.167,-.1572,-.7354,-.0492,.0115,.0608,.2971,.1179,.0046,-.0997,-.0041,-.0104,.3379,-.1854,.009,.0366,-.0583,.0269,-.0029,-.4175,-8e-4,.1794,.0752,-.0135,.1158,.1234,5e-4,.003,-.0032,.1034,-.0504,-.0055,-.0076,-.0772,.224,.0047,.0229,-.1044,.0162,-.0161,-.0241,-.0083,-.1388,-.0434,-.0125,-.0997,-.0327,-.0111,.1576,-.3911,.0199,.2522,.142,.0059,-.0721,-.0045,.031,-.1136,-.1685,.0641,.0142,.0312,.0426,-.1366,.1011,.0101,-.0157,.0018,-.0103,-.0344,.0907,.0016,.1168,-.0806,.0104,-.0057,.0111]}],10:{mean:[-.007,-.6338,.7695],identity:[1e-4,-.0296,.0089,-6e-4,-.0073,-.0065,-1e-4,-.0029,-.0031,-2e-4,.0128,.0065,0,-.0116,-.014,-1e-4,-.0037,-.0052,-5e-4,.0028,.003,-4e-4,.0041,.0015,6e-4,.0088,-.0076,-.0011,-.0015,-.0073,7e-4,-.0011,.0019,-.0011,-5e-4,.0031,-1e-4,-.0018,9e-4,.0018,.0038,.0068,-4e-4,-1e-4,.0061,.0024,.0024,-.0066,-6e-4,.0051,.0014,.002,.005,-.0035,1e-4,-.0034,-.004,-7e-4,.001,-8e-4,1e-4,-5e-4,-.0021,2e-4,.0045,-.0043,-.0012,-.0024,-.0014,6e-4,.0034,.0027,-8e-4,-.0053,.0014,1e-4,.0013,-.0018,6e-4,-.0015,.0029,-2e-4,-.0035,1e-4,-.002,.0012,.0048,.0011,1e-4,-2e-4,-3e-4,-.0012,.0033,6e-4,.002,-.0033,4e-4,.0028,2e-4,8e-4,-1e-4,-.0018,8e-4,.0017,1e-4,9e-4,8e-4,3e-4,.0019,-.001,.001,-7e-4,-.0013,0,1e-4,.0032,-1e-4,1e-4,.0011,-4e-4,5e-4,-7e-4,.0018,-3e-4,2e-4,7e-4,8e-4,-.0014,7e-4,.0015,-6e-4,-1e-4,-4e-4,.0019,-9e-4,-6e-4,-6e-4,-.0012,2e-4,-.0012,-8e-4,4e-4,6e-4,-.0011,3e-4,9e-4,-4e-4,6e-4,-7e-4,-4e-4],expression:[-.0603,2.0527,1.9014,.1025,.6143,.3804,.7881,-.1023,-.0764,.0454,-.2487,-.5073,-.6704,-.031,-.0181,.0466,.0651,-.0726,-.0033,-.0022,.2944,.0101,.1669,-.5225,-.4685,.0236,.0079,.011,.2173,.4529,.0121,-.2104,-.0673,.0225,-.4023,.0317,-9e-4,.0076,-.0032,.0333,.0523,.0129,-.001,-.0319,-.0139,.0015,-.0044,.0247,-5e-4,.0161,.0061,.0074,.0776,-.0176,.007,.055,-.017,.0052,-.1819,.0294,-.0161,-.0337,.0226,-.008,-.0297,.1967,-.0095,.0383,.2039,.0434,.0271,-.0064,-.0037,-.0294,-.024,.0024,-.0137,-.0209,-.0031,.0628,.1003,-.0126,-.056,-.0097,-.0012,-.0041,.0162]},11:{mean:[.2505,.3833,.7793],identity:[.0098,.012,.0077,-6e-4,-3e-4,0,1e-4,.0082,-7e-4,.0019,-.0036,-.0012,2e-4,.0119,-.0039,.001,1e-4,.0031,-.0036,-.0059,-7e-4,.0026,.0028,-.0011,9e-4,-.0032,8e-4,.0029,.0043,3e-4,.0025,-9e-4,.0047,.0016,.0022,.0018,-.001,.0025,-.003,-.001,.0033,.0034,4e-4,-.0052,.0024,-2e-4,.001,-.0014,-6e-4,.0038,-.0015,-6e-4,-.001,-.0011,-4e-4,-.001,4e-4,-7e-4,.0036,-8e-4,-2e-4,-.0019,5e-4,3e-4,-6e-4,-.0024,-.0017,-.0014,6e-4,-4e-4,-.0031,-.0013,-6e-4,.0042,2e-4,-2e-4,-.002,-3e-4,8e-4,.0018,-5e-4,-6e-4,-2e-4,-6e-4,.0025,.0019,.001,8e-4,-.0015,-.0012,-1e-4,-6e-4,-4e-4,.0023,-.001,6e-4,-2e-4,-.001,0,-9e-4,-.002,-.0011,1e-4,0,-1e-4,5e-4,6e-4,9e-4,-6e-4,5e-4,8e-4,-1e-4,-2e-4,-.0017,-6e-4,-4e-4,4e-4,-6e-4,.0012,4e-4,3e-4,-7e-4,3e-4,-2e-4,6e-4,1e-4,5e-4,-.0019,-6e-4,4e-4,7e-4,-1e-4,1e-4,5e-4,.001,-6e-4,-.002,-7e-4,-5e-4,5e-4,3e-4,7e-4,.0014,0,5e-4,-5e-4,-2e-4,3e-4,-6e-4,-1e-4],expression:[-9e-4,-3e-4,.0032,-.003,-.0034,-.0031,.0014,0,4e-4,-.0139,-.0764,.0275,-.002,-.0089,.0031,-.0503,-.0771,.038,-.1323,-.3523,.1368,-.0474,-.0564,.0296,-.0045,.007,-.0013,.0153,.1259,-.0464,.0866,.2175,-.0786,-.0413,-.1248,.0448,-.1777,-.4607,.1782,-5e-4,-.005,.0016,.0629,.1506,-.0624,.0545,.2576,-.0864,-.0231,-.0552,.0244,-.0136,-.0359,.0169,-.1158,-.2996,.1214,-.0235,-.0354,.0165,-.0745,-.1079,.0475,-.0116,-.0039,.0012,.0013,-.0108,-8e-4,.0044,-.0027,-1e-4,-.0694,.0363,.0071,.1462,-.136,.0047,.009,-.0177,.0038,-.0271,.0118,.0011,-.0399,-.0111,.0123]},12:{mean:[-.2981,.3828,.7563],identity:[-.0116,.014,.0054,.0018,5e-4,0,-4e-4,.0068,-.0013,-.0019,-.0048,-5e-4,5e-4,.0108,-.0036,-.0029,-.0018,.0029,.0043,-.0077,6e-4,-.0017,.002,-.0011,-.0014,-.0035,.0015,-.0024,.0011,4e-4,-.0048,2e-4,.0029,-1e-4,-1e-4,.003,.0019,.0035,-.0016,-4e-4,.0039,.0019,1e-4,-.0064,.004,3e-4,.002,-.0021,.0017,.0011,-.001,.0026,.0025,-5e-4,2e-4,-3e-4,-5e-4,-7e-4,9e-4,-4e-4,-.001,-.0022,.001,9e-4,-.0014,7e-4,.0011,-.001,-5e-4,-8e-4,-.0017,-.0021,9e-4,.0036,5e-4,4e-4,-.0031,6e-4,-.0015,.0027,2e-4,1e-4,-.0011,2e-4,-.0011,-.0018,4e-4,-.0013,-2e-4,7e-4,9e-4,-3e-4,.001,-.0021,8e-4,6e-4,-9e-4,4e-4,-7e-4,8e-4,-.002,-.0013,0,7e-4,-.0012,-1e-4,.0014,.0014,-1e-4,.0013,6e-4,6e-4,-.0014,-.0015,-9e-4,1e-4,1e-4,9e-4,7e-4,0,1e-4,-.001,-4e-4,0,-5e-4,1e-4,-3e-4,4e-4,-5e-4,-1e-4,-.0011,2e-4,0,1e-4,8e-4,8e-4,0,-7e-4,-8e-4,0,2e-4,-1e-4,.001,3e-4,4e-4,-2e-4,0,5e-4,.0018,-1e-4],expression:[0,-4e-4,.0028,.0036,-8e-4,-.0026,-.0015,-8e-4,3e-4,.0075,-.0608,.025,.0019,-.0076,.0033,.0379,-.0437,.0335,.0964,-.2452,.1233,.0368,-.0251,.0253,.0033,.0097,-.0021,-.0095,.1171,-.0475,-.064,.1548,-.0718,.0228,-.0831,.0343,-.1924,.6206,-.2771,.0021,-.0143,.0056,-.0705,.2522,-.1116,-.0692,.4229,-.1592,-.0093,.05,-.0185,.0948,-.3196,.1437,-.0184,.0194,-.0131,.0205,-.0353,.0201,.0676,-.135,.0672,.0137,-.0311,.0118,3e-4,-.0077,-2e-4,-.0151,4e-4,-.0058,.029,-.0139,.0163,.1324,.1819,-.0039,.0406,.0501,.0017,.0331,.0161,.0062,-.0235,-.0446,.0047]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={incompatible:function(){return!("function"===typeof Promise&&"object"===typeof WebAssembly&&(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia))},incompatible_ui:function(){var e=document.createElement("div");e.append(function(){var e=document.createElement("div"),t="a recent web browser";navigator.userAgent.match(/Android/i)?(t="Chrome for Android",window.location.href="googlechrome://navigate?url="+encodeURI(window.location.href),setTimeout((function(){window.location.href="samsunginternet://open?url="+encodeURI(window.location.href)}),2e3)):navigator.userAgent.match(/iPhone|iPod|iPad/i)&&(t="Safari",e.classList.add("zee-launcher-browser-safari")),e.classList.add("zee-launcher-unsupported"),e.innerHTML="\n            <style>.zee-launcher-unsupported {\n               display: flex;\n               flex-direction: column;\n               height: 100%;\n               justify-content: center;\n               position: absolute;\n               width: 100%;\n               height: 100%;\n               top: 0;\n               left: 0;\n               align-items: center;\n               }\n               .zee-launcher-browser-logo {\n               background-image: url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg version='1.1' viewBox='0 0 210 211' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg transform='translate(-82 -146)' fill-rule='nonzero' stroke='%23ffffff' stroke-width='2'%3E%3Cg transform='translate(83 146.5)'%3E%3Cpath d='m55.146 88.785l-32.039-49.472c19.962-24.947 49.904-38.684 80.517-38.81 17.739-0.12642 35.855 4.4246 52.336 13.99 18.2 10.619 32.039 25.874 40.846 43.404l-86.095-4.5511c-24.365-1.4327-47.556 12.347-55.565 35.439zm13.797 16.224c0 19.468 15.684 35.229 35.059 35.229 19.374 0 35.059-15.76 35.059-35.229 0-19.468-15.684-35.229-35.059-35.229-19.374 0-35.059 15.718-35.059 35.229zm132.06-37.588l-58.585 3.034c15.894 18.668 16.145 45.595 2.7678 66.243l-47.01 72.648c19.5 1.0535 39.588-3.2447 57.788-13.864 45.039-26.126 63.282-80.908 45.039-128.06zm-144.93 57.647l-39.126-77.326c-10.694 16.434-16.942 36.156-16.942 57.267 0 52.253 38.078 95.53 87.856 103.2l26.713-52.59c-24.155 4.5511-47.472-8.765-58.501-30.551z'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A\");\n               width: 211px;\n               height: 211px;\n               margin-bottom: 25%;\n               margin-top: -60px;\n               background-repeat: no-repeat;\n               }\n               .zee-launcher-browser-safari .zee-launcher-browser-logo {\n               background-image: url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg version='1.1' viewBox='0 0 211 211' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg transform='translate(-82 -146)' fill-rule='nonzero' stroke='%23ffffff' stroke-width='2'%3E%3Cpath d='m180 251.86c0-4.0385 2.9377-7.855 7.2552-7.855 3.9614 0 7.7448 2.8402 7.7448 7.145 0 4.0385-2.8487 7.855-7.1662 7.855-4.0059 0-7.8338-2.9734-7.8338-7.145zm112-0.35503c0 57.728-46.772 104.5-104.5 104.5s-104.5-46.772-104.5-104.5 46.772-104.5 104.5-104.5 104.5 46.772 104.5 104.5zm-12-1c0-51.649-41.851-93.5-93.5-93.5s-93.5 41.851-93.5 93.5 41.851 93.5 93.5 93.5 93.5-41.851 93.5-93.5zm-30.624 40.983c0 1.5095 5.4495 4.2768 6.8328 5.1154-11.486 17.401-29.26 29.938-49.423 34.928l-1.8444-7.757c-0.12576-1.0482-0.79646-1.174-1.7606-1.174-0.79646 0-1.2576 1.174-1.1737 1.7611l1.8444 7.8828c-5.5753 1.174-11.234 1.7611-16.935 1.7611-15.217 0-30.182-4.2768-43.177-12.202 0.71263-1.174 5.1141-7.5474 5.1141-8.4698 0-0.79666-0.71263-1.5095-1.5091-1.5095-1.6348 0-5.1141 6.9603-6.1621 8.344-17.522-11.615-30.182-29.602-35.044-50.148l8.0066-1.761c0.92222-0.25158 1.1737-0.92246 1.1737-1.7611 0-0.79667-1.1737-1.2579-1.8444-1.174l-7.8389 1.803c-1.048-5.3251-1.6348-10.692-1.6348-16.143 0-15.556 4.4015-30.86 12.66-43.984 1.1737 0.71281 6.749 4.5284 7.6712 4.5284 0.79646 0 1.5091-0.58702 1.5091-1.3837 0-1.6353-6.1621-4.7381-7.5455-5.7024 11.821-17.275 29.805-29.728 50.219-34.34l1.7606 7.757c0.25152 0.92246 0.92222 1.174 1.7606 1.174 0.83838 0 1.2576-1.174 1.1737-1.8449l-1.7606-7.6732c5.1141-0.92246 10.312-1.5095 15.552-1.5095 15.552 0 30.727 4.4026 43.973 12.663-0.79646 1.174-4.5273 6.6249-4.5273 7.5474 0 0.79667 0.58687 1.5095 1.3833 1.5095 1.6348 0 4.7369-6.0379 5.5753-7.4216 17.187 11.615 29.469 29.351 34.248 49.561l-6.4975 1.3837c-1.048 0.25158-1.1737 0.92246-1.1737 1.8449 0 0.79667 1.1737 1.2579 1.7606 1.174l6.6232-1.5095c1.048 5.3251 1.6348 10.776 1.6348 16.227 0 15.221-4.1919 30.189-12.073 43.062-1.1737-0.58702-6.0364-4.0672-6.9586-4.0672-0.8803 0-1.5929 0.71281-1.5929 1.5095zm-14.876-98.483c-5.2178 4.88-53.863 49.48-55.228 51.8l-38.772 64.2c5.0974-4.76 53.863-49.6 55.108-51.72l38.892-64.28z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n               }\n               .zee-launcher-unsupported-message {\n               text-align: center;\n               width: 250px;\n               font-family: sans-serif;\n               color: #ffffff;\n               }\n               .zee-launcher-unsupported-message-copy {\n               border: 1px solid #ffffff;\n               border-radius: 5px;\n               margin-top: 10px;\n               }\n               #zee-launcher-unsupported-message-input {\n               border: none;\n               padding: 10px;\n               border-radius: 0px;\n               border-right: 1px solid #344B60;\n               height: 40px;\n               color: #ffffff;\n               background-color: black;\n               box-sizing: border-box;\n               width: calc(100% - 65px);\n               margin-left: 5px;\n               }\n               #zee-launcher-unsupported-message-button {\n               background: none;\n               border: none;\n               outline: none;\n               text-transform: uppercase;\n               color: #ffffff;\n               height: 40px;\n               display: inline-block;\n               width: 59px;\n               }\n               .zee-launcher-unsupported-message-before-copy {\n               height: 100px;\n               display: flex;\n               flex-direction: column;\n               justify-content: center;\n               margin-top: 20px;\n               }\n               .zee-launcher-unsupported-message-copied .zee-launcher-unsupported-message-before-copy {\n               display: none;\n               }\n               .zee-launcher-unsupported-message-after-copy {\n               display: none;\n               }\n               .zee-launcher-unsupported-message-copied .zee-launcher-unsupported-message-after-copy {\n               height: 100px;\n               display: flex;\n               flex-direction: column;\n               justify-content: center;\n               margin-top: 20px;\n               }\n            </style>\n            <div class=\"zee-launcher-browser-logo\"></div>\n            <div class=\"zee-launcher-unsupported-message\">Open with ".concat(t,' to access this content.</div>\n            <div class="zee-launcher-unsupported-message-before-copy">\n               <div class="zee-launcher-unsupported-message ">Tap below to copy the address for easy pasting into ').concat(t,'.</div>\n               <div class="zee-launcher-unsupported-message-copy"><input id="zee-launcher-unsupported-message-input" type="text/"><button id="zee-launcher-unsupported-message-button">Copy</button></div>\n            </div>\n            <div class="zee-launcher-unsupported-message zee-launcher-unsupported-message-after-copy">COPIED! Now paste into ').concat(t,"'s address bar to experience the content.</div>\n    ");var n=e.querySelector("#zee-launcher-unsupported-message-input")||document.createElement("input");n.value=window.location.href;var r=function(){if(navigator.userAgent.match(/iPhone|iPod|iPad/i)){var t=document.createRange();t.selectNodeContents(n);var r=window.getSelection();if(!r)return;r.removeAllRanges(),r.addRange(t),n.setSelectionRange(0,999999999)}else n.select();document.execCommand("copy"),n.blur(),e.classList.toggle("zee-launcher-unsupported-message-copied",!0)};return(e.querySelector("#zee-launcher-unsupported-message-button")||document.createElement("button")).addEventListener("click",r),n.addEventListener("click",r),e}()),Object.assign(e.style,{position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px",zIndex:1001,backgroundColor:"rgba(0, 0, 0, 0.9)",fontFamily:"sans-serif",color:"white",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),e.classList.add("zee_launcher_compatibility"),document.body.append(e)}}},function(e,t,n){"use strict";n.r(t),t.default=n.p+"f7b62a3a53b5c9b3222ba8dc53cb8b11.zbin"},function(e,t,n){"use strict";n.r(t),t.default=n.p+"482727c0e7dd40d73f5aae47f238ad61.zbin"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.3.16"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.3.17"},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.InstantWorldTracker=void 0;var i=n(51),o=n(33),s=function(){function e(t){var n=this;r(this,e),this._pipeline=t,this.anchor={poseCameraRelative:function(e){return n._anchorPoseCameraRelative(e)},pose:function(e,t){return n._anchorPose(e,t)}},this._z=o.z(),this._impl=this._z.instant_world_tracker_create(this._pipeline._getImpl())}return a(e,[{key:"destroy",value:function(){this._z.instant_world_tracker_destroy(this._impl)}},{key:"_anchorPoseCameraRelative",value:function(e){return this._z.instant_world_tracker_anchor_pose_camera_relative(this._impl,!0===e)}},{key:"_anchorPose",value:function(e,t){return this._z.instant_world_tracker_anchor_pose(this._impl,e,!0===t)}},{key:"enabled",get:function(){return this._z.instant_world_tracker_enabled(this._impl)},set:function(e){this._z.instant_world_tracker_enabled_set(this._impl,e)}},{key:"setAnchorPoseFromCameraOffset",value:function(e,t,n,r){this._z.instant_world_tracker_anchor_pose_set_from_camera_offset(this._impl,e,t,n,r||i.instant_world_tracker_transform_orientation_t.MINUS_Z_AWAY_FROM_USER)}}]),e}();t.InstantWorldTracker=s},function(e,t,n){"use strict";var r=n(50).default,a=n(19).default,i=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.BarcodeFinder=void 0;var o=n(45),s=n(51),c=n(33),u=function(){function e(t){var n=this;a(this,e),this._pipeline=t,this.onDetection=new o.Event1,this._lastDetected=[],this._found=[],this._formats=[],this._frameUpdate=function(){n._found=[];for(var e=n._z.barcode_finder_found_number(n._impl),t=0;t<e;t++)n._found.push({text:n._z.barcode_finder_found_text(n._impl,t),format:n._z.barcode_finder_found_format(n._impl,t)});if(0!==n._found.length){var a,i=r(n._found);try{e:for(i.s();!(a=i.n()).done;){var o,s=a.value,c=r(n._lastDetected);try{for(c.s();!(o=c.n()).done;){if(o.value.text===s.text)continue e}}catch(u){c.e(u)}finally{c.f()}n.onDetection.emit(s)}}catch(u){i.e(u)}finally{i.f()}n._lastDetected=n._found}},this._pipeline._onFrameUpdateInternal.bind(this._frameUpdate),this._z=c.z(),this._impl=this._z.barcode_finder_create(this._pipeline._getImpl()),this._formats.push.apply(this._formats,[s.barcode_format_t.AZTEC,s.barcode_format_t.CODABAR,s.barcode_format_t.CODE_39,s.barcode_format_t.CODE_93,s.barcode_format_t.CODE_128,s.barcode_format_t.DATA_MATRIX,s.barcode_format_t.EAN_8,s.barcode_format_t.EAN_13,s.barcode_format_t.ITF,s.barcode_format_t.MAXICODE,s.barcode_format_t.PDF_417,s.barcode_format_t.QR_CODE,s.barcode_format_t.RSS_14,s.barcode_format_t.RSS_EXPANDED,s.barcode_format_t.UPC_A,s.barcode_format_t.UPC_E,s.barcode_format_t.UPC_EAN_EXTENSION])}return i(e,[{key:"destroy",value:function(){this._pipeline._onFrameUpdateInternal.unbind(this._frameUpdate),this._found=[],this._lastDetected=[],this._z.barcode_finder_destroy(this._impl)}},{key:"found",get:function(){return this._found}},{key:"enabled",get:function(){return this._z.barcode_finder_enabled(this._impl)},set:function(e){this._z.barcode_finder_enabled_set(this._impl,e)}},{key:"formats",get:function(){return this._formats},set:function(e){this._formats=e.slice();var t,n=0,a=r(this._formats);try{for(a.s();!(t=a.n()).done;){n|=t.value}}catch(i){a.e(i)}finally{a.f()}this._z.barcode_finder_formats_set(this._impl,n)}}]),e}();t.BarcodeFinder=u},function(e,t,n){"use strict";var r=n(17),a=n(50).default,i=n(19).default,o=n(20).default,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.FaceTracker=void 0;var c=n(45),u=n(33),l=function(){function e(t){var n=this;i(this,e),this._pipeline=t,this.onVisible=new c.Event1,this.onNotVisible=new c.Event1,this.onNewAnchor=new c.Event1,this.visible=new Set,this.anchors=new Map,this._visibleLastFrame=new Set,this._frameUpdate=function(){var e=new Set,t=n.visible;n.visible=n._visibleLastFrame,n._visibleLastFrame=t,n.visible.clear();for(var r=n._z.face_tracker_anchor_count(n._impl),i=function(t){var r=n._z.face_tracker_anchor_id(n._impl,t),a=n.anchors.get(r);a||(a={onVisible:new c.Event,onNotVisible:new c.Event,indx:0,id:r,poseCameraRelative:function(e){return n._z.face_tracker_anchor_pose_camera_relative(n._impl,a.indx,!0===e)},pose:function(e,t){return n._z.face_tracker_anchor_pose(n._impl,a.indx,e,!0===t)},identity:new Float32Array(50),expression:new Float32Array(29),visible:!0},!0,n.anchors.set(r,a),e.add(a)),a.indx=t,a.visible=!0,a.identity=n._z.face_tracker_anchor_identity_coefficients(n._impl,t),a.expression=n._z.face_tracker_anchor_expression_coefficients(n._impl,t),n.visible.add(a)},o=0;o<r;o++)i(o);var s,u=a(e);try{for(u.s();!(s=u.n()).done;){var l=s.value;n.onNewAnchor.emit(l)}}catch(f){u.e(f)}finally{u.f()}var g,d=a(n.visible);try{for(d.s();!(g=d.n()).done;){var I=g.value;n._visibleLastFrame.has(I)?n._visibleLastFrame.delete(I):(n.onVisible.emit(I),I.onVisible.emit())}}catch(f){d.e(f)}finally{d.f()}var A,h=a(n._visibleLastFrame);try{for(h.s();!(A=h.n()).done;){var C=A.value;n.onNotVisible.emit(C),C.onNotVisible.emit()}}catch(f){h.e(f)}finally{h.f()}},this._pipeline._onFrameUpdateInternal.bind(this._frameUpdate),this._z=u.z(),this._impl=this._z.face_tracker_create(this._pipeline._getImpl())}return o(e,[{key:"destroy",value:function(){this._pipeline._onFrameUpdateInternal.unbind(this._frameUpdate),this.anchors.clear(),this.visible.clear(),this._z.face_tracker_destroy(this._impl)}},{key:"loadModel",value:function(e){return s(this,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof e){t.next=6;break}return t.next=3,fetch(e);case 3:return t.next=5,t.sent.arrayBuffer();case 5:e=t.sent;case 6:this._z.face_tracker_model_load_from_memory(this._impl,e);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"loadDefaultModel",value:function(){return s(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._z.face_tracker_model_load_default(this._impl);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"enabled",get:function(){return this._z.face_tracker_enabled(this._impl)},set:function(e){this._z.face_tracker_enabled_set(this._impl,e)}},{key:"maxFaces",get:function(){return this._z.face_tracker_max_faces(this._impl)},set:function(e){this._z.face_tracker_max_faces_set(this._impl,e)}}]),e}();t.FaceTracker=l},function(e,t,n){"use strict";var r=n(17),a=n(19).default,i=n(20).default,o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.FaceMesh=void 0;var s=n(33),c=function(){function e(){a(this,e),this._z=s.z(),this._impl=this._z.face_mesh_create()}return i(e,[{key:"destroy",value:function(){this._z.face_mesh_destroy(this._impl)}},{key:"load",value:function(e,t,n,a,i){return o(this,void 0,void 0,r.mark((function o(){return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=5;break}return this.loadDefault(),r.abrupt("return");case 5:if("string"!==typeof e){r.next=11;break}return r.next=8,fetch(e);case 8:return r.next=10,r.sent.arrayBuffer();case 10:e=r.sent;case 11:this._z.face_mesh_load_from_memory(this._impl,e,t||!1,n||!1,a||!1,i||!1);case 12:case"end":return r.stop()}}),o,this)})))}},{key:"loadDefault",value:function(){return o(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._z.face_mesh_load_default(this._impl);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"loadDefaultFace",value:function(e,t,n){return o(this,void 0,void 0,r.mark((function a(){return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._z.face_mesh_load_default_face(this._impl,e||!1,t||!1,n||!1);case 2:case"end":return r.stop()}}),a,this)})))}},{key:"loadDefaultFullHeadSimplified",value:function(e,t,n,a){return o(this,void 0,void 0,r.mark((function i(){return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._z.face_mesh_load_default_full_head_simplified(this._impl,e||!1,t||!1,n||!1,a||!1);case 2:case"end":return r.stop()}}),i,this)})))}},{key:"updateFromFaceAnchor",value:function(e,t){this._z.face_mesh_update(this._impl,e.identity,e.expression,t||!1)}},{key:"updateFromIdentityExpression",value:function(e,t,n){this._z.face_mesh_update(this._impl,e,t,n||!1)}},{key:"vertices",get:function(){return this._z.face_mesh_vertices(this._impl)}},{key:"indices",get:function(){return this._z.face_mesh_indices(this._impl)}},{key:"uvs",get:function(){return this._z.face_mesh_uvs(this._impl)}},{key:"normals",get:function(){return this._z.face_mesh_normals(this._impl)}},{key:"_getImpl",value:function(){return this._impl}}]),e}();t.FaceMesh=c},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSource=void 0;var i=n(33),o=function(){function e(t,n){r(this,e),this._z=i.z(),this._impl=this._z.camera_source_create(t._getImpl(),n)}return a(e,[{key:"destroy",value:function(){this._z.camera_source_destroy(this._impl)}},{key:"start",value:function(){this._z.camera_source_start(this._impl)}},{key:"pause",value:function(){this._z.camera_source_pause(this._impl)}}]),e}();t.CameraSource=o},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLElementSource=void 0;var i=n(33),o=function(){function e(t,n){r(this,e),this._z=i.z(),this._impl=this._z.html_element_source_create(t._getImpl(),n)}return a(e,[{key:"destroy",value:function(){this._z.html_element_source_destroy(this._impl)}},{key:"start",value:function(){this._z.html_element_source_start(this._impl)}},{key:"pause",value:function(){this._z.html_element_source_pause(this._impl)}}]),e}();t.HTMLElementSource=o},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Pipeline=void 0;var i=n(33),o=n(45),s=function(){function e(){r(this,e),this.onFrameUpdate=new o.Event,this._onFrameUpdateInternal=new o.Event,this._lastFrameNumber=-1,this._z=i.z(),this._impl=this._z.pipeline_create()}return a(e,[{key:"destroy",value:function(){this._z.pipeline_destroy(this._impl)}},{key:"frameUpdate",value:function(){this._z.pipeline_frame_update(this._impl);var e=this._z.pipeline_frame_number(this._impl);e!==this._lastFrameNumber&&(this._lastFrameNumber=e,this._onFrameUpdateInternal.emit(),this.onFrameUpdate.emit())}},{key:"_getImpl",value:function(){return this._impl}},{key:"glContextSet",value:function(e){this._z.pipeline_gl_context_set(this._impl,e)}},{key:"glContextLost",value:function(){this._z.pipeline_gl_context_lost(this._impl)}},{key:"cameraFrameTextureGL",value:function(){return this._z.pipeline_camera_frame_texture_gl(this._impl)}},{key:"cameraFrameTextureMatrix",value:function(e,t,n){return this._z.pipeline_camera_frame_texture_matrix(this._impl,e,t,!0===n)}},{key:"cameraFrameDrawGL",value:function(e,t,n){this._z.pipeline_camera_frame_draw_gl(this._impl,e,t,n)}},{key:"cameraFrameUploadGL",value:function(){this._z.pipeline_camera_frame_upload_gl(this._impl)}},{key:"processGL",value:function(){this._z.pipeline_process_gl(this._impl)}},{key:"cameraModel",value:function(){return this._z.pipeline_camera_model(this._impl)}},{key:"cameraPoseDefault",value:function(){return this._z.pipeline_camera_pose_default(this._impl)}},{key:"cameraPoseWithAttitude",value:function(e){return this._z.pipeline_camera_pose_with_attitude(this._impl,e||!1)}},{key:"cameraPoseWithOrigin",value:function(e){return this._z.pipeline_camera_pose_with_origin(this._impl,e)}},{key:"cameraFrameUserFacing",value:function(){return this._z.pipeline_camera_frame_user_facing(this._impl)}},{key:"drawFace",value:function(e,t,n,r){this._z.pipeline_draw_face(this._impl,e,t,n,r._getImpl())}},{key:"frameNumber",value:function(){return this._z.pipeline_frame_number(this._impl)}}]),e}();t.Pipeline=s},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceLandmark=t.FaceLandmarkName=void 0;var i=n(33),o=n(36),s=n(51);Object.defineProperty(t,"FaceLandmarkName",{enumerable:!0,get:function(){return s.face_landmark_name_t}});var c=function(){function e(t){r(this,e),this._name=t,this.pose=o.mat4.create(),this._z=i.z(),this._impl=this._z.face_landmark_create(this._name)}return a(e,[{key:"destroy",value:function(){this._z.face_landmark_destroy(this._impl)}},{key:"updateFromFaceAnchor",value:function(e,t){this._z.face_landmark_update(this._impl,e.identity,e.expression,t||!1),this.pose=this._z.face_landmark_anchor_pose(this._impl)}},{key:"updateFromIdentityExpression",value:function(e,t,n){this._z.face_landmark_update(this._impl,e,t,n||!1),this.pose=this._z.face_landmark_anchor_pose(this._impl)}},{key:"_getImpl",value:function(){return this._impl}}]),e}();t.FaceLandmark=c},function(e,t,n){"use strict";var r=n(17),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.permissionDeniedUI=t.permissionRequestUI=t.permissionRequest=t.permissionDenied=t.permissionGranted=t.Permission=void 0;var i,o=n(33);!function(e){e[e.CAMERA=0]="CAMERA",e[e.MOTION=1]="MOTION"}(i=t.Permission||(t.Permission={})),t.permissionGranted=function(e){switch(e){case i.CAMERA:return o.z().permission_granted_camera();case i.MOTION:return o.z().permission_granted_motion();default:return o.z().permission_granted_all()}},t.permissionDenied=function(e){switch(e){case i.CAMERA:return o.z().permission_denied_camera();case i.MOTION:return o.z().permission_denied_motion();default:return o.z().permission_denied_any()}},t.permissionRequest=function(e){var t=this;switch(e){case i.CAMERA:o.z().permission_request_camera();break;case i.MOTION:o.z().permission_request_motion();break;default:o.z().permission_request_all()}return new Promise((function(n){return a(t,void 0,void 0,r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,new Promise((function(e){return requestAnimationFrame((function(){return e()}))}));case 3:t.t0=e,t.next=t.t0===i.CAMERA?6:t.t0===i.MOTION?13:20;break;case 6:if(!o.z().permission_granted_camera()){t.next=9;break}return n(!0),t.abrupt("return");case 9:if(!o.z().permission_denied_camera()){t.next=12;break}return n(!1),t.abrupt("return");case 12:case 19:case 26:return t.abrupt("break",27);case 13:if(!o.z().permission_granted_motion()){t.next=16;break}return n(!0),t.abrupt("return");case 16:if(!o.z().permission_denied_motion()){t.next=19;break}return n(!1),t.abrupt("return");case 20:if(!o.z().permission_granted_camera()||!o.z().permission_granted_motion()){t.next=23;break}return n(!0),t.abrupt("return");case 23:if(!o.z().permission_denied_camera()&&!o.z().permission_denied_motion()){t.next=26;break}return n(!1),t.abrupt("return");case 27:t.next=0;break;case 29:case"end":return t.stop()}}),t)})))}))},t.permissionRequestUI=function(){return a(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.z().permission_request_ui_promise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))},t.permissionDeniedUI=function(){return o.z().permission_denied_ui()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLogLevel=t.logLevel=t.LogLevel=void 0;var r=n(33),a=n(51);Object.defineProperty(t,"LogLevel",{enumerable:!0,get:function(){return a.log_level_t}}),t.logLevel=function(){return r.z().log_level()},t.setLogLevel=function(e){r.z().log_level_set(e)}},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(43).default,o=n(38).default,s=n(29).default,c=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.ImageAnchorGroup=void 0;var u=n(31),l=n(42),g=function(e){s(n,e);var t=c(n);function n(e,a,i){var o;return r(this,n),(o=t.call(this)).camera=e,o.imageTracker=a,o.anchorId=i,o.isReady=!1,o.matrixAutoUpdate=!1,o}return a(n,[{key:"updateMatrixWorld",value:function(e){this.currentAnchor&&this.imageTracker.visible.has(this.currentAnchor)||(this.anchorId?this.currentAnchor=this.imageTracker.anchors.get(this.anchorId):this.currentAnchor=this.imageTracker.visible.values().next().value),this.currentAnchor&&(this.matrix.fromArray(this.currentAnchor.pose(this.camera.rawPose,this.camera.currentMirrorMode===l.CameraMirrorMode.Poses)),this.matrix.decompose(this.position,this.quaternion,this.scale)),i(o(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(u.THREE.Group);t.ImageAnchorGroup=g},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTrackerLoader=void 0;var s=n(31),c=n(61),u=function(e){i(n,e);var t=o(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new c.ImageTracker;return i.loadTarget(e).then((function(){null===t||void 0===t||t(i),a.manager.itemEnd(e)})).catch((function(t){null===r||void 0===r||r(t),a.manager.itemError(e),a.manager.itemEnd(e)})),i}},{key:"parse",value:function(){}}]),n}(s.THREE.Loader);t.ImageTrackerLoader=u},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(43).default,o=n(38).default,s=n(29).default,c=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.InstantWorldAnchorGroup=void 0;var u=n(31),l=n(42),g=function(e){s(n,e);var t=c(n);function n(e,a){var i;return r(this,n),(i=t.call(this)).camera=e,i.instantTracker=a,i.matrixAutoUpdate=!1,i}return a(n,[{key:"setAnchorPoseFromCameraOffset",value:function(e,t,n,r){this.instantTracker.setAnchorPoseFromCameraOffset(e,t,n,r)}},{key:"updateMatrixWorld",value:function(e){this.matrix.fromArray(this.instantTracker.anchor.pose(this.camera.rawPose,this.camera.currentMirrorMode===l.CameraMirrorMode.Poses)),this.matrix.decompose(this.position,this.quaternion,this.scale),i(o(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(u.THREE.Group);t.InstantWorldAnchorGroup=g},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(43).default,o=n(38).default,s=n(29).default,c=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceAnchorGroup=void 0;var u=n(31),l=n(42),g=function(e){s(n,e);var t=c(n);function n(e,a,i){var o;return r(this,n),(o=t.call(this)).camera=e,o.faceTracker=a,o.anchorId=i,o.isReady=!1,o.matrixAutoUpdate=!1,o}return a(n,[{key:"updateMatrixWorld",value:function(e){this.currentAnchor&&this.faceTracker.visible.has(this.currentAnchor)||(this.anchorId?this.currentAnchor=this.faceTracker.anchors.get(this.anchorId):this.currentAnchor=this.faceTracker.visible.values().next().value),this.currentAnchor&&(this.matrix.fromArray(this.currentAnchor.pose(this.camera.rawPose,this.camera.currentMirrorMode===l.CameraMirrorMode.Poses)),this.matrix.decompose(this.position,this.quaternion,this.scale)),i(o(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(u.THREE.Group);t.FaceAnchorGroup=g},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(43).default,o=n(38).default,s=n(29).default,c=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceLandmarkGroup=void 0;var u=n(44),l=n(36),g=n(31),d=n(42),I=function(e){s(n,e);var t=c(n);function n(e,a,i){var o;return r(this,n),(o=t.call(this)).camera=e,o.faceTracker=a,o.pose=l.mat4.create(),o.landmark=new u.FaceLandmark(i),o.matrixAutoUpdate=!1,o}return a(n,[{key:"updateMatrixWorld",value:function(e){this.currentAnchor&&this.faceTracker.visible.has(this.currentAnchor)||(this.currentAnchor=this.faceTracker.visible.values().next().value),this.currentAnchor&&(this.landmark.updateFromFaceAnchor(this.currentAnchor,this.camera.currentMirrorMode===d.CameraMirrorMode.Poses),l.mat4.multiply(this.pose,this.currentAnchor.pose(this.camera.rawPose,this.camera.currentMirrorMode===d.CameraMirrorMode.Poses),this.landmark.pose),this.matrix.fromArray(this.pose),this.matrix.decompose(this.position,this.quaternion,this.scale)),i(o(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"dispose",value:function(){this.landmark.destroy()}}]),n}(g.THREE.Group);t.FaceLandmarkGroup=I},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.FaceTrackerLoader=void 0;var s=n(31),c=n(61),u=function(e){i(n,e);var t=o(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new c.FaceTracker,o=e?i.loadModel(e):i.loadDefaultModel(),s="string"===typeof e?e:"__zappar_threejs_face_tracker_default";return o.then((function(){null===t||void 0===t||t(i),a.manager.itemEnd(s)})).catch((function(e){null===r||void 0===r||r(e),a.manager.itemError(s),a.manager.itemEnd(s)})),i}},{key:"parse",value:function(){}}]),n}(s.THREE.Loader);t.FaceTrackerLoader=u},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default,i=n(29).default,o=n(30).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HeadMaskMeshLoader=void 0;var s=n(31),c=n(89),u="__zappar_threejs_head_mask_mesh",l=function(e){i(n,e);var t=o(n);function n(){return r(this,n),t.apply(this,arguments)}return a(n,[{key:"load",value:function(e,t,n){var r=this;return this.manager.itemStart(u),new c.HeadMaskMesh((function(){null===e||void 0===e||e(),r.manager.itemEnd(u)}),(function(){null===n||void 0===n||n(),r.manager.itemError(u),r.manager.itemEnd(u)}))}},{key:"parse",value:function(){}}]),n}(s.THREE.Loader);t.HeadMaskMeshLoader=l},function(e,t,n){"use strict";var r=n(59).default,a=n(29).default,i=n(30).default,o=n(19).default,s=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingManager=t.DefaultLoaderUI=void 0;var c=n(31),u=n(90),l=function(){function e(t){var n=this;o(this,e),this.lastLoadPercentage=0,this.divs={inner:document.createElement("div"),title:document.createElement("div"),progress:document.createElement("div"),progressValue:document.createElement("div")},this.css={container:{position:"fixed",width:"100%",height:"100%",top:"0px",left:"0px",zIndex:"10000",backgroundColor:"rgba(0,0,0,0.8)",fontFamily:"sans-serif",color:"rgba(255,255,255,1)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"opacity 500ms"},inner:{maxWidth:"400px",textAlign:"center"},title:{fontSize:"20px"},progress:{background:"rgba(255,255,255, 0.1)",justifyContent:"flex-start",borderRadius:"100px",alignItems:"center",position:"relative",padding:"0 5px",display:"flex",height:"15px",width:"250px",margin:"15px"},progressValue:{boxShadow:"0 10px 40px -10px #fff",borderTopLeftRadius:"100px",borderBottomLeftRadius:"100px",background:"rgba(255,255,255,1)",height:"10px",width:"0",transition:"width 500ms"}},this.updateLoader=function(e){if(!(e<n.lastLoadPercentage)){n.lastLoadPercentage=e;var t=document.getElementById("zappar-loader-progressValue");t.style.width="".concat(e,"%"),t.style.borderTopRightRadius="".concat(e,"px"),t.style.borderBottomRightRadius="".concat(e,"px"),t.addEventListener("transitionend",(function(){100===e&&(n.containerDiv.style.opacity="0",n.containerDiv.addEventListener("transitionend",(function(e){"opacity"===e.propertyName&&n.dispose()})))}))}},this.dispose=function(){n.containerDiv.remove()},this.customStyle=t,this.containerDiv=document.createElement("div")}return s(e,[{key:"initialize",value:function(){for(var e in this.divs)this.divs[e].id="zappar-loader-".concat(e);this.refreshStyle(),this.divs.inner.appendChild(this.divs.title),this.divs.inner.appendChild(this.divs.progress),this.divs.progress.appendChild(this.divs.progressValue),this.containerDiv.appendChild(this.divs.inner),this.divs.title.innerHTML="Loading..",document.body.append(this.containerDiv)}},{key:"refreshStyle",value:function(){var e,t,n,r,a;Object.assign(this.css.container,null===(e=this.customStyle)||void 0===e?void 0:e.container),Object.assign(this.css.inner,null===(t=this.customStyle)||void 0===t?void 0:t.inner),Object.assign(this.css.title,null===(n=this.customStyle)||void 0===n?void 0:n.title),Object.assign(this.css.progress,null===(r=this.customStyle)||void 0===r?void 0:r.progress),Object.assign(this.css.progressValue,null===(a=this.customStyle)||void 0===a?void 0:a.progressValue),Object.assign(this.containerDiv.style,this.css.container),Object.assign(this.divs.inner.style,this.css.inner),Object.assign(this.divs.title.style,this.css.title),Object.assign(this.divs.progress.style,this.css.progress),Object.assign(this.divs.progressValue.style,this.css.progressValue)}}]),e}(),g=function(e){a(n,e);var t=i(n);function n(e){var r;return o(this,n),r=t.call(this,null===e||void 0===e?void 0:e.style),c.THREE.DefaultLoadingManager.onStart=function(){r.initialize()},c.THREE.DefaultLoadingManager.onLoad=function(){var t;null===(t=null===e||void 0===e?void 0:e.onLoad)||void 0===t||t.call(e)},c.THREE.DefaultLoadingManager.onProgress=function(e,t,n){r.updateLoader(t/n*100)},r}return s(n)}(l);t.DefaultLoaderUI=g;var d=function(e){a(n,e);var t=i(n);function n(e){var a;return o(this,n),(a=t.call(this,(function(){var t;return null===(t=null===e||void 0===e?void 0:e.onLoad)||void 0===t?void 0:t.call(e)}),(function(t,n,r){var i;a.ui.customStyle=null===e||void 0===e?void 0:e.style,a.ui.refreshStyle(),null===(i=null===e||void 0===e?void 0:e.onProgress)||void 0===i||i.call(e,t,n,r),a.ui.updateLoader(n/r*100)}),null===e||void 0===e?void 0:e.onError)).ui=new l,a.onStartCallback=void 0,a.onStart=function(){a.ui.initialize(),a.onStartCallback&&a.onStartCallback()},a._onStart=function(e){a.onStartCallback=e},a.dispose=function(){a.ui.dispose()},new u.LibraryLoader(r(a)).load(),a}return s(n)}(c.THREE.LoadingManager);t.LoadingManager=d},function(e,t,n){"use strict";var r=n(19).default,a=n(20).default;Object.defineProperty(t,"__esModule",{value:!0}),t.CameraEnvironmentMap=void 0;var i=n(31),o=function(){function e(){r(this,e),this.cubeMapScene=new i.THREE.Scene,this.renderTarget=new i.THREE.WebGLCubeRenderTarget(256,{format:i.THREE.RGBAFormat,generateMipmaps:!0,minFilter:i.THREE.LinearMipmapLinearFilter}),this.cubeCamera=new i.THREE.CubeCamera(.1,1e3,this.renderTarget),this.sphereMaterial=new i.THREE.MeshBasicMaterial({side:i.THREE.DoubleSide}),this.sphereGroup=new i.THREE.Group,this.environmentMap=this.renderTarget.texture,this.cubeMapScene.add(this.cubeCamera);var t=new i.THREE.Mesh(new i.THREE.SphereBufferGeometry(10,16,12),this.sphereMaterial);t.rotation.set(0,-.5*Math.PI,0),this.sphereGroup.add(t),this.cubeMapScene.add(this.sphereGroup)}return a(e,[{key:"dispose",value:function(){this.renderTarget.dispose(),this.sphereMaterial.dispose()}},{key:"update",value:function(e,t){this.environmentMap.encoding=e.outputEncoding,this.sphereMaterial.map=t.backgroundTexture,this.sphereGroup.quaternion.copy(t.quaternion),this.cubeCamera.update(e,this.cubeMapScene)}}]),e}();t.CameraEnvironmentMap=o},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=o(n(34)),u=o(n(1)),l=s(n(18)),g=n(9),d=c.FaceBufferGeometry;(0,g.extend)({FaceBufferGeometry:d});var I=(0,u.forwardRef)((function(e,t){var n=e.fillMouth,a=void 0!==n&&n,i=e.fillEyeLeft,o=void 0!==i&&i,s=e.fillEyeRight,d=void 0!==s&&s,I=e.fillNeck,A=void 0!==I&&I,h=e.fullHead,C=void 0!==h&&h,f=e.children,p=e.trackerGroup,m=u.default.useRef(),v=(0,u.useState)(),b=r(v,2),y=b[0],B=b[1];return(0,u.useEffect)((function(){B(C?(new c.FaceMeshLoader).loadFullHeadSimplified({fillMouth:a,fillEyeLeft:o,fillEyeRight:d,fillNeck:A}):(new c.FaceMeshLoader).loadFace({fillMouth:a,fillEyeLeft:o,fillEyeRight:d}))}),[a,o,d,A]),(0,g.useFrame)((function(){m.current&&p&&p.current&&m.current.updateFromFaceAnchorGroup(p.current)})),y?u.default.createElement("faceBufferGeometry",Object.assign({args:[y],ref:(0,l.default)([m,t])},e),f):null}));t.default=I},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(c){s=!0,a=c}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){(function(e){e.exports=function(t){var r={},a=n(58),i=n(1),o=n(47);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=60103,l=60106,g=60107,d=60108,I=60114,A=60109,h=60110,C=60112,f=60113,p=60120,m=60115,v=60116,b=60121,y=60129,B=60130,G=60131;if("function"===typeof Symbol&&Symbol.for){var w=Symbol.for;u=w("react.element"),l=w("react.portal"),g=w("react.fragment"),d=w("react.strict_mode"),I=w("react.profiler"),A=w("react.provider"),h=w("react.context"),C=w("react.forward_ref"),f=w("react.suspense"),p=w("react.suspense_list"),m=w("react.memo"),v=w("react.lazy"),b=w("react.block"),w("react.scope"),y=w("react.debug_trace_mode"),B=w("react.offscreen"),G=w("react.legacy_hidden")}var _="function"===typeof Symbol&&Symbol.iterator;function Z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=_&&e[_]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case l:return"Portal";case I:return"Profiler";case d:return"StrictMode";case f:return"Suspense";case p:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case h:return(e.displayName||"Context")+".Consumer";case A:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case m:return S(e.type);case b:return S(e._render);case v:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function x(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function R(e){if(x(e)!==e)throw Error(s(188))}function M(e){var t=e.alternate;if(!t){if(null===(t=x(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return R(a),e;if(i===r)return R(a),t;i=i.sibling}throw Error(s(188))}if(n.return!==r.return)n=a,r=i;else{for(var o=!1,c=a.child;c;){if(c===n){o=!0,n=a,r=i;break}if(c===r){o=!0,r=a,n=i;break}c=c.sibling}if(!o){for(c=i.child;c;){if(c===n){o=!0,n=i,r=a;break}if(c===r){o=!0,r=i,n=a;break}c=c.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}function k(e){if(!(e=M(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function E(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var W,V=t.getPublicInstance,F=t.getRootHostContext,X=t.getChildHostContext,H=t.prepareForCommit,O=t.resetAfterCommit,L=t.createInstance,N=t.appendInitialChild,Y=t.finalizeInitialChildren,T=t.prepareUpdate,z=t.shouldSetTextContent,K=t.createTextInstance,j=t.scheduleTimeout,D=t.cancelTimeout,U=t.noTimeout,Q=t.isPrimaryRenderer,P=t.supportsMutation,J=t.supportsPersistence,q=t.supportsHydration,$=t.getInstanceFromNode,ee=t.makeOpaqueHydratingObject,te=t.makeClientId,ne=t.beforeActiveInstanceBlur,re=t.afterActiveInstanceBlur,ae=t.preparePortalMount,ie=t.supportsTestSelectors,oe=t.findFiberRoot,se=t.getBoundingRect,ce=t.getTextContent,ue=t.isHiddenSubtree,le=t.matchAccessibilityRole,ge=t.setFocusIfFocusable,de=t.setupIntersectionObserver,Ie=t.appendChild,Ae=t.appendChildToContainer,he=t.commitTextUpdate,Ce=t.commitMount,fe=t.commitUpdate,pe=t.insertBefore,me=t.insertInContainerBefore,ve=t.removeChild,be=t.removeChildFromContainer,ye=t.resetTextContent,Be=t.hideInstance,Ge=t.hideTextInstance,we=t.unhideInstance,_e=t.unhideTextInstance,Ze=t.clearContainer,Se=t.cloneInstance,xe=t.createContainerChildSet,Re=t.appendChildToContainerChildSet,Me=t.finalizeContainerChildren,ke=t.replaceContainerChildren,Ee=t.cloneHiddenInstance,We=t.cloneHiddenTextInstance,Ve=t.canHydrateInstance,Fe=t.canHydrateTextInstance,Xe=t.isSuspenseInstancePending,He=t.isSuspenseInstanceFallback,Oe=t.getNextHydratableSibling,Le=t.getFirstHydratableChild,Ne=t.hydrateInstance,Ye=t.hydrateTextInstance,Te=t.getNextHydratableInstanceAfterSuspenseInstance,ze=t.commitHydratedContainer,Ke=t.commitHydratedSuspenseInstance;function je(e){if(void 0===W)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);W=t&&t[1]||""}return"\n"+W+e}var De=!1;function Ue(e,t){if(!e||De)return"";De=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s])return"\n"+a[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{De=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?je(e):""}var Qe=[],Pe=-1;function Je(e){return{current:e}}function qe(e){0>Pe||(e.current=Qe[Pe],Qe[Pe]=null,Pe--)}function $e(e,t){Pe++,Qe[Pe]=e.current,e.current=t}var et={},tt=Je(et),nt=Je(!1),rt=et;function at(e,t){var n=e.type.contextTypes;if(!n)return et;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function it(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ot(){qe(nt),qe(tt)}function st(e,t,n){if(tt.current!==et)throw Error(s(168));$e(tt,t),$e(nt,n)}function ct(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(s(108,S(t)||"Unknown",i));return a({},n,r)}function ut(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||et,rt=tt.current,$e(tt,e),$e(nt,nt.current),!0}function lt(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=ct(e,t,rt),r.__reactInternalMemoizedMergedChildContext=e,qe(nt),qe(tt),$e(tt,e)):qe(nt),$e(nt,n)}var gt=null,dt=null;(0,o.unstable_now)();var It=0,At=8;function ht(e){if(0!==(1&e))return At=15,1;if(0!==(2&e))return At=14,2;if(0!==(4&e))return At=13,4;var t=24&e;return 0!==t?(At=12,t):0!==(32&e)?(At=11,32):0!==(t=192&e)?(At=10,t):0!==(256&e)?(At=9,256):0!==(t=3584&e)?(At=8,t):0!==(4096&e)?(At=7,4096):0!==(t=4186112&e)?(At=6,t):0!==(t=62914560&e)?(At=5,t):67108864&e?(At=4,67108864):0!==(134217728&e)?(At=3,134217728):0!==(t=805306368&e)?(At=2,t):0!==(1073741824&e)?(At=1,1073741824):(At=8,e)}function Ct(e,t){var n=e.pendingLanes;if(0===n)return At=0;var r=0,a=0,i=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==i)r=i,a=At=15;else if(0!==(i=134217727&n)){var c=i&~o;0!==c?(r=ht(c),a=At):0!==(s&=i)&&(r=ht(s),a=At)}else 0!==(i=n&~o)?(r=ht(i),a=At):0!==s&&(r=ht(s),a=At);if(0===r)return 0;if(r=n&((0>(r=31-yt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&o)){if(ht(t),a<=At)return t;At=a}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-yt(t)),r|=e[n],t&=~a;return r}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=mt(24&~t))?pt(10,t):e;case 10:return 0===(e=mt(192&~t))?pt(8,t):e;case 8:return 0===(e=mt(3584&~t))&&(0===(e=mt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=mt(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function mt(e){return e&-e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function bt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-yt(t)]=n}var yt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Bt(e)/Gt|0)|0},Bt=Math.log,Gt=Math.LN2;var wt=o.unstable_runWithPriority,_t=o.unstable_scheduleCallback,Zt=o.unstable_cancelCallback,St=o.unstable_shouldYield,xt=o.unstable_requestPaint,Rt=o.unstable_now,Mt=o.unstable_getCurrentPriorityLevel,kt=o.unstable_ImmediatePriority,Et=o.unstable_UserBlockingPriority,Wt=o.unstable_NormalPriority,Vt=o.unstable_LowPriority,Ft=o.unstable_IdlePriority,Xt={},Ht=void 0!==xt?xt:function(){},Ot=null,Lt=null,Nt=!1,Yt=Rt(),Tt=1e4>Yt?Rt:function(){return Rt()-Yt};function zt(){switch(Mt()){case kt:return 99;case Et:return 98;case Wt:return 97;case Vt:return 96;case Ft:return 95;default:throw Error(s(332))}}function Kt(e){switch(e){case 99:return kt;case 98:return Et;case 97:return Wt;case 96:return Vt;case 95:return Ft;default:throw Error(s(332))}}function jt(e,t){return e=Kt(e),wt(e,t)}function Dt(e,t,n){return e=Kt(e),_t(e,t,n)}function Ut(){if(null!==Lt){var e=Lt;Lt=null,Zt(e)}Qt()}function Qt(){if(!Nt&&null!==Ot){Nt=!0;var e=0;try{var t=Ot;jt(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ot=null}catch(n){throw null!==Ot&&(Ot=Ot.slice(e+1)),_t(kt,Ut),n}finally{Nt=!1}}}var Pt=c.ReactCurrentBatchConfig;var Jt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},qt=Object.prototype.hasOwnProperty;function $t(e,t){if(Jt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!qt.call(t,n[r])||!Jt(e[n[r]],t[n[r]]))return!1;return!0}function en(e){switch(e.tag){case 5:return je(e.type);case 16:return je("Lazy");case 13:return je("Suspense");case 19:return je("SuspenseList");case 0:case 2:case 15:return e=Ue(e.type,!1);case 11:return e=Ue(e.type.render,!1);case 22:return e=Ue(e.type._render,!1);case 1:return e=Ue(e.type,!0);default:return""}}function tn(e,t){if(e&&e.defaultProps){for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var nn=Je(null),rn=null,an=null,on=null;function sn(){on=an=rn=null}function cn(e,t){e=e.type._context,Q?($e(nn,e._currentValue),e._currentValue=t):($e(nn,e._currentValue2),e._currentValue2=t)}function un(e){var t=nn.current;qe(nn),e=e.type._context,Q?e._currentValue=t:e._currentValue2=t}function ln(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function gn(e,t){rn=e,on=an=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Yr=!0),e.firstContext=null)}function dn(e,t){if(on!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(on=e,t=1073741823),t={context:e,observedBits:t,next:null},null===an){if(null===rn)throw Error(s(308));an=t,rn.dependencies={lanes:0,firstContext:t,responders:null}}else an=an.next=t;return Q?e._currentValue:e._currentValue2}var In=!1;function An(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function hn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Cn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fn(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function pn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function mn(e,t,n,r){var i=e.updateQueue;In=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,c=i.shared.pending;if(null!==c){i.shared.pending=null;var u=c,l=u.next;u.next=null,null===s?o=l:s.next=l,s=u;var g=e.alternate;if(null!==g){var d=(g=g.updateQueue).lastBaseUpdate;d!==s&&(null===d?g.firstBaseUpdate=l:d.next=l,g.lastBaseUpdate=u)}}if(null!==o){for(d=i.baseState,s=0,g=l=u=null;;){c=o.lane;var I=o.eventTime;if((r&c)===c){null!==g&&(g=g.next={eventTime:I,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var A=e,h=o;switch(c=t,I=n,h.tag){case 1:if("function"===typeof(A=h.payload)){d=A.call(I,d,c);break e}d=A;break e;case 3:A.flags=-4097&A.flags|64;case 0:if(null===(c="function"===typeof(A=h.payload)?A.call(I,d,c):A)||void 0===c)break e;d=a({},d,c);break e;case 2:In=!0}}null!==o.callback&&(e.flags|=32,null===(c=i.effects)?i.effects=[o]:c.push(o))}else I={eventTime:I,lane:c,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===g?(l=g=I,u=d):g=g.next=I,s|=c;if(null===(o=o.next)){if(null===(c=i.shared.pending))break;o=c.next,c.next=null,i.lastBaseUpdate=c,i.shared.pending=null}}null===g&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=g,gi|=s,e.lanes=s,e.memoizedState=d}}function vn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(s(191,a));a.call(r)}}}var bn=(new i.Component).refs;function yn(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bn={isMounted:function(e){return!!(e=e._reactInternals)&&x(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Fi(),a=Xi(e),i=Cn(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),fn(e,i),Hi(e,a,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Fi(),a=Xi(e),i=Cn(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),fn(e,i),Hi(e,a,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Fi(),r=Xi(e),a=Cn(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),fn(e,a),Hi(e,r,n)}};function Gn(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!$t(n,r)||!$t(a,i))}function wn(e,t,n){var r=!1,a=et,i=t.contextType;return"object"===typeof i&&null!==i?i=dn(i):(a=it(t)?rt:tt.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?at(e,a):et),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function _n(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Bn.enqueueReplaceState(t,t.state,null)}function Zn(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=bn,An(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=dn(i):(i=it(t)?rt:tt.current,a.context=at(e,i)),mn(e,n,a,r),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(yn(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Bn.enqueueReplaceState(a,a.state,null),mn(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4)}var Sn=Array.isArray;function xn(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===bn&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function Rn(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Mn(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Go(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function o(t){return e&&null===t.alternate&&(t.flags=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=So(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n,r){return null!==t&&t.elementType===n.type?((r=a(t,n.props)).ref=xn(e,t,n),r.return=e,r):((r=wo(n.type,n.key,n.props,null,e.mode,r)).ref=xn(e,t,n),r.return=e,r)}function I(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=xo(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function A(e,t,n,r,i){return null===t||7!==t.tag?((t=_o(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=So(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case u:return(n=wo(t.type,t.key,t.props,null,e.mode,n)).ref=xn(e,null,t),n.return=e,n;case l:return(t=xo(t,e.mode,n)).return=e,t}if(Sn(t)||Z(t))return(t=_o(t,e.mode,n,null)).return=e,t;Rn(e,t)}return null}function C(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==a?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case u:return n.key===a?n.type===g?A(e,t,n.props.children,r,a):d(e,t,n,r):null;case l:return n.key===a?I(e,t,n,r):null}if(Sn(n)||Z(n))return null!==a?null:A(e,t,n,r,null);Rn(e,n)}return null}function f(e,t,n,r,a){if("string"===typeof r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case u:return e=e.get(null===r.key?n:r.key)||null,r.type===g?A(t,e,r.props.children,a,r.key):d(t,e,r,a);case l:return I(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(Sn(r)||Z(r))return A(t,e=e.get(n)||null,r,a,null);Rn(t,r)}return null}function p(a,o,s,c){for(var u=null,l=null,g=o,d=o=0,I=null;null!==g&&d<s.length;d++){g.index>d?(I=g,g=null):I=g.sibling;var A=C(a,g,s[d],c);if(null===A){null===g&&(g=I);break}e&&g&&null===A.alternate&&t(a,g),o=i(A,o,d),null===l?u=A:l.sibling=A,l=A,g=I}if(d===s.length)return n(a,g),u;if(null===g){for(;d<s.length;d++)null!==(g=h(a,s[d],c))&&(o=i(g,o,d),null===l?u=g:l.sibling=g,l=g);return u}for(g=r(a,g);d<s.length;d++)null!==(I=f(g,a,d,s[d],c))&&(e&&null!==I.alternate&&g.delete(null===I.key?d:I.key),o=i(I,o,d),null===l?u=I:l.sibling=I,l=I);return e&&g.forEach((function(e){return t(a,e)})),u}function m(a,o,c,u){var l=Z(c);if("function"!==typeof l)throw Error(s(150));if(null==(c=l.call(c)))throw Error(s(151));for(var g=l=null,d=o,I=o=0,A=null,p=c.next();null!==d&&!p.done;I++,p=c.next()){d.index>I?(A=d,d=null):A=d.sibling;var m=C(a,d,p.value,u);if(null===m){null===d&&(d=A);break}e&&d&&null===m.alternate&&t(a,d),o=i(m,o,I),null===g?l=m:g.sibling=m,g=m,d=A}if(p.done)return n(a,d),l;if(null===d){for(;!p.done;I++,p=c.next())null!==(p=h(a,p.value,u))&&(o=i(p,o,I),null===g?l=p:g.sibling=p,g=p);return l}for(d=r(a,d);!p.done;I++,p=c.next())null!==(p=f(d,a,I,p.value,u))&&(e&&null!==p.alternate&&d.delete(null===p.key?I:p.key),o=i(p,o,I),null===g?l=p:g.sibling=p,g=p);return e&&d.forEach((function(e){return t(a,e)})),l}return function(e,r,i,c){var d="object"===typeof i&&null!==i&&i.type===g&&null===i.key;d&&(i=i.props.children);var I="object"===typeof i&&null!==i;if(I)switch(i.$$typeof){case u:e:{for(I=i.key,d=r;null!==d;){if(d.key===I){if(7===d.tag){if(i.type===g){n(e,d.sibling),(r=a(d,i.props.children)).return=e,e=r;break e}}else if(d.elementType===i.type){n(e,d.sibling),(r=a(d,i.props)).ref=xn(e,d,i),r.return=e,e=r;break e}n(e,d);break}t(e,d),d=d.sibling}i.type===g?((r=_o(i.props.children,e.mode,c,i.key)).return=e,e=r):((c=wo(i.type,i.key,i.props,null,e.mode,c)).ref=xn(e,r,i),c.return=e,e=c)}return o(e);case l:e:{for(d=i.key;null!==r;){if(r.key===d){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=a(r,i.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=xo(i,e.mode,c)).return=e,e=r}return o(e)}if("string"===typeof i||"number"===typeof i)return i=""+i,null!==r&&6===r.tag?(n(e,r.sibling),(r=a(r,i)).return=e,e=r):(n(e,r),(r=So(i,e.mode,c)).return=e,e=r),o(e);if(Sn(i))return p(e,r,i,c);if(Z(i))return m(e,r,i,c);if(I&&Rn(e,i),"undefined"===typeof i&&!d)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,S(e.type)||"Component"))}return n(e,r)}}var kn=Mn(!0),En=Mn(!1),Wn={},Vn=Je(Wn),Fn=Je(Wn),Xn=Je(Wn);function Hn(e){if(e===Wn)throw Error(s(174));return e}function On(e,t){$e(Xn,t),$e(Fn,e),$e(Vn,Wn),e=F(t),qe(Vn),$e(Vn,e)}function Ln(){qe(Vn),qe(Fn),qe(Xn)}function Nn(e){var t=Hn(Xn.current),n=Hn(Vn.current);n!==(t=X(n,e.type,t))&&($e(Fn,e),$e(Vn,t))}function Yn(e){Fn.current===e&&(qe(Vn),qe(Fn))}var Tn=Je(0);function zn(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Xe(n)||He(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Kn=null,jn=null,Dn=!1;function Un(e,t){var n=yo(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Qn(e,t){switch(e.tag){case 5:return null!==(t=Ve(t,e.type,e.pendingProps))&&(e.stateNode=t,!0);case 6:return null!==(t=Fe(t,e.pendingProps))&&(e.stateNode=t,!0);default:return!1}}function Pn(e){if(Dn){var t=jn;if(t){var n=t;if(!Qn(e,t)){if(!(t=Oe(n))||!Qn(e,t))return e.flags=-1025&e.flags|2,Dn=!1,void(Kn=e);Un(Kn,n)}Kn=e,jn=Le(t)}else e.flags=-1025&e.flags|2,Dn=!1,Kn=e}}function Jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Kn=e}function qn(e){if(!q||e!==Kn)return!1;if(!Dn)return Jn(e),Dn=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!z(t,e.memoizedProps))for(t=jn;t;)Un(e,t),t=Oe(t);if(Jn(e),13===e.tag){if(!q)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));jn=Te(e)}else jn=Kn?Oe(e.stateNode):null;return!0}function $n(){q&&(jn=Kn=null,Dn=!1)}var er=[];function tr(){for(var e=0;e<er.length;e++){var t=er[e];Q?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}er.length=0}var nr=c.ReactCurrentDispatcher,rr=c.ReactCurrentBatchConfig,ar=0,ir=null,or=null,sr=null,cr=!1,ur=!1;function lr(){throw Error(s(321))}function gr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function dr(e,t,n,r,a,i){if(ar=i,ir=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,nr.current=null===e||null===e.memoizedState?Hr:Or,e=n(r,a),ur){i=0;do{if(ur=!1,!(25>i))throw Error(s(301));i+=1,sr=or=null,t.updateQueue=null,nr.current=Lr,e=n(r,a)}while(ur)}if(nr.current=Xr,t=null!==or&&null!==or.next,ar=0,sr=or=ir=null,cr=!1,t)throw Error(s(300));return e}function Ir(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===sr?ir.memoizedState=sr=e:sr=sr.next=e,sr}function Ar(){if(null===or){var e=ir.alternate;e=null!==e?e.memoizedState:null}else e=or.next;var t=null===sr?ir.memoizedState:sr.next;if(null!==t)sr=t,or=e;else{if(null===e)throw Error(s(310));e={memoizedState:(or=e).memoizedState,baseState:or.baseState,baseQueue:or.baseQueue,queue:or.queue,next:null},null===sr?ir.memoizedState=sr=e:sr=sr.next=e}return sr}function hr(e,t){return"function"===typeof t?t(e):t}function Cr(e){var t=Ar(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=or,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var o=a.next;a.next=i.next,i.next=o}r.baseQueue=a=i,n.pending=null}if(null!==a){a=a.next,r=r.baseState;var c=o=i=null,u=a;do{var l=u.lane;if((ar&l)===l)null!==c&&(c=c.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),r=u.eagerReducer===e?u.eagerState:e(r,u.action);else{var g={lane:l,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===c?(o=c=g,i=r):c=c.next=g,ir.lanes|=l,gi|=l}u=u.next}while(null!==u&&u!==a);null===c?i=r:c.next=o,Jt(r,t.memoizedState)||(Yr=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=c,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function fr(e){var t=Ar(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{i=e(i,o.action),o=o.next}while(o!==a);Jt(i,t.memoizedState)||(Yr=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function pr(e,t,n){var r=t._getVersion;r=r(t._source);var a=Q?t._workInProgressVersionPrimary:t._workInProgressVersionSecondary;if(null!==a?e=a===r:(e=e.mutableReadLanes,(e=(ar&e)===e)&&(Q?t._workInProgressVersionPrimary=r:t._workInProgressVersionSecondary=r,er.push(t))),e)return n(t._source);throw er.push(t),Error(s(350))}function mr(e,t,n,r){var a=ri;if(null===a)throw Error(s(349));var i=t._getVersion,o=i(t._source),c=nr.current,u=c.useState((function(){return pr(a,t,n)})),l=u[1],g=u[0];u=sr;var d=e.memoizedState,I=d.refs,A=I.getSnapshot,h=d.source;d=d.subscribe;var C=ir;return e.memoizedState={refs:I,source:t,subscribe:r},c.useEffect((function(){I.getSnapshot=n,I.setSnapshot=l;var e=i(t._source);if(!Jt(o,e)){e=n(t._source),Jt(g,e)||(l(e),e=Xi(C),a.mutableReadLanes|=e&a.pendingLanes),e=a.mutableReadLanes,a.entangledLanes|=e;for(var r=a.entanglements,s=e;0<s;){var c=31-yt(s),u=1<<c;r[c]|=e,s&=~u}}}),[n,t,r]),c.useEffect((function(){return r(t._source,(function(){var e=I.getSnapshot,n=I.setSnapshot;try{n(e(t._source));var r=Xi(C);a.mutableReadLanes|=r&a.pendingLanes}catch(i){n((function(){throw i}))}}))}),[t,r]),Jt(A,n)&&Jt(h,t)&&Jt(d,r)||((e={pending:null,dispatch:null,lastRenderedReducer:hr,lastRenderedState:g}).dispatch=l=Fr.bind(null,ir,e),u.queue=e,u.baseQueue=null,g=pr(a,t,n),u.memoizedState=u.baseState=g),g}function vr(e,t,n){return mr(Ar(),e,t,n)}function br(e){var t=Ir();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:hr,lastRenderedState:e}).dispatch=Fr.bind(null,ir,e),[t.memoizedState,e]}function yr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ir.updateQueue)?(t={lastEffect:null},ir.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Br(e){return e={current:e},Ir().memoizedState=e}function Gr(){return Ar().memoizedState}function wr(e,t,n,r){var a=Ir();ir.flags|=e,a.memoizedState=yr(1|t,n,void 0,void 0===r?null:r)}function _r(e,t,n,r){var a=Ar();r=void 0===r?null:r;var i=void 0;if(null!==or){var o=or.memoizedState;if(i=o.destroy,null!==r&&gr(r,o.deps))return void yr(t,n,i,r)}ir.flags|=e,a.memoizedState=yr(1|t,n,i,r)}function Zr(e,t){return wr(516,4,e,t)}function Sr(e,t){return _r(516,4,e,t)}function xr(e,t){return _r(4,2,e,t)}function Rr(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Mr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,_r(4,2,Rr.bind(null,t,e),n)}function kr(){}function Er(e,t){var n=Ar();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&gr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Wr(e,t){var n=Ar();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&gr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Vr(e,t){var n=zt();jt(98>n?98:n,(function(){e(!0)})),jt(97<n?97:n,(function(){var n=rr.transition;rr.transition=1;try{e(!1),t()}finally{rr.transition=n}}))}function Fr(e,t,n){var r=Fi(),a=Xi(e),i={lane:a,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?i.next=i:(i.next=o.next,o.next=i),t.pending=i,o=e.alternate,e===ir||null!==o&&o===ir)ur=cr=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,c=o(s,n);if(i.eagerReducer=o,i.eagerState=c,Jt(c,s))return}catch(u){}Hi(e,a,r)}}var Xr={readContext:dn,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useLayoutEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useMutableSource:lr,useOpaqueIdentifier:lr,unstable_isNewReconciler:!1},Hr={readContext:dn,useCallback:function(e,t){return Ir().memoizedState=[e,void 0===t?null:t],e},useContext:dn,useEffect:Zr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,wr(4,2,Rr.bind(null,t,e),n)},useLayoutEffect:function(e,t){return wr(4,2,e,t)},useMemo:function(e,t){var n=Ir();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ir();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Fr.bind(null,ir,e),[r.memoizedState,e]},useRef:Br,useState:br,useDebugValue:kr,useDeferredValue:function(e){var t=br(e),n=t[0],r=t[1];return Zr((function(){var t=rr.transition;rr.transition=1;try{r(e)}finally{rr.transition=t}}),[e]),n},useTransition:function(){var e=br(!1),t=e[0];return Br(e=Vr.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=Ir();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},mr(r,e,t,n)},useOpaqueIdentifier:function(){if(Dn){var e=!1,t=ee((function(){throw e||(e=!0,n(te())),Error(s(355))})),n=br(t)[1];return 0===(2&ir.mode)&&(ir.flags|=516,yr(5,(function(){n(te())}),void 0,null)),t}return br(t=te()),t},unstable_isNewReconciler:!1},Or={readContext:dn,useCallback:Er,useContext:dn,useEffect:Sr,useImperativeHandle:Mr,useLayoutEffect:xr,useMemo:Wr,useReducer:Cr,useRef:Gr,useState:function(){return Cr(hr)},useDebugValue:kr,useDeferredValue:function(e){var t=Cr(hr),n=t[0],r=t[1];return Sr((function(){var t=rr.transition;rr.transition=1;try{r(e)}finally{rr.transition=t}}),[e]),n},useTransition:function(){var e=Cr(hr)[0];return[Gr().current,e]},useMutableSource:vr,useOpaqueIdentifier:function(){return Cr(hr)[0]},unstable_isNewReconciler:!1},Lr={readContext:dn,useCallback:Er,useContext:dn,useEffect:Sr,useImperativeHandle:Mr,useLayoutEffect:xr,useMemo:Wr,useReducer:fr,useRef:Gr,useState:function(){return fr(hr)},useDebugValue:kr,useDeferredValue:function(e){var t=fr(hr),n=t[0],r=t[1];return Sr((function(){var t=rr.transition;rr.transition=1;try{r(e)}finally{rr.transition=t}}),[e]),n},useTransition:function(){var e=fr(hr)[0];return[Gr().current,e]},useMutableSource:vr,useOpaqueIdentifier:function(){return fr(hr)[0]},unstable_isNewReconciler:!1},Nr=c.ReactCurrentOwner,Yr=!1;function Tr(e,t,n,r){t.child=null===e?En(t,null,n,r):kn(t,e.child,n,r)}function zr(e,t,n,r,a){n=n.render;var i=t.ref;return gn(t,a),r=dr(e,t,n,r,i,a),null===e||Yr?(t.flags|=1,Tr(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,ga(e,t,a))}function Kr(e,t,n,r,a,i){if(null===e){var o=n.type;return"function"!==typeof o||Bo(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=wo(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,jr(e,t,o,r,a,i))}return o=e.child,0===(a&i)&&(a=o.memoizedProps,(n=null!==(n=n.compare)?n:$t)(a,r)&&e.ref===t.ref)?ga(e,t,i):(t.flags|=1,(e=Go(o,r)).ref=t.ref,e.return=t,t.child=e)}function jr(e,t,n,r,a,i){if(null!==e&&$t(e.memoizedProps,r)&&e.ref===t.ref){if(Yr=!1,0===(i&a))return t.lanes=e.lanes,ga(e,t,i);0!==(16384&e.flags)&&(Yr=!0)}return Qr(e,t,n,r,i)}function Dr(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},ji(t,n);else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},ji(t,e),null;t.memoizedState={baseLanes:0},ji(t,null!==i?i.baseLanes:n)}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,ji(t,r);return Tr(e,t,a,n),t.child}function Ur(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Qr(e,t,n,r,a){var i=it(n)?rt:tt.current;return i=at(t,i),gn(t,a),n=dr(e,t,n,r,i,a),null===e||Yr?(t.flags|=1,Tr(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~a,ga(e,t,a))}function Pr(e,t,n,r,a){if(it(n)){var i=!0;ut(t)}else i=!1;if(gn(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),wn(t,n,r),Zn(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=dn(u):u=at(t,u=it(n)?rt:tt.current);var l=n.getDerivedStateFromProps,g="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;g||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==u)&&_n(t,o,r,u),In=!1;var d=t.memoizedState;o.state=d,mn(t,r,o,a),c=t.memoizedState,s!==r||d!==c||nt.current||In?("function"===typeof l&&(yn(t,n,l,r),c=t.memoizedState),(s=In||Gn(t,n,s,r,d,c,u))?(g||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,hn(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:tn(t.type,s),o.props=u,g=t.pendingProps,d=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=dn(c):c=at(t,c=it(n)?rt:tt.current);var I=n.getDerivedStateFromProps;(l="function"===typeof I||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==g||d!==c)&&_n(t,o,r,c),In=!1,d=t.memoizedState,o.state=d,mn(t,r,o,a);var A=t.memoizedState;s!==g||d!==A||nt.current||In?("function"===typeof I&&(yn(t,n,I,r),A=t.memoizedState),(u=In||Gn(t,n,u,r,d,A,c))?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,A,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,A,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=A),o.props=r,o.state=A,o.context=c,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),r=!1)}return Jr(e,t,n,r,i,a)}function Jr(e,t,n,r,a,i){Ur(e,t);var o=0!==(64&t.flags);if(!r&&!o)return a&&lt(t,n,!1),ga(e,t,i);r=t.stateNode,Nr.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=kn(t,e.child,null,i),t.child=kn(t,null,s,i)):Tr(e,t,s,i),t.memoizedState=r.state,a&&lt(t,n,!0),t.child}function qr(e){var t=e.stateNode;t.pendingContext?st(0,t.pendingContext,t.pendingContext!==t.context):t.context&&st(0,t.context,!1),On(e,t.containerInfo)}var $r,ea,ta,na,ra={dehydrated:null,retryLane:0};function aa(e,t,n){var r,a=t.pendingProps,i=Tn.current,o=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===a.fallback||!0===a.unstable_avoidThisFallback||(i|=1),$e(Tn,1&i),null===e?(void 0!==a.fallback&&Pn(t),e=a.children,i=a.fallback,o?(e=ia(t,e,i,n),t.child.memoizedState={baseLanes:n},t.memoizedState=ra,e):"number"===typeof a.unstable_expectedLoadTime?(e=ia(t,e,i,n),t.child.memoizedState={baseLanes:n},t.memoizedState=ra,t.lanes=33554432,e):((n=Zo({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(a=sa(e,t,a.children,a.fallback,n),o=t.child,i=e.child.memoizedState,o.memoizedState=null===i?{baseLanes:n}:{baseLanes:i.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=ra,a):(n=oa(e,t,a.children,n),t.memoizedState=null,n))}function ia(e,t,n,r){var a=e.mode,i=e.child;return t={mode:"hidden",children:t},0===(2&a)&&null!==i?(i.childLanes=0,i.pendingProps=t):i=Zo(t,a,0,null),n=_o(n,a,r,null),i.return=e,n.return=e,i.sibling=n,e.child=i,n}function oa(e,t,n,r){var a=e.child;return e=a.sibling,n=Go(a,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function sa(e,t,n,r,a){var i=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&i)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Go(o,s),null!==e?r=Go(e,r):(r=_o(r,i,a,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ca(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ln(e.return,t)}function ua(e,t,n,r,a,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=a,o.lastEffect=i)}function la(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Tr(e,t,r.children,n),0!==(2&(r=Tn.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ca(e,n);else if(19===e.tag)ca(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if($e(Tn,r),0===(2&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===zn(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ua(t,!1,a,n,i,t.lastEffect);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===zn(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ua(t,!0,n,null,i,t.lastEffect);break;case"together":ua(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ga(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),gi|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Go(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Go(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function da(e){e.flags|=4}if(P)$r=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)N(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},ea=function(){},ta=function(e,t,n,r,a){if((e=e.memoizedProps)!==r){var i=t.stateNode,o=Hn(Vn.current);n=T(i,n,e,r,a,o),(t.updateQueue=n)&&da(t)}},na=function(e,t,n,r){n!==r&&da(t)};else if(J){$r=function(e,t,n,r){for(var a=t.child;null!==a;){if(5===a.tag){var i=a.stateNode;n&&r&&(i=Ee(i,a.type,a.memoizedProps,a)),N(e,i)}else if(6===a.tag)i=a.stateNode,n&&r&&(i=We(i,a.memoizedProps,a)),N(e,i);else if(4!==a.tag){if(13===a.tag&&0!==(4&a.flags)&&(i=null!==a.memoizedState)){var o=a.child;if(null!==o&&(null!==o.child&&(o.child.return=o,$r(e,o,!0,i)),null!==(i=o.sibling))){i.return=a,a=i;continue}}if(null!==a.child){a.child.return=a,a=a.child;continue}}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};var Ia=function e(t,n,r,a){for(var i=n.child;null!==i;){if(5===i.tag){var o=i.stateNode;r&&a&&(o=Ee(o,i.type,i.memoizedProps,i)),Re(t,o)}else if(6===i.tag)o=i.stateNode,r&&a&&(o=We(o,i.memoizedProps,i)),Re(t,o);else if(4!==i.tag){if(13===i.tag&&0!==(4&i.flags)&&(o=null!==i.memoizedState)){var s=i.child;if(null!==s&&(null!==s.child&&(s.child.return=s,e(t,s,!0,o)),null!==(o=s.sibling))){o.return=i,i=o;continue}}if(null!==i.child){i.child.return=i,i=i.child;continue}}if(i===n)break;for(;null===i.sibling;){if(null===i.return||i.return===n)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};ea=function(e){var t=e.stateNode;if(null!==e.firstEffect){var n=t.containerInfo,r=xe(n);Ia(r,e,!1,!1),t.pendingChildren=r,da(e),Me(n,r)}},ta=function(e,t,n,r,a){var i=e.stateNode,o=e.memoizedProps;if((e=null===t.firstEffect)&&o===r)t.stateNode=i;else{var s=t.stateNode,c=Hn(Vn.current),u=null;o!==r&&(u=T(s,n,o,r,a,c)),e&&null===u?t.stateNode=i:(i=Se(i,u,n,o,r,t,e,s),Y(i,n,r,a,c)&&da(t),t.stateNode=i,e?da(t):$r(i,t,!1,!1))}},na=function(e,t,n,r){n!==r?(e=Hn(Xn.current),n=Hn(Vn.current),t.stateNode=K(r,e,n,t),da(t)):t.stateNode=e.stateNode}}else ea=function(){},ta=function(){},na=function(){};function Aa(e,t){if(!Dn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ha(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return it(t.type)&&ot(),null;case 3:return Ln(),qe(nt),qe(tt),tr(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(qn(t)?da(t):r.hydrate||(t.flags|=256)),ea(t),null;case 5:Yn(t);var a=Hn(Xn.current);if(n=t.type,null!==e&&null!=t.stateNode)ta(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(s(166));return null}if(e=Hn(Vn.current),qn(t)){if(!q)throw Error(s(175));e=Ne(t.stateNode,t.type,t.memoizedProps,a,e,t),t.updateQueue=e,null!==e&&da(t)}else{var i=L(n,r,a,e,t);$r(i,t,!1,!1),t.stateNode=i,Y(i,n,r,a,e)&&da(t)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)na(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(e=Hn(Xn.current),a=Hn(Vn.current),qn(t)){if(!q)throw Error(s(176));Ye(t.stateNode,t.memoizedProps,t)&&da(t)}else t.stateNode=K(r,e,a,t)}return null;case 13:return qe(Tn),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,a=!1,null===e?void 0!==t.memoizedProps.fallback&&qn(t):a=null!==e.memoizedState,r&&!a&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Tn.current)?0===ci&&(ci=3):(0!==ci&&3!==ci||(ci=4),null===ri||0===(134217727&gi)&&0===(134217727&di)||Yi(ri,ii))),J&&r&&(t.flags|=4),P&&(r||a)&&(t.flags|=4),null);case 4:return Ln(),ea(t),null===e&&ae(t.stateNode.containerInfo),null;case 10:return un(t),null;case 19:if(qe(Tn),null===(r=t.memoizedState))return null;if(a=0!==(64&t.flags),null===(i=r.rendering))if(a)Aa(r,!1);else{if(0!==ci||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(i=zn(e))){for(t.flags|=64,Aa(r,!1),null!==(e=i.updateQueue)&&(t.updateQueue=e,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,e=n,r=t.child;null!==r;)n=e,(a=r).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(i=a.alternate)?(a.childLanes=0,a.lanes=n,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,n=i.dependencies,a.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext}),r=r.sibling;return $e(Tn,1&Tn.current|2),t.child}e=e.sibling}null!==r.tail&&Tt()>Ci&&(t.flags|=64,a=!0,Aa(r,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=zn(i))){if(t.flags|=64,a=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Aa(r,!0),null===r.tail&&"hidden"===r.tailMode&&!i.alternate&&!Dn)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Tt()-r.renderingStartTime>Ci&&1073741824!==n&&(t.flags|=64,a=!0,Aa(r,!1),t.lanes=33554432);r.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=r.last)?e.sibling=i:t.child=i,r.last=i)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Tt(),e.sibling=null,t=Tn.current,$e(Tn,a?1&t|2:1&t),e):null;case 23:case 24:return Di(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function Ca(e){switch(e.tag){case 1:it(e.type)&&ot();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Ln(),qe(nt),qe(tt),tr(),0!==(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Yn(e),null;case 13:return qe(Tn),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return qe(Tn),null;case 4:return Ln(),null;case 10:return un(e),null;case 23:case 24:return Di(),null;default:return null}}function fa(e,t){try{var n="",r=t;do{n+=en(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a}}function pa(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ma="function"===typeof WeakMap?WeakMap:Map;function va(e,t,n){(n=Cn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){vi||(vi=!0,bi=r),pa(0,t)},n}function ba(e,t,n){(n=Cn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return pa(0,t),r(a)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===yi?yi=new Set([this]):yi.add(this),pa(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ya="function"===typeof WeakSet?WeakSet:Set;function Ba(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){lo(e,n)}else t.current=null}function Ga(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:tn(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(P&&256&t.flags&&Ze(t.stateNode.containerInfo))}throw Error(s(163))}function wa(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function _a(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var a=e;r=a.next,0!==(4&(a=a.tag))&&0!==(1&a)&&(so(n,e),oo(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:tn(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&vn(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=V(n.child.stateNode);break;case 1:e=n.child.stateNode}vn(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ce(e,n.type,n.memoizedProps,n));case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(q&&null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Ke(n)))))}throw Error(s(163))}function Za(e,t){if(P)for(var n=e;;){if(5===n.tag){var r=n.stateNode;t?Be(r):we(n.stateNode,n.memoizedProps)}else if(6===n.tag)r=n.stateNode,t?Ge(r):_e(r,n.memoizedProps);else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function Sa(e,t){if(dt&&"function"===typeof dt.onCommitFiberUnmount)try{dt.onCommitFiberUnmount(gt,t)}catch(i){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,a=r.destroy;if(r=r.tag,void 0!==a)if(0!==(4&r))so(t,n);else{r=t;try{a()}catch(i){lo(r,i)}}n=n.next}while(n!==e)}break;case 1:if(Ba(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(i){lo(t,i)}break;case 5:Ba(t);break;case 4:P?Va(e,t):J&&J&&(t=t.stateNode.containerInfo,e=xe(t),ke(t,e))}}function xa(e,t){for(var n=t;;)if(Sa(e,n),null===n.child||P&&4===n.tag){if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}else n.child.return=n,n=n.child}function Ra(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function Ma(e){return 5===e.tag||3===e.tag||4===e.tag}function ka(e){if(P){e:{for(var t=e.return;null!==t;){if(Ma(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(s(161))}16&n.flags&&(ye(t),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Ma(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?Ea(e,n,t):Wa(e,n,t)}}function Ea(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?me(n,e,t):Ae(n,e);else if(4!==r&&null!==(e=e.child))for(Ea(e,t,n),e=e.sibling;null!==e;)Ea(e,t,n),e=e.sibling}function Wa(e,t,n){var r=e.tag,a=5===r||6===r;if(a)e=a?e.stateNode:e.stateNode.instance,t?pe(n,e,t):Ie(n,e);else if(4!==r&&null!==(e=e.child))for(Wa(e,t,n),e=e.sibling;null!==e;)Wa(e,t,n),e=e.sibling}function Va(e,t){for(var n,r,a=t,i=!1;;){if(!i){i=a.return;e:for(;;){if(null===i)throw Error(s(160));switch(n=i.stateNode,i.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}i=i.return}i=!0}if(5===a.tag||6===a.tag)xa(e,a),r?be(n,a.stateNode):ve(n,a.stateNode);else if(4===a.tag){if(null!==a.child){n=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(Sa(e,a),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(i=!1)}a.sibling.return=a.return,a=a.sibling}}function Fa(e,t){if(P){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wa(3,t);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var a=t.type,i=t.updateQueue;t.updateQueue=null,null!==i&&fe(n,i,a,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return n=t.memoizedProps,void he(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(q&&(t=t.stateNode,t.hydrate&&(t.hydrate=!1,ze(t.containerInfo))));case 13:return Xa(t),void Ha(t);case 19:return void Ha(t);case 23:case 24:return void Za(t,null!==t.memoizedState)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wa(3,t);case 12:case 23:case 24:return;case 13:return Xa(t),void Ha(t);case 19:return void Ha(t);case 3:q&&((n=t.stateNode).hydrate&&(n.hydrate=!1,ze(n.containerInfo)))}e:if(J){switch(t.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:t=t.stateNode,ke(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Xa(e){null!==e.memoizedState&&(hi=Tt(),P&&Za(e.child,!0))}function Ha(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ya),t.forEach((function(t){var r=Io.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Oa(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var La=0,Na=1,Ya=2,Ta=3,za=4;if("function"===typeof Symbol&&Symbol.for){var Ka=Symbol.for;La=Ka("selector.component"),Na=Ka("selector.has_pseudo_class"),Ya=Ka("selector.role"),Ta=Ka("selector.test_id"),za=Ka("selector.text")}function ja(e){var t=$(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=oe(e)))throw Error(s(362));return e.stateNode.current}function Da(e,t){switch(t.$$typeof){case La:if(e.type===t.value)return!0;break;case Na:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],a=e[n++],i=t[a];if(5!==r.tag||!ue(r)){for(;null!=i&&Da(r,i);)i=t[++a];if(a===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}t=!1}return t;case Ya:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case za:if((5===e.tag||6===e.tag)&&(null!==(e=ce(e))&&0<=e.indexOf(t.value)))return!0;break;case Ta:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365,t))}return!1}function Ua(e){switch(e.$$typeof){case La:return"<"+(S(e.value)||"Unknown")+">";case Na:return":has("+(Ua(e)||"")+")";case Ya:return'[role="'+e.value+'"]';case za:return'"'+e.value+'"';case Ta:return'[data-testname="'+e.value+'"]';default:throw Error(s(365,e))}}function Qa(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var a=e[r++],i=e[r++],o=t[i];if(5!==a.tag||!ue(a)){for(;null!=o&&Da(a,o);)o=t[++i];if(i===t.length)n.push(a);else for(a=a.child;null!==a;)e.push(a,i),a=a.sibling}}return n}function Pa(e,t){if(!ie)throw Error(s(363));e=Qa(e=ja(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)ue(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Ja=null;var qa=Math.ceil,$a=c.ReactCurrentDispatcher,ei=c.ReactCurrentOwner,ti=c.IsSomeRendererActing,ni=0,ri=null,ai=null,ii=0,oi=0,si=Je(0),ci=0,ui=null,li=0,gi=0,di=0,Ii=0,Ai=null,hi=0,Ci=1/0;function fi(){Ci=Tt()+500}var pi,mi=null,vi=!1,bi=null,yi=null,Bi=!1,Gi=null,wi=90,_i=[],Zi=[],Si=null,xi=0,Ri=null,Mi=-1,ki=0,Ei=0,Wi=null,Vi=!1;function Fi(){return 0!==(48&ni)?Tt():-1!==Mi?Mi:Mi=Tt()}function Xi(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===zt()?1:2;if(0===ki&&(ki=li),0!==Pt.transition){0!==Ei&&(Ei=null!==Ai?Ai.pendingLanes:0),e=ki;var t=4186112&~Ei;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=zt(),0!==(4&ni)&&98===e?e=pt(12,ki):e=pt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),ki),e}function Hi(e,t,n){if(50<xi)throw xi=0,Ri=null,Error(s(185));if(null===(e=Oi(e,t)))return null;bt(e,t,n),e===ri&&(di|=t,4===ci&&Yi(e,ii));var r=zt();1===t?0!==(8&ni)&&0===(48&ni)?Ti(e):(Li(e,n),0===ni&&(fi(),Ut())):(0===(4&ni)||98!==r&&99!==r||(null===Si?Si=new Set([e]):Si.add(e)),Li(e,n)),Ai=e}function Oi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Li(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,a=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var c=31-yt(o),u=1<<c,l=i[c];if(-1===l){if(0===(u&r)||0!==(u&a)){l=t,ht(u);var g=At;i[c]=10<=g?l+250:6<=g?l+5e3:-1}}else l<=t&&(e.expiredLanes|=u);o&=~u}if(r=Ct(e,e===ri?ii:0),t=At,0===r)null!==n&&(n!==Xt&&Zt(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Xt&&Zt(n)}15===t?(n=Ti.bind(null,e),null===Ot?(Ot=[n],Lt=_t(kt,Qt)):Ot.push(n),n=Xt):14===t?n=Dt(99,Ti.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),n=Dt(n,Ni.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function Ni(e){if(Mi=-1,Ei=ki=0,0!==(48&ni))throw Error(s(327));var t=e.callbackNode;if(io()&&e.callbackNode!==t)return null;var n=Ct(e,e===ri?ii:0);if(0===n)return null;var r=n,a=ni;ni|=16;var i=Pi();for(ri===e&&ii===r||(fi(),Ui(e,r));;)try{$i();break}catch(c){Qi(e,c)}if(sn(),$a.current=i,ni=a,null!==ai?r=0:(ri=null,ii=0,r=ci),0!==(li&di))Ui(e,0);else if(0!==r){if(2===r&&(ni|=64,e.hydrate&&(e.hydrate=!1,Ze(e.containerInfo)),0!==(n=ft(e))&&(r=Ji(e,n))),1===r)throw t=ui,Ui(e,0),Yi(e,n),Li(e,Tt()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(s(345));case 2:case 5:no(e);break;case 3:if(Yi(e,n),(62914560&n)===n&&10<(r=hi+500-Tt())){if(0!==Ct(e,0))break;if(((a=e.suspendedLanes)&n)!==n){Fi(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=j(no.bind(null,e),r);break}no(e);break;case 4:if(Yi(e,n),(4186112&n)===n)break;for(r=e.eventTimes,a=-1;0<n;){var o=31-yt(n);i=1<<o,(o=r[o])>a&&(a=o),n&=~i}if(n=a,10<(n=(120>(n=Tt()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*qa(n/1960))-n)){e.timeoutHandle=j(no.bind(null,e),n);break}no(e);break;default:throw Error(s(329))}}return Li(e,Tt()),e.callbackNode===t?Ni.bind(null,e):null}function Yi(e,t){for(t&=~Ii,t&=~di,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-yt(t),r=1<<n;e[n]=-1,t&=~r}}function Ti(e){if(0!==(48&ni))throw Error(s(327));if(io(),e===ri&&0!==(e.expiredLanes&ii)){var t=ii,n=Ji(e,t);0!==(li&di)&&(n=Ji(e,t=Ct(e,t)))}else n=Ji(e,t=Ct(e,0));if(0!==e.tag&&2===n&&(ni|=64,e.hydrate&&(e.hydrate=!1,Ze(e.containerInfo)),0!==(t=ft(e))&&(n=Ji(e,t))),1===n)throw n=ui,Ui(e,0),Yi(e,t),Li(e,Tt()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,no(e),Li(e,Tt()),null}function zi(e,t){var n=ni;ni|=1;try{return e(t)}finally{0===(ni=n)&&(fi(),Ut())}}function Ki(e,t){var n=ni;if(0!==(48&n))return e(t);ni|=1;try{if(e)return jt(99,e.bind(null,t))}finally{ni=n,Ut()}}function ji(e,t){$e(si,oi),oi|=t,li|=t}function Di(){oi=si.current,qe(si)}function Ui(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==U&&(e.timeoutHandle=U,D(n)),null!==ai)for(n=ai.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&ot();break;case 3:Ln(),qe(nt),qe(tt),tr();break;case 5:Yn(r);break;case 4:Ln();break;case 13:case 19:qe(Tn);break;case 10:un(r);break;case 23:case 24:Di()}n=n.return}ri=e,ai=Go(e.current,null),ii=oi=li=t,ci=0,ui=null,Ii=di=gi=0}function Qi(e,t){for(;;){var n=ai;try{if(sn(),nr.current=Xr,cr){for(var r=ir.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}cr=!1}if(ar=0,sr=or=ir=null,ur=!1,ei.current=null,null===n||null===n.return){ci=1,ui=t,ai=null;break}e:{var i=e,o=n.return,s=n,c=t;if(t=ii,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c;if(0===(2&s.mode)){var l=s.alternate;l?(s.updateQueue=l.updateQueue,s.memoizedState=l.memoizedState,s.lanes=l.lanes):(s.updateQueue=null,s.memoizedState=null)}var g=0!==(1&Tn.current),d=o;do{var I;if(I=13===d.tag){var A=d.memoizedState;if(null!==A)I=null!==A.dehydrated;else{var h=d.memoizedProps;I=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!g)}}if(I){var C=d.updateQueue;if(null===C){var f=new Set;f.add(u),d.updateQueue=f}else C.add(u);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var p=Cn(-1,1);p.tag=2,fn(s,p)}s.lanes|=1;break e}c=void 0,s=t;var m=i.pingCache;if(null===m?(m=i.pingCache=new ma,c=new Set,m.set(u,c)):void 0===(c=m.get(u))&&(c=new Set,m.set(u,c)),!c.has(s)){c.add(s);var v=go.bind(null,i,u,s);u.then(v,v)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);c=Error((S(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==ci&&(ci=2),c=fa(c,s),d=o;do{switch(d.tag){case 3:i=c,d.flags|=4096,t&=-t,d.lanes|=t,pn(d,va(0,i,t));break e;case 1:i=c;var b=d.type,y=d.stateNode;if(0===(64&d.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===yi||!yi.has(y)))){d.flags|=4096,t&=-t,d.lanes|=t,pn(d,ba(d,i,t));break e}}d=d.return}while(null!==d)}to(n)}catch(B){t=B,ai===n&&null!==n&&(ai=n=n.return);continue}break}}function Pi(){var e=$a.current;return $a.current=Xr,null===e?Xr:e}function Ji(e,t){var n=ni;ni|=16;var r=Pi();for(ri===e&&ii===t||Ui(e,t);;)try{qi();break}catch(a){Qi(e,a)}if(sn(),ni=n,$a.current=r,null!==ai)throw Error(s(261));return ri=null,ii=0,ci}function qi(){for(;null!==ai;)eo(ai)}function $i(){for(;null!==ai&&!St();)eo(ai)}function eo(e){var t=pi(e.alternate,e,oi);e.memoizedProps=e.pendingProps,null===t?to(e):ai=t,ei.current=null}function to(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ha(n,t,oi)))return void(ai=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&oi)||0===(4&n.mode)){for(var r=0,a=n.child;null!==a;)r|=a.lanes|a.childLanes,a=a.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=Ca(t)))return n.flags&=2047,void(ai=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(ai=t);ai=t=e}while(null!==t);0===ci&&(ci=5)}function no(e){var t=zt();return jt(99,ro.bind(null,e,t)),null}function ro(e,t){do{io()}while(null!==Gi);if(0!==(48&ni))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var r=n.lanes|n.childLanes,a=r,i=e.pendingLanes&~a;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=a,e.mutableReadLanes&=a,e.entangledLanes&=a,a=e.entanglements;for(var o=e.eventTimes,c=e.expirationTimes;0<i;){var u=31-yt(i),l=1<<u;a[u]=0,o[u]=-1,c[u]=-1,i&=~l}if(null!==Si&&0===(24&r)&&Si.has(e)&&Si.delete(e),e===ri&&(ai=ri=null,ii=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){a=ni,ni|=32,ei.current=null,Wi=H(e.containerInfo),Vi=!1,mi=r;do{try{ao()}catch(p){if(null===mi)throw Error(s(330));lo(mi,p),mi=mi.nextEffect}}while(null!==mi);Wi=null,mi=r;do{try{for(o=e;null!==mi;){var g=mi.flags;if(16&g&&P&&ye(mi.stateNode),128&g){var d=mi.alternate;if(null!==d){var I=d.ref;null!==I&&("function"===typeof I?I(null):I.current=null)}}switch(1038&g){case 2:ka(mi),mi.flags&=-3;break;case 6:ka(mi),mi.flags&=-3,Fa(mi.alternate,mi);break;case 1024:mi.flags&=-1025;break;case 1028:mi.flags&=-1025,Fa(mi.alternate,mi);break;case 4:Fa(mi.alternate,mi);break;case 8:c=o,i=mi,P?Va(c,i):xa(c,i);var A=i.alternate;Ra(i),null!==A&&Ra(A)}mi=mi.nextEffect}}catch(p){if(null===mi)throw Error(s(330));lo(mi,p),mi=mi.nextEffect}}while(null!==mi);Vi&&re(),O(e.containerInfo),e.current=n,mi=r;do{try{for(g=e;null!==mi;){var h=mi.flags;if(36&h&&_a(g,mi.alternate,mi),128&h){d=void 0;var C=mi.ref;if(null!==C){var f=mi.stateNode;if(5===mi.tag)d=V(f);else d=f;"function"===typeof C?C(d):C.current=d}}mi=mi.nextEffect}}catch(p){if(null===mi)throw Error(s(330));lo(mi,p),mi=mi.nextEffect}}while(null!==mi);mi=null,Ht(),ni=a}else e.current=n;if(Bi)Bi=!1,Gi=e,wi=t;else for(mi=r;null!==mi;)t=mi.nextEffect,mi.nextEffect=null,8&mi.flags&&((h=mi).sibling=null,h.stateNode=null),mi=t;if(0===(r=e.pendingLanes)&&(yi=null),1===r?e===Ri?xi++:(xi=0,Ri=e):xi=0,n=n.stateNode,dt&&"function"===typeof dt.onCommitFiberRoot)try{dt.onCommitFiberRoot(gt,n,void 0,64===(64&n.current.flags))}catch(p){}if(Li(e,Tt()),vi)throw vi=!1,e=bi,bi=null,e;return 0!==(8&ni)||Ut(),null}function ao(){for(;null!==mi;){var e=mi.alternate;Vi||null===Wi||(0!==(8&mi.flags)?E(mi,Wi)&&(Vi=!0,ne()):13===mi.tag&&Oa(e,mi)&&E(mi,Wi)&&(Vi=!0,ne()));var t=mi.flags;0!==(256&t)&&Ga(e,mi),0===(512&t)||Bi||(Bi=!0,Dt(97,(function(){return io(),null}))),mi=mi.nextEffect}}function io(){if(90!==wi){var e=97<wi?97:wi;return wi=90,jt(e,co)}return!1}function oo(e,t){_i.push(t,e),Bi||(Bi=!0,Dt(97,(function(){return io(),null})))}function so(e,t){Zi.push(t,e),Bi||(Bi=!0,Dt(97,(function(){return io(),null})))}function co(){if(null===Gi)return!1;var e=Gi;if(Gi=null,0!==(48&ni))throw Error(s(331));var t=ni;ni|=32;var n=Zi;Zi=[];for(var r=0;r<n.length;r+=2){var a=n[r],i=n[r+1],o=a.destroy;if(a.destroy=void 0,"function"===typeof o)try{o()}catch(u){if(null===i)throw Error(s(330));lo(i,u)}}for(n=_i,_i=[],r=0;r<n.length;r+=2){a=n[r],i=n[r+1];try{var c=a.create;a.destroy=c()}catch(u){if(null===i)throw Error(s(330));lo(i,u)}}for(c=e.current.firstEffect;null!==c;)e=c.nextEffect,c.nextEffect=null,8&c.flags&&(c.sibling=null,c.stateNode=null),c=e;return ni=t,Ut(),!0}function uo(e,t,n){fn(e,t=va(0,t=fa(n,t),1)),t=Fi(),null!==(e=Oi(e,1))&&(bt(e,1,t),Li(e,t))}function lo(e,t){if(3===e.tag)uo(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){uo(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===yi||!yi.has(r))){var a=ba(n,e=fa(t,e),1);if(fn(n,a),a=Fi(),null!==(n=Oi(n,1)))bt(n,1,a),Li(n,a);else if("function"===typeof r.componentDidCatch&&(null===yi||!yi.has(r)))try{r.componentDidCatch(t,e)}catch(i){}break}}n=n.return}}function go(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Fi(),e.pingedLanes|=e.suspendedLanes&n,ri===e&&(ii&n)===n&&(4===ci||3===ci&&(62914560&ii)===ii&&500>Tt()-hi?Ui(e,0):Ii|=n),Li(e,t)}function Io(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===zt()?1:2:(0===ki&&(ki=li),0===(t=mt(62914560&~ki))&&(t=4194304))),n=Fi(),null!==(e=Oi(e,t))&&(bt(e,t,n),Li(e,n))}pi=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||nt.current)Yr=!0;else{if(0===(n&r)){switch(Yr=!1,t.tag){case 3:qr(t),$n();break;case 5:Nn(t);break;case 1:it(t.type)&&ut(t);break;case 4:On(t,t.stateNode.containerInfo);break;case 10:cn(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?aa(e,t,n):($e(Tn,1&Tn.current),null!==(t=ga(e,t,n))?t.sibling:null);$e(Tn,1&Tn.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return la(e,t,n);t.flags|=64}var a=t.memoizedState;if(null!==a&&(a.rendering=null,a.tail=null,a.lastEffect=null),$e(Tn,Tn.current),r)break;return null;case 23:case 24:return t.lanes=0,Dr(e,t,n)}return ga(e,t,n)}Yr=0!==(16384&e.flags)}else Yr=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=at(t,tt.current),gn(t,n),a=dr(null,t,r,e,a,n),t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,it(r)){var i=!0;ut(t)}else i=!1;t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,An(t);var o=r.getDerivedStateFromProps;"function"===typeof o&&yn(t,r,o,e),a.updater=Bn,t.stateNode=a,a._reactInternals=t,Zn(t,r,e,n),t=Jr(null,t,r,!0,i,n)}else t.tag=0,Tr(null,t,a,n),t=t.child;return t;case 16:a=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,a=(i=a._init)(a._payload),t.type=a,i=t.tag=function(e){if("function"===typeof e)return Bo(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===m)return 14}return 2}(a),e=tn(a,e),i){case 0:t=Qr(null,t,a,e,n);break e;case 1:t=Pr(null,t,a,e,n);break e;case 11:t=zr(null,t,a,e,n);break e;case 14:t=Kr(null,t,a,tn(a.type,e),r,n);break e}throw Error(s(306,a,""))}return t;case 0:return r=t.type,a=t.pendingProps,Qr(e,t,r,a=t.elementType===r?a:tn(r,a),n);case 1:return r=t.type,a=t.pendingProps,Pr(e,t,r,a=t.elementType===r?a:tn(r,a),n);case 3:if(qr(t),r=t.updateQueue,null===e||null===r)throw Error(s(282));if(r=t.pendingProps,a=null!==(a=t.memoizedState)?a.element:null,hn(e,t),mn(t,r,null,n),(r=t.memoizedState.element)===a)$n(),t=ga(e,t,n);else{if((i=(a=t.stateNode).hydrate)&&(q?(jn=Le(t.stateNode.containerInfo),Kn=t,i=Dn=!0):i=!1),i){if(q&&null!=(e=a.mutableSourceEagerHydrationData))for(a=0;a<e.length;a+=2)i=e[a],o=e[a+1],Q?i._workInProgressVersionPrimary=o:i._workInProgressVersionSecondary=o,er.push(i);for(n=En(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Tr(e,t,r,n),$n();t=t.child}return t;case 5:return Nn(t),null===e&&Pn(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,o=a.children,z(r,a)?o=null:null!==i&&z(r,i)&&(t.flags|=16),Ur(e,t),Tr(e,t,o,n),t.child;case 6:return null===e&&Pn(t),null;case 13:return aa(e,t,n);case 4:return On(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=kn(t,null,r,n):Tr(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,zr(e,t,r,a=t.elementType===r?a:tn(r,a),n);case 7:return Tr(e,t,t.pendingProps,n),t.child;case 8:case 12:return Tr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,cn(t,i=a.value),null!==o){var c=o.value;if(0===(i=Jt(c,i)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(c,i):1073741823))){if(o.children===a.children&&!nt.current){t=ga(e,t,n);break e}}else for(null!==(c=t.child)&&(c.return=t);null!==c;){var u=c.dependencies;if(null!==u){o=c.child;for(var l=u.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&i)){1===c.tag&&((l=Cn(-1,n&-n)).tag=2,fn(c,l)),c.lanes|=n,null!==(l=c.alternate)&&(l.lanes|=n),ln(c.return,n),u.lanes|=n;break}l=l.next}}else o=10===c.tag&&c.type===t.type?null:c.child;if(null!==o)o.return=c;else for(o=c;null!==o;){if(o===t){o=null;break}if(null!==(c=o.sibling)){c.return=o.return,o=c;break}o=o.return}c=o}}Tr(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=(i=t.pendingProps).children,gn(t,n),r=r(a=dn(a,i.unstable_observedBits)),t.flags|=1,Tr(e,t,r,n),t.child;case 14:return i=tn(a=t.type,t.pendingProps),Kr(e,t,a,i=tn(a.type,i),r,n);case 15:return jr(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:tn(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,it(r)?(e=!0,ut(t)):e=!1,gn(t,n),wn(t,r,a),Zn(t,r,a,n),Jr(null,t,r,!0,e,n);case 19:return la(e,t,n);case 23:case 24:return Dr(e,t,n)}throw Error(s(156,t.tag))};var Ao={current:!1},ho=o.unstable_flushAllWithoutAsserting,Co="function"===typeof ho;function fo(){if(void 0!==ho)return ho();for(var e=!1;io();)e=!0;return e}function po(t){try{fo(),function(t){if(null===Ja)try{var n=("require"+Math.random()).slice(0,7);Ja=(e&&e[n]).call(e,"timers").setImmediate}catch(r){Ja=function(e){var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}Ja(t)}((function(){fo()?po(t):t()}))}catch(n){t(n)}}var mo=0,vo=!1;function bo(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function yo(e,t,n,r){return new bo(e,t,n,r)}function Bo(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Go(e,t){var n=e.alternate;return null===n?((n=yo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function wo(e,t,n,r,a,i){var o=2;if(r=e,"function"===typeof e)Bo(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case g:return _o(n.children,a,i,t);case y:o=8,a|=16;break;case d:o=8,a|=1;break;case I:return(e=yo(12,n,t,8|a)).elementType=I,e.type=I,e.lanes=i,e;case f:return(e=yo(13,n,t,a)).type=f,e.elementType=f,e.lanes=i,e;case p:return(e=yo(19,n,t,a)).elementType=p,e.lanes=i,e;case B:return Zo(n,a,i,t);case G:return(e=yo(24,n,t,a)).elementType=G,e.lanes=i,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case A:o=10;break e;case h:o=9;break e;case C:o=11;break e;case m:o=14;break e;case v:o=16,r=null;break e;case b:o=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=yo(o,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function _o(e,t,n,r){return(e=yo(7,e,r,t)).lanes=n,e}function Zo(e,t,n,r){return(e=yo(23,e,r,t)).elementType=B,e.lanes=n,e}function So(e,t,n){return(e=yo(6,e,null,t)).lanes=n,e}function xo(e,t,n){return(t=yo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ro(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=U,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),q&&(this.mutableSourceEagerHydrationData=null)}function Mo(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=k(t))?null:e.stateNode}function ko(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Eo(e,t){ko(e,t),(e=e.alternate)&&ko(e,t)}function Wo(e){return null===(e=k(e))?null:e.stateNode}function Vo(){return null}return r.IsThisRendererActing=Ao,r.act=function(e){function t(){mo--,ti.current=n,Ao.current=r}!1===vo&&(vo=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),mo++;var n=ti.current,r=Ao.current;ti.current=!0,Ao.current=!0;try{var a=zi(e)}catch(i){throw t(),i}if(null!==a&&"object"===typeof a&&"function"===typeof a.then)return{then:function(e,r){a.then((function(){1<mo||!0===Co&&!0===n?(t(),e()):po((function(n){t(),n?r(n):e()}))}),(function(e){t(),r(e)}))}};try{1!==mo||!1!==Co&&!1!==n||fo(),t()}catch(i){throw t(),i}return{then:function(e){e()}}},r.attemptContinuousHydration=function(e){13===e.tag&&(Hi(e,67108864,Fi()),Eo(e,67108864))},r.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=Fi(),n=Xi(e);Hi(e,n,t),Eo(e,n)}},r.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.hydrate){var n=ht(t.pendingLanes);t.expiredLanes|=n&t.pendingLanes,Li(t,Tt()),0===(48&ni)&&(fi(),Ut())}break;case 13:var r=Fi();Ki((function(){return Hi(e,1,r)})),Eo(e,4)}},r.attemptUserBlockingHydration=function(e){13===e.tag&&(Hi(e,4,Fi()),Eo(e,4))},r.batchedEventUpdates=function(e,t){var n=ni;ni|=2;try{return e(t)}finally{0===(ni=n)&&(fi(),Ut())}},r.batchedUpdates=zi,r.createComponentSelector=function(e){return{$$typeof:La,value:e}},r.createContainer=function(e,t,n){return e=new Ro(e,t,n),t=yo(3,null,null,2===t?7:1===t?3:0),e.current=t,t.stateNode=e,An(t),e},r.createHasPsuedoClassSelector=function(e){return{$$typeof:Na,value:e}},r.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:l,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},r.createRoleSelector=function(e){return{$$typeof:Ya,value:e}},r.createTestNameSelector=function(e){return{$$typeof:Ta,value:e}},r.createTextSelector=function(e){return{$$typeof:za,value:e}},r.deferredUpdates=function(e){return jt(97,e)},r.discreteUpdates=function(e,t,n,r,a){var i=ni;ni|=4;try{return jt(98,e.bind(null,t,n,r,a))}finally{0===(ni=i)&&(fi(),Ut())}},r.findAllNodes=Pa,r.findBoundingRects=function(e,t){if(!ie)throw Error(s(363));t=Pa(e,t),e=[];for(var n=0;n<t.length;n++)e.push(se(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,a=r+n.width,i=n.y,o=i+n.height,c=t-1;0<=c;c--)if(t!==c){var u=e[c],l=u.x,g=l+u.width,d=u.y,I=d+u.height;if(r>=l&&i>=d&&a<=g&&o<=I){e.splice(t,1);break}if(!(r!==l||n.width!==u.width||I<i||d>o)){d>i&&(u.height+=d-i,u.y=i),I<o&&(u.height=o-d),e.splice(t,1);break}if(!(i!==d||n.height!==u.height||g<r||l>a)){l>r&&(u.width+=l-r,u.x=r),g<a&&(u.width=a-l),e.splice(t,1);break}}return e},r.findHostInstance=Mo,r.findHostInstanceWithNoPortals=function(e){return null===(e=function(e){if(!(e=M(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child&&4!==t.tag)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}(e))?null:20===e.tag?e.stateNode.instance:e.stateNode},r.findHostInstanceWithWarning=function(e){return Mo(e)},r.flushControlled=function(e){var t=ni;ni|=1;try{jt(99,e)}finally{0===(ni=t)&&(fi(),Ut())}},r.flushDiscreteUpdates=function(){0===(49&ni)&&(function(){if(null!==Si){var e=Si;Si=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,Li(e,Tt())}))}Ut()}(),io())},r.flushPassiveEffects=io,r.flushSync=Ki,r.focusWithin=function(e,t){if(!ie)throw Error(s(363));for(t=Qa(e=ja(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!ue(n)){if(5===n.tag&&ge(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},r.getCurrentUpdateLanePriority=function(){return It},r.getFindAllNodesFailureDescription=function(e,t){if(!ie)throw Error(s(363));var n=0,r=[];e=[ja(e),0];for(var a=0;a<e.length;){var i=e[a++],o=e[a++],c=t[o];if((5!==i.tag||!ue(i))&&(Da(i,c)&&(r.push(Ua(c)),++o>n&&(n=o)),o<t.length))for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Ua(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},r.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?V(e.child.stateNode):e.child.stateNode:null},r.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c.ReactCurrentDispatcher,findHostInstanceByFiber:Wo,findFiberByHostInstance:e.findFiberByHostInstance||Vo,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t.isDisabled&&t.supportsFiber)try{gt=t.inject(e),dt=t}catch(n){}e=!0}return e},r.observeVisibleRects=function(e,t,n,r){if(!ie)throw Error(s(363));e=Pa(e,t);var a=de(e,n,r).disconnect;return{disconnect:function(){a()}}},r.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},r.runWithPriority=function(e,t){var n=It;try{return It=e,t()}finally{It=n}},r.shouldSuspend=function(){return!1},r.unbatchedUpdates=function(e,t){var n=ni;ni&=-2,ni|=8;try{return e(t)}finally{0===(ni=n)&&(fi(),Ut())}},r.updateContainer=function(e,t,n,r){var a=t.current,i=Fi(),o=Xi(a);e:if(n){t:{if(x(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var c=n;do{switch(c.tag){case 3:c=c.stateNode.context;break t;case 1:if(it(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break t}}c=c.return}while(null!==c);throw Error(s(171))}if(1===n.tag){var u=n.type;if(it(u)){n=ct(n,u,c);break e}}n=c}else n=et;return null===t.context?t.context=n:t.pendingContext=n,(t=Cn(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),fn(a,t),Hi(a,o,i),o},r}}).call(this,n(169)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(34)),c=i(n(1)),u=n(9),l=o(n(18)),g=o(n(53)),d=s.FaceLandmarkGroup;(0,u.extend)({FaceLandmarkGroup:d});var I=(0,c.forwardRef)((function(e,t){var n,r=e.children,a=e.trackerGroup,i=e.camera,o=e.target,u=(0,c.useRef)(),d={camera:g.default.camera((function(e){return e})),faceTracker:g.default.faceTracker((function(e){return e}))},I=(null===(n=null===a||void 0===a?void 0:a.current)||void 0===n?void 0:n.faceTracker)?a.current.faceTracker:d.faceTracker.object,A=(null===i||void 0===i?void 0:i.current)?i.current:d.camera.object;return I&&A?c.default.createElement("faceLandmarkGroup",Object.assign({args:[A,I,s.FaceLandmarkName[o.toUpperCase().replace("-","_")]],ref:(0,l.default)([u,t])},e),r):null}));t.default=I},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);function a(e){var t,n=new Set,r=function(e,r){var a="function"===typeof e?e(t):e;if(a!==t){var i=t;t=r?a:Object.assign({},t,a),n.forEach((function(e){return e(t,i)}))}},a=function(){return t},i={setState:r,getState:a,subscribe:function(e,r,i){return r||i?function(e,r,i){void 0===r&&(r=a),void 0===i&&(i=Object.is),console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=r(t);function s(){var n=r(t);if(!i(o,n)){var a=o;e(o=n,a)}}return n.add(s),function(){return n.delete(s)}}(e,r,i):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,a,i),i}var i="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?r.useEffect:r.useLayoutEffect;t.default=function(e){var t="function"===typeof e?a(e):e,n=function(e,n){void 0===e&&(e=t.getState),void 0===n&&(n=Object.is);var a,o=r.useReducer((function(e){return e+1}),0)[1],s=t.getState(),c=r.useRef(s),u=r.useRef(e),l=r.useRef(n),g=r.useRef(!1),d=r.useRef();void 0===d.current&&(d.current=e(s));var I=!1;(c.current!==s||u.current!==e||l.current!==n||g.current)&&(a=e(s),I=!n(d.current,a)),i((function(){I&&(d.current=a),c.current=s,u.current=e,l.current=n,g.current=!1}));var A=r.useRef(s);i((function(){var e=function(){try{var e=t.getState(),n=u.current(e);l.current(d.current,n)||(c.current=e,d.current=n,o())}catch(r){g.current=!0,o()}},n=t.subscribe(e);return t.getState()!==A.current&&e(),n}),[]);var h=I?a:d.current;return r.useDebugValue(h),h};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=o(n(34)),u=o(n(1)),l=n(9),g=s(n(18)),d=s(n(53)),I=s(n(73)),A=c.FaceAnchorGroup;(0,l.extend)({FaceAnchorGroup:A});var h=(0,u.forwardRef)((function(e,t){var n=e.camera,a=e.children,i=e.useFaceTracker,o=e.onNotVisible,s=e.onVisible,l=e.onNewAnchor,A=e.pipeline,h=e.model,C=e.enabled,f=(0,u.useState)(),p=r(f,2),m=p[0],v=p[1],b=u.default.useRef(),y={camera:d.default.camera((function(e){return e})),faceTracker:d.default.faceTracker((function(e){return e}))};(0,u.useEffect)((function(){var e=new c.FaceTracker(A);h?e.loadModel(h):e.loadDefaultModel(),v(e),y.faceTracker.set(e)}),[h,A]);var B=(null===n||void 0===n?void 0:n.current)?n.current:y.camera.object;return(0,u.useEffect)((function(){return m&&(i&&i(m),o&&m.onNotVisible.bind(o),s&&m.onVisible.bind(s),l&&m.onVisible.bind(l)),function(){m&&(o&&m.onNotVisible.unbind(o),s&&m.onVisible.unbind(s),l&&m.onVisible.unbind(l))}}),[i,s,o,b,m]),(0,I.default)(m,C),m&&B?u.default.createElement("faceAnchorGroup",Object.assign({ref:(0,g.default)([b,t]),args:[B,m]},e),a):null}));t.default=h},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=o(n(34)),u=o(n(1)),l=s(n(18)),g=n(9),d=(0,u.forwardRef)((function(e,t){var n=e.children,a=e.trackerGroup,i=u.default.useRef(),o=(0,u.useState)((new c.HeadMaskMeshLoader).load()),s=r(o,1)[0];return(0,g.useFrame)((function(){i.current&&a&&a.current&&i.current.updateFromFaceAnchorGroup(a.current)})),s?u.default.createElement("primitive",Object.assign({object:s,ref:(0,l.default)([i,t])},e),n):null}));t.default=d},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=o(n(34)),u=o(n(1)),l=n(9),g=s(n(18)),d=s(n(53)),I=s(n(73)),A=c.ImageAnchorGroup;(0,l.extend)({ImageAnchorGroup:A});var h=(0,u.forwardRef)((function(e,t){var n=e.useImageTracker,a=e.onNotVisible,i=e.onNewAnchor,o=e.onVisible,s=e.targetImage,l=e.camera,A=e.children,h=e.pipeline,C=e.enabled,f=(0,u.useRef)(),p=d.default.camera((function(e){return e})),m=(null===l||void 0===l?void 0:l.current)?l.current:p.object,v=(0,u.useState)(),b=r(v,2),y=b[0],B=b[1];return(0,u.useEffect)((function(){B(new c.ImageTracker(s,h))}),[s,h]),(0,u.useEffect)((function(){return y&&(n&&n(y),a&&y.onNotVisible.bind(a),i&&y.onNewAnchor.bind(i),o&&y.onVisible.bind(o)),function(){a&&(null===y||void 0===y||y.onNotVisible.unbind(a)),i&&(null===y||void 0===y||y.onNewAnchor.unbind(i)),o&&(null===y||void 0===y||y.onVisible.unbind(o))}}),[n,o,i,a,y]),(0,I.default)(y,C),m&&y?u.default.createElement("imageAnchorGroup",Object.assign({ref:(0,g.default)([f,t]),args:[m,y]},e),A):null}));t.default=h},function(e,t,n){"use strict";var r=n(17),a=n(176).default,i=n(177).default,o=n(39).default,s=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return c(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var g=u(n(34)),d=u(n(1)),I=n(9),A=l(n(18)),h=l(n(53)),C=l(n(181)),f=l(n(73)),p=g.InstantWorldAnchorGroup;(0,I.extend)({InstantWorldAnchorGroup:p});var m=(0,d.forwardRef)((function(e,t){var n=e.camera,s=e.placementMode,c=e.children,u=e.placementCameraOffset,l=e.pipeline,p=e.placementUI,m=e.useInstantTracker,v=e.enabled,b=(0,d.useRef)(),y=(0,d.useState)(s),B=o(y,2),G=B[0],w=B[1];(0,d.useEffect)((function(){w(s)}),[s,p]);var _=(0,d.useState)(),Z=o(_,2),S=Z[0],x=Z[1];(0,d.useEffect)((function(){x(new g.InstantWorldTracker(l))}),[l]);var R=h.default.camera((function(e){return e})),M=(null===n||void 0===n?void 0:n.current)?n.current:R.object,k=u||{x:0,y:0,z:-5};if((0,d.useEffect)((function(){S&&m&&m(S)}),[m,S]),(0,I.useFrame)((function(){G&&S&&(Array.isArray(k)?S.setAnchorPoseFromCameraOffset.apply(S,i(k)):"number"===typeof k?S.setAnchorPoseFromCameraOffset(0,0,k):k.x&&S.setAnchorPoseFromCameraOffset(k.x,k.y,k.z))})),(0,f.default)(S,v),!M||!S)return null;var E=p?d.default.createElement(C.default,{placementType:p,onInteract:function(){var e=a(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}):void 0;return d.default.createElement(d.default.Fragment,null,E,d.default.createElement("instantWorldAnchorGroup",Object.assign({ref:(0,A.default)([b,t]),args:[M,S]},e),c))}));t.default=m},function(e,t){function n(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,a)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function s(e){n(o,a,i,s,c,"next",e)}function c(e){n(o,a,i,s,c,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(178),a=n(179),i=n(70),o=n(180);e.exports=function(e){return r(e)||a(e)||i(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){var r=n(78);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(1)),c=n(97),u={position:"absolute",bottom:"5%",width:"200px",left:"calc(50% - 100px)",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",textAlign:"center",fontFamily:"sans-serif",padding:"10px",userSelect:"none",borderRadius:"5px"};t.default=function(e){var t=e.onInteract,n=e.placementType,a=(0,s.useState)(!0),i=r(a,2),o=i[0],l=i[1],g=(0,s.useState)(!1),d=r(g,2),I=d[0],A=d[1];return(0,s.useLayoutEffect)((function(){t(o)}),[o]),(0,s.useEffect)((function(){A(!0)}),[]),I&&("placement-only"!==n||o)?s.default.createElement(c.Html,{fullscreen:!0,style:{left:"0px",top:"0px"}},s.default.createElement("div",{style:{width:"100%",height:"100%",position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.1)"}},s.default.createElement("div",{id:"ZapparPlacementUIHelper",role:"button",style:u,tabIndex:0,onKeyPress:function(){l((function(e){return!e}))},onClick:function(){l((function(e){return!e}))}},"Tap here to",o?" place ":" pick up ","the object"))):null}},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c,u=[],l=!1,g=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):g=-1,u.length&&I())}function I(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++g<t;)c&&c[g].run();g=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function A(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new A(e,t)),1!==u.length||l||s(I)},A.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),o=r[0],s=r[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,g=s>0?o-4:o;for(n=0;n<g;n+=4)t=a[e.charCodeAt(n)]<<18|a[e.charCodeAt(n+1)]<<12|a[e.charCodeAt(n+2)]<<6|a[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=a[e.charCodeAt(n)]<<2|a[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=a[e.charCodeAt(n)]<<10|a[e.charCodeAt(n+1)]<<4|a[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],o=16383,s=0,c=n-a;s<c;s+=o)i.push(l(e,s,s+o>c?c:s+o));1===a?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],a=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=o.length;s<c;++s)r[s]=o[s],a[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var a,i,o=[],s=t;s<n;s+=3)a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(i=a)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,c=(1<<s)-1,u=c>>1,l=-7,g=n?a-1:0,d=n?-1:1,I=e[t+g];for(g+=d,i=I&(1<<-l)-1,I>>=-l,l+=s;l>0;i=256*i+e[t+g],g+=d,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+g],g+=d,l-=8);if(0===i)i=1-u;else{if(i===c)return o?NaN:1/0*(I?-1:1);o+=Math.pow(2,r),i-=u}return(I?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,c,u=8*i-a-1,l=(1<<u)-1,g=l>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,I=r?0:i-1,A=r?1:-1,h=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+g>=1?d/c:d*Math.pow(2,1-g))*c>=2&&(o++,c/=2),o+g>=l?(s=0,o=l):o+g>=1?(s=(t*c-1)*Math.pow(2,a),o+=g):(s=t*Math.pow(2,g-1)*Math.pow(2,a),o=0));a>=8;e[n+I]=255&s,I+=A,s/=256,a-=8);for(o=o<<a|s,u+=a;u>0;e[n+I]=255&o,I+=A,o/=256,u-=8);e[n+I-A]|=128*h}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=n(187);function a(){}function i(){}i.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,i,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";var r=n(39).default,a=n(20).default,i=n(19).default,o=n(29).default,s=n(30).default,c=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),u=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&c(t,e,n);return u(t,e),t},g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=l(n(34)),I=l(n(1)),A=n(86),h=g(n(18)),C=n(9),f=g(n(53)),p=function(e){o(n,e);var t=s(n);function n(){var e;return i(this,n),(e=t.apply(this,arguments)).updateProjectionMatrix=function(){},e}return a(n)}(d.Camera);(0,C.extend)({ZapparCameraAdditional:p});var m=(0,I.forwardRef)((function(e,t){var n=e.userFacing,a=void 0!==n&&n,i=e.rearCameraMirrorMode,o=e.userCameraMirrorMode,s=e.poseMode,c=e.poseAnchorOrigin,u=e.pipeline,l=e.sources,g=e.makeDefault,p=void 0===g||g,m=e.renderPriority,v=void 0===m?2:m,b=e.environmentMap,y=void 0!==b&&b,B=e.permissionRequest,G=void 0===B||B,w=e.onFirstFrame,_=e.backgroundImageProps,Z=(0,C.useThree)((function(e){return e})),S=Z.gl,x=Z.set,R=(0,I.useState)(!1),M=r(R,2),k=M[0],E=M[1],W=(0,I.useState)(new A.CameraTexture),V=r(W,1)[0],F=(0,I.useMemo)((function(){return y?new d.CameraEnvironmentMap:void 0}),[y]);(0,I.useEffect)((function(){_&&V&&Object.assign(V,_)}),[_,V]);var X=I.default.useRef(),H=(0,I.useState)(!1),O=r(H,2),L=O[0],N=O[1],Y={camera:f.default.camera((function(e){return e}))};return(0,I.useEffect)((function(){(u||d).glContextSet(S.getContext())}),[u,S]),(0,I.useEffect)((function(){p&&x((function(){return{camera:X.current}}))}),[p]),(0,I.useEffect)((function(){X.current&&(Y.camera.set(X.current),L||!G?X.current.start(a):d.permissionRequestUI().then((function(e){N(e),e?X.current.start(a):d.permissionDeniedUI()})))}),[a,G]),(0,I.useEffect)((function(){if(X.current){switch(i){case"poses":X.current.rearCameraMirrorMode=d.CameraMirrorMode.Poses;break;case"css":X.current.rearCameraMirrorMode=d.CameraMirrorMode.CSS;break;default:X.current.rearCameraMirrorMode=d.CameraMirrorMode.None}switch(o){case"none":X.current.userCameraMirrorMode=d.CameraMirrorMode.None;break;case"css":X.current.userCameraMirrorMode=d.CameraMirrorMode.CSS;break;default:X.current.userCameraMirrorMode=d.CameraMirrorMode.Poses}switch(s){case"anchor-origin":X.current.poseMode=d.CameraPoseMode.AnchorOrigin,X.current.poseAnchorOrigin=c;break;case"attitude":X.current.poseMode=d.CameraPoseMode.Attitude;break;default:X.current.poseMode=d.CameraPoseMode.Default}}}),[i,o,s,c]),(0,C.useFrame)((function(e){var t=e.gl,n=e.scene;X.current&&(w&&!k&&X.current.pipeline.frameNumber()>0&&(E(!0),w()),null===F||void 0===F||F.update(t,X.current),X.current.updateFrame(t),t.render(n,X.current))}),v),I.default.useMemo((function(){return I.default.createElement(I.default.Fragment,null,I.default.createElement("primitive",{object:V,attach:"background"}),y&&I.default.createElement("primitive",{object:F.environmentMap,attach:"environment"}),I.default.createElement("zapparCameraAdditional",Object.assign({args:[{pipeline:u,userCameraSource:null===l||void 0===l?void 0:l.userCamera,rearCameraSource:null===l||void 0===l?void 0:l.rearCamera,backgroundTexture:V}],ref:(0,h.default)([X,t])},e)))}),[V,F,l,e])}));t.default=m},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(1)),i=n(9),o=n(194);t.default=function(e){var t=e.children;return a.default.createElement(i.Canvas,Object.assign({flat:!0,resize:{polyfill:o.ResizeObserver},linear:!0,dpr:window.devicePixelRatio,id:"zapparCanvas"},e,{gl:Object.assign({antialias:!1},e.gl)}),t)}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=i(n(34));t.default=function(e){var t=e.style,n=e.onLoad;return(0,o.useEffect)((function(){var e=new s.DefaultLoaderUI({style:t,onLoad:n});return function(){return e.dispose()}}),[e]),null}},function(e,t,n){"use strict";var r=n(39).default,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n(34)),c=n(1);t.default=function(e){var t=e.fallback,n=(0,c.useState)(!0),a=r(n,2),i=a[0],o=a[1];return(0,c.useEffect)((function(){o(!s.browserIncompatible()),i||t||s.browserIncompatibleUI()}),[]),t&&!i?t:null}},function(e,t,n){"use strict";n(58);var r=n(1),a=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var i=Symbol.for;a=i("react.element"),t.Fragment=i("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,i={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:u,ref:l,props:i,_owner:o.current}}t.jsx=u,t.jsxs=u},function(e){e.exports=JSON.parse('[["#69d2e7","#a7dbd8","#e0e4cc","#f38630","#fa6900"],["#fe4365","#fc9d9a","#f9cdad","#c8c8a9","#83af9b"],["#ecd078","#d95b43","#c02942","#542437","#53777a"],["#556270","#4ecdc4","#c7f464","#ff6b6b","#c44d58"],["#774f38","#e08e79","#f1d4af","#ece5ce","#c5e0dc"],["#e8ddcb","#cdb380","#036564","#033649","#031634"],["#490a3d","#bd1550","#e97f02","#f8ca00","#8a9b0f"],["#594f4f","#547980","#45ada8","#9de0ad","#e5fcc2"],["#00a0b0","#6a4a3c","#cc333f","#eb6841","#edc951"],["#e94e77","#d68189","#c6a49a","#c6e5d9","#f4ead5"],["#3fb8af","#7fc7af","#dad8a7","#ff9e9d","#ff3d7f"],["#d9ceb2","#948c75","#d5ded9","#7a6a53","#99b2b7"],["#ffffff","#cbe86b","#f2e9e1","#1c140d","#cbe86b"],["#efffcd","#dce9be","#555152","#2e2633","#99173c"],["#343838","#005f6b","#008c9e","#00b4cc","#00dffc"],["#413e4a","#73626e","#b38184","#f0b49e","#f7e4be"],["#ff4e50","#fc913a","#f9d423","#ede574","#e1f5c4"],["#99b898","#fecea8","#ff847c","#e84a5f","#2a363b"],["#655643","#80bca3","#f6f7bd","#e6ac27","#bf4d28"],["#00a8c6","#40c0cb","#f9f2e7","#aee239","#8fbe00"],["#351330","#424254","#64908a","#e8caa4","#cc2a41"],["#554236","#f77825","#d3ce3d","#f1efa5","#60b99a"],["#5d4157","#838689","#a8caba","#cad7b2","#ebe3aa"],["#8c2318","#5e8c6a","#88a65e","#bfb35a","#f2c45a"],["#fad089","#ff9c5b","#f5634a","#ed303c","#3b8183"],["#ff4242","#f4fad2","#d4ee5e","#e1edb9","#f0f2eb"],["#f8b195","#f67280","#c06c84","#6c5b7b","#355c7d"],["#d1e751","#ffffff","#000000","#4dbce9","#26ade4"],["#1b676b","#519548","#88c425","#bef202","#eafde6"],["#5e412f","#fcebb6","#78c0a8","#f07818","#f0a830"],["#bcbdac","#cfbe27","#f27435","#f02475","#3b2d38"],["#452632","#91204d","#e4844a","#e8bf56","#e2f7ce"],["#eee6ab","#c5bc8e","#696758","#45484b","#36393b"],["#f0d8a8","#3d1c00","#86b8b1","#f2d694","#fa2a00"],["#2a044a","#0b2e59","#0d6759","#7ab317","#a0c55f"],["#f04155","#ff823a","#f2f26f","#fff7bd","#95cfb7"],["#b9d7d9","#668284","#2a2829","#493736","#7b3b3b"],["#bbbb88","#ccc68d","#eedd99","#eec290","#eeaa88"],["#b3cc57","#ecf081","#ffbe40","#ef746f","#ab3e5b"],["#a3a948","#edb92e","#f85931","#ce1836","#009989"],["#300030","#480048","#601848","#c04848","#f07241"],["#67917a","#170409","#b8af03","#ccbf82","#e33258"],["#aab3ab","#c4cbb7","#ebefc9","#eee0b7","#e8caaf"],["#e8d5b7","#0e2430","#fc3a51","#f5b349","#e8d5b9"],["#ab526b","#bca297","#c5ceae","#f0e2a4","#f4ebc3"],["#607848","#789048","#c0d860","#f0f0d8","#604848"],["#b6d8c0","#c8d9bf","#dadabd","#ecdbbc","#fedcba"],["#a8e6ce","#dcedc2","#ffd3b5","#ffaaa6","#ff8c94"],["#3e4147","#fffedf","#dfba69","#5a2e2e","#2a2c31"],["#fc354c","#29221f","#13747d","#0abfbc","#fcf7c5"],["#cc0c39","#e6781e","#c8cf02","#f8fcc1","#1693a7"],["#1c2130","#028f76","#b3e099","#ffeaad","#d14334"],["#a7c5bd","#e5ddcb","#eb7b59","#cf4647","#524656"],["#dad6ca","#1bb0ce","#4f8699","#6a5e72","#563444"],["#5c323e","#a82743","#e15e32","#c0d23e","#e5f04c"],["#edebe6","#d6e1c7","#94c7b6","#403b33","#d3643b"],["#fdf1cc","#c6d6b8","#987f69","#e3ad40","#fcd036"],["#230f2b","#f21d41","#ebebbc","#bce3c5","#82b3ae"],["#b9d3b0","#81bda4","#b28774","#f88f79","#f6aa93"],["#3a111c","#574951","#83988e","#bcdea5","#e6f9bc"],["#5e3929","#cd8c52","#b7d1a3","#dee8be","#fcf7d3"],["#1c0113","#6b0103","#a30006","#c21a01","#f03c02"],["#000000","#9f111b","#b11623","#292c37","#cccccc"],["#382f32","#ffeaf2","#fcd9e5","#fbc5d8","#f1396d"],["#e3dfba","#c8d6bf","#93ccc6","#6cbdb5","#1a1f1e"],["#f6f6f6","#e8e8e8","#333333","#990100","#b90504"],["#1b325f","#9cc4e4","#e9f2f9","#3a89c9","#f26c4f"],["#a1dbb2","#fee5ad","#faca66","#f7a541","#f45d4c"],["#c1b398","#605951","#fbeec2","#61a6ab","#accec0"],["#5e9fa3","#dcd1b4","#fab87f","#f87e7b","#b05574"],["#951f2b","#f5f4d7","#e0dfb1","#a5a36c","#535233"],["#8dccad","#988864","#fea6a2","#f9d6ac","#ffe9af"],["#2d2d29","#215a6d","#3ca2a2","#92c7a3","#dfece6"],["#413d3d","#040004","#c8ff00","#fa023c","#4b000f"],["#eff3cd","#b2d5ba","#61ada0","#248f8d","#605063"],["#ffefd3","#fffee4","#d0ecea","#9fd6d2","#8b7a5e"],["#cfffdd","#b4dec1","#5c5863","#a85163","#ff1f4c"],["#9dc9ac","#fffec7","#f56218","#ff9d2e","#919167"],["#4e395d","#827085","#8ebe94","#ccfc8e","#dc5b3e"],["#a8a7a7","#cc527a","#e8175d","#474747","#363636"],["#f8edd1","#d88a8a","#474843","#9d9d93","#c5cfc6"],["#046d8b","#309292","#2fb8ac","#93a42a","#ecbe13"],["#f38a8a","#55443d","#a0cab5","#cde9ca","#f1edd0"],["#a70267","#f10c49","#fb6b41","#f6d86b","#339194"],["#ff003c","#ff8a00","#fabe28","#88c100","#00c176"],["#ffedbf","#f7803c","#f54828","#2e0d23","#f8e4c1"],["#4e4d4a","#353432","#94ba65","#2790b0","#2b4e72"],["#0ca5b0","#4e3f30","#fefeeb","#f8f4e4","#a5b3aa"],["#4d3b3b","#de6262","#ffb88c","#ffd0b3","#f5e0d3"],["#fffbb7","#a6f6af","#66b6ab","#5b7c8d","#4f2958"],["#edf6ee","#d1c089","#b3204d","#412e28","#151101"],["#9d7e79","#ccac95","#9a947c","#748b83","#5b756c"],["#fcfef5","#e9ffe1","#cdcfb7","#d6e6c3","#fafbe3"],["#9cddc8","#bfd8ad","#ddd9ab","#f7af63","#633d2e"],["#30261c","#403831","#36544f","#1f5f61","#0b8185"],["#aaff00","#ffaa00","#ff00aa","#aa00ff","#00aaff"],["#d1313d","#e5625c","#f9bf76","#8eb2c5","#615375"],["#ffe181","#eee9e5","#fad3b2","#ffba7f","#ff9c97"],["#73c8a9","#dee1b6","#e1b866","#bd5532","#373b44"],["#805841","#dcf7f3","#fffcdd","#ffd8d8","#f5a2a2"]]')},function(e,t,n){"use strict";n.r(t),n.d(t,"ResizeObserver",(function(){return Y})),n.d(t,"ResizeObserverEntry",(function(){return B})),n.d(t,"ResizeObserverSize",(function(){return c}));var r,a=[],i="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(r||(r={}));var o,s=function(e){return Object.freeze(e)},c=function(e,t){this.inlineSize=e,this.blockSize=t,s(this)},u=function(){function e(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,s(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),l=function(e){return e instanceof SVGElement&&"getBBox"in e},g=function(e){if(l(e)){var t=e.getBBox(),n=t.width,r=t.height;return!n&&!r}var a=e,i=a.offsetWidth,o=a.offsetHeight;return!(i||o||e.getClientRects().length)},d=function(e){var t,n;if(e instanceof Element)return!0;var r=null===(n=null===(t=e)||void 0===t?void 0:t.ownerDocument)||void 0===n?void 0:n.defaultView;return!!(r&&e instanceof r.Element)},I="undefined"!==typeof window?window:{},A=new WeakMap,h=/auto|scroll/,C=/^tb|vertical/,f=/msie|trident/i.test(I.navigator&&I.navigator.userAgent),p=function(e){return parseFloat(e||"0")},m=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new c((n?t:e)||0,(n?e:t)||0)},v=s({devicePixelContentBoxSize:m(),borderBoxSize:m(),contentBoxSize:m(),contentRect:new u(0,0,0,0)}),b=function(e,t){if(void 0===t&&(t=!1),A.has(e)&&!t)return A.get(e);if(g(e))return A.set(e,v),v;var n=getComputedStyle(e),r=l(e)&&e.ownerSVGElement&&e.getBBox(),a=!f&&"border-box"===n.boxSizing,i=C.test(n.writingMode||""),o=!r&&h.test(n.overflowY||""),c=!r&&h.test(n.overflowX||""),d=r?0:p(n.paddingTop),I=r?0:p(n.paddingRight),b=r?0:p(n.paddingBottom),y=r?0:p(n.paddingLeft),B=r?0:p(n.borderTopWidth),G=r?0:p(n.borderRightWidth),w=r?0:p(n.borderBottomWidth),_=y+I,Z=d+b,S=(r?0:p(n.borderLeftWidth))+G,x=B+w,R=c?e.offsetHeight-x-e.clientHeight:0,M=o?e.offsetWidth-S-e.clientWidth:0,k=a?_+S:0,E=a?Z+x:0,W=r?r.width:p(n.width)-k-M,V=r?r.height:p(n.height)-E-R,F=W+_+M+S,X=V+Z+R+x,H=s({devicePixelContentBoxSize:m(Math.round(W*devicePixelRatio),Math.round(V*devicePixelRatio),i),borderBoxSize:m(F,X,i),contentBoxSize:m(W,V,i),contentRect:new u(y,d,W,V)});return A.set(e,H),H},y=function(e,t,n){var a=b(e,n),i=a.borderBoxSize,o=a.contentBoxSize,s=a.devicePixelContentBoxSize;switch(t){case r.DEVICE_PIXEL_CONTENT_BOX:return s;case r.BORDER_BOX:return i;default:return o}},B=function(e){var t=b(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=s([t.borderBoxSize]),this.contentBoxSize=s([t.contentBoxSize]),this.devicePixelContentBoxSize=s([t.devicePixelContentBoxSize])},G=function(e){if(g(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},w=function(){var e=1/0,t=[];a.forEach((function(n){if(0!==n.activeTargets.length){var r=[];n.activeTargets.forEach((function(t){var n=new B(t.target),a=G(t.target);r.push(n),t.lastReportedSize=y(t.target,t.observedBox),a<e&&(e=a)})),t.push((function(){n.callback.call(n.observer,r,n.observer)})),n.activeTargets.splice(0,n.activeTargets.length)}}));for(var n=0,r=t;n<r.length;n++){(0,r[n])()}return e},_=function(e){a.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(n){n.isActive()&&(G(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))}))}))},Z=function(){var e=0;for(_(e);a.some((function(e){return e.activeTargets.length>0}));)e=w(),_(e);return a.some((function(e){return e.skippedTargets.length>0}))&&function(){var e;"function"===typeof ErrorEvent?e=new ErrorEvent("error",{message:i}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=i),window.dispatchEvent(e)}(),e>0},S=[],x=function(e){if(!o){var t=0,n=document.createTextNode("");new MutationObserver((function(){return S.splice(0).forEach((function(e){return e()}))})).observe(n,{characterData:!0}),o=function(){n.textContent=""+(t?t--:t++)}}S.push(e),o()},R=0,M={attributes:!0,characterData:!0,childList:!0,subtree:!0},k=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],E=function(e){return void 0===e&&(e=0),Date.now()+e},W=!1,V=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!W){W=!0;var n,r=E(e);n=function(){var n=!1;try{n=Z()}finally{if(W=!1,e=r-E(),!R)return;n?t.run(1e3):e>0?t.run(e):t.start()}},x((function(){requestAnimationFrame(n)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,M)};document.body?t():I.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),k.forEach((function(t){return I.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),k.forEach((function(t){return I.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),F=function(e){!R&&e>0&&V.start(),!(R+=e)&&V.stop()},X=function(){function e(e,t){this.target=e,this.observedBox=t||r.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=y(this.target,this.observedBox,!0);return e=this.target,l(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),H=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},O=new WeakMap,L=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return-1},N=function(){function e(){}return e.connect=function(e,t){var n=new H(e,t);O.set(e,n)},e.observe=function(e,t,n){var r=O.get(e),i=0===r.observationTargets.length;L(r.observationTargets,t)<0&&(i&&a.push(r),r.observationTargets.push(new X(t,n&&n.box)),F(1),V.schedule())},e.unobserve=function(e,t){var n=O.get(e),r=L(n.observationTargets,t),i=1===n.observationTargets.length;r>=0&&(i&&a.splice(a.indexOf(n),1),n.observationTargets.splice(r,1),F(-1))},e.disconnect=function(e){var t=this,n=O.get(e);n.observationTargets.slice().forEach((function(n){return t.unobserve(e,n.target)})),n.activeTargets.splice(0,n.activeTargets.length)},e}(),Y=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!==typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");N.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!d(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");N.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!d(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");N.unobserve(this,e)},e.prototype.disconnect=function(){N.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}()}]]);
//# sourceMappingURL=2.19c653b0.chunk.js.map